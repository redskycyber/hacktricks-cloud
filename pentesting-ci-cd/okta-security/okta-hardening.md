# Zabezpieczenia Okta

<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

## Katalog

### Osoby

Z perspektywy atakujcego jest to bardzo interesujce, poniewa偶 bdziesz m贸g zobaczy **wszystkich zarejestrowanych u偶ytkownik贸w**, ich **adresy email**, **grupy**, do kt贸rych nale偶, **profile** oraz nawet **urzdzenia** (telefony kom贸rkowe wraz z ich systemami operacyjnymi).

Podczas przegldu whitebox sprawd藕, czy nie ma kilku "**Oczekujcych dziaa u偶ytkownika**" i "**Reset贸w hasa**".

### Grupy

To tutaj znajdziesz wszystkie utworzone grupy w Okta. Interesujce jest zrozumienie r贸偶nych grup (zestaw **uprawnie**), kt贸re mog by przyznane **u偶ytkownikom**.\
Mo偶na zobaczy **osoby zawarte w grupach** oraz **aplikacje przypisane** do ka偶dej grupy.

Oczywicie, ka偶da grupa o nazwie **admin** jest interesujca, zwaszcza grupa **Global Administrators**, sprawd藕 czonk贸w, aby dowiedzie si, kto ma najwiksze uprawnienia.

Podczas przegldu whitebox **nie powinno by wicej ni偶 5 globalnych administrator贸w** (lepiej, jeli jest ich tylko 2 lub 3).

### Urzdzenia

Znajdziesz tutaj **list wszystkich urzdze** wszystkich u偶ytkownik贸w. Mo偶esz r贸wnie偶 sprawdzi, czy s **aktywnie zarzdzane** czy nie.

### Edytor profilu

Tutaj mo偶na zobaczy, jakie kluczowe informacje, takie jak imiona, nazwiska, adresy email, nazwy u偶ytkownik贸w... s udostpniane midzy Okta a innymi aplikacjami. Jest to interesujce, poniewa偶 jeli u偶ytkownik mo偶e **modyfikowa w Okta pole** (takie jak jego imi lub email), kt贸re jest nastpnie u偶ywane przez **zewntrzn aplikacj** do **identyfikacji** u偶ytkownika, wewntrzny u偶ytkownik mo偶e pr贸bowa **przej inne konta**.

Co wicej, w profilu **`U偶ytkownik (domylny)`** z Okta mo偶na zobaczy, **jakie pola** ma ka偶dy **u偶ytkownik** i kt贸re z nich s **mo偶liwe do zapisania** przez u偶ytkownik贸w. Jeli nie widzisz panelu administratora, przejd藕 do **aktualizacji informacji o swoim profilu**, a zobaczysz, kt贸re pola mo偶esz zaktualizowa (zauwa偶, 偶e do zaktualizowania adresu email bdziesz musia go zweryfikowa).

### Integracje katalog贸w

Katalogi pozwalaj importowa osoby z istniejcych 藕r贸de. Przypuszczam, 偶e tutaj zobaczysz osoby zaimportowane z innych katalog贸w.

Nie widziaem tego, ale przypuszczam, 偶e jest to interesujce, aby dowiedzie si, **z jakich innych katalog贸w Okta korzysta do importowania u偶ytkownik贸w**, wic jeli **skompromitujesz ten katalog**, mo偶esz ustawi wartoci atrybut贸w w u偶ytkownikach utworzonych w Okta i **mo偶e skompromitowa rodowisko Okta**.

### 殴r贸da profilu

殴r贸do profilu to **aplikacja, kt贸ra dziaa jako 藕r贸do prawdy** dla atrybut贸w profilu u偶ytkownika. U偶ytkownik mo偶e by 藕r贸dem tylko jednej aplikacji lub katalogu w danym czasie.

Nie widziaem tego, wic wszelkie informacje dotyczce bezpieczestwa i hakowania dotyczce tej opcji s mile widziane.

## Dostosowania

### Marki

Sprawd藕 w zakadce **Domeny** tej sekcji adresy email u偶ywane do wysyania wiadomoci e-mail i niestandardow domen wewntrz Okta firmy (kt贸r prawdopodobnie ju偶 znasz).

Co wicej, w zakadce **Ustawienia**, jeli jeste administratorem, mo偶esz "**U偶yj niestandardowej strony wylogowania**" i ustawi niestandardowy adres URL.

### SMS

Nic interesujcego tutaj.

### Panel u偶ytkownika kocowego

Mo偶esz tutaj znale藕 skonfigurowane aplikacje, ale szczeg贸y tych aplikacji zobaczymy p贸藕niej w innej sekcji.

### Inne

Interesujce ustawienie, ale nic super interesujcego z punktu widzenia bezpieczestwa.

## Aplikacje

### Aplikacje

Tutaj znajdziesz wszystkie **skonfigurowane aplikacje** i ich szczeg贸y: Kto ma do nich dostp, jak s skonfigurowane (SAML, OPenID), URL do logowania, mapowania midzy Okta a aplikacj...

W zakadce **`Logowanie`** jest r贸wnie偶 pole o nazwie **`Ujawnienie hasa`**, kt贸re pozwolioby u偶ytkownikowi **ujawni swoje haso**, sprawdzajc ustawienia aplikacji. Aby sprawdzi ustawienia aplikacji z panelu u偶ytkownika, kliknij 3 kropki:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

I mo偶esz zobaczy wicej szczeg贸贸w o aplikacji (np. funkcj ujawniania hasa, jeli jest wczona):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Zarzdzanie to偶samoci

### Certyfikaty dostpu

U偶yj Certyfikat贸w dostpu, aby tworzy kampanie audytowe w celu okresowego przegldu dostpu u偶ytkownik贸w do zasob贸w i automatycznego zatwierdzania lub wycofywania dostpu, gdy jest to wymagane.

Nie widziaem tego u偶ywanego, ale przypuszczam, 偶e z punktu widzenia obronnego jest to fajna funkcja.

## Bezpieczestwo

### Og贸lne

* **Emaile z powiadomieniami o bezpieczestwie**: Wszystkie powinny by wczone.
* **Integracja CAPTCHA**: Zaleca si ustawienie przynajmniej niewidocznego reCaptcha
* **Bezpieczestwo organizacji**: Wszystko mo偶e by wczone, a emaile aktywacyjne nie powinny by dugotrwae (7 dni jest ok)
* **Zapobieganie wyliczaniu u偶ytkownik贸w**: Oba powinny by wczone
* Zauwa偶, 偶e Zapobieganie wyliczaniu u偶ytkownik贸w nie dziaa, jeli kt贸re z poni偶szych warunk贸w jest dozwolone (Zobacz [Zarzdzanie u偶ytkownikami](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) dla wicej informacji):
* Rejestracja samodzielna
* Przepywy JIT z uwierzytelnianiem email
* **Ustawienia Okta ThreatInsight**: Rejestruj i egzekwuj bezpieczestwo na podstawie poziomu zagro偶enia

### HealthInsight

Tutaj mo偶na znale藕 poprawnie i **niebezpiecznie** skonfigurowane **ustawienia**.

### Autentykatory

Tutaj znajdziesz wszystkie metody uwierzytelniania, kt贸rych u偶ytkownik m贸gby u偶y: Haso, telefon, email, kod, WebAuthn... Klikajc w autentykator hasa, mo偶esz zobaczy **polityk hasa**. Sprawd藕, czy jest silna.

W zakadce **Rejestracja** mo偶na zobaczy, kt贸re s wymagane, a kt贸re opcjonalne:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Zaleca si wyczenie Telefonu. Najmocniejsze s prawdopodobnie kombinacje hasa, emaila i WebAuthn.

### Polityki uwierzytelniania

Ka偶da aplikacja ma polityk uwierzytelniania. Polityka uwierzytelniania sprawdza, czy u偶ytkownicy, kt贸rzy pr贸buj si zalogowa do aplikacji, speniaj okrelone warunki, i nakada wymagania dotyczce czynnik贸w na podstawie tych warunk贸w.

Tutaj mo偶na znale藕 **wymagania dostpu do ka偶dej aplikacji**. Zaleca si 偶danie przynajmniej hasa i innego sposobu dla ka偶dej aplikacji. Ale jeli jako atakujcy znajdziesz co sabszego, mo偶esz by w stanie je zaatakowa.
### Globalna polityka sesji

Tutaj znajdziesz polityki sesji przypisane do r贸偶nych grup. Na przykad:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Zaleca si 偶danie MFA, ograniczenie czasu trwania sesji do kilku godzin, nie przechowywanie ciasteczek sesji w rozszerzeniach przegldarki oraz ograniczenie lokalizacji i dostawcy to偶samoci (jeli to mo偶liwe). Na przykad, jeli ka偶dy u偶ytkownik powinien logowa si z okrelonego kraju, mo偶na zezwoli tylko na t lokalizacj.

### Dostawcy To偶samoci

Dostawcy to偶samoci (IdPs) to usugi, kt贸re **zarzdzaj kontami u偶ytkownik贸w**. Dodanie IdPs w Okta umo偶liwia kocowym u偶ytkownikom **samodzielne rejestracje** w twoich niestandardowych aplikacjach, logujc si najpierw za pomoc konta spoecznociowego lub karty inteligentnej.

Na stronie Dostawc贸w To偶samoci mo偶esz doda logowanie spoecznociowe (IdPs) i skonfigurowa Okta jako dostawc usug (SP), dodajc przychodzcy SAML. Po dodaniu IdPs, mo偶esz skonfigurowa reguy routingu, aby kierowa u偶ytkownik贸w do IdP na podstawie kontekstu, takiego jak lokalizacja u偶ytkownika, urzdzenie lub domena e-mail.

**Jeli jaki dostawca to偶samoci jest skonfigurowany** z perspektywy atakujcego i obrocy, sprawd藕 t konfiguracj i **czy 藕r贸do jest naprawd godne zaufania**, poniewa偶 atakujcy, kt贸ry go skompromituje, mo偶e uzyska dostp do rodowiska Okta.

### Autoryzacja Delegowana

Autoryzacja delegowana pozwala u偶ytkownikom zalogowa si do Okta, wprowadzajc dane uwierzytelniajce do **Aktywnego Katalogu (AD) organizacji lub serwera LDAP**.

Ponownie sprawd藕 to, poniewa偶 atakujcy, kt贸ry skompromituje katalog AD organizacji, mo偶e by w stanie przej do Okta dziki tej konfiguracji.

### Sie

Strefa sieciowa to konfigurowalna granica, kt贸r mo偶na wykorzysta do **udzielania lub ograniczania dostpu do komputer贸w i urzdze** w twojej organizacji na podstawie **adresu IP**, kt贸ry 偶da dostpu. Mo偶esz zdefiniowa stref sieciow, okrelajc jeden lub wicej indywidualnych adres贸w IP, zakresy adres贸w IP lub lokalizacje geograficzne.

Po zdefiniowaniu jednej lub wicej stref sieciowych, mo偶esz **u偶ywa ich w Globalnych Politykach Sesji**, **politykach uwierzytelniania**, powiadomieniach VPN i **reguach routingu**.

Z perspektywy atakujcego interesujce jest wiedzie, kt贸re adresy IP s dozwolone (i sprawdzi, czy jakie **adresy IP s bardziej uprzywilejowane** ni偶 inne). Z perspektywy atakujcego, jeli u偶ytkownicy powinni uzyskiwa dostp z okrelonego adresu IP lub regionu, sprawd藕, czy ta funkcja jest waciwie u偶ywana.

### Integracje Urzdze

* **Zarzdzanie Punktem Kocowym**: Zarzdzanie punktem kocowym to warunek, kt贸ry mo偶na zastosowa w polityce uwierzytelniania, aby zapewni, 偶e zarzdzane urzdzenia maj dostp do aplikacji.
* Jeszcze tego nie widziaem. TODO
* **Usugi powiadomie**: Jeszcze tego nie widziaem. TODO

### API

Mo偶esz tworzy tokeny API Okta na tej stronie i zobaczy te, kt贸re zostay **utworzone**, ich **uprawnienia**, **czas wyganicia** i **adresy URL pochodzenia**. Nale偶y pamita, 偶e tokeny API s generowane z uprawnieniami u偶ytkownika, kt贸ry je utworzy, i s wa偶ne tylko wtedy, gdy **u偶ytkownik**, kt贸ry je utworzy, jest **aktywny**.

**Zaufane 藕r贸da** umo偶liwiaj dostp do stron internetowych, kt贸re kontrolujesz i kt贸rym ufasz, aby uzyska dostp do twojej organizacji Okta za porednictwem interfejsu API Okta.

Nie powinno by zbyt wielu token贸w API, poniewa偶 atakujcy m贸gby pr贸bowa uzyska do nich dostp i ich u偶ywa.

## Przepyw pracy

### Automatyzacje

Automatyzacje pozwalaj tworzy zautomatyzowane akcje, kt贸re uruchamiaj si na podstawie zestawu warunk贸w wyzwalajcych, kt贸re wystpuj podczas cyklu 偶ycia u偶ytkownik贸w.

Na przykad warunkiem mo偶e by "Nieaktywno u偶ytkownika w Okta" lub "Wyganicie hasa u偶ytkownika w Okta", a akcj mo偶e by "Wysanie e-maila do u偶ytkownika" lub "Zmiana stanu cyklu 偶ycia u偶ytkownika w Okta".

## Raporty

### Raporty

Pobierz logi. S **wysyane** na **adres e-mail** bie偶cego konta.

### Dziennik systemowy

Tutaj znajdziesz **logi dziaa wykonywanych przez u偶ytkownik贸w** z wieloma szczeg贸ami, takimi jak logowanie si do Okta lub do aplikacji za porednictwem Okta.

### Monitorowanie Importu

Mo偶na **importowa logi z innych platform**, do kt贸rych uzyskano dostp za pomoc Okta.

### Limity szybkoci

Sprawd藕 osignite limity szybkoci API.

## Ustawienia

### Konto

Tutaj znajdziesz **og贸lne informacje** o rodowisku Okta, takie jak nazwa firmy, adres, **kontakt do rozlicze e-mail**, **kontakt techniczny e-mail** oraz osoby, kt贸re powinny otrzymywa aktualizacje Okta i jakiego rodzaju aktualizacje Okta.

### Pobrania

Tutaj mo偶esz pobra agenty Okta do synchronizacji Okta z innymi technologiami.
