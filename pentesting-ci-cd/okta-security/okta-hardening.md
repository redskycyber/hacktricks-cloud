# Zabezpieczanie Okta

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Katalog

### Osoby

Z perspektywy atakujcego jest to bardzo interesujce, poniewa偶 bdziesz m贸g zobaczy **wszystkich zarejestrowanych u偶ytkownik贸w**, ich **adresy e-mail**, **grupy**, do kt贸rych nale偶, **profile** i nawet **urzdzenia** (telefony kom贸rkowe wraz z ich systemami operacyjnymi).

Podczas przegldu whiteboxowego sprawd藕, czy nie ma kilku "**Oczekujcych dziaa u偶ytkownika**" i "**Reset贸w hasa**".

### Grupy

To jest miejsce, gdzie znajdziesz wszystkie utworzone grupy w Okta. Interesujce jest zrozumienie r贸偶nych grup (zestaw **uprawnie**), kt贸re mog by przyznane **u偶ytkownikom**.\
Mo偶na zobaczy **osoby zawarte w grupach** i **przypisane aplikacje** do ka偶dej grupy.

Oczywicie, ka偶da grupa o nazwie **admin** jest interesujca, zwaszcza grupa **Global Administrators**, sprawd藕 czonk贸w, aby dowiedzie si, kto ma najwiksze uprawnienia.

Podczas przegldu whiteboxowego **nie powinno by wicej ni偶 5 globalnych administrator贸w** (lepiej, jeli jest ich tylko 2 lub 3).

### Urzdzenia

Znajd藕 tutaj **list wszystkich urzdze** wszystkich u偶ytkownik贸w. Mo偶na r贸wnie偶 zobaczy, czy jest ono **aktywnie zarzdzane** czy nie.

### Edytor profilu

Tutaj mo偶na zobaczy, jak kluczowe informacje, takie jak imiona, nazwiska, adresy e-mail, nazwy u偶ytkownik贸w... s udostpniane midzy Okta a innymi aplikacjami. Jest to interesujce, poniewa偶 jeli u偶ytkownik mo偶e **zmodyfikowa w Okta pole** (takie jak jego imi lub adres e-mail), kt贸re nastpnie jest u偶ywane przez **zewntrzn aplikacj** do **identyfikacji** u偶ytkownika, wewntrzny u偶ytkownik mo偶e pr贸bowa **przej inne konta**.

Ponadto, w profilu **`U偶ytkownik (domylny)`** z Okta mo偶na zobaczy, **jakie pola** ma ka偶dy **u偶ytkownik** i kt贸re z nich s **edytowalne** przez u偶ytkownik贸w. Jeli nie widzisz panelu administratora, przejd藕 do **aktualizacji informacji o swoim profilu**, a zobaczysz, kt贸re pola mo偶esz zaktualizowa (zauwa偶, 偶e aby zaktualizowa adres e-mail, trzeba go zweryfikowa).

### Integracje katalog贸w

Katalogi umo偶liwiaj importowanie os贸b z istniejcych 藕r贸de. Przypuszczam, 偶e tutaj zobaczysz u偶ytkownik贸w importowanych z innych katalog贸w.

Nie widziaem tego, ale przypuszczam, 偶e jest to interesujce, aby dowiedzie si, **jakie inne katalogi Okta u偶ywa do importowania u偶ytkownik贸w**, wic jeli **skompromitujesz ten katalog**, mo偶esz ustawi wartoci atrybut贸w w u偶ytkownikach utworzonych w Okta i **mo偶e skompromitowa rodowisko Okta**.

### 殴r贸da profilu

殴r贸do profilu to **aplikacja, kt贸ra dziaa jako 藕r贸do prawdy** dla atrybut贸w profilu u偶ytkownika. U偶ytkownik mo偶e by 藕r贸dowy tylko dla jednej aplikacji lub katalogu w danym czasie.

Nie widziaem tego, wic wszelkie informacje dotyczce bezpieczestwa i hakowania w tej opcji s mile widziane.

## Dostosowania

### Marki

Sprawd藕 w zakadce **Domeny** tej sekcji adresy e-mail u偶ywane do wysyania wiadomoci e-mail i niestandardow domen wewntrz Okta firmy (kt贸r prawdopodobnie ju偶 znasz).

Ponadto, w zakadce **Ustawienia**, jeli jeste administratorem, mo偶esz "**U偶yj niestandardowej strony wylogowania**" i ustawi niestandardowy adres URL.

### SMS

Nic interesujcego tutaj.

### Panel u偶ytkownika kocowego

Tutaj mo偶na znale藕 skonfigurowane aplikacje, ale szczeg贸y na ich temat zobaczymy p贸藕niej w innej sekcji.

### Inne

Interesujce ustawienie, ale nic super interesujcego z punktu widzenia bezpieczestwa.

## Aplikacje

### Aplikacje

Tutaj mo偶na znale藕 wszystkie **skonfigurowane aplikacje** i ich szczeg贸y: Kto ma do nich dostp, jak jest skonfigurowane (SAML, OPenID), URL do logowania, mapowanie midzy Okta a aplikacj...

W zakadce **`Logowanie`** znajduje si r贸wnie偶 pole o nazwie **`Ujawnienie hasa`**, kt贸re umo偶liwia u偶ytkownikowi **ujawnienie swojego hasa** podczas sprawdzania ustawie aplikacji. Aby sprawdzi ustawienia aplikacji z panelu u偶ytkownika, kliknij trzy kropki:

<figure><img src="../../.gitbook/assets/image (4) (7).png" alt=""><figcaption></figcaption></figure>

I mo偶na zobaczy wicej szczeg贸贸w na temat aplikacji (takich jak funkcja ujawniania hasa, jeli jest wczona):

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## Zarzdzanie to偶samoci

### Certyfikaty dostpu

U偶yj Certyfikat贸w dostpu, aby tworzy kampanie audytowe w celu okresowego przegldu dostpu u偶ytkownik贸w do zasob贸w i automatycznego zatwierdzania lub cofania dostpu, gdy jest to wymagane.

Nie widziaem tego u偶ywanego, ale przypuszczam, 偶e z perspektywy obronnej jest to przydatna funkcja.

## Bezpieczestwo

### Og贸lne

* **E-maile z powiadomieniami o bezpieczestwie**: Wszystkie powinny by wczone.
* **Integracja CAPTCHA**: Zaleca si ustawienie co najmniej niewidocznego reCaptcha
* **Bezpieczestwo organizacji**: Wszystko mo偶na wczy, a e-maile aktywacyjne nie powinny by dugotrwae (7 dni jest ok)
* **Zapobieganie wyliczaniu u偶ytkownik贸w**: Oba powinny by wczone
* Zauwa偶, 偶e Zapobieganie wyliczaniu u偶ytkownik贸w nie dziaa, jeli dozwolone s kt贸re z nastpujcych warunk贸w (Zobacz [Zarzdzanie u偶ytkownikami](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) dla wicej informacji):
* Rejestracja samoobsugowa
* Przepywy JIT z uwierzytelnianiem e-mail
* **Ustawienia Okta ThreatInsight**: Rejestruj i egzekwuj zabezpieczenia na podstawie poziomu zagro偶enia

### HealthInsight

Tutaj mo偶na znale藕 poprawnie i **niebezpiecznie** skonfigurowane **ustawienia**.

### Autentykatory

Tutaj mo偶na znale藕 wszystkie metody uwierzytelniania, kt贸re u偶ytk
### Globalna polityka sesji

Tutaj mo偶na znale藕 polityki sesji przypisane do r贸偶nych grup. Na przykad:

<figure><img src="../../.gitbook/assets/image (2) (1) (2).png" alt=""><figcaption></figcaption></figure>

Zaleca si 偶danie MFA, ograniczenie czasu trwania sesji do kilku godzin, niezachowywanie ciasteczek sesji w rozszerzeniach przegldarki oraz ograniczenie lokalizacji i dostawcy to偶samoci (jeli to mo偶liwe). Na przykad, jeli ka偶dy u偶ytkownik powinien logowa si z okrelonego kraju, mo偶na zezwoli tylko na t lokalizacj.

### Dostawcy to偶samoci

Dostawcy to偶samoci (IdP) to usugi, kt贸re **zarzdzaj kontami u偶ytkownik贸w**. Dodanie IdP w Okta umo偶liwia kocowym u偶ytkownikom **samodzielne rejestracj** w Twoich niestandardowych aplikacjach, logujc si najpierw za pomoc konta spoecznociowego lub karty inteligentnej.

Na stronie Dostawcy to偶samoci mo偶na doda logowanie za pomoc kont spoecznociowych (IdP) i skonfigurowa Okta jako dostawc usug (SP), dodajc przychodzcy protok贸 SAML. Po dodaniu IdP mo偶na skonfigurowa reguy routingu, aby kierowa u偶ytkownik贸w do IdP na podstawie kontekstu, takiego jak lokalizacja u偶ytkownika, urzdzenie lub domena e-mail.

**Jeli skonfigurowano jakiegokolwiek dostawc to偶samoci**, z punktu widzenia atakujcego i obrocy nale偶y sprawdzi t konfiguracj i **czy 藕r贸do jest naprawd godne zaufania**, poniewa偶 atakujcy, przejmujc je, mo偶e uzyska dostp do rodowiska Okta.

### Delegowane uwierzytelnianie

Delegowane uwierzytelnianie umo偶liwia u偶ytkownikom logowanie si do Okta, wprowadzajc dane uwierzytelniajce dla **Aktywnego Katalogu (AD) lub serwera LDAP** ich organizacji.

Ponownie sprawd藕 to, poniewa偶 atakujcy, przejmujc AD organizacji, mo偶e uzyska dostp do Okta dziki tej konfiguracji.

### Sie

Strefa sieciowa to konfigurowalne ograniczenie, kt贸re mo偶na u偶y do **udzielania lub ograniczania dostpu do komputer贸w i urzdze** w Twojej organizacji na podstawie **adresu IP**, kt贸ry 偶da dostpu. Mo偶na zdefiniowa stref sieciow, okrelajc jeden lub wicej indywidualnych adres贸w IP, zakresy adres贸w IP lub lokalizacje geograficzne.

Po zdefiniowaniu jednej lub wicej stref sieciowych mo偶na **u偶ywa ich w globalnych politykach sesji**, politykach uwierzytelniania, powiadomieniach VPN i reguach routingu.

Z perspektywy atakujcego interesujce jest, kt贸re Ps s dozwolone (i sprawdzenie, czy jakiekolwiek **adresy IP maj wiksze uprawnienia** ni偶 inne). Z perspektywy atakujcego, jeli u偶ytkownicy powinni mie dostp z okrelonego adresu IP lub regionu, sprawd藕, czy ta funkcja jest prawidowo u偶ywana.

### Integracje urzdze

* **Zarzdzanie punktami kocowymi**: Zarzdzanie punktami kocowymi to warunek, kt贸ry mo偶na zastosowa w polityce uwierzytelniania, aby zapewni, 偶e zarzdzane urzdzenia maj dostp do aplikacji.
* Jeszcze nie widziaem, 偶eby to byo u偶ywane. TODO
* **Usugi powiadomie**: Jeszcze nie widziaem, 偶eby to byo u偶ywane. TODO

### API

Na tej stronie mo偶na tworzy tokeny API Okta i zobaczy te, kt贸re zostay **utworzone**, ich **uprawnienia**, **czas wyganicia** i **adresy URL pochodzenia**. Nale偶y zauwa偶y, 偶e tokeny API s generowane z uprawnieniami u偶ytkownika, kt贸ry je utworzy, i s wa偶ne tylko wtedy, gdy **u偶ytkownik**, kt贸ry je utworzy, jest **aktywny**.

**Zaufane pochodzenie** umo偶liwia dostp do stron internetowych, kt贸re kontrolujesz i kt贸rym ufasz, do Twojej organizacji Okta za porednictwem interfejsu API Okta.

Nie powinno by zbyt wielu token贸w API, poniewa偶 atakujcy mo偶e pr贸bowa uzyska do nich dostp i ich u偶y.

## Workflow

### Automatyzacje

Automatyzacje umo偶liwiaj tworzenie automatycznych dziaa, kt贸re s wykonywane na podstawie zestawu warunk贸w wyzwalajcych, kt贸re wystpuj podczas cyklu 偶ycia u偶ytkownik贸w kocowych.

Na przykad warunkiem mo偶e by "Brak aktywnoci u偶ytkownika w Okta" lub "Wyganicie hasa u偶ytkownika w Okta", a dziaaniem mo偶e by "Wysanie wiadomoci e-mail do u偶ytkownika" lub "Zmiana stanu cyklu 偶ycia u偶ytkownika w Okta".

## Raporty

### Raporty

Pobierz logi. S **wysyane** na **adres e-mail** bie偶cego konta.

### Dziennik systemowy

Tutaj mo偶na znale藕 **logi dziaa wykonywanych przez u偶ytkownik贸w** z wieloma szczeg贸ami, takimi jak logowanie do Okta lub do aplikacji za porednictwem Okta.

### Monitorowanie importu

Mo偶na **importowa logi z innych platform**, do kt贸rych uzyskano dostp za pomoc Okta.

### Limity szybkoci

Sprawd藕 osignite limity szybkoci API.

## Ustawienia

### Konto

Tutaj mo偶na znale藕 **og贸lne informacje** o rodowisku Okta, takie jak nazwa firmy, adres, **kontakt rozliczeniowy e-mail**, **kontakt techniczny e-mail**, a tak偶e informacje o tym, kto powinien otrzymywa aktualizacje Okta i jakiego rodzaju aktualizacje Okta.

### Pobrania

Tutaj mo偶na pobra agent贸w Okta do synchronizacji z innymi technologiami.

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
