# Okta Bezbednost

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

[Okta, Inc.](https://www.okta.com/) je prepoznata u sektoru identiteta i upravljanja pristupom zbog svojih softverskih re코enja zasnovanih na oblaku. Ova re코enja su dizajnirana da pojednostave i obezbede autentifikaciju korisnika na razli캜itim modernim aplikacijama. Ona ne samo da slu쬰 kompanijama koje 쬰le da za코tite svoje osetljive podatke, ve캖 i programerima koji su zainteresovani za integraciju kontrola identiteta u aplikacije, veb servise i ure캠aje.

Glavna ponuda od Okta-e je **Okta Identity Cloud**. Ova platforma obuhvata niz proizvoda, uklju캜uju캖i, ali ne ograni캜avaju캖i se na:

- **Single Sign-On (SSO)**: Pojednostavljuje pristup korisnika omogu캖avaju캖i jedan set prijavljivanja za vi코e aplikacija.
- **Multi-Factor Authentication (MFA)**: Pove캖ava bezbednost zahtevaju캖i vi코e oblika verifikacije.
- **Lifecycle Management**: Automatizuje procese kreiranja, a쬿riranja i deaktivacije korisni캜kih naloga.
- **Universal Directory**: Omogu캖ava centralizovano upravljanje korisnicima, grupama i ure캠ajima.
- **API Access Management**: Obezbe캠uje i upravlja pristupom API-ima.

Ove usluge zajedno imaju za cilj da oja캜aju za코titu podataka i pojednostave pristup korisnika, pobolj코avaju캖i i bezbednost i prakti캜nost. Svestranost Okta-inih re코enja 캜ini ih popularnim izborom u razli캜itim industrijama, korisnim za velike preduze캖e, male kompanije i pojedina캜ne programere. Prema poslednjem a쬿riranju u septembru 2021. godine, Okta je priznata kao zna캜ajna entitet u oblasti upravljanja identitetom i pristupom (IAM).

{% hint style="danger" %}
Glavni cilj Okta-e je konfiguracija pristupa razli캜itim korisnicima i grupama za spoljne aplikacije. Ako uspete da **kompromitujete administratorske privilegije u Okta** okru쬰nju, vrlo je verovatno da 캖ete mo캖i da **kompromitujete sve druge platforme koje kompanija koristi**.
{% endhint %}

{% hint style="success" %}
Da biste izvr코ili sigurnosni pregled Okta okru쬰nja, trebali biste zatra쬴ti **administrator pristup samo za 캜itanje**.
{% endhint %}

### Rezime

Postoje **korisnici** (koji mogu biti **sa캜uvani u Okta-i**, prijavljeni iz konfigurisanih **Identity Providers** ili autentifikovani putem **Active Directory**-ja ili LDAP-a).\
Ovi korisnici mogu biti unutar **grupa**.\
Tu su i **autentifikatori**: razli캜ite opcije za autentifikaciju kao 코to su lozinka i nekoliko 2FA metoda kao 코to su WebAuthn, e-po코ta, telefon, Okta Verify (mogu biti omogu캖eni ili onemogu캖eni)...

Zatim, postoje **aplikacije** sinhronizovane sa Okta-om. Svaka aplikacija 캖e imati neko **mapiranje sa Okta-om** za deljenje informacija (kao 코to su adrese e-po코te, imena...). Osim toga, svaka aplikacija mora biti unutar **Authentication Policy**-ja, koji pokazuje **potrebne autentifikatore** za korisnika da **pristupi** aplikaciji.

{% hint style="danger" %}
Najmo캖nija uloga je **Super Administrator**.

Ako napada캜 kompromituje Okta-u sa administratorskim pristupom, sve **aplikacije koje veruju Okta-i** 캖e vrlo verovatno biti **kompromitovane**.
{% endhint %}

## Napadi

### Pronala쬰nje Okta Portala

Obi캜no 캖e portal kompanije biti sme코ten na **companyname.okta.com**. Ako nije, poku코ajte jednostavne **varijacije** od **companyname**. Ako ga ne mo쬰te prona캖i, tako캠e je mogu캖e da organizacija ima **CNAME** zapis kao 코to je **`okta.companyname.com`** koji pokazuje na **Okta portal**.

### Prijavljivanje na Okta putem Kerberosa

Ako je **`companyname.kerberos.okta.com`** aktivan, **Kerberos se koristi za pristup Okta-i**, obi캜no zaobilaze캖i **MFA** za **Windows** korisnike. Da biste prona코li korisnike Okta-e autentifikovane putem Kerberosa u AD-u, pokrenite **`getST.py`** sa **odgovaraju캖im parametrima**. Nakon dobijanja **AD korisni캜kog tiketa**, **ubacite** ga u kontrolisani host koriste캖i alate poput Rubeus-a ili Mimikatz-a, obezbe캠uju캖i da je **`clientname.kerberos.okta.com` u zoni "Intranet" Internet opcija**. Pristupanje odre캠enom URL-u trebalo bi da vrati JSON "OK" odgovor, 코to ukazuje na prihvatanje Kerberos tiketa i omogu캖ava pristup Okta kontrolnoj tabli.

Kompromitovanje **Okta servisnog naloga sa delegacijom SPN omogu캖ava napad Silver Ticket**. Me캠utim, Okta-ino kori코캖enje **AES** za enkripciju tiketa zahteva posedovanje AES klju캜a ili 코ifre u obliku otvorenog teksta. Koristite **`ticketer.py`** da biste generisali tiket za korisnika rtve i dostavite ga putem pregleda캜a radi autentifikacije sa Okta-om.

**Proverite napad na [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers).**

### Hakovanje Okta AD Agent-a

Ova tehnika uklju캜uje **pristupanje Okta AD Agent-u na serveru**, koji sinhronizuje korisnike i upravlja autentifikacijom. Pregledanjem i de코ifrovanjem konfiguracija u **`OktaAgentService.exe.config`**, posebno AgentToken-a koriste캖i **DPAPI**, napada캜 potencijalno mo쬰 **presresti i manipulisati podacima za autentifikaciju**. Ovo omogu캖ava ne samo **pra캖enje** i **hvatanje korisni캜kih podataka za prijavljivanje** u obi캜nom tekstu tokom Okta procesa autentifikacije, ve캖 i **odgovaranje na poku코aje autentifikacije**, 캜ime se omogu캖ava ne
### Fi코ingovanje Okta portala pomo캖u Evilgnix-a

U [**ovom blog postu**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) je obja코njeno kako pripremiti kampanju fi코inga protiv Okta portala.

### Napad impersonacije kolege

**Atributi koje svaki korisnik mo쬰 imati i menjati** (kao 코to su email ili ime) mogu se konfigurisati u Okta. Ako je **aplikacija** **poverljiva** prema ID-u **atributa** koji korisnik mo쬰 **menjati**, on 캖e mo캖i **impersonirati druge korisnike na toj platformi**.

Dakle, ako aplikacija veruje polju **`userName`**, verovatno ne캖ete mo캖i da ga promenite (jer obi캜no ne mo쬰te promeniti to polje), ali ako veruje, na primer, **`primaryEmail`**, mo쬯a 캖ete mo캖i da ga **promenite u email adresu kolege** i impersonirate ga (morate imati pristup emailu i prihvatiti promenu).

Imajte na umu da ova impersonacija zavisi od toga kako je svaka aplikacija konfigurisana. Samo one koje veruju polju koje ste promenili i prihvataju a쬿riranja 캖e biti kompromitovane.\
Stoga, aplikacija bi trebalo da ima ovo polje omogu캖eno ako postoji:

<figure><img src="../../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

Tako캠e sam video druge aplikacije koje su bile ranjive, ali nisu imale to polje u Okta pode코avanjima (na kraju razli캜ite aplikacije su razli캜ito konfigurisane).

Najbolji na캜in da saznate da li mo쬰te impersonirati bilo koga na svakoj aplikaciji je da to poku코ate!

## Izbegavanje politika za otkrivanje pona코anja <a href="#id-9fde" id="id-9fde"></a>

Politike za otkrivanje pona코anja u Okta mogu biti nepoznate sve dok se ne susretnu, ali njihovo **zaobilazno** mo쬰 se posti캖i **ciljaju캖i Okta aplikacije direktno**, izbegavaju캖i glavnu Okta kontrolnu tablu. Sa **Okta pristupnim tokenom**, ponovite token na **URL-u specifi캜nom za aplikaciju u Okta** umesto na glavnoj stranici za prijavu.

Klju캜ne preporuke uklju캜uju:

* **Izbegavajte kori코캖enje** popularnih anonimiziraju캖ih proxy-ja i VPN usluga prilikom ponovnog reprodukovanja uhva캖enih pristupnih tokena.
* Osigurajte **konzistentne korisni캜ke agente** izme캠u klijenta i ponovljenih pristupnih tokena.
* **Su쬬vajte reprodukciju** tokena sa razli캜itih korisnika sa iste IP adrese.
* Budite oprezni prilikom reprodukovanja tokena protiv Okta kontrolne table.
* Ako znate IP adrese rtvene kompanije, **ograni캜ite saobra캖aj** na te IP adrese ili njihov opseg, blokiraju캖i sav ostali saobra캖aj.

## Oja캜avanje Okta sistema

Okta ima mnogo mogu캖ih konfiguracija, na ovoj stranici 캖ete prona캖i kako ih pregledati kako bi bile 코to sigurnije mogu캖e:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Reference

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini da podr쬴te HackTricks:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
