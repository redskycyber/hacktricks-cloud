# Bezpieczestwo Okta

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

[Okta, Inc.](https://www.okta.com/) jest uznawana w sektorze zarzdzania to偶samoci i dostpem za swoje rozwizania oprogramowania oparte na chmurze. Rozwizania te maj na celu usprawnienie i zabezpieczenie uwierzytelniania u偶ytkownik贸w w r贸偶nych nowoczesnych aplikacjach. S one przeznaczone nie tylko dla firm, kt贸re chc chroni swoje poufne dane, ale tak偶e dla programist贸w zainteresowanych integracj kontroli to偶samoci w aplikacje, usugi internetowe i urzdzenia.

Flagowym produktem firmy Okta jest **Okta Identity Cloud**. Ta platforma obejmuje zestaw produkt贸w, w tym midzy innymi:

- **Single Sign-On (SSO)**: Uatwia dostp u偶ytkownik贸w, umo偶liwiajc u偶ycie jednego zestawu danych logowania do wielu aplikacji.
- **Multi-Factor Authentication (MFA)**: Wzmacnia bezpieczestwo, wymagajc wielu form weryfikacji.
- **Lifecycle Management**: Automatyzuje procesy tworzenia, aktualizacji i dezaktywacji kont u偶ytkownik贸w.
- **Universal Directory**: Umo偶liwia scentralizowane zarzdzanie u偶ytkownikami, grupami i urzdzeniami.
- **API Access Management**: Zabezpiecza i zarzdza dostpem do interfejs贸w API.

Te usugi maj na celu wzmocnienie ochrony danych i usprawnienie dostpu u偶ytkownik贸w, poprawiajc zar贸wno bezpieczestwo, jak i wygod. Wielofunkcyjno rozwiza Okta sprawia, 偶e s one popularnym wyborem w r贸偶nych bran偶ach, korzystnym zar贸wno dla du偶ych przedsibiorstw, maych firm, jak i indywidualnych programist贸w. Wedug ostatniej aktualizacji z wrzenia 2021 roku, Okta jest uznawana za prominentnego gracza na rynku zarzdzania to偶samoci i dostpem (IAM).

{% hint style="danger" %}
G贸wnym celem Okta jest konfiguracja dostpu r贸偶nym u偶ytkownikom i grupom do zewntrznych aplikacji. Jeli uda ci si **skompromitowa uprawnienia administratora w rodowisku Okta**, bardzo prawdopodobne jest, 偶e bdziesz w stanie **skompromitowa wszystkie inne platformy, kt贸rych firma u偶ywa**.
{% endhint %}

{% hint style="success" %}
Aby przeprowadzi przegld bezpieczestwa rodowiska Okta, powiniene poprosi o **tylko do odczytu uprawnienia administratora**.
{% endhint %}

### Podsumowanie

Istniej **u偶ytkownicy** (kt贸rzy mog by **przechowywani w Okta**, zalogowani z **skonfigurowanych dostawc贸w to偶samoci** lub uwierzytelniani za pomoc **Active Directory** lub LDAP).\
Ci u偶ytkownicy mog znajdowa si w **grupach**.\
Istniej r贸wnie偶 **uwierzytelnienia**: r贸偶ne opcje uwierzytelniania, takie jak haso i kilka metod dwuskadnikowego uwierzytelniania, takich jak WebAuthn, e-mail, telefon, okta verify (mog by wczone lub wyczone)...

Nastpnie s **aplikacje** zsynchronizowane z Okta. Ka偶da aplikacja bdzie miaa pewne **mapowanie z Okta**, aby udostpni informacje (takie jak adresy e-mail, imiona...). Ponadto, ka偶da aplikacja musi znajdowa si w **polityce uwierzytelniania**, kt贸ra okrela **wymagane uwierzytelnienia** dla u偶ytkownika, aby **uzyska dostp** do aplikacji.

{% hint style="danger" %}
Najbardziej pot偶n rol jest **Super Administrator**.

Jeli atakujcy skompromituje Okta z dostpem administratora, wszystkie **aplikacje ufajce Okta** bd bardzo prawdopodobnie **skompromitowane**.
{% endhint %}

## Ataki

### Lokalizowanie portalu Okta

Zwykle portal firmy bdzie znajdowa si pod adresem **companyname.okta.com**. Jeli nie, spr贸buj prostych **wariacji** nazwy **companyname**. Jeli nie mo偶esz go znale藕, mo偶liwe jest r贸wnie偶, 偶e organizacja ma rekord **CNAME** o nazwie **`okta.companyname.com`**, kt贸ry wskazuje na portal Okta.

### Logowanie do Okta za pomoc Kerberos

Jeli jest aktywny **`companyname.kerberos.okta.com`**, **Kerberos jest u偶ywany do dostpu do Okta**, co zwykle omija **MFA** dla u偶ytkownik贸w **Windows**. Aby znale藕 u偶ytkownik贸w Okta uwierzytelnianych za pomoc Kerberos w AD, uruchom **`getST.py`** z **odpowiednimi parametrami**. Po uzyskaniu **biletu u偶ytkownika AD**, **wstrzyknij** go do kontrolowanego hosta za pomoc narzdzi takich jak Rubeus lub Mimikatz, upewniajc si, 偶e **`clientname.kerberos.okta.com` znajduje si w strefie "Intranet" w opcjach internetowych**. Otwarcie okrelonego adresu URL powinno zwr贸ci odpowied藕 JSON "OK", co wskazuje na zaakceptowanie biletu Kerberos i umo偶liwienie dostpu do pulpitu nawigacyjnego Okta.

Skompromitowanie **konta usugi Okta z uprawnieniami delegacji SPN umo偶liwia atak Silver Ticket**. Jednak u偶ycie przez Okta **AES** do szyfrowania bilet贸w wymaga posiadania klucza AES lub hasa w postaci tekstu jawnego. U偶yj **`ticketer.py`**, aby wygenerowa bilet dla u偶ytkownika ofiary i dostarcz go za pomoc przegldarki, aby uwierzytelni si w Okta.

**Sprawd藕 atak na stronie [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers).**

### Przechwytywanie agenta Okta AD

Ta technika polega na **uzyskaniu dostpu do agenta Okta AD na serwerze**, kt贸ry **synchronizuje u偶ytkownik贸w i obsuguje uwierzytelnianie**. Analizujc i odszyfrowujc konfiguracje w pliku **`OktaAgentService.exe.config`**, w szczeg贸lnoci AgentToken za pomoc **DPAPI**, atakujcy mo偶e potencjalnie **przechwytywa i manipulowa danymi uwierzytelniania**. Pozwala to nie tylko na **monitorowanie** i **przechwytywanie danych uwierzytelniania** u偶ytkownik贸w w postaci tekstu jawnego podczas procesu uwierzytelniania w Okta, ale tak偶e na **odpowiadanie na pr贸by uwierzytelnienia**, umo偶liwiajc tym samym nieautoryzowany dost
### Phishing Okta Portal with Evilgnix

W [**tym wpisie na blogu**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) wyjaniono, jak przygotowa kampani phishingow przeciwko portalowi Okta.

### Atak na podszywanie si pod koleg

**Atrybuty, kt贸re ka偶dy u偶ytkownik mo偶e mie i modyfikowa** (takie jak adres e-mail czy imi) mo偶na skonfigurowa w Okta. Jeli **aplikacja** ufa **atrybutowi** jako ID, kt贸ry u偶ytkownik mo偶e **modyfikowa**, bdzie on m贸g **udawa innych u偶ytkownik贸w na tej platformie**.

Dlatego jeli aplikacja ufa polu **`userName`**, prawdopodobnie nie bdziesz w stanie go zmieni (poniewa偶 zazwyczaj nie mo偶na zmienia tego pola), ale jeli ufa na przykad polu **`primaryEmail`**, mo偶esz go **zmieni na adres e-mail kolegi** i podszywa si pod niego (bdziesz musia mie dostp do tego adresu e-mail i zaakceptowa zmian).

Nale偶y zauwa偶y, 偶e to podszywanie zale偶y od konfiguracji ka偶dej aplikacji. Skompromitowane zostan tylko te, kt贸re ufay zmodyfikowanemu polu i akceptoway aktualizacje.\
Dlatego aplikacja powinna mie to pole wczone, jeli istnieje:

<figure><img src="../../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

Zauwa偶yem r贸wnie偶 inne aplikacje, kt贸re byy podatne, ale nie miay tego pola w ustawieniach Okta (r贸偶ne aplikacje s r贸偶nie skonfigurowane).

Najlepszym sposobem, aby dowiedzie si, czy mo偶esz podszy si pod kogo w ka偶dej aplikacji, jest to wypr贸bowa!

## Unikanie wykrywania zachowa <a href="#id-9fde" id="id-9fde"></a>

Polityki wykrywania zachowa w Okta mog by nieznane do momentu napotkania, ale **ominicie** ich mo偶na osign, **celujc bezporednio w aplikacje Okta**, omijajc g贸wny pulpit Okta. Za pomoc **tokena dostpu Okta** odtw贸rz token na **adresie URL aplikacji Okta** zamiast na stronie logowania.

G贸wne zalecenia obejmuj:

* **Unikaj korzystania** z popularnych serwer贸w proxy i usug VPN anonimizujcych podczas odtwarzania przechwyconych token贸w dostpu.
* Upewnij si, 偶e **cigi agent贸w u偶ytkownika** s sp贸jne midzy klientem a odtwarzanymi tokenami dostpu.
* **Powstrzymaj si od odtwarzania** token贸w r贸偶nych u偶ytkownik贸w z tego samego adresu IP.
* Ostro偶nie odtwarzaj tokeny na pulpicie Okta.
* Jeli znasz adresy IP firmy ofiary, **ogranicz ruch** do tych adres贸w IP lub ich zakresu, blokujc cay inny ruch.

## Zabezpieczanie Okta

Okta ma wiele mo偶liwych konfiguracji, na tej stronie dowiesz si, jak je przeglda, aby byy jak najbardziej bezpieczne:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Odnoniki

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
