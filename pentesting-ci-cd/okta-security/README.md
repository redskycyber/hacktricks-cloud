# Okta Bezbednost

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJATELJE**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne Informacije

[Okta, Inc.](https://www.okta.com/) je prepoznata u sektoru identiteta i upravljanja pristupom zbog svojih softverskih re코enja zasnovanih na oblaku. Ova re코enja su dizajnirana da olak코aju i osiguraju autentifikaciju korisnika preko razli캜itih modernih aplikacija. Ona ne slu쬰 samo kompanijama koje 쬰le da za코tite svoje osetljive podatke, ve캖 i programerima zainteresovanim za integraciju kontrola identiteta u aplikacije, veb servise i ure캠aje.

Glavna ponuda od Okta-e je **Okta Identity Cloud**. Ova platforma obuhvata niz proizvoda, uklju캜uju캖i ali ne ograni캜avaju캖i se na:

* **Jednostruko Prijavljivanje (SSO)**: Pojednostavljuje pristup korisnika omogu캖avaju캖i jedan set prijavljiva캜kih podataka preko vi코e aplikacija.
* **Vi코estruka Autentifikacija (MFA)**: Pove캖ava sigurnost zahtevaju캖i vi코e oblika verifikacije.
* **Upravljanje 콯ivotnim Ciklusom**: Automatizuje procese kreiranja, a쬿riranja i deaktivacije korisni캜kih naloga.
* **Univerzalni Direktorijum**: Omogu캖ava centralizovano upravljanje korisnicima, grupama i ure캠ajima.
* **Upravljanje Pristupom API-ju**: Osigurava i upravlja pristupom API-ju.

Ovi servisi zajedno imaju za cilj da oja캜aju za코titu podataka i olak코aju pristup korisnika, unapre캠uju캖i i sigurnost i prakti캜nost. Raznovrsnost Okta-inih re코enja ih 캜ini popularnim izborom u razli캜itim industrijama, korisnim kako za velike preduze캖e, tako i za male kompanije i pojedina캜ne programere. Kako je poslednje a쬿riranje bilo u septembru 2021, Okta je priznata kao zna캜ajna entitet u oblasti Upravljanja Identitetom i Pristupom (IAM).

{% hint style="danger" %}
Glavni cilj Okta-e je konfiguracija pristupa razli캜itim korisnicima i grupama ka spoljnim aplikacijama. Ako uspete da **kompromitujete administratorske privilegije u Okta** okru쬰nju, vrlo je verovatno da 캖ete mo캖i da **kompromitujete sve ostale platforme koje kompanija koristi**.
{% endhint %}

{% hint style="success" %}
Da biste izvr코ili sigurnosni pregled Okta okru쬰nja, trebalo bi da zatra쬴te **administrator pristup samo za 캜itanje**.
{% endhint %}

### Sumarizacija

Postoje **korisnici** (koji mogu biti **skladi코teni u Okta-i**, prijavljeni iz konfigurisanih **Provajdera Identiteta** ili autentifikovani putem **Active Directory-a** ili LDAP-a).\
Ovi korisnici mogu biti unutar **grupa**.\
Postoje i **autentifikatori**: razli캜ite opcije za autentifikaciju kao 코to su lozinka, i nekoliko 2FA opcija poput WebAuthn, e-po코ta, telefon, okta verify (mogu biti omogu캖eni ili onemogu캖eni)...

Zatim, postoje **aplikacije** sinhronizovane sa Okta-om. Svaka aplikacija 캖e imati neko **mapiranje sa Okta-om** kako bi delila informacije (kao 코to su adrese e-po코te, imena...). Pored toga, svaka aplikacija mora biti unutar **Politike Autentifikacije**, koja pokazuje **potrebne autentifikatore** za korisnika da **pristupi** aplikaciji.

{% hint style="danger" %}
Najmo캖nija uloga je **Super Administrator**.

Ako napada캜 kompromituje Okta-u sa administratorskim pristupom, sve **aplikacije koje veruju Okta-i** 캖e vrlo verovatno biti **kompromitovane**.
{% endhint %}

## Napadi

### Lociranje Okta Portala

Obi캜no 캖e portal kompanije biti lociran na **nazivkompanije.okta.com**. Ako nije, poku코ajte jednostavne **varijacije** od **nazivakompanije**. Ako ga ne mo쬰te prona캖i, tako캠e je mogu캖e da organizacija ima **CNAME** zapis poput **`okta.nazivkompanije.com`** koji pokazuje ka **Okta portalu**.

### Prijavljivanje u Okta putem Kerberosa

Ako je **`nazivkompanije.kerberos.okta.com`** aktivan, **Kerberos se koristi za pristup Okta-i**, obi캜no zaobilaze캖i **MFA** za **Windows** korisnike. Da biste prona코li Kerberos-autentifikovane Okta korisnike u AD-u, pokrenite **`getST.py`** sa **odgovaraju캖im parametrima**. Nakon 코to dobijete **AD korisni캜ki tiket**, **ubacite** ga u kontrolisani host koriste캖i alate poput Rubeus-a ili Mimikatz-a, obezbe캠uju캖i da je **`imeklijenta.kerberos.okta.com` u "Intranet" zoni Internet opcija**. Pristupanje odre캠enom URL-u trebalo bi da vrati JSON odgovor "OK", 코to ukazuje na prihvatanje Kerberos tiketa, i omogu캖ava pristup Okta kontrolnoj tabli.

Kompromitovanje **Okta servisnog naloga sa SPN-om za delegaciju omogu캖ava napad Silver Ticket.** Me캠utim, Okta-ina upotreba **AES** za enkripciju tiketa zahteva posedovanje AES klju캜a ili plaintext lozinke. Koristite **`ticketer.py` da generi코ete tiket za korisnika rtve** i dostavite ga preko pregleda캜a radi autentifikacije sa Okta-om.

**Proverite napad na** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Preuzimanje Okta AD Agenta

Ova tehnika uklju캜uje **pristupanje Okta AD Agentu na serveru**, koji **sinhronizuje korisnike i upravlja autentifikacijom**. Prou캜avanjem i de코ifrovanjem konfiguracija u **`OktaAgentService.exe.config`**, posebno AgentToken kori코캖enjem **DPAPI**, napada캜 mo쬰 potencijalno **interceptovati i manipulisati podacima autentifikacije**. Ovo ne samo da omogu캖ava **pra캖enje** i **hvatanje korisni캜kih podataka** u plaintext-u tokom Okta autentifikacionog procesa, ve캖 i **odgovaranje na poku코aje autentifikacije**, 캜ime se omogu캖ava neovla코캖en pristup ili pru쬬nje univerzalne autentifikacije putem Okta-e (sli캜no 'skeleton key').

**Proverite napad na** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Preuzimanje AD-a Kao Administrator

Ova tehnika uklju캜uje preuzimanje Okta AD Agent-a prvo dobijanjem OAuth koda, a zatim zahtevanjem API tokena. Token je povezan sa AD domenom, a **konektor je nazvan da uspostavi la쬹og AD agenta**. Inicijalizacija omogu캖ava agentu da **obradi poku코aje autentifikacije**, hvataju캖i akreditive putem Okta API-ja. Alati za automatizaciju su dostupni kako bi olak코ali ovaj proces, nude캖i besprekoran na캜in za presretanje i rukovanje podacima autentifikacije unutar Okta okru쬰nja.

**Proverite napad na** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Okta La쬹i SAML Provajder

**Proverite napad na** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

Tehnika uklju캜uje **implementaciju la쬹og SAML provajdera**. Integrisanjem spoljnog Provajdera Identiteta (IdP) unutar Okta-ine strukture koriste캖i privilegovani nalog, napada캜i mogu **kontrolisati IdP, odobravaju캖i bilo koji zahtev za autentifikaciju po volji**. Proces podrazumeva postavljanje SAML 2.0 IdP u Okta-i, manipulisanje IdP Single Sign-On URL-a za preusmeravanje putem lokalne hosts datoteke, generisanje samopotpisanog sertifikata i konfigurisanje Okta pode코avanja da se podudaraju sa korisni캜kim imenom ili e-po코tom. Uspe코no izvr코avanje ovih koraka omogu캖ava autentifikaciju kao bilo koji Okta korisnik, zaobilaze캖i potrebu za individualnim korisni캜kim akreditivima, zna캜ajno unapre캠uju캖i kontrolu pristupa na potencijalno neprime캖en na캜in.
### Ribarenje Okta portala pomo캖u Evilgnix-a

U [**ovom blog postu**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) je obja코njeno kako pripremiti kampanju ribarenja protiv Okta portala.

### Napad na impersonaciju kolege

**Atributi koje svaki korisnik mo쬰 imati i menjati** (poput emaila ili imena) mogu se konfigurisati u Okta. Ako **aplikacija** kao ID **poverava** neki **atribut** koji korisnik mo쬰 **menjati**, on 캖e mo캖i **impersonirati druge korisnike na toj platformi**.

Stoga, ako aplikacija poverava polje **`userName`**, verovatno ne캖ete mo캖i da ga promenite (jer obi캜no ne mo쬰te promeniti to polje), ali ako poverava na primer **`primaryEmail`** mo쬯a 캖ete mo캖i da **ga promenite u email adresu kolege** i impersonirati je (morate imati pristup emailu i prihvatiti promenu).

Imajte na umu da ova impersonacija zavisi od toga kako je svaka aplikacija konfigurisana. Samo one koje poveravaju polje koje ste promenili i prihvataju a쬿riranja bi캖e kompromitovane.\
Stoga, aplikacija treba da ima ovo polje omogu캖eno ako postoji:

<figure><img src="../../.gitbook/assets/image (175).png" alt=""><figcaption></figcaption></figure>

Video sam i druge aplikacije koje su bile ranjive, ali nisu imale to polje u Okta pode코avanjima (na kraju razli캜ite aplikacije su konfigurisane na razli캜ite na캜ine).

Najbolji na캜in da saznate da li mo쬰te impersonirati bilo koga na svakoj aplikaciji je da to probate!

## Izbe캖i politike otkrivanja pona코anja <a href="#id-9fde" id="id-9fde"></a>

Politike otkrivanja pona코anja u Okta mogu biti nepoznate dok se ne susretnete s njima, ali ih je mogu캖e **zaobi캖i** ciljaju캖i Okta aplikacije direktno, izbegavaju캖i glavnu Okta kontrolnu tablu. Sa **Okta pristupnim tokenom**, ponovite token na **URL-u specifi캜nom za aplikaciju Okta** umesto na glavnoj stranici za prijavu.

Klju캜ne preporuke uklju캜uju:

* **Izbegavajte kori코캖enje** popularnih anonimizatora i VPN usluga prilikom ponovnog reprodukovanja uhva캖enih pristupnih tokena.
* Osigurajte **konzistentne korisni캜ke agente** izme캠u klijenta i ponovljenih pristupnih tokena.
* **Suzdr쬴te se od ponovnog reprodukovanja** tokena razli캜itih korisnika sa iste IP adrese.
* Budite oprezni prilikom ponovnog reprodukovanja tokena na Okta kontrolnoj tabli.
* Ako znate IP adrese kompanije rtve, **ograni캜ite saobra캖aj** na te IP adrese ili njihov opseg, blokiraju캖i sav ostali saobra캖aj.

## Ja캜anje Okta sistema

Okta ima mnogo mogu캖ih konfiguracija, na ovoj stranici 캖ete prona캖i kako da ih pregledate kako bi bile 코to sigurnije mogu캖e:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Reference

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
