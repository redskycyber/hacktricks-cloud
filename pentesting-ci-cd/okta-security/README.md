# Okta GÃ¼venliÄŸi

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonu
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± takip edin.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## Temel Bilgiler

[Okta, Inc.](https://www.okta.com/), bulut tabanlÄ± yazÄ±lÄ±m Ã§Ã¶zÃ¼mleriyle kimlik ve eriÅŸim yÃ¶netimi sektÃ¶rÃ¼nde tanÄ±nmaktadÄ±r. Bu Ã§Ã¶zÃ¼mler, Ã§eÅŸitli modern uygulamalar arasÄ±nda kullanÄ±cÄ± kimlik doÄŸrulamasÄ±nÄ± kolaylaÅŸtÄ±rmak ve gÃ¼vence altÄ±na almak iÃ§in tasarlanmÄ±ÅŸtÄ±r. Sadece hassas verilerini korumak isteyen ÅŸirketlere deÄŸil, aynÄ± zamanda kimlik kontrollerini uygulamalara, web hizmetlerine ve cihazlara entegre etmek isteyen geliÅŸtiricilere de hizmet vermektedir.

Okta'nÄ±n bayrak gemisi Ã¼rÃ¼nÃ¼ **Okta Identity Cloud**'tur. Bu platform, tek oturum aÃ§ma (SSO), Ã§ok faktÃ¶rlÃ¼ kimlik doÄŸrulama (MFA), yaÅŸam dÃ¶ngÃ¼sÃ¼ yÃ¶netimi, evrensel dizin ve API eriÅŸim yÃ¶netimi gibi Ã¼rÃ¼nleri iÃ§eren bir paketi kapsar.

Bu hizmetler, veri korumasÄ±nÄ± gÃ¼Ã§lendirmek ve kullanÄ±cÄ± eriÅŸimini kolaylaÅŸtÄ±rmak iÃ§in bir araya gelerek hem gÃ¼venliÄŸi hem de kullanÄ±m kolaylÄ±ÄŸÄ±nÄ± artÄ±rÄ±r. Okta'nÄ±n Ã§Ã¶zÃ¼mlerinin Ã§ok yÃ¶nlÃ¼lÃ¼ÄŸÃ¼, bÃ¼yÃ¼k iÅŸletmelerden kÃ¼Ã§Ã¼k ÅŸirketlere ve bireysel geliÅŸtiricilere kadar Ã§eÅŸitli endÃ¼strilerde popÃ¼ler bir tercih olmasÄ±nÄ± saÄŸlar. Son gÃ¼ncelleme olan EylÃ¼l 2021 tarihine kadar Okta, Kimlik ve EriÅŸim YÃ¶netimi (IAM) alanÄ±nda Ã¶nde gelen bir kuruluÅŸ olarak kabul edilmektedir.

{% hint style="danger" %}
Okta'nÄ±n ana hedefi, farklÄ± kullanÄ±cÄ±lara ve gruplara harici uygulamalara eriÅŸimi yapÄ±landÄ±rmaktÄ±r. Bir Okta ortamÄ±nda **yÃ¶netici ayrÄ±calÄ±klarÄ±nÄ±** ele geÃ§irmeyi baÅŸarÄ±rsanÄ±z, ÅŸirketin kullandÄ±ÄŸÄ± **diÄŸer tÃ¼m platformlarÄ± bÃ¼yÃ¼k olasÄ±lÄ±kla ele geÃ§irebilirsiniz**.
{% endhint %}

{% hint style="success" %}
Bir Okta ortamÄ±nÄ±n gÃ¼venlik incelemesini yapmak iÃ§in **yÃ¶netici salt okunur eriÅŸimini** istemelisiniz.
{% endhint %}

### Ã–zet

**KullanÄ±cÄ±lar** vardÄ±r (Okta'da **saklanabilir**, yapÄ±landÄ±rÄ±lmÄ±ÅŸ **Kimlik SaÄŸlayÄ±cÄ±lardan** oturum aÃ§abilir veya **Active Directory** veya LDAP ile kimlik doÄŸrulayabilir).\
Bu kullanÄ±cÄ±lar **gruplarÄ±n iÃ§inde** olabilir.\
AyrÄ±ca **kimlik doÄŸrulayÄ±cÄ±lar** vardÄ±r: ÅŸifre gibi kimlik doÄŸrulamak iÃ§in farklÄ± seÃ§enekler ve WebAuthn, e-posta, telefon, okta doÄŸrulama gibi Ã§eÅŸitli 2FA seÃ§enekleri (etkinleÅŸtirilmiÅŸ veya devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸ olabilir)...

Daha sonra, Okta ile senkronize edilen **uygulamalar** vardÄ±r. Her uygulamanÄ±n Okta ile bazÄ± bilgileri paylaÅŸmak iÃ§in bir **eÅŸleme** olacaktÄ±r (e-posta adresleri, adlar gibi). DahasÄ±, her uygulama bir **Kimlik DoÄŸrulama PolitikasÄ±** iÃ§inde olmalÄ±dÄ±r, bu da bir kullanÄ±cÄ±nÄ±n uygulamaya **eriÅŸmek iÃ§in gereken kimlik doÄŸrulayÄ±cÄ±larÄ±** belirtir.

{% hint style="danger" %}
En gÃ¼Ã§lÃ¼ rol **SÃ¼per YÃ¶netici** rolÃ¼dÃ¼r.

Bir saldÄ±rgan Okta'yÄ± YÃ¶netici eriÅŸimiyle ele geÃ§irirse, Okta'ya gÃ¼venen **tÃ¼m uygulamalar bÃ¼yÃ¼k olasÄ±lÄ±kla tehlikeye girecektir**.
{% endhint %}

## SaldÄ±rÄ±lar

### Okta PortalÄ±nÄ± Bulma

Genellikle bir ÅŸirketin portalÄ± **companyname.okta.com** adresinde bulunur. BulamazsanÄ±z, **companyname**'in basit **varyasyonlarÄ±nÄ±** deneyin. BulamazsanÄ±z, organizasyonun **Okta portalÄ±na iÅŸaret eden** **`okta.companyname.com`** gibi bir **CNAME** kaydÄ± olmasÄ± da mÃ¼mkÃ¼ndÃ¼r.

### Kerberos AracÄ±lÄ±ÄŸÄ±yla Okta'ya GiriÅŸ

**`companyname.kerberos.okta.com`** aktifse, Okta eriÅŸimi iÃ§in **Kerberos kullanÄ±lÄ±r** ve genellikle **Windows** kullanÄ±cÄ±larÄ± iÃ§in **MFA**'yÄ± atlar. AD'de Kerberos kimlik doÄŸrulamasÄ± yapÄ±lan Okta kullanÄ±cÄ±larÄ±nÄ± bulmak iÃ§in uygun parametrelerle **`getST.py`** Ã§alÄ±ÅŸtÄ±rÄ±n. Bir **AD kullanÄ±cÄ± bileti** elde ettikten sonra, Rubeus veya Mimikatz gibi araÃ§lar kullanarak kontrol edilen bir ana bilgisayara enjekte edin ve **`clientname.kerberos.okta.com`'Ä±n Internet Options "Intranet" bÃ¶lgesinde olduÄŸundan** emin olun. Belirli bir URL'ye eriÅŸmek, Kerberos biletinin kabul edildiÄŸini gÃ¶steren bir JSON "OK" yanÄ±tÄ± dÃ¶ndÃ¼rmelidir ve Okta panosuna eriÅŸim saÄŸlamalÄ±dÄ±r.

Okta hizmet hesabÄ±nÄ±n **delege SPN ile ele geÃ§irilmesi GÃ¼mÃ¼ÅŸ Bilet saldÄ±rÄ±sÄ±nÄ± mÃ¼mkÃ¼n kÄ±lar**. Bununla birlikte, Okta'nÄ±n bilet ÅŸifrelemesi iÃ§in AES kullanmasÄ±, AES anahtarÄ±na veya dÃ¼z metin parolasÄ±na sahip olmayÄ± gerektirir. **`ticketer.py`** kullanarak kurban kullanÄ±cÄ± iÃ§in bir bilet oluÅŸturun ve bunu tarayÄ±cÄ± aracÄ±lÄ±ÄŸÄ±yla Okta ile kimlik doÄŸrulamak iÃ§in iletebilirsiniz.

**SaldÄ±rÄ±yÄ± [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers) adresinde kontrol edin.**

### Okta AD AracÄ±sÄ±nÄ± Ele GeÃ§irme

Bu teknik, kullanÄ±cÄ±larÄ± senkronize eden ve kimlik doÄŸrulamayÄ± yÃ¶neten Okta AD AracÄ±sÄ±na eriÅŸmeyi iÃ§erir. **`OktaAgentService.exe.config`** dosyasÄ±ndaki yapÄ±landÄ±rmalarÄ± (Ã¶zellikle DPAPI kullanarak AgentToken'Ä±) inceleyerek ve ÅŸifresini Ã§Ã¶zerek, saldÄ±rgan potansiyel olarak kimlik doÄŸrulama verilerini **izleyebilir** ve **ele geÃ§irebilir**. Bu, Okta kimlik doÄŸrulama sÃ¼reci sÄ±rasÄ±nda kullanÄ±cÄ± kimlik bilgilerini dÃ¼z metin olarak yakalamayÄ± saÄŸlamanÄ±n yanÄ± sÄ±ra, kimlik doÄŸrulama giriÅŸimlerine yanÄ±t vererek yetkisiz eriÅŸim saÄŸlama veya Okta Ã¼zerinden evrensel kimlik doÄŸrulama saÄŸlama (bir 'iskelet anahtarÄ±' gibi) imkanÄ± saÄŸlar.

**SaldÄ±rÄ±yÄ± [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers) adresinde kontrol edin.**

### YÃ¶netici Olarak AD'yi Ele GeÃ§irme

Bu teknik, Ã¶nce bir OAuth
### Evilgnix ile Okta PortalÄ±na Phishing SaldÄ±rÄ±sÄ±

[**Bu blog yazÄ±sÄ±nda**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23), bir Okta portalÄ±na karÅŸÄ± bir phishing kampanyasÄ± nasÄ±l hazÄ±rlanacaÄŸÄ± aÃ§Ä±klanmaktadÄ±r.

### Ä°ÅŸ ArkadaÅŸÄ± Taklit SaldÄ±rÄ±sÄ±

Okta'da her kullanÄ±cÄ±nÄ±n sahip olabileceÄŸi ve deÄŸiÅŸtirebileceÄŸi **Ã¶znitelikler** (Ã¶rneÄŸin e-posta veya ad) Okta'da yapÄ±landÄ±rÄ±labilir. Bir **uygulama**, kullanÄ±cÄ±nÄ±n **deÄŸiÅŸtirebileceÄŸi bir Ã¶zniteliÄŸi** ID olarak gÃ¼veniyorsa, o platformda **diÄŸer kullanÄ±cÄ±larÄ± taklit edebilecektir**.

Bu nedenle, uygulama **`userName`** alanÄ±na gÃ¼veniyorsa, muhtemelen bunu deÄŸiÅŸtiremeyeceksiniz (genellikle bu alanÄ± deÄŸiÅŸtiremezsiniz), ancak Ã¶rneÄŸin **`primaryEmail`** alanÄ±na gÃ¼veniyorsa, bunu bir iÅŸ arkadaÅŸÄ±nÄ±n e-posta adresine deÄŸiÅŸtirebilir ve onu taklit edebilirsiniz (e-postaya eriÅŸiminizin olmasÄ± ve deÄŸiÅŸikliÄŸi kabul etmeniz gerekecektir).

Bu taklit, her uygulamanÄ±n nasÄ±l yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±na baÄŸlÄ±dÄ±r. DeÄŸiÅŸtirdiÄŸiniz alana gÃ¼venen ve gÃ¼ncellemeleri kabul edenler yalnÄ±zca etkilenecektir.\
Bu nedenle, uygulama bu alanÄ± etkinleÅŸtirmiÅŸ olmalÄ±dÄ±r:

<figure><img src="../../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

AyrÄ±ca, Okta ayarlarÄ±nda bu alanÄ± bulunmayan ancak savunmasÄ±z olan diÄŸer uygulamalarÄ± da gÃ¶rdÃ¼m (sonuÃ§ta farklÄ± uygulamalar farklÄ± ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r).

Herhangi bir uygulamada herhangi bir kiÅŸiyi taklit edebilip edemeyeceÄŸinizi bulmanÄ±n en iyi yolu denemektir!

## DavranÄ±ÅŸsal AlgÄ±lama PolitikalarÄ±nÄ± Atlama <a href="#id-9fde" id="id-9fde"></a>

Okta'daki davranÄ±ÅŸsal algÄ±lama politikalarÄ± genellikle bilinmez, ancak bunlarÄ± **atlatmak**, ana Okta panosundan kaÃ§Ä±narak Okta uygulamalarÄ±na doÄŸrudan hedeflenerek gerÃ§ekleÅŸtirilebilir. Bir **Okta eriÅŸim belirteci** ile, belirteci ana giriÅŸ sayfasÄ± yerine **uygulama Ã¶zel Okta URL'sinde** yeniden oynatÄ±n.

Ana Ã¶neriler ÅŸunlarÄ± iÃ§erir:

* Yakalanan eriÅŸim belirteÃ§lerini yeniden oynatÄ±rken popÃ¼ler anonimleÅŸtirici proxy'ler ve VPN hizmetlerinden **kaÃ§Ä±nÄ±n**.
* Ä°stemci ve yeniden oynatÄ±lan eriÅŸim belirteÃ§leri arasÄ±nda **uyumlu kullanÄ±cÄ± ajanÄ± dizelerini** saÄŸlayÄ±n.
* AynÄ± IP adresinden farklÄ± kullanÄ±cÄ±lara ait belirteÃ§leri yeniden oynatmaktan **kaÃ§Ä±nÄ±n**.
* Okta panosuna karÅŸÄ± belirteÃ§leri yeniden oynatÄ±rken dikkatli olun.
* Kurban ÅŸirketin IP adreslerini biliyorsanÄ±z, tÃ¼m diÄŸer trafiÄŸi engelleyerek trafiÄŸi yalnÄ±zca bu IP adreslerine veya bunlarÄ±n aralÄ±ÄŸÄ±na **kÄ±sÄ±tlayÄ±n**.

## Okta SÄ±kÄ±laÅŸtÄ±rma

Okta'nÄ±n birÃ§ok yapÄ±landÄ±rma seÃ§eneÄŸi vardÄ±r, bu sayfada bunlarÄ± mÃ¼mkÃ¼n olduÄŸunca gÃ¼venli hale getirmek iÃ§in nasÄ±l gÃ¶zden geÃ§ireceÄŸinizi bulacaksÄ±nÄ±z:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Referanslar

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **tanÄ±tmak** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da** takip edin.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
