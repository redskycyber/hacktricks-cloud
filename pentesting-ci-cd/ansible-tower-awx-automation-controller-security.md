# Bezbednost Ansible Tower / AWX / Kontrolera automatizacije

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** me na **Twitteru** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

**Ansible Tower** ili njegova open-source verzija [**AWX**](https://github.com/ansible/awx) poznati su kao **Ansible-ov korisni캜ki interfejs, kontrolna tabla i REST API**. Sa **kontrolom pristupa zasnovanom na ulogama**, planiranjem poslova i grafi캜kim upravljanjem inventarom, mo쬰te upravljati svojom Ansible infrastrukturom putem modernog korisni캜kog interfejsa. REST API i interfejs komandne linije Tower-a olak코avaju njegovo integrisanje u trenutne alate i radne tokove.

**Kontroler automatizacije je novija** verzija Ansible Tower-a sa vi코e mogu캖nosti.

### Razlike

Prema [**ovome**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00), glavne razlike izme캠u Ansible Tower-a i AWX-a su podr코ka koju dobijaju i dodatne funkcije koje Ansible Tower ima, kao 코to su kontrola pristupa zasnovana na ulogama, podr코ka za prilago캠ene API-je i korisni캜ki definisani radni tokovi.

### Tehnolo코ki sklop

* **Veb interfejs**: Ovo je grafi캜ki interfejs gde korisnici mogu upravljati inventarima, akreditacijama, 코ablonima i poslovima. Dizajniran je da bude intuitivan i pru쬬 vizualizacije koje poma쬿 u razumevanju stanja i rezultata va코ih automatizacionih poslova.
* **REST API**: Sve 코to mo쬰te uraditi u veb interfejsu, mo쬰te uraditi i putem REST API-ja. To zna캜i da mo쬰te integrisati AWX/Tower sa drugim sistemima ili skriptovima koje obi캜no izvr코avate u interfejsu.
* **Baza podataka**: AWX/Tower koristi bazu podataka (obi캜no PostgreSQL) za 캜uvanje svoje konfiguracije, rezultata poslova i ostalih neophodnih operativnih podataka.
* **RabbitMQ**: Ovo je sistem poruka koji koristi AWX/Tower za komunikaciju izme캠u razli캜itih komponenti, posebno izme캠u veb servisa i izvr코ilaca zadataka.
* **Redis**: Redis slu쬴 kao ke코 i pozadina za red zadataka.

### Logi캜ki komponenti

* **Inventari**: Inventar je **kolekcija doma캖ina (ili 캜vorova)** protiv kojih se mogu **izvr코avati poslovi** (Ansible skripte). AWX/Tower vam omogu캖ava da defini코ete i grupi코ete svoje inventare i tako캠e podr쬬va dinami캜ke inventare koji mogu **dobavljati liste doma캖ina iz drugih sistema** poput AWS-a, Azure-a, itd.
* **Projekti**: Projekat je u osnovi **kolekcija Ansible skripti** preuzetih iz **sistema za kontrolu verzija** (kao 코to je Git) kako bi se povukle najnovije skripte kada je potrebno.
* **마bloni**: 마bloni poslova defini코u **kako 캖e odre캠ena skripta biti izvr코ena**, navode캖i **inventar**, **akreditacije** i druge **parametre** za posao.
* **Akreditacije**: AWX/Tower pru쬬 siguran na캜in za **upravljanje i 캜uvanje tajni, poput SSH klju캜eva, lozinki i API tokena**. Ove akreditacije mogu biti povezane sa 코ablonima poslova kako bi skripte imale neophodan pristup prilikom izvr코avanja.
* **Zadatak ma코ina**: Ovde se de코ava magija. Zadatak ma코ina je zasnovan na Ansible-u i odgovoran je za **izvr코avanje skripti**. Poslovi se prosle캠uju zadatnoj ma코ini, koja zatim izvr코ava Ansible skripte protiv odre캠enih inventara koriste캖i navedene akreditacije.
* **Planeri i povratni pozivi**: Ovo su napredne funkcije u AWX/Tower-u koje omogu캖avaju **planiranje poslova** da se izvr코e u odre캠eno vreme ili da se pokrenu spolja코njim doga캠ajima.
* **Obave코tenja**: AWX/Tower mo쬰 slati obave코tenja na osnovu uspeha ili neuspeha poslova. Podr쬬va razli캜ite na캜ine obave코tavanja poput emailova, Slack poruka, webhooks, itd.
* **Ansible Skripte**: Ansible skripte su alati za konfigurisanje, implementaciju i orkestraciju. One opisuju 쬰ljeno stanje sistema na automatizovan, ponovljiv na캜in. Napisane u YAML-u, skripte koriste Ansible-ov deklarativni jezik automatizacije da opi코u konfiguracije, zadatke i korake koji treba da budu izvr코eni.

### Tok izvr코avanja posla

1. **Interakcija korisnika**: Korisnik mo쬰 da interaguje sa AWX/Tower-om ili putem **Veb interfejsa** ili putem **REST API-ja**. Ovi pru쬬ju pristup svim funkcionalnostima koje nudi AWX/Tower.
2. **Inicijacija posla**:
* Korisnik, putem Veb interfejsa ili API-ja, inicira posao na osnovu **마blona posla**.
* 마blon posla uklju캜uje reference na **Inventar**, **Projekat** (koji sadr쬴 skriptu) i **Akreditacije**.
* Po inicijaciji posla, zahtev se 코alje AWX/Tower backend-u da stavi posao u red za izvr코avanje.
3. **Stavljanje posla u red**:
* **RabbitMQ** upravlja porukama izme캠u veb komponente i izvr코ilaca zadataka. Kada se posao inicira, poruka se prosle캠uje zadatnoj ma코ini kori코캖enjem RabbitMQ-a.
* **Redis** deluje kao pozadina za red zadataka, upravljaju캖i poslovima u redu koji 캜ekaju izvr코avanje.
4. **Izvr코avanje posla**:
* **Zadatak ma코ina** preuzima posao iz reda. On dobavlja neophodne informacije iz **Baze podataka** o povezanoj skripti posla, inventaru i akreditacijama.
* Koriste캖i dobijenu Ansible skriptu iz povezanog **Projekta**, Zadatak ma코ina izvr코ava skriptu protiv odre캠enih **Inventara** 캜vorova koriste캖i navedene **Akreditacije**.
* Dok se skripta izvr코ava, njen izlaz izvr코avanja (logovi, 캜injenice, itd.) se bele쬰 i 캜uvaju u **Bazi podataka**.
5. **Rezultati posla**:
* Kada se skripta zavr코i sa izvr코avanjem, rezultati (uspeh, neuspeh, logovi) se 캜uvaju u **Bazi podataka**.
* Korisnici mogu zatim pregledati rezultate putem Veb interfejsa ili ih upitati putem REST API-ja.
* Na osnovu ishoda posla, **Obave코tenja** se mogu slati da obaveste korisnike ili spoljne sisteme o statusu posla. Obave코tenja mogu biti emailovi, Slack poruke, webhooks, itd.
6. **Integracija sa spoljnim sistemima**:
* **Inventari** mogu biti dinami캜ki dobijeni iz spoljnih sistema, omogu캖avaju캖i AWX/Tower-u da povu캜e doma캖ine iz izvora poput AWS-a, Azure-a, VMware-a i drugih.
* **Projekti** (skripte) mogu biti preuzeti iz sistema za kontrolu verzija, obezbe캠uju캖i kori코캖enje a쬿riranih skripti tokom izvr코avanja poslova.
* **Planeri i povratni pozivi** mogu se koristiti za integraciju sa drugim sistemima ili alatima, 캜ine캖i AWX/Tower reaktivnim na spoljne okida캜e ili pokretanje poslova u unapred odre캠eno vreme.

### Kreiranje AWX laboratorije za testiranje

[**Prate캖i dokumentaciju**](https://github.com/ansible/awx/blob/devel/tools/docker-compose/README.md) mogu캖e je koristiti docker-compose za pokretanje AWX-a:

{% code overflow="wrap" %}
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### Podr쬬ne uloge

Najprivilegovanija uloga se zove **Sistem Administrator**. Svi sa ovom ulogom mogu **modifikovati bilo 코ta**.

Iz **bele kutije bezbednosti**, potrebna vam je uloga **Sistem Auditora**, koja omogu캖ava da se **pregledaju svi sistemske podaci** ali ne mo쬰 vr코iti nikakve promene. Druga opcija bi bila da se dobije uloga **Organizacije Auditora**, ali bilo bi bolje dobiti prvu.

<details>

<summary>Pro코irite ovo da biste dobili detaljan opis dostupnih uloga</summary>

1. **Sistem Administrator**:
* Ovo je superkorisni캜ka uloga sa dozvolama za pristup i modifikaciju bilo kog resursa u sistemu.
* Mogu upravljati svim organizacijama, timovima, projektima, inventarima, 코ablonima poslova, itd.
2. **Sistem Auditor**:
* Korisnici sa ovom ulogom mogu pregledati sve sistemske podatke ali ne mogu vr코iti nikakve promene.
* Ova uloga je dizajnirana za uskla캠enost i nadzor.
3. **Uloge Organizacije**:
* **Admin**: Potpuna kontrola nad resursima organizacije.
* **Auditor**: Samo pregled pristup resursima organizacije.
* **캛lan**: Osnovno 캜lanstvo u organizaciji bez specifi캜nih dozvola.
* **Izvr코i**: Mo쬰 pokrenuti 코ablone poslova unutar organizacije.
* **캛itaj**: Mo쬰 pregledati resurse organizacije.
4. **Uloge Projekta**:
* **Admin**: Mo쬰 upravljati i modifikovati projekat.
* **Koristi**: Mo쬰 koristiti projekat u 코ablonu posla.
* **A쬿riraj**: Mo쬰 a쬿rirati projekat kori코캖enjem SCM (kontrole izvora).
5. **Uloge Inventara**:
* **Admin**: Mo쬰 upravljati i modifikovati inventar.
* **Ad Hoc**: Mo쬰 pokrenuti ad hoc komande na inventaru.
* **A쬿riraj**: Mo쬰 a쬿rirati izvor inventara.
* **Koristi**: Mo쬰 koristiti inventar u 코ablonu posla.
* **캛itaj**: Samo pregled pristupa.
6. **Uloge 마blona Posla**:
* **Admin**: Mo쬰 upravljati i modifikovati 코ablon posla.
* **Izvr코i**: Mo쬰 pokrenuti posao.
* **캛itaj**: Samo pregled pristupa.
7. **Uloge Kredencijala**:
* **Admin**: Mo쬰 upravljati i modifikovati kredencijale.
* **Koristi**: Mo쬰 koristiti kredencijale u 코ablonima poslova ili drugim relevantnim resursima.
* **캛itaj**: Samo pregled pristupa.
8. **Uloge Tima**:
* **캛lan**: Deo tima ali bez specifi캜nih dozvola.
* **Admin**: Mo쬰 upravljati 캜lanovima tima i povezanim resursima.
9. **Uloge Radnog Tijeka**:
* **Admin**: Mo쬰 upravljati i modifikovati radni tijek.
* **Izvr코i**: Mo쬰 pokrenuti radni tijek.
* **캛itaj**: Samo pregled pristupa.

</details>
