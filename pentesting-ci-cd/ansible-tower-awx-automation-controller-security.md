# Bezpieczestwo Ansible Tower / AWX / Automation Controller

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

**Ansible Tower** lub jego wersja open source [**AWX**](https://github.com/ansible/awx) jest r贸wnie偶 znany jako **interfejs u偶ytkownika, panel sterowania i REST API Ansible**. Dziki **kontroli dostpu opartej na rolach**, harmonogramowi zada i graficznemu zarzdzaniu inwentarzem, mo偶na zarzdza infrastruktur Ansible za pomoc nowoczesnego interfejsu u偶ytkownika. REST API i interfejs wiersza polece Tower umo偶liwiaj atwe zintegrowanie go z obecnymi narzdziami i procesami.

**Automation Controller to nowsza** wersja Ansible Tower z wikszymi mo偶liwociami.

### R贸偶nice

Wedug [**tego**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00), g贸wne r贸偶nice midzy Ansible Tower a AWS to otrzymywane wsparcie oraz dodatkowe funkcje Ansible Tower, takie jak kontrola dostpu oparta na rolach, obsuga niestandardowych interfejs贸w API i zdefiniowane przez u偶ytkownika przepywy pracy.

### Stos technologiczny

* **Interfejs sieciowy**: Jest to interfejs graficzny, w kt贸rym u偶ytkownicy mog zarzdza inwentarzami, powiadczeniami, szablonami i zadaniami. Zosta zaprojektowany tak, aby by intuicyjny i zapewnia wizualizacje, kt贸re pomagaj zrozumie stan i wyniki zada automatyzacji.
* **REST API**: Wszystko, co mo偶na zrobi w interfejsie sieciowym, mo偶na r贸wnie偶 zrobi za pomoc REST API. Oznacza to, 偶e mo偶na zintegrowa AWX/Tower z innymi systemami lub skryptowa dziaania, kt贸re zwykle wykonuje si w interfejsie.
* **Baza danych**: AWX/Tower korzysta z bazy danych (zwykle PostgreSQL) do przechowywania konfiguracji, wynik贸w zada i innych niezbdnych danych operacyjnych.
* **RabbitMQ**: Jest to system komunikacji u偶ywany przez AWX/Tower do komunikacji midzy r贸偶nymi komponentami, zwaszcza midzy usug sieciow a wykonawcami zada.
* **Redis**: Redis su偶y jako pami podrczna i backend dla kolejki zada.

### Skadniki logiczne

* **Inwentarze**: Inwentarz to **zbi贸r host贸w (lub wz贸w)**, na kt贸rych mo偶na **uruchamia zadania** (playbooki Ansible). AWX/Tower pozwala na definiowanie i grupowanie inwentarzy oraz obsuguje dynamiczne inwentarze, kt贸re mog **pobiera listy host贸w z innych system贸w**, takich jak AWS, Azure itp.
* **Projekty**: Projekt to w zasadzie **zbi贸r playbook贸w Ansible** pobieranych z **systemu kontroli wersji** (takiego jak Git), aby pobiera najnowsze playbooki w razie potrzeby.
* **Szablony**: Szablony zada definiuj, **jak bdzie uruchamiany okrelony playbook**, okrelajc **inwentarz**, **powiadczenia** i inne **parametry** dla zadania.
* **Powiadczenia**: AWX/Tower zapewnia bezpieczny spos贸b **zarzdzania i przechowywania sekret贸w, takich jak klucze SSH, hasa i tokeny API**. Te powiadczenia mog by powizane z szablonami zada, aby playbooks miay niezbdny dostp podczas ich uruchamiania.
* **Silnik zada**: To tutaj dzieje si magia. Silnik zada jest oparty na Ansible i jest odpowiedzialny za **uruchamianie playbook贸w**. Zadania s wysyane do silnika zada, kt贸ry nastpnie uruchamia playbooki Ansible na wyznaczonym inwentarzu, korzystajc z okrelonych powiadcze.
* **Planistyczki i wywoania zwrotne**: S to zaawansowane funkcje w AWX/Tower, kt贸re pozwalaj **planowa zadania** do uruchomienia o okrelonych godzinach lub wywoywane przez zewntrzne zdarzenia.
* **Powiadomienia**: AWX/Tower mo偶e wysya powiadomienia na podstawie sukcesu lub niepowodzenia zada. Obsuguje r贸偶ne sposoby powiadamiania, takie jak e-maile, wiadomoci Slack, webhooki itp.
* **Playbooki Ansible**: Playbooki Ansible to narzdzia konfiguracji, wdra偶ania i orkiestracji. Opisuj one po偶dany stan system贸w w spos贸b zautomatyzowany i powtarzalny. Napisane w formacie YAML, playbooki u偶ywaj deklaratywnego jzyka automatyzacji Ansible do opisania konfiguracji, zada i krok贸w, kt贸re nale偶y wykona.

### Przebieg wykonania zadania

1. **Interakcja u偶ytkownika**: U偶ytkownik mo偶e korzysta z AWX/Tower za pomoc **interfejsu sieciowego** lub **REST API**. Zapewniaj one dostp do wszystkich funkcji oferowanych przez AWX/Tower.
2. **Inicjowanie zadania**:
* U偶ytkownik za pomoc interfejsu sieciowego lub API inicjuje zadanie na podstawie **szablonu zadania**.
* Szablon zadania zawiera odwoania do **inwentarza**, **projektu** (zawierajcego playbook) i **powiadcze**.
* Po inicjacji zadania wysyane jest 偶danie do backendu AWX/Tower w celu umieszczenia zadania w kolejce do wykonania.
3. **Umieszczanie zadania w kolejce**:
* **RabbitMQ** obsuguje komunikacj midzy komponentem sieciowym a wykonawcami zada. Po zainicjowaniu zadania wysyana jest wiadomo do silnika zada za pomoc RabbitMQ.
* **Redis** dziaa jako backend dla kolejki zada, zarzdzajc zadaniami oczekujcymi na wykonanie.
4. **Wykonanie zadania**:
* **Silnik zada** pobiera zadanie z kolejki. Pobiera niezbdne informacje z **bazy danych** dotyczce powizanego playbooka, inwentarza i powiadcze.
* Korzystajc z pobranego playbooka Ansible z powizanego **projektu**, silnik zada uruchamia playbook na okrelonych wzach **inwentarza** przy u偶yciu podanych **powiadcze**.
* Podczas uruchamiania playbooka jego wynik wykonania (logi, fakty itp.) jest przechwytywany i przechowywany w **bazie danych**.
5. **Wyniki zadania**:
* Po zakoczeniu uruchamiania playbooka wyniki (sukces, niepowodzenie, logi) s zapisywane w **bazie danych**.
* U偶ytkownicy mog nastpnie przeglda wyniki za pomoc interfejsu sieciowego lub zapytywa o nie za pomoc REST API.
* Na podstawie wynik贸w zadania mog by wysyane **powiadomienia**, informuj
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### Obsugiwane role

Najbardziej uprzywilejowan rol jest **Administrator systemu**. Osoba posiadajca t rol mo偶e **modyfikowa wszystko**.

Podczas przegldu **bezpieczestwa biaej skrzynki** potrzebujesz roli **Audytora systemu**, kt贸ry pozwala na **wywietlanie wszystkich danych systemowych**, ale nie mo偶e dokonywa 偶adnych zmian. Inn opcj jest uzyskanie roli **Audytora organizacji**, ale lepiej jest uzyska t pierwsz.

<details>

<summary>Rozwi, aby uzyska szczeg贸owy opis dostpnych r贸l</summary>

1. **Administrator systemu**:
* Jest to rola superu偶ytkownika z uprawnieniami do dostpu i modyfikowania dowolnego zasobu w systemie.
* Mog zarzdza wszystkimi organizacjami, zespoami, projektami, inwentarzami, szablonami zada, itp.
2. **Audytor systemu**:
* U偶ytkownicy posiadajcy t rol mog wywietla wszystkie dane systemowe, ale nie mog dokonywa 偶adnych zmian.
* Rola ta jest przeznaczona do cel贸w zgodnoci i nadzoru.
3. **Role organizacji**:
* **Admin**: Pena kontrola nad zasobami organizacji.
* **Auditor**: Dostp tylko do odczytu do zasob贸w organizacji.
* **Member**: Podstawowe czonkostwo w organizacji bez okrelonych uprawnie.
* **Execute**: Mo偶e uruchamia szablony zada w ramach organizacji.
* **Read**: Mo偶e wywietla zasoby organizacji.
4. **Role projektu**:
* **Admin**: Mo偶e zarzdza i modyfikowa projekt.
* **Use**: Mo偶e u偶ywa projektu w szablonie zadania.
* **Update**: Mo偶e aktualizowa projekt za pomoc SCM (kontroli 藕r贸da).
5. **Role inwentarza**:
* **Admin**: Mo偶e zarzdza i modyfikowa inwentarz.
* **Ad Hoc**: Mo偶e uruchamia polecenia ad hoc na inwentarzu.
* **Update**: Mo偶e aktualizowa 藕r贸do inwentarza.
* **Use**: Mo偶e u偶ywa inwentarza w szablonie zadania.
* **Read**: Dostp tylko do odczytu.
6. **Role szablonu zadania**:
* **Admin**: Mo偶e zarzdza i modyfikowa szablon zadania.
* **Execute**: Mo偶e uruchamia zadanie.
* **Read**: Dostp tylko do odczytu.
7. **Role powiadcze**:
* **Admin**: Mo偶e zarzdza i modyfikowa powiadczenia.
* **Use**: Mo偶e u偶ywa powiadcze w szablonach zada lub innych powizanych zasobach.
* **Read**: Dostp tylko do odczytu.
8. **Role zespou**:
* **Member**: Cz zespou, ale bez okrelonych uprawnie.
* **Admin**: Mo偶e zarzdza czonkami zespou i powizanymi zasobami.
9. **Role przepywu pracy**:
* **Admin**: Mo偶e zarzdza i modyfikowa przepyw pracy.
* **Execute**: Mo偶e uruchamia przepyw pracy.
* **Read**: Dostp tylko do odczytu.

</details>

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
