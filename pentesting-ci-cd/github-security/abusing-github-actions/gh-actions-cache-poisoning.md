# GH Actions - Cache Poisoning

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Cache Poisoning

Utiliser l'action Git [**action/cache**](https://github.com/actions/cache) dans le CI ex√©cutera deux √©tapes : une √©tape aura lieu pendant le processus **run** lorsqu'elle est appel√©e et l'autre apr√®s le **workflow** (si l'action run a retourn√© un cache-miss).

* **Action run** ‚Äì est utilis√©e pour rechercher et r√©cup√©rer le cache. La recherche est effectu√©e en utilisant la cl√© de cache, avec comme r√©sultat soit un cache-hit (succ√®s, donn√©es trouv√©es dans le cache) soit un cache-miss. Si trouv√©, les fichiers et r√©pertoires sont r√©cup√©r√©s du cache pour une utilisation active. Si le r√©sultat est un cache-miss, les fichiers et r√©pertoires d√©sir√©s sont t√©l√©charg√©s comme s'il s'agissait de leur premier appel.
* **Action post workflow** ‚Äì utilis√©e pour sauvegarder le cache. Si le r√©sultat de l'appel de cache dans l'action run retourne un cache-miss, cette action sauvegardera l'√©tat actuel des r√©pertoires que nous voulons mettre en cache avec la cl√© fournie. Cette action se produit automatiquement et n'a pas besoin d'√™tre explicitement appel√©e.

Les **restrictions d'acc√®s** fournissent une **isolation du cache** et une s√©curit√© en cr√©ant une **fronti√®re logique entre diff√©rentes branches** _(par exemple : un cache cr√©√© pour la branche **Feature-A** \[avec la base principale] ne serait pas accessible √† une pull request pour la branche **Feature-B** \[avec la base principale])_.

L'action de cache recherche d'abord les hits de cache pour une cl√© et restaure les cl√©s dans la branche contenant le **workflow run**. S'il n'y a pas de hits dans la branche actuelle, l'action de cache recherche la cl√© et restaure les cl√©s dans la branche parente et les branches en amont.

L'acc√®s √† un cache est limit√© par branche (actuelle et parente), ce qui signifie que l'acc√®s est fourni √† tous les **workflows** √† travers les **runs** de ladite branche.

Un autre point important est que GitHub ne permet pas de modifications une fois que les entr√©es sont pouss√©es ‚Äì les entr√©es de cache sont des enregistrements en lecture seule.

Nous avons utilis√© un exemple de CI qui comprenait deux workflows. Cet exemple montre comment une attaque peut pivoter d'un workflow √† faibles permissions √† un workflow √† permissions √©lev√©es.

* **Workflow unit-test** ex√©cutant des tests unitaires et des outils de couverture de code. Nous supposons que l'un des outils est malveillant ou vuln√©rable √† l'ex√©cution de code √† distance. Le workflow n'a pas besoin d'utiliser l'action Git **action/cache**. N'importe quel workflow peut acc√©der au cache.
* **Workflow release** construit et publie l'artefact de l'application. Ce workflow utilise un cache pour optimiser l'utilisation des d√©pendances Golang.

Le workflow **unit-test** utilise une action malveillante qui ajoute une entr√©e de cache avec un contenu malveillant en changeant une biblioth√®que de journalisation Golang (**go.uber.org/zap@v1**) pour ajouter la cha√Æne, 'BAD library' √† la description de l'artefact de l'application.

Ensuite, le workflow **release** utilise cette entr√©e de cache empoisonn√©e. En cons√©quence, le code malveillant est inject√© dans le binaire Golang construit et l'image. Le cache reste empoisonn√© jusqu'√† ce que la cl√© d'entr√©e soit √©cart√©e (g√©n√©ralement d√©clench√©e par des mises √† jour de d√©pendances). Le m√™me cache empoisonn√© affectera tout autre **workflow**, **run**, et **branche enfant** utilisant la m√™me cl√© de cache.

Dans le test que nous avons effectu√©, nous avons r√©ussi √† injecter la cha√Æne 'BAD library' dans la description de l'image :

![BAD library](https://scribesecurity.com/wp-content/uploads/2022/02/BAD-library-2-300x79.jpg)

C'√©tait dans la version 0.4.1. Ensuite, nous avons mis √† jour le tag et reconstruit l'image plusieurs fois, et observ√© que 'Bad library' restait dans la description.

Cette technique a √©t√© prise de [https://scribesecurity.com/blog/github-cache-poisoning/](https://scribesecurity.com/blog/github-cache-poisoning/)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
