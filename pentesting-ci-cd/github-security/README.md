# Bezpieczestwo Githuba

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Czym jest Github

(Z [tutaj](https://kinsta.com/knowledgebase/what-is-github/)) Na wysokim poziomie, **GitHub to strona internetowa i usuga w chmurze, kt贸ra pomaga programistom przechowywa i zarzdza ich kodem, a tak偶e ledzi i kontrolowa zmiany w kodzie**.

### Podstawowe informacje

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Zewntrzne rozpoznanie

Repozytoria Githuba mog by skonfigurowane jako publiczne, prywatne i wewntrzne.

* **Prywatne** oznacza, 偶e bd do nich mie dostp tylko osoby z **organizacji**
* **Wewntrzne** oznacza, 偶e bd do nich mie dostp tylko osoby z **przedsibiorstwa** (przedsibiorstwo mo偶e mie kilka organizacji)
* **Publiczne** oznacza, 偶e bdzie do nich mie dostp **cay internet**.

Jeli znasz **u偶ytkownika, repozytorium lub organizacj**, kt贸r chcesz zaatakowa, mo偶esz u偶y **dork贸w Githuba**, aby znale藕 poufne informacje lub wyszuka **wycieki poufnych informacji w ka偶dym repozytorium**.

### Dorki Githuba

Github umo偶liwia **wyszukiwanie czego, okrelajc zakres u偶ytkownika, repozytorium lub organizacji**. Dlatego, majc list cig贸w, kt贸re bd wystpowa w pobli偶u poufnych informacji, mo偶na atwo **wyszukiwa potencjalne poufne informacje w celu ataku**.

Narzdzia (ka偶de narzdzie zawiera swoj list dork贸w):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Lista dork贸w](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Lista dork贸w](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Lista dork贸w](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Wycieki Githuba

Zauwa偶, 偶e dorki Githuba su偶 r贸wnie偶 do wyszukiwania wyciek贸w za pomoc opcji wyszukiwania Githuba. Ta sekcja jest powicona narzdziom, kt贸re **pobior ka偶de repozytorium i wyszukaj w nich poufne informacje** (nawet sprawdzajc okrelon gboko commit贸w).

Narzdzia (ka偶de narzdzie zawiera swoj list wyra偶e regularnych):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Podczas szukania wyciek贸w w repozytorium i uruchamiania czego takiego jak `git log -p`, nie zapomnij, 偶e mog istnie **inne gazie z innymi commitami**, kt贸re zawieraj poufne informacje!
{% endhint %}

### Zewntrzne forki

Mo偶liwe jest **skompromitowanie repozytori贸w, wykorzystujc 偶dania pull**. Aby dowiedzie si, czy repozytorium jest podatne, przede wszystkim nale偶y przeczyta konfiguracje yaml Github Actions. [**Wicej informacji na ten temat poni偶ej**](./#execution-from-a-external-fork).

## Utrudnianie organizacji

### Uprawnienia czonk贸w

Istniej pewne **domylne uprawnienia**, kt贸re mo偶na przypisa **czonkom** organizacji. Mo偶na nimi zarzdza ze strony `https://github.com/organizations/<org_name>/settings/member_privileges` lub za pomoc [**API organizacji**](https://docs.github.com/en/rest/orgs/orgs).

* **Podstawowe uprawnienia**: Czonkowie bd mie uprawnienia None/Read/write/Admin wobec repozytori贸w organizacji. Zalecane jest **None** lub **Read**.
* **Forkowanie repozytori贸w**: Jeli nie jest to konieczne, lepiej **nie zezwala** czonkom na forkowanie repozytori贸w organizacji.
* **Tworzenie stron**: Jeli nie jest to konieczne, lepiej **nie zezwala** czonkom na publikowanie stron z repozytori贸w organizacji. Jeli jest to konieczne, mo偶na zezwoli na tworzenie stron publicznych lub prywatnych.
* **Proby o dostp do integracji**: Po wczeniu tej opcji zewntrzni wsp贸pracownicy bd mogli 偶da dostpu do aplikacji GitHub lub OAuth do dostpu do tej organizacji i jej zasob贸w. Zazwyczaj jest to potrzebne, ale jeli nie, lepiej to wyczy.
* _Nie znalazem tych informacji w odpowiedziach API, podziel si, jeli je znajdziesz_
* **Zmiana widocznoci repozytorium**: Jeli ta opcja jest wczona, **czonkowie** z uprawnieniami **admin** dla **repozytorium** bd mogli **zmienia jego widoczno**. Jeli jest wyczona, tylko waciciele organizacji mog zmienia widoczno repozytori贸w. Jeli nie chcesz, aby ludzie udostpn
### Integracje

_Daj mi zna, jeli znasz punkt kocowy API, aby uzyska dostp do tych informacji!_

* **Polityka dostpu do aplikacji zewntrznych**: Zaleca si ograniczenie dostpu do ka偶dej aplikacji i zezwolenie tylko na te, kt贸re s potrzebne (po ich przegldzie).
* **Zainstalowane aplikacje GitHub**: Zaleca si zezwolenie tylko na te, kt贸re s potrzebne (po ich przegldzie).

## Rozpoznanie i ataki wykorzystujce powiadczenia

W tym scenariuszu za贸偶my, 偶e uzyskae dostp do konta GitHub.

### Z powiadczeniami u偶ytkownika

Jeli w jaki spos贸b masz ju偶 powiadczenia u偶ytkownika w organizacji, mo偶esz **po prostu si zalogowa** i sprawdzi, jakie **role przedsibiorstwa i organizacji posiadasz**, jeli jeste czonkiem, sprawdzi, jakie **uprawnienia maj czonkowie**, w jakich **grupach** si znajdujesz, jakie **uprawnienia masz** w stosunku do poszczeg贸lnych **repozytori贸w** i **jak s one chronione**.

Nale偶y zauwa偶y, 偶e mo偶e by u偶ywane **2FA**, wic bdziesz m贸g uzyska dostp do tych informacji tylko wtedy, gdy bdziesz w stanie **przej t weryfikacj**.

{% hint style="info" %}
Nale偶y zauwa偶y, 偶e jeli **uda ci si ukra ciasteczko `user_session`** (obecnie skonfigurowane z SameSite: Lax), mo偶esz **cakowicie podszywa si pod u偶ytkownika** bez koniecznoci posiadania powiadcze ani 2FA.
{% endhint %}

Sprawd藕 sekcj poni偶ej dotyczc [**omijania zabezpiecze gazi**](./#omijanie-zabezpiecze-gazi), jeli jest to przydatne.

### Z kluczem SSH u偶ytkownika

Github umo偶liwia **u偶ytkownikom** ustawienie **kluczy SSH**, kt贸re bd u偶ywane jako **metoda uwierzytelniania do wdra偶ania kodu** w ich imieniu (nie stosuje si 2FA).

Z tym kluczem mo偶esz dokonywa **zmian w repozytoriach, w kt贸rych u偶ytkownik ma pewne uprawnienia**, jednak nie mo偶esz go u偶y do uzyskania dostpu do interfejsu API GitHub w celu wyliczenia rodowiska. Mo偶esz jednak **wyliczy lokalne ustawienia**, aby uzyska informacje o repozytoriach i u偶ytkowniku, do kt贸rych masz dostp:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Jeli u偶ytkownik skonfigurowa swoj nazw u偶ytkownika jako swoj nazw u偶ytkownika na GitHub, mo偶na uzyska dostp do **kluczy publicznych**, kt贸re ustawi w swoim koncie na stronie _https://github.com/\<nazwa\_u偶ytkownika\_na\_GitHub>.keys_. Mo偶na to sprawdzi, aby potwierdzi, czy znaleziony klucz prywatny mo偶e by u偶ywany.

**Klucze SSH** mog r贸wnie偶 by ustawiane w repozytoriach jako **klucze do wdro偶e**. Ka偶da osoba majca dostp do tego klucza bdzie moga **uruchamia projekty z repozytorium**. Zazwyczaj na serwerze z r贸偶nymi kluczami do wdro偶e plik lokalny **`~/.ssh/config`** dostarczy informacji o powizanym kluczu.

#### Klucze GPG

Jak wyjaniono [**tutaj**](broken-reference/), czasami konieczne jest podpisywanie commit贸w, aby unikn wykrycia.

Sprawd藕 lokalnie, czy bie偶cy u偶ytkownik ma jakikolwiek klucz za pomoc polecenia:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Za pomoc Tokena U偶ytkownika

Aby uzyska wprowadzenie do [**Token贸w U偶ytkownika, sprawd藕 podstawowe informacje**](basic-github-information.md#personal-access-tokens).

Token u偶ytkownika mo偶e by u偶ywany **zamiast hasa** dla Git przez HTTPS lub mo偶e by u偶ywany do [**uwierzytelniania w API za pomoc podstawowego uwierzytelniania**](https://docs.github.com/v3/auth/#basic-authentication). W zale偶noci od przywilej贸w przypisanych do niego, mo偶esz wykonywa r贸偶ne czynnoci.

Token u偶ytkownika wyglda tak: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Za pomoc Aplikacji Oauth

Aby uzyska wprowadzenie do [**Aplikacji Oauth Github, sprawd藕 podstawowe informacje**](basic-github-information.md#oauth-applications).

Atakujcy mo偶e stworzy **zoliw aplikacj Oauth**, aby uzyska dostp do uprzywilejowanych danych/czynnoci u偶ytkownik贸w, kt贸rzy najprawdopodobniej akceptuj je jako cz kampanii phishingowej.

Oto [zakresy, kt贸re aplikacja Oauth mo偶e 偶da](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Zawsze nale偶y sprawdzi 偶dane zakresy przed ich akceptacj.

Ponadto, jak wyjaniono w podstawowych informacjach, **organizacje mog udziela/odmawia dostpu aplikacjom innych firm** do informacji/repozytori贸w/czynnoci zwizanych z organizacj.

### Za pomoc Aplikacji Github

Aby uzyska wprowadzenie do [**Aplikacji Github, sprawd藕 podstawowe informacje**](basic-github-information.md#github-applications).

Atakujcy mo偶e stworzy **zoliw aplikacj Github**, aby uzyska dostp do uprzywilejowanych danych/czynnoci u偶ytkownik贸w, kt贸rzy najprawdopodobniej akceptuj je jako cz kampanii phishingowej.

Ponadto, jak wyjaniono w podstawowych informacjach, **organizacje mog udziela/odmawia dostpu aplikacjom innych firm** do informacji/repozytori贸w/czynnoci zwizanych z organizacj.

## Kompromitacja i Nadu偶ycie Github Action

Istnieje kilka technik kompromitacji i nadu偶ywania Github Action, sprawd藕 je tutaj:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Ominicie Ochrony Gazi

* **Wymagaj okrelonej liczby zatwierdze**: Jeli skompromitujesz kilka kont, mo偶esz zaakceptowa swoje PR z innych kont. Jeli masz tylko dostp do konta, z kt贸rego utworzye PR, nie mo偶esz zaakceptowa swojego wasnego PR. Jednak jeli masz dostp do rodowiska **Github Action** wewntrz repozytorium, u偶ywajc **GITHUB\_TOKEN**, mo偶esz by w stanie **zaakceptowa sw贸j PR** i uzyska w ten spos贸b 1 zatwierdzenie.
* _Uwaga: zazwyczaj u偶ytkownik nie bdzie m贸g zatwierdzi swoich wasnych PR, ale jeli mo偶esz, mo偶esz to nadu偶y, aby zaakceptowa swoje PR._
* **Odrzu zatwierdzenia po wprowadzeniu nowych zmian**: Jeli to nie jest ustawione, mo偶esz przesa prawidowy kod, poczeka, a偶 kto go zatwierdzi, a nastpnie doda zoliwy kod i scali go z chronion gazi.
* **Wymagaj zatwierdze od wacicieli kodu**: Jeli jest to aktywowane i jeste wacicielem kodu, mo偶esz **za pomoc Github Action utworzy sw贸j PR, a nastpnie go zaakceptowa**.
* Gdy plik **CODEOWNER jest 藕le skonfigurowany**, Github nie zgasza bdu, ale go nie u偶ywa. Dlatego jeli jest 藕le skonfigurowany, **ochrona wacicieli kodu nie jest stosowana**.
* **Zezwalaj okrelonym podmiotom na ominicie wymaga dotyczcych 偶da cignicia**: Jeli jeste jednym z tych podmiot贸w, mo偶esz omin ochron 偶da cignicia.
* **Uwzgldnij administrator贸w**: Jeli to nie jest ustawione, a jeste administratorem repozytorium, mo偶esz omin ochron gazi.
* **Hijacking PR**: Mo偶esz by w stanie **zmodyfikowa PR innej osoby**, dodajc zoliwy kod, zatwierdzajc wynikowy PR samodzielnie i scalajc wszystko.
* **Usuwanie ochrony gazi**: Jeli jeste **administratorem repozytorium, mo偶esz wyczy ochron**, scali sw贸j PR i ponownie wczy ochron.
* **Ominicie ochrony push**: Jeli repozytorium **pozwala tylko okrelonym u偶ytkownikom** na wysyanie push (scalanie kodu) do gazi (ochrona gazi mo偶e chroni wszystkie gazie, okrelajc symbol wieloznaczny `*`).
* Jeli masz **uprawnienia do zapisu w repozytorium, ale nie mo偶esz wysya kodu** z powodu ochrony gazi, nadal mo偶esz **utworzy now ga藕** i w niej utworzy **github action, kt贸ry jest uruchamiany po wysaniu kodu**. Poniewa偶 **ochrona gazi nie chroni gazi do momentu jej utworzenia**, pierwsze wysanie kodu do gazi **uruchomi github action**.

## Ominicie Ochrony rodowisk

Aby uzyska wprowadzenie do [**rodowisk Github, sprawd藕 podstawowe informacje**](basic-github-information.md#git-environments).

W przypadku, gdy rodowisko mo偶e by **dostpne ze wszystkich gazi**, nie jest **chronione**, a atwo mo偶na uzyska dostp do tajemnic wewntrz rodowiska. Nale偶y jednak pamita, 偶e mo偶na znale藕 repozytoria, w kt贸rych **wszystkie gazie s chronione** (poprzez podanie ich nazw lub za pomoc `*`), w takim przypadku nale偶y **znale藕 ga藕, do kt贸rej mo偶na wysa kod** i mo偶na **wycieka** tajemnice, tworzc now akcj github (lub modyfikujc istniejc).

Nale偶y zauwa偶y, 偶e mo偶na napotka skrajny przypadek, w kt贸rym **wszystkie gazie s chronione** (za pomoc symbolu wieloznacznego `*`), okrelono **kto mo偶e wysya kod do gazi** (_mo偶na to okreli w ochronie gazi_) i **twoje konto nie jest dozwolone**. Nadal mo偶na uruchomi niestandardow akcj github, poniewa偶 mo偶na utworzy ga藕 i u偶y wyzwalacza push na tej samej gazi. **Ochrona gazi pozwala na wysanie do nowej gazi, wic zostanie uruchomiona akcja github**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Zauwa偶, 偶e **po utworzeniu** gazi **ochrona gazi zostanie zastosowana do nowej gazi** i nie bdziesz w stanie jej modyfikowa, ale w tym czasie ju偶 wykrade tajemnice.

## Wytrwao

* Wygeneruj **token u偶ytkownika**
* Ukradnij **tokeny Githuba** z **tajemnic**
* **Usunicie** wynik贸w **przepywu pracy** i **gazi**
* Przyznaj **wicej uprawnie wszystkim organizacjom**
* Utw贸rz **webhooki** do wycieku informacji
* Zaproszenie **zewntrznych wsp贸pracownik贸w**
* **Usu** **webhooki** u偶ywane przez **SIEM**
* Utw贸rz/zmodyfikuj **Akcj Githuba** z **tylnymi drzwiami**
* Znajd藕 **podatn Akcj Githuba na wstrzyknicie polece** poprzez modyfikacj wartoci **tajemnicy**

### Faszywe Commity - Tylna furtka poprzez commity repozytorium

W Githubie mo偶liwe jest **utworzenie PR do repozytorium z forka**. Nawet jeli PR nie zostanie **zaakceptowany**, zostanie utworzone id **commita** w oryginalnym repozytorium dla wersji kodu z forka. Dlatego atakujcy **m贸gby przypi u偶ycie okrelonego commita z pozornie legalnego repozytorium, kt贸re nie zostao utworzone przez waciciela repozytorium**.

Tak jak [**tutaj**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Aby uzyska wicej informacji, sprawd藕 [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
