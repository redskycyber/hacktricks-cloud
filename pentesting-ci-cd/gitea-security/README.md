# Seguridad de Gitea

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## 驴Qu茅 es Gitea?

**Gitea** es una soluci贸n de alojamiento de c贸digo **ligera, administrada por la comunidad y autohospedada** escrita en Go.

![](<../../.gitbook/assets/image (5) (1) (1) (1).png>)

### Informaci贸n b谩sica

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Laboratorio

Para ejecutar una instancia de Gitea localmente, simplemente puede ejecutar un contenedor de docker:

```bash
docker run -p 3000:3000 gitea/gitea
```

Con茅ctese al puerto 3000 para acceder a la p谩gina web.

Tambi茅n puede ejecutarlo con kubernetes:

```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```

## Enumeraci贸n sin autenticaci贸n

* Repositorios p煤blicos: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Usuarios registrados: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Organizaciones registradas: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Tenga en cuenta que por **defecto, Gitea permite que los nuevos usuarios se registren**. Esto no dar谩 acceso especialmente interesante a los nuevos usuarios sobre otros repositorios de organizaciones / usuarios, pero un **usuario conectado** podr铆a ser capaz de **visualizar m谩s repositorios u organizaciones**.

## Explotaci贸n interna

Para este escenario, vamos a suponer que ha obtenido alg煤n acceso a una cuenta de Github.

### Con credenciales de usuario / cookie web

Si de alguna manera ya tiene credenciales para un usuario dentro de una organizaci贸n (o rob贸 una cookie de sesi贸n), puede **iniciar sesi贸n** y verificar qu茅 **permisos tiene** sobre qu茅 **repositorios**, en **qu茅 equipos** est谩, **listar otros usuarios** y **c贸mo est谩n protegidos los repositorios**.

Tenga en cuenta que **se puede usar la autenticaci贸n de dos factores (2FA)**, por lo que solo podr谩 acceder a esta informaci贸n si tambi茅n puede **pasar esa verificaci贸n**.

{% hint style="info" %}
Tenga en cuenta que si **logra robar la cookie `i_like_gitea`** (actualmente configurada con SameSite: Lax), puede **suplantar completamente al usuario** sin necesidad de credenciales o 2FA.
{% endhint %}

### Con clave SSH de usuario

Gitea permite que los **usuarios** establezcan **claves SSH** que se utilizar谩n como **m茅todo de autenticaci贸n para implementar c贸digo** en su nombre (no se aplica 2FA).

Con esta clave, puede realizar **cambios en los repositorios donde el usuario tiene algunos privilegios**, sin embargo, no puede usarla para acceder a la API de gitea para enumerar el entorno. Sin embargo, puede **enumerar la configuraci贸n local** para obtener informaci贸n sobre los repositorios y el usuario al que tiene acceso:

```bash
# Ir a la carpeta del repositorio
# Obtener la configuraci贸n del repositorio y el nombre de usuario y correo electr贸nico actual
git config --list
```

Si el usuario ha configurado su nombre de usuario como su nombre de usuario de gitea, puede acceder a las **claves p煤blicas que ha establecido** en su cuenta en _https://github.com/\<gitea\_username>.keys_, podr铆a verificar esto para confirmar que la clave privada que encontr贸 se puede usar.

Las **claves SSH** tambi茅n se pueden establecer en los repositorios como **claves de implementaci贸n**. Cualquier persona con acceso a esta clave podr谩 **lanzar proyectos desde un repositorio**. Por lo general, en un servidor con diferentes claves de implementaci贸n, el archivo local **`~/.ssh/config`** le dar谩 informaci贸n sobre la clave relacionada.

#### Claves GPG

Como se explica [**aqu铆**](broken-reference/), a veces es necesario firmar los commits o puede ser descubierto.

Verifique localmente si el usuario actual tiene alguna clave con:

```shell
gpg --list-secret-keys --keyid-format=long
```

### Con token de usuario

Para una introducci贸n sobre [**Tokens de usuario, consulte la informaci贸n b谩sica**](basic-gitea-information.md#personal-access-tokens).

Se puede usar un token de usuario **en lugar de una contrase帽a** para **autenticarse** contra el servidor Gitea [**a trav茅s de la API**](https://try.gitea.io/api/swagger#/). tendr谩 **acceso completo** sobre el usuario.

### Con aplicaci贸n Oauth

Para una introducci贸n sobre [**Aplicaciones Oauth de Gitea, consulte la informaci贸n b谩sica**](./#with-oauth-application).

Un atacante podr铆a crear una **aplicaci贸n Oauth maliciosa** para acceder a datos / acciones privilegiados de los usuarios que los acepten probablemente como parte de una campa帽a de phishing.

Como se explica en la informaci贸n b谩sica, la aplicaci贸n tendr谩 **acceso completo a la cuenta de usuario**.

### Bypass de protecci贸n de rama

En Github tenemos **acciones de Github** que por defecto obtienen un **token con acceso de escritura** sobre el repositorio que se puede usar para **bypass de protecciones de rama**. En este caso, eso **no existe**, por lo que los bypasses son m谩s limitados. Pero echemos un vistazo a lo que se puede hacer:

* **Habilitar Push**: Si alguien con acceso de escritura puede hacer push a la rama, simplemente haga push a ella.
* **Lista blanca de empuje restringida**: De la misma manera, si eres parte de esta lista, haz push a la rama.
* **Habilitar lista blanca de combinaci贸n**: Si hay una lista blanca de combin