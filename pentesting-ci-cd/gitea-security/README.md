# Gitea bezbednost

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini da podrÅ¾ite HackTricks:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Å ta je Gitea

**Gitea** je **samohostovano reÅ¡enje za upravljanje lakim kodom zajednice** napisano u Go-u.

![](<../../.gitbook/assets/image (5) (1) (1) (1) (1) (1).png>)

### Osnovne informacije

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Laboratorija

Da biste pokrenuli lokalnu instancu Gitea, jednostavno pokrenite docker kontejner:
```bash
docker run -p 3000:3000 gitea/gitea
```
PoveÅ¾ite se na port 3000 da biste pristupili web stranici.

TakoÄ‘e ga moÅ¾ete pokrenuti sa Kubernetes-om:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Neautentifikovano nabrojavanje

* Javni repozitorijumi: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Registrovani korisnici: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Registrovane organizacije: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Imajte na umu da **podrazumevano Gitea dozvoljava novim korisnicima da se registruju**. Ovo neÄ‡e dati poseban pristup novim korisnicima nad repozitorijumima drugih organizacija/korisnika, ali **prijavljeni korisnik** moÅ¾e moÄ‡i da **vizualizuje viÅ¡e repozitorijuma ili organizacija**.

## Interna eksploatacija

Za ovaj scenario pretpostavljamo da ste dobili pristup nekom github nalogu.

### Sa korisniÄkim podacima/Veb kolaÄiÄ‡em

Ako veÄ‡ imate pristupnim podacima za korisnika unutar organizacije (ili ste ukrali sesioni kolaÄiÄ‡), moÅ¾ete se **samo prijaviti** i proveriti koje **dozvole imate** nad kojim **repozitorijumima**, u **kojim timovima** se nalazite, **nabrojati druge korisnike**, i **kako su repozitorijumi zaÅ¡tiÄ‡eni**.

Imajte na umu da se moÅ¾e koristiti **2FA**, pa Ä‡ete moÄ‡i pristupiti ovim informacijama samo ako moÅ¾ete **proÄ‡i tu proveru**.

{% hint style="info" %}
Imajte na umu da ako **uspete da ukradete kolaÄiÄ‡ `i_like_gitea`** (trenutno konfigurisan sa SameSite: Lax), moÅ¾ete **potpuno se predstaviti kao korisnik** bez potrebe za pristupnim podacima ili 2FA.
{% endhint %}

### Sa korisniÄkim SSH kljuÄem

Gitea dozvoljava **korisnicima** da postave **SSH kljuÄeve** koji Ä‡e se koristiti kao **metod autentifikacije za implementaciju koda** u njihovo ime (ne primenjuje se 2FA).

Sa ovim kljuÄem moÅ¾ete izvrÅ¡iti **promene u repozitorijumima gde korisnik ima odreÄ‘ene privilegije**, meÄ‘utim ne moÅ¾ete ga koristiti za pristup gitea API-ju radi nabrojavanja okruÅ¾enja. MeÄ‘utim, moÅ¾ete **nabrojati lokalna podeÅ¡avanja** da biste dobili informacije o repozitorijumima i korisniku kojima imate pristup:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Ako je korisnik konfigurisao svoje korisniÄko ime kao svoje gitea korisniÄko ime, moÅ¾ete pristupiti **javnom kljuÄu koji je postavio** na svom nalogu na _https://github.com/\<gitea\_korisniÄko\_ime>.keys_, moÅ¾ete to proveriti da biste potvrdili da li pronaÄ‘eni privatni kljuÄ moÅ¾e da se koristi.

**SSH kljuÄevi** takoÄ‘e mogu biti postavljeni u repozitorijumima kao **deploy kljuÄevi**. Svako ko ima pristup ovom kljuÄu moÄ‡i Ä‡e da **pokrene projekte iz repozitorijuma**. ObiÄno, na serveru sa razliÄitim deploy kljuÄevima, lokalna datoteka **`~/.ssh/config`** Ä‡e vam pruÅ¾iti informacije o tome koji kljuÄ je povezan.

#### GPG KljuÄevi

Kao Å¡to je objaÅ¡njeno [**ovde**](broken-reference/), ponekad je potrebno potpisati komitove ili biste mogli biti otkriveni.

Lokalno proverite da li trenutni korisnik ima neki kljuÄ sa:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Sa korisniÄkim tokenom

Za uvod o **KorisniÄkim tokenima pogledajte osnovne informacije**.

KorisniÄki token se moÅ¾e koristiti **umesto lozinke** za **autentifikaciju** na Gitea serveru [**putem API-ja**](https://try.gitea.io/api/swagger#/). On Ä‡e imati **potpuni pristup** korisniku.

### Sa Oauth aplikacijom

Za uvod o **Gitea Oauth aplikacijama pogledajte osnovne informacije**.

NapadaÄ moÅ¾e kreirati **zlonamernu Oauth aplikaciju** kako bi pristupio privilegovanim podacima/akcijama korisnika koji ih prihvataju, verovatno kao deo kampanje phishinga.

Kao Å¡to je objaÅ¡njeno u osnovnim informacijama, aplikacija Ä‡e imati **potpuni pristup korisniÄkom nalogu**.

### ZaobilaÅ¾enje zaÅ¡tite grane

Na Github-u imamo **github akcije** koje podrazumevano dobijaju **token sa pristupom za pisanje** nad repozitorijumom koji se moÅ¾e koristiti za **zaobilaÅ¾enje zaÅ¡tite grane**. U ovom sluÄaju to **ne postoji**, pa su zaobilaÅ¾enja ograniÄenija. Ali hajde da vidimo Å¡ta se moÅ¾e uraditi:

* **OmoguÄ‡i slanje**: Ako bilo ko sa pristupom za pisanje moÅ¾e slati na granu, jednostavno poÅ¡aljite na nju.
* **Whitelist ograniÄenog slanja**: Na isti naÄin, ako ste deo ove liste, poÅ¡aljite na granu.
* **OmoguÄ‡i whitelist spajanja**: Ako postoji whitelist spajanja, morate biti unutra.
* **Zahtevaj odobrenja veÄ‡e od 0**: Onda... morate kompromitovati drugog korisnika.
* **OgraniÄi odobrenja na whitelistu**: Ako samo korisnici sa whiteliste mogu odobriti... morate kompromitovati drugog korisnika koji je unutar te liste.
* **Odbaci zastarela odobrenja**: Ako odobrenja nisu uklonjena sa novim commit-ovima, moÅ¾ete preuzeti veÄ‡ odobren PR da ubacite svoj kod i spojite PR.

Imajte na umu da **ako ste admin org/repo-a** moÅ¾ete zaobiÄ‡i zaÅ¡titu.

### Nabrojavanje Webhook-ova

**Webhook-ovi** mogu **slati specifiÄne Gitea informacije na odreÄ‘ena mesta**. MoÅ¾da Ä‡ete moÄ‡i **iskoristiti tu komunikaciju**.\
MeÄ‘utim, obiÄno je postavljena **tajna** koju **ne moÅ¾ete dobiti** u **webhook-u** i koja Ä‡e **spreÄiti** eksterne korisnike koji znaju URL webhook-a, ali ne i tajnu, da **iskoriste taj webhook**.\
Ali u nekim sluÄajevima, umesto postavljanja **tajne** na odgovarajuÄ‡e mesto, oni je **postavljaju u URL** kao parametar, pa **provera URL-ova** moÅ¾e vam omoguÄ‡iti da **pronaÄ‘ete tajne** i druga mesta koja biste mogli dalje iskoristiti.

Webhook-ovi se mogu postaviti na **nivou repozitorijuma i organizacije**.

## Post eksploatacija

### Unutar servera

Ako ste nekako uspeli da se dokopate servera na kojem se izvrÅ¡ava Gitea, trebali biste pretraÅ¾iti konfiguracioni fajl Gitea-e. Podrazumevano se nalazi u `/data/gitea/conf/app.ini`

U ovom fajlu moÅ¾ete pronaÄ‡i **kljuÄeve** i **lozinke**.

Na putanji Gitea-e (podrazumevano: /data/gitea) moÅ¾ete pronaÄ‡i i interesantne informacije kao Å¡to su:

* **sqlite** baza podataka: Ako Gitea ne koristi spoljnu bazu podataka, koristiÄ‡e sqlite bazu podataka.
* **sesije** unutar foldera sesija: Pokretanjem `cat sessions/*/*/*` moÅ¾ete videti korisniÄka imena prijavljenih korisnika (Gitea takoÄ‘e moÅ¾e Äuvati sesije unutar baze podataka).
* **jwt privatni kljuÄ** unutar foldera jwt
* ViÅ¡e **osetljivih informacija** moÅ¾e se pronaÄ‡i u ovom folderu

Ako ste unutar servera, takoÄ‘e moÅ¾ete **koristiti `gitea` binarni fajl** za pristup/modifikaciju informacija:

* `gitea dump` Ä‡e izvrÅ¡iti dump Gitea-e i generisati .zip fajl
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` Ä‡e generisati token odabranog tipa (persistence)
* `gitea admin user change-password --username admin --password newpassword` Promeni lozinku
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Kreiraj novog admin korisnika i dobij pristupni token

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini da podrÅ¾ite HackTricks:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
