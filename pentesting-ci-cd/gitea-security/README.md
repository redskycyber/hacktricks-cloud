# Gitea Security

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Czym jest Gitea

**Gitea** to **samodzielnie hostowane, zarzÄ…dzane przez spoÅ‚ecznoÅ›Ä‡, lekkie rozwiÄ…zanie do hostowania kodu** napisane w Go.

![](<../../.gitbook/assets/image (5) (1) (1) (1) (1) (1).png>)

### Podstawowe informacje

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Laboratorium

Aby uruchomiÄ‡ lokalnÄ… instancjÄ™ Gitea, wystarczy uruchomiÄ‡ kontener dockera:

```bash
docker run -p 3000:3000 gitea/gitea
```

PodÅ‚Ä…cz siÄ™ do portu 3000, aby uzyskaÄ‡ dostÄ™p do strony internetowej.

MoÅ¼esz rÃ³wnieÅ¼ uruchomiÄ‡ to przy uÅ¼yciu kubernetes:

```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```

## Nieuwierzytelnione wyliczanie

* Publiczne repozytoria: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Zarejestrowani uÅ¼ytkownicy: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Zarejestrowane organizacje: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e domyÅ›lnie Gitea pozwala nowym uÅ¼ytkownikom na rejestracjÄ™. To nie daje nowym uÅ¼ytkownikom specjalnie interesujÄ…cego dostÄ™pu do repozytoriÃ³w innych organizacji/uÅ¼ytkownikÃ³w, ale zalogowany uÅ¼ytkownik moÅ¼e mieÄ‡ moÅ¼liwoÅ›Ä‡ zobaczenia wiÄ™kszej liczby repozytoriÃ³w lub organizacji.

## WewnÄ™trzne wykorzystanie

W tym scenariuszu zaÅ‚Ã³Å¼my, Å¼e uzyskaÅ‚eÅ› dostÄ™p do konta na GitHubie.

### Z poÅ›wiadczeniami uÅ¼ytkownika/Ciasteczkiem sieciowym

JeÅ›li w jakiÅ› sposÃ³b masz juÅ¼ poÅ›wiadczenia dla uÅ¼ytkownika wewnÄ…trz organizacji (lub ukradÅ‚eÅ› ciasteczko sesji), moÅ¼esz po prostu siÄ™ zalogowaÄ‡ i sprawdziÄ‡, jakie uprawnienia masz wobec repozytoriÃ³w, w jakich zespoÅ‚ach siÄ™ znajdujesz, wyÅ›wietliÄ‡ innych uÅ¼ytkownikÃ³w i jak sÄ… chronione repozytoria.

NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e moÅ¼e byÄ‡ uÅ¼ywane uwierzytelnianie dwuskÅ‚adnikowe, wiÄ™c bÄ™dziesz mÃ³gÅ‚ uzyskaÄ‡ dostÄ™p do tych informacji tylko wtedy, gdy bÄ™dziesz w stanie przejÅ›Ä‡ tÄ™ weryfikacjÄ™.

{% hint style="info" %}
NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e jeÅ›li uda ci siÄ™ ukraÅ›Ä‡ ciasteczko `i_like_gitea` (obecnie skonfigurowane z atrybutem SameSite: Lax), moÅ¼esz caÅ‚kowicie podszywaÄ‡ siÄ™ pod uÅ¼ytkownika bez potrzeby posiadania poÅ›wiadczeÅ„ ani uwierzytelniania dwuskÅ‚adnikowego.
{% endhint %}

### Z kluczem SSH uÅ¼ytkownika

Gitea pozwala uÅ¼ytkownikom na ustawienie kluczy SSH, ktÃ³re bÄ™dÄ… uÅ¼ywane jako metoda uwierzytelniania do wdraÅ¼ania kodu w ich imieniu (nie jest stosowane uwierzytelnianie dwuskÅ‚adnikowe).

Z tym kluczem moÅ¼esz dokonywaÄ‡ zmian w repozytoriach, w ktÃ³rych uÅ¼ytkownik ma pewne uprawnienia, jednak nie moÅ¼esz go uÅ¼yÄ‡ do uzyskania dostÄ™pu do interfejsu API Gitea w celu wyliczenia Å›rodowiska. MoÅ¼esz jednak wyliczyÄ‡ lokalne ustawienia, aby uzyskaÄ‡ informacje o repozytoriach i uÅ¼ytkownikach, do ktÃ³rych masz dostÄ™p.

```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```

JeÅ›li uÅ¼ytkownik skonfigurowaÅ‚ swojÄ… nazwÄ™ uÅ¼ytkownika jako swojÄ… nazwÄ™ uÅ¼ytkownika gitea, moÅ¼na uzyskaÄ‡ dostÄ™p do **kluczy publicznych**, ktÃ³re ustawiÅ‚ w swoim koncie na stronie _https://github.com/\<gitea\_username>.keys_. MoÅ¼na to sprawdziÄ‡, aby potwierdziÄ‡, czy znaleziony klucz prywatny moÅ¼e byÄ‡ uÅ¼ywany.

**Klucze SSH** mogÄ… rÃ³wnieÅ¼ byÄ‡ ustawiane w repozytoriach jako **klucze do wdroÅ¼eÅ„**. KaÅ¼da osoba majÄ…ca dostÄ™p do tego klucza bÄ™dzie mogÅ‚a **uruchamiaÄ‡ projekty z repozytorium**. Zazwyczaj na serwerze z rÃ³Å¼nymi kluczami do wdroÅ¼eÅ„ plik lokalny **`~/.ssh/config`** dostarczy informacji o powiÄ…zanym kluczu.

#### Klucze GPG

Jak wyjaÅ›niono [**tutaj**](https://github.com/carlospolop/hacktricks-cloud/blob/pl/pentesting-ci-cd/gitea-security/broken-reference/README.md), czasami konieczne jest podpisywanie commitÃ³w, aby uniknÄ…Ä‡ wykrycia.

Lokalnie sprawdÅº, czy bieÅ¼Ä…cy uÅ¼ytkownik ma jakikolwiek klucz za pomocÄ… polecenia:

```shell
gpg --list-secret-keys --keyid-format=long
```

### Za pomocÄ… Tokena UÅ¼ytkownika

Aby uzyskaÄ‡ wprowadzenie do [**TokenÃ³w UÅ¼ytkownika, sprawdÅº podstawowe informacje**](basic-gitea-information.md#personal-access-tokens).

Token uÅ¼ytkownika moÅ¼e byÄ‡ uÅ¼ywany **zamiast hasÅ‚a** do **uwierzytelnienia** na serwerze Gitea [**poprzez API**](https://try.gitea.io/api/swagger#/). BÄ™dzie on miaÅ‚ **peÅ‚ny dostÄ™p** do konta uÅ¼ytkownika.

### Za pomocÄ… Aplikacji Oauth

Aby uzyskaÄ‡ wprowadzenie do [**Aplikacji Oauth Gitea, sprawdÅº podstawowe informacje**](./#with-oauth-application).

AtakujÄ…cy moÅ¼e stworzyÄ‡ **zÅ‚oÅ›liwÄ… aplikacjÄ™ Oauth**, aby uzyskaÄ‡ dostÄ™p do poufnych danych/akcji uÅ¼ytkownikÃ³w, ktÃ³rzy najprawdopodobniej zaakceptujÄ… je jako czÄ™Å›Ä‡ kampanii phishingowej.

Jak wyjaÅ›niono w podstawowych informacjach, aplikacja bÄ™dzie miaÅ‚a **peÅ‚ny dostÄ™p do konta uÅ¼ytkownika**.

### OminiÄ™cie Ochrony GaÅ‚Ä™zi

W Githubie mamy **dziaÅ‚ania githuba**, ktÃ³re domyÅ›lnie otrzymujÄ… **token z uprawnieniami do zapisu** na repozytorium, ktÃ³ry moÅ¼e byÄ‡ uÅ¼ywany do **ominiÄ™cia ochrony gaÅ‚Ä™zi**. W tym przypadku **nie istnieje**, wiÄ™c ominiÄ™cia sÄ… bardziej ograniczone. Ale zobaczmy, co moÅ¼na zrobiÄ‡:

* **WÅ‚Ä…czanie Push**: JeÅ›li ktokolwiek z uprawnieniami do zapisu moÅ¼e wykonaÄ‡ push do gaÅ‚Ä™zi, wystarczy go wykonaÄ‡.
* **Whitelist Restricted Push**: W ten sam sposÃ³b, jeÅ›li jesteÅ› czÄ™Å›ciÄ… tej listy, wykonaj push do gaÅ‚Ä™zi.
* **WÅ‚Ä…czanie Whitelisty Scalania**: JeÅ›li istnieje whitelist scalania, musisz byÄ‡ w nim.
* **Wymagane zatwierdzenia wiÄ™ksze niÅ¼ 0**: W takim przypadku... musisz skompromitowaÄ‡ innego uÅ¼ytkownika.
* **Ograniczanie zatwierdzeÅ„ do uÅ¼ytkownikÃ³w na liÅ›cie whitelist**: JeÅ›li tylko uÅ¼ytkownicy z listy whitelist mogÄ… zatwierdzaÄ‡... musisz skompromitowaÄ‡ innego uÅ¼ytkownika, ktÃ³ry jest na tej liÅ›cie.
* **Odrzucanie przestarzaÅ‚ych zatwierdzeÅ„**: JeÅ›li zatwierdzenia nie sÄ… usuwane przy nowych commitach, moÅ¼esz przejÄ…Ä‡ juÅ¼ zatwierdzone PR, aby wstrzyknÄ…Ä‡ swÃ³j kod i scaliÄ‡ PR.

ZauwaÅ¼, Å¼e **jeÅ›li jesteÅ› administratorem org/repo**, moÅ¼esz ominÄ…Ä‡ zabezpieczenia.

### Wyliczanie WebhookÃ³w

**Webhooki** sÄ… w stanie **wysyÅ‚aÄ‡ okreÅ›lone informacje z Gitea w rÃ³Å¼ne miejsca**. MoÅ¼esz byÄ‡ w stanie **wykorzystaÄ‡ tÄ™ komunikacjÄ™**.\
Jednak zazwyczaj jest ustawiony **sekret**, ktÃ³rego **nie moÅ¼na odzyskaÄ‡**, w **webhooku**, co **uniemoÅ¼liwia** zewnÄ™trznym uÅ¼ytkownikom, ktÃ³rzy znajÄ… URL webhooku, ale nie znajÄ… sekretu, **wykorzystanie tego webhooku**.\
Ale w niektÃ³rych przypadkach, zamiast ustawienia **sekretu** na swoim miejscu, ustawiajÄ… go w URL jako parametr, wiÄ™c **sprawdzanie URL** moÅ¼e pozwoliÄ‡ Ci **odnaleÅºÄ‡ sekrety** i inne miejsca, ktÃ³re moÅ¼na dalej wykorzystaÄ‡.

Webhooki mogÄ… byÄ‡ ustawione na **poziomie repozytorium i organizacji**.

## Po Wykorzystaniu

### WewnÄ…trz serwera

JeÅ›li udaÅ‚o Ci siÄ™ jakoÅ› dostaÄ‡ do serwera, na ktÃ³rym dziaÅ‚a Gitea, powinieneÅ› poszukaÄ‡ pliku konfiguracyjnego Gitea. DomyÅ›lnie znajduje siÄ™ on w `/data/gitea/conf/app.ini`

W tym pliku moÅ¼na znaleÅºÄ‡ **klucze** i **hasÅ‚a**.

W Å›cieÅ¼ce Gitea (domyÅ›lnie: /data/gitea) moÅ¼na rÃ³wnieÅ¼ znaleÅºÄ‡ interesujÄ…ce informacje, takie jak:

* Baza danych **sqlite**: JeÅ›li Gitea nie korzysta z zewnÄ™trznej bazy danych, uÅ¼ywa bazy danych sqlite.
* **Sesje** w folderze sesji: Uruchomienie polecenia `cat sessions/*/*/*` pozwoli zobaczyÄ‡ nazwy uÅ¼ytkownikÃ³w zalogowanych (Gitea moÅ¼e rÃ³wnieÅ¼ zapisywaÄ‡ sesje w bazie danych).
* **Prywatny klucz JWT** w folderze jwt
* W tym folderze moÅ¼na znaleÅºÄ‡ wiÄ™cej **wraÅ¼liwych informacji**

JeÅ›li jesteÅ› wewnÄ…trz serwera, moÅ¼esz rÃ³wnieÅ¼ **uÅ¼yÄ‡ binarnego pliku `gitea`** do dostÄ™pu/modyfikacji informacji:

* `gitea dump` spowoduje zrzut Gitea i wygeneruje plik .zip
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` wygeneruje token o wskazanym typie (trwaÅ‚oÅ›Ä‡)
* `gitea admin user change-password --username admin --password newpassword` ZmieÅ„ hasÅ‚o
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` UtwÃ³rz nowego uÅ¼ytkownika administratora i otrzymaj token dostÄ™pu

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCYJNY**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
