# BezpieczeÅ„stwo Gitea

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Co to jest Gitea

**Gitea** to **samodzielnie hostowane lekkie rozwiÄ…zanie do hostowania kodu zarzÄ…dzane przez spoÅ‚ecznoÅ›Ä‡**, napisane w Go.

![](<../../.gitbook/assets/image (160).png>)

### Podstawowe informacje

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Laboratorium

Aby uruchomiÄ‡ lokalnÄ… instancjÄ™ Gitea, wystarczy uruchomiÄ‡ kontener docker:
```bash
docker run -p 3000:3000 gitea/gitea
```
PoÅ‚Ä…cz siÄ™ z portem 3000, aby uzyskaÄ‡ dostÄ™p do strony internetowej.

MoÅ¼esz takÅ¼e uruchomiÄ‡ to przy uÅ¼yciu kubernetes:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Nieuwierzytelnione wyliczanie

* Publiczne repozytoria: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Zarejestrowani uÅ¼ytkownicy: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Zarejestrowane organizacje: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

ZauwaÅ¼, Å¼e **domyÅ›lnie Gitea pozwala nowym uÅ¼ytkownikom siÄ™ rejestrowaÄ‡**. To nie da nowym uÅ¼ytkownikom specjalnego dostÄ™pu do repozytoriÃ³w innych organizacji/uÅ¼ytkownikÃ³w, ale **zalogowany uÅ¼ytkownik** moÅ¼e **zobaczyÄ‡ wiÄ™cej repozytoriÃ³w lub organizacji**.

## WewnÄ™trzne wykorzystanie

W tym scenariuszu zaÅ‚oÅ¼ymy, Å¼e uzyskaÅ‚eÅ› dostÄ™p do konta github.

### Z danymi uwierzytelniajÄ…cymi uÅ¼ytkownika/Ciasteczkiem sieciowym

JeÅ›li w jakiÅ› sposÃ³b juÅ¼ masz dane uwierzytelniajÄ…ce uÅ¼ytkownika wewnÄ…trz organizacji (lub ukradÅ‚eÅ› ciasteczko sesji), moÅ¼esz **po prostu siÄ™ zalogowaÄ‡** i sprawdziÄ‡, jakie **uprawnienia masz** do **repozytoriÃ³w**, w **jakich zespoÅ‚ach** jesteÅ›, **wyÅ›wietliÄ‡ innych uÅ¼ytkownikÃ³w** i **jak sÄ… chronione repozytoria**.

ZauwaÅ¼, Å¼e moÅ¼e byÄ‡ uÅ¼ywane **2FA**, wiÄ™c bÄ™dziesz mÃ³gÅ‚ uzyskaÄ‡ dostÄ™p do tych informacji tylko jeÅ›li **zdasz tÄ™ weryfikacjÄ™**.

{% hint style="info" %}
ZauwaÅ¼, Å¼e jeÅ›li **uda ci siÄ™ ukraÅ›Ä‡ ciasteczko `i_like_gitea`** (obecnie skonfigurowane z SameSite: Lax), moÅ¼esz **caÅ‚kowicie podaÄ‡ siÄ™ za uÅ¼ytkownika** bez potrzeby posiadania danych uwierzytelniajÄ…cych lub 2FA.
{% endhint %}

### Z kluczem SSH uÅ¼ytkownika

Gitea pozwala **uÅ¼ytkownikom** ustawiÄ‡ **klucze SSH**, ktÃ³re bÄ™dÄ… uÅ¼ywane jako **metoda uwierzytelniania do wdraÅ¼ania kodu** w ich imieniu (nie stosuje siÄ™ 2FA).

Z tym kluczem moÅ¼esz dokonywaÄ‡ **zmian w repozytoriach, do ktÃ³rych uÅ¼ytkownik ma pewne uprawnienia**, jednak nie moÅ¼esz go uÅ¼yÄ‡ do dostÄ™pu do interfejsu api gitea w celu wyliczenia Å›rodowiska. MoÅ¼esz jednak **wyliczyÄ‡ ustawienia lokalne**, aby uzyskaÄ‡ informacje o repozytoriach i uÅ¼ytkowniku, do ktÃ³rych masz dostÄ™p:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
JeÅ›li uÅ¼ytkownik skonfigurowaÅ‚ swojÄ… nazwÄ™ uÅ¼ytkownika jako swojÄ… nazwÄ™ uÅ¼ytkownika gitea, moÅ¼esz uzyskaÄ‡ dostÄ™p do **kluczy publicznych**, ktÃ³re ustawiÅ‚ w swoim koncie pod adresem _https://github.com/\<gitea\_username>.keys_, moÅ¼esz to sprawdziÄ‡, aby potwierdziÄ‡, czy znaleziony przez Ciebie klucz prywatny moÅ¼e byÄ‡ uÅ¼yty.

**Klucze SSH** mogÄ… rÃ³wnieÅ¼ byÄ‡ ustawione w repozytoriach jako **klucze deploy**. KaÅ¼dy, kto ma dostÄ™p do tego klucza, bÄ™dzie mÃ³gÅ‚ **uruchamiaÄ‡ projekty z repozytorium**. Zazwyczaj na serwerze z rÃ³Å¼nymi kluczami deploy plik lokalny **`~/.ssh/config`** dostarczy informacje o powiÄ…zanym kluczu.

#### Klucze GPG

Jak wyjaÅ›niono [**tutaj**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/gitea-security/broken-reference/README.md) czasami konieczne jest podpisanie commitÃ³w lub moÅ¼esz zostaÄ‡ odkryty.

SprawdÅº lokalnie, czy bieÅ¼Ä…cy uÅ¼ytkownik ma jakiÅ› klucz za pomocÄ…:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Z UÅ¼yciem Tokena UÅ¼ytkownika

Dla wprowadzenia do [**TokenÃ³w UÅ¼ytkownika sprawdÅº podstawowe informacje**](basic-gitea-information.md#personal-access-tokens).

Token uÅ¼ytkownika moÅ¼e byÄ‡ uÅ¼yty **zamiast hasÅ‚a** do **uwierzytelnienia** siÄ™ na serwerze Gitea [**poprzez API**](https://try.gitea.io/api/swagger#/). BÄ™dzie miaÅ‚ **peÅ‚ny dostÄ™p** do konta uÅ¼ytkownika.

### Z UÅ¼yciem Aplikacji Oauth

Dla wprowadzenia do [**Aplikacji Gitea Oauth sprawdÅº podstawowe informacje**](./#with-oauth-application).

AtakujÄ…cy moÅ¼e stworzyÄ‡ **zÅ‚oÅ›liwÄ… AplikacjÄ™ Oauth** w celu uzyskania dostÄ™pu do poufnych danych/akcji uÅ¼ytkownikÃ³w, ktÃ³rzy akceptujÄ… je prawdopodobnie jako czÄ™Å›Ä‡ kampanii phishingowej.

Jak wyjaÅ›niono w podstawowych informacjach, aplikacja bÄ™dzie miaÅ‚a **peÅ‚ny dostÄ™p do konta uÅ¼ytkownika**.

### OminiÄ™cie Ochrony GaÅ‚Ä™zi

W Github mamy **dziaÅ‚ania githubowe**, ktÃ³re domyÅ›lnie otrzymujÄ… **token z dostÄ™pem do zapisu** w repozytorium, ktÃ³ry moÅ¼e byÄ‡ uÅ¼yty do **omijania ochrony gaÅ‚Ä™zi**. W tym przypadku to **nie istnieje**, wiÄ™c ominiÄ™cia sÄ… bardziej ograniczone. Ale zobaczmy, co moÅ¼na zrobiÄ‡:

* **WÅ‚Ä…cz Push**: JeÅ›li ktoÅ› z dostÄ™pem do zapisu moÅ¼e wykonaÄ‡ push do gaÅ‚Ä™zi, po prostu zrÃ³b push.
* **Whitelist Restricted Push**: Podobnie, jeÅ›li jesteÅ› czÄ™Å›ciÄ… tej listy, wykonaj push do gaÅ‚Ä™zi.
* **WÅ‚Ä…cz WhitelistÄ™ Merge**: JeÅ›li istnieje whitelist merge, musisz byÄ‡ wewnÄ…trz niego.
* **Wymagane zatwierdzenia wiÄ™ksze niÅ¼ 0**: W takim przypadku... musisz skompromitowaÄ‡ innego uÅ¼ytkownika.
* **Ogranicz zatwierdzenia do uÅ¼ytkownikÃ³w na biaÅ‚ej liÅ›cie**: JeÅ›li tylko uÅ¼ytkownicy na biaÅ‚ej liÅ›cie mogÄ… zatwierdzaÄ‡... musisz skompromitowaÄ‡ innego uÅ¼ytkownika znajdujÄ…cego siÄ™ na tej liÅ›cie.
* **OdrzuÄ‡ przeterminowane zatwierdzenia**: JeÅ›li zatwierdzenia nie sÄ… usuwane przy nowych commitach, moÅ¼esz przejÄ…Ä‡ juÅ¼ zatwierdzony PR, aby wstrzyknÄ…Ä‡ swÃ³j kod i zmergowaÄ‡ PR.

ZauwaÅ¼, Å¼e **jeÅ›li jesteÅ› administratorem org/repo**, moÅ¼esz ominÄ…Ä‡ zabezpieczenia.

### Wyliczanie WebhookÃ³w

**Webhooki** mogÄ… **wysyÅ‚aÄ‡ okreÅ›lone informacje z Gitea w rÃ³Å¼ne miejsca**. MoÅ¼esz byÄ‡ w stanie **wykorzystaÄ‡ tÄ™ komunikacjÄ™**.\
Jednak zazwyczaj **ustawiany jest sekret**, ktÃ³rego **nie moÅ¼na odzyskaÄ‡**, w **webhooku**, co **zapobiegnie** wykorzystaniu tego webhooka przez zewnÄ™trznych uÅ¼ytkownikÃ³w, ktÃ³rzy znajÄ… URL webhooka, ale nie znajÄ… sekretu.\
Ale w niektÃ³rych przypadkach ludzie zamiast ustawiaÄ‡ **sekret** na swoim miejscu, **ustawiajÄ… go w URL** jako parametr, wiÄ™c **sprawdzanie URLi** moÅ¼e pozwoliÄ‡ ci **odnaleÅºÄ‡ sekrety** i inne miejsca, ktÃ³re moÅ¼na dalej wykorzystaÄ‡.

Webhooki mogÄ… byÄ‡ ustawione na **poziomie repozytorium i na poziomie org**.

## Po Wykorzystaniu

### WewnÄ…trz serwera

JeÅ›li w jakiÅ› sposÃ³b udaÅ‚o ci siÄ™ dostaÄ‡ do serwera, na ktÃ³rym dziaÅ‚a Gitea, powinieneÅ› poszukaÄ‡ pliku konfiguracyjnego Gitea. DomyÅ›lnie znajduje siÄ™ on w `/data/gitea/conf/app.ini`

W tym pliku moÅ¼esz znaleÅºÄ‡ **klucze** i **hasÅ‚a**.

W Å›cieÅ¼ce Gitea (domyÅ›lnie: /data/gitea) moÅ¼esz znaleÅºÄ‡ rÃ³wnieÅ¼ interesujÄ…ce informacje, takie jak:

* Baza danych **sqlite**: JeÅ›li Gitea nie korzysta z zewnÄ™trznej bazy danych, uÅ¼yje bazy danych sqlite.
* **Sesje** wewnÄ…trz folderu sesji: Uruchomienie `cat sessions/*/*/*` pozwoli zobaczyÄ‡ nazwy uÅ¼ytkownikÃ³w zalogowanych (Gitea moÅ¼e rÃ³wnieÅ¼ zapisywaÄ‡ sesje w bazie danych).
* **Prywatny klucz jwt** w folderze jwt
* WiÄ™cej **wraÅ¼liwych informacji** moÅ¼na znaleÅºÄ‡ w tym folderze

JeÅ›li jesteÅ› wewnÄ…trz serwera, moÅ¼esz rÃ³wnieÅ¼ **uÅ¼yÄ‡ binarii `gitea`** do dostÄ™pu/modyfikacji informacji:

* `gitea dump` spowoduje zrzut Gitea i wygeneruje plik .zip
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` wygeneruje token wskazanego typu (trwaÅ‚oÅ›Ä‡)
* `gitea admin user change-password --username admin --password newpassword` ZmieÅ„ hasÅ‚o
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` UtwÃ³rz nowego uÅ¼ytkownika admina i uzyskaj token dostÄ™pu
