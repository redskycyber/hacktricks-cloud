# Concourse Lab Creation

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å¾—ã‚‹ï¼</strong></summary>

* **HackTricksã§ä¼šç¤¾ã®åºƒå‘Šã‚’è¦‹ãŸã„**å ´åˆã‚„ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹ã—ãŸã„**å ´åˆã€ã¾ãŸã¯HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ã”ç¢ºèªãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>

## ãƒ†ã‚¹ãƒˆç’°å¢ƒ

### Concourseã®å®Ÿè¡Œ

#### Docker-Composeã‚’ä½¿ç”¨ã—ã¦

ã“ã®docker-composeãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Concourseã§ã®ãƒ†ã‚¹ãƒˆã‚’ç°¡ç´ åŒ–ã—ã¾ã™ï¼š
```bash
wget https://raw.githubusercontent.com/starkandwayne/concourse-tutorial/master/docker-compose.yml
docker-compose up -d
```
æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³`fly`ã¯ã€`127.0.0.1:8080`ã‹ã‚‰ã‚¦ã‚§ãƒ–ä¸Šã§OSã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚

#### Kubernetesã‚’ä½¿ç”¨ã™ã‚‹ï¼ˆæ¨å¥¨ï¼‰

[**concourse-chart**](https://github.com/concourse/concourse-chart)ã‚’ä½¿ç”¨ã—ã¦ã€**Kubernetes**ï¼ˆãŸã¨ãˆã°**minikube**ï¼‰ã«ç°¡å˜ã«Concourseã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚
```bash
brew install helm
helm repo add concourse https://concourse-charts.storage.googleapis.com/
helm install concourse-release concourse/concourse
# concourse-release will be the prefix name for the concourse elements in k8s
# After the installation you will find the indications to connect to it in the console

# If you need to delete it
helm delete concourse-release
```
concourseç’°å¢ƒã‚’ç”Ÿæˆã—ãŸå¾Œã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç”Ÿæˆã—ã€concourse webã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹SAãŒK8sã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä¸ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```yaml
echo 'apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: read-secrets
rules:
- apiGroups: [""]
resources: ["secrets"]
verbs: ["get"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
name: read-secrets-concourse
roleRef:
apiGroup: rbac.authorization.k8s.io
kind: ClusterRole
name: read-secrets
subjects:
- kind: ServiceAccount
name: concourse-release-web
namespace: default

---

apiVersion: v1
kind: Secret
metadata:
name: super
namespace: concourse-release-main
type: Opaque
data:
secret: MWYyZDFlMmU2N2Rm

' | kubectl apply -f -
```
### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä½œæˆ

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã€[ã‚¸ãƒ§ãƒ–](https://concourse-ci.org/jobs.html)ã®ãƒªã‚¹ãƒˆã§æ§‹æˆã•ã‚Œã€é †åºä»˜ã‘ã‚‰ã‚ŒãŸ[ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/steps.html)ã®ãƒªã‚¹ãƒˆã‚’å«ã¿ã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—

ã•ã¾ã–ã¾ãªç¨®é¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:

* **[`task`ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/task-step.html)**ã¯ã€[ã‚¿ã‚¹ã‚¯](https://concourse-ci.org/tasks.html)ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
* [`get`ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/get-step.html)ã¯ã€[ãƒªã‚½ãƒ¼ã‚¹](https://concourse-ci.org/resources.html)ã‚’å–å¾—ã—ã¾ã™ã€‚
* [`put`ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/put-step.html)ã¯ã€[ãƒªã‚½ãƒ¼ã‚¹](https://concourse-ci.org/resources.html)ã‚’æ›´æ–°ã—ã¾ã™ã€‚
* [`set_pipeline`ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/set-pipeline-step.html)ã¯ã€[ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](https://concourse-ci.org/pipelines.html)ã‚’è¨­å®šã—ã¾ã™ã€‚
* [`load_var`ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/load-var-step.html)ã¯ã€å€¤ã‚’[ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°](https://concourse-ci.org/vars.html#local-vars)ã«èª­ã¿è¾¼ã¿ã¾ã™ã€‚
* [`in_parallel`ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/in-parallel-step.html)ã¯ã€ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä¸¦åˆ—ã§å®Ÿè¡Œã—ã¾ã™ã€‚
* [`do`ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/do-step.html)ã¯ã€ã‚¹ãƒ†ãƒƒãƒ—ã‚’é †æ¬¡å®Ÿè¡Œã—ã¾ã™ã€‚
* [`across`ã‚¹ãƒ†ãƒƒãƒ—ä¿®é£¾å­](https://concourse-ci.org/across-step.html#schema.across)ã¯ã€ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¤‡æ•°å›å®Ÿè¡Œã—ã¾ã™ã€‚å¤‰æ•°ã®å€¤ã®çµ„ã¿åˆã‚ã›ã”ã¨ã«ä¸€åº¦ãšã¤å®Ÿè¡Œã—ã¾ã™ã€‚
* [`try`ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/try-step.html)ã¯ã€ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã—ã€ã‚¹ãƒ†ãƒƒãƒ—ãŒå¤±æ•—ã—ã¦ã‚‚æˆåŠŸã—ã¾ã™ã€‚

[ã‚¸ãƒ§ãƒ–ãƒ—ãƒ©ãƒ³](https://concourse-ci.org/jobs.html#schema.job.plan)ã®å„[ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/steps.html)ã¯ã€**ç‹¬è‡ªã®ã‚³ãƒ³ãƒ†ãƒŠ**ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ä»»æ„ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆä¾‹: ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã€Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ãªã©ï¼‰ã€‚ã—ãŸãŒã£ã¦ã€5ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’æŒã¤ã‚¸ãƒ§ãƒ–ã§ã¯ã€Concourseã¯5ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€å„ã‚¹ãƒ†ãƒƒãƒ—ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

### ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä¾‹
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
sleep 1000
echo "$SUPER_SECRET"
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial set-pipeline -p pipe-name -c hello-world.yml
# pipelines are paused when first created
fly -t tutorial unpause-pipeline -p pipe-name
# trigger the job and watch it run to completion
fly -t tutorial trigger-job --job pipe-name/simple --watch
# From another console
fly -t tutorial intercept --job pipe-name/simple
```
### ãƒãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨å‡ºåŠ›/å…¥åŠ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

**1ã¤ã®ã‚¿ã‚¹ã‚¯ã®çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜**ã—ã€ãã‚ŒãŒå‡ºåŠ›ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã€æ¬¡ã®ã‚¿ã‚¹ã‚¯ã®å…¥åŠ›ã‚’å‰ã®ã‚¿ã‚¹ã‚¯ã®å‡ºåŠ›ã¨ã—ã¦æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Concourseã¯ã€å‰ã®ã‚¿ã‚¹ã‚¯ã§ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã€å‰ã®ã‚¿ã‚¹ã‚¯ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã«ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚

### ãƒˆãƒªã‚¬ãƒ¼

ã‚¸ãƒ§ãƒ–ã‚’æ‰‹å‹•ã§å®Ÿè¡Œã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ¬¡ã®ã‚ˆã†ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

* ä¸€å®šã®æ™‚é–“ãŒçµŒéã—ãŸå ´åˆï¼š[Timeãƒªã‚½ãƒ¼ã‚¹](https://github.com/concourse/time-resource/)
* ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆãŒã‚ã‚‹å ´åˆï¼š[Gitãƒªã‚½ãƒ¼ã‚¹](https://github.com/concourse/git-resource)
* æ–°ã—ã„PRï¼š[Github-PRãƒªã‚½ãƒ¼ã‚¹](https://github.com/telia-oss/github-pr-resource)
* ã‚¢ãƒ—ãƒªã®æœ€æ–°ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ•ã‚§ãƒƒãƒã¾ãŸã¯ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹å ´åˆï¼š[Registry-imageãƒªã‚½ãƒ¼ã‚¹](https://github.com/concourse/registry-image-resource/)

[https://concourse-ci.org/tutorial-resources.html](https://concourse-ci.org/tutorial-resources.html)ã®ãƒã‚¹ã‚¿ãƒ¼ã¸ã®æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹YAMLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä¾‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* **HackTricksã§ä¼šç¤¾ã®åºƒå‘Šã‚’è¦‹ãŸã„**å ´åˆã‚„ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
