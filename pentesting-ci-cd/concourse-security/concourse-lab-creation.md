# Concourseå®éªŒåˆ›å»º

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ–è€… [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ–è€… **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## æµ‹è¯•ç¯å¢ƒ

### è¿è¡ŒConcourse

#### ä½¿ç”¨Docker-Compose

è¿™ä¸ªdocker-composeæ–‡ä»¶ç®€åŒ–äº†ä½¿ç”¨concourseè¿›è¡Œä¸€äº›æµ‹è¯•çš„å®‰è£…è¿‡ç¨‹ï¼š
```bash
wget https://raw.githubusercontent.com/starkandwayne/concourse-tutorial/master/docker-compose.yml
docker-compose up -d
```
æ‚¨å¯ä»¥ä»ç½‘ä¸Šåœ¨`127.0.0.1:8080`ä¸‹è½½é€‚ç”¨äºæ‚¨çš„æ“ä½œç³»ç»Ÿçš„å‘½ä»¤è¡Œå·¥å…·`fly`ã€‚

#### ä½¿ç”¨Kubernetesï¼ˆæ¨èï¼‰

æ‚¨å¯ä»¥ä½¿ç”¨helm-chartï¼š[**concourse-chart**](https://github.com/concourse/concourse-chart)ï¼Œåœ¨**Kubernetes**ï¼ˆä¾‹å¦‚åœ¨**minikube**ä¸­ï¼‰è½»æ¾éƒ¨ç½²concourseã€‚
```bash
brew install helm
helm repo add concourse https://concourse-charts.storage.googleapis.com/
helm install concourse-release concourse/concourse
# concourse-release will be the prefix name for the concourse elements in k8s
# After the installation you will find the indications to connect to it in the console

# If you need to delete it
helm delete concourse-release
```
åœ¨ç”Ÿæˆconcourseç¯å¢ƒä¹‹åï¼Œæ‚¨å¯ä»¥ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œå¹¶æˆäºˆåœ¨concourse webä¸­è¿è¡Œçš„SAè®¿é—®K8s secretsçš„æƒé™ï¼š
```yaml
echo 'apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: read-secrets
rules:
- apiGroups: [""]
resources: ["secrets"]
verbs: ["get"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
name: read-secrets-concourse
roleRef:
apiGroup: rbac.authorization.k8s.io
kind: ClusterRole
name: read-secrets
subjects:
- kind: ServiceAccount
name: concourse-release-web
namespace: default

---

apiVersion: v1
kind: Secret
metadata:
name: super
namespace: concourse-release-main
type: Opaque
data:
secret: MWYyZDFlMmU2N2Rm

' | kubectl apply -f -
```
### åˆ›å»ºæµæ°´çº¿

æµæ°´çº¿ç”±ä¸€ç³»åˆ—çš„[ä½œä¸š](https://concourse-ci.org/jobs.html)ç»„æˆï¼Œæ¯ä¸ªä½œä¸šåŒ…å«ä¸€ä¸ªæœ‰åºçš„[æ­¥éª¤](https://concourse-ci.org/steps.html)åˆ—è¡¨ã€‚

### æ­¥éª¤

å¯ä»¥ä½¿ç”¨å¤šç§ä¸åŒç±»å‹çš„æ­¥éª¤ï¼š

* **[`task`æ­¥éª¤](https://concourse-ci.org/task-step.html)** è¿è¡Œä¸€ä¸ª[ä»»åŠ¡](https://concourse-ci.org/tasks.html)
* [`get`æ­¥éª¤](https://concourse-ci.org/get-step.html)è·å–ä¸€ä¸ª[èµ„æº](https://concourse-ci.org/resources.html)
* [`put`æ­¥éª¤](https://concourse-ci.org/put-step.html)æ›´æ–°ä¸€ä¸ª[èµ„æº](https://concourse-ci.org/resources.html)
* [`set_pipeline`æ­¥éª¤](https://concourse-ci.org/set-pipeline-step.html)é…ç½®ä¸€ä¸ª[æµæ°´çº¿](https://concourse-ci.org/pipelines.html)
* [`load_var`æ­¥éª¤](https://concourse-ci.org/load-var-step.html)å°†ä¸€ä¸ªå€¼åŠ è½½åˆ°[æœ¬åœ°å˜é‡](https://concourse-ci.org/vars.html#local-vars)ä¸­
* [`in_parallel`æ­¥éª¤](https://concourse-ci.org/in-parallel-step.html)å¹¶è¡Œè¿è¡Œå¤šä¸ªæ­¥éª¤
* [`do`æ­¥éª¤](https://concourse-ci.org/do-step.html)æŒ‰é¡ºåºè¿è¡Œå¤šä¸ªæ­¥éª¤
* [`across`æ­¥éª¤ä¿®é¥°ç¬¦](https://concourse-ci.org/across-step.html#schema.across)å¤šæ¬¡è¿è¡Œä¸€ä¸ªæ­¥éª¤ï¼Œæ¯æ¬¡ä½¿ç”¨ä¸åŒçš„å˜é‡å€¼ç»„åˆ
* [`try`æ­¥éª¤](https://concourse-ci.org/try-step.html)å°è¯•è¿è¡Œä¸€ä¸ªæ­¥éª¤ï¼Œå³ä½¿æ­¥éª¤å¤±è´¥ä¹Ÿä¼šæˆåŠŸ

ä½œä¸šè®¡åˆ’ä¸­çš„æ¯ä¸ª[æ­¥éª¤](https://concourse-ci.org/steps.html)éƒ½åœ¨**è‡ªå·±çš„å®¹å™¨**ä¸­è¿è¡Œã€‚æ‚¨å¯ä»¥åœ¨å®¹å™¨ä¸­è¿è¡Œä»»ä½•æ‚¨æƒ³è¦çš„å†…å®¹ï¼ˆä¾‹å¦‚è¿è¡Œæˆ‘çš„æµ‹è¯•ï¼Œè¿è¡Œæ­¤bashè„šæœ¬ï¼Œæ„å»ºæ­¤é•œåƒç­‰ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªåŒ…å«äº”ä¸ªæ­¥éª¤çš„ä½œä¸šï¼ŒConcourseå°†åˆ›å»ºäº”ä¸ªå®¹å™¨ï¼Œæ¯ä¸ªæ­¥éª¤ä¸€ä¸ªå®¹å™¨ã€‚

å› æ­¤ï¼Œå¯ä»¥æŒ‡å®šæ¯ä¸ªæ­¥éª¤éœ€è¦è¿è¡Œçš„å®¹å™¨ç±»å‹ã€‚

### ç®€å•æµæ°´çº¿ç¤ºä¾‹
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
sleep 1000
echo "$SUPER_SECRET"
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial set-pipeline -p pipe-name -c hello-world.yml
# pipelines are paused when first created
fly -t tutorial unpause-pipeline -p pipe-name
# trigger the job and watch it run to completion
fly -t tutorial trigger-job --job pipe-name/simple --watch
# From another console
fly -t tutorial intercept --job pipe-name/simple
```
æ£€æŸ¥ **127.0.0.1:8080** ä»¥æŸ¥çœ‹æµæ°´çº¿æµç¨‹ã€‚

### å…·æœ‰è¾“å‡º/è¾“å…¥æµæ°´çº¿çš„ Bash è„šæœ¬

å¯ä»¥**å°†ä¸€ä¸ªä»»åŠ¡çš„ç»“æœä¿å­˜åœ¨æ–‡ä»¶ä¸­**ï¼Œå¹¶æŒ‡ç¤ºå®ƒæ˜¯ä¸€ä¸ªè¾“å‡ºï¼Œç„¶åå°†ä¸‹ä¸€ä¸ªä»»åŠ¡çš„è¾“å…¥æŒ‡å®šä¸ºå‰ä¸€ä¸ªä»»åŠ¡çš„è¾“å‡ºã€‚Concourse ä¼š**å°†å‰ä¸€ä¸ªä»»åŠ¡çš„ç›®å½•æŒ‚è½½åˆ°æ–°ä»»åŠ¡ä¸­ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥è®¿é—®å‰ä¸€ä¸ªä»»åŠ¡åˆ›å»ºçš„æ–‡ä»¶**ã€‚

### è§¦å‘å™¨

æ‚¨ä¸éœ€è¦æ‰‹åŠ¨è§¦å‘ä½œä¸šæ¯æ¬¡è¿è¡Œï¼Œæ‚¨ä¹Ÿå¯ä»¥ç¼–ç¨‹ä½¿å…¶åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è¿è¡Œï¼š

* ç»è¿‡ä¸€æ®µæ—¶é—´ï¼š[Time èµ„æº](https://github.com/concourse/time-resource/)
* åœ¨ä¸»åˆ†æ”¯ä¸Šæœ‰æ–°çš„æäº¤ï¼š[Git èµ„æº](https://github.com/concourse/git-resource)
* æ–°çš„ PRï¼š[Github-PR èµ„æº](https://github.com/telia-oss/github-pr-resource)
* è·å–æˆ–æ¨é€æ‚¨çš„åº”ç”¨ç¨‹åºçš„æœ€æ–°é•œåƒï¼š[Registry-image èµ„æº](https://github.com/concourse/registry-image-resource/)

åœ¨ [https://concourse-ci.org/tutorial-resources.html](https://concourse-ci.org/tutorial-resources.html) ä¸­æŸ¥çœ‹ä¸€ä¸ªè§¦å‘å™¨åœ¨ä¸»åˆ†æ”¯ä¸Šæœ‰æ–°çš„æäº¤æ—¶çš„ YAML æµæ°´çº¿ç¤ºä¾‹ã€‚

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**ï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®**PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ PDF æ ¼å¼çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨ **Twitter** ä¸Šå…³æ³¨æˆ‘ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
