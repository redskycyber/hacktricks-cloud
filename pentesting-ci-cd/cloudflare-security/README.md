# Seguridad de Cloudflare

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

En una cuenta de Cloudflare hay algunas **configuraciones y servicios generales** que se pueden configurar. En esta p谩gina vamos a **analizar las configuraciones relacionadas con la seguridad de cada secci贸n:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Sitios web

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Registro de dominios

* [ ] En **`Transferir dominios`** verifica que no sea posible transferir ning煤n dominio.

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Anal铆ticas

_No pude encontrar nada para revisar en una revisi贸n de seguridad de la configuraci贸n._

## P谩ginas

En cada p谩gina de Cloudflare:

* [ ] Verifica la presencia de **informaci贸n sensible** en el **`Registro de construcci贸n`**.
* [ ] Verifica la presencia de **informaci贸n sensible** en el **repositorio de Github** asignado a las p谩ginas.
* [ ] Verifica la posible compromisi贸n del repositorio de Github a trav茅s de **inyecci贸n de comandos en el flujo de trabajo** o compromiso de `pull_request_target`. M谩s informaci贸n en la [**p谩gina de Seguridad de Github**](../github-security/).
* [ ] Verifica la presencia de **funciones vulnerables** en el directorio `/fuctions` (si hay), verifica los **redireccionamientos** en el archivo `_redirects` (si hay) y los **encabezados mal configurados** en el archivo `_headers` (si hay).
* [ ] Verifica las **vulnerabilidades** en la **p谩gina web** a trav茅s de **blackbox** o **whitebox** si puedes **acceder al c贸digo**
* [ ] En los detalles de cada p谩gina `/<page_id>/pages/view/blocklist/settings/functions`. Verifica la presencia de **informaci贸n sensible** en las **`Variables de entorno`**.
* [ ] En la p谩gina de detalles, verifica tambi茅n el **comando de construcci贸n** y el **directorio ra铆z** para **inyecciones potenciales** que comprometan la p谩gina.

## **Workers**

En cada worker de Cloudflare verifica:

* [ ] Los desencadenantes: 驴Qu茅 hace que el worker se active? 驴Puede un **usuario enviar datos** que ser谩n **utilizados** por el worker?
* [ ] En la **`Configuraci贸n`**, verifica las **`Variables`** que contienen **informaci贸n sensible**
* [ ] Verifica el **c贸digo del worker** y busca **vulnerabilidades** (especialmente en lugares donde el usuario puede gestionar la entrada)
* Verifica SSRFs que devuelvan la p谩gina indicada que puedas controlar
* Verifica XSSs ejecutando JS dentro de una imagen svg

{% hint style="warning" %}
Ten en cuenta que por defecto a un **Worker se le asigna una URL** como `<nombre-worker>.<cuenta>.workers.dev`. El usuario puede configurarlo como un **subdominio** pero siempre puedes acceder a 茅l con esa **URL original** si la conoces.
{% endhint %}

## R2

POR HACER

## Stream

POR HACER

## Im谩genes

POR HACER

## Centro de Seguridad

* [ ] Si es posible, ejecuta un **escaneo de** **`Security Insights`** y un **escaneo de** **`Infraestructura`**, ya que resaltar谩n informaci贸n interesante en t茅rminos de **seguridad**.
* [ ] Simplemente **verifica esta informaci贸n** en busca de configuraciones de seguridad incorrectas e informaci贸n interesante

## Turnstile

POR HACER

## **Confianza Cero**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Redirecciones Masivas

{% hint style="info" %}
A diferencia de [Redirecciones Din谩micas](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Redirecciones Masivas**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) son esencialmente est谩ticas, no admiten operaciones de **reemplazo de cadenas** ni expresiones regulares. Sin embargo, puedes configurar par谩metros de redirecci贸n de URL que afectan su comportamiento de coincidencia de URL y su comportamiento en tiempo de ejecuci贸n.
{% endhint %}

* [ ] Verifica que las **expresiones** y **requisitos** para las redirecciones tengan **sentido**.
* [ ] Verifica tambi茅n la presencia de **puntos finales ocultos sensibles** que contengan informaci贸n interesante.

## Notificaciones

* [ ] Verifica las **notificaciones**. Estas notificaciones son recomendadas para la seguridad:
* `Facturaci贸n basada en uso`
* `Alerta de Ataque DDoS HTTP`
* `Alerta de Ataque DDoS de Capa 3/4`
* `Alerta de Ataque DDoS HTTP Avanzado`
* `Alerta de Ataque DDoS de Capa 3/4 Avanzado`
* `Monitoreo basado en flujo: Ataque volum茅trico`
* `Alerta de Detecci贸n de Fuga de Rutas`
* `Alerta de Expiraci贸n de Certificado mTLS de Acceso`
* `Alerta de Hostnames Personalizados SSL para SaaS`
* `Alerta de SSL Universal`
* `Alerta de Detecci贸n de Cambio de C贸digo Nuevo en Monitor de Scripts`
* `Alerta de Nuevo Dominio en Monitor de Scripts`
* `Alerta de Nuevo Dominio Malicioso en Monitor de Scripts`
* `Alerta de Nuevo Script Malicioso en Monitor de Scripts`
* `Alerta de Nueva URL Maliciosa en Monitor de Scripts`
* `Alerta de Nuevos Scripts en Monitor de Scripts`
* `Alerta de Nuevo Script que Excede la Longitud M谩xima de URL en Monitor de Scripts`
* `Alerta de Eventos de Seguridad Avanzados`
* `Alerta de Eventos de Seguridad`
* [ ] Verifica todos los **destinos**, ya que podr铆a haber **informaci贸n sensible** (autenticaci贸n b谩sica http) en las URL de webhook. Aseg煤rate tambi茅n de que las URL de webhook utilicen **HTTPS**
* [ ] Como verificaci贸n adicional, podr铆as intentar **suplantar una notificaci贸n de Cloudflare** a un tercero, tal vez puedas de alguna manera **inyectar algo peligroso**

## Administrar Cuenta

* [ ] Es posible ver los **煤ltimos 4 d铆gitos de la tarjeta de cr茅dito**, la **fecha de vencimiento** y la **direcci贸n de facturaci贸n** en **`Facturaci贸n` -> `Informaci贸n de pago`**.
* [ ] Es posible ver el **tipo de plan** utilizado en la cuenta en **`Facturaci贸n` -> `Suscripciones`**.
* [ ] En **`Miembros`** es posible ver todos los miembros de la cuenta y su **rol**. Ten en cuenta que si el tipo de plan no es Enterprise, solo existen 2 roles: Administrador y Super Administrador. Pero si se utiliza un **plan Enterprise**, se pueden utilizar [**m谩s roles**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) para seguir el principio de privilegio m铆nimo.
* Por lo tanto, siempre que sea posible es **recomendable** utilizar el **plan Enterprise**.
* [ ] En Miembros es posible verificar qu茅 **miembros** tienen habilitado el **2FA**. **Cada** usuario deber铆a tenerlo habilitado.

{% hint style="info" %}
Ten en cuenta que afortunadamente el rol **`Administrador`** no otorga permisos para gestionar membres铆as (**no puede escalar privilegios o invitar** nuevos miembros)
{% endhint %}
## Investigaci贸n de DDoS

[Ver esta secci贸n](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
