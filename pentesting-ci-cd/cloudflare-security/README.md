# Seguridad de Cloudflare

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop).
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>

En una cuenta de Cloudflare, hay algunas **configuraciones y servicios generales** que se pueden configurar. En esta p谩gina vamos a **analizar las configuraciones relacionadas con la seguridad de cada secci贸n**:

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## Sitios web

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Registro de dominios

* [ ] En **`Transfer Domains`**, verifica que no sea posible transferir ning煤n dominio.

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Anal铆ticas

_No pude encontrar nada para revisar la configuraci贸n de seguridad._

## P谩ginas

En cada p谩gina de Cloudflare:

* [ ] Verifica si hay **informaci贸n sensible** en el **`Registro de compilaci贸n`**.
* [ ] Verifica si hay **informaci贸n sensible** en el **repositorio de Github** asignado a las p谩ginas.
* [ ] Verifica si hay una posible compromiso del repositorio de Github a trav茅s de una **inyecci贸n de comandos de flujo de trabajo** o una compromiso de `pull_request_target`. M谩s informaci贸n en la [**p谩gina de seguridad de Github**](../github-security/).
* [ ] Verifica si hay **funciones vulnerables** en el directorio `/fuctions` (si existe), verifica las **redirecciones** en el archivo `_redirects` (si existe) y las **cabeceras mal configuradas** en el archivo `_headers` (si existe).
* [ ] Verifica si hay **vulnerabilidades** en la **p谩gina web** a trav茅s de **blackbox** o **whitebox** si puedes **acceder al c贸digo**.
* [ ] En los detalles de cada p谩gina `/<page_id>/pages/view/blocklist/settings/functions`, verifica si hay **informaci贸n sensible** en las **`Variables de entorno`**.
* [ ] En la p谩gina de detalles, verifica tambi茅n el **comando de compilaci贸n** y el **directorio ra铆z** para **posibles inyecciones** que comprometan la p谩gina.

## **Workers**

En cada worker de Cloudflare, verifica:

* [ ] Los desencadenantes: 驴Qu茅 hace que el worker se active? 驴Un **usuario puede enviar datos** que ser谩n **utilizados** por el worker?
* [ ] En **`Configuraci贸n`**, verifica si hay **`Variables`** que contengan **informaci贸n sensible**.
* [ ] Verifica el **c贸digo del worker** y busca **vulnerabilidades** (especialmente en lugares donde el usuario puede gestionar la entrada).
* Verifica SSRFs que devuelvan la p谩gina indicada que puedes controlar.
* Verifica XSSs ejecutando JS dentro de una imagen svg.

{% hint style="warning" %}
Ten en cuenta que de forma predeterminada, a un **Worker se le asigna una URL** como `<nombre-del-worker>.<cuenta>.workers.dev`. El usuario puede configurarlo como un **subdominio**, pero siempre puedes acceder a 茅l con esa **URL original** si la conoces.
{% endhint %}

## R2

POR HACER

## Stream

POR HACER

## Im谩genes

POR HACER

## Centro de seguridad

* [ ] Si es posible, ejecuta un **escaneo de** **`Security Insights`** y un **escaneo de** **`Infraestructura`**, ya que resaltar谩n informaci贸n interesante en t茅rminos de seguridad.
* [ ] Solo **verifica esta informaci贸n** en busca de configuraciones de seguridad incorrectas e informaci贸n interesante.

## Turnstile

POR HACER

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Redirecciones masivas

{% hint style="info" %}
A diferencia de las [Redirecciones din谩micas](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), las [**Redirecciones masivas**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) son esencialmente est谩ticas, no admiten ninguna operaci贸n de reemplazo de cadenas ni expresiones regulares. Sin embargo, puedes configurar par谩metros de redirecci贸n de URL que afectan su comportamiento de coincidencia de URL y su comportamiento en tiempo de ejecuci贸n.
{% endhint %}

* [ ] Verifica que las **expresiones** y **requisitos** para las redirecciones **tengan sentido**.
* [ ] Verifica tambi茅n si hay **puntos finales ocultos sensibles** que contengan informaci贸n interesante.

## Notificaciones

* [ ] Verifica las **notificaciones**. Estas notificaciones se recomiendan para la seguridad:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Verifica todos los **destinos**, ya que puede haber **informaci贸n sensible** (autenticaci贸n b谩sica HTTP) en las URL de webhook. Aseg煤rate tambi茅n de que las URL de webhook usen **HTTPS**.
* [ ] Como verificaci贸n adicional, podr铆as intentar **suplantar una notificaci贸n de Cloudflare** a un tercero, tal vez puedas **inyectar algo peligroso** de alguna manera.
## Administrar cuenta

* [ ] Es posible ver los **煤ltimos 4 d铆gitos de la tarjeta de cr茅dito**, la **fecha de vencimiento** y la **direcci贸n de facturaci贸n** en **`Facturaci贸n` -> `Informaci贸n de pago`**.
* [ ] Es posible ver el **tipo de plan** utilizado en la cuenta en **`Facturaci贸n` -> `Suscripciones`**.
* [ ] En **`Miembros`** es posible ver todos los miembros de la cuenta y su **rol**. Tenga en cuenta que si el tipo de plan no es Enterprise, solo existen 2 roles: Administrador y Superadministrador. Pero si se utiliza un **plan Enterprise**, se pueden utilizar [**m谩s roles**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) para seguir el principio de privilegio m铆nimo.
* Por lo tanto, siempre que sea posible, se **recomienda** utilizar el **plan Enterprise**.
* [ ] En Miembros es posible verificar qu茅 **miembros** tienen habilitada la **autenticaci贸n de dos factores (2FA)**. **Todos** los usuarios deber铆an tenerla habilitada.

{% hint style="info" %}
Tenga en cuenta que afortunadamente el rol **`Administrador`** no otorga permisos para administrar membres铆as (**no puede aumentar privilegios ni invitar** nuevos miembros).
{% endhint %}

## Investigaci贸n de DDoS

[Ver esta parte](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, 隆consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PR a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
