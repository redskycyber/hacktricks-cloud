# BezpieczeÅ„stwo Cloudflare

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

W koncie Cloudflare moÅ¼na skonfigurowaÄ‡ pewne **ogÃ³lne ustawienia i usÅ‚ugi**. Na tej stronie zamierzamy **analizowaÄ‡ ustawienia zwiÄ…zane z bezpieczeÅ„stwem w kaÅ¼dej sekcji:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Strony internetowe

Przejrzyj kaÅ¼dÄ… z:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Rejestracja domen

* [ ] W **`Transfer Domains`** sprawdÅº, czy nie moÅ¼na przenieÅ›Ä‡ Å¼adnej domeny.

Przejrzyj kaÅ¼dÄ… z:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analizy

_Nie znalazÅ‚em niczego, co moÅ¼na by sprawdziÄ‡ pod kÄ…tem bezpieczeÅ„stwa konfiguracji._

## Strony

Na kaÅ¼dej stronie Cloudflare:

* [ ] SprawdÅº, czy nie ma **informacji poufnych** w **`Build log`**.
* [ ] SprawdÅº, czy nie ma **informacji poufnych** w repozytorium **Github** przypisanym do stron.
* [ ] SprawdÅº, czy nie ma potencjalnego naruszenia repozytorium Github poprzez **wstrzykniÄ™cie poleceÅ„ do workflow** lub naruszenie `pull_request_target`. WiÄ™cej informacji na stronie [**BezpieczeÅ„stwo Githuba**](../github-security/).
* [ ] SprawdÅº, czy nie ma **podatnych funkcji** w katalogu `/fuctions` (jeÅ›li istniejÄ…), sprawdÅº **przekierowania** w pliku `_redirects` (jeÅ›li istniejÄ…) i **Åºle skonfigurowane nagÅ‚Ã³wki** w pliku `_headers` (jeÅ›li istniejÄ…).
* [ ] SprawdÅº **podatnoÅ›ci** na **stronie internetowej** za pomocÄ… **blackbox** lub **whitebox**, jeÅ›li masz **dostÄ™p do kodu**
* [ ] W szczegÃ³Å‚ach kaÅ¼dej strony `/<page_id>/pages/view/blocklist/settings/functions`. SprawdÅº, czy nie ma **informacji poufnych** w **`Zmiennych Å›rodowiskowych`**.
* [ ] Na stronie szczegÃ³Å‚Ã³w sprawdÅº rÃ³wnieÅ¼ **polecenie budowy** i **katalog gÅ‚Ã³wny** w celu **potencjalnych wstrzykniÄ™Ä‡** w celu naruszenia strony.

## **Workers**

Na kaÅ¼dym workerze Cloudflare sprawdÅº:

* [ ] Wyzwalacze: Co powoduje uruchomienie workera? Czy **uÅ¼ytkownik moÅ¼e wysÅ‚aÄ‡ dane**, ktÃ³re zostanÄ… **uÅ¼yte** przez workera?
* [ ] W **`Ustawieniach`**, sprawdÅº **`Zmienne`** zawierajÄ…ce **informacje poufne**
* SprawdÅº kod workera i poszukaj **podatnoÅ›ci** (szczegÃ³lnie w miejscach, gdzie uÅ¼ytkownik moÅ¼e zarzÄ…dzaÄ‡ wejÅ›ciem)
* SprawdÅº SSRF zwracajÄ…ce wskazanÄ… stronÄ™, ktÃ³rÄ… moÅ¼esz kontrolowaÄ‡
* SprawdÅº XSS wykonujÄ…ce JS wewnÄ…trz obrazu svg

{% hint style="warning" %}
ZauwaÅ¼, Å¼e domyÅ›lnie **Workerowi przypisany jest adres URL** taki jak `<nazwa-workera>.<konto>.workers.dev`. UÅ¼ytkownik moÅ¼e ustawiÄ‡ go na **subdomenÄ™**, ale zawsze moÅ¼esz uzyskaÄ‡ do niego dostÄ™p za pomocÄ… tego **oryginalnego adresu URL**, jeÅ›li go znasz.
{% endhint %}

## R2

TODO

## Stream

TODO

## Obrazy

TODO

## Centrum bezpieczeÅ„stwa

* [ ] JeÅ›li to moÅ¼liwe, uruchom **`Skanowanie Security Insights`** i **`Infrastruktura`**, poniewaÅ¼ ujawniÄ… ciekawe informacje zwiÄ…zane z bezpieczeÅ„stwem.
* [ ] Po prostu **sprawdÅº te informacje** pod kÄ…tem bÅ‚Ä™dÃ³w konfiguracji bezpieczeÅ„stwa i ciekawych informacji

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Przekierowania masowe

{% hint style="info" %}
W przeciwieÅ„stwie do [PrzekierowaÅ„ dynamicznych](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Przekierowania masowe**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) sÄ… w zasadzie statyczne â€” **nie obsÅ‚ugujÄ… Å¼adnych operacji zastÄ™powania ciÄ…gÃ³w** ani wyraÅ¼eÅ„ regularnych. MoÅ¼esz jednak skonfigurowaÄ‡ parametry przekierowania URL, ktÃ³re wpÅ‚ywajÄ… na ich zachowanie podczas dopasowywania adresÃ³w URL i ich dziaÅ‚ania w czasie wykonania.
{% endhint %}

* [ ] SprawdÅº, czy **wyraÅ¼enia** i **wymagania** dla przekierowaÅ„ **sÄ… sensowne**.
* [ ] SprawdÅº rÃ³wnieÅ¼ **informacje poufne ukryte w koÅ„cÃ³wkach**, ktÃ³re zawierajÄ… interesujÄ…ce informacje.

## Powiadomienia

* [ ] SprawdÅº **powiadomienia**. Te powiadomienia sÄ… zalecane dla bezpieczeÅ„stwa:
* `Fakturowanie oparte na uÅ¼yciu`
* `Alert ataku DDoS HTTP`
* `Alert ataku DDoS warstwy 3/4`
* `Zaawansowany alert ataku DDoS HTTP`
* `Zaawansowany alert ataku DDoS warstwy 3/4`
* `Monitorowanie oparte na przepÅ‚ywie: Atak objÄ™toÅ›ciowy`
* `Alert wykrywania wycieku trasy`
* `Alert wygaÅ›niÄ™cia certyfikatu dostÄ™pu mTLS`
* `Alert niestandardowych nazw hostÃ³w SSL dla SaaS`
* `Alert Uniwersalnego SSL`
* `Alert wykrywania nowej zmiany kodu monitora skryptÃ³w`
* `Alert wykrywania nowej domeny monitora skryptÃ³w`
* `Alert wykrywania nowej zÅ‚oÅ›liwej domeny monitora skryptÃ³w`
* `Alert wykrywania nowego zÅ‚oÅ›liwego skryptu monitora skryptÃ³w`
* `Alert wykrywania nowego zÅ‚oÅ›liwego adresu URL monitora skryptÃ³w`
* `Alert wykrywania nowych skryptÃ³w monitora skryptÃ³w`
* `Alert wykrywania nowego skryptu monitora skryptÃ³w przekraczajÄ…cego maksymalnÄ… dÅ‚ugoÅ›Ä‡ adresu URL`
* `Zaawansowane zdarzenia bezpieczeÅ„stwa`
* `Alerty zdarzeÅ„ bezpieczeÅ„stwa`
* [ ] SprawdÅº wszystkie **destynacje**, poniewaÅ¼ mogÄ… zawieraÄ‡ **informacje poufne** (podstawowa autoryzacja http) w adresach URL webhookÃ³w. Upewnij siÄ™ rÃ³wnieÅ¼, Å¼e adresy URL webhookÃ³w uÅ¼ywajÄ… protokoÅ‚u **HTTPS**
* [ ] Dodatkowo, moÅ¼esz sprÃ³bowaÄ‡ **podrobiÄ‡ powiadomienie Cloudflare** do strony trzeciej, byÄ‡ moÅ¼e w jakiÅ› sposÃ³b **wstrzykniesz coÅ› niebezpiecznego**

## ZarzÄ…dzaj kontem

* [ ] MoÅ¼na zobaczyÄ‡ **ostatnie 4 cyfry karty kredytowej**, **termin waÅ¼noÅ›ci** i **adres rozliczeniowy** w **`Rozliczenia` -> `Informacje o pÅ‚atnoÅ›ci`**.
* [ ] MoÅ¼na zobaczyÄ‡ rodzaj **planu** uÅ¼ywanego w koncie w **`Rozliczenia` -> `Subskrypcje`**.
* [ ] W **`CzÅ‚onkowie`** moÅ¼na zobaczyÄ‡ wszystkich czÅ‚onkÃ³w konta i ich **rolÄ™**. ZauwaÅ¼, Å¼e jeÅ›li rodzaj planu nie jest Enterprise, istniejÄ… tylko 2 role: Administrator i Super Administrator. Ale jeÅ›li uÅ¼ywany jest **plan Enterprise**, moÅ¼na uÅ¼yÄ‡ [**wiÄ™cej rÃ³l**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) zgodnie z zasadÄ… najmniejszych uprawnieÅ„.
* Dlatego zaleca siÄ™ **korzystanie z planu Enterprise**, gdy tylko to moÅ¼liwe.
* [ ] W CzÅ‚onkach moÅ¼na sprawdziÄ‡, ktÃ³rzy **czÅ‚onkowie** majÄ… wÅ‚Ä…czone **2FA**. **KaÅ¼dy** uÅ¼ytkownik powinien mieÄ‡ to wÅ‚Ä…czone.

{% hint style="info" %}
ZauwaÅ¼, Å¼e rola **`Administrator`** nie daje uprawnieÅ„ do zarzÄ…dzania czÅ‚onkostwem (**nie moÅ¼e eskalowaÄ‡ uprawnieÅ„ ani zapraszaÄ‡** nowych czÅ‚onkÃ³w)
{% endhint %}
## Åšledztwo w sprawie ataku DDoS

[SprawdÅº tÄ™ czÄ™Å›Ä‡](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>Zacznij od zera i staÅ„ siÄ™ ekspertem od hakowania AWS dziÄ™ki</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>
