# Seguridad de Cloudflare

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de Github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

En una cuenta de Cloudflare hay algunas **configuraciones y servicios generales** que se pueden configurar. En esta p谩gina vamos a **analizar las configuraciones relacionadas con la seguridad de cada secci贸n:**

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## Sitios web

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Registro de dominios

* [ ] En **`Transferir dominios`** comprueba que no sea posible transferir ning煤n dominio.

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## An谩lisis

_No pude encontrar nada para revisar en una revisi贸n de seguridad de configuraci贸n._

## P谩ginas

En cada p谩gina de Cloudflare:

* [ ] Comprueba si hay **informaci贸n sensible** en el **`Registro de compilaci贸n`**.
* [ ] Comprueba si hay **informaci贸n sensible** en el **repositorio de Github** asignado a las p谩ginas.
* [ ] Comprueba si hay una posible **compromiso del repositorio de Github** a trav茅s de la **inyecci贸n de comandos de flujo de trabajo** o el compromiso de **`pull_request_target`**. M谩s informaci贸n en la [**p谩gina de seguridad de Github**](../github-security/).
* [ ] Comprueba si hay **funciones vulnerables** en el directorio `/fuctions` (si lo hay), comprueba las **redirecciones** en el archivo `_redirects` (si lo hay) y las **cabeceras mal configuradas** en el archivo `_headers` (si lo hay).
* [ ] Comprueba si hay **vulnerabilidades** en la **p谩gina web** a trav茅s de **blackbox** o **whitebox** si puedes **acceder al c贸digo**.
* [ ] En los detalles de cada p谩gina \*\*\*\* `/<page_id>/pages/view/blocklist/settings/functions`. Comprueba si hay **informaci贸n sensible** en las **`Variables de entorno`**.
* [ ] En la p谩gina de detalles, comprueba tambi茅n el **comando de compilaci贸n** y el **directorio ra铆z** para **posibles inyecciones** para comprometer la p谩gina.

## **Workers**

En cada worker de Cloudflare, comprueba:

* [ ] Los desencadenantes: 驴Qu茅 hace que el trabajador se active? 驴Puede un **usuario enviar datos** que ser谩n **utilizados** por el trabajador?
* [ ] En **`Configuraci贸n`**, comprueba si hay **`Variables`** que contengan **informaci贸n sensible**.
* [ ] Comprueba el **c贸digo del trabajador** y busca **vulnerabilidades** (especialmente en lugares donde el usuario puede gestionar la entrada).
  * Comprueba si hay SSRFs que devuelvan la p谩gina indicada que puedes controlar.
  * Comprueba si hay XSSs que ejecuten JS dentro de una imagen svg.

{% hint style="warning" %}
Ten en cuenta que por defecto se le da a un **Worker una URL** como `<worker-name>.<account>.workers.dev`. El usuario puede establecerlo en un **subdominio**, pero siempre puedes acceder a 茅l con esa **URL original** si la conoces.
{% endhint %}

## R2

POR HACER

## Stream

POR HACER

## Im谩genes

POR HACER

## Centro de seguridad

* [ ] Si es posible, ejecuta un **an谩lisis de `Security Insights`** y un **an谩lisis de `Infraestructura`**, ya que **destacar谩n** informaci贸n interesante en cuanto a **seguridad**.
  * [ ] Solo **comprueba esta informaci贸n** para las configuraciones de seguridad y la informaci贸n interesante.

## Turnstile

POR HACER

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Redirecciones masivas

{% hint style="info" %}
A diferencia de las [Redirecciones din谩micas](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Redirecciones masivas**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) son esencialmente est谩ticas, no admiten ninguna operaci贸n de **reemplazo de cadena** ni expresiones regulares. Sin embargo, puede configurar par谩metros de redireccionamiento de URL que afectan su comportamiento de coincidencia de URL y su comportamiento en tiempo de ejecuci贸n.
{% endhint %}

* [ ] Comprueba que las **expresiones** y los **requisitos** para las redirecciones **tengan sentido**.
* [ ] Comprueba tambi茅n si hay **puntos finales ocultos sensibles** que contengan informaci贸n interesante.

## Notificaciones

* [ ] Comprueba las **notificaciones**. Estas notificaciones son recomendadas para la seguridad:
  * `Facturaci贸n basada en el uso`
  * `Alerta de ataque HTTP DDoS`
  * `Alerta de ataque de capa 3/4 DDoS`
  * `Alerta de ataque HTTP DDoS avanzado`
  * `Alerta de ataque de capa 3/4 DDoS avanzado`
  * `Monitorizaci贸n basada en el flujo: Ataque volum茅trico`
  * `Alerta de detecci贸n de fuga de ruta`
  * `Alerta de caducidad del certificado mTLS de acceso`
  * `Alerta de nombres de host personalizados SSL para SaaS`
  * `Alerta de SSL universal`
  * `Alerta de detecci贸n de cambio de c贸digo nuevo del monitor de scripts`
  * `Alerta de nuevo dominio del monitor de scripts`
  * `Alerta de nuevo dominio malicioso del monitor de scripts`
  * `Alerta de nuevo script malicioso del monitor de scripts`
  * `Alerta de nueva URL maliciosa del monitor de scripts`
  * `Alerta de nuevos scripts del monitor de scripts`
  * `Alerta de nuevo script que excede la longitud m谩xima de URL del monitor de scripts`
  * `Alerta de eventos de seguridad avanzados`
  * `Alerta de eventos de seguridad`
* [ ] Comprueba todos los **destinos**, ya que puede haber **informaci贸n sensible** (autenticaci贸n b谩sica http) en las URL de webhook. Aseg煤rate tambi茅n de que las URL de webhook usen **HTTPS**.
  * [ ] Como comprobaci贸n adicional, podr铆as intentar **suplantar una notificaci贸n de Cloudflare** a un tercero, tal vez puedas **inyectar algo peligroso**.

## Administrar cuenta

* [ ] Es posible ver los **煤ltimos 4 d铆gitos de la tarjeta de cr茅dito**, la **fecha de caducidad** y la **direcci贸n de facturaci贸n** en **`Facturaci贸n` -> `Informaci贸n de pago`**.
* [ ] Es posible ver el **tipo de plan