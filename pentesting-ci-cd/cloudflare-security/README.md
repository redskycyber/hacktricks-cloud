# Cloudflare安全

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

在Cloudflare账户中，有一些**通用设置和服务**可以配置。在本页面中，我们将**分析每个部分与安全相关的设置**：

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## 网站

通过以下内容进行审查：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### 域名注册

* [ ] 在**`转移域名`**中检查是否无法转移任何域名。

通过以下内容进行审查：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## 分析

_我找不到任何需要检查的配置安全性的内容。_

## 页面

在每个Cloudflare页面上：

* [ ] 检查**`构建日志`**中是否存在**敏感信息**。
* [ ] 检查分配给页面的**Github存储库**中是否存在**敏感信息**。
* [ ] 检查通过**工作流命令注入**或`pull_request_target`妥协可能导致的**潜在Github存储库妥协**。更多信息请参阅[**Github安全页面**](../github-security/)。
* [ ] 检查`/fuctions`目录（如果有）中的**易受攻击功能**，检查`_redirects`文件（如果有）中的**重定向**以及`_headers`文件（如果有）中的**配置错误的标头**。
* [ ] 如果可以**访问代码**，通过**黑盒**或**白盒**方式检查**网页**中的**漏洞**。
* [ ] 在每个页面的详细信息`/<page_id>/pages/view/blocklist/settings/functions`中，检查**`环境变量`**中是否存在**敏感信息**。
* [ ] 在详细页面中还要检查**构建命令**和**根目录**，以查看是否存在**潜在注入**以妥协页面。

## **工作者**

在每个Cloudflare的工作者中检查：

* [ ] 触发器：是什么触发了工作者？用户是否可以发送数据，然后工作者会使用这些数据？
* [ ] 在**`设置`**中，检查是否包含**敏感信息**的**`变量`**。
* [ ] 检查工作者的**代码**，并搜索**漏洞**（特别是用户可以管理输入的地方）
* 检查返回您可以控制的指定页面的SSRF
* 检查执行JS的XSS是否在svg图像中

{% hint style="warning" %}
请注意，默认情况下，**工作者**会被分配一个URL，例如 `<worker-name>.<account>.workers.dev`。用户可以将其设置为**子域**，但如果您知道，您始终可以使用**原始URL**访问它。
{% endhint %}

## R2

待办事项

## 流

待办事项

## 图像

待办事项

## 安全中心

* [ ] 如果可能，运行**`安全洞察`** **扫描**和**`基础设施`** **扫描**，因为它们将从安全角度**突出显示**有趣的信息。
* [ ] 仅出于安全考虑，检查此信息以查找安全配置错误和有趣的信息

## 转门

待办事项

## **零信任**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## 批量重定向

{% hint style="info" %}
与[动态重定向](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/)不同，[**批量重定向**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/)基本上是静态的 —— 它们**不支持任何字符串替换**操作或正则表达式。但是，您可以配置影响它们的URL匹配行为和运行时行为的URL重定向参数。
{% endhint %}

* [ ] 检查重定向的**表达式**和**要求**是否**合理**。
* [ ] 还要检查是否包含**敏感隐藏端点**，其中包含有趣的信息。

## 通知

* [ ] 检查**通知**。这些通知对安全性有建议：
* `基于使用量计费`
* `HTTP DDoS攻击警报`
* `第3/4层DDoS攻击警报`
* `高级HTTP DDoS攻击警报`
* `高级第3/4层DDoS攻击警报`
* `基于流量的监控：体积攻击`
* `路由泄漏检测警报`
* `访问mTLS证书到期警报`
* `用于SaaS自定义主机名的SSL警报`
* `通用SSL警报`
* `脚本监视器新代码更改检测警报`
* `脚本监视器新域名警报`
* `脚本监视器新恶意域名警报`
* `脚本监视器新恶意脚本警报`
* `脚本监视器新恶意URL警报`
* `脚本监视器新脚本警报`
* `脚本监视器新脚本超过最大URL长度警报`
* `高级安全事件警报`
* `安全事件警报`
* [ ] 检查所有**目的地**，因为Webhook URL中可能包含**敏感信息**（基本HTTP身份验证）。还要确保Webhook URL使用**HTTPS**。
* [ ] 作为额外检查，您可以尝试**冒充Cloudflare通知**发送给第三方，也许您可以以某种方式**注入危险内容**

## 管理账户

* [ ] 可以在**`账单` -> `付款信息`**中查看信用卡的**最后4位数字**、**到期时间**和**账单地址**。
* [ ] 可以在**`账单` -> `订阅`**中查看账户使用的**计划类型**。
* * [ ] 在**`成员`**中，可以查看账户的所有成员及其**角色**。请注意，如果计划类型不是企业，只有两种角色存在：管理员和超级管理员。但如果使用的**计划是企业**，则可以使用[**更多角色**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/)来遵循最小特权原则。
* 因此，尽可能使用**企业计划**是**推荐的**。
* [ ] 在成员中，可以查看哪些**成员**已启用**双因素认证**。**每个**用户都应该启用它。

{% hint style="info" %}
幸运的是，角色**`管理员`**不具备管理成员的权限（**无法升级权限或邀请**新成员）
{% endhint %}
## DDoS Investigation

[查看此部分](cloudflare-domains.md#cloudflare-ddos-protection)。
