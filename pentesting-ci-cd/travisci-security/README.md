# Seguridad de TravisCI

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si deseas ver a tu **empresa anunciada en HackTricks** o si deseas acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, 隆consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## 驴Qu茅 es TravisCI?

**Travis CI** es un servicio de **integraci贸n continua** alojado o en las instalaciones utilizado para construir y probar proyectos de software alojados en varias **plataformas git diferentes**.

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## Ataques

### Disparadores

Para lanzar un ataque, primero necesitas saber c贸mo activar una compilaci贸n. Por defecto, TravisCI **activar谩 una compilaci贸n en los empujes y solicitudes de extracci贸n**:

![](<../../.gitbook/assets/image (19) (1).png>)

#### Trabajos Cron

Si tienes acceso a la aplicaci贸n web, puedes **establecer trabajos cron para ejecutar la compilaci贸n**, esto podr铆a ser 煤til para la persistencia o para activar una compilaci贸n:

![](<../../.gitbook/assets/image (42).png>)

{% hint style="info" %}
Parece que no es posible establecer trabajos cron dentro de `.travis.yml` seg煤n [esto](https://github.com/travis-ci/travis-ci/issues/9162).
{% endhint %}

### PR de terceros

TravisCI, por defecto, desactiva el intercambio de variables de entorno con las solicitudes de extracci贸n de terceros, pero alguien podr铆a habilitarlo y luego podr铆as crear solicitudes de extracci贸n al repositorio y exfiltrar los secretos:

![](<../../.gitbook/assets/image (1) (1) (1) (1).png>)

### Volcado de secretos

Como se explica en la p谩gina de [**informaci贸n b谩sica**](basic-travisci-information.md), hay 2 tipos de secretos. Los **secretos de variables de entorno** (que se enumeran en la p谩gina web) y los **secretos cifrados personalizados**, que se almacenan dentro del archivo `.travis.yml` como base64 (ten en cuenta que tanto los almacenados cifrados como los almacenados como variables de entorno aparecer谩n como variables de entorno en las m谩quinas finales).

* Para **enumerar secretos** configurados como **variables de entorno**, ve a la **configuraci贸n** del **proyecto** y comprueba la lista. Sin embargo, ten en cuenta que todas las variables de entorno del proyecto establecidas aqu铆 aparecer谩n al activar una compilaci贸n.
* Para enumerar los **secretos cifrados personalizados**, lo mejor que puedes hacer es **comprobar el archivo `.travis.yml`**.
* Para **enumerar archivos cifrados**, puedes buscar **archivos `.enc`** en el repositorio, l铆neas similares a `openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d` en el archivo de configuraci贸n, o para **iv y claves cifradas** en las **variables de entorno**, como:

![](<../../.gitbook/assets/image (23).png>)

### TODO:

* Ejemplo de compilaci贸n con shell inverso en Windows/Mac/Linux
* Ejemplo de compilaci贸n que filtra la base64 de la variable de entorno en los registros

### TravisCI Enterprise

Si un atacante termina en un entorno que utiliza **TravisCI Enterprise** (m谩s informaci贸n sobre lo que es esto en la [**informaci贸n b谩sica**](basic-travisci-information.md#travisci-enterprise)), podr谩 **activar compilaciones en el trabajador**. Esto significa que un atacante podr谩 moverse lateralmente a ese servidor desde el cual podr铆a ser capaz de:

* 驴escapar al host?
* 驴comprometer kubernetes?
* 驴comprometer otras m谩quinas que se ejecutan en la misma red?
* 驴comprometer nuevas credenciales en la nube?

## Referencias

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si deseas ver a tu **empresa anunciada en HackTricks** o si deseas acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, 隆consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>