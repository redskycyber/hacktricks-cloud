# Bezbednost Supabase-a

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Prema njihovoj [**poÄetnoj stranici**](https://supabase.com/): Supabase je open source alternativa za Firebase. PoÄnite svoj projekat sa Postgres bazom podataka, Autentikacijom, instant API-jima, Edge funkcijama, Realtime pretplatom, SkladiÅ¡tem i Vektorskim ugneÅ¾Ä‘ivanjem.

### Poddomen

U osnovi, kada se projekat kreira, korisnik Ä‡e dobiti supabase.co poddomen poput: **`jnanozjdybtpqgcwhdiz.supabase.co`**

## **Konfiguracija baze podataka**

{% hint style="success" %}
**Ovim podacima se moÅ¾e pristupiti preko linka poput `https://supabase.com/dashboard/project/<project-id>/settings/database`**
{% endhint %}

Ova **baza podataka** Ä‡e biti implementirana u nekoj AWS regiji, i kako bi se povezali sa njom, moguÄ‡e je to uÄiniti povezivanjem na: `postgres://postgres.jnanozjdybtpqgcwhdiz:[VAÅ A-LOZINKA]@aws-0-us-west-1.pooler.supabase.com:5432/postgres` (ovo je kreirano u us-west-1).\
Lozinka je **lozinka koju je korisnik unio** ranije.

Stoga, poÅ¡to je poddomen poznat i koristi se kao korisniÄko ime, a AWS regioni su ograniÄeni, moguÄ‡e je pokuÅ¡ati **bruteforce napad na lozinku**.

Ova sekcija takoÄ‘e sadrÅ¾i opcije za:

* Resetovanje lozinke baze podataka
* Konfigurisanje poolinga konekcija
* Konfigurisanje SSL-a: Odbijanje plain-text konekcija (podrazumevano su omoguÄ‡ene)
* Konfigurisanje veliÄine diska
* Primena mreÅ¾nih restrikcija i zabrana

## Konfiguracija API-ja

{% hint style="success" %}
**Ovim podacima se moÅ¾e pristupiti preko linka poput `https://supabase.com/dashboard/project/<project-id>/settings/api`**
{% endhint %}

URL za pristup supabase API-ju u vaÅ¡em projektu Ä‡e biti: `https://jnanozjdybtpqgcwhdiz.supabase.co`.

### anon API kljuÄevi

TakoÄ‘e Ä‡e generisati **anon API kljuÄ** (`role: "anon"`), poput: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk` koji Ä‡e aplikacija morati koristiti kako bi kontaktirala API kljuÄ izloÅ¾en u naÅ¡em primeru u&#x20;

MoguÄ‡e je pronaÄ‡i API REST za kontaktiranje ovog API-ja u [**dokumentaciji**](https://supabase.com/docs/reference/self-hosting-auth/returns-the-configuration-settings-for-the-gotrue-server), ali najinteresantniji endpointovi bi bili:

<details>

<summary>Registracija (/auth/v1/signup)</summary>
```
POST /auth/v1/signup HTTP/2
Host: id.io.net
Content-Length: 90
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

<details>

<summary>Prijavljivanje (/auth/v1/token?grant_type=password)</summary>
```
POST /auth/v1/token?grant_type=password HTTP/2
Host: hypzbtgspjkludjcnjxl.supabase.co
Content-Length: 80
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

Dakle, kada otkrijete klijenta koji koristi supabase sa poddomenom koji im je odobren (moguÄ‡e je da poddomen kompanije ima CNAME preko njihovog supabase poddomena), moÅ¾ete pokuÅ¡ati **kreirati novi nalog na platformi koristeÄ‡i supabase API**.

### tajni / service\_role API kljuÄevi

TakoÄ‘e Ä‡e biti generisan tajni API kljuÄ sa **`role: "service_role"`**. Ovaj API kljuÄ treba da bude tajan jer Ä‡e moÄ‡i da zaobiÄ‘e **Row Level Security**.

API kljuÄ izgleda ovako: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcxNDk5MjcxOSwiZXhwIjoyMDMwNTY4NzE5fQ.0a8fHGp3N_GiPq0y0dwfs06ywd-zhTwsm486Tha7354`

### JWT Tajna

TakoÄ‘e Ä‡e biti generisana **JWT Tajna** kako bi aplikacija mogla **kreirati i potpisati prilagoÄ‘ene JWT tokene**.

## Autentikacija

### Registracije

{% hint style="success" %}
**Podrazumevano**, supabase Ä‡e dozvoliti **novim korisnicima da kreiraju naloge** na vaÅ¡em projektu koriÅ¡Ä‡enjem prethodno pomenutih API endpointova.
{% endhint %}

MeÄ‘utim, ovi novi nalozi, podrazumevano, **Ä‡e morati da potvrde svoju email adresu** kako bi mogli da se prijave na nalog. MoguÄ‡e je omoguÄ‡iti **"Dozvoli anonimne prijave"** kako bi se omoguÄ‡ilo ljudima da se prijave bez provere njihove email adrese. To bi moglo omoguÄ‡iti pristup **neoÄekivanim podacima** (oni dobijaju uloge `public` i `authenticated`).\
Ovo je veoma loÅ¡a ideja jer supabase naplaÄ‡uje po aktivnom korisniku pa ljudi mogu kreirati korisnike, prijaviti se i supabase Ä‡e naplatiti za njih:

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

### Lozinke i sesije

MoguÄ‡e je naznaÄiti minimalnu duÅ¾inu lozinke (podrazumevano), zahteve (ne podrazumevano) i zabraniti koriÅ¡Ä‡enje procurelih lozinki.\
PreporuÄuje se **unapreÄ‘enje zahteva jer su podrazumevani slabi**.

* KorisniÄke Sesije: MoguÄ‡e je konfigurisati kako korisniÄke sesije funkcioniÅ¡u (istek vremena, 1 sesija po korisniku...)
* ZaÅ¡tita od Botova i Zloupotreba: MoguÄ‡e je omoguÄ‡iti Captcha.

### SMTP Postavke

MoguÄ‡e je postaviti SMTP za slanje emailova.

### Napredne Postavke

* Postavite vreme isteka pristupnih tokena (3600 podrazumevano)
* Postavite da detektujete i opozovete potencijalno kompromitovane osveÅ¾avajuÄ‡e tokene i vreme isteka
* MFA: NaznaÄite koliko MFA faktora moÅ¾e biti upisano odjednom po korisniku (10 podrazumevano)
* Maksimalne Direktne Baze Podataka: Maksimalan broj konekcija koriÅ¡Ä‡en za autentifikaciju (10 podrazumevano)
* Maksimalno Trajanje Zahteva: Maksimalno vreme dozvoljeno za zahtev za autentifikaciju (10s podrazumevano)

## SkladiÅ¡tenje

{% hint style="success" %}
Supabase omoguÄ‡ava **skladiÅ¡tenje fajlova** i Äini ih dostupnim preko URL-a (koristi S3 kofe).
{% endhint %}

* Postavite ograniÄenje veliÄine fajla za otpremanje (podrazumevano je 50MB)
* Veza sa S3 je data sa URL-om kao: `https://jnanozjdybtpqgcwhdiz.supabase.co/storage/v1/s3`
* MoguÄ‡e je **zatraÅ¾iti S3 pristupne kljuÄeve** koji se sastoje od `ID pristupnog kljuÄa` (npr. `a37d96544d82ba90057e0e06131d0a7b`) i `tajni pristupni kljuÄ` (npr. `58420818223133077c2cec6712a4f909aec93b4daeedae205aa8e30d5a860628`)

## Edge Funkcije

MoguÄ‡e je **skladiÅ¡titi tajne informacije** u supabase-u koje Ä‡e biti **dostupne putem edge funkcija** (one se mogu kreirati i brisati sa veba, ali nije moguÄ‡e pristupiti njihovoj vrednosti direktno).
