# Supabase Sicherheit

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## Grundlegende Informationen

Gem√§√ü ihrer [**Startseite**](https://supabase.com/): Supabase ist eine Open-Source-Alternative zu Firebase. Starten Sie Ihr Projekt mit einer Postgres-Datenbank, Authentifizierung, sofortigen APIs, Edge Functions, Echtzeit-Abonnements, Speicher und Vektoreinbettungen.

### Subdom√§ne

Im Grunde erh√§lt der Benutzer bei der Erstellung eines Projekts eine Supabase.co-Subdom√§ne wie: **`jnanozjdybtpqgcwhdiz.supabase.co`**

## **Datenbankkonfiguration**

{% hint style="success" %}
**Diese Daten k√∂nnen √ºber einen Link wie `https://supabase.com/dashboard/project/<project-id>/settings/database` abgerufen werden**
{% endhint %}

Diese **Datenbank** wird in einer AWS-Region bereitgestellt, und um eine Verbindung dazu herzustellen, w√§re es m√∂glich, dies √ºber die Verbindung zu tun: `postgres://postgres.jnanozjdybtpqgcwhdiz:[DEIN PASSWORT]@aws-0-us-west-1.pooler.supabase.com:5432/postgres` (dies wurde in us-west-1 erstellt).\
Das Passwort ist ein **Passwort, das der Benutzer zuvor eingegeben hat**.

Daher, da die Subdom√§ne bekannt ist und als Benutzername verwendet wird und die AWS-Regionen begrenzt sind, k√∂nnte es m√∂glich sein, zu versuchen, das Passwort **brute forcen**.

Dieser Abschnitt enth√§lt auch Optionen zum:

* Zur√ºcksetzen des Datenbankpassworts
* Konfigurieren des Verbindungspoolings
* Konfigurieren von SSL: Ablehnen von Klartextverbindungen (standardm√§√üig aktiviert)
* Konfigurieren der Festplattengr√∂√üe
* Anwenden von Netzwerkbeschr√§nkungen und Sperren

## API-Konfiguration

{% hint style="success" %}
**Diese Daten k√∂nnen √ºber einen Link wie `https://supabase.com/dashboard/project/<project-id>/settings/api` abgerufen werden**
{% endhint %}

Die URL zum Zugriff auf die Supabase-API in Ihrem Projekt wird wie folgt aussehen: `https://jnanozjdybtpqgcwhdiz.supabase.co`.

### Anonyme API-Schl√ºssel

Es wird auch einen **anon API-Schl√ºssel** generieren (`Rolle: "anon"`), wie z.B.: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk`, den die Anwendung verwenden muss, um den in unserem Beispiel freigegebenen API-Schl√ºssel zu kontaktieren.

Es ist m√∂glich, die API-REST zu finden, um diese API in den [**Dokumenten**](https://supabase.com/docs/reference/self-hosting-auth/returns-the-configuration-settings-for-the-gotrue-server) zu kontaktieren, aber die interessantesten Endpunkte w√§ren: 

<details>

<summary>Registrierung (/auth/v1/signup)</summary>
```
POST /auth/v1/signup HTTP/2
Host: id.io.net
Content-Length: 90
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

<details>

<summary>Anmeldung (/auth/v1/token?grant_type=password)</summary>
```
POST /auth/v1/token?grant_type=password HTTP/2
Host: hypzbtgspjkludjcnjxl.supabase.co
Content-Length: 80
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

So, wann immer Sie einen Client entdecken, der Supabase mit dem ihm gew√§hrten Subdomain verwendet (es ist m√∂glich, dass eine Subdomain des Unternehmens √ºber ihrer Supabase-Subdomain ein CNAME hat), k√∂nnten Sie versuchen, **ein neues Konto in der Plattform √ºber die Supabase-API zu erstellen**.

### Geheime / service\_role API-Schl√ºssel

Ein geheimer API-Schl√ºssel wird auch mit **`role: "service_role"`** generiert. Dieser API-Schl√ºssel sollte geheim gehalten werden, da er in der Lage sein wird, die **Zeilen-Ebene-Sicherheit** zu umgehen.

Der API-Schl√ºssel sieht so aus: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcxNDk5MjcxOSwiZXhwIjoyMDMwNTY4NzE5fQ.0a8fHGp3N_GiPq0y0dwfs06ywd-zhTwsm486Tha7354`

### JWT Secret

Ein **JWT Secret** wird auch generiert, damit die Anwendung **benutzerdefinierte JWT-Token erstellen und signieren** kann.

## Authentifizierung

### Registrierungen

{% hint style="success" %}
Standardm√§√üig erlaubt Supabase **neuen Benutzern, Konten** in Ihrem Projekt zu erstellen, indem sie die zuvor genannten API-Endpunkte verwenden.
{% endhint %}

Diese neuen Konten m√ºssen jedoch standardm√§√üig **ihre E-Mail-Adresse validieren**, um sich in das Konto einloggen zu k√∂nnen. Es ist m√∂glich, **"Anonyme Anmeldungen zulassen"** zu aktivieren, um Personen das Einloggen ohne √úberpr√ºfung ihrer E-Mail-Adresse zu erm√∂glichen. Dies k√∂nnte Zugriff auf **unerwartete Daten** gew√§hren (sie erhalten die Rollen `public` und `authenticated`).\
Dies ist eine sehr schlechte Idee, da Supabase pro aktiven Benutzer Geb√ºhren erhebt, sodass Personen Benutzer erstellen und sich einloggen k√∂nnten und Supabase f√ºr diese Geb√ºhren erheben w√ºrde:

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

### Passw√∂rter & Sitzungen

Es ist m√∂glich, die minimale Passwortl√§nge anzugeben (standardm√§√üig), Anforderungen (standardm√§√üig nicht) und das Verwenden von durchgesickerten Passw√∂rtern zu verbieten.\
Es wird empfohlen, die Anforderungen zu verbessern, da die Standardanforderungen schwach sind.

* Benutzersitzungen: Es ist m√∂glich zu konfigurieren, wie Benutzersitzungen funktionieren (Timeouts, 1 Sitzung pro Benutzer...)
* Bot- und Missbrauchsschutz: Es ist m√∂glich, Captcha zu aktivieren.

### SMTP-Einstellungen

Es ist m√∂glich, einen SMTP einzurichten, um E-Mails zu senden.

### Erweiterte Einstellungen

* Ablaufzeit f√ºr Zugriffstoken festlegen (standardm√§√üig 3600)
* Festlegen, um potenziell kompromittierte Auffrischungstoken zu erkennen und zu widerrufen und Timeout
* MFA: Angeben, wie viele MFA-Faktoren pro Benutzer gleichzeitig eingeschrieben werden k√∂nnen (standardm√§√üig 10)
* Maximale direkte Datenbankverbindungen: Maximale Anzahl von Verbindungen, die zur Authentifizierung verwendet werden (standardm√§√üig 10)
* Maximale Anforderungsdauer: Maximale Zeit, die f√ºr eine Authentifizierungsanforderung zul√§ssig ist (standardm√§√üig 10s)

## Speicher

{% hint style="success" %}
Supabase erlaubt es, **Dateien zu speichern** und √ºber eine URL darauf zuzugreifen (es verwendet S3-Buckets).
{% endhint %}

* Legen Sie das Upload-Dateigr√∂√üenlimit fest (Standardwert betr√§gt 50 MB)
* Die S3-Verbindung wird mit einer URL wie dieser bereitgestellt: `https://jnanozjdybtpqgcwhdiz.supabase.co/storage/v1/s3`
* Es ist m√∂glich, **S3-Zugriffsschl√ºssel** anzufordern, die aus einer `Zugriffsschl√ºssel-ID` (z. B. `a37d96544d82ba90057e0e06131d0a7b`) und einem `geheimen Zugriffsschl√ºssel` (z. B. `58420818223133077c2cec6712a4f909aec93b4daeedae205aa8e30d5a860628`) bestehen

## Edge-Funktionen

Es ist auch m√∂glich, **Geheimnisse** in Supabase zu speichern, die von Edge-Funktionen **zug√§nglich sind** (sie k√∂nnen √ºber das Web erstellt und gel√∂scht werden, aber es ist nicht m√∂glich, direkt auf ihren Wert zuzugreifen).
