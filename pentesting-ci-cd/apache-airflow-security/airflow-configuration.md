# Configuraci贸n de Airflow

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Archivo de Configuraci贸n

**Apache Airflow** genera un **archivo de configuraci贸n** en todas las m谩quinas de airflow llamado **`airflow.cfg`** en el home del usuario de airflow. Este archivo de configuraci贸n contiene informaci贸n importante y **puede contener informaci贸n sensible.**

**Hay dos maneras de acceder a este archivo: Comprometiendo alguna m谩quina de airflow, o accediendo a la consola web.**

Ten en cuenta que los **valores dentro del archivo de configuraci贸n** **pueden no ser los que se usan**, ya que puedes sobrescribirlos estableciendo variables de entorno como `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`.

Si tienes acceso al **archivo de configuraci贸n en el servidor web**, puedes verificar la **configuraci贸n real en ejecuci贸n** en la misma p谩gina donde se muestra la configuraci贸n.\
Si tienes **acceso a alguna m谩quina dentro del entorno de airflow**, revisa el **entorno**.

Algunos valores interesantes para revisar al leer el archivo de configuraci贸n:

### \[api]

* **`access_control_allow_headers`**: Esto indica los **encabezados permitidos** para **CORS**
* **`access_control_allow_methods`**: Esto indica los **m茅todos permitidos** para **CORS**
* **`access_control_allow_origins`**: Esto indica los **or铆genes permitidos** para **CORS**
* **`auth_backend`**: [**Seg煤n la documentaci贸n**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html) hay varias opciones disponibles para configurar qui茅n puede acceder a la API:
* `airflow.api.auth.backend.deny_all`: **Por defecto nadie** puede acceder a la API
* `airflow.api.auth.backend.default`: **Todos pueden** acceder sin autenticaci贸n
* `airflow.api.auth.backend.kerberos_auth`: Para configurar la **autenticaci贸n kerberos**
* `airflow.api.auth.backend.basic_auth`: Para **autenticaci贸n b谩sica**
* `airflow.composer.api.backend.composer_auth`: Usa la autenticaci贸n de composer (GCP) (desde [**aqu铆**](https://cloud.google.com/composer/docs/access-airflow-api)).
* `composer_auth_user_registration_role`: Esto indica el **rol** que el **usuario de composer** tendr谩 dentro de **airflow** (**Op** por defecto).
* Tambi茅n puedes **crear tu propio m茅todo de autenticaci贸n** con python.
* **`google_key_path`:** Ruta a la **clave de cuenta de servicio de GCP**

### **\[atlas]**

* **`password`**: Contrase帽a de Atlas
* **`username`**: Usuario de Atlas

### \[celery]

* **`flower_basic_auth`** : Credenciales (_usuario1:contrase帽a1,usuario2:contrase帽a2_)
* **`result_backend`**: URL de Postgres que puede contener **credenciales**.
* **`ssl_cacert`**: Ruta al cacert
* **`ssl_cert`**: Ruta al certificado
* **`ssl_key`**: Ruta a la clave

### \[core]

* **`dag_discovery_safe_mode`**: Habilitado por defecto. Al descubrir DAGs, ignora cualquier archivo que no contenga las cadenas `DAG` y `airflow`.
* **`fernet_key`**: Clave para almacenar variables cifradas (sim茅trica)
* **`hide_sensitive_var_conn_fields`**: Habilitado por defecto, oculta informaci贸n sensible de las conexiones.
* **`security`**: Qu茅 m贸dulo de seguridad usar (por ejemplo, kerberos)

### \[dask]

* **`tls_ca`**: Ruta al ca
* **`tls_cert`**: Ruta al certificado
* **`tls_key`**: Ruta a la clave tls

### \[kerberos]

* **`ccache`**: Ruta al archivo ccache
* **`forwardable`**: Habilitado por defecto

### \[logging]

* **`google_key_path`**: Ruta a las credenciales JSON de GCP.

### \[secrets]

* **`backend`**: Nombre completo de la clase del backend de secretos para habilitar
* **`backend_kwargs`**: El par谩metro backend_kwargs se carga en un diccionario y se pasa al **init** de la clase del backend de secretos.

### \[smtp]

* **`smtp_password`**: Contrase帽a SMTP
* **`smtp_user`**: Usuario SMTP

### \[webserver]

* **`cookie_samesite`**: Por defecto es **Lax**, por lo que ya es el valor m谩s d茅bil posible
* **`cookie_secure`**: Establece la **bandera segura** en la cookie de sesi贸n
* **`expose_config`**: Por defecto es Falso, si es verdadero, la **configuraci贸n** se puede **leer** desde la **consola web**
* **`expose_stacktrace`**: Por defecto es Verdadero, mostrar谩 **rastreos de python** (potencialmente 煤tiles para un atacante)
* **`secret_key`**: Esta es la **clave utilizada por flask para firmar las cookies** (si tienes esto puedes **suplantar a cualquier usuario en Airflow**)
* **`web_server_ssl_cert`**: **Ruta** al **certificado SSL**
* **`web_server_ssl_key`**: **Ruta** a la **Clave SSL**
* **`x_frame_enabled`**: Por defecto es **Verdadero**, por lo que por defecto el clickjacking no es posible

### Autenticaci贸n Web

Por defecto, la **autenticaci贸n web** se especifica en el archivo **`webserver_config.py`** y est谩 configurada como
```bash
AUTH_TYPE = AUTH_DB
```
Lo que significa que la **autenticaci贸n se verifica contra la base de datos**. Sin embargo, otras configuraciones son posibles como
```bash
AUTH_TYPE = AUTH_OAUTH
```
Para delegar la **autenticaci贸n a servicios de terceros**.

Sin embargo, tambi茅n existe la opci贸n de **permitir el acceso a usuarios an贸nimos**, estableciendo el siguiente par谩metro al **rol deseado**:
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
