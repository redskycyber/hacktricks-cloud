# Konfiguracja Airflow

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Plik konfiguracyjny

**Apache Airflow** generuje plik konfiguracyjny na wszystkich maszynach Airflow o nazwie **`airflow.cfg`** w katalogu domowym uÅ¼ytkownika Airflow. Plik konfiguracyjny zawiera informacje konfiguracyjne i **moÅ¼e zawieraÄ‡ interesujÄ…ce i wraÅ¼liwe informacje**.

**IstniejÄ… dwie metody dostÄ™pu do tego pliku: poprzez skompromitowanie jakiejÅ› maszyny Airflow lub uzyskanie dostÄ™pu do konsoli internetowej.**

NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e **wartoÅ›ci wewnÄ…trz pliku konfiguracyjnego** **mogÄ… nie byÄ‡ uÅ¼ywane**, poniewaÅ¼ moÅ¼na je nadpisaÄ‡, ustawiajÄ…c zmienne Å›rodowiskowe, takie jak `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`.

JeÅ›li masz dostÄ™p do **pliku konfiguracyjnego w serwerze internetowym**, moÅ¼esz sprawdziÄ‡ **rzeczywistÄ… konfiguracjÄ™ dziaÅ‚ajÄ…cÄ…** na tej samej stronie, na ktÃ³rej wyÅ›wietlana jest konfiguracja.\
JeÅ›li masz **dostÄ™p do jakiejÅ› maszyny w Å›rodowisku Airflow**, sprawdÅº **Å›rodowisko**.

NaleÅ¼y sprawdziÄ‡ niektÃ³re interesujÄ…ce wartoÅ›ci podczas czytania pliku konfiguracyjnego:

### \[api]

* **`access_control_allow_headers`**: Wskazuje **dozwolone nagÅ‚Ã³wki** dla **CORS**
* **`access_control_allow_methods`**: Wskazuje **dozwolone metody** dla **CORS**
* **`access_control_allow_origins`**: Wskazuje **dozwolone ÅºrÃ³dÅ‚a** dla **CORS**
* **`auth_backend`**: [**Zgodnie z dokumentacjÄ…**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html) istnieje kilka opcji konfiguracji dostÄ™pu do interfejsu API:
* `airflow.api.auth.backend.deny_all`: **DomyÅ›lnie nikt** nie ma dostÄ™pu do interfejsu API
* `airflow.api.auth.backend.default`: **KaÅ¼dy moÅ¼e** uzyskaÄ‡ do niego dostÄ™p bez uwierzytelniania
* `airflow.api.auth.backend.kerberos_auth`: Konfiguracja uwierzytelniania **kerberos**
* `airflow.api.auth.backend.basic_auth`: Uwierzytelnianie **podstawowe**
* `airflow.composer.api.backend.composer_auth`: UÅ¼ywa uwierzytelniania kompozytora (GCP) (od [**tutaj**](https://cloud.google.com/composer/docs/access-airflow-api)).
* `composer_auth_user_registration_role`: Wskazuje **rolÄ™**, jakÄ… **uÅ¼ytkownik kompozytora** otrzyma w **Airflow** (**Op** domyÅ›lnie).
* MoÅ¼esz rÃ³wnieÅ¼ **stworzyÄ‡ wÅ‚asnÄ… metodÄ™ uwierzytelniania** za pomocÄ… Pythona.
* **`google_key_path`:** ÅšcieÅ¼ka do klucza konta usÅ‚ugi GCP

### **\[atlas]**

* **`password`**: HasÅ‚o Atlas
* **`username`**: Nazwa uÅ¼ytkownika Atlas

### \[celery]

* **`flower_basic_auth`** : Dane uwierzytelniajÄ…ce (_user1:password1,user2:password2_)
* **`result_backend`**: Adres URL Postgres, ktÃ³ry moÅ¼e zawieraÄ‡ **dane uwierzytelniajÄ…ce**.
* **`ssl_cacert`**: ÅšcieÅ¼ka do pliku cacert
* **`ssl_cert`**: ÅšcieÅ¼ka do pliku certyfikatu
* **`ssl_key`**: ÅšcieÅ¼ka do pliku klucza

### \[core]

* **`dag_discovery_safe_mode`**: DomyÅ›lnie wÅ‚Ä…czone. Podczas odkrywania DAG-Ã³w ignorowane sÄ… pliki, ktÃ³re nie zawierajÄ… ciÄ…gÃ³w `DAG` i `airflow`.
* **`fernet_key`**: Klucz do przechowywania zaszyfrowanych zmiennych (symetryczny)
* **`hide_sensitive_var_conn_fields`**: DomyÅ›lnie wÅ‚Ä…czone, ukrywa wraÅ¼liwe informacje o poÅ‚Ä…czeniach.
* **`security`**: ModuÅ‚ zabezpieczeÅ„ do uÅ¼ycia (na przykÅ‚ad kerberos)

### \[dask]

* **`tls_ca`**: ÅšcieÅ¼ka do pliku ca
* **`tls_cert`**: ÅšcieÅ¼ka do pliku certyfikatu
* **`tls_key`**: ÅšcieÅ¼ka do pliku klucza TLS

### \[kerberos]

* **`ccache`**: ÅšcieÅ¼ka do pliku ccache
* **`forwardable`**: DomyÅ›lnie wÅ‚Ä…czone

### \[logging]

* **`google_key_path`**: ÅšcieÅ¼ka do pliku JSON z danymi uwierzytelniajÄ…cymi GCP.

### \[secrets]

* **`backend`**: PeÅ‚na nazwa klasy backendu tajemnic do wÅ‚Ä…czenia
* **`backend_kwargs`**: Parametr backend\_kwargs jest Å‚adowany do sÅ‚ownika i przekazywany do **init** klasy backendu tajemnic.

### \[smtp]

* **`smtp_password`**: HasÅ‚o SMTP
* **`smtp_user`**: UÅ¼ytkownik SMTP

### \[webserver]

* **`cookie_samesite`**: DomyÅ›lnie jest to **Lax**, wiÄ™c jest to juÅ¼ najmniejsza moÅ¼liwa wartoÅ›Ä‡
* **`cookie_secure`**: Ustawia flagÄ™ **secure** na pliku cookie sesji
* **`expose_config`**: DomyÅ›lnie jest False, jeÅ›li jest true, **konfiguracja** moÅ¼e byÄ‡ **odczytana** z konsoli internetowej
* **`expose_stacktrace`**: DomyÅ›lnie jest True, pokazuje **Å›lad pythona** (potencjalnie przydatne dla atakujÄ…cego)
* **`secret_key`**: Jest to **klucz uÅ¼ywany przez flask do podpisywania plikÃ³w cookie** (jeÅ›li go masz, moÅ¼esz **udawaÄ‡ dowolnego uÅ¼ytkownika w Airflow**)
* **`web_server_ssl_cert`**: **ÅšcieÅ¼ka** do **certyfikatu SSL**
* **`web_server_ssl_key`**: **ÅšcieÅ¼ka** do **klucza SSL**
* **`x_frame_enabled`**: DomyÅ›lnie jest **True**, wiÄ™c domyÅ›lnie nie jest moÅ¼liwe klikanie w ramki (clickjacking)

### Uwierzytelnianie internetowe

DomyÅ›lnie **uwierzytelnianie internetowe** jest okreÅ›lone w pliku **`webserver_config.py`** i jest skonfigurowane jako
```bash
AUTH_TYPE = AUTH_DB
```
Co oznacza, Å¼e **uwierzytelnianie jest sprawdzane w stosunku do bazy danych**. Jednak inne konfiguracje sÄ… moÅ¼liwe, takie jak
```bash
AUTH_TYPE = AUTH_OAUTH
```
Aby pozostawiÄ‡ **uwierzytelnianie stronom trzecim**.

Jednak istnieje rÃ³wnieÅ¼ opcja **umoÅ¼liwienia dostÄ™pu anonimowym uÅ¼ytkownikom**, ustawiajÄ…c nastÄ™pujÄ…cy parametr na **Å¼Ä…danÄ… rolÄ™**:
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
