# Configuration d'Airflow

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Fichier de Configuration

**Apache Airflow** g√©n√®re un **fichier de configuration** dans toutes les machines airflow appel√© **`airflow.cfg`** dans le r√©pertoire personnel de l'utilisateur airflow. Ce fichier de configuration contient des informations de configuration et **peut contenir des informations int√©ressantes et sensibles.**

**Il y a deux fa√ßons d'acc√©der √† ce fichier : en compromettant une machine airflow, ou en acc√©dant √† la console web.**

Notez que les **valeurs √† l'int√©rieur du fichier de configuration** **pourraient ne pas √™tre celles utilis√©es**, car vous pouvez les remplacer en d√©finissant des variables d'environnement telles que `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`.

Si vous avez acc√®s au **fichier de configuration sur le serveur web**, vous pouvez v√©rifier la **configuration r√©elle en cours d'ex√©cution** sur la m√™me page o√π la configuration est affich√©e.\
Si vous avez **acc√®s √† une machine √† l'int√©rieur de l'environnement airflow**, v√©rifiez l'**environnement**.

Quelques valeurs int√©ressantes √† v√©rifier lors de la lecture du fichier de configuration :

### \[api]

* **`access_control_allow_headers`** : Cela indique les **en-t√™tes autoris√©s** pour **CORS**
* **`access_control_allow_methods`** : Cela indique les **m√©thodes autoris√©es** pour **CORS**
* **`access_control_allow_origins`** : Cela indique les **origines autoris√©es** pour **CORS**
* **`auth_backend`** : [**Selon la documentation**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html) quelques options peuvent √™tre mises en place pour configurer qui peut acc√©der √† l'API :
* `airflow.api.auth.backend.deny_all` : **Par d√©faut, personne** ne peut acc√©der √† l'API
* `airflow.api.auth.backend.default` : **Tout le monde peut** y acc√©der sans authentification
* `airflow.api.auth.backend.kerberos_auth` : Pour configurer l'**authentification kerberos**
* `airflow.api.auth.backend.basic_auth` : Pour l'**authentification de base**
* `airflow.composer.api.backend.composer_auth` : Utilise l'authentification de composer (GCP) (depuis [**ici**](https://cloud.google.com/composer/docs/access-airflow-api)).
* `composer_auth_user_registration_role` : Cela indique le **r√¥le** que l'**utilisateur composer** obtiendra dans **airflow** (**Op** par d√©faut).
* Vous pouvez √©galement **cr√©er votre propre m√©thode d'authentification** avec python.
* **`google_key_path`** : Chemin vers la **cl√© de compte de service GCP**

### **\[atlas]**

* **`password`** : Mot de passe Atlas
* **`username`** : Nom d'utilisateur Atlas

### \[celery]

* **`flower_basic_auth`** : Identifiants (_user1:password1,user2:password2_)
* **`result_backend`** : URL de Postgres qui peut contenir des **identifiants**.
* **`ssl_cacert`** : Chemin vers le cacert
* **`ssl_cert`** : Chemin vers le certificat
* **`ssl_key`** : Chemin vers la cl√©

### \[core]

* **`dag_discovery_safe_mode`** : Activ√© par d√©faut. Lors de la d√©couverte des DAGs, ignorer tous les fichiers qui ne contiennent pas les cha√Ænes `DAG` et `airflow`.
* **`fernet_key`** : Cl√© pour stocker des variables chiffr√©es (sym√©trique)
* **`hide_sensitive_var_conn_fields`** : Activ√© par d√©faut, cache les informations sensibles des connexions.
* **`security`** : Quel module de s√©curit√© utiliser (par exemple kerberos)

### \[dask]

* **`tls_ca`** : Chemin vers le ca
* **`tls_cert`** : Chemin vers le certificat
* **`tls_key`** : Chemin vers la cl√© tls

### \[kerberos]

* **`ccache`** : Chemin vers le fichier ccache
* **`forwardable`** : Activ√© par d√©faut

### \[logging]

* **`google_key_path`** : Chemin vers les identifiants JSON de GCP.

### \[secrets]

* **`backend`** : Nom complet de la classe du backend de secrets √† activer
* **`backend_kwargs`** : Le param√®tre backend_kwargs est charg√© dans un dictionnaire et pass√© √† **init** de la classe backend de secrets.

### \[smtp]

* **`smtp_password`** : Mot de passe SMTP
* **`smtp_user`** : Utilisateur SMTP

### \[webserver]

* **`cookie_samesite`** : Par d√©faut, c'est **Lax**, donc c'est d√©j√† la valeur la plus faible possible
* **`cookie_secure`** : D√©finir le **drapeau s√©curis√©** sur le cookie de session
* **`expose_config`** : Par d√©faut, c'est Faux, si vrai, la **configuration** peut √™tre **lue** depuis la **console web**
* **`expose_stacktrace`** : Par d√©faut, c'est Vrai, cela montrera les **tracebacks python** (potentiellement utiles pour un attaquant)
* **`secret_key`** : C'est la **cl√© utilis√©e par flask pour signer les cookies** (si vous avez cela, vous pouvez **usurper l'identit√© de n'importe quel utilisateur dans Airflow**)
* **`web_server_ssl_cert`** : **Chemin** vers le **certificat SSL**
* **`web_server_ssl_key`** : **Chemin** vers la **Cl√© SSL**
* **`x_frame_enabled`** : Par d√©faut, c'est **Vrai**, donc par d√©faut le clickjacking n'est pas possible

### Authentification Web

Par d√©faut, l'**authentification web** est sp√©cifi√©e dans le fichier **`webserver_config.py`** et est configur√©e comme
```bash
AUTH_TYPE = AUTH_DB
```
Cela signifie que **l'authentification est v√©rifi√©e par rapport √† la base de donn√©es**. Cependant, d'autres configurations sont possibles telles que
```bash
AUTH_TYPE = AUTH_OAUTH
```
Pour d√©l√©guer l'**authentification √† des services tiers**.

Cependant, il existe √©galement une option pour **permettre l'acc√®s aux utilisateurs anonymes**, en d√©finissant le param√®tre suivant pour le **r√¥le souhait√©** :
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
