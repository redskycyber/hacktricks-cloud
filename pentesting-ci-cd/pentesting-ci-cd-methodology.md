# Metodologia testowania penetracyjnego CI/CD

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../.gitbook/assets/CLOUD-logo-letters.svg" alt=""><figcaption></figcaption></figure>

## VCS

VCS oznacza **System Kontroli Wersji**, ten system pozwala programistom **zarzÄ…dzaÄ‡ swoim kodem ÅºrÃ³dÅ‚owym**. NajczÄ™Å›ciej uÅ¼ywanym jest **git**, a firmy zazwyczaj korzystajÄ… z jednej z nastÄ™pujÄ…cych **platform**:

* Github
* Gitlab
* Bitbucket
* Gitea
* Dostawcy chmury (oferujÄ… wÅ‚asne platformy VCS)

## Pipeliny

Pipeliny pozwalajÄ… programistom na **automatyzacjÄ™ wykonania kodu** (np. w celu budowania, testowania, wdraÅ¼ania...) po wystÄ…pieniu okreÅ›lonych akcji: push, PR, cron... SÄ… one niezwykle przydatne do **automatyzacji wszystkich krokÃ³w od rozwoju do produkcji**.

Jednak te systemy muszÄ… byÄ‡ **wykonywane gdzieÅ›** i zazwyczaj z **uprzywilejowanymi poÅ›wiadczeniami do wdraÅ¼ania kodu**.

## Metodologia testowania penetracyjnego VCS

{% hint style="info" %}
Nawet jeÅ›li niektÃ³re platformy VCS pozwalajÄ… tworzyÄ‡ pipeliny, w tej sekcji analizujemy tylko potencjalne ataki na kontrolÄ™ kodu ÅºrÃ³dÅ‚owego.
{% endhint %}

Platformy zawierajÄ…ce kod ÅºrÃ³dÅ‚owy projektu zawierajÄ… wraÅ¼liwe informacje, dlatego ludzie muszÄ… byÄ‡ bardzo ostroÅ¼ni z przyznanymi uprawnieniami w tej platformie. Oto kilka powszechnych problemÃ³w wystÄ™pujÄ…cych na platformach VCS, ktÃ³re atakujÄ…cy mogÄ… wykorzystaÄ‡:

* **Wycieki**: JeÅ›li twÃ³j kod zawiera wycieki w commitach, a atakujÄ…cy ma dostÄ™p do repozytorium (poniewaÅ¼ jest publiczne lub ma do niego dostÄ™p), moÅ¼e odkryÄ‡ wycieki.
* **DostÄ™p**: JeÅ›li atakujÄ…cy ma **dostÄ™p do konta w platformie VCS**, moÅ¼e uzyskaÄ‡ **wiÄ™kszÄ… widocznoÅ›Ä‡ i uprawnienia**.
* **Rejestracja**: NiektÃ³re platformy pozwolÄ… tylko zewnÄ™trznym uÅ¼ytkownikom na utworzenie konta.
* **SSO**: NiektÃ³re platformy nie pozwolÄ… uÅ¼ytkownikom na rejestracjÄ™, ale pozwolÄ… kaÅ¼demu na dostÄ™p za pomocÄ… waÅ¼nego SSO (wiÄ™c atakujÄ…cy moÅ¼e na przykÅ‚ad uÅ¼yÄ‡ swojego konta github).
* **PoÅ›wiadczenia**: Nazwa uÅ¼ytkownika + hasÅ‚o, tokeny osobiste, klucze ssh, tokeny OAuth, pliki cookie... istnieje kilka rodzajÃ³w tokenÃ³w, ktÃ³re uÅ¼ytkownik moÅ¼e ukraÅ›Ä‡, aby w jakiÅ› sposÃ³b uzyskaÄ‡ dostÄ™p do repozytorium.
* **Webhooki**: Platformy VCS pozwalajÄ… na generowanie webhookÃ³w. JeÅ›li nie sÄ… **chronione** za pomocÄ… niewidocznych sekretÃ³w, **atakujÄ…cy moÅ¼e je wykorzystaÄ‡**.
* JeÅ›li nie ma ustawionego sekretu, atakujÄ…cy moÅ¼e wykorzystaÄ‡ webhook z platformy osÃ³b trzecich.
* JeÅ›li sekret znajduje siÄ™ w adresie URL, dzieje siÄ™ to samo, a atakujÄ…cy ma rÃ³wnieÅ¼ dostÄ™p do sekretu.
* **Kompromitacja kodu**: JeÅ›li zÅ‚oÅ›liwy aktor ma pewien rodzaj dostÄ™pu **do zapisu** w repozytoriach, moÅ¼e prÃ³bowaÄ‡ **wstrzyknÄ…Ä‡ zÅ‚oÅ›liwy kod**. Aby odnieÅ›Ä‡ sukces, moÅ¼e byÄ‡ konieczne **ominiÄ™cie zabezpieczeÅ„ gaÅ‚Ä™zi**. Te dziaÅ‚ania mogÄ… byÄ‡ wykonywane z rÃ³Å¼nymi celami:
* Skompromituj gÅ‚Ã³wnÄ… gaÅ‚Ä…Åº, aby **skompromitowaÄ‡ produkcjÄ™**.
* Skompromituj gÅ‚Ã³wnÄ… (lub inne gaÅ‚Ä™zie), aby **skompromitowaÄ‡ maszyny programistÃ³w** (poniewaÅ¼ zazwyczaj wykonujÄ… testy, terraform lub inne rzeczy w repozytorium na swoich maszynach).
* **Skompromituj pipeline** (sprawdÅº nastÄ™pnÄ… sekcjÄ™)

## Metodologia testowania penetracyjnego PipelinÃ³w

NajczÄ™stszy sposÃ³b definiowania pipeliny polega na uÅ¼yciu **pliku konfiguracyjnego CI hostowanego w repozytorium**, dla ktÃ³rego pipeline jest budowany. Ten plik opisuje kolejnoÅ›Ä‡ wykonywanych zadaÅ„, warunki wpÅ‚ywajÄ…ce na przepÅ‚yw i ustawienia Å›rodowiska budowy.\
Te pliki zwykle majÄ… spÃ³jnÄ… nazwÄ™ i format, na przykÅ‚ad â€” Jenkinsfile (Jenkins), .gitlab-ci.yml (GitLab), .circleci/config.yml (CircleCI) i pliki YAML GitHub Actions znajdujÄ…ce siÄ™ w .github/workflows. Po wywoÅ‚aniu zadania pipeline **pobiera kod** z wybranego ÅºrÃ³dÅ‚a (np. commit / gaÅ‚Ä…Åº) i **uruchamia polecenia okreÅ›lone w pliku konfiguracji CI** na tym kodzie.

Dlatego ostatecznym celem atakujÄ…cego jest w jakiÅ› sposÃ³b **skompromitowanie tych plikÃ³w konfiguracyjnych** lub **wykonywanych przez nie poleceÅ„**.

### PPE - Zatrute Wykonanie Pipeliny

ÅšcieÅ¼ka Zatrutego Wykonania Pipeliny (PPE) wykorzystuje uprawnienia w repozytorium SCM do manipulowania pipelinÄ… CI i wykonywania szkodliwych poleceÅ„. UÅ¼ytkownicy posiadajÄ…cy odpowiednie uprawnienia mogÄ… modyfikowaÄ‡ pliki konfiguracji CI lub inne pliki uÅ¼ywane przez zadanie pipeliny, aby zawieraÅ‚y zÅ‚oÅ›liwe polecenia. To "zatruwa" pipelinÄ™ CI, co prowadzi do wykonania tych zÅ‚oÅ›liwych poleceÅ„.

Aby zÅ‚oÅ›liwy aktor odniÃ³sÅ‚ sukces w przeprowadzeniu ataku PPE, musi byÄ‡ w stanie:

* MieÄ‡ **dostÄ™p do zapisu w platformie VCS**, poniewaÅ¼ pipeliny zazwyczaj sÄ… uruchamiane, gdy nastÄ™puje push lub pull request. (SprawdÅº metodologiÄ™ testowania penetracyjnego VCS, aby uzyskaÄ‡ podsumowanie sposobÃ³w uzyskania dostÄ™pu
## WiÄ™cej istotnych informacji

### NarzÄ™dzia i standard CIS

* [**Chain-bench**](https://github.com/aquasecurity/chain-bench) to narzÄ™dzie open-source do audytu stosu Å‚aÅ„cucha dostaw oprogramowania pod kÄ…tem zgodnoÅ›ci z bezpieczeÅ„stwem, oparte na nowym [**standardzie CIS Software Supply Chain**](https://github.com/aquasecurity/chain-bench/blob/main/docs/CIS-Software-Supply-Chain-Security-Guide-v1.0.pdf). Audyt skupia siÄ™ na caÅ‚ym procesie SDLC, gdzie moÅ¼e ujawniÄ‡ ryzyka od czasu pisania kodu do czasu wdroÅ¼enia.

### Top 10 ryzyk zwiÄ…zanych z CI/CD

SprawdÅº ten interesujÄ…cy artykuÅ‚ na temat top 10 ryzyk zwiÄ…zanych z CI/CD wedÅ‚ug Cider: [**https://www.cidersecurity.io/top-10-cicd-security-risks/**](https://www.cidersecurity.io/top-10-cicd-security-risks/)

### Laboratoria

* Na kaÅ¼dej platformie, ktÃ³rÄ… moÅ¼na uruchomiÄ‡ lokalnie, znajdziesz informacje o tym, jak jÄ… uruchomiÄ‡ lokalnie, aby moÅ¼na jÄ… byÅ‚o skonfigurowaÄ‡ wedÅ‚ug wÅ‚asnych preferencji i przetestowaÄ‡.
* Laboratorium Gitea + Jenkins: [https://github.com/cider-security-research/cicd-goat](https://github.com/cider-security-research/cicd-goat)

### Automatyczne narzÄ™dzia

* [**Checkov**](https://github.com/bridgecrewio/checkov): **Checkov** to narzÄ™dzie do statycznej analizy kodu dla infrastruktury jako kodu.

## OdwoÅ‚ania

* [https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422](https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422)

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ **reklamÄ™ swojej firmy w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
