# Metodologija testiranja penetracije CI/CD

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** me na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../.gitbook/assets/CLOUD-logo-letters.svg" alt=""><figcaption></figcaption></figure>

## VCS

VCS ozna캜ava **Sistem za kontrolu verzija**, ovaj sistem omogu캖ava programerima da **upravljaju svojim izvornim kodom**. Naj캜e코캖i je **git** i obi캜no 캖ete prona캖i kompanije koje ga koriste na jednoj od slede캖ih **platformi**:

* Github
* Gitlab
* Bitbucket
* Gitea
* Cloud provajderi (oni nude svoje sopstvene VCS platforme)

## Pipelines

Pipelines omogu캖avaju programerima da **automatizuju izvr코avanje koda** (za izgradnju, testiranje, implementaciju... svrhe) nakon 코to se odre캠ene radnje dese: push, PR, cron... Oni su veoma korisni za **automatizaciju svih koraka od razvoja do produkcije**.

Me캠utim, ovi sistemi moraju biti **izvr코eni negde** i obi캜no sa **privilegovanim akreditivima za implementaciju koda**.

## Metodologija testiranja penetracije VCS-a

{% hint style="info" %}
캛ak i ako neke VCS platforme omogu캖avaju kreiranje pipelina, u ovom odeljku 캖emo analizirati samo potencijalne napade na kontrolu izvornog koda.
{% endhint %}

Platforme koje sadr쬰 izvorni kod va코eg projekta sadr쬰 osetljive informacije i ljudi moraju biti veoma oprezni sa dozvolama koje se dodeljuju unutar ove platforme. Ovo su neki uobi캜ajeni problemi sa VCS platformama koje napada캜 mo쬰 zloupotrebiti:

* **Curenje**: Ako va코 kod sadr쬴 curenja u commit-ovima i napada캜 mo쬰 pristupiti repozitorijumu (jer je javan ili jer ima pristup), on mo쬰 otkriti curenja.
* **Pristup**: Ako napada캜 mo쬰 **pristupiti nalogu unutar VCS platforme**, on mo쬰 dobiti **ve캖u vidljivost i dozvole**.
* **Registracija**: Neke platforme 캖e dozvoliti samo eksternim korisnicima da kreiraju nalog.
* **SSO**: Neke platforme ne캖e dozvoliti korisnicima da se registruju, ali 캖e dozvoliti svakome da pristupi sa validnim SSO (tako da napada캜 mo쬰 koristiti svoj github nalog da pristupi na primer).
* **Akreditivi**: Korisni캜ko ime + lozinka, li캜ni tokeni, ssh klju캜evi, Oauth tokeni, kola캜i캖i... postoji nekoliko vrsta tokena koje korisnik mo쬰 ukrasti da bi pristupio repozitorijumu na neki na캜in.
* **Webhook-ovi**: VCS platforme omogu캖avaju generisanje webhook-ova. Ako nisu **za코ti캖eni** sa nevidljivim tajnama, **napada캜 mo쬰 zloupotrebiti** ove webhook-ove.
* Ako nije postavljena tajna, napada캜 mo쬰 zloupotrebiti webhook tre캖e strane
* Ako je tajna u URL-u, isto se de코ava i napada캜 tako캠e ima tajnu
* **Kompromitacija koda**: Ako zlonamerni akter ima neku vrstu **pisanog** pristupa repozitorijumima, on mo쬰 poku코ati da **ubaci zlonamerni kod**. Da bi bio uspe코an, mo쬯a 캖e morati da **zaobi캠e za코titu grane**. Ove akcije se mogu izvr코iti sa razli캜itim ciljevima:
* Kompromitacija glavne grane da bi se **kompromitovala produkcija**.
* Kompromitacija glavne (ili drugih grana) da bi se **kompromitovali ra캜unari programera** (jer obi캜no izvr코avaju testove, terraform ili druge stvari unutar repozitorijuma na svojim ra캜unarima).
* **Kompromitacija pipeline-a** (proverite slede캖e odeljke)

## Metodologija testiranja penetracije Pipelines-a

Naj캜e코캖i na캜in definisanja pipeline-a je kori코캖enjem **konfiguracionog fajla CI-a koji se nalazi u repozitorijumu** koji pipeline gradi. Ovaj fajl opisuje redosled izvr코avanja poslova, uslove koji uti캜u na tok i postavke okru쬰nja za izgradnju.\
Ovi fajlovi obi캜no imaju dosledno ime i format, na primer - Jenkinsfile (Jenkins), .gitlab-ci.yml (GitLab), .circleci/config.yml (CircleCI), i GitHub Actions YAML fajlovi sme코teni pod .github/workflows. Kada se pokrene, posao pipeline-a **vu캜e kod** sa izabranog izvora (npr. commit / grana) i **izvr코ava komande navedene u konfiguracionom fajlu CI-a** protiv tog koda.

Stoga je krajnji cilj napada캜a da na neki na캜in **kompromituje te konfiguracione fajlove** ili **komande koje izvr코avaju**.

### PPE - Trovanje izvr코avanja pipeline-a

Put trovanja izvr코avanja pipeline-a (PPE) zloupotrebljava dozvole u SCM repozitorijumu da manipuli코e CI pipeline-om i izvr코ava 코tetne komande. Korisnici sa potrebnim dozvolama mogu izmeniti konfiguracione fajlove CI-a ili druge fajlove koje koristi posao pipeline-a da bi uklju캜ili zlonamerne komande. Ovo "trovanje" CI pipeline-a dovodi do izvr코avanja ovih zlonamernih komandi.

Da bi zlonamerni akter bio uspe코an u izvo캠enju napada PPE, mora biti u mogu캖nosti da:

* Ima **pisan pristup VCS platformi**, jer se pipeline-ovi obi캜no pokre캖u kada se iz
## Jo코 relevantnih informacija

### Alati i CIS Benchmark

* [**Chain-bench**](https://github.com/aquasecurity/chain-bench) je alat otvorenog koda za proveru uskla캠enosti sigurnosti va코eg softverskog lanca snabdevanja na osnovu novog [**CIS Software Supply Chain benchmarka**](https://github.com/aquasecurity/chain-bench/blob/main/docs/CIS-Software-Supply-Chain-Security-Guide-v1.0.pdf). Provera se fokusira na ceo proces SDLC-a, gde mo쬰 otkriti rizike od vremena kodiranja do vremena implementacije.

### Top 10 CI/CD sigurnosnih rizika

Proverite ovaj interesantan 캜lanak o top 10 CI/CD rizika prema Cider-u: [**https://www.cidersecurity.io/top-10-cicd-security-risks/**](https://www.cidersecurity.io/top-10-cicd-security-risks/)

### Laboratorije

* Na svakoj platformi koju mo쬰te pokrenuti lokalno, prona캖i 캖ete kako je pokrenuti lokalno kako biste je mogli konfigurisati onako kako 쬰lite da je testirate.
* Gitea + Jenkins laboratorija: [https://github.com/cider-security-research/cicd-goat](https://github.com/cider-security-research/cicd-goat)

### Automatski alati

* [**Checkov**](https://github.com/bridgecrewio/checkov): **Checkov** je alat za stati캜ku analizu koda za infrastrukturu-kao-kod.

## Reference

* [https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422](https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
