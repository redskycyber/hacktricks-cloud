# CI/CD Pentest Metodolojisi

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

<figure><img src="../.gitbook/assets/CLOUD-logo-letters.svg" alt=""><figcaption></figcaption></figure>

## VCS

VCS, **SÃ¼rÃ¼m Kontrol Sistemi** anlamÄ±na gelir ve bu sistemler geliÅŸtiricilerin **kaynak kodlarÄ±nÄ± yÃ¶netmelerine** olanak tanÄ±r. En yaygÄ±n olanÄ± **git** olup, genellikle ÅŸirketlerin aÅŸaÄŸÄ±daki **platformlardan birini kullanarak** kullandÄ±ÄŸÄ±nÄ± gÃ¶receksiniz:

* Github
* Gitlab
* Bitbucket
* Gitea
* Bulut saÄŸlayÄ±cÄ±larÄ± (kendi VCS platformlarÄ±nÄ± sunarlar)

## Pipelines

Pipelines, geliÅŸtiricilere kodun **otomatik olarak yÃ¼rÃ¼tÃ¼lmesini** (derleme, test, daÄŸÄ±tma vb. amaÃ§larla) belirli eylemler gerÃ§ekleÅŸtikten sonra saÄŸlar: Bir itme, bir PR, cron... Bunlar, geliÅŸtirmeden Ã¼retime kadar olan tÃ¼m adÄ±mlarÄ± **otomatikleÅŸtirmek iÃ§in son derece kullanÄ±ÅŸlÄ±dÄ±r**.

Ancak, bu sistemlerin **bir yerde yÃ¼rÃ¼tÃ¼lmesi** ve genellikle **kod daÄŸÄ±tmak iÃ§in ayrÄ±calÄ±klÄ± kimlik bilgilerine** sahip olmasÄ± gerekir.

## VCS Pentest Metodolojisi

{% hint style="info" %}
BazÄ± VCS platformlarÄ±nÄ±n bu bÃ¶lÃ¼m iÃ§in pipeline'lar oluÅŸturmaya izin vermesine raÄŸmen, sadece kaynak kodun kontrolÃ¼ne yÃ¶nelik potansiyel saldÄ±rÄ±larÄ± analiz edeceÄŸiz.
{% endhint %}

Projenizin kaynak kodunu iÃ§eren platformlar, hassas bilgiler iÃ§erir ve insanlar bu platform iÃ§inde verilen izinlere Ã§ok dikkat etmelidir. SaldÄ±rganÄ±n istismar edebileceÄŸi bazÄ± yaygÄ±n sorunlar ÅŸunlardÄ±r:

* **SÄ±zÄ±ntÄ±lar**: Kodunuz, taahhÃ¼tlerde sÄ±zÄ±ntÄ±lar iÃ§eriyorsa ve saldÄ±rgan repo'ya eriÅŸebiliyorsa (genel veya eriÅŸimi olduÄŸu iÃ§in), sÄ±zÄ±ntÄ±larÄ± keÅŸfedebilir.
* **EriÅŸim**: Bir saldÄ±rgan, VCS platformu iÃ§indeki bir hesaba **eriÅŸebilirse**, **daha fazla gÃ¶rÃ¼nÃ¼rlÃ¼k ve izin** elde edebilir.
* **KayÄ±t**: BazÄ± platformlar yalnÄ±zca harici kullanÄ±cÄ±larÄ±n hesap oluÅŸturmasÄ±na izin verir.
* **SSO**: BazÄ± platformlar kullanÄ±cÄ±larÄ±n kaydolmasÄ±na izin vermez, ancak geÃ§erli bir SSO ile herkesin eriÅŸmesine izin verir (bu nedenle bir saldÄ±rgan Ã¶rneÄŸin github hesabÄ±nÄ± kullanabilir).
* **Kimlik bilgileri**: KullanÄ±cÄ±larÄ±n bir ÅŸekilde bir repo'ya eriÅŸmek iÃ§in Ã§alabileceÄŸi kullanÄ±cÄ± adÄ± + ÅŸifre, kiÅŸisel belirteÃ§ler, ssh anahtarlarÄ±, Oauth belirteÃ§leri, Ã§erezler... birkaÃ§ tÃ¼r belirteÃ§ vardÄ±r.
* **Webhooks**: VCS platformlarÄ±, webhooks oluÅŸturmayÄ± saÄŸlar. EÄŸer bunlar **gÃ¶rÃ¼nmez sÄ±rlarla korunmuyorsa**, bir saldÄ±rgan bunlarÄ± istismar edebilir.
* EÄŸer bir sÄ±r yoksa, saldÄ±rgan Ã¼Ã§Ã¼ncÃ¼ taraf platformunun webhook'unu istismar edebilir
* EÄŸer sÄ±r URL'de ise, aynÄ± ÅŸey olur ve saldÄ±rgan ayrÄ±ca sÄ±rra sahip olur
* **Kodun tehlikeye girmesi**: KÃ¶tÃ¼ niyetli bir aktÃ¶rÃ¼n repo'lar Ã¼zerinde bir tÃ¼r **yazma** eriÅŸimi varsa, **zararlÄ± kod enjekte etmeye** Ã§alÄ±ÅŸabilir. BaÅŸarÄ±lÄ± olmak iÃ§in genellikle **dal korumalarÄ±nÄ± atlatmasÄ±** gerekebilir. Bu eylemler farklÄ± hedeflerle gerÃ§ekleÅŸtirilebilir:
* Ãœretimi **tehlikeye atmak iÃ§in ana dalÄ±** tehlikeye atmak.
* GeliÅŸtiricilerin makinelerini tehlikeye atmak iÃ§in ana (veya diÄŸer dallarÄ±) tehlikeye atmak (genellikle test, terraform veya diÄŸer ÅŸeyleri repo iÃ§inde makinelerinde Ã§alÄ±ÅŸtÄ±rÄ±rlar).
* **Pipeline'Ä± tehlikeye atmak** (bir sonraki bÃ¶lÃ¼me bakÄ±n)

## Pipelines Pentest Metodolojisi

Bir pipeline'Ä± tanÄ±mlamanÄ±n en yaygÄ±n yolu, pipeline'Ä±n oluÅŸturulduÄŸu **repo'da barÄ±ndÄ±rÄ±lan bir CI yapÄ±landÄ±rma dosyasÄ±** kullanmaktÄ±r. Bu dosya, yÃ¼rÃ¼tÃ¼len iÅŸlerin sÄ±rasÄ±nÄ±, akÄ±ÅŸÄ± etkileyen koÅŸullarÄ± ve yapÄ±landÄ±rma dosyasÄ±na karÅŸÄ± belirtilen komutlarÄ± tanÄ±mlar.\
Bu dosyalar genellikle tutarlÄ± bir ad ve formata sahiptir, Ã¶rneÄŸin â€” Jenkinsfile (Jenkins), .gitlab-ci.yml (GitLab), .circleci/config.yml (CircleCI) ve .github/workflows altÄ±nda bulunan GitHub Actions YAML dosyalarÄ±. Pipeline iÅŸlemi tetiklendiÄŸinde, pipeline iÅŸi **seÃ§ilen kaynaktan (Ã¶rneÄŸin taahhÃ¼t / dal) kodu Ã§eker** ve bu kod Ã¼zerinde CI yapÄ±landÄ±rma dosyasÄ±nda belirtilen komutlarÄ± Ã§alÄ±ÅŸtÄ±rÄ±r.

Bu nedenle, saldÄ±rganÄ±n nihai hedefi, bu yapÄ±landÄ±rma dosyalarÄ±nÄ± veya **yÃ¼rÃ¼tÃ¼len komutlarÄ± bir ÅŸekilde tehlikeye atmak**tÄ±r.

### Zehirli Pipeline YÃ¼rÃ¼tme (PPE)

Zehirli Pipeline YÃ¼rÃ¼tme (PPE) yolu, bir SCM deposundaki izinleri istismar ederek bir CI pipeline'Ä± manipÃ¼le etmek ve zararlÄ± komutlarÄ± yÃ¼rÃ¼tmektir. Gerekli izinlere sahip kullanÄ±cÄ±lar, CI yapÄ±landÄ±rma dosyalarÄ±nÄ± veya pipeline iÅŸi tarafÄ±ndan kullanÄ±lan diÄŸer dosyalarÄ± deÄŸiÅŸtirerek zararlÄ± komutlarÄ± iÃ§erecek ÅŸekilde pipeline'Ä± "zehirler". Bu, bu zararlÄ± komutlarÄ±n yÃ¼rÃ¼tÃ¼lmesine yol aÃ§ar.

Bir saldÄ±rganÄ±n PPE saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirirken baÅŸarÄ±lÄ± olabilmesi iÃ§in ÅŸunlara ihtiyacÄ± vardÄ±r:

* Genellikle bir itme veya bir pull isteÄŸi gerÃ§ekleÅŸtirildi
## Daha ilgili bilgiler

### AraÃ§lar ve CIS Benchmark

* [**Chain-bench**](https://github.com/aquasecurity/chain-bench), yeni bir [**CIS YazÄ±lÄ±m Tedarik Zinciri benchmark**](https://github.com/aquasecurity/chain-bench/blob/main/docs/CIS-Software-Supply-Chain-Security-Guide-v1.0.pdf) Ã¼zerinde gÃ¼venlik uyumluluÄŸunu denetlemek iÃ§in aÃ§Ä±k kaynaklÄ± bir araÃ§tÄ±r. Denetleme, kod zamanÄ±ndan daÄŸÄ±tÄ±m zamanÄ±na kadar olan tÃ¼m SDLC sÃ¼recine odaklanÄ±r ve riskleri ortaya Ã§Ä±karabilir.

### En Ä°yi 10 CI/CD GÃ¼venlik Riski

Cider'a gÃ¶re en iyi 10 CI/CD riski hakkÄ±nda ilginÃ§ bir makaleyi kontrol edin: [**https://www.cidersecurity.io/top-10-cicd-security-risks/**](https://www.cidersecurity.io/top-10-cicd-security-risks/)

### Laboratuvarlar

* Yerel olarak Ã§alÄ±ÅŸtÄ±rabileceÄŸiniz her platformda, onu istediÄŸiniz gibi yapÄ±landÄ±rarak test etmek iÃ§in nasÄ±l baÅŸlatacaÄŸÄ±nÄ±zÄ± bulacaksÄ±nÄ±z.
* Gitea + Jenkins laboratuvarÄ±: [https://github.com/cider-security-research/cicd-goat](https://github.com/cider-security-research/cicd-goat)

### Otomatik AraÃ§lar

* [**Checkov**](https://github.com/bridgecrewio/checkov): **Checkov**, altyapÄ± olarak kod analizi aracÄ±dÄ±r.

## Referanslar

* [https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422](https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422)

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki Ã¶zel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
