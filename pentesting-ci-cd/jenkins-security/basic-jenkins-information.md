# åŸºæœ¬çš„ Jenkins ä¿¡æ¯

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF ç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹çš„ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š **å…³æ³¨** æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## è®¿é—®

### ç”¨æˆ·å + å¯†ç 

ç™»å½• Jenkins æœ€å¸¸è§çš„æ–¹å¼æ˜¯ä½¿ç”¨ç”¨æˆ·åæˆ–å¯†ç ã€‚

### Cookie

å¦‚æœ **æˆæƒçš„ cookie è¢«ç›—**ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥è®¿é—®ç”¨æˆ·çš„ä¼šè¯ã€‚Cookie é€šå¸¸è¢«ç§°ä¸º `JSESSIONID.*`ã€‚ï¼ˆç”¨æˆ·å¯ä»¥ç»ˆæ­¢ä»–çš„æ‰€æœ‰ä¼šè¯ï¼Œä½†ä»–éœ€è¦é¦–å…ˆå‘ç° cookie è¢«ç›—ï¼‰ã€‚

### SSO/æ’ä»¶

Jenkins å¯ä»¥ä½¿ç”¨æ’ä»¶é…ç½®ï¼Œé€šè¿‡ç¬¬ä¸‰æ–¹ SSO **å¯è®¿é—®**ã€‚

### ä»¤ç‰Œ

**ç”¨æˆ·å¯ä»¥ç”Ÿæˆä»¤ç‰Œ**ï¼Œä»¥ä¾¿é€šè¿‡ CLI æˆ– REST API æˆæƒåº”ç”¨ç¨‹åºæ¨¡æ‹Ÿä»–ä»¬ã€‚

### SSH å¯†é’¥

æ­¤ç»„ä»¶ä¸º Jenkins æä¾›äº†å†…ç½®çš„ SSH æœåŠ¡å™¨ã€‚å®ƒæ˜¯ [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/) çš„å¦ä¸€ç§æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½• SSH å®¢æˆ·ç«¯ä»¥è¿™ç§æ–¹å¼è°ƒç”¨å‘½ä»¤ã€‚ï¼ˆæ¥è‡ª [æ–‡æ¡£](https://plugins.jenkins.io/sshd/)ï¼‰

## æˆæƒ

åœ¨ `/configureSecurity` ä¸­ï¼Œå¯ä»¥ **é…ç½® Jenkins çš„æˆæƒæ–¹æ³•**ã€‚æœ‰å‡ ä¸ªé€‰é¡¹ï¼š

* **ä»»ä½•äººéƒ½å¯ä»¥åšä»»ä½•äº‹**ï¼šå³ä½¿æ˜¯åŒ¿åè®¿é—®ä¹Ÿå¯ä»¥ç®¡ç†æœåŠ¡å™¨
* **ä¼ ç»Ÿæ¨¡å¼**ï¼šä¸ Jenkins <1.164 ç›¸åŒã€‚å¦‚æœæ‚¨æ‹¥æœ‰ **"admin" è§’è‰²**ï¼Œæ‚¨å°†è¢«æˆäºˆå¯¹ç³»ç»Ÿçš„ **å®Œå…¨æ§åˆ¶**ï¼Œ**å¦åˆ™**ï¼ˆåŒ…æ‹¬ **åŒ¿å** ç”¨æˆ·ï¼‰æ‚¨å°†æ‹¥æœ‰ **è¯»å–** æƒé™ã€‚
* **ç™»å½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹**ï¼šåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ª **ç™»å½•ç”¨æˆ·éƒ½è·å¾—å¯¹ Jenkins çš„å®Œå…¨æ§åˆ¶**ã€‚å”¯ä¸€æ²¡æœ‰å®Œå…¨æ§åˆ¶æƒçš„ç”¨æˆ·æ˜¯ **åŒ¿åç”¨æˆ·**ï¼Œä»–åªè·å¾— **è¯»å–æƒé™**ã€‚
* **åŸºäºçŸ©é˜µçš„å®‰å…¨æ€§**ï¼šæ‚¨å¯ä»¥åœ¨è¡¨æ ¼ä¸­é…ç½® **è°å¯ä»¥åšä»€ä¹ˆ**ã€‚æ¯ä¸ª **åˆ—** ä»£è¡¨ä¸€ä¸ª **æƒé™**ã€‚æ¯ä¸ª **è¡Œ** **ä»£è¡¨** ä¸€ä¸ª **ç”¨æˆ·æˆ–ä¸€ä¸ªç»„/è§’è‰²**ã€‚è¿™åŒ…æ‹¬ä¸€ä¸ªç‰¹æ®Šç”¨æˆ· '**anonymous**'ï¼Œä»£è¡¨ **æœªç»è®¤è¯çš„ç”¨æˆ·**ï¼Œä»¥åŠ '**authenticated**'ï¼Œä»£è¡¨ **æ‰€æœ‰ç»è¿‡è®¤è¯çš„ç”¨æˆ·**ã€‚

![](<../../.gitbook/assets/image (40).png>)

* **åŸºäºé¡¹ç›®çš„çŸ©é˜µæˆæƒç­–ç•¥**ï¼šè¿™ç§æ¨¡å¼æ˜¯å¯¹ "**åŸºäºçŸ©é˜µçš„å®‰å…¨æ€§**" çš„ **æ‰©å±•**ï¼Œå…è®¸ä¸ºæ¯ä¸ªé¡¹ç›®å•ç‹¬å®šä¹‰é¢å¤–çš„ ACL çŸ©é˜µã€‚
* **åŸºäºè§’è‰²çš„ç­–ç•¥**ï¼šä½¿ç”¨ **åŸºäºè§’è‰²çš„ç­–ç•¥** å®šä¹‰æˆæƒã€‚åœ¨ `/role-strategy` ç®¡ç†è§’è‰²ã€‚

## **å®‰å…¨é¢†åŸŸ**

åœ¨ `/configureSecurity` ä¸­ï¼Œå¯ä»¥ **é…ç½®å®‰å…¨é¢†åŸŸ**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒJenkins æ”¯æŒå‡ ç§ä¸åŒçš„å®‰å…¨é¢†åŸŸï¼š

* **å§”æ‰˜ç»™ servlet å®¹å™¨**ï¼šç”¨äº **å°†èº«ä»½éªŒè¯å§”æ‰˜ç»™è¿è¡Œ Jenkins æ§åˆ¶å™¨çš„ servlet å®¹å™¨**ï¼Œä¾‹å¦‚ [Jetty](https://www.eclipse.org/jetty/)ã€‚
* **Jenkins è‡ªå·±çš„ç”¨æˆ·æ•°æ®åº“**ï¼šä½¿ç”¨ **Jenkins è‡ªå·±çš„å†…ç½®ç”¨æˆ·æ•°æ®å­˜å‚¨** è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè€Œä¸æ˜¯å§”æ‰˜ç»™å¤–éƒ¨ç³»ç»Ÿã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ã€‚
* **LDAP**ï¼šå°†æ‰€æœ‰èº«ä»½éªŒè¯å§”æ‰˜ç»™é…ç½®çš„ LDAP æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬ç”¨æˆ·å’Œç»„ã€‚
* **Unix ç”¨æˆ·/ç»„æ•°æ®åº“**ï¼š **å°†èº«ä»½éªŒè¯å§”æ‰˜ç»™ Jenkins æ§åˆ¶å™¨ä¸Šçš„åº•å±‚ Unix** æ“ä½œç³»ç»Ÿçº§ç”¨æˆ·æ•°æ®åº“ã€‚è¿™ç§æ¨¡å¼è¿˜å…è®¸é‡ç”¨ Unix ç»„è¿›è¡Œæˆæƒã€‚

æ’ä»¶å¯ä»¥æä¾›é¢å¤–çš„å®‰å…¨é¢†åŸŸï¼Œè¿™å¯èƒ½æœ‰åŠ©äºå°† Jenkins é›†æˆåˆ°ç°æœ‰çš„èº«ä»½ç³»ç»Ÿä¸­ï¼Œä¾‹å¦‚ï¼š

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub è®¤è¯](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins èŠ‚ç‚¹ã€ä»£ç†å’Œæ‰§è¡Œå™¨

**èŠ‚ç‚¹** æ˜¯ **æœºå™¨**ï¼Œæ„å»º **ä»£ç†è¿è¡Œ** åœ¨å…¶ä¸Šã€‚Jenkins ç›‘æ§æ¯ä¸ªè¿æ¥çš„èŠ‚ç‚¹çš„ç£ç›˜ç©ºé—´ã€ä¸´æ—¶ç©ºé—´ã€äº¤æ¢ç©ºé—´ã€æ—¶é’Ÿæ—¶é—´/åŒæ­¥å’Œå“åº”æ—¶é—´ã€‚å¦‚æœè¿™äº›å€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªè¶…å‡ºé…ç½®çš„é˜ˆå€¼ï¼ŒèŠ‚ç‚¹å°†è¢«è„±æœºã€‚

**ä»£ç†** **ç®¡ç†** ä»£è¡¨ Jenkins æ§åˆ¶å™¨çš„ **ä»»åŠ¡æ‰§è¡Œ**ï¼Œ**ä½¿ç”¨æ‰§è¡Œå™¨**ã€‚ä»£ç†å¯ä»¥ä½¿ç”¨æ”¯æŒ Java çš„ä»»ä½•æ“ä½œç³»ç»Ÿã€‚æ„å»ºå’Œæµ‹è¯•æ‰€éœ€çš„å·¥å…·å®‰è£…åœ¨ä»£ç†è¿è¡Œçš„èŠ‚ç‚¹ä¸Šï¼›å®ƒä»¬å¯ä»¥ **ç›´æ¥å®‰è£…æˆ–åœ¨å®¹å™¨ä¸­å®‰è£…**ï¼ˆDocker æˆ– Kubernetesï¼‰ã€‚æ¯ä¸ª **ä»£ç†å®é™…ä¸Šæ˜¯å®¿ä¸»æœºä¸Šæ‹¥æœ‰è‡ªå·± PID çš„è¿›ç¨‹**ã€‚

**æ‰§è¡Œå™¨** æ˜¯ **æ‰§è¡Œä»»åŠ¡çš„æ’æ§½**ï¼›å®é™…ä¸Šï¼Œå®ƒæ˜¯ **ä»£ç†ä¸­çš„çº¿ç¨‹**ã€‚èŠ‚ç‚¹ä¸Šçš„ **æ‰§è¡Œå™¨æ•°é‡** å®šä¹‰äº†å¯ä»¥åŒæ—¶åœ¨è¯¥èŠ‚ç‚¹ä¸Šæ‰§è¡Œçš„ **å¹¶å‘ä»»åŠ¡æ•°é‡**ã€‚æ¢å¥è¯è¯´ï¼Œè¿™å†³å®šäº†å¯ä»¥åŒæ—¶åœ¨è¯¥èŠ‚ç‚¹ä¸Šæ‰§è¡Œçš„ **å¹¶å‘ Pipeline `stages` çš„æ•°é‡**ã€‚

## Jenkins ç§˜å¯†

### ç§˜å¯†å’Œå‡­æ®çš„åŠ å¯†

Jenkins ä½¿ç”¨ **AES åŠ å¯†å’Œä¿æŠ¤ç§˜å¯†**ã€å‡­æ®åŠå…¶å„è‡ªçš„åŠ å¯†å¯†é’¥ã€‚è¿™äº›åŠ å¯†å¯†é’¥å­˜å‚¨åœ¨ `$JENKINS_HOME/secrets/` ä¸­ï¼Œè¿åŒç”¨äºä¿æŠ¤è¿™äº›å¯†é’¥çš„ä¸»å¯†é’¥ã€‚åº”é…ç½®æ­¤ç›®å½•ï¼Œä»¥ä¾¿åªæœ‰ Jenkins æ§åˆ¶å™¨è¿è¡Œçš„æ“ä½œç³»ç»Ÿç”¨æˆ·å…·æœ‰å¯¹æ­¤ç›®å½•çš„è¯»å†™æƒé™ï¼ˆå³ï¼Œ`chmod` å€¼ä¸º `0700` æˆ–ä½¿ç”¨é€‚å½“çš„æ–‡ä»¶å±æ€§ï¼‰ã€‚**ä¸»å¯†é’¥**ï¼ˆåœ¨åŠ å¯†æœ¯è¯­ä¸­æœ‰æ—¶è¢«ç§°ä¸º "å¯†é’¥åŠ å¯†å¯†é’¥"ï¼‰**æœªåŠ å¯†åœ°å­˜å‚¨** åœ¨ Jenkins æ§åˆ¶å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ **`$JENKINS_HOME/secrets/master.key`**ï¼Œè¿™ä¸ä¼šé˜²æ­¢ç›´æ¥è®¿é—®è¯¥æ–‡ä»¶çš„æ”»å‡»è€…ã€‚å¤§å¤šæ•°ç”¨æˆ·å’Œå¼€å‘äººå‘˜å°†é€šè¿‡ [Secret](https://javadoc.jenkins.io/byShortName/Secret) API é—´æ¥ä½¿ç”¨è¿™äº›åŠ å¯†å¯†é’¥ï¼Œç”¨äºåŠ å¯†é€šç”¨ç§˜å¯†æ•°æ®ï¼Œæˆ–é€šè¿‡å‡­æ® APIã€‚å¯¹äºå¯¹åŠ å¯†æ„Ÿå…´è¶£çš„äººï¼ŒJenkins ä½¿ç”¨ AES çš„å¯†ç å—é“¾æ¥ï¼ˆCBCï¼‰æ¨¡å¼ã€PKCS#5 å¡«å……å’Œéšæœº IV æ¥åŠ å¯† [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) çš„å®ä¾‹ï¼Œè¿™äº›å®ä¾‹å­˜å‚¨åœ¨ `$JENKINS_HOME/secrets/` ä¸­ï¼Œæ–‡ä»¶åå¯¹åº”äºå®ƒä»¬çš„ `CryptoConfidentialKey` idã€‚å¸¸è§çš„å¯†é’¥ id åŒ…æ‹¬ï¼š

* `hudson.util.Secret`ï¼šç”¨äºé€šç”¨ç§˜å¯†ï¼›
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`ï¼šç”¨äºæŸäº›å‡­æ®ç±»å‹ï¼›
* `jenkins.model.Jenkins.crumbSalt`ï¼šç”± [CSRF ä¿æŠ¤æœºåˆ¶](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery) ä½¿ç”¨ï¼›
### å‡­è¯è®¿é—®

å‡­è¯å¯ä»¥**é™å®šä¸ºå…¨å±€æä¾›è€…**(`/credentials/`)ï¼Œä»»ä½•é…ç½®çš„é¡¹ç›®éƒ½å¯ä»¥è®¿é—®ï¼Œæˆ–è€…å¯ä»¥é™å®šä¸º**ç‰¹å®šé¡¹ç›®**(`/job/<project-name>/configure`)ï¼Œå› æ­¤åªèƒ½ä»ç‰¹å®šé¡¹ç›®è®¿é—®ã€‚

æ ¹æ®[**æ–‡æ¡£**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)ï¼šåœ¨èŒƒå›´å†…çš„å‡­è¯å¯ä¾›æµæ°´çº¿æ— é™åˆ¶åœ°ä½¿ç”¨ã€‚ä¸ºäº†**é˜²æ­¢åœ¨æ„å»ºæ—¥å¿—ä¸­æ„å¤–æš´éœ²**ï¼Œå‡­è¯ä¼šä»å¸¸è§„è¾“å‡ºä¸­**æ©ç **ï¼Œå› æ­¤è°ƒç”¨`env`ï¼ˆLinuxï¼‰æˆ–`set`ï¼ˆWindowsï¼‰ï¼Œæˆ–è€…æ‰“å°å…¶ç¯å¢ƒæˆ–å‚æ•°çš„ç¨‹åºå°†**ä¸ä¼šåœ¨æ„å»ºæ—¥å¿—ä¸­æ˜¾ç¤ºå®ƒä»¬**ï¼Œå¯¹äºé‚£äº›æœ¬æ¥æ— æ³•è®¿é—®å‡­è¯çš„ç”¨æˆ·æ¥è¯´ã€‚

**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ”»å‡»è€…è¦çªƒå–å‡­è¯æ—¶éœ€è¦ï¼Œä¾‹å¦‚ï¼Œå¯¹å®ƒä»¬è¿›è¡Œbase64ç¼–ç ã€‚**

## å‚è€ƒèµ„æ–™

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
