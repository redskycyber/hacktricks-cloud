# Podstawowe informacje o Jenkins

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Dostp

### Nazwa u偶ytkownika + Haso

Najczstszy spos贸b logowania do Jenkins to za pomoc nazwy u偶ytkownika lub hasa.

### Cookie

Jeli **skradziono autoryzowane cookie**, mo偶na je wykorzysta do uzyskania dostpu do sesji u偶ytkownika. Cookie zazwyczaj nosi nazw `JSESSIONID.*`. (U偶ytkownik mo偶e zakoczy wszystkie swoje sesje, ale najpierw musiaby dowiedzie si, 偶e cookie zostao skradzione).

### SSO/Wtyczki

Jenkins mo偶e by skonfigurowany za pomoc wtyczek, aby by **dostpny za porednictwem zewntrznego SSO**.

### Tokeny

**U偶ytkownicy mog generowa tokeny**, aby umo偶liwi aplikacjom podszycie si pod nich za pomoc interfejsu wiersza polece (CLI) lub interfejsu API REST.

### Klucze SSH

Ten komponent zapewnia wbudowany serwer SSH dla Jenkins. Jest to alternatywny interfejs dla [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), a polecenia mo偶na wywoywa w ten spos贸b za pomoc dowolnego klienta SSH. (Z [dokumentacji](https://plugins.jenkins.io/sshd/))

## Autoryzacja

W `/configureSecurity` mo偶na **skonfigurowa metod autoryzacji Jenkinsa**. Istnieje kilka opcji:

* **Ka偶dy mo偶e wszystko**: Nawet anonimowy dostp mo偶e zarzdza serwerem.
* **Tryb dziedziczny**: To samo co w Jenkinsie <1.164. Jeli masz rol **"admin"**, otrzymasz **pen kontrol** nad systemem, a w przeciwnym razie (w tym **u偶ytkownicy anonimowi**) uzyskasz dostp **tylko do odczytu**.
* **Zalogowani u偶ytkownicy mog wszystko**: W tym trybie **ka偶dy zalogowany u偶ytkownik ma pen kontrol** nad Jenkins. Jedynym u偶ytkownikiem, kt贸ry nie ma penej kontroli, jest **u偶ytkownik anonimowy**, kt贸ry otrzymuje **tylko dostp do odczytu**.
* **Bezpieczestwo oparte na macierzy**: Mo偶esz skonfigurowa, **kto mo偶e co robi** w tabeli. Ka偶da **kolumna** reprezentuje **uprawnienie**. Ka偶dy **wiersz** reprezentuje **u偶ytkownika lub grup/rol**. Obejmuje on specjalnego u偶ytkownika '**anonimowego**', kt贸ry reprezentuje **nieuwierzytelnionych u偶ytkownik贸w**, oraz '**uwierzytelnionego**', kt贸ry reprezentuje **wszystkich uwierzytelnionych u偶ytkownik贸w**.

![](<../../.gitbook/assets/image (149).png>)

* **Strategia autoryzacji oparta na macierzy projekt贸w:** Ten tryb to **rozszerzenie** do "**Bezpieczestwa opartego na macierzy**", kt贸re pozwala zdefiniowa dodatkow macierz ACL dla ka偶dego projektu osobno.
* **Strategia oparta na rolach:** Umo偶liwia definiowanie autoryzacji za pomoc **strategii opartej na rolach**. Zarzdzaj rolami w `/role-strategy`.

## **Dziedzina bezpieczestwa**

W `/configureSecurity` mo偶na **skonfigurowa dziedzin bezpieczestwa**. Domylnie Jenkins zawiera obsug kilku r贸偶nych dziedzin bezpieczestwa:

* **Deleguj do kontenera serwlet贸w**: Do **delegowania uwierzytelniania do kontenera serwlet贸w uruchamiajcego kontroler Jenkinsa**, takiego jak [Jetty](https://www.eclipse.org/jetty/).
* **Wasna baza danych u偶ytkownik贸w Jenkinsa:** U偶yj **wbudowanej bazy danych u偶ytkownik贸w Jenkinsa** do uwierzytelniania zamiast delegowa to do zewntrznego systemu. Jest to domylnie wczone.
* **LDAP**: Deleguj cae uwierzytelnianie do skonfigurowanego serwera LDAP, obejmujcego zar贸wno u偶ytkownik贸w, jak i grupy.
* **Baza danych u偶ytkownik贸w/grup Unix**: **Deleguje uwierzytelnianie do bazowej bazy danych u偶ytkownik贸w Unix** na kontrolerze Jenkinsa. Ten tryb pozwala r贸wnie偶 na ponowne wykorzystanie grup Unix do autoryzacji.

Wtyczki mog dostarcza dodatkowe dziedziny bezpieczestwa, kt贸re mog by przydatne do wczenia Jenkinsa do istniejcych system贸w to偶samoci, takich jak:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Wzy, Agenci i Wykonawcy Jenkinsa

Definicje z [dokumentacji](https://www.jenkins.io/doc/book/managing/nodes/):

**Wzy** to **maszyny**, na kt贸rych uruchamiane s **agenci budowy**. Jenkins monitoruje ka偶dy podczony wze pod ktem miejsca na dysku, wolnego miejsca tymczasowego, wolnej przestrzeni wymiany, czasu/zegara i czasu odpowiedzi. Wze jest wyczany, jeli kt贸re z tych wartoci przekracza skonfigurowany pr贸g.

**Agenci** **zarzdzaj** wykonaniem zada w imieniu kontrolera Jenkinsa, **korzystajc z wykonawc贸w**. Agent mo偶e korzysta z dowolnego systemu operacyjnego obsugujcego Jav. Narzdzia wymagane do budowy i test贸w s instalowane na w藕le, na kt贸rym dziaa agent; mog **by instalowane bezporednio lub w kontenerze** (Docker lub Kubernetes). Ka偶dy **agent jest efektywnie procesem z wasnym PID** na maszynie hosta.

**Wykonawca** to **slot do wykonywania zada**; efektywnie jest to **wtek w agencie**. Liczba wykonawc贸w na w藕le okrela liczb **r贸wnoczesnych zada**, kt贸re mo偶na wykona na tym w藕le jednoczenie. Innymi sowy, to okrela **liczb r贸wnoczesnych etap贸w `stages` Pipeline**, kt贸re mog by wykonywane na tym w藕le jednoczenie.

## Tajemnice Jenkinsa

### Szyfrowanie Tajemnic i Powiadcze

Definicja z [dokumentacji](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Jenkins u偶ywa **AES do szyfrowania i ochrony tajemnic**, powiadcze i ich odpowiednich kluczy szyfrowania. Te klucze szyfrowania s przechowywane w `$JENKINS_HOME/secrets/` wraz z g贸wnym kluczem u偶ywanym do ochrony tych kluczy. Ten katalog powinien by skonfigurowany tak, aby tylko u偶ytkownik systemu operacyjnego, na kt贸rym dziaa kontroler Jenkinsa, mia dostp do odczytu i zapisu do tego katalogu (tj. warto `chmod` `0700` lub odpowiednie atrybuty pliku). **G贸wny klucz** (czasami nazywany "kluczem szyfrowania klucza" w kryptojargonie) jest **przechowywany \_niezaszyfrowany**\_ na systemie plik贸w kontrolera Jenkinsa w **`$JENKINS_HOME/secrets/master.key`**, co nie chroni przed atakujcymi majcymi bezporedni dostp do tego pliku. Wikszo u偶ytkownik贸w i programist贸w bdzie korzysta z tych kluczy szyfrowania porednio za pomoc interfejsu API [Secret](https://javadoc.jenkins.io/byShortName/Secret) do szyfrowania og贸lnych danych tajnych lub za porednictwem interfejsu powiadcze. Dla ciekawych kryptografii, Jenkins u偶ywa AES w trybie szyfrowania blokowego acuchowego (CBC) z dopenieniem PKCS#5 i losowymi IV do szyfrowania instancji [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey), kt贸re s przechowywane w `$JENKINS_HOME/secrets/` z nazw pliku odpowiadajc ich id `CryptoConfidentialKey`. Wsp贸lne identyfikatory kluczy to:

* `hudson.util.Secret`: u偶ywany do og贸lnych tajemnic;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: u偶ywany dla niekt贸rych typ贸w powiadcze;
* `jenkins.model.Jenkins.crumbSalt`: u偶ywany przez [mechanizm ochrony CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); i
### Dostp do powiadcze

Powiadczenia mog by **ograniczone do globalnych dostawc贸w** (`/credentials/`), kt贸re mog by dostpne dla ka偶dego skonfigurowanego projektu, lub mog by ograniczone do **konkretnych projekt贸w** (`/job/<project-name>/configure`) i tym samym dostpne tylko z konkretnego projektu.

Zgodnie z [**dokumentacj**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Powiadczenia, kt贸re s w zasigu, s udostpniane potoku bez ogranicze. Aby **zapobiec przypadkowemu ujawnieniu w dzienniku budowy**, powiadczenia s **maskowane** z regularnego wyjcia, wic wywoanie `env` (Linux) lub `set` (Windows), lub programy drukujce swoje rodowisko lub parametry **nie ujawni ich w dzienniku budowy** dla u偶ytkownik贸w, kt贸rzy w innych przypadkach nie mieliby dostpu do powiadcze.

**Dlatego aby wydoby powiadczenia, atakujcy musi np. zakodowa je w base64.**

## Odnoniki

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
