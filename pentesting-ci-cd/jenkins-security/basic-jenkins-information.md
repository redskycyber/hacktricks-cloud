# Informaci贸n b谩sica de Jenkins

<details>

<summary><strong>Aprende hacking de AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Acceso

### Usuario + Contrase帽a

La forma m谩s com煤n de iniciar sesi贸n en Jenkins es con un nombre de usuario o una contrase帽a.

### Cookie

Si una **cookie autorizada es robada**, puede ser utilizada para acceder a la sesi贸n del usuario. La cookie suele llamarse `JSESSIONID.*`. (Un usuario puede terminar todas sus sesiones, pero primero tendr铆a que descubrir que se rob贸 una cookie).

### SSO/Plugins

Jenkins se puede configurar utilizando plugins para ser **accesible a trav茅s de SSO de terceros**.

### Tokens

**Los usuarios pueden generar tokens** para dar acceso a aplicaciones para suplantarlos a trav茅s de CLI o REST API.

### Claves SSH

Este componente proporciona un servidor SSH integrado para Jenkins. Es una interfaz alternativa para el [CLI de Jenkins](https://www.jenkins.io/doc/book/managing/cli/), y los comandos se pueden invocar de esta manera utilizando cualquier cliente SSH. (De la [documentaci贸n](https://plugins.jenkins.io/sshd/))

## Autorizaci贸n

En `/configureSecurity` es posible **configurar el m茅todo de autorizaci贸n de Jenkins**. Hay varias opciones:

* **Cualquiera puede hacer cualquier cosa**: Incluso el acceso an贸nimo puede administrar el servidor.
* **Modo heredado**: Igual que Jenkins <1.164. Si tienes el rol de **"admin"**, se te otorgar谩 **control total** sobre el sistema, y **de lo contrario** (incluidos los usuarios **an贸nimos**) tendr谩s acceso de **lectura**.
* **Los usuarios conectados pueden hacer cualquier cosa**: En este modo, cada **usuario conectado obtiene control total** de Jenkins. El 煤nico usuario que no tendr谩 control total es el **usuario an贸nimo**, que solo obtiene acceso de **lectura**.
* **Seguridad basada en matriz**: Puedes configurar **qui茅n puede hacer qu茅** en una tabla. Cada **columna** representa un **permiso**. Cada **fila** **representa** un **usuario o un grupo/rol**. Esto incluye un usuario especial '**an贸nimo**', que representa a los **usuarios no autenticados**, as铆 como '**autenticado**', que representa a **todos los usuarios autenticados**.

![](<../../.gitbook/assets/image (149).png>)

* **Estrategia de autorizaci贸n de matriz basada en proyectos:** Este modo es una **extensi贸n** de la seguridad basada en matriz que permite definir una matriz ACL adicional para cada proyecto por separado.
* **Estrategia basada en roles:** Permite definir autorizaciones utilizando una **estrategia basada en roles**. Gestiona los roles en `/role-strategy`.

## **Reino de seguridad**

En `/configureSecurity` es posible **configurar el reino de seguridad**. Por defecto, Jenkins incluye soporte para varios Reinos de Seguridad diferentes:

* **Delegar al contenedor servlet**: Para **delegar la autenticaci贸n a un contenedor servlet que ejecuta el controlador Jenkins**, como [Jetty](https://www.eclipse.org/jetty/).
* **Base de datos de usuarios propia de Jenkins:** Utiliza **la propia base de datos de usuarios integrada de Jenkins** para la autenticaci贸n en lugar de delegar en un sistema externo. Esto est谩 habilitado por defecto.
* **LDAP**: Delega toda la autenticaci贸n a un servidor LDAP configurado, incluidos usuarios y grupos.
* **Base de datos de usuarios/grupos Unix**: **Delega la autenticaci贸n al nivel de base de datos de usuarios Unix subyacente** en el controlador Jenkins. Este modo tambi茅n permitir谩 reutilizar los grupos Unix para la autorizaci贸n.

Los plugins pueden proporcionar reinos de seguridad adicionales que pueden ser 煤tiles para incorporar Jenkins en sistemas de identidad existentes, como:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [Autenticaci贸n de GitHub](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Nodos, Agentes y Ejecutores de Jenkins

Definiciones de la [documentaci贸n](https://www.jenkins.io/doc/book/managing/nodes/):

**Nodos** son las **m谩quinas** en las que se ejecutan los **agentes de construcci贸n**. Jenkins monitorea cada nodo adjunto para el espacio en disco, espacio temporal libre, intercambio libre, tiempo/reloj sincronizado y tiempo de respuesta. Un nodo se desconecta si alguno de estos valores supera el umbral configurado.

**Agentes** **gestionan** la **ejecuci贸n de tareas** en nombre del controlador Jenkins mediante **ejecutores**. Un agente puede utilizar cualquier sistema operativo que admita Java. Las herramientas requeridas para las construcciones y pruebas se instalan en el nodo donde se ejecuta el agente; pueden **instalarse directamente o en un contenedor** (Docker o Kubernetes). Cada **agente es efectivamente un proceso con su propio PID** en la m谩quina host.

Un **ejecutor** es un **espacio para la ejecuci贸n de tareas**; efectivamente, es **un hilo en el agente**. El **n煤mero de ejecutores** en un nodo define la cantidad de **tareas concurrentes** que se pueden ejecutar en ese nodo al mismo tiempo. En otras palabras, esto determina la cantidad de **`stages` de Pipeline concurrentes** que pueden ejecutarse en ese nodo al mismo tiempo.

## Secretos de Jenkins

### Encriptaci贸n de Secretos y Credenciales

Definici贸n de la [documentaci贸n](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Jenkins utiliza **AES para encriptar y proteger secretos**, credenciales y sus respectivas claves de encriptaci贸n. Estas claves de encriptaci贸n se almacenan en `$JENKINS_HOME/secrets/` junto con la clave maestra utilizada para proteger dichas claves. Este directorio debe configurarse para que solo el usuario del sistema operativo en el que se est谩 ejecutando el controlador Jenkins tenga acceso de lectura y escritura a este directorio (es decir, un valor `chmod` de `0700` o utilizando atributos de archivo apropiados). La **clave maestra** (a veces denominada "clave de encriptaci贸n de clave" en la jerga criptogr谩fica) se **almacena \_sin encriptar**\_ en el sistema de archivos del controlador Jenkins en **`$JENKINS_HOME/secrets/master.key`** lo que no protege contra atacantes con acceso directo a ese archivo. La mayor铆a de los usuarios y desarrolladores utilizar谩n estas claves de encriptaci贸n indirectamente a trav茅s de la API [Secret](https://javadoc.jenkins.io/byShortName/Secret) para encriptar datos secretos gen茅ricos o a trav茅s de la API de credenciales. Para los curiosos de la criptograf铆a, Jenkins utiliza AES en modo de cifrado por bloques encadenados (CBC) con relleno PKCS#5 e IVs aleatorios para encriptar instancias de [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) que se almacenan en `$JENKINS_HOME/secrets/` con un nombre de archivo correspondiente a su id de `CryptoConfidentialKey`. Los ids de clave comunes incluyen:

* `hudson.util.Secret`: utilizado para secretos gen茅ricos;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: utilizado para algunos tipos de credenciales;
* `jenkins.model.Jenkins.crumbSalt`: utilizado por el [mecanismo de protecci贸n CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); y
### Acceso a Credenciales

Las credenciales pueden estar **limitadas a proveedores globales** (`/credentials/`) que pueden ser accedidos por cualquier proyecto configurado, o pueden estar limitadas a **proyectos espec铆ficos** (`/job/<nombre-del-proyecto>/configure`) y por lo tanto solo accesibles desde el proyecto espec铆fico.

Seg煤n [**la documentaci贸n**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Las credenciales que est谩n en el alcance est谩n disponibles para el pipeline sin limitaciones. Para **prevenir la exposici贸n accidental en el registro de construcci贸n**, las credenciales est谩n **enmascaradas** en la salida regular, por lo que una invocaci贸n de `env` (Linux) o `set` (Windows), o programas que imprimen su entorno o par谩metros **no las revelar铆an en el registro de construcci贸n** a usuarios que de otra manera no tendr铆an acceso a las credenciales.

**Por eso, para extraer las credenciales, un atacante necesita, por ejemplo, codificarlas en base64.**

## Referencias

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
