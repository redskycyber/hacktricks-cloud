# Seguridad de Okta

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop).
* Obt茅n [**productos oficiales de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>

## Informaci贸n b谩sica

Okta, Inc. es una empresa de **gesti贸n de identidad y acceso** que proporciona software en la nube para ayudar a las empresas a **administrar y asegurar la autenticaci贸n de usuarios en aplicaciones modernas**, y para que los desarrolladores puedan construir controles de identidad en aplicaciones, servicios web y dispositivos.

Su servicio principal, llamado Okta Identity Cloud, ofrece productos que incluyen inicio de sesi贸n 煤nico (SSO), autenticaci贸n multifactor (MFA), gesti贸n del ciclo de vida, directorio universal, gesti贸n de acceso a API y m谩s. Esto ayuda a las empresas a proteger sus datos sensibles y tambi茅n a agilizar el acceso de los usuarios, haciendo que las aplicaciones y servicios sean m谩s accesibles y f谩ciles de usar para empleados o clientes.

Los servicios de Okta se utilizan ampliamente en contextos empresariales, as铆 como por empresas m谩s peque帽as y desarrolladores. Juega un papel crucial en permitir a las empresas adoptar y gestionar de forma segura las tecnolog铆as en la nube. Hasta mi fecha l铆mite de conocimiento en septiembre de 2021, Okta sigue siendo un actor importante en la industria de la gesti贸n de identidad y acceso (IAM).

{% hint style="danger" %}
El objetivo principal de Okta es configurar el acceso de diferentes usuarios y grupos a aplicaciones externas. Si logras **comprometer privilegios de administrador en un entorno de Okta**, es muy probable que puedas **comprometer todas las dem谩s plataformas que la empresa est茅 utilizando**.
{% endhint %}

{% hint style="success" %}
Para realizar una revisi贸n de seguridad de un entorno de Okta, debes solicitar acceso de solo lectura para administradores.
{% endhint %}

### Resumen

Existen **usuarios** (que pueden estar **almacenados en Okta**, registrados desde **proveedores de identidad** configurados o autenticados a trav茅s de **Active Directory** o LDAP). \
Estos usuarios pueden estar dentro de **grupos**.\
Tambi茅n existen **autenticadores**: diferentes opciones para autenticar como contrase帽a y varios m茅todos de autenticaci贸n de dos factores (2FA) como WebAuthn, correo electr贸nico, tel茅fono, Okta Verify (pueden estar habilitados o deshabilitados)...

Luego, hay **aplicaciones** sincronizadas con Okta. Cada aplicaci贸n tendr谩 un **mapeo con Okta** para compartir informaci贸n (como direcciones de correo electr贸nico, nombres...). Adem谩s, cada aplicaci贸n debe estar dentro de una **Pol铆tica de Autenticaci贸n**, que indica los **autenticadores necesarios** para que un usuario pueda **acceder** a la aplicaci贸n.

{% hint style="danger" %}
El rol m谩s poderoso es el de **Super Administrador**.

Si un atacante compromete Okta con acceso de administrador, es muy probable que todas las **aplicaciones que conf铆an en Okta** sean comprometidas.

Se pueden configurar los **atributos que cada usuario puede tener y modificar** (como correo electr贸nico o nombre). Si una **aplicaci贸n** conf铆a en un **atributo** que el usuario puede **modificar** como ID, podr谩 **suplantar a otros usuarios en esa plataforma**.
{% endhint %}

## Directorio

### Personas

Desde la perspectiva de un atacante, esto es muy interesante, ya que podr谩s ver **todos los usuarios registrados**, sus direcciones de **correo electr贸nico**, los **grupos** a los que pertenecen, los **perfiles** e incluso los **dispositivos** (m贸viles junto con sus sistemas operativos).

Para una revisi贸n en modo caja blanca, verifica que no haya varios "**Pending user action**" y "**Password reset**".

### Grupos

Aqu铆 es donde se encuentran todos los grupos creados en Okta. Es interesante comprender los diferentes grupos (conjunto de **permisos**) que se pueden otorgar a los **usuarios**.\
Es posible ver las **personas incluidas en los grupos** y las **aplicaciones asignadas** a cada grupo.

Por supuesto, cualquier grupo con el nombre de **admin** es interesante, especialmente el grupo **Global Administrators**, verifica los miembros para saber qui茅nes son los miembros m谩s privilegiados.

Desde una revisi贸n en modo caja blanca, **no deber铆a haber m谩s de 5 administradores globales** (mejor si hay solo 2 o 3).

### Dispositivos

Aqu铆 encontrar谩s una **lista de todos los dispositivos** de todos los usuarios. Tambi茅n puedes ver si se est谩 **gestionando activamente** o no.

### Editor de perfiles

Aqu铆 es posible observar c贸mo se comparten informaci贸n clave como nombres, apellidos, correos electr贸nicos, nombres de usuario, etc. entre Okta y otras aplicaciones. Esto es interesante porque si un usuario puede **modificar en Okta un campo** (como su nombre o correo electr贸nico) que luego es utilizado por una **aplicaci贸n externa** para **identificar** al usuario, un empleado podr铆a intentar **apoderarse de otras cuentas**.

Adem谩s, en el perfil **`User (default)`** de Okta, puedes ver **qu茅 campos** tiene cada **usuario** y cu谩les son **modificables** por los usuarios. Si no puedes ver el panel de administraci贸n, simplemente ve a **actualizar la informaci贸n de tu perfil** y ver谩s qu茅 campos puedes actualizar (ten en cuenta que para actualizar una direcci贸n de correo electr贸nico deber谩s verificarla).

### Integraciones de directorio

Los directorios te permiten importar personas desde fuentes existentes. Supongo que aqu铆 ver谩s los usuarios importados de otros directorios.

No lo he visto, pero supongo que esto es interesante para descubrir **otros directorios que Okta est谩 utilizando para importar usuarios**, por lo que si **comprometes ese directorio**, podr铆as establecer algunos valores de atributos en los usuarios creados en Okta y **comprometer el entorno de Okta**.

### Fuentes de perfil

Una fuente de perfil es una **aplicaci贸n que act煤a como fuente de verdad** para los atributos del perfil de usuario. Un usuario solo puede tener una fuente de perfil de una aplicaci贸n o directorio a la vez.

No lo he visto, por lo que se agradece cualquier informaci贸n sobre seguridad y hacking relacionada con esta opci贸n.
## Personalizaciones

### Marcas

Verifique en la pesta帽a **Dominios** de esta secci贸n las direcciones de correo electr贸nico utilizadas para enviar correos electr贸nicos y el dominio personalizado dentro de Okta de la empresa (que probablemente ya conozca).

Adem谩s, en la pesta帽a **Configuraci贸n**, si es administrador, puede "**Usar una p谩gina de cierre de sesi贸n personalizada**" y establecer una URL personalizada.

### SMS

Aqu铆 no hay nada interesante.

### Panel de control del usuario final

Aqu铆 puede encontrar las aplicaciones configuradas, pero veremos los detalles de estas m谩s adelante en una secci贸n diferente.

### Otros

Configuraci贸n interesante, pero nada super interesante desde el punto de vista de la seguridad.

## Aplicaciones

### Aplicaciones

Aqu铆 puede encontrar todas las aplicaciones configuradas y sus detalles: qui茅n tiene acceso a ellas, c贸mo est谩 configurado (SAML, OpenID), URL para iniciar sesi贸n, las asignaciones entre Okta y la aplicaci贸n...

En la pesta帽a **`Inicio de sesi贸n`** tambi茅n hay un campo llamado **`Revelar contrase帽a`** que permitir铆a a un usuario **revelar su contrase帽a** al verificar la configuraci贸n de la aplicaci贸n. Para verificar la configuraci贸n de una aplicaci贸n desde el Panel de usuario, haga clic en los 3 puntos:

<figure><img src="../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

Y podr铆a ver m谩s detalles sobre la aplicaci贸n (como la funci贸n de revelaci贸n de contrase帽a, si est谩 habilitada):

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

## Gobierno de identidad

### Certificaciones de acceso

Utilice las Certificaciones de acceso para crear campa帽as de auditor铆a para revisar peri贸dicamente el acceso de sus usuarios a los recursos y aprobar o revocar el acceso autom谩ticamente cuando sea necesario.

No lo he visto utilizado, pero supongo que desde un punto de vista defensivo es una buena caracter铆stica.

## Seguridad

### General

* **Correos electr贸nicos de notificaci贸n de seguridad**: Todos deber铆an estar habilitados.
* **Integraci贸n de CAPTCHA**: Se recomienda configurar al menos el reCaptcha invisible.
* **Seguridad de la organizaci贸n**: Todo se puede habilitar y los correos electr贸nicos de activaci贸n no deben durar mucho tiempo (7 d铆as est谩 bien).
* **Prevenci贸n de enumeraci贸n de usuarios**: Ambos deben estar habilitados.
* Tenga en cuenta que la prevenci贸n de enumeraci贸n de usuarios no tiene efecto si se permiten cualquiera de las siguientes condiciones (consulte [Gesti贸n de usuarios](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) para obtener m谩s informaci贸n):
* Registro de autoservicio
* Flujos JIT con autenticaci贸n por correo electr贸nico
* **Configuraci贸n de Okta ThreatInsight**: Registrar y hacer cumplir la seguridad seg煤n el nivel de amenaza.

### HealthInsight

Aqu铆 es posible encontrar configuraciones correctamente y **peligrosas**.

### Autenticadores

Aqu铆 puede encontrar todos los m茅todos de autenticaci贸n que un usuario podr铆a usar: contrase帽a, tel茅fono, correo electr贸nico, c贸digo, WebAuthn... Al hacer clic en el autenticador de contrase帽a, puede ver la **pol铆tica de contrase帽as**. Verifique que sea fuerte.

En la pesta帽a **Inscripci贸n** puede ver cu谩les son los que son requeridos u opcionales:

<figure><img src="../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

Se recomienda desactivar el tel茅fono. Los m谩s fuertes probablemente sean una combinaci贸n de contrase帽a, correo electr贸nico y WebAuthn.

### Pol铆ticas de autenticaci贸n

Cada aplicaci贸n tiene una pol铆tica de autenticaci贸n. La pol铆tica de autenticaci贸n verifica que los usuarios que intentan iniciar sesi贸n en la aplicaci贸n cumplan con condiciones espec铆ficas y aplica requisitos de factor basados en esas condiciones.

Aqu铆 puede encontrar los **requisitos para acceder a cada aplicaci贸n**. Se recomienda solicitar al menos una contrase帽a y otro m茅todo para cada aplicaci贸n. Pero si como atacante encuentra algo m谩s d茅bil, es posible que pueda atacarlo.

### Pol铆tica global de sesiones

Aqu铆 puede encontrar las pol铆ticas de sesi贸n asignadas a diferentes grupos. Por ejemplo:

<figure><img src="../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

Se recomienda solicitar MFA, limitar la duraci贸n de la sesi贸n a algunas horas, no persistir las cookies de sesi贸n en extensiones del navegador y limitar la ubicaci贸n y el proveedor de identidad (si esto es posible). Por ejemplo, si cada usuario debe iniciar sesi贸n desde un pa铆s, solo puede permitir esta ubicaci贸n.

### Proveedores de identidad

Los proveedores de identidad (IdP) son servicios que **gestionan cuentas de usuario**. Agregar IdP en Okta permite a sus usuarios finales **registrarse ellos mismos** con sus aplicaciones personalizadas autentic谩ndose primero con una cuenta social o una tarjeta inteligente.

En la p谩gina de Proveedores de identidad, puede agregar inicio de sesi贸n social (IdP) y configurar Okta como un proveedor de servicios (SP) agregando SAML entrante. Despu茅s de agregar IdP, puede configurar reglas de enrutamiento para dirigir a los usuarios a un IdP seg煤n el contexto, como la ubicaci贸n del usuario, el dispositivo o el dominio de correo electr贸nico.

**Si se configura alg煤n proveedor de identidad** desde el punto de vista de un atacante y un defensor, verifique esa configuraci贸n y **si la fuente es realmente confiable**, ya que un atacante que comprometa tambi茅n podr铆a obtener acceso al entorno de Okta.

### Autenticaci贸n delegada

La autenticaci贸n delegada permite a los usuarios iniciar sesi贸n en Okta ingresando las credenciales de su servidor de **Active Directory (AD) o LDAP** de la organizaci贸n.

Nuevamente, verifique esto, ya que un atacante que comprometa el AD de una organizaci贸n podr铆a ser capaz de pivotar a Okta gracias a esta configuraci贸n.

### Red

Una zona de red es un l铆mite configurable que puede utilizar para **conceder o restringir el acceso a computadoras y dispositivos** en su organizaci贸n seg煤n la **direcci贸n IP** que solicita el acceso. Puede definir una zona de red especificando una o m谩s direcciones IP individuales, rangos de direcciones IP o ubicaciones geogr谩ficas.

Despu茅s de definir una o m谩s zonas de red, puede **utilizarlas en las pol铆ticas globales de sesi贸n**, las pol铆ticas de autenticaci贸n, las notificaciones de VPN y las reglas de enrutamiento.

Desde la perspectiva de un atacante, es interesante saber qu茅 Ps est谩n permitidos (y verificar si alguna **IP tiene m谩s privilegios** que otras). Desde la perspectiva de un atacante, si los usuarios deben acceder desde una direcci贸n IP o regi贸n espec铆fica, verifique que esta funci贸n se utilice correctamente.

### Integraciones de dispositivos

* **Gesti贸n de puntos finales**: La gesti贸n de puntos finales es una condici贸n que se puede aplicar en una pol铆tica de autenticaci贸n para garantizar que los dispositivos administrados tengan acceso a una aplicaci贸n.
* A煤n no he visto esto utilizado. POR HACER
* **Servicios de notificaci贸n**: A煤n no he visto esto utilizado. POR HACER

### API

Puede crear tokens de API de Okta en esta p谩gina y ver los que se han **creado**, sus **privilegios**, el tiempo de **vencimiento** y las **URL de origen**. Tenga en cuenta que los tokens de API se generan con los permisos del usuario que cre贸 el token y solo son v谩lidos si el **usuario** que los cre贸 est谩 **activo**.

Los **Or铆genes confiables** otorgan acceso a sitios web que controla y en los que conf铆a para acceder a su organizaci贸n de Okta a trav茅s de la API de Okta.

No deber铆a haber muchos tokens de API, ya que si hay muchos, un atacante podr铆a intentar acceder a ellos y usarlos.
## Flujo de trabajo

### Automatizaciones

Las automatizaciones te permiten crear acciones automatizadas que se ejecutan en funci贸n de un conjunto de condiciones de activaci贸n que ocurren durante el ciclo de vida de los usuarios finales.

Por ejemplo, una condici贸n podr铆a ser "Inactividad del usuario en Okta" o "Caducidad de la contrase帽a del usuario en Okta" y la acci贸n podr铆a ser "Enviar un correo electr贸nico al usuario" o "Cambiar el estado del ciclo de vida del usuario en Okta".

## Informes

### Informes

Descarga registros. Se **env铆an** a la **direcci贸n de correo electr贸nico** de la cuenta actual.

### Registro del sistema

Aqu铆 puedes encontrar los **registros de las acciones realizadas por los usuarios** con muchos detalles, como el inicio de sesi贸n en Okta o en aplicaciones a trav茅s de Okta.

### Monitoreo de importaci贸n

Esto puede **importar registros de otras plataformas** a las que se accede con Okta.

### L铆mites de velocidad

Verifica los l铆mites de velocidad de la API alcanzados.

## Configuraciones

### Cuenta

Aqu铆 puedes encontrar informaci贸n **gen茅rica** sobre el entorno de Okta, como el nombre de la empresa, la direcci贸n, el **contacto de facturaci贸n por correo electr贸nico**, el **contacto t茅cnico por correo electr贸nico** y tambi茅n qui茅n debe recibir las actualizaciones de Okta y qu茅 tipo de actualizaciones de Okta.

### Descargas

Aqu铆 puedes descargar agentes de Okta para sincronizar Okta con otras tecnolog铆as.

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, 隆consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PR a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
