# GCP - Artifact Registryææƒ

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFT](https://opensea.io/collection/the-peass-family)æ”¶è—å“
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ã€‚**
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## Artifact Registry

æœ‰å…³Artifact Registryçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="../gcp-services/gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](../gcp-services/gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### artifactregistry.repositories.uploadArtifacts

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥ä¸Šä¼ å¸¦æœ‰æ¶æ„ä»£ç çš„æ–°ç‰ˆæœ¬çš„å·¥ä»¶ï¼Œå¦‚Dockeré•œåƒï¼š

{% code overflow="wrap" %}
```bash
# Configure docker to use gcloud to authenticate with Artifact Registry
gcloud auth configure-docker <location>-docker.pkg.dev

# tag the image to upload it
docker tag <local-img-name>:<local-tag> <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>

# Upload it
docker push <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
{% endcode %}

{% hint style="danger" %}
å·²ç»æ£€æŸ¥åˆ°**å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæ–°çš„æ¶æ„docker**é•œåƒï¼Œä¸å·²ç»å­˜åœ¨çš„ç›¸åŒåç§°å’Œæ ‡ç­¾ï¼Œå› æ­¤**æ—§çš„å°†å¤±å»æ ‡ç­¾**ï¼Œä¸‹æ¬¡ä¸‹è½½å¸¦æœ‰è¯¥æ ‡ç­¾çš„é•œåƒæ—¶ï¼Œå°†ä¸‹è½½**æ¶æ„çš„é•œåƒ**ã€‚
{% endhint %}

<details>

<summary>ä¸Šä¼ ä¸€ä¸ªPythonåº“</summary>

**é¦–å…ˆåˆ›å»ºè¦ä¸Šä¼ çš„åº“**ï¼ˆå¦‚æœå¯ä»¥ä»æ³¨å†Œè¡¨ä¸­ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼Œåˆ™å¯ä»¥é¿å…æ­¤æ­¥éª¤ï¼‰ï¼š

1. **è®¾ç½®é¡¹ç›®ç»“æ„**ï¼š

* ä¸ºæ‚¨çš„åº“åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œä¾‹å¦‚`hello_world_library`ã€‚
* åœ¨æ­¤ç›®å½•å†…ï¼Œåˆ›å»ºå¦ä¸€ä¸ªç›®å½•ï¼Œä½¿ç”¨æ‚¨çš„åŒ…åç§°ï¼Œä¾‹å¦‚`hello_world`ã€‚
* åœ¨æ‚¨çš„åŒ…ç›®å½•å†…ï¼Œåˆ›å»ºä¸€ä¸ª`__init__.py`æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶å¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥åŒ…å«å¯¹æ‚¨çš„åŒ…çš„åˆå§‹åŒ–ã€‚

```bash
mkdir hello_world_library
cd hello_world_library
mkdir hello_world
touch hello_world/__init__.py
```
2. **ç¼–å†™æ‚¨çš„åº“ä»£ç **ï¼š

* åœ¨`hello_world`ç›®å½•å†…ï¼Œä¸ºæ‚¨çš„æ¨¡å—åˆ›å»ºä¸€ä¸ªæ–°çš„Pythonæ–‡ä»¶ï¼Œä¾‹å¦‚`greet.py`ã€‚
* ç¼–å†™æ‚¨çš„â€œHello, World!â€å‡½æ•°ï¼š

```python
# hello_world/greet.py
def say_hello():
return "Hello, World!"
```
3. **åˆ›å»ºä¸€ä¸ª`setup.py`æ–‡ä»¶**ï¼š

* åœ¨æ‚¨çš„`hello_world_library`ç›®å½•çš„æ ¹ç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª`setup.py`æ–‡ä»¶ã€‚
* æ­¤æ–‡ä»¶åŒ…å«æœ‰å…³æ‚¨çš„åº“çš„å…ƒæ•°æ®ï¼Œå¹¶å‘Šè¯‰Pythonå¦‚ä½•å®‰è£…å®ƒã€‚

```python
# setup.py
from setuptools import setup, find_packages

setup(
name='hello_world',
version='0.1',
packages=find_packages(),
install_requires=[
# æ‚¨çš„åº“éœ€è¦çš„ä»»ä½•ä¾èµ–é¡¹
],
)
```



**ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¸Šä¼ åº“ï¼š**

1. **æ„å»ºæ‚¨çš„åŒ…**ï¼š

* ä»æ‚¨çš„`hello_world_library`ç›®å½•çš„æ ¹ç›®å½•è¿è¡Œï¼š

```sh
python3 setup.py sdist bdist_wheel
```
2. **ä¸ºtwineé…ç½®èº«ä»½éªŒè¯**ï¼ˆç”¨äºä¸Šä¼ æ‚¨çš„åŒ…ï¼‰ï¼š

* ç¡®ä¿å·²å®‰è£…`twine`ï¼ˆ`pip install twine`ï¼‰ã€‚
* ä½¿ç”¨`gcloud`é…ç½®å‡­æ®ï¼š

{% code overflow="wrap" %}
```sh
twine upload --username 'oauth2accesstoken' --password "$(gcloud auth print-access-token)" --repository-url https://<location>-python.pkg.dev/<project-id>/<repo-name>/ dist/*
```
{% endcode %}

<!---->

3. **æ¸…ç†æ„å»º**
```bash
rm -rf dist build hello_world.egg-info
```
</details>

{% hint style="danger" %}
æ— æ³•ä¸Šä¼ ä¸å·²å­˜åœ¨ç‰ˆæœ¬ç›¸åŒçš„Pythonåº“ï¼Œä½†å¯ä»¥ä¸Šä¼ **æ›´é«˜çš„ç‰ˆæœ¬**ï¼ˆæˆ–åœ¨ç‰ˆæœ¬æœ«å°¾æ·»åŠ é¢å¤–çš„**`.0` -ä¸é€‚ç”¨äºPython-**ï¼‰ï¼Œæˆ–è€…**åˆ é™¤æœ€åä¸€ä¸ªç‰ˆæœ¬å¹¶ä¸Šä¼ ä¸€ä¸ªæ–°ç‰ˆæœ¬**ï¼ˆéœ€è¦`artifactregistry.versions.delete)`**ï¼š**

{% code overflow="wrap" %}
```sh
gcloud artifacts versions delete <version> --repository=<repo-name> --location=<location> --package=<lib-name>
```
{% endcode %}
{% endhint %}

### `artifactregistry.repositories.downloadArtifacts`

æ‹¥æœ‰æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥**ä¸‹è½½å·¥ä»¶**å¹¶æœç´¢**æ•æ„Ÿä¿¡æ¯**å’Œ**æ¼æ´**ã€‚

ä¸‹è½½ä¸€ä¸ª**Docker**é•œåƒï¼š
```sh
# Configure docker to use gcloud to authenticate with Artifact Registry
gcloud auth configure-docker <location>-docker.pkg.dev

# Dowload image
docker pull <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
ä¸‹è½½ä¸€ä¸ª **python** åº“ï¼š

{% code overflow="wrap" %}
```bash
pip install <lib-name> --index-url "https://oauth2accesstoken:$(gcloud auth print-access-token)@<location>-python.pkg.dev/<project-id>/<repo-name>/simple/" --trusted-host <location>-python.pkg.dev --no-cache-dir
```
{% endcode %}

* å¦‚æœåœ¨è™šæ‹Ÿå­˜å‚¨åº“ä¸­æ··åˆäº†è¿œç¨‹å­˜å‚¨åº“å’Œæ ‡å‡†å­˜å‚¨åº“ï¼Œå¹¶ä¸”ä¸€ä¸ªè½¯ä»¶åŒ…åŒæ—¶å­˜åœ¨äºä¸¤è€…ä¸­ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè¯·æŸ¥çœ‹æ­¤é¡µé¢ï¼š

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

### `artifactregistry.tags.delete`ã€`artifactregistry.versions.delete`ã€`artifactregistry.packages.delete`ã€(`artifactregistry.repositories.get`ã€`artifactregistry.tags.get`ã€`artifactregistry.tags.list`)

ä»å­˜å‚¨åº“ä¸­åˆ é™¤å·¥ä»¶ï¼Œå¦‚ Docker é•œåƒï¼š

{% code overflow="wrap" %}
```bash
# Delete a docker image
gcloud artifacts docker images delete <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
### `artifactregistry.repositories.delete`

åˆ é™¤ä¸€ä¸ªå®Œæ•´çš„å­˜å‚¨åº“ï¼ˆå³ä½¿å®ƒåŒ…å«å†…å®¹ï¼‰ï¼š
```
gcloud artifacts repositories delete <repo-name> --location=<location>
```
### `artifactregistry.repositories.setIamPolicy`

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥ç»™è‡ªå·±æˆäºˆæ‰§è¡Œå…ˆå‰æåˆ°çš„ä¸€äº›å­˜å‚¨åº“æ”»å‡»çš„æƒé™ã€‚

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
