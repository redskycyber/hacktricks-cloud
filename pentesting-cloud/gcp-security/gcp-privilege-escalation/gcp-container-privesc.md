# GCP - ì»¨í…Œì´ë„ˆ ê¶Œí•œ ìƒìŠ¹

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œì—ì„œ ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ì„ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°êµë¥¼ ê³µìœ í•˜ì„¸ìš”.

</details>

## ì»¨í…Œì´ë„ˆ

### `container.clusters.get`

ì´ ê¶Œí•œì€ Kubernetes í´ëŸ¬ìŠ¤í„°ì˜ ìê²© ì¦ëª…ì„ ìˆ˜ì§‘í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gcloud container clusters get-credentials <cluster_name> --zone <zone>
```
ì¶”ê°€ ê¶Œí•œì´ ì—†ìœ¼ë©´ ìê²© ì¦ëª…ì€ ë§¤ìš° ê¸°ë³¸ì ì…ë‹ˆë‹¤. **ì¼ë¶€ ë¦¬ì†ŒìŠ¤ë¥¼ ì—´ê±°í•  ìˆ˜ë§Œ ìˆìŠµë‹ˆë‹¤**. ê·¸ëŸ¬ë‚˜ ì´ëŠ” í™˜ê²½ì—ì„œ ì˜ëª»ëœ êµ¬ì„±ì„ ì°¾ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.

{% hint style="info" %}
ì°¸ê³ ë¡œ **ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ëŠ” ë¹„ê³µê°œë¡œ êµ¬ì„±**ë  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì¸í„°ë„·ì—ì„œ Kube-API ì„œë²„ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ê¸ˆì§€í•©ë‹ˆë‹¤.
{% endhint %}

ì´ ê¶Œí•œì´ ì—†ìœ¼ë©´ ì—¬ì „íˆ í´ëŸ¬ìŠ¤í„°ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆì§€ë§Œ, í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ í¬í•¨í•œ **ìì²´ kubectl êµ¬ì„± íŒŒì¼ì„ ìƒì„±**í•´ì•¼ í•©ë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```yaml
apiVersion: v1
clusters:
- cluster:
certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVMRENDQXBTZ0F3SUJBZ0lRRzNaQmJTSVlzeVRPR1FYODRyNDF3REFOQmdrcWhraUc5dzBCQVFzRkFEQXYKTVMwd0t3WURWUVFERXlRMk9UQXhZVEZoWlMweE56ZGxMVFF5TkdZdE9HVmhOaTAzWVdFM01qVmhNR05tTkdFdwpJQmNOTWpJeE1qQTBNakl4T1RJMFdoZ1BNakExTWpFeE1qWXlNekU1TWpSYU1DOHhMVEFyQmdOVkJBTVRKRFk1Ck1ERmhNV0ZsTFRFM04yVXROREkwWmkwNFpXRTJMVGRoWVRjeU5XRXdZMlkwWVRDQ0FhSXdEUVlKS29aSWh2Y04KQVFFQkJRQURnZ0dQQURDQ0FZb0NnZ0dCQU00TWhGemJ3Y3VEQXhiNGt5WndrNEdGNXRHaTZmb0pydExUWkI4Rgo5TDM4a2V2SUVWTHpqVmtoSklpNllnSHg4SytBUHl4RHJQaEhXMk5PczFNMmpyUXJLSHV6M0dXUEtRUmtUWElRClBoMy9MMDVtbURwRGxQK3hKdzI2SFFqdkE2Zy84MFNLakZjRXdKRVhZbkNMMy8yaFBFMzdxN3hZbktwTWdKVWYKVnoxOVhwNEhvbURvOEhUN2JXUTJKWTVESVZPTWNpbDhkdDZQd3FUYmlLNjJoQzNRTHozNzNIbFZxaiszNy90RgpmMmVwUUdFOG90a0VVOFlHQ3FsRTdzaVllWEFqbUQ4bFZENVc5dk1RNXJ0TW8vRHBTVGNxRVZUSzJQWk1rc0hyCmMwbGVPTS9LeXhnaS93TlBRdW5oQ2hnRUJIZTVzRmNxdmRLQ1pmUFovZVI1Qk0vc0w1WFNmTE9sWWJLa2xFL1YKNFBLNHRMVmpiYVg1VU9zMUZIVXMrL3IyL1BKQ2hJTkRaVTV2VjU0L1c5NWk4RnJZaUpEYUVGN0pveXJvUGNuMwpmTmNjQ2x1eGpOY1NsZ01ISGZKRzZqb0FXLzB0b2U3ek05RHlQOFh3NW44Zm5lQm5aVTFnYXNKREZIYVlZbXpGCitoQzFETmVaWXNibWNxOGVPVG9LOFBKRjZ3SURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQWdRd0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVU5UkhvQXlxY3RWSDVIcmhQZ1BjYzF6Sm9kWFV3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFLbnp3VEx0QlJBVE1KRVB4TlBNbmU2UUNqZDJZTDgxcC9oeVc1eWpYb2w5CllkMTRRNFVlVUJJVXI0QmJadzl0LzRBQ3ZlYUttVENaRCswZ2wyNXVzNzB3VlFvZCtleVhEK2I1RFBwUUR3Z1gKbkJLcFFCY1NEMkpvZ29tT3M3U1lPdWVQUHNrODVvdWEwREpXLytQRkY1WU5ublc3Z1VLT2hNZEtKcnhuYUVGZAprVVl1TVdPT0d4U29qVndmNUsyOVNCbGJ5YXhDNS9tOWkxSUtXV2piWnZPN0s4TTlYLytkcDVSMVJobDZOSVNqCi91SmQ3TDF2R0crSjNlSjZneGs4U2g2L28yRnhxZWFNdDladWw4MFk4STBZaGxXVmlnSFMwZmVBUU1NSzUrNzkKNmozOWtTZHFBYlhPaUVOMzduOWp2dVlNN1ZvQzlNUk1oYUNyQVNhR2ZqWEhtQThCdlIyQW5iQThTVGpQKzlSMQp6VWRpK3dsZ0V4bnFvVFpBcUVHRktuUTlQcjZDaDYvR0xWWStqYXhuR3lyUHFPYlpNZTVXUDFOUGs4NkxHSlhCCjc1elFvanEyRUpxanBNSjgxT0gzSkxOeXRTdmt4UDFwYklxTzV4QUV0OWxRMjh4N28vbnRuaWh1WmR6M0lCRU8KODdjMDdPRGxYNUJQd0hIdzZtKzZjUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
server: https://34.123.141.28
name: gke_security-devbox_us-central1_autopilot-cluster-1
contexts:
- context:
cluster: gke_security-devbox_us-central1_autopilot-cluster-1
user: gke_security-devbox_us-central1_autopilot-cluster-1
name: gke_security-devbox_us-central1_autopilot-cluster-1
current-context: gke_security-devbox_us-central1_autopilot-cluster-1
kind: Config
preferences: {}
users:
- name: gke_security-devbox_us-central1_autopilot-cluster-1
user:
auth-provider:
config:
access-token: <access token>
cmd-args: config config-helper --format=json
cmd-path: gcloud
expiry: "2022-12-06T01:13:11Z"
expiry-key: '{.credential.token_expiry}'
token-key: '{.credential.access_token}'
name: gcp
```
### `container.roles.escalate` | `container.clusterRoles.escalate`

ê¸°ë³¸ì ìœ¼ë¡œ **Kubernetes**ëŠ” ì£¼ì²´ê°€ ê°€ì§€ê³  ìˆëŠ” ê¶Œí•œë³´ë‹¤ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§„ **Roles**ì™€ **ClusterRoles**ì„ **ìƒì„±**í•˜ê±°ë‚˜ **ì—…ë°ì´íŠ¸**í•˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ê¶Œí•œì„ ê°€ì§„ **GCP** ì£¼ì²´ëŠ” Kubernetesì˜ ì´ëŸ¬í•œ ë™ì‘ì— ëŒ€í•œ ë³´í˜¸ë¥¼ ìš°íšŒí•˜ì—¬ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§„ Roles/ClusterRolesì„ ìƒì„±/ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ê¶Œí•œì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” **`container.roles.create`** ë°/ë˜ëŠ” **`container.roles.update`** ë˜ëŠ” **`container.clusterRoles.create`** ë°/ë˜ëŠ” **`container.clusterRoles.update`**ë„ í•„ìš”í•©ë‹ˆë‹¤.

### `container.roles.bind` | `container.clusterRoles.bind`

ê¸°ë³¸ì ìœ¼ë¡œ **Kubernetes**ëŠ” ì£¼ì²´ê°€ ê°€ì§€ê³  ìˆëŠ” ê¶Œí•œë³´ë‹¤ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§„ **RoleBindings**ì™€ **ClusterRoleBindings**ì„ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ê¶Œí•œì„ ê°€ì§„ **GCP** ì£¼ì²´ëŠ” Kubernetesì˜ ì´ëŸ¬í•œ ë™ì‘ì— ëŒ€í•œ ë³´í˜¸ë¥¼ ìš°íšŒí•˜ì—¬ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§„ RoleBindings/ClusterRoleBindingsì„ ìƒì„±/ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ê¶Œí•œì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” **`container.roleBindings.create`** ë°/ë˜ëŠ” **`container.roleBindings.update`** ë˜ëŠ” **`container.clusterRoleBindings.create`** ë°/ë˜ëŠ” **`container.clusterRoleBindings.update`**ë„ í•„ìš”í•©ë‹ˆë‹¤.

### `container.cronJobs.create` | `container.cronJobs.update` | `container.daemonSets.create` | `container.daemonSets.update` | `container.deployments.create` | `container.deployments.update` | `container.jobs.create` | `container.jobs.update` | `container.pods.create` | `container.pods.update` | `container.replicaSets.create` | `container.replicaSets.update` | `container.replicationControllers.create` | `container.replicationControllers.update` | `container.scheduledJobs.create` | `container.scheduledJobs.update` | `container.statefulSets.create` | `container.statefulSets.update`

ì´ëŸ¬í•œ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ **ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸**í•  ìˆ˜ ìˆìœ¼ë©°, **pod**ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. podë¥¼ ì •ì˜í•˜ë©´ **ì—°ê²°**ë  **SA**ì™€ **ì‹¤í–‰ë  ì´ë¯¸ì§€**ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, SAì˜ í† í°ì„ ì„œë²„ë¡œ **ìœ ì¶œì‹œí‚¤ëŠ” ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰**í•˜ì—¬ ëª¨ë“  ì„œë¹„ìŠ¤ ê³„ì •ìœ¼ë¡œ ìŠ¹ê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤:

GCP í™˜ê²½ì—ì„œëŠ” **ë©”íƒ€ë°ì´í„°** ì„œë¹„ìŠ¤ì—ì„œ **ë…¸ë“œí’€ GCP SA**ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ GC**Pì—ì„œ ê¶Œí•œì„ ìŠ¹ê²©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ê¸°ë³¸ì ìœ¼ë¡œ compute SAê°€ ì‚¬ìš©ë©ë‹ˆë‹¤).

### `container.secrets.get` | `container.secrets.list`

ì´ëŸ¬í•œ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ [**ì´ í˜ì´ì§€ì—ì„œ ì„¤ëª…í•œëŒ€ë¡œ**](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#listing-secrets) Kubernetesì˜ ëª¨ë“  SAì˜ **í† í°**ì„ **ì½ì„ ìˆ˜** ìˆìœ¼ë¯€ë¡œ, ìŠ¹ê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `container.pods.exec`

ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ **podì— ì‹¤í–‰**í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ K8s ë‚´ì—ì„œ ê¶Œí•œì„ ìŠ¹ê²©í•  ìˆ˜ ìˆëŠ” ëª¨ë“  Kubernetes SAì— **ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ **NodePool**ì˜ **GCP ì„œë¹„ìŠ¤ ê³„ì •**ì„ **í›”ì¹ ** ìˆ˜ ìˆì–´ GCPì—ì„œ ê¶Œí•œì„ ìŠ¹ê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `container.pods.portForward`

ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ [**ì´ í˜ì´ì§€ì—ì„œ ì„¤ëª…í•œëŒ€ë¡œ**](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#malicious-admission-controller) **pod**ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ **ë¡œì»¬ ì„œë¹„ìŠ¤**ì— **ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ Kubernetes(ë° GCP)ì—ì„œ ê¶Œí•œì„ ìŠ¹ê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `container.serviceAccounts.createToken`

ì´ ê¶Œí•œì˜ ì´ë¦„ìœ¼ë¡œ ë³´ì•„ K8s ì„œë¹„ìŠ¤ ê³„ì •ì˜ í† í°ì„ ìƒì„±í•  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ë”°ë¼ì„œ Kubernetes ë‚´ì˜ ëª¨ë“  SAë¡œ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ í•´ë‹¹ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì§€ ëª»í–ˆìœ¼ë¯€ë¡œ ì°¾ìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš”.

### `container.mutatingWebhookConfigurations.create` | `container.mutatingWebhookConfigurations.update`

ì´ëŸ¬í•œ ê¶Œí•œì€ Kubernetesì—ì„œ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•  ìˆ˜ ìˆì§€ë§Œ, ë” ìì£¼ í´ëŸ¬ìŠ¤í„°ì— **ì˜ì†ì„±ì„ ìœ ì§€**í•˜ê¸° ìœ„í•´ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ìì„¸í•œ ì •ë³´ëŠ” [**ì´ ë§í¬ë¥¼ ë”°ë¥´ì„¸ìš”**](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#malicious-admission-controller).
