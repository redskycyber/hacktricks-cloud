# GCP - ã‚³ãƒ³ãƒ†ãƒŠç‰¹æ¨©æ˜‡æ ¼

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong>ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã¾ã—ã‚‡ã†ï¼</summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

- **HackTricksã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„**å ´åˆã‚„**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
- [**å…¬å¼PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[NFTs](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
- ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã™ã‚‹ã€‚
- **HackTricks**ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>

## container

### `container.clusters.get`

ã“ã®æ¨©é™ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªæ–¹æ³•ã§**Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®è³‡æ ¼æƒ…å ±ã‚’åé›†**ã§ãã¾ã™ï¼š
```bash
gcloud container clusters get-credentials <cluster_name> --zone <zone>
```
è¿½åŠ ã®æ¨©é™ãŒãªã„å ´åˆã€è³‡æ ¼æƒ…å ±ã¯ã‹ãªã‚ŠåŸºæœ¬çš„ã§ã™ãŒã€**ã„ãã¤ã‹ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒªã‚¹ãƒˆã™ã‚‹ã ã‘**ã§ãã¾ã™ãŒã€ç’°å¢ƒã®è¨­å®šãƒŸã‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

{% hint style="info" %}
**kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§**ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰Kube-APIã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã™ã€‚
{% endhint %}

ã“ã®æ¨©é™ãŒãªã„å ´åˆã§ã‚‚ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã™ãŒã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®æƒ…å ±ã‚’å«ã‚€**ç‹¬è‡ªã®kubectlæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ–°ã—ãç”Ÿæˆã•ã‚ŒãŸã‚‚ã®ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š
```yaml
apiVersion: v1
clusters:
- cluster:
certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVMRENDQXBTZ0F3SUJBZ0lRRzNaQmJTSVlzeVRPR1FYODRyNDF3REFOQmdrcWhraUc5dzBCQVFzRkFEQXYKTVMwd0t3WURWUVFERXlRMk9UQXhZVEZoWlMweE56ZGxMVFF5TkdZdE9HVmhOaTAzWVdFM01qVmhNR05tTkdFdwpJQmNOTWpJeE1qQTBNakl4T1RJMFdoZ1BNakExTWpFeE1qWXlNekU1TWpSYU1DOHhMVEFyQmdOVkJBTVRKRFk1Ck1ERmhNV0ZsTFRFM04yVXROREkwWmkwNFpXRTJMVGRoWVRjeU5XRXdZMlkwWVRDQ0FhSXdEUVlKS29aSWh2Y04KQVFFQkJRQURnZ0dQQURDQ0FZb0NnZ0dCQU00TWhGemJ3Y3VEQXhiNGt5WndrNEdGNXRHaTZmb0pydExUWkI4Rgo5TDM4a2V2SUVWTHpqVmtoSklpNllnSHg4SytBUHl4RHJQaEhXMk5PczFNMmpyUXJLSHV6M0dXUEtRUmtUWElRClBoMy9MMDVtbURwRGxQK3hKdzI2SFFqdkE2Zy84MFNLakZjRXdKRVhZbkNMMy8yaFBFMzdxN3hZbktwTWdKVWYKVnoxOVhwNEhvbURvOEhUN2JXUTJKWTVESVZPTWNpbDhkdDZQd3FUYmlLNjJoQzNRTHozNzNIbFZxaiszNy90RgpmMmVwUUdFOG90a0VVOFlHQ3FsRTdzaVllWEFqbUQ4bFZENVc5dk1RNXJ0TW8vRHBTVGNxRVZUSzJQWk1rc0hyCmMwbGVPTS9LeXhnaS93TlBRdW5oQ2hnRUJIZTVzRmNxdmRLQ1pmUFovZVI1Qk0vc0w1WFNmTE9sWWJLa2xFL1YKNFBLNHRMVmpiYVg1VU9zMUZIVXMrL3IyL1BKQ2hJTkRaVTV2VjU0L1c5NWk4RnJZaUpEYUVGN0pveXJvUGNuMwpmTmNjQ2x1eGpOY1NsZ01ISGZKRzZqb0FXLzB0b2U3ek05RHlQOFh3NW44Zm5lQm5aVTFnYXNKREZIYVlZbXpGCitoQzFETmVaWXNibWNxOGVPVG9LOFBKRjZ3SURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQWdRd0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVU5UkhvQXlxY3RWSDVIcmhQZ1BjYzF6Sm9kWFV3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFLbnp3VEx0QlJBVE1KRVB4TlBNbmU2UUNqZDJZTDgxcC9oeVc1eWpYb2w5CllkMTRRNFVlVUJJVXI0QmJadzl0LzRBQ3ZlYUttVENaRCswZ2wyNXVzNzB3VlFvZCtleVhEK2I1RFBwUUR3Z1gKbkJLcFFCY1NEMkpvZ29tT3M3U1lPdWVQUHNrODVvdWEwREpXLytQRkY1WU5ublc3Z1VLT2hNZEtKcnhuYUVGZAprVVl1TVdPT0d4U29qVndmNUsyOVNCbGJ5YXhDNS9tOWkxSUtXV2piWnZPN0s4TTlYLytkcDVSMVJobDZOSVNqCi91SmQ3TDF2R0crSjNlSjZneGs4U2g2L28yRnhxZWFNdDladWw4MFk4STBZaGxXVmlnSFMwZmVBUU1NSzUrNzkKNmozOWtTZHFBYlhPaUVOMzduOWp2dVlNN1ZvQzlNUk1oYUNyQVNhR2ZqWEhtQThCdlIyQW5iQThTVGpQKzlSMQp6VWRpK3dsZ0V4bnFvVFpBcUVHRktuUTlQcjZDaDYvR0xWWStqYXhuR3lyUHFPYlpNZTVXUDFOUGs4NkxHSlhCCjc1elFvanEyRUpxanBNSjgxT0gzSkxOeXRTdmt4UDFwYklxTzV4QUV0OWxRMjh4N28vbnRuaWh1WmR6M0lCRU8KODdjMDdPRGxYNUJQd0hIdzZtKzZjUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
server: https://34.123.141.28
name: gke_security-devbox_us-central1_autopilot-cluster-1
contexts:
- context:
cluster: gke_security-devbox_us-central1_autopilot-cluster-1
user: gke_security-devbox_us-central1_autopilot-cluster-1
name: gke_security-devbox_us-central1_autopilot-cluster-1
current-context: gke_security-devbox_us-central1_autopilot-cluster-1
kind: Config
preferences: {}
users:
- name: gke_security-devbox_us-central1_autopilot-cluster-1
user:
auth-provider:
config:
access-token: <access token>
cmd-args: config config-helper --format=json
cmd-path: gcloud
expiry: "2022-12-06T01:13:11Z"
expiry-key: '{.credential.token_expiry}'
token-key: '{.credential.access_token}'
name: gcp
```
### `container.roles.escalate` | `container.clusterRoles.escalate`

**Kubernetes**ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ä¸»ä½“ãŒæŒã£ã¦ã„ã‚‹æ¨©é™ã‚ˆã‚Šã‚‚å¤šãã®æ¨©é™ã‚’æŒã¤**Roles**ãŠã‚ˆã³**ClusterRoles**ã‚’**ä½œæˆ**ã¾ãŸã¯**æ›´æ–°**ã™ã‚‹ã“ã¨ã‚’é˜²ãã¾ã™ã€‚ã—ã‹ã—ã€ãã®æ¨©é™ã‚’æŒã¤**GCP**ã®ä¸»ä½“ã¯ã€ã“ã®æŒ¯ã‚‹èˆã„ã«å¯¾ã™ã‚‹Kubernetesã®ä¿è­·ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦ã€ã‚ˆã‚Šå¤šãã®æ¨©é™ã‚’æŒã¤Roles/ClusterRolesã‚’ä½œæˆ/æ›´æ–°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ç‰¹æ¨©æ˜‡æ ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€ãã‚Œãã‚Œ**`container.roles.create`**ãŠã‚ˆã³/ã¾ãŸã¯**`container.roles.update`**ã¾ãŸã¯**`container.clusterRoles.create`**ãŠã‚ˆã³/ã¾ãŸã¯**`container.clusterRoles.update`**ã‚‚**å¿…è¦**ã§ã™ã€‚

### `container.roles.bind` | `container.clusterRoles.bind`

**Kubernetes**ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ä¸»ä½“ãŒæŒã£ã¦ã„ã‚‹æ¨©é™ã‚ˆã‚Šã‚‚å¤šãã®æ¨©é™ã‚’æŒã¤**RoleBindings**ãŠã‚ˆã³**ClusterRoleBindings**ã‚’**ä½œæˆ**ã¾ãŸã¯**æ›´æ–°**ã™ã‚‹ã“ã¨ã‚’é˜²ãã¾ã™ã€‚ã—ã‹ã—ã€ãã®æ¨©é™ã‚’æŒã¤**GCP**ã®ä¸»ä½“ã¯ã€ã“ã®æŒ¯ã‚‹èˆã„ã«å¯¾ã™ã‚‹Kubernetesã®ä¿è­·ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦ã€ã‚ˆã‚Šå¤šãã®æ¨©é™ã‚’æŒã¤RolesBindings/ClusterRolesBindingsã‚’ä½œæˆ/æ›´æ–°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ç‰¹æ¨©æ˜‡æ ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€ãã‚Œãã‚Œ**`container.roleBindings.create`**ãŠã‚ˆã³/ã¾ãŸã¯**`container.roleBindings.update`**ã¾ãŸã¯**`container.clusterRoleBindings.create`**ãŠã‚ˆã³/ã¾ãŸã¯**`container.clusterRoleBindings.update`**ã‚‚**å¿…è¦**ã§ã™ã€‚

### `container.cronJobs.create` | `container.cronJobs.update` | `container.daemonSets.create` | `container.daemonSets.update` | `container.deployments.create` | `container.deployments.update` | `container.jobs.create` | `container.jobs.update` | `container.pods.create` | `container.pods.update` | `container.replicaSets.create` | `container.replicaSets.update` | `container.replicationControllers.create` | `container.replicationControllers.update` | `container.scheduledJobs.create` | `container.scheduledJobs.update` | `container.statefulSets.create` | `container.statefulSets.update`

ã“ã‚Œã‚‰ã®æ¨©é™ã¯ã€**ãƒãƒƒãƒ‰**ã‚’**å®šç¾©**ã§ãã‚‹**ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ**ã¾ãŸã¯**æ›´æ–°**ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ãƒãƒƒãƒ‰ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€**ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã‚‹SA**ã¨**å®Ÿè¡Œã•ã‚Œã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸**ã‚’æŒ‡å®šã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€SAã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚ãªãŸã®ã‚µãƒ¼ãƒãƒ¼ã«**æ¼æ´©ã•ã›ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å®Ÿè¡Œ**ã™ã‚‹ã“ã¨ãŒã§ãã€ä»»æ„ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«æ˜‡æ ¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

GCPç’°å¢ƒã«ã„ã‚‹ãŸã‚ã€**ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰**ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«GCP SA**ã‚’å–å¾—ã—ã€**GC**Pã§æ¨©é™ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆSAãŒä½¿ç”¨ã•ã‚Œã¾ã™ï¼‰ã€‚

### `container.secrets.get` | `container.secrets.list`

ã“ã‚Œã‚‰ã®æ¨©é™ã‚’æŒã¤ã¨ã€[**ã“ã®ãƒšãƒ¼ã‚¸ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«**](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#listing-secrets)ã€**Kubernetesã®ã™ã¹ã¦ã®SAã®ãƒˆãƒ¼ã‚¯ãƒ³**ã‚’**èª­ã¿å–ã‚‹**ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€ãã‚Œã‚‰ã«æ˜‡æ ¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### `container.pods.exec`

ã“ã®æ¨©é™ã‚’æŒã¤ã¨ã€**ãƒãƒƒãƒ‰ã«ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–**ã§ãã‚‹ãŸã‚ã€K8så†…ã§æ¨©é™ã‚’æ˜‡æ ¼ã™ã‚‹ãŸã‚ã«**å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹Kubernetes SA**ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ãŒã€**NodePool**ã®**GCPã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ã‚’**ç›—ã‚€**ã“ã¨ã‚‚ã§ãã€**GCP**ã§æ¨©é™ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### `container.pods.portForward`

ã“ã‚Œã‚‰ã®æ¨©é™ã‚’æŒã¤ã¨ã€**ãƒãƒƒãƒ‰**ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹**ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒ“ã‚¹**ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã€ãã‚Œã«ã‚ˆã‚Š**Kubernetes**ã§æ¨©é™ã‚’æ˜‡æ ¼ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ˆãã—ã¦**ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹**ã«æ¥ç¶šã§ãã‚Œã°**GCP**ã§æ¨©é™ã‚’æ˜‡æ ¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼‰ã€‚

### `container.serviceAccounts.createToken`

ã“ã®**æ¨©é™**ã®åå‰ã‹ã‚‰ã™ã‚‹ã¨ã€**K8sã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ**ã§ãã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã®ã§ã€Kuberneteså†…ã®ä»»æ„ã®SAã«**ç‰¹æ¨©æ˜‡æ ¼**ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ãŸã ã—ã€ä½¿ç”¨ã™ã‚‹APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã®ã§ã€è¦‹ã¤ã‘ãŸå ´åˆã¯ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚

### `container.mutatingWebhookConfigurations.create` | `container.mutatingWebhookConfigurations.update`

ã“ã‚Œã‚‰ã®æ¨©é™ã¯ã€Kubernetesã§æ¨©é™ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã‚ˆã‚Šç¢ºå®Ÿã«ã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«**æ°¸ç¶šåŒ–**ã™ã‚‹ãŸã‚ã«ãã‚Œã‚‰ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
è©³ç´°ã«ã¤ã„ã¦ã¯ã€[**ã“ã®ãƒªãƒ³ã‚¯**](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#malicious-admission-controller)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
