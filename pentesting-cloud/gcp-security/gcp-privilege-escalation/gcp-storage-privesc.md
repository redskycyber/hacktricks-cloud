# GCP - å­˜å‚¨æƒé™æå‡

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## å­˜å‚¨

åŸºæœ¬ä¿¡æ¯ï¼š

{% content-ref url="../gcp-services/gcp-storage-enum.md" %}
[gcp-storage-enum.md](../gcp-services/gcp-storage-enum.md)
{% endcontent-ref %}

### `storage.objects.get`

æ­¤æƒé™å…è®¸æ‚¨**ä¸‹è½½å­˜å‚¨åœ¨Cloud Storageå†…çš„æ–‡ä»¶**ã€‚è¿™å¯èƒ½å…è®¸æ‚¨æå‡æƒé™ï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹**æ•æ„Ÿä¿¡æ¯è¢«ä¿å­˜åœ¨é‚£é‡Œ**ã€‚æ­¤å¤–ï¼Œä¸€äº›GCPæœåŠ¡å°†å®ƒä»¬çš„ä¿¡æ¯å­˜å‚¨åœ¨å­˜å‚¨æ¡¶ä¸­ï¼š

* **GCP Composer**: åˆ›å»ºComposerç¯å¢ƒæ—¶ï¼Œæ‰€æœ‰DAGsçš„**ä»£ç **å°†è¢«ä¿å­˜åœ¨ä¸€ä¸ª**å­˜å‚¨æ¡¶**ä¸­ã€‚è¿™äº›ä»»åŠ¡çš„ä»£ç ä¸­å¯èƒ½åŒ…å«æœ‰è¶£çš„ä¿¡æ¯ã€‚
* **GCR (Container Registry)**: å®¹å™¨çš„**é•œåƒ**å­˜å‚¨åœ¨**å­˜å‚¨æ¡¶**ä¸­ï¼Œè¿™æ„å‘³ç€å¦‚æœæ‚¨å¯ä»¥è¯»å–å­˜å‚¨æ¡¶ï¼Œæ‚¨å°†èƒ½å¤Ÿä¸‹è½½é•œåƒå¹¶**å¯»æ‰¾æ³„éœ²å’Œ/æˆ–æºä»£ç **ã€‚

### `storage.objects.setIamPolicy`

æ‚¨å¯ä»¥ç»™è‡ªå·±æƒé™æ¥**æ»¥ç”¨æœ¬èŠ‚å‰é¢çš„ä»»ä½•åœºæ™¯**ã€‚

### **`storage.buckets.setIamPolicy`**

æœ‰å…³å¦‚ä½•ä½¿ç”¨æ­¤æƒé™ä¿®æ”¹æƒé™çš„ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹æ­¤é¡µé¢ï¼š

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/gcp-public-buckets-privilege-escalation.md" %}
[gcp-public-buckets-privilege-escalation.md](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/gcp-public-buckets-privilege-escalation.md)
{% endcontent-ref %}

### `storage.hmacKeys.create`

Cloud Storageçš„"äº’æ“ä½œæ€§"åŠŸèƒ½ï¼Œæ—¨åœ¨å®ç°**è·¨äº‘äº¤äº’**ï¼Œå¦‚ä¸AWS S3ï¼Œæ¶‰åŠä¸ºæœåŠ¡è´¦æˆ·å’Œç”¨æˆ·**åˆ›å»ºHMACå¯†é’¥**ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡**ä¸ºå…·æœ‰æå‡æƒé™çš„æœåŠ¡è´¦æˆ·ç”ŸæˆHMACå¯†é’¥**æ¥**åœ¨Cloud Storageå†…æå‡æƒé™**ã€‚è™½ç„¶ä¸ç”¨æˆ·å…³è”çš„HMACå¯†é’¥åªèƒ½é€šè¿‡ç½‘ç»œæ§åˆ¶å°æ£€ç´¢ï¼Œä½†è®¿é—®å¯†é’¥å’Œç§˜å¯†å¯†é’¥ä»ç„¶**æ°¸ä¹…å¯è®¿é—®**ï¼Œå…è®¸æ½œåœ¨çš„å¤‡ä»½è®¿é—®å­˜å‚¨ã€‚ç›¸åï¼Œä¸æœåŠ¡è´¦æˆ·é“¾æ¥çš„HMACå¯†é’¥å¯ä»¥é€šè¿‡APIè®¿é—®ï¼Œä½†å®ƒä»¬çš„è®¿é—®å¯†é’¥å’Œç§˜å¯†å¯†é’¥åœ¨åˆ›å»ºåæ— æ³•æ£€ç´¢ï¼Œä¸ºæŒç»­è®¿é—®å¢åŠ äº†å¤æ‚æ€§ã€‚
```bash
# Create key
gsutil hmac create <sa-email>

# Configure gsutil to use it
gsutil config -a

# Use it
gsutil ls gs://[BUCKET_NAME]
```
å¦ä¸€ä¸ªç”¨äºæ­¤æ–¹æ³•çš„åˆ©ç”¨è„šæœ¬å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/storage.hmacKeys.create.py)æ‰¾åˆ°ã€‚

## `storage.objects.create`, `storage.objects.delete` = å­˜å‚¨å†™æƒé™

ä¸ºäº†åœ¨å­˜å‚¨æ¡¶å†…**åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡**ï¼Œä½ éœ€è¦`storage.objects.create`æƒé™ï¼Œæ ¹æ®[æ–‡æ¡£](https://cloud.google.com/storage/docs/access-control/iam-permissions#object_permissions)ï¼Œä½ è¿˜éœ€è¦`storage.objects.delete`æƒé™æ¥**ä¿®æ”¹**å·²å­˜åœ¨çš„å¯¹è±¡ã€‚

ä¸€ä¸ªéå¸¸**å¸¸è§çš„åˆ©ç”¨**æ˜¯ï¼Œå¦‚æœä½ å¯ä»¥åœ¨äº‘ä¸­çš„å­˜å‚¨æ¡¶ä¸­å†™å…¥æ•°æ®ï¼Œå¹¶ä¸”**å­˜å‚¨æ¡¶æ­£åœ¨ä¿å­˜WebæœåŠ¡å™¨æ–‡ä»¶**ï¼Œä½ å¯èƒ½èƒ½å¤Ÿ**å­˜å‚¨æ–°ä»£ç **ï¼Œè¯¥ä»£ç å°†è¢«Webåº”ç”¨ç¨‹åºä½¿ç”¨ã€‚

### Composer

**Composer**æ˜¯åœ¨GCPå†…éƒ¨ç®¡ç†çš„**Apache Airflow**ã€‚å®ƒæœ‰å‡ ä¸ªæœ‰è¶£çš„ç‰¹ç‚¹ï¼š

* å®ƒè¿è¡Œåœ¨ä¸€ä¸ª**GKEé›†ç¾¤**å†…ï¼Œæ‰€ä»¥é›†ç¾¤ä½¿ç”¨çš„**SAæ˜¯å¯è®¿é—®çš„**ï¼Œç”±Composerå†…éƒ¨è¿è¡Œçš„ä»£ç 
* å®ƒå°†**ä»£ç å­˜å‚¨åœ¨ä¸€ä¸ªå­˜å‚¨æ¡¶ä¸­**ï¼Œå› æ­¤ï¼Œ**ä»»ä½•å¯¹è¯¥å­˜å‚¨æ¡¶æœ‰å†™æƒé™çš„äºº**éƒ½å°†èƒ½å¤Ÿæ›´æ”¹/æ·»åŠ DGAä»£ç ï¼ˆApache Airflowå°†æ‰§è¡Œçš„ä»£ç ï¼‰\
ç„¶åï¼Œå¦‚æœä½ å¯¹Composerç”¨æ¥å­˜å‚¨ä»£ç çš„å­˜å‚¨æ¡¶æœ‰**å†™æƒé™**ï¼Œä½ å¯ä»¥**æå‡æƒé™åˆ°åœ¨GKEé›†ç¾¤ä¸­è¿è¡Œçš„SA**ã€‚

### Cloud Functions

* Cloud Functionsçš„ä»£ç å­˜å‚¨åœ¨Storageä¸­ï¼Œå› æ­¤**è¦†ç›–å®ƒï¼Œå¯ä»¥æ‰§è¡Œä»»æ„ä»£ç **ã€‚

### App Engine

* App Engineçš„æºä»£ç å­˜å‚¨åœ¨å­˜å‚¨æ¡¶ä¸­ï¼Œ**è¦†ç›–ä»£ç å¯èƒ½å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„**
* **çœ‹èµ·æ¥å®¹å™¨å±‚å­˜å‚¨åœ¨å­˜å‚¨æ¡¶ä¸­ï¼Œä¹Ÿè®¸æ”¹å˜è¿™äº›ï¼Ÿ**

### GCR

* **Google Container Registry**å°†é•œåƒå­˜å‚¨åœ¨å­˜å‚¨æ¡¶ä¸­ï¼Œå¦‚æœä½ å¯ä»¥**å†™å…¥è¿™äº›å­˜å‚¨æ¡¶**ï¼Œä½ å¯èƒ½èƒ½å¤Ÿ**æ¨ªå‘ç§»åŠ¨åˆ°è¿™äº›å­˜å‚¨æ¡¶æ­£åœ¨è¿è¡Œçš„åœ°æ–¹**ã€‚
* GCRä½¿ç”¨çš„å­˜å‚¨æ¡¶å°†æœ‰ä¸€ä¸ªç±»ä¼¼äº`gs://<eu/usa/asia/nothing>.artifacts.<project>.appspot.com`çš„URLï¼ˆé¡¶çº§å­åŸŸåœ¨[è¿™é‡Œ](https://cloud.google.com/container-registry/docs/pushing-and-pulling)æŒ‡å®šï¼‰ã€‚

## **å‚è€ƒèµ„æ–™**

* [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/#:\~:text=apiKeys.-,create,privileges%20than%20our%20own%20user.](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºä¸“å®¶ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°ä½ çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚

</details>
