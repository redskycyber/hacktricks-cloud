# GCP - Depolama Privilege YÃ¼kseltme

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Depolama

Temel Bilgiler:

{% content-ref url="../gcp-services/gcp-storage-enum.md" %}
[gcp-storage-enum.md](../gcp-services/gcp-storage-enum.md)
{% endcontent-ref %}

### `storage.objects.get`

Bu izin, Cloud Storage iÃ§inde depolanan dosyalarÄ± **indirmenize** olanak saÄŸlar. Bu, bazÄ± durumlarda **duyarlÄ± bilgilerin kaydedildiÄŸi** iÃ§in ayrÄ±calÄ±klarÄ± yÃ¼kseltmenize olanak saÄŸlayabilir. AyrÄ±ca, bazÄ± GCP hizmetleri bilgilerini kovalara kaydeder:

* **GCP Composer**: Bir Composer OrtamÄ± oluÅŸturduÄŸunuzda, **tÃ¼m DAG'larÄ±n kodu** bir **kova** iÃ§inde kaydedilir. Bu gÃ¶revlerin kodlarÄ±nÄ±n iÃ§inde ilginÃ§ bilgiler olabilir.
* **GCR (Container Registry)**: Konteynerlerin **gÃ¶rÃ¼ntÃ¼leri** kovalarda saklanÄ±r, bu da kovalarÄ± okuyabiliyorsanÄ±z gÃ¶rÃ¼ntÃ¼leri indirebileceÄŸiniz ve **sÄ±zÄ±ntÄ±larÄ± ve/veya kaynak kodunu arayabileceÄŸiniz** anlamÄ±na gelir.

### `storage.objects.setIamPolicy`

Bu izin, bu bÃ¶lÃ¼mÃ¼n Ã¶nceki senaryolarÄ±ndan herhangi birini **kÃ¶tÃ¼ye kullanmanÄ±za** olanak saÄŸlar.

### **`storage.buckets.setIamPolicy`**

Bu izinle izinleri nasÄ±l deÄŸiÅŸtireceÄŸinize dair bir Ã¶rnek iÃ§in bu sayfaya bakÄ±n:

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/gcp-public-buckets-privilege-escalation.md" %}
[gcp-public-buckets-privilege-escalation.md](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/gcp-public-buckets-privilege-escalation.md)
{% endcontent-ref %}

### `storage.hmacKeys.create`

Cloud Storage'Ä±n AWS S3 gibi **Ã§apraz bulut etkileÅŸimleri** iÃ§in tasarlanmÄ±ÅŸ "uyumluluk" Ã¶zelliÄŸi, **Hizmet HesaplarÄ± ve kullanÄ±cÄ±lar iÃ§in HMAC anahtarlarÄ±nÄ±n oluÅŸturulmasÄ±nÄ±** iÃ§erir. Bir saldÄ±rgan, **yÃ¼ksek ayrÄ±calÄ±klara sahip bir Hizmet HesabÄ± iÃ§in HMAC anahtarÄ± oluÅŸturarak** bunu istismar edebilir, bÃ¶ylece Cloud Storage iÃ§indeki ayrÄ±calÄ±klarÄ± **yÃ¼kseltebilir**. KullanÄ±cÄ±ya baÄŸlÄ± HMAC anahtarlarÄ± yalnÄ±zca web konsolu aracÄ±lÄ±ÄŸÄ±yla alÄ±nabilirken, eriÅŸim ve gizli anahtarlar **sÃ¼rekli olarak eriÅŸilebilir** kalÄ±r ve potansiyel yedek eriÅŸim depolama iÃ§in kullanÄ±labilir. Ã–te yandan, Hizmet HesabÄ±yla iliÅŸkilendirilmiÅŸ HMAC anahtarlarÄ± API eriÅŸimine aÃ§Ä±ktÄ±r, ancak eriÅŸim ve gizli anahtarlar oluÅŸturulduktan sonra alÄ±namaz, bu da sÃ¼rekli eriÅŸim iÃ§in bir karmaÅŸÄ±klÄ±k katmanÄ± ekler.
```bash
# Create key
gsutil hmac create <sa-email>

# Configure gsutil to use it
gsutil config -a

# Use it
gsutil ls gs://[BUCKET_NAME]
```
Bu yÃ¶ntem iÃ§in baÅŸka bir exploit scripti [burada](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/storage.hmacKeys.create.py) bulunabilir.

## `storage.objects.create`, `storage.objects.delete` = Depolama Yazma izinleri

Bir kovaya yeni bir nesne oluÅŸturmak iÃ§in `storage.objects.create` iznine ihtiyacÄ±nÄ±z vardÄ±r ve [belgelere](https://cloud.google.com/storage/docs/access-control/iam-permissions#object\_permissions) gÃ¶re, mevcut bir nesneyi **deÄŸiÅŸtirmek** iÃ§in de `storage.objects.delete` iznine ihtiyacÄ±nÄ±z vardÄ±r.

Bulutta yazma yetkisine sahip olduÄŸunuz kovalarÄ±n yaygÄ±n olarak sÃ¶mÃ¼rÃ¼ldÃ¼ÄŸÃ¼ bir durum, kovanÄ±n **web sunucusu dosyalarÄ±nÄ± kaydettiÄŸi** durumdur. Bu durumda, web uygulamasÄ± tarafÄ±ndan kullanÄ±lacak olan **yeni bir kodu depolayabilirsiniz**.

### Composer

**Composer**, GCP iÃ§inde yÃ¶netilen **Apache Airflow**'dur. BirkaÃ§ ilginÃ§ Ã¶zelliÄŸi vardÄ±r:

* Bir **GKE kÃ¼mesi iÃ§inde Ã§alÄ±ÅŸÄ±r**, bu nedenle Composer iÃ§inde Ã§alÄ±ÅŸan kod tarafÄ±ndan eriÅŸilebilen **SA kÃ¼menin kullandÄ±ÄŸÄ±dÄ±r**.
* Kodu bir kovada saklar, bu nedenle, kodu deÄŸiÅŸtirme/ekleme yetkisine sahip olan herkes, bir DGA kodu (Apache Airflow tarafÄ±ndan yÃ¼rÃ¼tÃ¼lecek olan kod) deÄŸiÅŸtirebilecektir.\
Bu durumda, kodu depolamak iÃ§in Composer'Ä±n kullandÄ±ÄŸÄ± kovada yazma yetkisine sahipseniz, GKE kÃ¼mesinde Ã§alÄ±ÅŸan SA'ya **privilege escalation** yapabilirsiniz.

### Cloud Functions

* Cloud Functions kodu Depolama'da saklanÄ±r, bu nedenle onu Ã¼zerine yazarak keyfi kodu yÃ¼rÃ¼tmek mÃ¼mkÃ¼ndÃ¼r.

### App Engine

* App Engine kaynak kodu kovalarda saklanÄ±r, kodu Ã¼zerine yazarak keyfi kodu yÃ¼rÃ¼tmek mÃ¼mkÃ¼n olabilir. BU MÃœMKÃœN DEÄÄ°LDÄ°R.
* **Muhtemelen konteyner katmanlarÄ± kovada saklanÄ±r, belki onlarÄ± deÄŸiÅŸtirerek?**

### GCR

* **Google Container Registry**, gÃ¶rÃ¼ntÃ¼leri kovalarda saklar, bu kovalara **yazabilirseniz**, bu kovalarÄ±n Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ± yere yanal hareket edebilirsiniz.
* GCR tarafÄ±ndan kullanÄ±lan kova, `gs://<eu/usa/asia/nothing>.artifacts.<project>.appspot.com` gibi bir URL'ye sahip olacaktÄ±r (Ãœst dÃ¼zey alt alan adlarÄ± [burada](https://cloud.google.com/container-registry/docs/pushing-and-pulling) belirtilmiÅŸtir).

## **Referanslar**

* [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/#:\~:text=apiKeys.-,create,privileges%20than%20our%20own%20user.](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin!</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **tanÄ±tmak veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.**

</details>
