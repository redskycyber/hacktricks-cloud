# GCP - Sourcerepos Privilegieneskalation

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories einreichen.

</details>

## Quellcode-Repositories

F√ºr weitere Informationen zu Quellcode-Repositories siehe:

{% content-ref url="../gcp-services/gcp-source-repositories-enum.md" %}
[gcp-source-repositories-enum.md](../gcp-services/gcp-source-repositories-enum.md)
{% endcontent-ref %}

### `source.repos.get`

Mit dieser Berechtigung ist es m√∂glich, das Repository lokal herunterzuladen:
```bash
gcloud source repos clone <repo-name> --project=<project-uniq-name>
```
### `source.repos.update`

Ein Prinzipal mit dieser Berechtigung **kann Code in einem mit `gcloud source repos clone <repo>` geklonten Repository schreiben**. Beachten Sie jedoch, dass diese Berechtigung nicht benutzerdefinierten Rollen zugewiesen werden kann, sondern √ºber eine vordefinierte Rolle wie:

* Besitzer
* Editor
* Administrator des Quellcode-Repositorys (`roles/source.admin`)
* Schreibender des Quellcode-Repositorys (`roles/source.writer`)

Um zu schreiben, f√ºhren Sie einfach einen regul√§ren **`git push`** aus.

### `source.repos.setIamPolicy`

Mit dieser Berechtigung k√∂nnte sich ein Angreifer die zuvor genannten Berechtigungen selbst gew√§hren.

### Geheimer Zugriff

Wenn der Angreifer **Zugriff auf die Secrets** hat, in denen die Tokens gespeichert sind, kann er sie stehlen. Weitere Informationen dazu, wie auf ein Secret zugegriffen werden kann, finden Sie unter:

{% content-ref url="gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### SSH-Schl√ºssel hinzuf√ºgen

Es ist m√∂glich, **SSH-Schl√ºssel zum Source Repository-Projekt hinzuzuf√ºgen** √ºber die Weboberfl√§che. Es wird ein POST-Request an **`/v1/sshKeys:add`** gesendet und kann konfiguriert werden unter [https://source.cloud.google.com/user/ssh\_keys](https://source.cloud.google.com/user/ssh\_keys)

Sobald Ihr SSH-Schl√ºssel festgelegt ist, k√∂nnen Sie auf ein Repository zugreifen mit:

{% code overflow="wrap" %}
```bash
git clone ssh://username@domain.com@source.developers.google.com:2022/p/<proj-name>/r/<repo-name>
```
{% endcode %}

Und verwenden Sie dann die **`git`** Befehle wie gewohnt.

### Manuelle Anmeldeinformationen

Es ist m√∂glich, manuelle Anmeldeinformationen zu erstellen, um auf die Quellrepositories zuzugreifen:

<figure><img src="../../../.gitbook/assets/image (324).png" alt=""><figcaption></figcaption></figure>

Wenn Sie auf den ersten Link klicken, gelangen Sie zu [https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3](https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3)

Dort wird eine **OAuth-Autorisierungsaufforderung** angezeigt, um Zugriff auf die **Google Cloud-Entwicklung** zu gew√§hren. Sie ben√∂tigen entweder die **Anmeldeinformationen des Benutzers** oder eine **offene Sitzung im Browser** daf√ºr.

Dadurch gelangen Sie zu einer Seite mit einem **Bash-Skript zum Ausf√ºhren** und Konfigurieren eines Git-Cookies in **`$HOME/.gitcookies`**

<figure><img src="../../../.gitbook/assets/image (323).png" alt=""><figcaption></figcaption></figure>

Nach Ausf√ºhrung des Skripts k√∂nnen Sie dann git clone, push... verwenden und es wird funktionieren.

### `source.repos.updateProjectConfig`

Mit dieser Berechtigung ist es m√∂glich, den Standardschutz der Quellrepositories zu deaktivieren, um keinen Code mit privaten Schl√ºsseln hochzuladen:
```bash
gcloud source project-configs update --disable-pushblock
```
Sie k√∂nnen auch ein anderes Pub/Sub-Thema konfigurieren oder es vollst√§ndig deaktivieren:
```bash
gcloud source project-configs update --remove-topic=REMOVE_TOPIC
gcloud source project-configs update --remove-topic=UPDATE_TOPIC
```
<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories einreichen.

</details>
