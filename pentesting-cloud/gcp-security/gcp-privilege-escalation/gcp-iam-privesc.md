# GCP - IAM ê¶Œí•œ ìƒìŠ¹

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì„ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## IAM

IAMì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì—ì„œ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### `iam.roles.update` (`iam.roles.get`)

í•´ë‹¹ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” í• ë‹¹ëœ ì—­í• ì„ ì—…ë°ì´íŠ¸í•˜ê³  ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤ì— ì¶”ê°€ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:
```bash
gcloud iam roles update <rol name> --project <project> --add-permissions <permission>
```
ë‹¤ìŒì€ GCP ê¶Œí•œ ìƒìŠ¹ì— ëŒ€í•œ ë‚´ìš©ì…ë‹ˆë‹¤. ì·¨ì•½í•œ í™˜ê²½ì„ ìë™ìœ¼ë¡œ ìƒì„±, ì•…ìš© ë° ì •ë¦¬í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ëŠ” [ì—¬ê¸°](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/4-iam.serviceAccounts.getAccessToken.sh)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, ì´ ê¶Œí•œì„ ì•…ìš©í•˜ê¸° ìœ„í•œ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ëŠ” [ì—¬ê¸°](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.getAccessToken.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì›ë³¸ ì—°êµ¬](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤.

### `iam.serviceAccounts.getAccessToken` (`iam.serviceAccounts.get`)

í•´ë‹¹ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” **ì„œë¹„ìŠ¤ ê³„ì •ì— ì†í•œ ì•¡ì„¸ìŠ¤ í† í°ì„ ìš”ì²­**í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ìš°ë¦¬ë³´ë‹¤ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§„ ì„œë¹„ìŠ¤ ê³„ì •ì˜ ì•¡ì„¸ìŠ¤ í† í°ì„ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì·¨ì•½í•œ í™˜ê²½ì„ ìë™ìœ¼ë¡œ ìƒì„±, ì•…ìš© ë° ì •ë¦¬í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ëŠ” [ì—¬ê¸°](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/4-iam.serviceAccounts.getAccessToken.sh)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, ì´ ê¶Œí•œì„ ì•…ìš©í•˜ê¸° ìœ„í•œ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ëŠ” [ì—¬ê¸°](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.getAccessToken.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì›ë³¸ ì—°êµ¬](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤.

### `iam.serviceAccountKeys.create`

í•´ë‹¹ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” **ì„œë¹„ìŠ¤ ê³„ì •ì— ëŒ€í•œ ì‚¬ìš©ì ê´€ë¦¬ í‚¤ë¥¼ ìƒì„±**í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ í•´ë‹¹ ì„œë¹„ìŠ¤ ê³„ì •ìœ¼ë¡œ GCPì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
gcloud iam service-accounts keys create --iam-account <name> /tmp/key.json

gcloud auth activate-service-account --key-file=sa_cred.json
```
ë‹¤ìŒì€ GCP ê¶Œí•œ ìƒìŠ¹ì— ëŒ€í•œ ë‚´ìš©ì„ í¬í•¨í•œ í•´í‚¹ ì±…ì˜ ë‚´ìš©ì…ë‹ˆë‹¤. ë‹¤ìŒ ë‚´ìš©ì€ /hive/hacktricks-cloud/pentesting-cloud/gcp-security/gcp-privilege-escalation/gcp-iam-privesc.md íŒŒì¼ì—ì„œ ê°€ì ¸ì˜¨ ê²ƒì…ë‹ˆë‹¤. ê´€ë ¨ëœ ì˜ì–´ í…ìŠ¤íŠ¸ë¥¼ í•œêµ­ì–´ë¡œ ë²ˆì—­í•˜ê³ , ì •í™•íˆ ë™ì¼í•œ ë§ˆí¬ë‹¤ìš´ ë° HTML êµ¬ë¬¸ì„ ìœ ì§€í•œ ì±„ ë²ˆì—­ì„ ë°˜í™˜í•˜ì„¸ìš”. ì½”ë“œ, í•´í‚¹ ê¸°ë²• ì´ë¦„, í•´í‚¹ ê´€ë ¨ ìš©ì–´, í´ë¼ìš°ë“œ/SaaS í”Œë«í¼ ì´ë¦„(ì˜ˆ: Workspace, aws, gcp...) ë° 'leak', pentesting, ë§ˆí¬ë‹¤ìš´ íƒœê·¸ì™€ ê°™ì€ ìš”ì†ŒëŠ” ë²ˆì—­í•˜ì§€ ë§ˆì„¸ìš”. ë˜í•œ ë²ˆì—­ ë° ë§ˆí¬ë‹¤ìš´ êµ¬ë¬¸ ì´ì™¸ì˜ ì¶”ê°€ ë‚´ìš©ì€ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”.

---

ë‹¤ìŒì€ ì·¨ì•½í•œ í™˜ê²½ì˜ ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìë™í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆëŠ” ë§í¬ì…ë‹ˆë‹¤: [ì—¬ê¸°](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/3-iam.serviceAccountKeys.create.sh). ë˜í•œ ì´ ê¶Œí•œì„ ì•…ìš©í•˜ëŠ” íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ëŠ” [ì—¬ê¸°](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccountKeys.create.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì›ë³¸ ì—°êµ¬](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ í™•ì¸í•˜ì„¸ìš”.

ì°¸ê³ ë¡œ, `iam.serviceAccountKeys.update`ëŠ” SAì˜ í‚¤ë¥¼ ìˆ˜ì •í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í‚¤ë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ `iam.serviceAccountKeys.create` ê¶Œí•œë„ í•„ìš”í•©ë‹ˆë‹¤.

### `iam.serviceAccounts.implicitDelegation`

`iam.serviceAccounts.implicitDelegation` ê¶Œí•œì„ ê°€ì§„ ì„œë¹„ìŠ¤ ê³„ì •ì´ ì„¸ ë²ˆì§¸ ì„œë¹„ìŠ¤ ê³„ì •ì— `iam.serviceAccounts.getAccessToken` ê¶Œí•œì„ ê°€ì§€ê³  ìˆëŠ” ê²½ìš°, implicitDelegationì„ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ì„¸ ë²ˆì§¸ ì„œë¹„ìŠ¤ ê³„ì •ì„ ìœ„í•œ í† í°ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ì´ë¥¼ ì„¤ëª…í•˜ê¸° ìœ„í•œ ë‹¤ì´ì–´ê·¸ë¨ì…ë‹ˆë‹¤.

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image2-500x493.png)

ë‹¤ìŒì€ ì·¨ì•½í•œ í™˜ê²½ì˜ ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìë™í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆëŠ” ë§í¬ì…ë‹ˆë‹¤: [ì—¬ê¸°](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/5-iam.serviceAccounts.implicitDelegation.sh). ë˜í•œ ì´ ê¶Œí•œì„ ì•…ìš©í•˜ëŠ” íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ëŠ” [ì—¬ê¸°](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.implicitDelegation.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì›ë³¸ ì—°êµ¬](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ í™•ì¸í•˜ì„¸ìš”.

ì°¸ê³ ë¡œ, [ë¬¸ì„œ](https://cloud.google.com/iam/docs/understanding-service-accounts)ì— ë”°ë¥´ë©´ ìœ„ì„ì€ [generateAccessToken()](https://cloud.google.com/iam/credentials/reference/rest/v1/projects.serviceAccounts/generateAccessToken) ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ í† í°ì„ ìƒì„±í•˜ëŠ” ë°ë§Œ ì‘ë™í•©ë‹ˆë‹¤.

### `iam.serviceAccounts.signBlob`

ìœ„ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” GCPì—ì„œ ì„ì˜ì˜ í˜ì´ë¡œë“œë¥¼ ì„œëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ëŒ€ìƒì´ ë˜ëŠ” SAì˜ ì„œëª…ë˜ì§€ ì•Šì€ JWTë¥¼ ìƒì„±í•œ ë‹¤ìŒ blobìœ¼ë¡œ ë³´ë‚´ JWTë¥¼ ì„œëª…ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://medium.com/google-cloud/using-serviceaccountactor-iam-role-for-account-impersonation-on-google-cloud-platform-a9e7118480ed)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

ë‹¤ìŒì€ ì·¨ì•½í•œ í™˜ê²½ì˜ ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìë™í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆëŠ” ë§í¬ì…ë‹ˆë‹¤: [ì—¬ê¸°](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/6-iam.serviceAccounts.signBlob.sh). ë˜í•œ ì´ ê¶Œí•œì„ ì•…ìš©í•˜ëŠ” íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ëŠ” [ì—¬ê¸°](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.signBlob-accessToken.py)ì™€ [ì—¬ê¸°](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.signBlob-gcsSignedUrl.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì›ë³¸ ì—°êµ¬](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ í™•ì¸í•˜ì„¸ìš”.

### `iam.serviceAccounts.signJwt`

ìœ„ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±ëœ JSON ì›¹ í† í°(JWT)ì„ ì„œëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì „ ë°©ë²•ê³¼ì˜ ì°¨ì´ì ì€ êµ¬ê¸€ì´ JWTë¥¼ í¬í•¨í•œ blobì„ ì„œëª…í•˜ëŠ” ëŒ€ì‹  ì´ë¯¸ JWTë¥¼ ê¸°ëŒ€í•˜ëŠ” signJWT ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ ì‚¬ìš©í•˜ë©´ ë” ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì„ì˜ì˜ ë°”ì´íŠ¸ ëŒ€ì‹  JWTë§Œ ì„œëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒì€ ì·¨ì•½í•œ í™˜ê²½ì˜ ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìë™í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆëŠ” ë§í¬ì…ë‹ˆë‹¤: [ì—¬ê¸°](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/7-iam.serviceAccounts.signJWT.sh). ë˜í•œ ì´ ê¶Œí•œì„ ì•…ìš©í•˜ëŠ” íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ëŠ” [ì—¬ê¸°](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.signJWT.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì›ë³¸ ì—°êµ¬](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ í™•ì¸í•˜ì„¸ìš”.

### `iam.serviceAccounts.setIamPolicy` <a href="#iam.serviceaccounts.setiampolicy" id="iam.serviceaccounts.setiampolicy"></a>

ìœ„ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” ì„œë¹„ìŠ¤ ê³„ì •ì— IAM ì •ì±…ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì•…ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ ê³„ì •ì„ ìœ„ì¥í•  ìˆ˜ ìˆëŠ” í•„ìš”í•œ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì˜ˆì œì—ì„œëŠ” í¥ë¯¸ë¡œìš´ SAì— ëŒ€í•´ `roles/iam.serviceAccountTokenCreator` ì—­í• ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.
```bash
gcloud iam service-accounts add-iam-policy-binding "${VICTIM_SA}@${PROJECT_ID}.iam.gserviceaccount.com" \
--member="user:username@domain.com" \
--role="roles/iam.serviceAccountTokenCreator"
```
[**ì—¬ê¸°ì—ì„œ ì·¨ì•½í•œ í™˜ê²½ì˜ ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìë™í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/d-iam.serviceAccounts.setIamPolicy.sh)**.**

### `iam.serviceAccounts.actAs`

**iam.serviceAccounts.actAs ê¶Œí•œ**ì€ **AWSì˜ iam:PassRole ê¶Œí•œê³¼ ìœ ì‚¬**í•©ë‹ˆë‹¤. ì´ëŠ” Compute Engine ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹œì‘í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ë° í•„ìˆ˜ì ì´ë©°, ì„œë¹„ìŠ¤ ê³„ì •ì„ "actAs"í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ ì•ˆì „í•œ ê¶Œí•œ ê´€ë¦¬ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤. ì´ ê¶Œí•œì´ ì—†ìœ¼ë©´ ì‚¬ìš©ìê°€ ë¶ˆí•„ìš”í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, **iam.serviceAccounts.actAs**ë¥¼ ì•…ìš©í•˜ëŠ” ê²ƒì€ ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ì´ ìˆìœ¼ë©°, ê° ë°©ë²•ë§ˆë‹¤ ì¼ë ¨ì˜ ê¶Œí•œì´ í•„ìš”í•˜ë¯€ë¡œ ë‹¤ë¥¸ ë°©ë²•ê³¼ ëŒ€ì¡°ë©ë‹ˆë‹¤.

#### ì„œë¹„ìŠ¤ ê³„ì • ìœ„ì¥ <a href="#service-account-impersonation" id="service-account-impersonation"></a>

ì„œë¹„ìŠ¤ ê³„ì • ìœ„ì¥ì€ **ìƒˆë¡œìš´ ë° ë” ë‚˜ì€ ê¶Œí•œì„ ì–»ê¸° ìœ„í•´ ë§¤ìš° ìœ ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ê³„ì •ì„ ìœ„ì¥í•˜ëŠ”](https://cloud.google.com/iam/docs/understanding-service-accounts#impersonating\_a\_service\_account) ì„¸ ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤:

* RSA ê°œì¸ í‚¤ë¥¼ ì‚¬ìš©í•œ ì¸ì¦ (ìœ„ì—ì„œ ë‹¤ë£¸)
* Cloud IAM ì •ì±…ì„ ì‚¬ìš©í•œ ê¶Œí•œ ë¶€ì—¬ (ì—¬ê¸°ì—ì„œ ë‹¤ë£¸)
* GCP ì„œë¹„ìŠ¤ì— ì‘ì—… ë°°í¬ (ì‚¬ìš©ì ê³„ì • ì¹¨í•´ì™€ ë” ê´€ë ¨ë¨)

### `iam.serviceAccounts.getOpenIdToken`

ìœ„ì—ì„œ ì–¸ê¸‰í•œ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” OpenID JWTë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‹ ì›ì„ ì£¼ì¥í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ë©°, ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•”ë¬µì ì¸ ì¸ê°€ë¥¼ ë°˜ë“œì‹œ ê°–ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.

ì´ [**í¥ë¯¸ë¡œìš´ ê²Œì‹œë¬¼**](https://medium.com/google-cloud/authenticating-using-google-openid-connect-tokens-e7675051213b)ì— ë”°ë¥´ë©´, í† í°ì„ ì‚¬ìš©í•˜ì—¬ ì¸ì¦í•˜ë ¤ëŠ” ì„œë¹„ìŠ¤ (í† í°ì„ ì‚¬ìš©í•˜ë ¤ëŠ” ì„œë¹„ìŠ¤)ë¥¼ ì§€ì •í•´ì•¼ í•˜ë©°, êµ¬ê¸€ì—ì„œ ì„œë¹„ìŠ¤ ê³„ì •ê³¼ JWTì˜ ëŒ€ìƒì„ ë‚˜íƒ€ë‚´ëŠ” ì„œëª…ëœ JWTë¥¼ ë°›ê²Œ ë©ë‹ˆë‹¤.

ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìˆëŠ” ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ OpenIDTokenì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
# First activate the SA with iam.serviceAccounts.getOpenIdToken over the other SA
gcloud auth activate-service-account --key-file=/path/to/svc_account.json
# Then, generate token
gcloud auth print-identity-token "${ATTACK_SA}@${PROJECT_ID}.iam.gserviceaccount.com" --audiences=https://example.com
```
ê·¸ëŸ¼ ë‹¹ì‹ ì€ ë‹¤ìŒê³¼ ê°™ì´ ì„œë¹„ìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ ê·¸ê²ƒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
curl -v -H "Authorization: Bearer id_token" https://some-cloud-run-uc.a.run.app
```
ì´ëŸ¬í•œ ì¢…ë¥˜ì˜ í† í°ì„ í†µí•´ ì¸ì¦ì„ ì§€ì›í•˜ëŠ” ì¼ë¶€ ì„œë¹„ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* [Google Cloud Run](https://cloud.google.com/run/)
* [Google Cloud Functions](https://cloud.google.com/functions/docs/)
* [Google Identity Aware Proxy](https://cloud.google.com/iap/docs/authentication-howto)
* [Google Cloud Endpoints](https://cloud.google.com/endpoints/docs/openapi/authenticating-users-google-id) (Google OIDCë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°)

ì„œë¹„ìŠ¤ ê³„ì •ì„ ëŒ€ì‹ í•˜ì—¬ OpenID í† í°ì„ ìƒì„±í•˜ëŠ” ì˜ˆì œëŠ” [ì—¬ê¸°](https://github.com/carlospolop-forks/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.getOpenIdToken.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œì—ì„œ ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ì„ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* íšŒì‚¬ë¥¼ **HackTricksì—ì„œ ê´‘ê³ **í•˜ê±°ë‚˜ **PDFë¡œ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì¸ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
