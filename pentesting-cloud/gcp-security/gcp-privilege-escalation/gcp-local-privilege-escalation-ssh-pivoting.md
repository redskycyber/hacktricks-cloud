# GCP - ë¡œì»¬ ê¶Œí•œ ìƒìŠ¹ SSH í”¼ë²—

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ **íŒ”ë¡œìš°**í•˜ì„¸ìš”. ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

ì´ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” Compute Engine í”„ë¡œì íŠ¸ ë‚´ì—ì„œ **ê¶Œí•œì´ ì—†ëŠ” ê³„ì •**ì´ í¬í•¨ëœ VMì„ ì¹¨íˆ¬í–ˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.

ë†€ëê²Œë„, ì¹¨íˆ¬í•œ Compute Engineì˜ GPC ê¶Œí•œì„ ì‚¬ìš©í•˜ì—¬ **ë¡œì»¬ì—ì„œ ê¶Œí•œì„ ìƒìŠ¹**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œëŠ” í•­ìƒ ë§¤ìš° ìœ ìš©í•˜ì§€ëŠ” ì•Šì§€ë§Œ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì„ ì•Œê³  ìˆëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

## ìŠ¤í¬ë¦½íŠ¸ ì½ê¸° <a href="#follow-the-scripts" id="follow-the-scripts"></a>

**Compute Instances**ëŠ” ì„œë¹„ìŠ¤ ê³„ì •ì„ ì‚¬ìš©í•˜ì—¬ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ **ì¼ë¶€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰**í•˜ëŠ” ê²ƒìœ¼ë¡œ ì¶”ì •ë©ë‹ˆë‹¤.

IAMì´ ë§¤ìš° ì„¸ë¶„í™”ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ê³„ì •ì€ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ **ì½ê¸°/ì“°ê¸°** ê¶Œí•œì„ ê°€ì§€ê³  ìˆì§€ë§Œ **ëª©ë¡ ê¶Œí•œì€ ì—†ì„ ìˆ˜** ìˆìŠµë‹ˆë‹¤.

ì´ì— ëŒ€í•œ ì¢‹ì€ ê°€ìƒ ì˜ˆëŠ” `instance82736-long-term-xyz-archive-0332893`ë¼ëŠ” ì €ì¥ì†Œ ë²„í‚·ì— ëŒ€í•œ ì½ê¸°/ì“°ê¸° ê¶Œí•œì„ ê°€ì§„ Compute Instanceì…ë‹ˆë‹¤.

ëª…ë ¹ ì¤„ì—ì„œ `gsutil ls`ë¥¼ ì‹¤í–‰í•˜ë©´ `storage.buckets.list` IAM ê¶Œí•œì´ ì—†ê¸° ë•Œë¬¸ì— ì•„ë¬´ê²ƒë„ ë°˜í™˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ `gsutil ls gs://instance82736-long-term-xyz-archive-0332893`ë¥¼ ì‹¤í–‰í•˜ë©´ ì™„ì „í•œ íŒŒì¼ ì‹œìŠ¤í…œ ë°±ì—…ì„ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ ë¡œì»¬ Linux ê³„ì •ì´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ì—†ëŠ” ë°ì´í„°ì— ëŒ€í•œ í‰ë¬¸ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ë²„í‚· ì´ë¦„ì„ ìŠ¤í¬ë¦½íŠ¸(ë°°ì‹œ, íŒŒì´ì¬, ë£¨ë¹„...)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

## ì‚¬ìš©ì ì •ì˜ ë©”íƒ€ë°ì´í„°

ê´€ë¦¬ìëŠ” **ì¸ìŠ¤í„´ìŠ¤** ë° **í”„ë¡œì íŠ¸ ìˆ˜ì¤€**ì—ì„œ [ì‚¬ìš©ì ì •ì˜ ë©”íƒ€ë°ì´í„°](https://cloud.google.com/compute/docs/storing-retrieving-metadata#custom)ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë‹¨ìˆœíˆ **ì„ì˜ì˜ í‚¤/ê°’ ìŒì„ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì „ë‹¬í•˜ëŠ” ë°©ë²•**ì´ë©°, ì£¼ë¡œ í™˜ê²½ ë³€ìˆ˜ ë° ì‹œì‘/ì¢…ë£Œ ìŠ¤í¬ë¦½íŠ¸ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

ë˜í•œ **userdata**ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ê¸°ê³„ê°€ ì‹œì‘ë˜ê±°ë‚˜ ë‹¤ì‹œ ì‹œì‘ë  ë•Œë§ˆë‹¤ **ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸**ë¡œ ë©”íƒ€ë°ì´í„° ì—”ë“œí¬ì¸íŠ¸ì—ì„œë„ **ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

## IAM ê¶Œí•œ ë‚¨ìš©

ë‹¤ìŒ ì œì•ˆëœ ê¶Œí•œ ëŒ€ë¶€ë¶„ì€ **ê¸°ë³¸ Compute SAì—ê²Œ ì œê³µ**ë©ë‹ˆë‹¤. ìœ ì¼í•œ ë¬¸ì œëŠ” **ê¸°ë³¸ ì•¡ì„¸ìŠ¤ ë²”ìœ„ê°€ SAê°€ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ** ë§‰ëŠ”ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **`cloud-platform`** **ë²”ìœ„**ê°€ í™œì„±í™”ë˜ì—ˆê±°ë‚˜ **`compute`** **ë²”ìœ„**ë§Œ í™œì„±í™”ë˜ì—ˆë‹¤ë©´ ì´ë¥¼ **ë‚¨ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”:

* [**compute.instances.osLogin**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/#compute.instances.oslogin)
* [**compute.instances.osAdminLogin**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/#compute.instances.osadminlogin)
* [**compute.projects.setCommonInstanceMetadata**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/#compute.projects.setcommoninstancemetadata)
* [**compute.instances.setMetadata**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/#compute.instances.setmetadata)
* [**compute.instances.setIamPolicy**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/#compute.instances.setiampolicy)

## íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ í‚¤ ê²€ìƒ‰

ìƒì ë‚´ì—ì„œ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ gcloudì— ë¡œê·¸ì¸í•˜ê³  íŒŒì¼ ì‹œìŠ¤í…œì— ìê²© ì¦ëª…ì„ ë‚¨ê²¼ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:
```
sudo find / -name "gcloud"
```
ë‹¤ìŒì€ ê°€ì¥ í¥ë¯¸ë¡œìš´ íŒŒì¼ë“¤ì…ë‹ˆë‹¤:

* `~/.config/gcloud/credentials.db`
* `~/.config/gcloud/legacy_credentials/[ACCOUNT]/adc.json`
* `~/.config/gcloud/legacy_credentials/[ACCOUNT]/.boto`
* `~/.credentials.json`

### ë” ë§ì€ API í‚¤ ì •ê·œì‹ë“¤
```bash
TARGET_DIR="/path/to/whatever"

# Service account keys
grep -Pzr "(?s){[^{}]*?service_account[^{}]*?private_key.*?}" \
"$TARGET_DIR"

# Legacy GCP creds
grep -Pzr "(?s){[^{}]*?client_id[^{}]*?client_secret.*?}" \
"$TARGET_DIR"

# Google API keys
grep -Pr "AIza[a-zA-Z0-9\\-_]{35}" \
"$TARGET_DIR"

# Google OAuth tokens
grep -Pr "ya29\.[a-zA-Z0-9_-]{100,200}" \
"$TARGET_DIR"

# Generic SSH keys
grep -Pzr "(?s)-----BEGIN[ A-Z]*?PRIVATE KEY[a-zA-Z0-9/\+=\n-]*?END[ A-Z]*?PRIVATE KEY-----" \
"$TARGET_DIR"

# Signed storage URLs
grep -Pir "storage.googleapis.com.*?Goog-Signature=[a-f0-9]+" \
"$TARGET_DIR"

# Signed policy documents in HTML
grep -Pzr '(?s)<form action.*?googleapis.com.*?name="signature" value=".*?">' \
"$TARGET_DIR"
```
## ì°¸ê³  ìë£Œ

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ì„** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ ê¸°êµë¥¼ ê³µìœ **í•˜ì„¸ìš”.

</details>
