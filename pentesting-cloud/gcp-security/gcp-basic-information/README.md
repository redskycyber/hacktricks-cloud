# GCP - Basic Information

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github Repositories einreichen.

</details>

## **Ressourcenhierarchie**

Google Cloud verwendet eine [Ressourcenhierarchie](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy), die konzeptionell √§hnlich ist wie die eines traditionellen Dateisystems. Dies bietet einen logischen Eltern-Kind-Arbeitsablauf mit spezifischen Anbindungspunkten f√ºr Richtlinien und Berechtigungen.

Auf hoher Ebene sieht es so aus:

```
Organization
--> Folders
--> Projects
--> Resources
```

Ein virtuelle Maschine (genannt Compute-Instanz) ist eine Ressource. Eine Ressource befindet sich in einem Projekt, wahrscheinlich neben anderen Compute-Instanzen, Speichereimern, usw.

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption><p><a href="https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg">https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg</a></p></figcaption></figure>

## **Projektmigration**

Es ist m√∂glich, **ein Projekt ohne Organisation zu einer Organisation zu migrieren** mit den Berechtigungen `roles/resourcemanager.projectCreator` und `roles/resourcemanager.projectMover`. Wenn sich das Projekt in einer anderen Organisation befindet, muss der GCP-Support kontaktiert werden, um sie zuerst aus der Organisation zu **verschieben**. Weitere Informationen finden Sie [**hier**](https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6).

## **Organisationsrichtlinien**

Erm√∂glichen die zentrale Kontrolle √ºber die Cloud-Ressourcen Ihrer Organisation:

* Zentrale Kontrolle zur **Konfiguration von Einschr√§nkungen** f√ºr die Verwendung der Ressourcen Ihrer Organisation.
* Definieren und festlegen von **Leitplanken** f√ºr Ihre Entwicklungsteams, um innerhalb der Compliance-Grenzen zu bleiben.
* Unterst√ºtzen Projektinhaber und ihre Teams dabei, schnell voranzukommen, ohne sich um die Einhaltung von Compliance-Sicherheitsrichtlinien sorgen zu m√ºssen.

Diese Richtlinien k√∂nnen erstellt werden, um die gesamte Organisation, Ordner oder Projekte zu **beeinflussen**. Nachkommen des ausgew√§hlten Ressourcen-Hierarchieknotens **erben die Organisationsrichtlinie**.

Um eine Organisationsrichtlinie **festzulegen**, w√§hlen Sie eine [**Einschr√§nkung**](https://cloud.google.com/resource-manager/docs/organization-policy/overview#constraints) aus, die eine bestimmte Art von Einschr√§nkung gegen√ºber einem Google Cloud-Dienst oder einer Gruppe von Google Cloud-Diensten darstellt. Sie **konfigurieren diese Einschr√§nkung mit den gew√ºnschten Einschr√§nkungen**.

<figure><img src="../../../.gitbook/assets/image (5) (4).png" alt=""><figcaption><p><a href="https://cloud.google.com/resource-manager/img/org-policy-concepts.svg">https://cloud.google.com/resource-manager/img/org-policy-concepts.svg</a></p></figcaption></figure>

#### H√§ufige Anwendungsf√§lle <a href="#common_use_cases" id="common_use_cases"></a>

* Begrenzung des Ressourcenaustauschs basierend auf der Dom√§ne.
* Begrenzung der Verwendung von Identit√§ts- und Zugriffsverwaltungsdienstkonten.
* Einschr√§nkung des physischen Standorts neu erstellter Ressourcen.
* Deaktivierung der Erstellung von Dienstkonten

<figure><img src="../../../.gitbook/assets/image (83).png" alt=""><figcaption></figcaption></figure>

Es gibt viele weitere Einschr√§nkungen, die Ihnen eine fein abgestimmte Kontrolle √ºber die Ressourcen Ihrer Organisation geben. F√ºr **weitere Informationen siehe die** [**Liste aller Organisationsrichtliniendienst-Einschr√§nkungen**](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints)**.**

### **Standard-Organisationsrichtlinien**

<details>

<summary>Dies sind die Richtlinien, die Google standardm√§√üig hinzuf√ºgt, wenn Ihre GCP-Organisation eingerichtet wird:</summary>

**Zugriffsverwaltungspolitiken**

* **Dom√§nenbeschr√§nkte Kontakte:** Verhindert das Hinzuf√ºgen von Benutzern zu Essential Contacts au√üerhalb Ihrer angegebenen Dom√§nen. Dies beschr√§nkt Essential Contacts darauf, nur verwaltete Benutzeridentit√§ten in Ihren ausgew√§hlten Dom√§nen zuzulassen, um Plattformbenachrichtigungen zu erhalten.
* **Dom√§nenbeschr√§nktes Teilen:** Verhindert das Hinzuf√ºgen von Benutzern zu IAM-Richtlinien au√üerhalb Ihrer angegebenen Dom√§nen. Dies beschr√§nkt IAM-Richtlinien darauf, nur verwaltete Benutzeridentit√§ten in Ihren ausgew√§hlten Dom√§nen zuzulassen, um auf Ressourcen innerhalb dieser Organisation zuzugreifen.
* **√ñffentlicher Zugriffsschutz:** Verhindert, dass Cloud Storage-Buckets der √ñffentlichkeit ausgesetzt werden. Dadurch kann ein Entwickler keine Cloud Storage-Buckets konfigurieren, um nicht authentifizierten Internetzugriff zu haben.
* **Einheitlicher Bucket-Zugriffsebene:** Verhindert Zugriffssteuerungslisten (ACLs) auf Objektebene in Cloud Storage-Buckets. Dadurch wird Ihr Zugriffsmanagement vereinfacht, indem IAM-Richtlinien konsistent auf alle Objekte in Cloud Storage-Buckets angewendet werden.
* **OS-Anmeldung erforderlich:** VMs, die in neuen Projekten erstellt werden, haben OS-Anmeldung aktiviert. Dadurch k√∂nnen Sie den SSH-Zugriff auf Ihre Instanzen mithilfe von IAM verwalten, ohne einzelne SSH-Schl√ºssel erstellen und verwalten zu m√ºssen.

**Zus√§tzliche Sicherheitsrichtlinien f√ºr Dienstkonten**

* **Automatische IAM-Zuweisungen deaktivieren**: Verhindert, dass den Standard-App Engine- und Compute Engine-Dienstkonten automatisch die Editor-IAM-Rolle bei der Projekterstellung zugewiesen wird. Dadurch erhalten Dienstkonten bei der Erstellung keine √ºberm√§√üig berechtigten IAM-Rollen.
* **Erstellung von Dienstkontoschl√ºsseln deaktivieren**: Verhindert die Erstellung √∂ffentlicher Dienstkontoschl√ºssel. Dadurch wird das Risiko der Offenlegung von dauerhaften Anmeldeinformationen verringert.
* **Hochladen von Dienstkontoschl√ºsseln deaktivieren**: Verhindert das Hochladen √∂ffentlicher Dienstkontoschl√ºssel. Dadurch wird das Risiko der Offenlegung oder Wiederverwendung von Schl√ºsselmaterial verringert.

**Sichere VPC-Netzwerkkonfigurationsrichtlinien**

* **Zul√§ssige externe IPs f√ºr VM-Instanzen definieren**: Verhindert die Erstellung von Compute-Instanzen mit einer √∂ffentlichen IP, die sie dem Internetverkehr aussetzen k√∂nnen.

<!---->

* **Verschachtelte Virtualisierung von VMs deaktivieren**: Verhindert die Erstellung von verschachtelten VMs auf Compute Engine-VMs. Dies verringert das Sicherheitsrisiko un√ºberwachter verschachtelter VMs.

<!---->

* **Serielles Portdeaktivieren von VMs**: Verhindert den seriellen Portzugriff auf Compute Engine-VMs. Dadurch wird verhindert, dass √ºber die Compute Engine-API Eingaben an den seriellen Port eines Servers erfolgen.

<!---->

* **Autorisierte Netzwerke auf Cloud SQL-Instanzen einschr√§nken**: Verhindert, dass √∂ffentliche oder nicht interne Netzwerkbereiche auf Ihre Cloud SQL-Datenbanken zugreifen k√∂nnen.

<!---->

* **Weiterleitung von Protokollen basierend auf dem Typ der IP-Adresse einschr√§nken**: Verhindert die Weiterleitung von VM-Protokollen f√ºr externe IP-Adressen.

<!---->

* **√ñffentlichen IP-Zugriff auf Cloud SQL-Instanzen einschr√§nken**: Verhindert die Erstellung von Cloud SQL-Instanzen mit einer √∂ffentlichen IP, die sie dem Internetverkehr aussetzen k√∂nnen.

<!---->

* **Entfernen von Shared VPC-Projektliens einschr√§nken**: Verhindert das versehentliche L√∂schen von Shared VPC-Hostprojekten.

<!---->

* **Setzt die interne DNS-Einstellung f√ºr neue Projekte auf Zonal DNS Only**: Verhindert die Verwendung einer veralteten DNS-Einstellung, die die Serviceverf√ºgbarkeit verringert.

<!---->

* **Standardnetzwerkerstellung √ºberspringen**: Verhindert die automatische Erstellung des Standard-VPC-Netzwerks und zugeh√∂riger Ressourcen. Dadurch werden √ºberm√§√üig berechtigte Standard-Firewallregeln vermieden.

<!---->

* **Externe IPv6-Nutzung in VPC deaktivieren**: Verhindert die Erstellung von externen IPv6-Subnetzen, die nicht autorisiertem Internetzugriff ausgesetzt sein k√∂nnen.

</details>

## **IAM-Rollen**

Diese sind wie IAM-Richtlinien in AWS, da **jede Rolle eine Reihe von Berechtigungen enth√§lt**.

Im Gegensatz zu AWS gibt es jedoch **kein zentrales Repository** f√ºr Rollen. Stattdessen **erteilen Ressourcen X-Zugriffsrollen an Y-Prinzipale**, und der einzige Weg herauszufinden, wer Zugriff auf eine Ressource hat, besteht darin, die **`get-iam-policy`-Methode √ºber diese Ressource zu verwenden**.\
Dies k√∂nnte ein Problem sein, da dies bedeutet, dass der einzige Weg herauszufinden ist, **welche Berechtigungen ein Prinzipal hat, darin besteht, jede Ressource zu fragen, wem sie Berechtigungen erteilt**, und ein Benutzer m√∂glicherweise nicht die Berechtigungen hat, um Berechtigungen von allen Ressourcen zu erhalten.

Es gibt **drei Arten** von Rollen in IAM:

* **Grundlegende/Primitive Rollen**, die die **Owner**, **Editor** und **Viewer**-Rollen umfassen, die vor der Einf√ºhrung von IAM existierten.
* **Vordefinierte Rollen**, die granularen Zugriff f√ºr einen bestimmten Dienst bieten und von Google Cloud verwaltet werden. Es gibt viele vordefinierte Rollen, Sie k√∂nnen **alle mit den ihnen zugeordneten Berechtigungen** [**hier**](https://cloud.google.com/iam/docs/understanding-roles#predefined\_roles) einsehen.
* **Benutzerdefinierte Rollen**, die granularen Zugriff gem√§√ü einer benutzerspezifischen Liste von Berechtigungen bieten.

Es gibt Tausende von Berechtigungen in GCP. Um zu √ºberpr√ºfen, ob eine Rolle Berechtigungen hat, k√∂nnen Sie [**hier nach der Berechtigung suchen**](https://cloud.google.com/iam/docs/permissions-reference) und sehen, welche Rollen sie hat.

Sie k√∂nnen auch [**hier nach vordefinierten Rollen suchen**](https://cloud.google.com/iam/docs/understanding-roles#product\_specific\_documentation) **suchen, die von jedem Produkt angeboten werden.** Beachten Sie, dass einige **Rollen** nicht an Benutzer angeh√§ngt werden k√∂nnen und **nur an SAs angeh√§ngt werden k√∂nnen, da einige Berechtigungen** enthalten.\
Dar√ºber hinaus beachten Sie, dass **Berechtigungen** nur **wirksam werden**, wenn sie **dem relevanten Dienst zugeordnet sind**.

Oder √ºberpr√ºfen Sie, ob eine **benutzerdefinierte Rolle eine** [**bestimmte Berechtigung hier verwenden kann**](https://cloud.google.com/iam/docs/custom-roles-permissions-support)**.**

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

## Benutzer <a href="#default-credentials" id="default-credentials"></a>

Im **GCP-Konsole** gibt es **kein Benutzer- oder Gruppenmanagement**, das wird in **Google Workspace** durchgef√ºhrt. Sie k√∂nnten jedoch einen anderen Identit√§tsanbieter in Google Workspace synchronisieren.

Sie k√∂nnen auf die Benutzer und Gruppen von Workspace unter [**https://admin.google.com**](https://admin.google.com/) zugreifen.

**MFA** kann f√ºr Workspace-Benutzer **erzwungen** werden, jedoch k√∂nnte ein **Angreifer** ein Token verwenden, um √ºber die Befehlszeile auf GCP zuzugreifen, das nicht durch MFA gesch√ºtzt ist (es wird nur durch MFA gesch√ºtzt, wenn der Benutzer sich anmeldet, um es zu generieren: `gcloud auth login`).

## Gruppen

Bei der Erstellung einer Organisation wird dringend empfohlen, mehrere Gruppen zu erstellen. Wenn Sie eine davon verwalten, k√∂nnten Sie die gesamte Organisation oder einen wichtigen Teil kompromittiert haben:

<table data-header-hidden><thead><tr><th width="299.3076923076923"></th><th></th></tr></thead><tbody><tr><td><strong>Gruppe</strong></td><td><strong>Funktion</strong></td></tr><tr><td><strong><code>gcp-organization-admins</code></strong><br><em>(Gruppe oder individuelle Konten erforderlich f√ºr Checkliste)</em></td><td>Verwaltung von Ressourcen, die der Organisation geh√∂ren. Weisen Sie diese Rolle sparsam zu; Org-Administratoren haben Zugriff auf alle Ihre Google Cloud-Ressourcen. Alternativ, da diese Funktion sehr privilegiert ist, erw√§gen Sie die Verwendung von individuellen Konten anstelle der Erstellung einer Gruppe.</td></tr><tr><td><strong><code>gcp-network-admins</code></strong><br><em>(erforderlich f√ºr Checkliste)</em></td><td>Erstellen von Netzwerken, Subnetzen, Firewall-Regeln und Netzwerkger√§ten wie Cloud Router, Cloud VPN und Cloud-Lastenausgleicher.</td></tr><tr><td><strong><code>gcp-billing-admins</code></strong><br><em>(erforderlich f√ºr Checkliste)</em></td><td>Einrichten von Abrechnungskonten und √úberwachung ihres Verbrauchs.</td></tr><tr><td><strong><code>gcp-developers</code></strong><br><em>(erforderlich f√ºr Checkliste)</em></td><td>Entwurf, Codierung und Testen von Anwendungen.</td></tr><tr><td><strong><code>gcp-security-admins</code></strong><br></td><td>Einrichten und Verwalten von Sicherheitsrichtlinien f√ºr die gesamte Organisation, einschlie√ülich Zugriffsverwaltung und <a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints">Organisationsrichtlinienbeschr√§nkungen</a>. Weitere Informationen zur Planung Ihrer Google Cloud-Sicherheitsinfrastruktur finden Sie im <a href="https://cloud.google.com/architecture/security-foundations/authentication-authorization#users_and_groups">Google Cloud-Sicherheitsgrundlagenleitfaden</a>.</td></tr><tr><td><strong><code>gcp-devops</code></strong></td><td>Erstellen oder Verwalten von End-to-End-Pipelines, die die kontinuierliche Integration und Bereitstellung, √úberwachung und Systembereitstellung unterst√ºtzen.</td></tr><tr><td><strong><code>gcp-logging-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-logging-viewers</code></strong></td><td></td></tr><tr><td><strong><code>gcp-monitor-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-billing-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberwachung der Ausgaben f√ºr Projekte. Typische Mitglieder sind Teil des Finanzteams.</td></tr><tr><td><strong><code>gcp-platform-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberpr√ºfung von Ressourceninformationen in der gesamten Google Cloud-Organisation.</td></tr><tr><td><strong><code>gcp-security-reviewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberpr√ºfung der Cloud-Sicherheit.</td></tr><tr><td><strong><code>gcp-network-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberpr√ºfung von Netzwerkkonfigurationen.</td></tr><tr><td><strong><code>grp-gcp-audit-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>Anzeigen von Pr√ºfprotokollen.</td></tr><tr><td><strong><code>gcp-scc-admin</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>Verwalten des Security Command Center.</td></tr><tr><td><strong><code>gcp-secrets-admin</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>Verwalten von Geheimnissen im Secret Manager.</td></tr></tbody></table>

## **Standard-Passwortrichtlinie**

* Durchsetzung von starken Passw√∂rtern
* Zwischen 8 und 100 Zeichen
* Keine Wiederverwendung
* Kein Ablaufdatum
* Wenn Personen √ºber einen Drittanbieter auf Workspace zugreifen, werden diese Anforderungen nicht angewendet.

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## **Dienstkonten**

Dies sind die Prinzipale, die **Ressourcen** **angeh√§ngt** haben k√∂nnen und so einfach mit GCP interagieren k√∂nnen. Zum Beispiel ist es m√∂glich, auf das **Authentifizierungstoken** eines Dienstkontos zuzugreifen, das an eine VM **angeh√§ngt ist**, in den Metadaten.\
Es kann zu **Konflikten** kommen, wenn sowohl **IAM als auch Zugriffsberechtigungen** verwendet werden. Beispielsweise kann Ihr Dienstkonto die IAM-Rolle `compute.instanceAdmin` haben, aber die Instanz, auf die Sie zugegriffen haben, wurde mit der Bereichseinschr√§nkung `https://www.googleapis.com/auth/compute.readonly` eingeschr√§nkt. Dadurch wird verhindert, dass Sie √Ñnderungen mit dem automatisch Ihrem Instanz zugewiesenen OAuth-Token vornehmen k√∂nnen.

Es √§hnelt den **IAM-Rollen von AWS**. Aber anders als bei AWS kann **jedes** Dienstkonto **an jeden Dienst angeh√§ngt werden** (es muss nicht √ºber eine Richtlinie zugelassen werden).

Einige der Dienstkonten, die Sie finden werden, werden tats√§chlich **automatisch von GCP generiert**, wenn Sie einen Dienst verwenden, wie:

```
PROJECT_NUMBER-compute@developer.gserviceaccount.com
PROJECT_ID@appspot.gserviceaccount.com
```

Jedoch ist es auch m√∂glich, **benutzerdefinierte Dienstkonten** zu erstellen und an Ressourcen anzuh√§ngen, die wie folgt aussehen werden:

```
SERVICE_ACCOUNT_NAME@PROJECT_NAME.iam.gserviceaccount.com
```

### **Zugriffsberechtigungen**

Zugriffsberechtigungen werden **den generierten OAuth-Token zugeordnet**, um auf die GCP-API-Endpunkte zuzugreifen. Sie **beschr√§nken die Berechtigungen** des OAuth-Tokens.\
Das bedeutet, dass wenn ein Token einem Besitzer einer Ressource geh√∂rt, aber nicht √ºber den im Token festgelegten Bereich verf√ºgt, um auf diese Ressource zuzugreifen, kann das Token **nicht verwendet werden, um diese Berechtigungen zu missbrauchen**.

Google [empfiehlt](https://cloud.google.com/compute/docs/access/service-accounts#service\_account\_permissions) tats√§chlich, dass **Zugriffsberechtigungen nicht verwendet werden und vollst√§ndig auf IAM vertraut wird**. Das Web-Verwaltungsportal setzt dies tats√§chlich durch, aber Zugriffsberechtigungen k√∂nnen immer noch programmgesteuert auf Instanzen mit benutzerdefinierten Dienstkonten angewendet werden.

Sie k√∂nnen sehen, welche **Bereiche** **zugewiesen** sind, indem Sie **abfragen:**

{% code overflow="wrap" %}
```bash
curl 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=<access_token>'

{
"issued_to": "223044615559.apps.googleusercontent.com",
"audience": "223044615559.apps.googleusercontent.com",
"user_id": "139746512919298469201",
"scope": "openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/appengine.admin https://www.googleapis.com/auth/sqlservice.login https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/accounts.reauth",
"expires_in": 2253,
"email": "username@testing.com",
"verified_email": true,
"access_type": "offline"
}
```
{% endcode %}

Die vorherigen **Berechtigungen** werden standardm√§√üig von **`gcloud`** generiert, um auf Daten zuzugreifen. Dies liegt daran, dass Sie bei Verwendung von **`gcloud`** zun√§chst ein OAuth-Token erstellen und es dann verwenden, um die Endpunkte zu kontaktieren.

Die wichtigste Berechtigung davon ist wahrscheinlich **`cloud-platform`**, was im Grunde bedeutet, dass es m√∂glich ist, **auf jeden Dienst in GCP zuzugreifen**.

Eine Liste aller m√∂glichen Berechtigungen finden Sie [**hier**](https://developers.google.com/identity/protocols/googlescopes)**.**

Wenn Sie **`gcloud`**-Browseranmeldeinformationen haben, ist es m√∂glich, ein Token mit anderen Berechtigungen zu **erhalten, indem Sie etwas √Ñhnliches tun wie:**

{% code overflow="wrap" %}
```bash
# Maybe you can get a user token with other scopes changing the scopes array from ~/.config/gcloud/credentials.db

# Set new scopes for SDKs credentials
gcloud auth application-default login --scopes=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/sqlservice.login,https://www.googleapis.com/auth/appengine.admin,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/accounts.reauth,https://www.googleapis.com/auth/admin.directory.user,https://www.googleapis.com/auth/admin.directory.group,https://www.googleapis.com/auth/admin.directory.domain,https://www.googleapis.com/auth/admin.directory.user

# Print new token
gcloud auth application-default print-access-token

# To use this token with some API you might need to use curl to indicate the project header with --header "X-Goog-User-Project: <project-name>"
```
{% endcode %}

## **Terraform IAM-Richtlinien, Bindungen und Mitgliedschaften**

Wie von Terraform definiert in [https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam) gibt es verschiedene M√∂glichkeiten, einem Prinzipal Zugriff auf eine Ressource zu gew√§hren:

* **Mitgliedschaften**: Sie setzen **Prinzipale als Mitglieder von Rollen** **ohne Einschr√§nkungen** √ºber die Rolle oder die Prinzipale. Sie k√∂nnen einen Benutzer als Mitglied einer Rolle festlegen und dann eine Gruppe als Mitglied derselben Rolle festlegen und auch diese Prinzipale (Benutzer und Gruppe) als Mitglied anderer Rollen festlegen.
* **Bindungen**: Mehrere **Prinzipale k√∂nnen an eine Rolle gebunden werden**. Diese **Prinzipale k√∂nnen immer noch an andere Rollen gebunden sein oder Mitglieder anderer Rollen sein**. Wenn jedoch ein Prinzipal, der nicht an die Rolle gebunden ist, als **Mitglied einer gebundenen Rolle festgelegt wird**, verschwindet die Mitgliedschaft beim n√§chsten Mal, wenn die **Bindung angewendet wird**.
* **Richtlinien**: Eine Richtlinie ist **verbindlich**, sie gibt Rollen und Prinzipale an und dann k√∂nnen **diese Prinzipale keine weiteren Rollen haben und diese Rollen keine weiteren Prinzipale haben**, es sei denn, die Richtlinie wird ge√§ndert (nicht einmal in anderen Richtlinien, Bindungen oder Mitgliedschaften). Wenn also eine Rolle oder ein Prinzipal in einer Richtlinie festgelegt ist, sind alle seine Berechtigungen **durch diese Richtlinie eingeschr√§nkt**. Offensichtlich kann dies umgangen werden, falls dem Prinzipal die M√∂glichkeit gegeben wird, die Richtlinie zu √§ndern oder Berechtigungen f√ºr Eskalation von Privilegien zu erhalten (wie das Erstellen eines neuen Prinzipals und Zuweisen einer neuen Rolle).

## Referenzen

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks in PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
