# GCP - åŸºæœ¬ä¿¡æ¯

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDFï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## **èµ„æºå±‚æ¬¡ç»“æ„**

Google Cloud ä½¿ç”¨ç±»ä¼¼äºä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿçš„[èµ„æºå±‚æ¬¡ç»“æ„](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)ï¼Œåœ¨æ¦‚å¿µä¸Šç±»ä¼¼äºä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿã€‚è¿™æä¾›äº†ä¸€ä¸ªå…·æœ‰ç‰¹å®šç­–ç•¥å’Œæƒé™é™„åŠ ç‚¹çš„é€»è¾‘çˆ¶/å­å·¥ä½œæµç¨‹ã€‚

åœ¨é«˜å±‚æ¬¡ä¸Šï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š
```
Organization
--> Folders
--> Projects
--> Resources
```
è™šæ‹Ÿæœºï¼ˆç§°ä¸ºè®¡ç®—å®ä¾‹ï¼‰æ˜¯ä¸€ç§èµ„æºã€‚èµ„æºä½äºä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¸å…¶ä»–è®¡ç®—å®ä¾‹ã€å­˜å‚¨æ¡¶ç­‰èµ„æºä¸€èµ·ã€‚

<figure><img src="../../.gitbook/assets/image (5) (1).png" alt=""><figcaption></figcaption></figure>

## **é¡¹ç›®è¿ç§»**

å¯ä»¥å°†ä¸€ä¸ªæ²¡æœ‰ä»»ä½•ç»„ç»‡çš„é¡¹ç›®è¿ç§»åˆ°å…·æœ‰`roles/resourcemanager.projectCreator`å’Œ`roles/resourcemanager.projectMover`æƒé™çš„ç»„ç»‡ä¸­ã€‚å¦‚æœé¡¹ç›®ä½äºå…¶ä»–ç»„ç»‡ä¸­ï¼Œåˆ™éœ€è¦è”ç³»GCPæ”¯æŒäººå‘˜å…ˆå°†å…¶ç§»å‡ºç»„ç»‡ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§[**æ­¤å¤„**](https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6)ã€‚

## **ç»„ç»‡ç­–ç•¥**

å…è®¸é›†ä¸­æ§åˆ¶ç»„ç»‡çš„äº‘èµ„æºï¼š

* é›†ä¸­æ§åˆ¶ä»¥**é…ç½®é™åˆ¶**ç»„ç»‡èµ„æºçš„ä½¿ç”¨æ–¹å¼ã€‚
* ä¸ºå¼€å‘å›¢é˜Ÿ**å®šä¹‰å’Œå»ºç«‹**åˆè§„è¾¹ç•Œå†…çš„**é™åˆ¶æ¡ä»¶**ã€‚
* å¸®åŠ©é¡¹ç›®æ‰€æœ‰è€…åŠå…¶å›¢é˜Ÿå¿«é€Ÿç§»åŠ¨ï¼Œæ— éœ€æ‹…å¿ƒè¿ååˆè§„æ€§ã€‚

è¿™äº›ç­–ç•¥å¯ä»¥åˆ›å»ºä»¥**å½±å“æ•´ä¸ªç»„ç»‡ã€æ–‡ä»¶å¤¹æˆ–é¡¹ç›®**çš„æ–¹å¼ã€‚ç›®æ ‡èµ„æºå±‚æ¬¡ç»“æ„èŠ‚ç‚¹çš„**åä»£ç»§æ‰¿ç»„ç»‡ç­–ç•¥**ã€‚

ä¸ºäº†**å®šä¹‰**ç»„ç»‡ç­–ç•¥ï¼Œ**é€‰æ‹©ä¸€ä¸ª**[**çº¦æŸæ¡ä»¶**](https://cloud.google.com/resource-manager/docs/organization-policy/overview#constraints)ï¼Œå®ƒæ˜¯é’ˆå¯¹Google CloudæœåŠ¡æˆ–ä¸€ç»„Google CloudæœåŠ¡çš„ç‰¹å®šç±»å‹çš„é™åˆ¶ã€‚æ‚¨å¯ä»¥**ä½¿ç”¨æ‰€éœ€çš„é™åˆ¶æ¡ä»¶é…ç½®è¯¥çº¦æŸæ¡ä»¶**ã€‚

<figure><img src="../../.gitbook/assets/image (5) (4).png" alt=""><figcaption></figcaption></figure>

#### å¸¸è§ç”¨ä¾‹ <a href="#common_use_cases" id="common_use_cases"></a>

* åŸºäºåŸŸé™åˆ¶èµ„æºå…±äº«ã€‚
* é™åˆ¶èº«ä»½å’Œè®¿é—®ç®¡ç†æœåŠ¡è´¦å·çš„ä½¿ç”¨ã€‚
* é™åˆ¶æ–°åˆ›å»ºèµ„æºçš„ç‰©ç†ä½ç½®ã€‚
* ç¦ç”¨æœåŠ¡è´¦å·åˆ›å»ºã€‚

<figure><img src="../../.gitbook/assets/image (83).png" alt=""><figcaption></figcaption></figure>

è¿˜æœ‰è®¸å¤šå…¶ä»–çº¦æŸæ¡ä»¶å¯ä»¥å¯¹ç»„ç»‡çš„èµ„æºè¿›è¡Œç²¾ç»†æ§åˆ¶ã€‚æœ‰å…³**æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§**[**æ‰€æœ‰ç»„ç»‡ç­–ç•¥æœåŠ¡çº¦æŸæ¡ä»¶çš„åˆ—è¡¨**](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints)**ã€‚**

## **IAMè§’è‰²**

è¿™äº›è§’è‰²ç±»ä¼¼äºAWSä¸­çš„IAMç­–ç•¥ï¼Œ**æ¯ä¸ªè§’è‰²åŒ…å«ä¸€ç»„æƒé™**ã€‚

ç„¶è€Œï¼Œä¸AWSä¸åŒçš„æ˜¯ï¼Œ**æ²¡æœ‰é›†ä¸­çš„è§’è‰²å­˜å‚¨åº“**ã€‚è€Œæ˜¯**èµ„æºå‘ä¸»ä½“æä¾›Xè®¿é—®è§’è‰²**ï¼Œæ‰¾å‡ºè°å¯ä»¥è®¿é—®èµ„æºçš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿ç”¨**`get-iam-policy`æ–¹æ³•æŸ¥è¯¢è¯¥èµ„æº**ã€‚\
è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºè¿™æ„å‘³ç€æ‰¾å‡ºä¸€ä¸ªä¸»ä½“æ‹¥æœ‰å“ªäº›æƒé™çš„å”¯ä¸€æ–¹æ³•æ˜¯è¯¢é—®æ¯ä¸ªèµ„æºå®ƒæˆäºˆæƒé™çš„å¯¹è±¡ï¼Œå¹¶ä¸”ç”¨æˆ·å¯èƒ½æ²¡æœ‰æƒé™ä»æ‰€æœ‰èµ„æºè·å–æƒé™ã€‚

IAMæœ‰**ä¸‰ç§ç±»å‹**çš„è§’è‰²ï¼š

* **åŸºæœ¬/åŸå§‹è§’è‰²**ï¼ŒåŒ…æ‹¬åœ¨å¼•å…¥IAMä¹‹å‰å­˜åœ¨çš„**Owner**ã€**Editor**å’Œ**Viewer**è§’è‰²ã€‚
* **é¢„å®šä¹‰è§’è‰²**ï¼Œä¸ºç‰¹å®šæœåŠ¡æä¾›ç»†ç²’åº¦è®¿é—®æƒé™ï¼Œç”±Google Cloudç®¡ç†ã€‚æœ‰å¾ˆå¤šé¢„å®šä¹‰è§’è‰²ï¼Œæ‚¨å¯ä»¥**åœ¨æ­¤å¤„æŸ¥çœ‹å®ƒä»¬åŠå…¶æƒé™**[**here**](https://cloud.google.com/iam/docs/understanding-roles#predefined\_roles)ã€‚
* **è‡ªå®šä¹‰è§’è‰²**ï¼Œæ ¹æ®ç”¨æˆ·æŒ‡å®šçš„æƒé™åˆ—è¡¨æä¾›ç»†ç²’åº¦è®¿é—®æƒé™ã€‚

GCPä¸­æœ‰æ•°åƒä¸ªæƒé™ã€‚ä¸ºäº†æ£€æŸ¥è§’è‰²æ˜¯å¦å…·æœ‰æŸä¸ªæƒé™ï¼Œæ‚¨å¯ä»¥[**åœ¨æ­¤å¤„æœç´¢æƒé™**](https://cloud.google.com/iam/docs/permissions-reference)å¹¶æŸ¥çœ‹å…·æœ‰è¯¥æƒé™çš„è§’è‰²ã€‚&#x20;

æ‚¨è¿˜å¯ä»¥[**åœ¨æ­¤å¤„æœç´¢æ¯ä¸ªäº§å“æä¾›çš„é¢„å®šä¹‰è§’è‰²**](https://cloud.google.com/iam/docs/understanding-roles#product\_specific\_documentation)**ã€‚**è¯·æ³¨æ„ï¼ŒæŸäº›**è§’è‰²**ä¸èƒ½é™„åŠ ç»™ç”¨æˆ·ï¼Œ**åªèƒ½é™„åŠ ç»™æœåŠ¡è´¦å·**ï¼Œå› ä¸ºå®ƒä»¬åŒ…å«æŸäº›æƒé™ã€‚\
æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œ**æƒé™**åªæœ‰åœ¨é™„åŠ åˆ°ç›¸å…³æœåŠ¡æ—¶æ‰ä¼š**ç”Ÿæ•ˆ**ã€‚

æˆ–è€…åœ¨[**æ­¤å¤„æ£€æŸ¥è‡ªå®šä¹‰è§’è‰²æ˜¯å¦å¯ä»¥ä½¿ç”¨ç‰¹å®šæƒé™**](https://cloud.google.com/iam/docs/custom-roles-permissions-support)**ã€‚**

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

## ç”¨æˆ· <a href="#default-credentials" id="default-credentials"></a>

åœ¨**GCPæ§åˆ¶å°**ä¸­ï¼Œ**æ²¡æœ‰ä»»ä½•ç”¨æˆ·æˆ–ç»„**ç®¡ç†ï¼Œè¿™æ˜¯åœ¨**Google Workspace**ä¸­å®Œæˆçš„ã€‚å°½ç®¡æ‚¨å¯ä»¥åœ¨Google Workspaceä¸­åŒæ­¥ä¸åŒçš„èº«ä»½æä¾›è€…ã€‚

æ‚¨å¯ä»¥åœ¨[**https://admin.google.com**](https://admin.google.com/)ä¸­è®¿é—®Workspacesçš„**ç”¨æˆ·å’Œç»„**ã€‚

å¯ä»¥**å¼ºåˆ¶**Workspacesç”¨æˆ·ä½¿ç”¨**MFA**ï¼Œä½†æ˜¯æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ä»¤ç‰Œé€šè¿‡cliè®¿é—®GCPï¼Œè€Œcliä¸å—MFAä¿æŠ¤ï¼ˆä»…åœ¨ç”¨æˆ·ç™»å½•ä»¥ç”Ÿæˆä»¤ç‰Œæ—¶å—MFAä¿æŠ¤ï¼š`gcloud auth login`ï¼‰ã€‚

## ç»„

åˆ›å»ºç»„ç»‡æ—¶ï¼Œ**å¼ºçƒˆå»ºè®®åˆ›å»ºå‡ ä¸ªç»„**ã€‚å¦‚æœæ‚¨ç®¡ç†å…¶ä¸­ä»»ä½•ä¸€ä¸ªç»„ï¼Œå¯èƒ½ä¼šå±åŠæ•´ä¸ªç»„ç»‡æˆ–é‡è¦éƒ¨åˆ†ï¼š
| ç»„ | åŠŸèƒ½ |
| --- | --- |
| grp-gcp-organization-admins | ç®¡ç†å±äºç»„ç»‡çš„ä»»ä½•èµ„æºã€‚è¯·è°¨æ…åˆ†é…æ­¤è§’è‰²ï¼›ç»„ç»‡ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‚¨çš„æ‰€æœ‰Google Cloudèµ„æºã€‚æˆ–è€…ï¼Œè€ƒè™‘ä½¿ç”¨ä¸ªäººå¸æˆ·è€Œä¸æ˜¯åˆ›å»ºç»„ï¼Œå› ä¸ºæ­¤åŠŸèƒ½æƒé™éå¸¸é«˜ã€‚ |
| grp-gcp-network-admins | åˆ›å»ºç½‘ç»œã€å­ç½‘ã€é˜²ç«å¢™è§„åˆ™å’Œç½‘ç»œè®¾å¤‡ï¼Œå¦‚Cloud Routerã€Cloud VPNå’Œäº‘è´Ÿè½½å‡è¡¡å™¨ã€‚ |
| grp-gcp-billing-admins | è®¾ç½®è®¡è´¹å¸æˆ·å¹¶ç›‘æ§å…¶ä½¿ç”¨æƒ…å†µã€‚ |
| grp-gcp-developers | è®¾è®¡ã€ç¼–ç å’Œæµ‹è¯•åº”ç”¨ç¨‹åºã€‚ |
| grp-gcp-security-admins | ä¸ºæ•´ä¸ªç»„ç»‡å»ºç«‹å’Œç®¡ç†å®‰å…¨ç­–ç•¥ï¼ŒåŒ…æ‹¬è®¿é—®ç®¡ç†å’Œç»„ç»‡çº¦æŸç­–ç•¥ã€‚æœ‰å…³è§„åˆ’Google Cloudå®‰å…¨åŸºç¡€è®¾æ–½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Google Cloudå®‰å…¨åŸºç¡€æŒ‡å—ã€‚ |
| grp-gcp-devops | åˆ›å»ºæˆ–ç®¡ç†æ”¯æŒæŒç»­é›†æˆå’Œäº¤ä»˜ã€ç›‘æ§å’Œç³»ç»Ÿé…ç½®çš„ç«¯åˆ°ç«¯æµæ°´çº¿ã€‚ |
| grp-gcp-billing-viewer | ç›‘æ§é¡¹ç›®çš„æ”¯å‡ºã€‚å…¸å‹æˆå‘˜æ˜¯è´¢åŠ¡å›¢é˜Ÿçš„ä¸€éƒ¨åˆ†ã€‚ |
| grp-gcp-platform-viewer | æŸ¥çœ‹Google Cloudç»„ç»‡ä¸­çš„èµ„æºä¿¡æ¯ã€‚ |
| grp-gcp-security-reviewer | å®¡æŸ¥äº‘å®‰å…¨ã€‚ |
| grp-gcp-network-viewer | æŸ¥çœ‹ç½‘ç»œé…ç½®ã€‚ |
| grp-gcp-audit-viewer | æŸ¥çœ‹å®¡è®¡æ—¥å¿—ã€‚ |
| grp-gcp-scc-admin | ç®¡ç†å®‰å…¨å‘½ä»¤ä¸­å¿ƒã€‚ |
| grp-gcp-secrets-admin | åœ¨Secret Managerä¸­ç®¡ç†å¯†é’¥ã€‚ |

## **é»˜è®¤å¯†ç ç­–ç•¥**

<figure><img src="../../.gitbook/assets/image (1) (9).png" alt=""><figcaption></figcaption></figure>

## **æœåŠ¡å¸æˆ·**

è¿™äº›æ˜¯èµ„æºå¯ä»¥é™„åŠ å¹¶ä¸GCPè½»æ¾äº¤äº’çš„ä¸»ä½“ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨å…ƒæ•°æ®ä¸­è®¿é—®é™„åŠ åˆ°VMçš„æœåŠ¡å¸æˆ·çš„èº«ä»½éªŒè¯ä»¤ç‰Œã€‚\
åœ¨ä½¿ç”¨IAMå’Œè®¿é—®èŒƒå›´æ—¶å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å†²çªã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„æœåŠ¡å¸æˆ·å¯èƒ½å…·æœ‰`compute.instanceAdmin`çš„IAMè§’è‰²ï¼Œä½†æ‚¨å…¥ä¾µçš„å®ä¾‹å¯èƒ½å—åˆ°`https://www.googleapis.com/auth/compute.readonly`èŒƒå›´é™åˆ¶çš„é™åˆ¶ã€‚è¿™å°†é˜»æ­¢æ‚¨ä½¿ç”¨è‡ªåŠ¨åˆ†é…ç»™å®ä¾‹çš„OAuthä»¤ç‰Œè¿›è¡Œä»»ä½•æ›´æ”¹ã€‚

è¿™ç±»ä¼¼äºAWSçš„IAMè§’è‰²ã€‚ä½†ä¸AWSä¸åŒçš„æ˜¯ï¼Œä»»ä½•æœåŠ¡å¸æˆ·éƒ½å¯ä»¥é™„åŠ åˆ°ä»»ä½•æœåŠ¡ï¼ˆä¸éœ€è¦é€šè¿‡ç­–ç•¥å…è®¸ï¼‰ã€‚

æ‚¨å°†å‘ç°çš„ä¸€äº›æœåŠ¡å¸æˆ·å®é™…ä¸Šæ˜¯åœ¨æ‚¨å¼€å§‹ä½¿ç”¨æœåŠ¡æ—¶ç”±GCPè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¾‹å¦‚ï¼š
```
PROJECT_NUMBER-compute@developer.gserviceaccount.com
PROJECT_ID@appspot.gserviceaccount.com
```
ç„¶è€Œï¼Œæ‚¨ä¹Ÿå¯ä»¥åˆ›å»ºå’Œé™„åŠ åˆ°èµ„æºçš„**è‡ªå®šä¹‰æœåŠ¡å¸å·**ï¼Œå…¶å½¢å¼å¦‚ä¸‹ï¼š
```
SERVICE_ACCOUNT_NAME@PROJECT_NAME.iam.gserviceaccount.com
```
### **è®¿é—®èŒƒå›´**

è®¿é—®èŒƒå›´æ˜¯é™„åŠ åˆ°ç”Ÿæˆçš„OAuthä»¤ç‰Œä¸Šçš„ï¼Œç”¨äºè®¿é—®GCP APIç«¯ç‚¹çš„ã€‚å®ƒä»¬é™åˆ¶äº†OAuthä»¤ç‰Œçš„æƒé™ã€‚

è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªä»¤ç‰Œå±äºèµ„æºçš„æ‰€æœ‰è€…ï¼Œä½†åœ¨ä»¤ç‰ŒèŒƒå›´å†…æ²¡æœ‰è®¿é—®è¯¥èµ„æºçš„æƒé™ï¼Œé‚£ä¹ˆè¯¥ä»¤ç‰Œå°†æ— æ³•è¢«ç”¨äºæ»¥ç”¨è¿™äº›ç‰¹æƒã€‚

Googleå®é™…ä¸Šå»ºè®®ä¸ä½¿ç”¨è®¿é—®èŒƒå›´ï¼Œå®Œå…¨ä¾èµ–äºIAMã€‚Webç®¡ç†é—¨æˆ·å®é™…ä¸Šå¼ºåˆ¶æ‰§è¡Œäº†è¿™ä¸€ç‚¹ï¼Œä½†ä»ç„¶å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æœåŠ¡å¸æˆ·ä»¥ç¼–ç¨‹æ–¹å¼å°†è®¿é—®èŒƒå›´åº”ç”¨äºå®ä¾‹ã€‚

æ‚¨å¯ä»¥é€šè¿‡æŸ¥è¯¢æ¥æŸ¥çœ‹åˆ†é…äº†å“ªäº›èŒƒå›´ï¼š

{% code overflow="wrap" %}
```bash
curl 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=<access_token>'

{
"issued_to": "223044615559.apps.googleusercontent.com",
"audience": "223044615559.apps.googleusercontent.com",
"user_id": "139746512919298469201",
"scope": "openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/appengine.admin https://www.googleapis.com/auth/sqlservice.login https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/accounts.reauth",
"expires_in": 2253,
"email": "username@testing.com",
"verified_email": true,
"access_type": "offline"
}
```
{% endcode %}

ä¹‹å‰çš„**èŒƒå›´ï¼ˆscopesï¼‰**æ˜¯ä½¿ç”¨**`gcloud`**è®¿é—®æ•°æ®æ—¶ç”Ÿæˆçš„é»˜è®¤èŒƒå›´ã€‚è¿™æ˜¯å› ä¸ºå½“æ‚¨ä½¿ç”¨**`gcloud`**æ—¶ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªOAuthä»¤ç‰Œï¼Œç„¶åä½¿ç”¨å®ƒæ¥è”ç³»ç»ˆç«¯ã€‚

å…¶ä¸­æœ€é‡è¦çš„èŒƒå›´å¯èƒ½æ˜¯**`cloud-platform`**ï¼Œå®ƒåŸºæœ¬ä¸Šæ„å‘³ç€å¯ä»¥**è®¿é—®GCPä¸­çš„ä»»ä½•æœåŠ¡**ã€‚

æ‚¨å¯ä»¥åœ¨[**è¿™é‡Œæ‰¾åˆ°æ‰€æœ‰å¯èƒ½çš„èŒƒå›´åˆ—è¡¨**](https://developers.google.com/identity/protocols/googlescopes)**ã€‚**

å¦‚æœæ‚¨æ‹¥æœ‰**`gcloud`**æµè§ˆå™¨å‡­æ®ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œç±»ä¼¼ä»¥ä¸‹æ“ä½œæ¥**è·å–å…·æœ‰å…¶ä»–èŒƒå›´çš„ä»¤ç‰Œ**ï¼š

{% code overflow="wrap" %}
```bash
# Maybe you can get a user token with other scopes changing the scopes array from ~/.config/gcloud/credentials.db

# Set new scopes for SDKs credentials
gcloud auth application-default login --scopes=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/sqlservice.login,https://www.googleapis.com/auth/appengine.admin,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/accounts.reauth,https://www.googleapis.com/auth/admin.directory.user,https://www.googleapis.com/auth/admin.directory.group,https://www.googleapis.com/auth/admin.directory.domain

# Print new token
gcloud auth application-default print-access-token

# To use this token with some API you might need to use curl to indicate the project header with --header "X-Goog-User-Project: <project-name>"
```
{% endcode %}

## **Terraform IAMç­–ç•¥ã€ç»‘å®šå’Œæˆå‘˜å…³ç³»**

æ ¹æ®terraformåœ¨[https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam)ä¸­çš„å®šä¹‰ï¼Œä½¿ç”¨terraformä¸GCPä¸€èµ·ï¼Œæœ‰ä¸åŒçš„æ–¹æ³•å¯ä»¥æˆäºˆä¸»ä½“å¯¹èµ„æºçš„è®¿é—®æƒé™ï¼š

* **æˆå‘˜å…³ç³»**ï¼šæ‚¨å¯ä»¥å°†**ä¸»ä½“è®¾ç½®ä¸ºè§’è‰²çš„æˆå‘˜**ï¼Œ**æ²¡æœ‰é™åˆ¶**å¯¹è§’è‰²æˆ–ä¸»ä½“çš„é™åˆ¶ã€‚æ‚¨å¯ä»¥å°†ç”¨æˆ·è®¾ç½®ä¸ºè§’è‰²çš„æˆå‘˜ï¼Œç„¶åå°†ç»„è®¾ç½®ä¸ºç›¸åŒè§’è‰²çš„æˆå‘˜ï¼Œå¹¶å°†è¿™äº›ä¸»ä½“ï¼ˆç”¨æˆ·å’Œç»„ï¼‰è®¾ç½®ä¸ºå…¶ä»–è§’è‰²çš„æˆå‘˜ã€‚
* **ç»‘å®š**ï¼šå¯ä»¥å°†å¤šä¸ª**ä¸»ä½“ç»‘å®šåˆ°ä¸€ä¸ªè§’è‰²**ã€‚è¿™äº›**ä¸»ä½“ä»ç„¶å¯ä»¥ç»‘å®šæˆ–æˆä¸ºå…¶ä»–è§’è‰²çš„æˆå‘˜**ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†æœªç»‘å®šåˆ°è§’è‰²çš„ä¸»ä½“è®¾ç½®ä¸º**ç»‘å®šè§’è‰²çš„æˆå‘˜**ï¼Œåˆ™ä¸‹æ¬¡**åº”ç”¨ç»‘å®šæ—¶ï¼Œæˆå‘˜å…³ç³»å°†æ¶ˆå¤±**ã€‚
* **ç­–ç•¥**ï¼šç­–ç•¥æ˜¯**æœ‰æƒå¨çš„**ï¼Œå®ƒæŒ‡ç¤ºè§’è‰²å’Œä¸»ä½“ï¼Œç„¶åï¼Œ**é™¤éä¿®æ”¹è¯¥ç­–ç•¥**ï¼ˆç”šè‡³åœ¨å…¶ä»–ç­–ç•¥ã€ç»‘å®šæˆ–æˆå‘˜å…³ç³»ä¸­ï¼‰ï¼Œå¦åˆ™è¿™äº›ä¸»ä½“ä¸èƒ½æ‹¥æœ‰æ›´å¤šè§’è‰²ï¼Œè¿™äº›è§’è‰²ä¸èƒ½æ‹¥æœ‰æ›´å¤šä¸»ä½“ã€‚å› æ­¤ï¼Œå½“åœ¨ç­–ç•¥ä¸­æŒ‡å®šè§’è‰²æˆ–ä¸»ä½“æ—¶ï¼Œæ‰€æœ‰ç‰¹æƒéƒ½å—åˆ°è¯¥ç­–ç•¥çš„**é™åˆ¶**ã€‚æ˜¾ç„¶ï¼Œå¦‚æœä¸»ä½“è¢«èµ‹äºˆä¿®æ”¹ç­–ç•¥æˆ–ç‰¹æƒå‡çº§æƒé™çš„é€‰é¡¹ï¼ˆä¾‹å¦‚åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸»ä½“å¹¶å°†å…¶ç»‘å®šåˆ°æ–°çš„è§’è‰²ï¼‰ï¼Œåˆ™å¯ä»¥ç»•è¿‡æ­¤é™åˆ¶ã€‚

## å‚è€ƒèµ„æ–™

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**ï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
