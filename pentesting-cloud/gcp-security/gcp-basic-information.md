# GCP - åŸºæœ¬ä¿¡æ¯

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## **èµ„æºå±‚æ¬¡ç»“æ„**

Google Cloud ä½¿ç”¨ä¸€ç§[èµ„æºå±‚æ¬¡ç»“æ„](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)ï¼Œåœ¨æ¦‚å¿µä¸Šç±»ä¼¼äºä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿã€‚è¿™æä¾›äº†ä¸€ä¸ªå…·æœ‰ç‰¹å®šç­–ç•¥å’Œæƒé™é™„ç€ç‚¹çš„é€»è¾‘çˆ¶/å­å·¥ä½œæµç¨‹ã€‚

ä»é«˜å±‚æ¬¡æ¥çœ‹ï¼Œå®ƒæ˜¯è¿™æ ·çš„ï¼š
```
Organization
--> Folders
--> Projects
--> Resources
```
è™šæ‹Ÿæœºï¼ˆç§°ä¸ºè®¡ç®—å®ä¾‹ï¼‰æ˜¯ä¸€ç§èµ„æºã€‚èµ„æºä½äºé¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¸å…¶ä»–è®¡ç®—å®ä¾‹ã€å­˜å‚¨æ¡¶ç­‰ä¸€èµ·ã€‚

<figure><img src="../../.gitbook/assets/image (5) (1) (1).png" alt=""><figcaption></figcaption></figure>

## **é¡¹ç›®è¿ç§»**

å¯ä»¥**å°†æ²¡æœ‰ä»»ä½•ç»„ç»‡çš„é¡¹ç›®è¿ç§»**è‡³å…·æœ‰æƒé™ `roles/resourcemanager.projectCreator` å’Œ `roles/resourcemanager.projectMover` çš„ç»„ç»‡ã€‚å¦‚æœé¡¹ç›®ä½äºå…¶ä»–ç»„ç»‡å†…ï¼Œéœ€è¦å…ˆè”ç³» GCP æ”¯æŒ**å°†å®ƒä»¬ç§»å‡ºç»„ç»‡**ã€‚æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹[**æ­¤å¤„**](https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6)ã€‚

## **ç»„ç»‡ç­–ç•¥**

å…è®¸é›†ä¸­æ§åˆ¶ç»„ç»‡çš„äº‘èµ„æºï¼š

* é›†ä¸­æ§åˆ¶ä»¥**é…ç½®é™åˆ¶**ï¼Œè§„å®šç»„ç»‡èµ„æºçš„ä½¿ç”¨æ–¹å¼ã€‚
* å®šä¹‰å¹¶å»ºç«‹**é˜²æŠ¤æ **ï¼Œè®©å¼€å‘å›¢é˜Ÿåœ¨åˆè§„è¾¹ç•Œå†…æ“ä½œã€‚
* å¸®åŠ©é¡¹ç›®æ‰€æœ‰è€…åŠå…¶å›¢é˜Ÿå¿«é€Ÿè¡ŒåŠ¨ï¼Œæ— éœ€æ‹…å¿ƒè¿ååˆè§„æ€§ã€‚

è¿™äº›ç­–ç•¥å¯ä»¥åˆ›å»ºä»¥**å½±å“æ•´ä¸ªç»„ç»‡ã€æ–‡ä»¶å¤¹æˆ–é¡¹ç›®**ã€‚ç›®æ ‡èµ„æºå±‚æ¬¡ç»“æ„èŠ‚ç‚¹çš„åä»£**ç»§æ‰¿ç»„ç»‡ç­–ç•¥**ã€‚

ä¸ºäº†**å®šä¹‰**ç»„ç»‡ç­–ç•¥ï¼Œ**æ‚¨éœ€è¦é€‰æ‹©ä¸€ä¸ª**[**çº¦æŸ**](https://cloud.google.com/resource-manager/docs/organization-policy/overview#constraints)ï¼Œè¿™æ˜¯é’ˆå¯¹ Google Cloud æœåŠ¡æˆ–ä¸€ç»„ Google Cloud æœåŠ¡çš„ç‰¹å®šç±»å‹çš„é™åˆ¶ã€‚æ‚¨**æ ¹æ®æ‰€éœ€çš„é™åˆ¶é…ç½®è¯¥çº¦æŸ**ã€‚

<figure><img src="../../.gitbook/assets/image (5) (4).png" alt=""><figcaption></figcaption></figure>

#### å¸¸è§ç”¨ä¾‹ <a href="#common_use_cases" id="common_use_cases"></a>

* æ ¹æ®åŸŸé™åˆ¶èµ„æºå…±äº«ã€‚
* é™åˆ¶èº«ä»½å’Œè®¿é—®ç®¡ç†æœåŠ¡è´¦æˆ·çš„ä½¿ç”¨ã€‚
* é™åˆ¶æ–°åˆ›å»ºèµ„æºçš„ç‰©ç†ä½ç½®ã€‚
* ç¦ç”¨æœåŠ¡è´¦æˆ·åˆ›å»º

<figure><img src="../../.gitbook/assets/image (83).png" alt=""><figcaption></figcaption></figure>

è¿˜æœ‰è®¸å¤šå…¶ä»–çº¦æŸï¼Œå¯ä»¥è®©æ‚¨å¯¹ç»„ç»‡çš„èµ„æºè¿›è¡Œç»†ç²’åº¦æ§åˆ¶ã€‚æœ‰å…³**æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹**[**æ‰€æœ‰ç»„ç»‡ç­–ç•¥æœåŠ¡çº¦æŸçš„åˆ—è¡¨**](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints)**ã€‚**

## **IAM è§’è‰²**

å®ƒä»¬ç±»ä¼¼äº AWS ä¸­çš„ IAM ç­–ç•¥ï¼Œå› ä¸º**æ¯ä¸ªè§’è‰²åŒ…å«ä¸€ç»„æƒé™**ã€‚

ç„¶è€Œï¼Œä¸ AWS ä¸åŒï¼Œè¿™é‡Œ**æ²¡æœ‰é›†ä¸­çš„è§’è‰²ä»“åº“**ã€‚ç›¸åï¼Œ**èµ„æºå‘ Y ä¸»ä½“æˆäºˆ X è®¿é—®è§’è‰²**ï¼Œæ‰¾å‡ºè°æœ‰æƒè®¿é—®èµ„æºçš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿ç”¨**è¯¥èµ„æºä¸Šçš„ `get-iam-policy` æ–¹æ³•**ã€‚\
è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºè¿™æ„å‘³ç€æ‰¾å‡º**ä¸»ä½“æ‹¥æœ‰å“ªäº›æƒé™çš„å”¯ä¸€æ–¹æ³•æ˜¯è¯¢é—®æ¯ä¸ªèµ„æºå®ƒæˆäºˆäº†å“ªäº›æƒé™**ï¼Œè€Œç”¨æˆ·å¯èƒ½æ²¡æœ‰æƒé™ä»æ‰€æœ‰èµ„æºè·å–æƒé™ã€‚

IAM ä¸­æœ‰**ä¸‰ç§ç±»å‹**çš„è§’è‰²ï¼š

* **åŸºæœ¬/åŸå§‹è§’è‰²**ï¼ŒåŒ…æ‹¬åœ¨å¼•å…¥ IAM ä¹‹å‰å°±å­˜åœ¨çš„**æ‰€æœ‰è€…**ã€**ç¼–è¾‘è€…**å’Œ**æŸ¥çœ‹è€…**è§’è‰²ã€‚
* **é¢„å®šä¹‰è§’è‰²**ï¼Œä¸ºç‰¹å®šæœåŠ¡æä¾›ç»†ç²’åº¦è®¿é—®æƒé™ï¼Œå¹¶ç”± Google Cloud ç®¡ç†ã€‚æœ‰å¾ˆå¤šé¢„å®šä¹‰è§’è‰²ï¼Œæ‚¨å¯ä»¥**åœ¨è¿™é‡ŒæŸ¥çœ‹å®ƒä»¬åŠå…¶æƒé™**[**è¿™é‡Œ**](https://cloud.google.com/iam/docs/understanding-roles#predefined_roles)ã€‚
* **è‡ªå®šä¹‰è§’è‰²**ï¼Œæ ¹æ®ç”¨æˆ·æŒ‡å®šçš„æƒé™åˆ—è¡¨æä¾›ç»†ç²’åº¦è®¿é—®æƒé™ã€‚

GCP ä¸­æœ‰æ•°åƒä¸ªæƒé™ã€‚ä¸ºäº†æ£€æŸ¥è§’è‰²æ˜¯å¦æ‹¥æœ‰æƒé™ï¼Œæ‚¨å¯ä»¥[**åœ¨è¿™é‡Œæœç´¢æƒé™**](https://cloud.google.com/iam/docs/permissions-reference)ï¼Œå¹¶æŸ¥çœ‹å“ªäº›è§’è‰²æ‹¥æœ‰å®ƒã€‚

æ‚¨è¿˜å¯ä»¥[**åœ¨è¿™é‡Œæœç´¢æ¯ä¸ªäº§å“æä¾›çš„é¢„å®šä¹‰è§’è‰²**](https://cloud.google.com/iam/docs/understanding-roles#product_specific_documentation)ã€‚è¯·æ³¨æ„ï¼ŒæŸäº›**è§’è‰²**ä¸èƒ½é™„åŠ ç»™ç”¨æˆ·ï¼Œ**åªèƒ½é™„åŠ ç»™æœåŠ¡è´¦æˆ·ï¼Œå› ä¸ºå®ƒä»¬åŒ…å«çš„æŸäº›æƒé™**ã€‚\
æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œ**æƒé™**åªæœ‰åœ¨**é™„åŠ åˆ°ç›¸å…³æœåŠ¡æ—¶æ‰ä¼šç”Ÿæ•ˆ**ã€‚

æˆ–è€…æ£€æŸ¥**è‡ªå®šä¹‰è§’è‰²æ˜¯å¦å¯ä»¥ä½¿ç”¨**[**ç‰¹å®šæƒé™åœ¨è¿™é‡Œ**](https://cloud.google.com/iam/docs/custom-roles-permissions-support)**ã€‚**

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

## ç”¨æˆ· <a href="#default-credentials" id="default-credentials"></a>

åœ¨ **GCP æ§åˆ¶å°**ä¸­ï¼Œ**æ²¡æœ‰ä»»ä½•ç”¨æˆ·æˆ–ç»„**ç®¡ç†ï¼Œè¿™æ˜¯åœ¨ **Google Workspace** ä¸­å®Œæˆçš„ã€‚å°½ç®¡æ‚¨å¯ä»¥åœ¨ Google Workspace ä¸­åŒæ­¥ä¸åŒçš„èº«ä»½æä¾›è€…ã€‚

æ‚¨å¯ä»¥åœ¨[**https://admin.google.com**](https://admin.google.com/)è®¿é—® Workspace **ç”¨æˆ·å’Œç»„**ã€‚

**MFA** å¯ä»¥å¼ºåˆ¶åº”ç”¨äº Workspace ç”¨æˆ·ï¼Œç„¶è€Œï¼Œ**æ”»å‡»è€…**å¯ä»¥ä½¿ç”¨ä»¤ç‰Œé€šè¿‡ cli è®¿é—® GCPï¼Œ**è¿™ä¸ä¼šå—åˆ° MFA çš„ä¿æŠ¤**ï¼ˆä»…åœ¨ç”¨æˆ·ç™»å½•ç”Ÿæˆå®ƒæ—¶å—åˆ° MFA ä¿æŠ¤ï¼š`gcloud auth login`ï¼‰ã€‚

## ç»„

å½“åˆ›å»ºç»„ç»‡æ—¶ï¼Œå¼ºçƒˆå»ºè®®åˆ›å»ºå‡ ä¸ªç»„ã€‚å¦‚æœæ‚¨ç®¡ç†å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œæ‚¨å¯èƒ½å·²ç»å±åŠäº†æ•´ä¸ªç»„ç»‡æˆ–å…¶é‡è¦éƒ¨åˆ†ï¼š

<table data-header-hidden><thead><tr><th width="320"></th><th></th></tr></thead><tbody><tr><td><strong>ç»„</strong></td><td><strong>åŠŸèƒ½</strong></td></tr><tr><td><strong><code>grp-gcp-organization-admins</code></strong><br><em>(æ¸…å•æ‰€éœ€çš„ç»„æˆ–ä¸ªäººè´¦æˆ·)</em></td><td>ç®¡ç†å±äºç»„ç»‡çš„ä»»ä½•èµ„æºã€‚è°¨æ…åˆ†é…æ­¤è§’è‰²ï¼›ç»„ç»‡ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‚¨çš„æ‰€æœ‰ Google Cloud èµ„æºã€‚æˆ–è€…ï¼Œç”±äºè¿™ä¸ªåŠŸèƒ½æƒé™å¾ˆé«˜ï¼Œè€ƒè™‘ä½¿ç”¨ä¸ªäººè´¦æˆ·è€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªç»„ã€‚</td></tr><tr><td><strong><code>grp-gcp-network-admins</code></strong><br><em>(æ¸…å•æ‰€éœ€)</em></td><td>åˆ›å»ºç½‘ç»œã€å­ç½‘ã€é˜²ç«å¢™è§„åˆ™å’Œç½‘ç»œè®¾å¤‡ï¼Œå¦‚ Cloud Routerã€Cloud VPN å’Œäº‘è´Ÿè½½å‡è¡¡å™¨ã€‚</td></tr><tr><td><strong><code>grp-gcp-billing-admins</code></strong><br><em>(æ¸…å•æ‰€éœ€)</em></td><td>è®¾ç½®è®¡è´¹è´¦æˆ·å¹¶ç›‘æ§å…¶ä½¿ç”¨æƒ…å†µã€‚</td></tr><tr><td><strong><code>grp-gcp-developers</code></strong><br><em>(æ¸…å•æ‰€éœ€)</em></td><td>è®¾è®¡ã€ç¼–ç å’Œæµ‹è¯•åº”ç”¨ç¨‹åºã€‚</td></tr><tr><td><strong><code>grp-gcp-security-admins</code></strong></br></td><td>ä¸ºæ•´ä¸ªç»„ç»‡å»ºç«‹å’Œç®¡ç†å®‰å…¨ç­–ç•¥ï¼ŒåŒ…æ‹¬è®¿é—®ç®¡ç†å’Œ<a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints">ç»„ç»‡çº¦æŸç­–ç•¥</a>ã€‚æœ‰å…³è§„åˆ’ Google Cloud å®‰å…¨åŸºç¡€è®¾æ–½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://cloud.google.com/architecture/security-foundations/authentication-authorization#users_and_groups">Google Cloud å®‰å…¨åŸºç¡€æŒ‡å—</a>ã€‚</td></tr><tr><td><strong><code>grp-gcp-devops</code></strong></td><td>åˆ›å»ºæˆ–ç®¡ç†æ”¯æŒæŒç»­é›†æˆå’Œäº¤ä»˜ã€ç›‘æ§å’Œç³»ç»Ÿé…ç½®çš„ç«¯åˆ°ç«¯ç®¡é“ã€‚</td></tr><tr><td><strong><code>grp-gcp-billing-viewer</code></strong></td><td>ç›‘æ§é¡¹ç›®æ”¯å‡ºã€‚å…¸å‹æˆå‘˜æ˜¯è´¢åŠ¡å›¢é˜Ÿçš„ä¸€éƒ¨åˆ†ã€‚</td></tr><tr><td><strong><code>grp-gcp-platform-viewer</code></strong></td><td>å®¡æŸ¥æ•´ä¸ª Google Cloud ç»„ç»‡çš„èµ„æºä¿¡æ¯ã€‚</td></tr><tr><td><strong><code>grp-gcp-security-reviewer</code></strong></td><td>å®¡æŸ¥äº‘å®‰å…¨ã€‚</td></tr><tr><td><strong><code>grp-gcp-network-viewer</code></strong></td><td>å®¡æŸ¥ç½‘ç»œé…ç½®ã€‚</td></tr><tr><td><strong><code>grp-gcp-audit-viewer</code></strong></td><td>æŸ¥çœ‹å®¡è®¡æ—¥å¿—ã€‚</td></tr><tr><td><strong><code>grp-gcp-scc-admin</code></strong></td><td>ç®¡ç†å®‰å…¨å‘½ä»¤ä¸­å¿ƒã€‚</td></tr><tr><td><strong><code>grp-gcp-secrets-admin</code></strong></td><td>åœ¨ç§˜å¯†ç®¡ç†å™¨ä¸­ç®¡ç†ç§˜å¯†ã€‚</td></tr></tbody></table>

## **é»˜è®¤å¯†ç ç­–ç•¥**

<figure><img src="../../.gitbook/assets/image (1) (9).png" alt=""><figcaption></figcaption></figure>

## **æœåŠ¡è´¦æˆ·**

è¿™äº›æ˜¯**èµ„æº**å¯ä»¥**é™„åŠ **å¹¶è½»æ¾ä¸ GCP äº¤äº’çš„ä¸»ä½“ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨å…ƒæ•°æ®ä¸­è®¿é—®**é™„åŠ åˆ° VM çš„æœåŠ¡è´¦æˆ·çš„è®¤è¯ä»¤ç‰Œ**ã€‚\
åœ¨ä½¿ç”¨**IAM å’Œè®¿é—®èŒƒå›´**æ—¶å¯èƒ½ä¼šé‡åˆ°ä¸€äº›**å†²çª**ã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„æœåŠ¡è´¦æˆ·å¯èƒ½å…·æœ‰ `compute.instanceAdmin` çš„ IAM è§’è‰²ï¼Œä½†æ‚¨å·²ä¾µå…¥çš„å®ä¾‹è¢«é™åˆ¶èŒƒå›´ä¸º `https://www.googleapis.com/auth/compute.readonly`ã€‚è¿™å°†é˜»æ­¢æ‚¨ä½¿ç”¨è‡ªåŠ¨åˆ†é…ç»™å®ä¾‹çš„ OAuth ä»¤ç‰Œè¿›è¡Œä»»ä½•æ›´æ”¹ã€‚

å®ƒç±»ä¼¼äº**AWS ä¸­çš„ IAM è§’è‰²**ã€‚ä½†ä¸åƒ AWSï¼Œ**ä»»ä½•**æœåŠ¡è´¦æˆ·éƒ½å¯ä»¥**é™„åŠ åˆ°ä»»ä½•æœåŠ¡**ï¼ˆå®ƒä¸éœ€è¦é€šè¿‡ç­–ç•¥å…è®¸ï¼‰ã€‚

æ‚¨å°†å‘ç°çš„å‡ ä¸ªæœåŠ¡è´¦æˆ·å®é™…ä¸Šæ˜¯**GCP åœ¨æ‚¨å¼€å§‹ä½¿ç”¨æœåŠ¡æ—¶è‡ªåŠ¨ç”Ÿæˆçš„**ï¼š
```
PROJECT_NUMBER-compute@developer.gserviceaccount.com
PROJECT_ID@appspot.gserviceaccount.com
```
ç„¶è€Œï¼Œä¹Ÿå¯ä»¥åˆ›å»ºå¹¶é™„åŠ åˆ°èµ„æº**è‡ªå®šä¹‰æœåŠ¡è´¦æˆ·**ï¼Œå…¶æ ¼å¼å¦‚ä¸‹ï¼š
```
SERVICE_ACCOUNT_NAME@PROJECT_NAME.iam.gserviceaccount.com
```
### **è®¿é—®èŒƒå›´**

è®¿é—®èŒƒå›´æ˜¯**é™„åŠ åˆ°ç”Ÿæˆçš„OAuthä»¤ç‰Œä¸Š**ä»¥è®¿é—®GCP APIç«¯ç‚¹çš„ã€‚å®ƒä»¬**é™åˆ¶äº†OAuthä»¤ç‰Œçš„æƒé™**ã€‚\
è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªä»¤ç‰Œå±äºæŸä¸ªèµ„æºçš„æ‰€æœ‰è€…ï¼Œä½†åœ¨ä»¤ç‰ŒèŒƒå›´å†…æ²¡æœ‰è®¿é—®è¯¥èµ„æºçš„æƒé™ï¼Œé‚£ä¹ˆè¯¥ä»¤ç‰Œ**ä¸èƒ½ç”¨æ¥ï¼ˆæ»¥ç”¨ï¼‰è¿™äº›æƒé™**ã€‚

Googleå®é™…ä¸Š[å»ºè®®](https://cloud.google.com/compute/docs/access/service-accounts#service\_account\_permissions)ä¸ä½¿ç”¨è®¿é—®èŒƒå›´ï¼Œè€Œæ˜¯å®Œå…¨ä¾èµ–IAMã€‚ç½‘ç»œç®¡ç†é—¨æˆ·å®é™…ä¸Šå¼ºåˆ¶æ‰§è¡Œäº†è¿™ä¸€ç‚¹ï¼Œä½†ä»ç„¶å¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼ä½¿ç”¨è‡ªå®šä¹‰æœåŠ¡è´¦æˆ·å°†è®¿é—®èŒƒå›´åº”ç”¨äºå®ä¾‹ã€‚

æ‚¨å¯ä»¥é€šè¿‡**æŸ¥è¯¢**æ¥æŸ¥çœ‹åˆ†é…çš„**èŒƒå›´**ï¼š

{% code overflow="wrap" %}
```bash
curl 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=<access_token>'

{
"issued_to": "223044615559.apps.googleusercontent.com",
"audience": "223044615559.apps.googleusercontent.com",
"user_id": "139746512919298469201",
"scope": "openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/appengine.admin https://www.googleapis.com/auth/sqlservice.login https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/accounts.reauth",
"expires_in": 2253,
"email": "username@testing.com",
"verified_email": true,
"access_type": "offline"
}
```
{% endcode %}

å‰è¿°çš„**èŒƒå›´**æ˜¯ä½¿ç”¨**`gcloud`**è®¿é—®æ•°æ®æ—¶é»˜è®¤ç”Ÿæˆçš„ã€‚è¿™æ˜¯å› ä¸ºå½“ä½ ä½¿ç”¨**`gcloud`**æ—¶ï¼Œä½ é¦–å…ˆåˆ›å»ºä¸€ä¸ªOAuthä»¤ç‰Œï¼Œç„¶åä½¿ç”¨å®ƒæ¥è”ç³»ç«¯ç‚¹ã€‚

å…¶ä¸­æœ€é‡è¦çš„èŒƒå›´å¯èƒ½æ˜¯**`cloud-platform`**ï¼Œè¿™åŸºæœ¬ä¸Šæ„å‘³ç€å¯ä»¥**è®¿é—®GCPä¸­çš„ä»»ä½•æœåŠ¡**ã€‚

ä½ å¯ä»¥åœ¨[**è¿™é‡Œæ‰¾åˆ°æ‰€æœ‰å¯èƒ½çš„èŒƒå›´çš„åˆ—è¡¨**](https://developers.google.com/identity/protocols/googlescopes)**ã€‚**

å¦‚æœä½ æœ‰**`gcloud`**æµè§ˆå™¨å‡­è¯ï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œç±»ä¼¼ä»¥ä¸‹æ“ä½œæ¥**è·å–å…·æœ‰å…¶ä»–èŒƒå›´çš„ä»¤ç‰Œ**ï¼š

{% code overflow="wrap" %}
```bash
# Maybe you can get a user token with other scopes changing the scopes array from ~/.config/gcloud/credentials.db

# Set new scopes for SDKs credentials
gcloud auth application-default login --scopes=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/sqlservice.login,https://www.googleapis.com/auth/appengine.admin,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/accounts.reauth,https://www.googleapis.com/auth/admin.directory.user,https://www.googleapis.com/auth/admin.directory.group,https://www.googleapis.com/auth/admin.directory.domain

# Print new token
gcloud auth application-default print-access-token

# To use this token with some API you might need to use curl to indicate the project header with --header "X-Goog-User-Project: <project-name>"
```
```markdown
## **Terraform IAM ç­–ç•¥ã€ç»‘å®šå’Œæˆå‘˜èµ„æ ¼**

æ ¹æ® terraform åœ¨ [https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam) ä¸­çš„å®šä¹‰ï¼Œä½¿ç”¨ terraform ä¸ GCP æ—¶ï¼Œæœ‰ä¸åŒçš„æ–¹å¼æˆäºˆä¸»ä½“å¯¹èµ„æºçš„è®¿é—®æƒé™ï¼š

* **æˆå‘˜èµ„æ ¼**ï¼šæ‚¨å¯ä»¥**å°†ä¸»ä½“è®¾ç½®ä¸ºè§’è‰²çš„æˆå‘˜ï¼Œå¯¹è§’è‰²æˆ–ä¸»ä½“**æ²¡æœ‰é™åˆ¶ã€‚æ‚¨å¯ä»¥å°†ç”¨æˆ·è®¾ç½®ä¸ºè§’è‰²çš„æˆå‘˜ï¼Œç„¶åå°†ä¸€ä¸ªç»„è®¾ç½®ä¸ºåŒä¸€è§’è‰²çš„æˆå‘˜ï¼Œä¹Ÿå¯ä»¥å°†è¿™äº›ä¸»ä½“ï¼ˆç”¨æˆ·å’Œç»„ï¼‰è®¾ç½®ä¸ºå…¶ä»–è§’è‰²çš„æˆå‘˜ã€‚
* **ç»‘å®š**ï¼šå¯ä»¥å°†å¤šä¸ª**ä¸»ä½“ç»‘å®šåˆ°ä¸€ä¸ªè§’è‰²**ã€‚è¿™äº›**ä¸»ä½“ä»ç„¶å¯ä»¥ç»‘å®šæˆ–æˆä¸ºå…¶ä»–è§’è‰²çš„æˆå‘˜**ã€‚ç„¶è€Œï¼Œå¦‚æœä¸€ä¸ªæœªç»‘å®šåˆ°è§’è‰²çš„ä¸»ä½“è¢«è®¾ç½®ä¸º**ç»‘å®šè§’è‰²çš„æˆå‘˜**ï¼Œä¸‹æ¬¡**åº”ç”¨ç»‘å®šæ—¶ï¼Œæˆå‘˜èµ„æ ¼å°†æ¶ˆå¤±**ã€‚
* **ç­–ç•¥**ï¼šç­–ç•¥æ˜¯**æƒå¨æ€§çš„**ï¼Œå®ƒæŒ‡å®šè§’è‰²å’Œä¸»ä½“ï¼Œç„¶åï¼Œ**è¿™äº›ä¸»ä½“ä¸èƒ½æœ‰æ›´å¤šçš„è§’è‰²ï¼Œè¿™äº›è§’è‰²ä¸èƒ½æœ‰æ›´å¤šçš„ä¸»ä½“**ï¼Œé™¤éä¿®æ”¹äº†è¯¥ç­–ç•¥ï¼ˆå³ä½¿åœ¨å…¶ä»–ç­–ç•¥ã€ç»‘å®šæˆ–æˆå‘˜èµ„æ ¼ä¸­ä¹Ÿä¸è¡Œï¼‰ã€‚å› æ­¤ï¼Œå½“åœ¨ç­–ç•¥ä¸­æŒ‡å®šäº†è§’è‰²æˆ–ä¸»ä½“æ—¶ï¼Œå…¶æ‰€æœ‰æƒé™éƒ½**å—åˆ°è¯¥ç­–ç•¥çš„é™åˆ¶**ã€‚æ˜¾ç„¶ï¼Œå¦‚æœä¸»ä½“è¢«æˆäºˆä¿®æ”¹ç­–ç•¥æˆ–æƒé™æå‡æƒé™ï¼ˆå¦‚åˆ›å»ºæ–°ä¸»ä½“å¹¶ä¸ºå…¶ç»‘å®šæ–°è§’è‰²ï¼‰çš„é€‰é¡¹ï¼Œåˆ™å¯ä»¥ç»•è¿‡è¿™ä¸€é™åˆ¶ã€‚

## å‚è€ƒèµ„æ–™

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricks** ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
```
