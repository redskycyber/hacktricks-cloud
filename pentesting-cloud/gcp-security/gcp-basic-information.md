# GCP - Temel Bilgiler

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olacak ÅŸekilde AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## **Kaynak hiyerarÅŸisi**

Google Cloud, kavramsal olarak geleneksel bir dosya sistemininkinden benzer olan bir [Kaynak hiyerarÅŸisi](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy) kullanÄ±r. Bu, belirli politika ve izinler iÃ§in mantÄ±ksal bir ebeveyn/Ã§ocuk iÅŸ akÄ±ÅŸÄ± saÄŸlar.

YÃ¼ksek seviyede ÅŸu ÅŸekilde gÃ¶rÃ¼nÃ¼r:
```
Organization
--> Folders
--> Projects
--> Resources
```
## **Proje GÃ¶Ã§leri**

**Herhangi bir organizasyon olmadan bir projeyi bir organizasyona gÃ¶Ã§ etmek mÃ¼mkÃ¼ndÃ¼r**. Bu iÅŸlem iÃ§in `roles/resourcemanager.projectCreator` ve `roles/resourcemanager.projectMover` izinlerine sahip olmak gerekmektedir. EÄŸer proje baÅŸka bir organizasyonun iÃ§indeyse, Ã¶nce onlarÄ± organizasyondan Ã§Ä±karmak iÃ§in GCP desteÄŸi ile iletiÅŸime geÃ§mek gerekmektedir. Daha fazla bilgi iÃ§in [**buraya**](https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6) bakabilirsiniz.

## **Organizasyon PolitikalarÄ±**

Organizasyonunuzun bulut kaynaklarÄ± Ã¼zerinde merkezi kontrol saÄŸlamasÄ±na izin verir:

* Organizasyonunuzun kaynaklarÄ±nÄ±n nasÄ±l kullanÄ±labileceÄŸi Ã¼zerinde **kÄ±sÄ±tlamalarÄ± yapÄ±landÄ±rmak** iÃ§in merkezi kontrol saÄŸlar.
* GeliÅŸtirme ekiplerinin uyumluluk sÄ±nÄ±rlarÄ± iÃ§inde kalmasÄ±nÄ± saÄŸlamak iÃ§in **sÄ±nÄ±rlar** tanÄ±mlar ve oluÅŸturur.
* Proje sahiplerinin ve ekiplerinin uyumluluÄŸu bozmadan hÄ±zlÄ± bir ÅŸekilde ilerlemelerine yardÄ±mcÄ± olur.

Bu politikalar, **tÃ¼m organizasyonu, klasÃ¶r(ler)i veya proje(leri) etkileyebilir**. Hedeflenen kaynak hiyerarÅŸisi dÃ¼ÄŸÃ¼mÃ¼nÃ¼n **alt kÃ¼meleri organizasyon politikasÄ±nÄ± miras alÄ±r**.

Bir organizasyon politikasÄ±nÄ± **tanÄ±mlamak** iÃ§in, bir [**kÄ±sÄ±tlama**](https://cloud.google.com/resource-manager/docs/organization-policy/overview#constraints) seÃ§ersiniz, bu ya bir Google Cloud hizmetine ya da bir grup Google Cloud hizmetine karÅŸÄ± belirli bir kÄ±sÄ±tlama tÃ¼rÃ¼dÃ¼r. ArdÄ±ndan, bu kÄ±sÄ±tlamayÄ± **istediÄŸiniz kÄ±sÄ±tlamalarla yapÄ±landÄ±rÄ±rsÄ±nÄ±z**.

#### Ortak kullanÄ±m durumlarÄ± <a href="#common_use_cases" id="common_use_cases"></a>

* Alan adÄ±na gÃ¶re kaynak paylaÅŸÄ±mÄ±nÄ± sÄ±nÄ±rlama.
* Kimlik ve EriÅŸim YÃ¶netimi hizmet hesaplarÄ±nÄ±n kullanÄ±mÄ±nÄ± sÄ±nÄ±rlama.
* Yeni oluÅŸturulan kaynaklarÄ±n fiziksel konumunu kÄ±sÄ±tlama.
* Hizmet hesabÄ± oluÅŸturmayÄ± devre dÄ±ÅŸÄ± bÄ±rakma

### **VarsayÄ±lan Organizasyon PolitikalarÄ±**

<details>

<summary>Google'Ä±n GCP organizasyonunuzu kurarken varsayÄ±lan olarak ekleyeceÄŸi politikalar:</summary>

**EriÅŸim YÃ¶netimi PolitikalarÄ±**

* **Alan adÄ± kÄ±sÄ±tlÄ± kiÅŸiler:** Belirtilen alanlar dÄ±ÅŸÄ±ndaki Kritik KiÅŸilere kullanÄ±cÄ± eklenmesini engeller. Bu, yalnÄ±zca belirtilen alanlardaki yÃ¶netilen kullanÄ±cÄ± kimliklerinin platform bildirimleri almasÄ±na izin verir.
* **Alan adÄ± kÄ±sÄ±tlÄ± paylaÅŸÄ±m:** Belirtilen alanlar dÄ±ÅŸÄ±ndaki kullanÄ±cÄ±larÄ±n IAM politikalarÄ±na eklenmesini engeller. Bu, yalnÄ±zca belirtilen alanlardaki yÃ¶netilen kullanÄ±cÄ± kimliklerinin bu organizasyon iÃ§indeki kaynaklara eriÅŸmesine izin verir.
* **Genel eriÅŸim Ã¶nleme:** Cloud Storage kovalarÄ±nÄ±n genel eriÅŸime aÃ§Ä±k olmasÄ±nÄ± engeller. Bu, bir geliÅŸtiricinin Cloud Storage kovalarÄ±nÄ± kimliksiz internet eriÅŸimine sahip olacak ÅŸekilde yapÄ±landÄ±rmasÄ±nÄ± engeller.
* **DÃ¼zgÃ¼n kova dÃ¼zeyinde eriÅŸim:** Cloud Storage kovalarÄ±ndaki nesne dÃ¼zeyinde eriÅŸim kontrol listelerini (ACL'ler) engeller. Bu, IAM politikalarÄ±nÄ± Cloud Storage kovalarÄ±ndaki tÃ¼m nesnelere tutarlÄ± bir ÅŸekilde uygulayarak eriÅŸim yÃ¶netiminizi basitleÅŸtirir.
* **Ä°ÅŸletim sistemi giriÅŸini gerektir:** Yeni projelerde oluÅŸturulan VM'lerde OS GiriÅŸinin etkin olmasÄ±nÄ± saÄŸlar. Bu, IAM kullanarak Ã¶rneklerinize SSH eriÅŸimini yÃ¶netmenizi saÄŸlar ve ayrÄ±ca bireysel SSH anahtarlarÄ± oluÅŸturmanÄ±za ve yÃ¶netmenize gerek kalmaz.

**Hizmet hesaplarÄ± iÃ§in ek gÃ¼venlik politikalarÄ±**

* **Otomatik IAM izinlerini devre dÄ±ÅŸÄ± bÄ±rak**: VarsayÄ±lan App Engine ve Compute Engine hizmet hesaplarÄ±nÄ±n projede oluÅŸturulduÄŸunda EditÃ¶r IAM rolÃ¼nÃ¼ otomatik olarak almalarÄ±nÄ± engeller. Bu, hizmet hesaplarÄ±nÄ±n oluÅŸturulduÄŸunda aÅŸÄ±rÄ± derecede geniÅŸletilmiÅŸ IAM rollerini almamalarÄ±nÄ± saÄŸlar.
* **Hizmet hesabÄ± anahtar oluÅŸturmayÄ± devre dÄ±ÅŸÄ± bÄ±rak**: Genel hizmet hesabÄ± anahtarlarÄ±nÄ±n oluÅŸturulmasÄ±nÄ± engeller. Bu, kalÄ±cÄ± kimlik bilgilerinin aÃ§Ä±ÄŸa Ã§Ä±kma riskini azaltmaya yardÄ±mcÄ± olur.
* **Hizmet hesabÄ± anahtar yÃ¼kleme iÅŸlemini devre dÄ±ÅŸÄ± bÄ±rak**: Genel hizmet hesabÄ± anahtarlarÄ±nÄ±n yÃ¼klenmesini engeller. Bu, sÄ±zdÄ±rÄ±lan veya yeniden kullanÄ±lan anahtar materyallerinin riskini azaltmaya yardÄ±mcÄ± olur.

**GÃ¼venli VPC aÄŸÄ± yapÄ±landÄ±rma politikalarÄ±**

* **VM Ã¶rnekleri iÃ§in izin verilen harici IP'leri tanÄ±mla**: Genel IP'ye sahip Compute Ã¶rneklerinin oluÅŸturulmasÄ±nÄ± engeller, bu da onlarÄ± internet trafiÄŸine aÃ§Ä±k hale getirebilir.

<!---->

* **VM iÃ§ iÃ§e sanallaÅŸtÄ±rmayÄ± devre dÄ±ÅŸÄ± bÄ±rak**: Compute Engine VM'lerinde iÃ§ iÃ§e VM'lerin oluÅŸturulmasÄ±nÄ± engeller. Bu, izlenmeyen iÃ§ iÃ§e VM'lerin gÃ¼venlik riskini azaltÄ±r.

<!---->

* **VM seri baÄŸlantÄ±sÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rak:** Compute Engine VM'lerine seri baÄŸlantÄ± eriÅŸimini engeller. Bu, Compute Engine API'sÄ±nÄ± kullanarak sunucunun seri baÄŸlantÄ±sÄ±na giriÅŸi engeller.

<!---->

* **Cloud SQL Ã¶rneklerine yetkilendirilmiÅŸ aÄŸlarÄ± kÄ±sÄ±tla:** Genel veya iÃ§ aÄŸ olmayan aÄŸ aralÄ±klarÄ±nÄ±n Cloud SQL veritabanlarÄ±nÄ±za eriÅŸmesini engeller.

<!---->

* **IP Adresi TÃ¼rÃ¼ne GÃ¶re Protokol YÃ¶nlendirmeyi KÄ±sÄ±tla:** Harici IP adresleri iÃ§in VM protokol yÃ¶nlendirmesini engeller.

<!---->

* **Cloud SQL Ã¶rneklerinde Genel IP eriÅŸimini kÄ±sÄ±tla:** Genel IP'ye sahip Cloud SQL Ã¶rneklerinin oluÅŸturulmasÄ±nÄ± engeller, bu da onlarÄ± internet trafiÄŸine aÃ§Ä±k hale getirebilir.

<!---->

* **PaylaÅŸÄ±lan VPC proje lien kaldÄ±rmasÄ±nÄ± kÄ±sÄ±tla:** PaylaÅŸÄ±lan VPC ana bilgisayar projelerinin yanlÄ±ÅŸlÄ±kla silinmesini engeller.

<!---->

* **Yeni projeler iÃ§in iÃ§ DNS ayarÄ±nÄ± Zonal DNS Only olarak ayarla:** Hizmet kullanÄ±labilirliÄŸini azaltan eski bir DNS ayarÄ±nÄ±n kullanÄ±lmasÄ±nÄ± engeller.

<!---->

* **VarsayÄ±lan aÄŸ oluÅŸturmayÄ± atla:** VarsayÄ±lan VPC aÄŸÄ±nÄ±n ve ilgili kaynaklarÄ±n otomatik oluÅŸturulmasÄ±nÄ± engeller. Bu, aÅŸÄ±rÄ± derecede geniÅŸletilmiÅŸ varsayÄ±lan gÃ¼venlik duvarÄ± kurallarÄ±nÄ± Ã¶nler.

<!---->

* **VPC Harici IPv6 kullanÄ±mÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rak:** Harici IPv6 alt aÄŸlarÄ±nÄ±n oluÅŸturulmasÄ±nÄ± engeller, bu da yetkisiz internet eriÅŸimine aÃ§Ä±k hale gelebilir.

</details>

## **IAM Rolleri**

Bu, AWS'deki IAM politikalarÄ±na benzer ÅŸekilde **her rolÃ¼n bir dizi izni iÃ§erdiÄŸi** IAM politikalarÄ±dÄ±r.

Ancak AWS'den farklÄ± olarak, rollerin merkezi bir depo**su yoktur**. Bunun yerine, **kaynaklar X eriÅŸim rollerini Y prensiplere verir**, ve bir kaynaÄŸa kimin eriÅŸimi olduÄŸunu Ã¶ÄŸrenmenin tek yolu, o kaynaÄŸÄ±n Ã¼zerinde **`get-iam-policy` yÃ¶ntemini kullanmaktÄ±r**.\
Bu bir sorun olabilir Ã§Ã¼nkÃ¼ bu, bir prensibin hangi izinlere sahip olduÄŸunu Ã¶ÄŸrenmenin tek yolunun, izin verdiÄŸi prensipleri sormak olduÄŸu anlamÄ±na gelir ve bir kullanÄ±cÄ±nÄ±n tÃ¼m kaynaklardan izin almak iÃ§in izni olmayabilir.

IAM'de **Ã¼Ã§ tÃ¼r** rol vardÄ±r:

* **Temel/Ä°lkel roller**, IAM'in tanÄ±tÄ±lmasÄ±ndan Ã¶nce var olan **Sahip**, **EditÃ¶r** ve **GÃ¶rÃ¼ntÃ¼leyici** rollerini iÃ§erir.
* **Ã–nceden tanÄ±mlanmÄ±ÅŸ roller**, belirli bir hizmet iÃ§in ayrÄ±ntÄ±lÄ± eriÅŸim saÄŸlar ve Google Cloud tarafÄ±ndan yÃ¶netilir. BirÃ§ok Ã¶nceden tanÄ±mlanmÄ±ÅŸ rol vardÄ±r, **onlarÄ±n tÃ¼mÃ¼nÃ¼ ve sahip olduklarÄ± ayrÄ±calÄ±klarÄ±** [**buradan**](https://cloud.google.com/iam/docs/understanding-roles#predefined\_roles) gÃ¶rebilirsiniz.
* **Ã–zel roller**, kullanÄ±cÄ± tarafÄ±ndan belirtilen bir izin listesine gÃ¶re ayrÄ±ntÄ±lÄ± eriÅŸim saÄŸlar.

GCP'de binlerce izin bulunmaktadÄ±r. Bir rolÃ¼n bir izne sahip olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in [**buradan izni arayabilirsiniz**](https://cloud.google.com/iam/docs/permissions-reference) ve hangi rollerin ona sahip olduÄŸunu gÃ¶rebilirsiniz.

AyrÄ±ca, **her Ã¼rÃ¼n tarafÄ±ndan sunulan Ã¶nceden tanÄ±mlanmÄ±ÅŸ rolleri** [**buradan arayabilirsiniz**](https://cloud.google.com/iam/docs/understanding-roles#product\_specific\_documentation). BazÄ± **rollerin** kullanÄ±cÄ±lara **baÄŸlanamayacaÄŸÄ±nÄ± ve yalnÄ±zca Hizmet HesaplarÄ±na** baÄŸlanabileceÄŸini unutmayÄ±n Ã§Ã¼nkÃ¼ iÃ§erdikleri bazÄ± izinler.\
AyrÄ±ca, **izinlerin** yalnÄ±zca **ilgili hizmete baÄŸlandÄ±ÄŸÄ±nda** etkili olacaÄŸÄ±nÄ± unutmayÄ±n.

Veya bir **Ã¶zel rolÃ¼n** [**burada belirli bir izni kullanÄ±p kullanamayacaÄŸÄ±nÄ± kontrol edebilirsiniz**](https://cloud.google.com/iam/docs/custom-roles-permissions-support)**.**
## KullanÄ±cÄ±lar <a href="#default-credentials" id="default-credentials"></a>

**GCP konsolunda** **KullanÄ±cÄ±lar veya Gruplar** yÃ¶netimi yapÄ±lmaz, bu **Google Workspace**'de gerÃ§ekleÅŸtirilir. Ancak farklÄ± bir kimlik saÄŸlayÄ±cÄ±yÄ± Google Workspace'e senkronize edebilirsiniz.

Workspace'in **kullanÄ±cÄ±larÄ±na ve gruplarÄ±na** [**https://admin.google.com**](https://admin.google.com/) adresinden eriÅŸebilirsiniz.

**MFA**, Workspace kullanÄ±cÄ±larÄ±na **zorunlu** olabilir, ancak bir **saldÄ±rgan** MFA tarafÄ±ndan korunmayan GCP'ye eriÅŸmek iÃ§in bir belirteÃ§ kullanabilir (kullanÄ±cÄ± giriÅŸ yaparak yalnÄ±zca oluÅŸturduÄŸunda MFA tarafÄ±ndan korunur: `gcloud auth login`).

## Gruplar

Bir organizasyon oluÅŸturulduÄŸunda birkaÃ§ grubun **kesinlikle oluÅŸturulmasÄ± Ã¶nerilir**. Bunlardan herhangi birini yÃ¶netiyorsanÄ±z, tÃ¼m organizasyonu veya Ã¶nemli bir kÄ±smÄ±nÄ± tehlikeye atabilirsiniz:

<table data-header-hidden><thead><tr><th width="299.3076923076923"></th><th></th></tr></thead><tbody><tr><td><strong>Grup</strong></td><td><strong>Fonksiyon</strong></td></tr><tr><td><strong><code>gcp-organization-admins</code></strong><br><em>(kontrol listesi iÃ§in grup veya bireysel hesaplar gereklidir)</em></td><td>Organizasyona ait herhangi bir kaynaÄŸÄ± yÃ¶netmek. Bu rolÃ¼ dikkatlice atayÄ±n; org yÃ¶neticileri tÃ¼m Google Cloud kaynaklarÄ±na eriÅŸime sahiptir. Alternatif olarak, bu fonksiyon Ã§ok ayrÄ±calÄ±klÄ± olduÄŸundan, bir grup oluÅŸturmak yerine bireysel hesaplarÄ± kullanmayÄ± dÃ¼ÅŸÃ¼nebilirsiniz.</td></tr><tr><td><strong><code>gcp-network-admins</code></strong><br><em>(kontrol listesi iÃ§in gereklidir)</em></td><td>AÄŸlar, alt aÄŸlar, gÃ¼venlik duvarÄ± kurallarÄ± ve Cloud Router, Cloud VPN ve bulut yÃ¼k dengeleyicileri gibi aÄŸ cihazlarÄ± oluÅŸturma.</td></tr><tr><td><strong><code>gcp-billing-admins</code></strong><br><em>(kontrol listesi iÃ§in gereklidir)</em></td><td>FaturalandÄ±rma hesaplarÄ±nÄ± kurma ve kullanÄ±mlarÄ±nÄ± izleme.</td></tr><tr><td><strong><code>gcp-developers</code></strong><br><em>(kontrol listesi iÃ§in gereklidir)</em></td><td>UygulamalarÄ± tasarlama, kodlama ve test etme.</td></tr><tr><td><strong><code>gcp-security-admins</code></strong><br></td><td>Organizasyonun tamamÄ± iÃ§in gÃ¼venlik politikalarÄ±nÄ± oluÅŸturma ve yÃ¶netme, eriÅŸim yÃ¶netimi ve <a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints">organizasyon kÄ±sÄ±tlama politikalarÄ±</a> gibi. Google Cloud gÃ¼venlik altyapÄ±nÄ±zÄ± planlarken daha fazla bilgi iÃ§in <a href="https://cloud.google.com/architecture/security-foundations/authentication-authorization#users_and_groups">Google Cloud gÃ¼venlik temelleri kÄ±lavuzuna</a> bakÄ±n.</td></tr><tr><td><strong><code>gcp-devops</code></strong></td><td>SÃ¼rekli entegrasyon ve daÄŸÄ±tÄ±mÄ± destekleyen, izleme ve sistem saÄŸlama sÃ¼reÃ§lerini oluÅŸturma veya yÃ¶netme.</td></tr><tr><td><strong><code>gcp-logging-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-logging-viewers</code></strong></td><td></td></tr><tr><td><strong><code>gcp-monitor-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-billing-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan deÄŸil)</em></td><td>Projelerdeki harcamalarÄ± izleme. Tipik Ã¼yeler finans ekibinin bir parÃ§asÄ±dÄ±r.</td></tr><tr><td><strong><code>gcp-platform-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan deÄŸil)</em></td><td>Google Cloud organizasyonu genelinde kaynak bilgilerini inceleme.</td></tr><tr><td><strong><code>gcp-security-reviewer</code></strong><br><em>(artÄ±k varsayÄ±lan deÄŸil)</em></td><td>Bulut gÃ¼venliÄŸini inceleme.</td></tr><tr><td><strong><code>gcp-network-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan deÄŸil)</em></td><td>AÄŸ yapÄ±landÄ±rmalarÄ±nÄ± inceleme.</td></tr><tr><td><strong><code>grp-gcp-audit-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan deÄŸil)</em></td><td>Denetim gÃ¼nlÃ¼klerini gÃ¶rÃ¼ntÃ¼leme.</td></tr><tr><td><strong><code>gcp-scc-admin</code></strong><br><em>(artÄ±k varsayÄ±lan deÄŸil)</em></td><td>GÃ¼venlik Komut Merkezi'ni yÃ¶netme.</td></tr><tr><td><strong><code>gcp-secrets-admin</code></strong><br><em>(artÄ±k varsayÄ±lan deÄŸil)</em></td><td>Secret Manager'da sÄ±rlarÄ± yÃ¶netme.</td></tr></tbody></table>

## **VarsayÄ±lan Åifre PolitikasÄ±**

* GÃ¼Ã§lÃ¼ ÅŸifreleri zorunlu kÄ±lma
* 8 ile 100 karakter arasÄ±
* Tekrar kullanÄ±mÄ± yok
* SÃ¼resizlik yok
* Ä°nsanlar Ã¼Ã§Ã¼ncÃ¼ taraf saÄŸlayÄ±cÄ± aracÄ±lÄ±ÄŸÄ±yla Workspace'e eriÅŸiyorsa, bu gereksinimler uygulanmaz.

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## **Hizmet hesaplarÄ±**

Bunlar, **kaynaklarÄ±n** **baÄŸlÄ± olabileceÄŸi** ve GCP ile kolayca etkileÅŸimde bulunabileceÄŸi temel kimliklerdir. Ã–rneÄŸin, bir Hizmet HesabÄ±nÄ±n **VM'ye baÄŸlÄ±** kimlik belirteÃ§lerine eriÅŸmek mÃ¼mkÃ¼ndÃ¼r.\
IAM ve eriÅŸim kapsamlarÄ±nÄ± birlikte kullanÄ±rken bazÄ± **Ã§akÄ±ÅŸmalarla** karÅŸÄ±laÅŸabilirsiniz. Ã–rneÄŸin, hizmet hesabÄ±nÄ±zÄ±n `compute.instanceAdmin` IAM rolÃ¼ne sahip olabilir ancak ele geÃ§irdiÄŸiniz Ã¶rneÄŸin `https://www.googleapis.com/auth/compute.readonly` kapsam kÄ±sÄ±tlamasÄ± ile kÄ±sÄ±tlanmÄ±ÅŸ olabilir. Bu durum, otomatik olarak Ã¶rneÄŸinize atanan OAuth belirteci kullanarak herhangi bir deÄŸiÅŸiklik yapmanÄ±zÄ± engeller.

Bu, **AWS'deki IAM rollerine** benzer. Ancak AWS'deki gibi, **herhangi bir** hizmet hesabÄ± **herhangi bir hizmete baÄŸlanabilir** (bunu bir politika aracÄ±lÄ±ÄŸÄ±yla izin vermesi gerekmez).

KarÅŸÄ±laÅŸacaÄŸÄ±nÄ±z hizmet hesaplarÄ±nÄ±n bir kÄ±smÄ± aslÄ±nda GCP'yi kullanmaya baÅŸladÄ±ÄŸÄ±nÄ±zda **otomatik olarak oluÅŸturulur**, Ã¶rneÄŸin:
```
PROJECT_NUMBER-compute@developer.gserviceaccount.com
PROJECT_ID@appspot.gserviceaccount.com
```
Ancak, kaynaklara **Ã¶zel hizmet hesaplarÄ±** oluÅŸturmak ve bunlara baÄŸlamak da mÃ¼mkÃ¼ndÃ¼r ve bu hesaplar ÅŸÃ¶yle gÃ¶rÃ¼necektir:
```
SERVICE_ACCOUNT_NAME@PROJECT_NAME.iam.gserviceaccount.com
```
### EriÅŸim kapsamlarÄ±

EriÅŸim kapsamlarÄ±, GCP API uÃ§ noktalarÄ±na eriÅŸmek iÃ§in oluÅŸturulan OAuth belgelerine **eklenir**. Bunlar OAuth belgesinin **izinlerini kÄ±sÄ±tlar**.\
Bu, bir belgenin bir kaynaÄŸÄ±n Sahibi olmasÄ±na raÄŸmen, belgede o kaynaÄŸa eriÅŸim kapsamÄ± olmadÄ±ÄŸÄ± takdirde, belge **o ayrÄ±calÄ±klarÄ± (kÃ¶tÃ¼ye) kullanmak iÃ§in kullanÄ±lamaz**.

Google aslÄ±nda [Ã¶neriyor](https://cloud.google.com/compute/docs/access/service-accounts#service\_account\_permissions) ki **eriÅŸim kapsamlarÄ± kullanÄ±lmasÄ±n ve tamamen IAM'a gÃ¼venilsin**. Web yÃ¶netim portalÄ± aslÄ±nda bunu zorlar, ancak eriÅŸim kapsamlarÄ± hala Ã¶zel hizmet hesaplarÄ± kullanÄ±larak Ã¶rneklerde uygulanabilir.

**KapsamlarÄ±n** ne olduÄŸunu **sorgulayarak** gÃ¶rebilirsiniz:

{% code overflow="wrap" %}
```bash
curl 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=<access_token>'

{
"issued_to": "223044615559.apps.googleusercontent.com",
"audience": "223044615559.apps.googleusercontent.com",
"user_id": "139746512919298469201",
"scope": "openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/appengine.admin https://www.googleapis.com/auth/sqlservice.login https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/accounts.reauth",
"expires_in": 2253,
"email": "username@testing.com",
"verified_email": true,
"access_type": "offline"
}
```
{% endcode %}

Ã–nceki **kapsamlar** varsayÄ±lan olarak **`gcloud`** kullanÄ±larak veriye eriÅŸmek iÃ§in oluÅŸturulan kapsamlardÄ±r. Bu, **`gcloud`** kullandÄ±ÄŸÄ±nÄ±zda Ã¶nce bir OAuth belirteci oluÅŸturmanÄ±z ve ardÄ±ndan uÃ§ noktalara eriÅŸmek iÃ§in kullanmanÄ±z gerektiÄŸi anlamÄ±na gelir.

Bu kapsamlar arasÄ±ndaki en Ã¶nemli kapsam muhtemelen **`cloud-platform`**'dur, bu da temelde **GCP'deki herhangi bir hizmete eriÅŸimin mÃ¼mkÃ¼n olduÄŸu anlamÄ±na gelir**.

[**Burada tÃ¼m olasÄ± kapsamlarÄ±n bir listesini bulabilirsiniz**](https://developers.google.com/identity/protocols/googlescopes)**.**

EÄŸer **`gcloud`** tarayÄ±cÄ± kimlik bilgilerine sahipseniz, baÅŸka kapsamlara sahip bir belirteÃ§ **elde etmek mÃ¼mkÃ¼ndÃ¼r**, ÅŸÃ¶yle bir ÅŸey yaparak:
```bash
# Maybe you can get a user token with other scopes changing the scopes array from ~/.config/gcloud/credentials.db

# Set new scopes for SDKs credentials
gcloud auth application-default login --scopes=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/sqlservice.login,https://www.googleapis.com/auth/appengine.admin,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/accounts.reauth,https://www.googleapis.com/auth/admin.directory.user,https://www.googleapis.com/auth/admin.directory.group,https://www.googleapis.com/auth/admin.directory.domain,https://www.googleapis.com/auth/admin.directory.user

# Print new token
gcloud auth application-default print-access-token

# To use this token with some API you might need to use curl to indicate the project header with --header "X-Goog-User-Project: <project-name>"
```
## **Terraform IAM PolitikalarÄ±, BaÄŸlantÄ±lar ve Ãœyelikler**

Terraform tarafÄ±ndan [burada](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google_project_iam) tanÄ±mlandÄ±ÄŸÄ± gibi GCP ile terraform kullanarak bir ilkeye eriÅŸim saÄŸlamanÄ±n farklÄ± yollarÄ± vardÄ±r:

- **Ãœyelikler**: **Ä°lke veya prensipler Ã¼zerinde kÄ±sÄ±tlama olmadan prensipleri rollerin Ã¼yeleri olarak belirlersiniz**. Bir kullanÄ±cÄ±yÄ± bir rolÃ¼n Ã¼yesi olarak belirleyebilir ve ardÄ±ndan aynÄ± rolÃ¼n bir Ã¼yesi olarak bir grup belirleyebilir ve bu prensipleri (kullanÄ±cÄ± ve grup) diÄŸer rollerin Ã¼yeleri olarak da belirleyebilirsiniz.
- **BaÄŸlantÄ±lar**: Bir role **Ã§eÅŸitli prensipler baÄŸlanabilir**. Bu **prensipler hala baÄŸlanabilir veya diÄŸer rollerin Ã¼yeleri olabilir**. Ancak, bir role baÄŸlÄ± olmayan bir prensip, bir baÄŸlÄ± role Ã¼ye olarak belirlenirse, **baÄŸlantÄ± uygulandÄ±ÄŸÄ±nda Ã¼yelik kaybolur**.
- **Politikalar**: Bir politika **yetkilidir**, rolleri ve prensipleri belirtir ve sonra, **bu prensiplerin daha fazla rolÃ¼ olamaz ve bu rollerin daha fazla prensibi olamaz** (baÅŸka politikalarda, baÄŸlantÄ±larda veya Ã¼yeliklerde bile). DolayÄ±sÄ±yla, bir rol veya prensip politikada belirtildiÄŸinde, tÃ¼m ayrÄ±calÄ±klarÄ± **o politika tarafÄ±ndan sÄ±nÄ±rlanÄ±r**. AÃ§Ä±kÃ§a, prensibe politikayÄ± deÄŸiÅŸtirme veya ayrÄ±calÄ±k yÃ¼kseltme izni verildiÄŸinde (yeni bir prensip oluÅŸturup ona yeni bir rol baÄŸlama gibi), bu durum atlanabilir.

## Referanslar

- [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
- [https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)
