# GCP - Understanding Domain-Wide Delegation

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS korsanlÄ±ÄŸÄ±nÄ± Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u takip edin.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

Bu yazÄ±, daha fazla ayrÄ±ntÄ± iÃ§in [https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover](https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover) adresinden eriÅŸilebilen [https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover](https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover) adresinin tanÄ±tÄ±mÄ±dÄ±r.

## **Alan GeniÅŸ Yetkilendirme Anlama**

Google Workspace'in Alan GeniÅŸ Yetkilendirme Ã¶zelliÄŸi, bir **Google Workspace Marketplace dÄ±ÅŸÄ±ndaki uygulama** veya bir iÃ§ **GCP Hizmet HesabÄ±** tarafÄ±ndan, kullanÄ±cÄ±lar adÄ±na Workspace Ã¼zerindeki verilere **eriÅŸim saÄŸlamasÄ±na** olanak tanÄ±r. Bu Ã¶zellik, Google API'leriyle etkileÅŸimde bulunan uygulamalar veya kullanÄ±cÄ± taklitine ihtiyaÃ§ duyan hizmetler iÃ§in Ã¶nemlidir ve gÃ¶revleri otomatikleÅŸtirerek verimliliÄŸi artÄ±rÄ±r ve insan hatalarÄ±nÄ± en aza indirir. OAuth 2.0 kullanarak, uygulama geliÅŸtiricileri ve yÃ¶neticileri bu hizmet hesaplarÄ±na kullanÄ±cÄ± verilerine eriÅŸim izni verebilirler, bÃ¶ylece her bir kullanÄ±cÄ±nÄ±n ayrÄ± ayrÄ± onay vermesine gerek kalmaz.\
\
Google Workspace, iki ana tÃ¼rde genel yetkilendirilmiÅŸ nesne kimlikleri oluÅŸturmaya izin verir:

* **GWS UygulamalarÄ±:** Workspace Marketplace'den alÄ±nan uygulamalar, yetkilendirilmiÅŸ bir kimlik olarak yapÄ±landÄ±rÄ±labilir. Her Workspace uygulamasÄ±, potansiyel kÃ¶tÃ¼ye kullanÄ±mÄ± en aza indirmek iÃ§in Google tarafÄ±ndan incelenir. Bu, kÃ¶tÃ¼ye kullanÄ±m riskini tamamen ortadan kaldÄ±rmaz, ancak bÃ¶yle olaylarÄ±n gerÃ§ekleÅŸmesini Ã¶nemli Ã¶lÃ§Ã¼de zorlaÅŸtÄ±rÄ±r.
* **GCP Hizmet HesabÄ±:** [**GCP Hizmet HesaplarÄ± hakkÄ±nda daha fazla bilgi edinin**](../gcp-basic-information/#service-accounts).

### **Alan GeniÅŸ Yetkilendirme: Ä°Ã§ YapÄ±sÄ±**

Bir GCP Hizmet HesabÄ±'nÄ±n Google API'lerine Google Workspace iÃ§indeki diÄŸer kimlikler adÄ±na nasÄ±l eriÅŸebileceÄŸi aÅŸaÄŸÄ±daki gibi Ã§alÄ±ÅŸÄ±r:

<figure><img src="../../../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

1. **Kimlik JWT oluÅŸturur:** Kimlik, JWT'yi oluÅŸturmak iÃ§in hizmet hesabÄ±nÄ±n Ã¶zel anahtarÄ±nÄ± (JSON anahtar Ã§ifti dosyasÄ±nÄ±n bir parÃ§asÄ±) kullanÄ±r. Bu JWT, istenen REST API'sine eriÅŸim iÃ§in hizmet hesabÄ±, taklit edilecek hedef kullanÄ±cÄ± ve OAuth kapsamlarÄ± hakkÄ±nda talepler iÃ§erir.
2. **Kimlik, eriÅŸim belirteci talep etmek iÃ§in JWT'yi kullanÄ±r:** Uygulama/kullanÄ±cÄ±, JWT'yi Google'Ä±n OAuth 2.0 hizmetinden bir eriÅŸim belirteci talep etmek iÃ§in kullanÄ±r. Talep ayrÄ±ca taklit edilecek hedef kullanÄ±cÄ±yÄ± (kullanÄ±cÄ±nÄ±n Workspace e-postasÄ±) ve eriÅŸim istenen kapsamlarÄ± iÃ§erir.
3. **Google'Ä±n OAuth 2.0 hizmeti bir eriÅŸim belirteci dÃ¶ndÃ¼rÃ¼r:** EriÅŸim belirteci, hizmet hesabÄ±nÄ±n belirtilen kapsamlar iÃ§in kullanÄ±cÄ± adÄ±na hareket etme yetkisini temsil eder. Bu belirteÃ§ genellikle kÄ±sa Ã¶mÃ¼rlÃ¼dÃ¼r ve periyodik olarak yenilenmelidir (uygulamanÄ±n ihtiyacÄ±na gÃ¶re). JWT belirtecinde belirtilen OAuth kapsamlarÄ±nÄ±n geÃ§erliliÄŸi ve etkisi olduÄŸunu anlamak Ã¶nemlidir. Ã–rneÄŸin, birden fazla kapsama sahip eriÅŸim belirteÃ§leri, birÃ§ok REST API uygulamasÄ± iÃ§in geÃ§erlilik saÄŸlar.
4. **Kimlik, eriÅŸim belirteciyle Google API'lerini Ã§aÄŸÄ±rÄ±r**: Ä°lgili bir eriÅŸim belirteÄŸiyle hizmet, gereken REST API'ye eriÅŸebilir. Uygulama, bu eriÅŸim belirteÄŸini, Google API'leri iÃ§in HTTP isteklerinin "Authorization" baÅŸlÄ±ÄŸÄ±nda kullanÄ±r. Bu API'ler, taklit edilen kimliÄŸi doÄŸrulamak ve gerekli yetkilendirmeye sahip olduÄŸunu onaylamak iÃ§in belirteci kullanÄ±r.
5. **Google API'leri istenen verileri dÃ¶ndÃ¼rÃ¼r**: EriÅŸim belirteci geÃ§erli ise ve hizmet hesabÄ± uygun yetkilendirmeye sahipse, Google API'leri istenen verileri dÃ¶ndÃ¼rÃ¼r. Ã–rneÄŸin, aÅŸaÄŸÄ±daki resimde, hedef Workspace kullanÄ±cÄ±sÄ±yla iliÅŸkili tÃ¼m Gmail ileti kimliklerini listelemek iÃ§in _users.messages.list_ yÃ¶ntemini kullanmÄ±ÅŸÄ±zdÄ±r.

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS korsanlÄ±ÄŸÄ±nÄ± Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u takip edin.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
