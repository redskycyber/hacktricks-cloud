# GCP - IAM, ì£¼ì²´ ë° ì¡°ì§ ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±°

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ì„** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ PRì„** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ë°** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ì— ì œì¶œ**í•˜ì„¸ìš”.
*
*
* &#x20;github ì €ì¥ì†Œ.

</details>

## Iam & GCP ì£¼ì²´

ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### Workspaceì—ì„œ ë„ë©”ì¸ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆê¹Œ?

1. **DNS ë ˆì½”ë“œ í™•ì¸**

**`google-site-verification`** ë ˆì½”ë“œê°€ ìˆë‹¤ë©´ (ë˜ëŠ” ì‚¬ìš©í–ˆì„ ê°€ëŠ¥ì„±ì´ ìˆë‹¤ë©´) Workspaceë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.
```
dig txt hacktricks.xyz

[...]
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=2mWyPXMPXEEy6QqWbCfWkxFTcQhyYdwHrOxee1Yeo-0"
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=C19PtLcZ1EGyzUYYJTX1Tp6bOGessxzN9gqE-SVKhRA"
hacktricks.xyz.		300	IN	TXT	"v=spf1 include:usb._netblocks.mimecast.com include:_spf.google.com include:_spf.psm.knowbe4.com include:_spf.salesforce.com include:spf.mandrillapp.com ~all"
```
ë§Œì•½ **`include:_spf.google.com`**ê³¼ ê°™ì€ ê²ƒì´ ë‚˜íƒ€ë‚˜ë©´, ì´ê²ƒì„ í™•ì¸í•©ë‹ˆë‹¤ (ì°¸ê³ ë¡œ, ë‚˜íƒ€ë‚˜ì§€ ì•ŠëŠ”ë‹¤ë©´ gmailì„ ë©”ì¼ ì œê³µìë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê³ ë„ Workspaceì— ë„ë©”ì¸ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤).

2. í•´ë‹¹ ë„ë©”ì¸ìœ¼ë¡œ Workspaceë¥¼ ì„¤ì •í•´ ë³´ì„¸ìš”

ë‹¤ë¥¸ ì˜µì…˜ì€ í•´ë‹¹ ë„ë©”ì¸ì„ ì‚¬ìš©í•˜ì—¬ Workspaceë¥¼ ì„¤ì •í•´ ë³´ëŠ” ê²ƒì…ë‹ˆë‹¤. ë§Œì•½ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë„ë©”ì¸ì´ë¼ê³  **ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´** (ì´ë¯¸ì§€ì™€ ê°™ì´), ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

Workspace ë„ë©”ì¸ì„ ì„¤ì •í•´ ë³´ë ¤ë©´ ë‹¤ìŒì„ ë”°ë¥´ì„¸ìš”: [https://workspace.google.com/business/signup/welcome](https://workspace.google.com/business/signup/welcome)

<figure><img src="../../../.gitbook/assets/image (141).png" alt=""><figcaption></figcaption></figure>

3. í•´ë‹¹ ë„ë©”ì¸ì„ ì‚¬ìš©í•˜ëŠ” ì´ë©”ì¼ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³µêµ¬í•´ ë³´ì„¸ìš”

í•´ë‹¹ ë„ë©”ì¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì•Œê³  ìˆë‹¤ë©´ (ì˜ˆ: admin@email.com ë˜ëŠ” info@email.com), [https://accounts.google.com/signin/v2/recoveryidentifier](https://accounts.google.com/signin/v2/recoveryidentifier)ì—ì„œ ê³„ì •ì„ ë³µêµ¬í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šê³  Googleì´ í•´ë‹¹ ê³„ì •ì— ëŒ€í•´ ì•„ë¬´ëŸ° ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆì§€ ì•Šë‹¤ëŠ” ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚œë‹¤ë©´, í•´ë‹¹ ë„ë©”ì¸ì€ Workspaceë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.

### ì´ë©”ì¼ê³¼ ì„œë¹„ìŠ¤ ê³„ì • ì—´ê±°í•˜ê¸°

Workspace ë„ë©”ì¸ê³¼ SA(Servie Account) ì´ë©”ì¼ì˜ ìœ íš¨ì„±ì„ í™•ì¸í•˜ê¸° ìœ„í•´ ê¶Œí•œì„ í• ë‹¹í•˜ê³  ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ì„œëŠ” í”„ë¡œì íŠ¸ì— ê¶Œí•œì„ í• ë‹¹í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤ (ì´ í”„ë¡œì íŠ¸ëŠ” ë‹¨ì§€ ë‹¹ì‹ ì´ ì†Œìœ í•œ ê²ƒì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤).

ì°¸ê³ ë¡œ, ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ê¶Œí•œì„ ë¶€ì—¬í•˜ì§€ ì•Šê³  í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, **`user`**ì¸ ê²½ìš° **`serviceAccount`** ìœ í˜•ì„ ì‚¬ìš©í•˜ê³ , **`SA`**ì¸ ê²½ìš° **`user`** ìœ í˜•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
# Try to assign permissions to user 'unvalid-email-34r434f@hacktricks.xyz'
# but indicating it's a service account
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:unvalid-email-34r434f@hacktricks.xyz' \
--role='roles/viewer'
## Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User unvalid-email-34r434f@hacktricks.xyz does not exist.

# Now try with a valid email
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:support@hacktricks.xyz' \
--role='roles/viewer'
# Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal support@hacktricks.xyz is of type "user". The principal should appear as "user:support@hacktricks.xyz". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

ì‚¬ìš©ì ì´ë©”ì¼ì´ ìœ íš¨í•œ ê²½ìš° ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ì…ë ¥í•œ íƒ€ì…ì´ ì•„ë‹ˆë¼ê³  ë‚˜íƒ€ë‚˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ìš°ë¦¬ëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ì§€ ì•Šê³ ë„ ì´ë©”ì¼ support@hacktricks.xyzê°€ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

**ì„œë¹„ìŠ¤ ê³„ì •**ì— ëŒ€í•´ì„œë„ ë™ì¼í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë©°, **`serviceAccount:`** ëŒ€ì‹  **`user:`** ìœ í˜•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
# Non existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User <invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com does not exist.

# Existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal testing@digital-bonfire-410512.iam.gserviceaccount.com is of type "serviceAccount". The principal should appear as "serviceAccount:testing@digital-bonfire-410512.iam.gserviceaccount.com". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud**ì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.
*
*
* &#x20;github ì €ì¥ì†Œ.

</details>
