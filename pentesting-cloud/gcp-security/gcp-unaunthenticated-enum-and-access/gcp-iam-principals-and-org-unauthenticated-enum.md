# GCP - IAM, Principals & Org Yetkisiz Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizin **HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)'a **PR gÃ¶ndererek** paylaÅŸÄ±n
*
*
* &#x20;github depolarÄ±.

</details>

## Iam & GCP Principals&#x20;

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### Alan adÄ± Workspace'de kullanÄ±lÄ±yor mu?

1. **DNS kayÄ±tlarÄ±nÄ± kontrol edin**

EÄŸer **`google-site-verification`** kaydÄ± varsa, muhtemelen Workspace kullanÄ±lÄ±yor (veya kullanÄ±ldÄ±):
```
dig txt hacktricks.xyz

[...]
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=2mWyPXMPXEEy6QqWbCfWkxFTcQhyYdwHrOxee1Yeo-0"
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=C19PtLcZ1EGyzUYYJTX1Tp6bOGessxzN9gqE-SVKhRA"
hacktricks.xyz.		300	IN	TXT	"v=spf1 include:usb._netblocks.mimecast.com include:_spf.google.com include:_spf.psm.knowbe4.com include:_spf.salesforce.com include:spf.mandrillapp.com ~all"
```
EÄŸer **`include:_spf.google.com`** gibi bir ÅŸey varsa, bu doÄŸrular (unutmayÄ±n, gÃ¶rÃ¼nmÃ¼yorsa, bir alan adÄ± gmail'i posta saÄŸlayÄ±cÄ±sÄ± olarak kullanmadan Workspace iÃ§inde olabilir).

2. **Bu alan adÄ±yla bir Workspace kurmayÄ± deneyin**

BaÅŸka bir seÃ§enek, alan adÄ±nÄ± kullanarak bir Workspace kurmayÄ± denemektir, eÄŸer **alan adÄ±nÄ±n zaten kullanÄ±ldÄ±ÄŸÄ±ndan ÅŸikayet ederse** (resimde olduÄŸu gibi), zaten kullanÄ±ldÄ±ÄŸÄ±nÄ± biliyorsunuz demektir!

Bir Workspace alan adÄ± kurmayÄ± denemek iÃ§in ÅŸu adÄ±mlarÄ± izleyin: [https://workspace.google.com/business/signup/welcome](https://workspace.google.com/business/signup/welcome)

<figure><img src="../../../.gitbook/assets/image (141).png" alt=""><figcaption></figcaption></figure>

3. **Bu alan adÄ±nÄ± kullanan bir e-postanÄ±n ÅŸifresini kurtarmayÄ± deneyin**

EÄŸer bu alan adÄ±nda kullanÄ±lan geÃ§erli bir e-posta adresi biliyorsanÄ±z (Ã¶rneÄŸin: admin@email.com veya info@email.com), [https://accounts.google.com/signin/v2/recoveryidentifier](https://accounts.google.com/signin/v2/recoveryidentifier) adresinde hesabÄ± kurtarmayÄ± deneyebilirsiniz ve eÄŸer deneme, Google'Ä±n bu hesap hakkÄ±nda hiÃ§bir fikri olmadÄ±ÄŸÄ±nÄ± gÃ¶steren bir hata gÃ¶stermiyorsa, o zaman Workspace kullanÄ±lÄ±yor demektir.

### E-postalarÄ± ve hizmet hesaplarÄ±nÄ± sÄ±ralama

Bir Workspace alan adÄ±nÄ±n geÃ§erli e-postalarÄ±nÄ± ve hizmet hesaplarÄ±nÄ± sÄ±ralamak mÃ¼mkÃ¼ndÃ¼r, bunlarÄ± izin atayarak ve hata mesajlarÄ±nÄ± kontrol ederek deneyerek. Bunun iÃ§in bir projeye izin atama izninizin olmasÄ± yeterlidir (bu projenin size ait olmasÄ± da mÃ¼mkÃ¼ndÃ¼r).

OnlarÄ± kontrol etmek iÃ§in, var olup olmadÄ±klarÄ±nÄ± kontrol etmek iÃ§in **`serviceAccount`** tipini kullanabilirsiniz, ancak izin vermemek iÃ§in **`user`** tipini kullanabilirsiniz:

{% code overflow="wrap" %}
```bash
# Try to assign permissions to user 'unvalid-email-34r434f@hacktricks.xyz'
# but indicating it's a service account
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:unvalid-email-34r434f@hacktricks.xyz' \
--role='roles/viewer'
## Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User unvalid-email-34r434f@hacktricks.xyz does not exist.

# Now try with a valid email
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:support@hacktricks.xyz' \
--role='roles/viewer'
# Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal support@hacktricks.xyz is of type "user". The principal should appear as "user:support@hacktricks.xyz". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

KullanÄ±cÄ± e-postasÄ± geÃ§erli olduÄŸunda hata mesajÄ±, tipin geÃ§erli olmadÄ±ÄŸÄ±nÄ± belirtir, bu nedenle support@hacktricks.xyz e-postasÄ±nÄ±n herhangi bir yetki verilmeden var olduÄŸunu keÅŸfettik.

AynÄ±sÄ±nÄ± **Hizmet HesaplarÄ±** iÃ§in de yapabilirsiniz, ancak **`serviceAccount:`** yerine **`user:`** tipini kullanarak:

{% code overflow="wrap" %}
```bash
# Non existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User <invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com does not exist.

# Existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal testing@digital-bonfire-410512.iam.gserviceaccount.com is of type "serviceAccount". The principal should appear as "serviceAccount:testing@digital-bonfire-410512.iam.gserviceaccount.com". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

<details>

<summary><strong>AWS hackleme becerilerini sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) iÃ§in PR gÃ¶ndererek paylaÅŸÄ±n
*
*
* &#x20;github depolarÄ±.

</details>
