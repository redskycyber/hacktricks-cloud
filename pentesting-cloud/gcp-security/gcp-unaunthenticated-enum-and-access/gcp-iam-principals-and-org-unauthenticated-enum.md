# GCP - IAM, Podmioty i Org Unauthenticated Enum

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
*
*
* repozytoria github.

</details>

## Iam & GCP Podmioty&#x20;

Aby uzyskaÄ‡ wiÄ™cej informacji, sprawdÅº:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### Czy domena jest uÅ¼ywana w Workspace?

1. **SprawdÅº rekordy DNS**

JeÅ›li posiada rekord **`google-site-verification`**, prawdopodobne jest, Å¼e uÅ¼ywana jest (lub byÅ‚a) w Workspace:
```
dig txt hacktricks.xyz

[...]
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=2mWyPXMPXEEy6QqWbCfWkxFTcQhyYdwHrOxee1Yeo-0"
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=C19PtLcZ1EGyzUYYJTX1Tp6bOGessxzN9gqE-SVKhRA"
hacktricks.xyz.		300	IN	TXT	"v=spf1 include:usb._netblocks.mimecast.com include:_spf.google.com include:_spf.psm.knowbe4.com include:_spf.salesforce.com include:spf.mandrillapp.com ~all"
```
JeÅ›li pojawi siÄ™ coÅ› takiego jak **`include:_spf.google.com`**, potwierdza to (zauwaÅ¼, Å¼e jeÅ›li siÄ™ nie pojawi, nie oznacza to, Å¼e nie jest to domena Workspace, poniewaÅ¼ domena moÅ¼e byÄ‡ w Workspace, ale nie korzystaÄ‡ z Gmaila jako dostawcy poczty).

2. **SprÃ³buj skonfigurowaÄ‡ Workspace z tÄ… domenÄ…**

InnÄ… opcjÄ… jest sprÃ³bowanie skonfigurowania Workspace z uÅ¼yciem tej domeny. JeÅ›li pojawi siÄ™ komunikat, Å¼e domena jest juÅ¼ uÅ¼ywana (jak na obrazku), to oznacza, Å¼e jest juÅ¼ uÅ¼ywana!

Aby sprÃ³bowaÄ‡ skonfigurowaÄ‡ domenÄ™ Workspace, przejdÅº pod adres: [https://workspace.google.com/business/signup/welcome](https://workspace.google.com/business/signup/welcome)

<figure><img src="../../../.gitbook/assets/image (141).png" alt=""><figcaption></figcaption></figure>

3. **SprÃ³buj odzyskaÄ‡ hasÅ‚o do konta e-mail z uÅ¼yciem tej domeny**

JeÅ›li znasz jakikolwiek waÅ¼ny adres e-mail uÅ¼ywany w tej domenie (np. admin@email.com lub info@email.com), moÅ¼esz sprÃ³bowaÄ‡ **odzyskaÄ‡ konto** pod adresem [https://accounts.google.com/signin/v2/recoveryidentifier](https://accounts.google.com/signin/v2/recoveryidentifier), a jeÅ›li prÃ³ba nie wyÅ›wietla bÅ‚Ä™du wskazujÄ…cego, Å¼e Google nie ma pojÄ™cia o tym koncie, to oznacza, Å¼e jest uÅ¼ywany Workspace.

### Wyliczanie adresÃ³w e-mail i kont usÅ‚ugowych

MoÅ¼liwe jest **wyliczenie waÅ¼nych adresÃ³w e-mail domeny Workspace i adresÃ³w e-mail kont usÅ‚ugowych** poprzez prÃ³bÄ™ przypisania im uprawnieÅ„ i sprawdzanie komunikatÃ³w o bÅ‚Ä™dach. W tym celu wystarczy mieÄ‡ uprawnienia do przypisywania uprawnieÅ„ do projektu (ktÃ³ry moÅ¼e byÄ‡ wÅ‚asnoÅ›ciÄ… tylko Ciebie).

ZauwaÅ¼, Å¼e aby je sprawdziÄ‡, ale nawet jeÅ›li istniejÄ…, nie przyznawaj im uprawnieÅ„, moÅ¼esz uÅ¼yÄ‡ typu **`serviceAccount`** gdy jest to **`uÅ¼ytkownik`**, a **`uÅ¼ytkownik`** gdy jest to **`SA`**:

{% code overflow="wrap" %}
```bash
# Try to assign permissions to user 'unvalid-email-34r434f@hacktricks.xyz'
# but indicating it's a service account
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:unvalid-email-34r434f@hacktricks.xyz' \
--role='roles/viewer'
## Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User unvalid-email-34r434f@hacktricks.xyz does not exist.

# Now try with a valid email
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:support@hacktricks.xyz' \
--role='roles/viewer'
# Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal support@hacktricks.xyz is of type "user". The principal should appear as "user:support@hacktricks.xyz". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

ZauwaÅ¼, Å¼e gdy adres e-mail uÅ¼ytkownika byÅ‚ prawidÅ‚owy, komunikat o bÅ‚Ä™dzie wskazywaÅ‚, Å¼e typ nie jest prawidÅ‚owy, wiÄ™c udaÅ‚o nam siÄ™ odkryÄ‡, Å¼e adres e-mail support@hacktricks.xyz istnieje, nie przyznajÄ…c mu Å¼adnych uprawnieÅ„.

MoÅ¼esz to **samo zrobiÄ‡ z kontami usÅ‚ugowymi** uÅ¼ywajÄ…c typu **`user:`** zamiast **`serviceAccount:`**:

{% code overflow="wrap" %}
```bash
# Non existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User <invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com does not exist.

# Existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal testing@digital-bonfire-410512.iam.gserviceaccount.com is of type "serviceAccount". The principal should appear as "serviceAccount:testing@digital-bonfire-410512.iam.gserviceaccount.com". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
*
*
* repozytoria na GitHubie.

</details>
