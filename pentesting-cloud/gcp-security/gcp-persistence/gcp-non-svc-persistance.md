# GCP - Non-svc KalÄ±cÄ±lÄ±k

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

Bu, bir ÅŸekilde GCP kimlik bilgilerini veya GCP ortamÄ±nda Ã§alÄ±ÅŸan bir makineyi ele geÃ§irdiÄŸinizde kullanÄ±ÅŸlÄ± tekniklerdir.

## Token KaÃ§Ä±rma

### Kimlik DoÄŸrulama YapÄ±lmÄ±ÅŸ KullanÄ±cÄ±

Bir **GCP'de kimlik doÄŸrulamasÄ± yapÄ±lmÄ±ÅŸ bir kullanÄ±cÄ±nÄ±n** ev klasÃ¶rÃ¼ne eriÅŸmeyi baÅŸarÄ±rsanÄ±z, **varsayÄ±lan olarak**, kullanÄ±cÄ±nÄ±n token'larÄ±nÄ± **kimlik doÄŸrulamaya gerek duymadan ve kullanÄ±cÄ±nÄ±n token'larÄ±nÄ± kullandÄ±ÄŸÄ±nÄ±z makineden baÄŸÄ±msÄ±z olarak ve hatta kullanÄ±cÄ±nÄ±n MFA yapÄ±landÄ±rÄ±lmÄ±ÅŸ olsa bile** istediÄŸiniz sÃ¼rece alabilirsiniz.

Bu, varsayÄ±lan olarak **yeniden token oluÅŸturmak iÃ§in istediÄŸiniz sÃ¼re boyunca yenileme token'Ä±nÄ± kullanabileceÄŸiniz anlamÄ±na gelir**.

Bir kullanÄ±cÄ±nÄ±n **geÃ§erli token'Ä±nÄ±** almak iÃ§in ÅŸunu Ã§alÄ±ÅŸtÄ±rabilirsiniz:

{% code overflow="wrap" %}
```bash
sqlite3 ./.config/gcloud/access_tokens.db "select access_token from access_tokens where account_id='<email>';"
```
{% endcode %}

Bu sayfada, bu belirteci gcloud kullanarak nasÄ±l **doÄŸrudan kullanacaÄŸÄ±nÄ±zÄ±** kontrol edin:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#id-6440-1" %}

Yeni bir eriÅŸim belirteci **oluÅŸturmak iÃ§in ayrÄ±ntÄ±larÄ±** almak iÃ§in Ã§alÄ±ÅŸtÄ±rÄ±n:

{% code overflow="wrap" %}
```bash
sqlite3 ./.config/gcloud/credentials.db "select value from credentials where account_id='<email>';"
```
{% endcode %}

YenilenmiÅŸ bir eriÅŸim belirteci almak iÃ§in **yenileme belirteci**, istemci kimliÄŸi ve istemci sÄ±rrÄ±nÄ± kullanarak Ã§alÄ±ÅŸtÄ±rÄ±n:

{% code overflow="wrap" %}
```bash
curl -s --data client_id=<client_id> --data client_secret=<client_secret> --data grant_type=refresh_token --data refresh_token=<refresh_token> --data scope="https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/accounts.reauth" https://www.googleapis.com/oauth2/v4/token
```
{% endcode %}

Yenileme belgeleri, varsayÄ±lan olarak 16 saat olarak ayarlanmÄ±ÅŸ olsa da, **YÃ¶netici** > **GÃ¼venlik** > **Google Cloud oturum kontrolÃ¼** bÃ¶lÃ¼mÃ¼nde yÃ¶netilebilir ve hiÃ§bir zaman sÃ¼resi dolmamasÄ± iÃ§in ayarlanabilir:

<figure><img src="../../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

### Hizmet HesaplarÄ±

YetkilendirilmiÅŸ kullanÄ±cÄ±larla aynÄ± ÅŸekilde, bir hizmet hesabÄ±nÄ±n **Ã¶zel anahtar dosyasÄ±nÄ± ele geÃ§irirseniz**, genellikle **istediÄŸiniz sÃ¼rece eriÅŸebilirsiniz**.\
Ancak, bir hizmet hesabÄ±nÄ±n **OAuth belirteci**ni Ã§alarsanÄ±z, bu daha da ilginÃ§ olabilir, Ã§Ã¼nkÃ¼ varsayÄ±lan olarak bu belirteÃ§ler yalnÄ±zca bir saat iÃ§in kullanÄ±ÅŸlÄ± olsa da, **kurban Ã¶zel API anahtarÄ±nÄ± silse bile, OAuth belirteci sÃ¼resi dolana kadar geÃ§erli olacaktÄ±r**.

### Meta Veri

AÃ§Ä±kÃ§asÄ±, GCP ortamÄ±nda Ã§alÄ±ÅŸan bir makinede olduÄŸunuz sÃ¼rece, **metadata uÃ§ noktasÄ±na baÅŸvurarak o makineye baÄŸlÄ± hizmet hesabÄ±na eriÅŸebilirsiniz** (bu uÃ§ noktada eriÅŸebileceÄŸiniz OAuth belirteÃ§leri genellikle kapsamlarla sÄ±nÄ±rlÄ±dÄ±r).

### Ã‡Ã¶zÃ¼mler

Bu teknikler iÃ§in bazÄ± Ã§Ã¶zÃ¼mler [https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-2](https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-2) adresinde aÃ§Ä±klanmÄ±ÅŸtÄ±r.

## Referanslar

* [https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-1](https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-1)
* [https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-2](https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-2)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
