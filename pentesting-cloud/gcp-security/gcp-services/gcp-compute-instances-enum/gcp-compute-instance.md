# GCP - Instancje obliczeniowe

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

Instancje obliczeniowe Google Cloud to **dostosowywalne wirtualne maszyny na infrastrukturze chmurowej Google**, oferujÄ…ce skalowalnÄ… i elastycznÄ… moc obliczeniowÄ… dla szerokiego zakresu aplikacji. ZapewniajÄ… funkcje takie jak globalne wdroÅ¼enie, trwaÅ‚e przechowywanie, elastyczny wybÃ³r systemu operacyjnego oraz integracje z sieciÄ… i zabezpieczeniami, co czyni je wszechstronnym wyborem do hostowania witryn, przetwarzania danych i efektywnego uruchamiania aplikacji w chmurze.

### Poufne VM

Poufne VM wykorzystujÄ… **funkcje bezpieczeÅ„stwa oparte na sprzÄ™cie** oferowane przez najnowszÄ… generacjÄ™ procesorÃ³w AMD EPYC, ktÃ³re obejmujÄ… szyfrowanie pamiÄ™ci i bezpiecznÄ… wirtualizacjÄ™ zaszyfrowanÄ…. Te funkcje umoÅ¼liwiajÄ… VM ochronÄ™ przetwarzanych i przechowywanych w nim danych nawet przed systemem operacyjnym hosta i hipernadzorcÄ….

Aby uruchomiÄ‡ poufnÄ… VM, moÅ¼e byÄ‡ konieczne **zmienienie** takich rzeczy jak **typ** **maszyny**, **interfejs sieciowy**, **obraz dysku rozruchowego**.

### Dysk i szyfrowanie dysku

MoÅ¼liwe jest **wybranie dysku** do uÅ¼ycia lub **utworzenie nowego**. JeÅ›li wybierzesz nowy, moÅ¼esz:

* WybraÄ‡ **rozmiar** dysku
* WybraÄ‡ **system operacyjny**
* WskazaÄ‡, czy chcesz **usunÄ…Ä‡ dysk po usuniÄ™ciu instancji**
* **Szyfrowanie**: DomyÅ›lnie zostanie uÅ¼yty **zarzÄ…dzany przez Google klucz**, ale moÅ¼na rÃ³wnieÅ¼ **wybraÄ‡ klucz z KMS** lub wskazaÄ‡ **klucz do uÅ¼ycia**.

### WdroÅ¼enie kontenera

MoÅ¼liwe jest wdroÅ¼enie **kontenera** wewnÄ…trz wirtualnej maszyny.\
MoÅ¼na skonfigurowaÄ‡ **obraz**, ktÃ³ry ma byÄ‡ uÅ¼ywany, ustawiÄ‡ **polecenie** do uruchomienia wewnÄ…trz, **argumenty**, zamontowaÄ‡ **wolumin** i **zmienne Å›rodowiskowe** (informacje poufne?) oraz skonfigurowaÄ‡ wiele opcji dla tego kontenera, takich jak wykonanie jako **uprzywilejowany**, stdin i pseudo TTY.

### Konto usÅ‚ugi

DomyÅ›lnie bÄ™dzie uÅ¼ywane **domyÅ›lne konto usÅ‚ugi Compute Engine**. Adres e-mail tego konta usÅ‚ugi wyglÄ…da tak: `<proj-num>-compute@developer.gserviceaccount.com`\
To konto usÅ‚ugi ma **rolÄ™ Edytora w caÅ‚ym projekcie (wysokie uprawnienia).**

DomyÅ›lne zakresy dostÄ™pu to:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- DostÄ™p do odczytu do kubeÅ‚kÃ³w :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Jednak moÅ¼liwe jest **przyznanie mu uprawnieÅ„ `cloud-platform` jednym klikniÄ™ciem** lub okreÅ›lenie **niestandardowych uprawnieÅ„**.

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### Zapora sieciowa

MoÅ¼liwe jest zezwolenie na ruch HTTP i HTTPS.

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### Sieciowanie

* **Przekazywanie IP**: MoÅ¼liwe jest **wÅ‚Ä…czenie przekazywania IP** juÅ¼ podczas tworzenia instancji.
* **Nazwa hosta**: MoÅ¼liwe jest nadanie instancji staÅ‚ej nazwy hosta.
* **Interfejs**: MoÅ¼liwe jest dodanie interfejsu sieciowego.

### Dodatkowe zabezpieczenia

Te opcje **zwiÄ™kszÄ… bezpieczeÅ„stwo** VM i sÄ… zalecane:

* **Bezpieczne uruchamianie**: Bezpieczne uruchamianie pomaga chroniÄ‡ twoje instancje VM przed zÅ‚oÅ›liwym oprogramowaniem na poziomie rozruchu i jÄ…dra oraz rootkitami.
* **WÅ‚Ä…cz vTPM**: Wirtualny moduÅ‚ platformy zaufanej (vTPM) sprawdza integralnoÅ›Ä‡ rozruchu i uruchamiania goÅ›cia VM oraz oferuje generowanie i ochronÄ™ kluczy.
* **NadzÃ³r integralnoÅ›ci**: Monitorowanie integralnoÅ›ci umoÅ¼liwia monitorowanie i weryfikacjÄ™ integralnoÅ›ci rozruchu w czasie rzeczywistym twoich instancji VM zabezpieczonych za pomocÄ… raportÃ³w Stackdriver. Wymaga wÅ‚Ä…czonego vTPM.

### DostÄ™p do VM

NajczÄ™stszym sposobem umoÅ¼liwienia dostÄ™pu do VM jest **zezwolenie na dostÄ™p do VM za pomocÄ… okreÅ›lonych kluczy publicznych SSH**.\
Jednak moÅ¼liwe jest rÃ³wnieÅ¼ **wÅ‚Ä…czenie dostÄ™pu do VM za pomocÄ… usÅ‚ugi `os-config` przy uÅ¼yciu IAM**. Ponadto, moÅ¼liwe jest wÅ‚Ä…czenie uwierzytelniania dwuskÅ‚adnikowego (2FA) do dostÄ™pu do VM za pomocÄ… tej usÅ‚ugi.\
Gdy ta **usÅ‚uga** jest **wÅ‚Ä…czona**, dostÄ™p za pomocÄ… **kluczy SSH jest wyÅ‚Ä…czony**.

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### Metadane

MoÅ¼liwe jest zdefiniowanie **automatyzacji** (userdata w AWS), ktÃ³re sÄ… **poleceniami powÅ‚oki**, ktÃ³re bÄ™dÄ… wykonywane za kaÅ¼dym razem, gdy maszyna zostanie wÅ‚Ä…czona lub zrestartowana.

MoÅ¼liwe jest rÃ³wnieÅ¼ **dodanie dodatkowych metadanych klucz-wartoÅ›Ä‡**, ktÃ³re bÄ™dÄ… dostÄ™pne z punktu koÅ„cowego metadanych. Te informacje sÄ… czÄ™sto uÅ¼ywane do zmiennych Å›rodowiskowych i skryptÃ³w uruchamiania/zamykania. MoÅ¼na to uzyskaÄ‡ za pomocÄ… **metody `describe`** z polecenia w sekcji wyliczania, ale moÅ¼na je rÃ³wnieÅ¼ pobraÄ‡ z wnÄ™trza instancji, uzyskujÄ…c dostÄ™p do punktu koÅ„cowego metadanych.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Ponadto, **token autoryzacyjny dla przypisanego konta usÅ‚ugi** oraz **ogÃ³lne informacje** o instancji, sieci i projekcie bÄ™dÄ… dostÄ™pne z **punktu koÅ„cowego metadanych**. Aby uzyskaÄ‡ wiÄ™cej informacji, sprawdÅº:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Szyfrowanie

DomyÅ›lnie uÅ¼ywany jest zarzÄ…dzany przez Google klucz szyfrowania, ale moÅ¼na skonfigurowaÄ‡ klucz szyfrowania zarzÄ…dzany przez klienta (CMEK). MoÅ¼na rÃ³wnieÅ¼ skonfigurowaÄ‡, co zrobiÄ‡, gdy uÅ¼ywany klucz CMEF zostanie wycofany: Nic lub wyÅ‚Ä…czenie maszyny wirtualnej.

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
