# GCP - RaÄunarski instanci

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Google Cloud raÄunarske instance su **prilagodljive virtuelne maÅ¡ine na Google-ovoj cloud infrastrukturi**, koje pruÅ¾aju skalabilnu i na zahtev raÄunarsku snagu za Å¡irok spektar aplikacija. PruÅ¾aju moguÄ‡nosti kao Å¡to su globalno razmeÅ¡tanje, trajno skladiÅ¡tenje, fleksibilan izbor operativnih sistema, snaÅ¾ne integracije mreÅ¾e i sigurnosti, ÄineÄ‡i ih svestranim izborom za hostovanje veb sajtova, obradu podataka i efikasno pokretanje aplikacija u oblaku.

### Poverljiva VM

Poverljive VM koriste **bezbednosne funkcije zasnovane na hardveru** koje nude najnovije generacije AMD EPYC procesora, koje ukljuÄuju enkripciju memorije i sigurnu enkriptovanu virtualizaciju. Ove funkcije omoguÄ‡avaju VM-u da zaÅ¡titi podatke koji se obraÄ‘uju i skladiÅ¡te unutar njega Äak i od operativnog sistema domaÄ‡ina i hipervizora.

Za pokretanje Poverljive VM moÅ¾e biti potrebno **promeniti** stvari poput **tipa** maÅ¡ine, mreÅ¾nog **interfejsa**, **slike pokretnog diska**.

### Disk i enkripcija diska

MoguÄ‡e je **izabrati disk** koji Ä‡e se koristiti ili **napraviti novi**. Ako izaberete novi, moÅ¾ete:

* Izabrati **veliÄinu** diska
* Izabrati **OS**
* OznaÄiti da li Å¾elite **obrisati disk kada se instanca obriÅ¡e**
* **Enkripcija**: Podrazumevano Ä‡e se koristiti **Google upravljani kljuÄ**, ali moÅ¾ete takoÄ‘e **izabrati kljuÄ iz KMS-a** ili naznaÄiti **sirovi kljuÄ za koriÅ¡Ä‡enje**.

### Implementacija kontejnera

MoguÄ‡e je implementirati **kontejner** unutar virtuelne maÅ¡ine.\
MoguÄ‡e je konfigurisati **sliku** za koriÅ¡Ä‡enje, postaviti **komandu** za pokretanje unutar, **argumente**, montirati **volume**, i **env promenljive** (osetljive informacije?) i konfigurisati nekoliko opcija za ovaj kontejner kao izvrÅ¡avanje kao **privilegovani**, stdin i pseudo TTY.

### Servisni nalog

Podrazumevano Ä‡e se koristiti **Servisni nalog podrazumevane Compute Engine**. Email ovog SA je poput: `<proj-br>-compute@developer.gserviceaccount.com`\
Ovaj servisni nalog ima **UredniÄku ulogu nad celim projektom (visoki privilegije).**

I **podrazumevani pristupni opsezi** su sledeÄ‡i:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Pristup za Äitanje bucket-ova :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

MeÄ‘utim, moguÄ‡e je **dodeliti mu `cloud-platform` jednim klikom** ili specificirati **prilagoÄ‘ene**.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Firewall

MoguÄ‡e je dozvoliti HTTP i HTTPS saobraÄ‡aj.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### MreÅ¾a

* **ProsleÄ‘ivanje IP adrese**: MoguÄ‡e je **omoguÄ‡iti prosleÄ‘ivanje IP adrese** prilikom kreiranja instance.
* **Hostname**: MoguÄ‡e je dati instanci stalni hostname.
* **Interfejs**: MoguÄ‡e je dodati mreÅ¾ni interfejs

### Dodatna sigurnost

Ove opcije Ä‡e **poveÄ‡ati sigurnost** VM-a i preporuÄuju se:

* **Sigurno podizanje sistema:** Sigurno podizanje sistema pomaÅ¾e u zaÅ¡titi vaÅ¡ih VM instanci od malvera na nivou podizanja sistema i jezgra.
* **OmoguÄ‡avanje vTPM-a:** Virtuelni Trusted Platform Module (vTPM) validira pre-boot i boot integritet vaÅ¡eg gostujuÄ‡eg VM-a, i nudi generisanje i zaÅ¡titu kljuÄeva.
* **Nadgledanje integriteta:** Nadgledanje integriteta omoguÄ‡ava vam da pratite i verifikujete integritet pokretanja vaÅ¡ih zaÅ¡tiÄ‡enih VM instanci koristeÄ‡i izveÅ¡taje Stackdriver-a. Zahteva omoguÄ‡en vTPM.

### Pristup VM-u

UobiÄajeni naÄin omoguÄ‡avanja pristupa VM-u je putem **dozvoljavanja odreÄ‘enih SSH javnih kljuÄeva** za pristup VM-u.\
MeÄ‘utim, takoÄ‘e je moguÄ‡e **omoguÄ‡iti pristup VM-u putem `os-config` servisa koriÅ¡Ä‡enjem IAM-a**. Osim toga, moguÄ‡e je omoguÄ‡iti 2FA za pristup VM-u koriÅ¡Ä‡enjem ovog servisa.\
Kada je ovaj **servis** **omoguÄ‡en**, pristup putem **SSH kljuÄeva je onemoguÄ‡en.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metapodaci

MoguÄ‡e je definisati **automatizaciju** (userdata u AWS) koja su **shell komande** koje Ä‡e se izvrÅ¡iti svaki put kada se maÅ¡ina ukljuÄi ili restartuje.

TakoÄ‘e je moguÄ‡e **dodati dodatne metapodatke kljuÄ-vrednost** koji Ä‡e biti dostupni sa metapodataka endpointa. Ove informacije se obiÄno koriste za promenljive okruÅ¾enja i skripte za pokretanje/zaustavljanje. Ovo se moÅ¾e dobiti koriÅ¡Ä‡enjem **`describe` metode** iz komande u odeljku za enumeraciju, ali se takoÄ‘e moÅ¾e dobiti iznutra instance pristupajuÄ‡i metapodacima endpointa.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Pored toga, **auth token za povezani servisni nalog** i **opÅ¡te informacije** o instanci, mreÅ¾i i projektu takoÄ‘e Ä‡e biti dostupne sa **metadata endpointa**. Za viÅ¡e informacija pogledajte:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Enkripcija

Podrazumevani kljuÄ za enkripciju upravlja Google-om, ali se moÅ¾e konfigurisati i korisniÄki upravljani kljuÄ za enkripciju (CMEK). TakoÄ‘e moÅ¾ete konfigurisati Å¡ta treba uraditi kada se koriÅ¡Ä‡eni CMEK povuÄe: NiÅ¡ta ili iskljuÄiti virtuelnu maÅ¡inu.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
