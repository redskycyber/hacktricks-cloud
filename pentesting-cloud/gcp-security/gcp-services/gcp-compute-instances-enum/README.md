# GCP - Compute Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## GCP VPC ë° ë„¤íŠ¸ì›Œí‚¹

ì´ ì‘ì—… ë°©ì‹ì— ëŒ€í•´ ì•Œì•„ë³´ì„¸ìš”:

{% content-ref url="gcp-vpc-and-networking.md" %}
[gcp-vpc-and-networking.md](gcp-vpc-and-networking.md)
{% endcontent-ref %}

### ì—´ê±°

{% code overflow="wrap" %}
```bash
# List networks
gcloud compute networks list
gcloud compute networks describe <network>

# List subnetworks
gcloud compute networks subnets list
gcloud compute networks subnets get-iam-policy <name> --region <region>
gcloud compute networks subnets describe <name> --region <region>

# List FW rules in networks
gcloud compute firewall-rules list --format="table(
name,
network,
direction,
priority,
sourceRanges.list():label=SRC_RANGES,
destinationRanges.list():label=DEST_RANGES,
allowed[].map().firewall_rule().list():label=ALLOW,
denied[].map().firewall_rule().list():label=DENY,
sourceTags.list():label=SRC_TAGS,
sourceServiceAccounts.list():label=SRC_SVC_ACCT,
targetTags.list():label=TARGET_TAGS,
targetServiceAccounts.list():label=TARGET_SVC_ACCT,
disabled
)"

# List Hierarchical Firewalls
gcloud compute firewall-policies list  (--folder <value>| --organization <value>)
gcloud compute firewall-policies describe <fw_policy>
gcloud compute firewall-policies list-rules <fw_policy>

# Get Firewalls of each region
gcloud compute network-firewall-policies list
## Get final FWs applied in a region
gcloud compute network-firewall-policies get-effective-firewalls --network=<vpc_name> --region <region>
```
{% endcode %}

[https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum)ì—ì„œ ì—´ë¦° ë°©í™”ë²½ ê·œì¹™ì„ ê°€ì§„ ì»´í“¨íŒ… ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì»´í“¨íŒ… ì¸ìŠ¤í„´ìŠ¤

ì´ê²ƒì€ **GCP ë‚´ì—ì„œ ê°€ìƒ ë¨¸ì‹ ì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•**ì…ë‹ˆë‹¤. ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="gcp-compute-instance.md" %}
[gcp-compute-instance.md](gcp-compute-instance.md)
{% endcontent-ref %}

### ì—´ê±°
```bash
# Get list of zones
# It's interesting to know which zones are being used
gcloud compute regions list | grep -E "NAME|[^0]/"

# List compute instances & get info
gcloud compute instances list
gcloud compute instances describe <instance name>
gcloud compute instances get-iam-policy <instance> --zone=ZONE
gcloud compute instances get-screenshot <instance name> # Instace must have "Display Device" enabled
gcloud compute instances os-inventory list-instances # Get OS info of instances (OS Config agent is running on instances)


# Enumerate disks
gcloud compute disks list
gcloud compute disks describe <disk>
gcloud compute disks get-iam-policy <disk>
```
ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **SSH** ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ì˜ **ë©”íƒ€ë°ì´í„° ìˆ˜ì •**ì„ í†µí•´ **ê¶Œí•œ ìƒìŠ¹**ì„ ì–´ë–»ê²Œ í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

### ê¶Œí•œ ìƒìŠ¹

ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **ì»´í“¨íŠ¸ ê¶Œí•œì„ ë‚¨ìš©í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹**í•˜ëŠ” ë°©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../../gcp-privilege-escalation/gcp-compute-privesc/" %}
[gcp-compute-privesc](../../gcp-privilege-escalation/gcp-compute-privesc/)
{% endcontent-ref %}

### ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±°

{% content-ref url="../../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md" %}
[gcp-compute-unauthenticated-enum.md](../../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md)
{% endcontent-ref %}

### í›„ë°˜ ê³µê²©

{% content-ref url="../../../gcp-security/gcp-post-exploitation/gcp-compute-post-exploitation.md" %}
[gcp-compute-post-exploitation.md](../../../gcp-security/gcp-post-exploitation/gcp-compute-post-exploitation.md)
{% endcontent-ref %}

### ì§€ì†ì„±

{% content-ref url="../../../gcp-security/gcp-persistence/gcp-compute-persistence.md" %}
[gcp-compute-persistence.md](../../../gcp-security/gcp-persistence/gcp-compute-persistence.md)
{% endcontent-ref %}

## ì‹œë¦¬ì–¼ ì½˜ì†” ë¡œê·¸

Compute Engine ì‹œë¦¬ì–¼ ì½˜ì†” ë¡œê·¸ëŠ” ê°€ìƒ ë¨¸ì‹  ì¸ìŠ¤í„´ìŠ¤ì˜ ë¶€íŒ… ë° ìš´ì˜ ì²´ì œ ë¡œê·¸ë¥¼ **ë³´ê³  ì§„ë‹¨**í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

ì‹œë¦¬ì–¼ ì½˜ì†” ë¡œê·¸ëŠ” ì¸ìŠ¤í„´ìŠ¤ì˜ ë¶€íŒ… í”„ë¡œì„¸ìŠ¤ë¥¼ **ì €ìˆ˜ì¤€ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤**. ì´ëŠ” ë¶€íŒ… ë¬¸ì œì˜ ë””ë²„ê¹…, ì˜ëª»ëœ êµ¬ì„± ë˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ì˜¤ë¥˜ì˜ ì‹ë³„, ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œì˜ ë¬¸ì œ í•´ê²°ì— ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ë¡œê·¸ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì €ìˆ˜ì¤€ ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ì—†ëŠ” ì‹œìŠ¤í…œ ë¡œê·¸ì—ì„œ **ë¯¼ê°í•œ ì •ë³´ë¥¼ ë…¸ì¶œ**í•  ìˆ˜ ìˆì§€ë§Œ, ì ì ˆí•œ IAM ê¶Œí•œì„ ê°€ì§€ê³  ìˆë‹¤ë©´ ì´ë¥¼ ì½ì„ ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ [gcloud ëª…ë ¹](https://cloud.google.com/sdk/gcloud/reference/compute/instances/get-serial-port-output)ì„ ì‚¬ìš©í•˜ì—¬ ì‹œë¦¬ì–¼ í¬íŠ¸ ë¡œê·¸ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (`compute.instances.getSerialPortOutput` ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤):
```bash
gcloud compute instances get-serial-port-output <instance-name>
```
## OS êµ¬ì„± ê´€ë¦¬ì

OS êµ¬ì„± ê´€ë¦¬ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ VM ì¸ìŠ¤í„´ìŠ¤(VM)ì— ì¼ê´€ëœ êµ¬ì„±(ì›í•˜ëŠ” ìƒíƒœ ë° ì†Œí”„íŠ¸ì›¨ì–´)ë¥¼ ë°°í¬, ì¡°íšŒ ë° ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Compute Engineì—ì„œëŠ” VMì—ì„œ ì¼ê´€ëœ ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ [ê²ŒìŠ¤íŠ¸ ì •ì±…](https://cloud.google.com/compute/docs/os-config-management#guest-policy)ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

OS êµ¬ì„± ê´€ë¦¬ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ì„¤ì¹˜í•´ì•¼ í•  ì†Œí”„íŠ¸ì›¨ì–´ íŒ¨í‚¤ì§€, í™œì„±í™”í•´ì•¼ í•  ì„œë¹„ìŠ¤, VMì— ìˆì–´ì•¼ í•  íŒŒì¼ ë˜ëŠ” êµ¬ì„±ì„ ì§€ì •í•˜ëŠ” êµ¬ì„± ì •ì±…ì„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. VMì˜ ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì„±ì„ ì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ êµ¬ì„± ê´€ë¦¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ìë™í™”í•˜ê³  í™•ì¥í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤.

ë˜í•œ IAM ê¶Œí•œì„ í†µí•´ ì¸ìŠ¤í„´ìŠ¤ì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ **ê¶Œí•œ ìƒìŠ¹ ë° í”¼ë²—ì— ë§¤ìš° ìœ ìš©**í•©ë‹ˆë‹¤.

{% hint style="warning" %}
ì „ì²´ í”„ë¡œì íŠ¸ ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ì—ì„œ **os-configë¥¼ í™œì„±í™”**í•˜ë ¤ë©´ ì›í•˜ëŠ” ìˆ˜ì¤€ì—ì„œ **ë©”íƒ€ë°ì´í„°** í‚¤ **`enable-oslogin`**ì„ **`true`**ë¡œ ì„¤ì •í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.\
ë˜í•œ, 2faë¥¼ í™œì„±í™”í•˜ë ¤ë©´ ë©”íƒ€ë°ì´í„° **`enable-oslogin-2fa`**ë¥¼ **`true`**ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ë•Œ í™œì„±í™”í•˜ë©´ ë©”íƒ€ë°ì´í„° í‚¤ê°€ ìë™ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.
{% endhint %}

**OS-configì—ì„œì˜ 2faì— ëŒ€í•´ ë” ì•Œì•„ë³´ë©´**, **ì‚¬ìš©ìì¸ ê²½ìš°ì—ë§Œ ì ìš©**ë˜ë©°, ì»´í“¨íŠ¸ SAì™€ ê°™ì€ SAì¸ ê²½ìš° ì¶”ê°€ë¡œ ì•„ë¬´ê²ƒë„ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### ì—´ê±°
```bash
gcloud compute os-config patch-deployments list
gcloud compute os-config patch-deployments describe <patch-deployment>

gcloud compute os-config patch-jobs list
gcloud compute os-config patch-jobs describe <patch-job>
```
## ì´ë¯¸ì§€

### ì‚¬ìš©ì ì •ì˜ ì´ë¯¸ì§€

**ì‚¬ìš©ì ì •ì˜ ì»´í“¨íŒ… ì´ë¯¸ì§€ì—ëŠ” ë¯¼ê°í•œ ì„¸ë¶€ ì •ë³´**ë‚˜ ë‹¤ë¥¸ ì·¨ì•½í•œ êµ¬ì„±ì´ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

ì´ë¯¸ì§€ë¥¼ ìƒì„±í•  ë•ŒëŠ” **Google ê´€ë¦¬ í‚¤**(ê¸°ë³¸ê°’), **KMSì—ì„œ ê°€ì ¸ì˜¨ í‚¤**, ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì œê³µí•œ **ì›ì‹œ í‚¤** ì¤‘ì—ì„œ **3 ì¢…ë¥˜ì˜ ì•”í˜¸í™”**ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì—´ê±°

ë‹¤ìŒ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ì—ì„œ í‘œì¤€ì´ ì•„ë‹Œ ì´ë¯¸ì§€ ëª©ë¡ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
gcloud compute machine-images list
gcloud compute machine-images describe <name>
gcloud compute machine-images get-iam-policy <name>
```
{% endcode %}

ê·¸ëŸ° ë‹¤ìŒ [**ê°€ìƒ ë””ìŠ¤í¬**](https://cloud.google.com/sdk/gcloud/reference/compute/images/export)ë¥¼ ì—¬ëŸ¬ í˜•ì‹ìœ¼ë¡œ **ë‚´ë³´ë‚¼ ìˆ˜** ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì€ `test-image` ì´ë¯¸ì§€ë¥¼ qcow2 í˜•ì‹ìœ¼ë¡œ ë‚´ë³´ë‚´ì–´ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê³  ì¶”ê°€ ì¡°ì‚¬ë¥¼ ìœ„í•´ ë¡œì»¬ì—ì„œ VMì„ ë¹Œë“œí•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤:
```bash
gcloud compute images export --image test-image \
--export-format qcow2 --destination-uri [BUCKET]

# Execute container inside a docker
docker run --rm -ti gcr.io/<project-name>/secret:v1 sh
```
#### ê¶Œí•œ ìƒìŠ¹

Compute Instances ê¶Œí•œ ìƒìŠ¹ ì„¹ì…˜ì„ í™•ì¸í•˜ì„¸ìš”.

### ì‚¬ìš©ì ì •ì˜ ì¸ìŠ¤í„´ìŠ¤ í…œí”Œë¦¿

[**ì¸ìŠ¤í„´ìŠ¤ í…œí”Œë¦¿**](https://cloud.google.com/compute/docs/instance-templates/)ì€ ì¼ê´€ëœ êµ¬ì„±ì„ ë°°í¬í•˜ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” **ì¸ìŠ¤í„´ìŠ¤ ì†ì„±ì„ ì •ì˜**í•©ë‹ˆë‹¤. ì´ë“¤ì€ ì‹¤í–‰ ì¤‘ì¸ ì¸ìŠ¤í„´ìŠ¤ì˜ ì‚¬ìš©ì ì •ì˜ ë©”íƒ€ë°ì´í„°ì™€ ë™ì¼í•œ ìœ í˜•ì˜ ë¯¼ê°í•œ ë°ì´í„°ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ì¡°ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
# List the available templates
gcloud compute instance-templates list

# Get the details of a specific template
gcloud compute instance-templates describe [TEMPLATE NAME]
```
ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ìƒˆë¡œìš´ ë””ìŠ¤í¬ë¥¼ ì•Œì•„ë‚´ëŠ” ê²ƒì€ í¥ë¯¸ë¡œìš¸ ìˆ˜ ìˆì§€ë§Œ, ì´ëŸ¬í•œ í…œí”Œë¦¿ì—ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë¯¼ê°í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.

## ìŠ¤ëƒ…ìƒ·

**ìŠ¤ëƒ…ìƒ·ì€ ë””ìŠ¤í¬ì˜ ë°±ì—…**ì…ë‹ˆë‹¤. ë””ìŠ¤í¬ë¥¼ ë³µì œí•˜ëŠ” ê²ƒê³¼ëŠ” ë‹¤ë¥¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.\
**ìŠ¤ëƒ…ìƒ·**ì€ **ë””ìŠ¤í¬ì™€ ë™ì¼í•œ ì•”í˜¸í™”ë¥¼ ì‚¬ìš©**í•©ë‹ˆë‹¤.

### ì—´ê±°
```bash
gcloud compute snapshots list
gcloud compute snapshots describe <snapshot>
gcloud compute snapshots get-iam-policy <snapshot>
```
### ê¶Œí•œ ìƒìŠ¹

Compute Instances ê¶Œí•œ ìƒìŠ¹ ì„¹ì…˜ì„ í™•ì¸í•˜ì„¸ìš”.

## ì°¸ê³  ìë£Œ

* [https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œì—ì„œ ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ì„ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ë¥¼** íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°êµë¥¼ ê³µìœ í•˜ì„¸ìš”.

</details>
