# GCP - VPC & Mre≈æenje

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## **GCP Raƒçunarsko Mre≈æenje u Kratkim Crtama**

**VPC-ovi** sadr≈æe **Firewall** pravila za dozvolu dolaznog saobraƒáaja u VPC. VPC-ovi takoƒëe sadr≈æe **podmre≈æe** gde ƒáe biti **povezane virtuelne ma≈°ine**.\
U poreƒëenju sa AWS-om, **Firewall** bi bio **najbli≈æa** stvar **AWS** **Security Groups i NACLs**, ali u ovom sluƒçaju su **definisani u VPC-u** a ne u svakom primerku.

## **VPC, Podmre≈æe & Firewall-ovi u GCP-u**

Raƒçunarski primeri su povezani **podmre≈æama** koje su deo **VPC-ova** ([Virtualne privatne mre≈æe](https://cloud.google.com/vpc/docs/vpc)). U GCP-u nema sigurnosnih grupa, postoje [**VPC firewall-ovi**](https://cloud.google.com/vpc/docs/firewalls) sa pravilima definisanim na ovom nivou mre≈æe ali primenjenim na svaku VM instancu.

### Podmre≈æe

Jedan **VPC** mo≈æe imati **vi≈°e podmre≈æa**. Svaka **podmre≈æa je u 1 regionu**.

### Firewall-ovi

Podrazumevano, svaka mre≈æa ima dva [**podrazumevana firewall pravila**](https://cloud.google.com/vpc/docs/firewalls#default\_firewall\_rules): **dozvoli odlazni** i **zabrani dolazni**.

Kada se kreira GCP projekat, VPC nazvan **`default`** je takoƒëe kreiran, sa sledeƒáim firewall pravilima:

* **default-allow-internal:** dozvoli sav saobraƒáaj od drugih instanci na `default` mre≈æi
* **default-allow-ssh:** dozvoli 22 sa bilo kog mesta
* **default-allow-rdp:** dozvoli 3389 sa bilo kog mesta
* **default-allow-icmp:** dozvoli ping sa bilo kog mesta

{% hint style="warning" %}
Kao ≈°to mo≈æete videti, **firewall pravila** obiƒçno su **vi≈°e dozvoljena** za **internu IP adresu**. Podrazumevani VPC dozvoljava sav saobraƒáaj izmeƒëu Raƒçunarskih Instanci.
{% endhint %}

Vi≈°e **Firewall pravila** mo≈æe biti kreirano za podrazumevani VPC ili za nove VPC-ove. [**Firewall pravila**](https://cloud.google.com/vpc/docs/firewalls) mogu biti primenjena na instance putem sledeƒáih **metoda**:

* [**Mre≈æni tagovi**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**Servisni nalozi**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **Sve instance unutar VPC-a**

Na≈æalost, ne postoji jednostavna `gcloud` komanda koja ƒáe izlistati sve Raƒçunske Instance sa otvorenim portovima na internetu. Morate povezati taƒçkice izmeƒëu firewall pravila, mre≈ænih tagova, servisnih naloga i instanci.

Ovaj proces je automatizovan kori≈°ƒáenjem [ovog python skripta](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp\_firewall\_enum) koji ƒáe izvesti sledeƒáe:

* CSV fajl koji prikazuje instancu, javnu IP adresu, dozvoljeni TCP, dozvoljeni UDP
* nmap skeniranje svih instanci na portovima dolaznog saobraƒáaja dozvoljenog sa javnog interneta (0.0.0.0/0)
* masscan za ciljanje punog TCP opsega tih instanci koje dozvoljavaju SVE TCP portove sa javnog interneta (0.0.0.0/0)

### Hijerarhijske Firewall Politike <a href="#hierarchical-firewall-policies" id="hierarchical-firewall-policies"></a>

_Hijerarhijske firewall politike_ vam omoguƒáavaju da kreirate i **sprovedete doslednu firewall politiku ≈°irom va≈°e organizacije**. Mo≈æete dodeliti **hijerarhijske firewall politike organizaciji** u celini ili pojedinaƒçnim **folderima**. Ove politike sadr≈æe pravila koja mogu eksplicitno zabraniti ili dozvoliti konekcije.

Kreirate i primenjujete firewall politike kao odvojene korake. Mo≈æete kreirati i primeniti firewall politike na **ƒçvorovima organizacije ili foldera** [**hijerarhije resursa**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy). Pravilo firewall politike mo≈æe **blokirati konekcije, dozvoliti konekcije ili odlo≈æiti evaluaciju pravila firewall-a** na ni≈æim nivoima foldera ili VPC firewall pravila definisanih u VPC mre≈æama.

Podrazumevano, sva pravila hijerarhijske firewall politike se primenjuju na sve VM-ove u svim projektima pod organizacijom ili folderom gde je politika povezana. Meƒëutim, mo≈æete **ograniƒçiti kojim VM-ovima se dodeljuje dato pravilo** specificiranjem [ciljnih mre≈æa ili ciljnih servisnih naloga](https://cloud.google.com/vpc/docs/firewall-policies#targets).

Mo≈æete proƒçitati ovde kako [**kreirati Hijerarhijsku Firewall Politiku**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud).

### Evaluacija Firewall Pravila

<figure><img src="../../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

1. Org: Firewall politike dodeljene Organizaciji
2. Folder: Firewall politike dodeljene Folderu
3. VPC: Firewall pravila dodeljena VPC-u
4. Globalno: Druga vrsta firewall pravila koja mogu biti dodeljena VPC-ovima
5. Regionalno: Firewall pravila povezana sa VPC mre≈æom NIC-a VM-a i regionom VM-a.

## Povezivanje VPC Mre≈æa

Omoguƒáava povezivanje dve Virtualne privatne mre≈æe (VPC) tako da **resursi u svakoj mre≈æi mogu komunicirati** jedni sa drugima.\
Povezane VPC mre≈æe mogu biti u istom projektu, razliƒçitim projektima iste organizacije, ili **razliƒçitim projektima razliƒçitih organizacija**.

Potrebne dozvole su:

* `compute.networks.addPeering`
* `compute.networks.updatePeering`
* `compute.networks.removePeering`
* `compute.networks.listPeeringRoutes`

[**Vi≈°e u dokumentaciji**](https://cloud.google.com/vpc/docs/vpc-peering).

## Reference

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/vpc/docs/firewall-policies-overview#rule-evaluation](https://cloud.google.com/vpc/docs/firewall-policies-overview#rule-evaluation)

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
