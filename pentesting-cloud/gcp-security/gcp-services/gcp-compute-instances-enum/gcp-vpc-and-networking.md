# GCP - VPC & Networking

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶nderin.

</details>

## **GCP Compute Networking Ã–zeti**

**VPC'ler**, VPC'ye gelen trafiÄŸi izin veren **GÃ¼venlik DuvarÄ±** kurallarÄ±nÄ± iÃ§erir. VPC'ler ayrÄ±ca **sanal makinelerin** baÄŸlanacaÄŸÄ± **alt aÄŸlarÄ±** iÃ§erir.\
AWS ile karÅŸÄ±laÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda, **GÃ¼venlik DuvarÄ±**, **AWS GÃ¼venlik GruplarÄ± ve NACL'lerine** en yakÄ±n ÅŸey olacaktÄ±r, ancak bu durumda bunlar **her Ã¶rnekte deÄŸil, VPC'de tanÄ±mlanmÄ±ÅŸtÄ±r**.

## **GCP'de VPC, Alt AÄŸlar ve GÃ¼venlik DuvarlarÄ±**

Hesaplama Ã–rnekleri, **VPC'lerin** bir parÃ§asÄ± olan **alt aÄŸlar** ile baÄŸlantÄ±lÄ±dÄ±r ([Sanal Ã–zel Bulutlar](https://cloud.google.com/vpc/docs/vpc)). GCP'de gÃ¼venlik gruplarÄ± yok, bu aÄŸ dÃ¼zeyinde tanÄ±mlanan ancak her VM Ã–rneÄŸine uygulanan [**VPC gÃ¼venlik duvarlarÄ±**](https://cloud.google.com/vpc/docs/firewalls) bulunmaktadÄ±r.

### Alt AÄŸlar

Bir **VPC**, **birkaÃ§ alt aÄŸa** sahip olabilir. Her **alt aÄŸ 1 bÃ¶lgede** bulunur.

### GÃ¼venlik DuvarlarÄ±

Her aÄŸÄ±n varsayÄ±lan olarak iki [**varsayÄ±lan gÃ¼venlik duvarÄ± kuralÄ±**](https://cloud.google.com/vpc/docs/firewalls#default\_firewall\_rules) bulunur: **giden trafiÄŸi izin ver** ve **gelen trafiÄŸi reddet**.

Bir GCP projesi oluÅŸturulduÄŸunda, aÅŸaÄŸÄ±daki gÃ¼venlik duvarÄ± kurallarÄ±na sahip **`varsayÄ±lan`** adÄ±nda bir VPC oluÅŸturulur:

* **default-allow-internal:** `varsayÄ±lan` aÄŸÄ±ndaki diÄŸer Ã¶rneklerden tÃ¼m trafiÄŸi izin ver
* **default-allow-ssh:** her yerden 22'ye izin ver
* **default-allow-rdp:** her yerden 3389'a izin ver
* **default-allow-icmp:** her yerden ping'e izin ver

{% hint style="warning" %}
GÃ¶rebileceÄŸiniz gibi, **gÃ¼venlik duvarÄ± kurallarÄ±** genellikle **dahili IP adresleri** iÃ§in **daha geniÅŸ kapsamlÄ±** olma eÄŸilimindedir. VarsayÄ±lan VPC, Hesaplama Ã–rnekleri arasÄ±ndaki tÃ¼m trafiÄŸi izin verir.
{% endhint %}

Daha fazla **GÃ¼venlik DuvarÄ± kuralÄ±**, varsayÄ±lan VPC veya yeni VPC'ler iÃ§in oluÅŸturulabilir. [**GÃ¼venlik DuvarÄ± kurallarÄ±**](https://cloud.google.com/vpc/docs/firewalls), aÅŸaÄŸÄ±daki **yÃ¶ntemler** aracÄ±lÄ±ÄŸÄ±yla Ã¶rnekler Ã¼zerine uygulanabilir:

* [**AÄŸ etiketleri**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**Hizmet hesaplarÄ±**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **VPC iÃ§indeki tÃ¼m Ã¶rnekler**

Ne yazÄ±k ki, internet Ã¼zerinde aÃ§Ä±k portlara sahip tÃ¼m Hesaplama Ã–rneklerini dÃ¶kmek iÃ§in basit bir `gcloud` komutu yoktur. GÃ¼venlik duvarÄ± kurallarÄ±, aÄŸ etiketleri, hizmet hesaplarÄ± ve Ã¶rnekler arasÄ±ndaki baÄŸlantÄ±larÄ± kurmanÄ±z gerekir.

Bu sÃ¼reÃ§, aÅŸaÄŸÄ±dakileri dÄ±ÅŸa aktaracak olan [bu python betiÄŸi](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp\_firewall\_enum) kullanÄ±larak otomatikleÅŸtirildi:

* Halka aÃ§Ä±k IP, izin verilen TCP, izin verilen UDP gÃ¶steren CSV dosyasÄ±
* Halka aÃ§Ä±k internet Ã¼zerinden tÃ¼m Ã¶rnekleri hedefleyen nmap taramasÄ± (0.0.0.0/0'dan gelen giriÅŸ izinli portlar)
* Halka aÃ§Ä±k internet Ã¼zerinden TÃœM TCP portlarÄ±na izin veren bu Ã¶rneklerin tam TCP aralÄ±ÄŸÄ±na hedefleyen masscan taramasÄ±

### HiyerarÅŸik GÃ¼venlik DuvarÄ± PolitikalarÄ± <a href="#hiyerarÅŸik-gÃ¼venlik-duvarÄ±-politikalarÄ±" id="hiyerarÅŸik-gÃ¼venlik-duvarÄ±-politikalarÄ±"></a>

_HiyerarÅŸik gÃ¼venlik duvarÄ± politikalarÄ±_, **kuruluÅŸunuz genelinde tutarlÄ± bir gÃ¼venlik duvarÄ± politikasÄ± oluÅŸturmanÄ±za ve uygulamanÄ±za olanak tanÄ±r**. Bu politikalarÄ± **kuruluÅŸun geneline veya bireysel klasÃ¶rlere** atayabilirsiniz. Bu politikalar, baÄŸlantÄ±larÄ± aÃ§Ä±kÃ§a reddeden veya izin veren kurallar iÃ§erebilir.

GÃ¼venlik duvarÄ± politikalarÄ±nÄ± oluÅŸturup uygulamayÄ± ayrÄ± adÄ±mlar olarak gerÃ§ekleÅŸtirebilirsiniz. GÃ¼venlik duvarÄ± politikalarÄ±nÄ± [**kaynak hiyerarÅŸisi**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy) altÄ±ndaki **kuruluÅŸ veya klasÃ¶r dÃ¼ÄŸÃ¼mlerine** oluÅŸturabilir ve uygulayabilirsiniz. Bir gÃ¼venlik duvarÄ± politikasÄ± kuralÄ±, baÄŸlantÄ±larÄ± **engelleyebilir, izin verebilir veya VPC aÄŸlarÄ±nda tanÄ±mlanan VPC gÃ¼venlik duvarÄ± kurallarÄ±nÄ±** alt dÃ¼zey klasÃ¶rlere veya VPC aÄŸlarÄ±nda tanÄ±mlanan VPC gÃ¼venlik duvarÄ± kurallarÄ±nÄ± erteleyebilir.

VarsayÄ±lan olarak, tÃ¼m hiyerarÅŸik gÃ¼venlik duvarÄ± politikasÄ± kurallarÄ±, politikanÄ±n iliÅŸkilendirildiÄŸi kuruluÅŸ veya klasÃ¶r altÄ±ndaki tÃ¼m projelerdeki tÃ¼m VM'ler iÃ§in geÃ§erlidir. Ancak, [hedef aÄŸlar veya hedef hizmet hesaplarÄ±](https://cloud.google.com/vpc/docs/firewall-policies#targets) belirterek bir kuralÄ±n hangi VM'lerin alacaÄŸÄ±nÄ± **kÄ±sÄ±tlayabilirsiniz**.

[**HiyerarÅŸik GÃ¼venlik DuvarÄ± PolitikasÄ± oluÅŸturmayÄ±**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud) buradan okuyabilirsiniz.

### GÃ¼venlik DuvarÄ± KurallarÄ± DeÄŸerlendirmesi

<figure><img src="../../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

1. KuruluÅŸ: KuruluÅŸa atanan GÃ¼venlik DuvarÄ± politikalarÄ±
2. KlasÃ¶r: KlasÃ¶re atanan GÃ¼venlik DuvarÄ± politikalarÄ±
3. VPC: VPC'ye atanan GÃ¼venlik DuvarÄ± kurallarÄ±
4. Global: VPC'lere atanabilen baÅŸka bir tÃ¼r GÃ¼venlik DuvarÄ± kurallarÄ±
5. BÃ¶lgesel: VM'nin NIC'inin VPC aÄŸÄ± ve VM'nin bÃ¶lgesi ile iliÅŸkilendirilen GÃ¼venlik DuvarÄ± kurallarÄ±.

## VPC AÄŸÄ± EÅŸleme

Ä°ki Sanal Ã–zel Bulut (VPC) aÄŸÄ±nÄ± birbirine baÄŸlamayÄ± saÄŸlar, bÃ¶ylece **her aÄŸdaki kaynaklar birbirleriyle iletiÅŸim kurabilir**.\
EÅŸlenmiÅŸ VPC aÄŸlarÄ± aynÄ± projede, aynÄ± organizasyonun farklÄ± projelerinde veya **farklÄ± organizasyonlarÄ±n farklÄ± projelerinde** olabilir.

Gerekli izinler ÅŸunlardÄ±r:

* `compute.networks.addPeering`
* `compute.networks.updatePeering`
* `compute.networks.removePeering`
* `compute.networks.listPeeringRoutes`

[Daha fazlasÄ± belgelerde](https://cloud.google.com/vpc/docs/vpc-peering).

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/vpc/docs/firewall-policies-overview#rule-evaluation](https://cloud.google.com/vpc/docs/firewall-policies-overview#rule-evaluation)

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶nderin.

</details>
