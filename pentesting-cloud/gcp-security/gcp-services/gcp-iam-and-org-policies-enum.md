# GCP - IAM, Principals & Org Policies Enum

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>

## –û–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å–ª—É–∂–±–∏

–î–ª—è –≤—Å—Ç—É–ø—É –≤ —Ç–µ, —â–æ —Ç–∞–∫–µ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ:

{% content-ref url="../gcp-basic-information/" %}
[gcp-basic-information](../gcp-basic-information/)
{% endcontent-ref %}

### –ü–µ—Ä–µ–ª—ñ–∫

–û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏ –∑–∞–≤–∂–¥–∏ –Ω–∞–ª–µ–∂–∏—Ç—å –¥–æ –ø—Ä–æ–µ–∫—Ç—É:

```bash
gcloud iam service-accounts list --project <project>
```

## –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–∞ –ì—Ä—É–ø–∏

–î–ª—è –≤—Å—Ç—É–ø—É –≤ —Ç–µ, —è–∫ –ø—Ä–∞—Ü—é—é—Ç—å –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–∞ –ì—Ä—É–ø–∏ –≤ GCP, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

{% content-ref url="../gcp-basic-information/" %}
[gcp-basic-information](../gcp-basic-information/)
{% endcontent-ref %}

### –ü–µ—Ä–µ–ª—ñ–∫

–ó –¥–æ–∑–≤–æ–ª–∞–º–∏ **`serviceusage.services.enable`** —Ç–∞ **`serviceusage.services.use`** –º–æ–∂–ª–∏–≤–æ **—É–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–µ—Ä–≤—ñ—Å–∏** –≤ –ø—Ä–æ–µ–∫—Ç—ñ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ó—Ö.

{% hint style="danger" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º Workspace –Ω–∞–¥–∞—î—Ç—å—Å—è —Ä–æ–ª—å **–°—Ç–≤–æ—Ä—é–≤–∞—á –ø—Ä–æ–µ–∫—Ç—É**, —â–æ –¥–∞—î —ó–º –¥–æ—Å—Ç—É–ø –¥–æ **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –ø—Ä–æ–µ–∫—Ç—ñ–≤**. –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä—é—î –ø—Ä–æ–µ–∫—Ç, –π–æ–º—É –Ω–∞–¥–∞—î—Ç—å—Å—è —Ä–æ–ª—å **`owner`** –Ω–∞–¥ –Ω–∏–º. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤—ñ–Ω –º–æ–∂–µ **—É–≤—ñ–º–∫–Ω—É—Ç–∏ —Ü—ñ —Å–µ—Ä–≤—ñ—Å–∏ –≤ –ø—Ä–æ–µ–∫—Ç—ñ, —â–æ–± –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ–ª—ñ–∫—É Workspace**.

–ü—Ä–æ—Ç–µ, —Å–ª—ñ–¥ –∑–≤–µ—Ä–Ω—É—Ç–∏ —É–≤–∞–≥—É, —â–æ —Ç–∞–∫–æ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ **–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–æ–∑–≤–æ–ª—ñ–≤ –≤ Workspace**, —â–æ–± –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ü—ñ API.
{% endhint %}

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **—É–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–ª—É–∂–±—É `admin`** —ñ —è–∫—â–æ –≤–∞—à –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î **–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –≤ Workspace**, –≤–∏ –º–æ–∂–µ—Ç–µ **–ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –≤—Å—ñ –≥—Ä—É–ø–∏ —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤.\
–ù–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–æ–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å –ø—Ä–æ **`–≥—Ä—É–ø–∏ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ`**, –≤–æ–Ω–æ —Ç–∞–∫–æ–∂ –ø–æ–≤–µ—Ä—Ç–∞—î **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –±–µ–∑ –∂–æ–¥–Ω–∏—Ö –≥—Ä—É–ø**:

{% code overflow="wrap" %}
```bash
# Enable admin
gcloud services enable admin.googleapis.com
gcloud services enable cloudidentity.googleapis.com

# Using admin.googleapis.com
## List all users
gcloud organizations list #The DIRECTORY_CUSTOMER_ID is the Workspace ID
gcloud beta identity groups preview --customer <workspace-id>

# Using cloudidentity.googleapis.com
## List groups of a user (you can list at least the groups you belong to)
gcloud identity groups memberships search-transitive-groups --member-email <email> --labels=cloudidentity.googleapis.com/groups.discussion_forum

## List Group Members (you can list at least the groups you belong to)
gcloud identity groups memberships list --group-email=<email>
### Make it transitive
gcloud identity groups memberships search-transitive-memberships --group-email=<email>

## Get a graph (if you have enough permissions)
gcloud identity groups memberships get-membership-graph --member-email=<email> --labels=cloudidentity.googleapis.com/groups.discussion_forum
```
{% endcode %}

{% hint style="success" %}
–£ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –ø—Ä–∏–∫–ª–∞–¥–∞—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä `--labels` —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º, —Ç–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑–∞–≥–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è (–≤—ñ–Ω –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω, —è–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ API –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ, —è–∫ [**PurplePanda —Ä–æ–±–∏—Ç—å —Ç—É—Ç**](https://github.com/carlospolop/PurplePanda/blob/master/intel/google/discovery/disc\_groups\_users.py).
{% endhint %}

–ù–∞–≤—ñ—Ç—å –∑ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º —Å–ª—É–∂–±–æ—é –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –º–æ–∂–ª–∏–≤–æ, —â–æ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –ø–æ–º–∏–ª–∫—É –ø—Ä–∏ –ø–µ—Ä–µ–ª—ñ–∫—É —ó—Ö —á–µ—Ä–µ–∑ —Ç–µ, —â–æ –≤–∞—à –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–æ–±–æ—á–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É, —è–∫–∏–π –±—É–≤ –∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–∏–π, –Ω–µ –º–∞—î –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–æ–∑–≤–æ–ª—ñ–≤:

<figure><img src="../../../.gitbook/assets/image (5) (2).png" alt=""><figcaption></figcaption></figure>

## IAM

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**—Ü–µ –¥–ª—è –±–∞–∑–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ IAM**](../gcp-basic-information/#iam-roles).

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –¥–æ–∑–≤–æ–ª–∏

–ó [**–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó**](https://cloud.google.com/resource-manager/docs/default-access-control): –ö–æ–ª–∏ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —Ä–µ—Å—É—Ä—Å –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó, –≤—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –≤–∞—à–æ–≥–æ –¥–æ–º–µ–Ω—É –æ—Ç—Ä–∏–º—É—é—Ç—å —Ä–æ–ª—ñ **–°—Ç–≤–æ—Ä—é–≤–∞—á –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤** —Ç–∞ **–°—Ç–≤–æ—Ä—é–≤–∞—á –ø—Ä–æ–µ–∫—Ç—É** –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º. –¶—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ —Ä–æ–ª—ñ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤–∞—à–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –ø–æ—á–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Google Cloud –Ω–µ–≥–∞–π–Ω–æ, –∞–ª–µ –Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∑–≤–∏—á–∞–π–Ω—ñ–π —Ä–æ–±–æ—Ç—ñ –∑ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –≤–∞—à–æ—ó –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó.

–¶—ñ **—Ä–æ–ª—ñ** –Ω–∞–¥–∞—é—Ç—å **–¥–æ–∑–≤–æ–ª–∏**:

* `billing.accounts.create` —Ç–∞ `resourcemanager.organizations.get`
* `resourcemanager.organizations.get` —Ç–∞ `resourcemanager.projects.create`

–ö—Ä—ñ–º —Ç–æ–≥–æ, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä—é—î –ø—Ä–æ–µ–∫—Ç, –≤—ñ–Ω **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º—É—î –≤–ª–∞—Å–Ω–∏–∫–∞ —Ü—å–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É** –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó](https://cloud.google.com/resource-manager/docs/access-control-proj). –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –ø—Ä–æ–µ–∫—Ç —Ç–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –±—É–¥—å-—è–∫—É —Å–ª—É–∂–±—É –Ω–∞ –Ω—å–æ–º—É (–º–∞–π–Ω–µ—Ä–∏? –ü–µ—Ä–µ–ª—ñ–∫ —Ä–æ–±–æ—á–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É? ...)

{% hint style="danger" %}
–ù–∞–π–≤–∏—â–∏–π —Ä—ñ–≤–µ–Ω—å –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –≤ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó GCP - —Ü–µ —Ä–æ–ª—å **–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó**.
{% endhint %}

### set-iam-policy vs add-iam-policy-binding

–£ –±—ñ–ª—å—à–æ—Å—Ç—ñ —Å–ª—É–∂–± –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –¥–æ–∑–≤–æ–ª–∏ –¥–ª—è —Ä–µ—Å—É—Ä—Å—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–µ—Ç–æ–¥—É **`add-iam-policy-binding`** –∞–±–æ **`set-iam-policy`**. –û—Å–Ω–æ–≤–Ω–∞ –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ **`add-iam-policy-binding` –¥–æ–¥–∞—î –Ω–æ–≤–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª—ñ** –¥–æ —ñ—Å–Ω—É—é—á–æ—ó –ø–æ–ª—ñ—Ç–∏–∫–∏ IAM, —Ç–æ–¥—ñ —è–∫ **`set-iam-policy`** –±—É–¥–µ **–≤–∏–¥–∞–ª—è—Ç–∏ —Ä–∞–Ω—ñ—à–µ** –Ω–∞–¥–∞–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ —Ç–∞ **–≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –ª–∏—à–µ —Ç—ñ**, —è–∫—ñ –≤–∫–∞–∑–∞–Ω—ñ –≤ –∫–æ–º–∞–Ω–¥—ñ.

### –ü–µ—Ä–µ–ª—ñ–∫

```bash
# Roles
## List roles
gcloud iam roles list --project $PROJECT_ID # List only custom roles
gcloud iam roles list --filter='etag:AA=='

## Get perms and description of role
gcloud iam roles describe roles/container.admin
gcloud iam roles describe --project <proj-name> <role-name>

# Policies
gcloud organizations get-iam-policy <org_id>
gcloud resource-manager folders get-iam-policy <folder-id>
gcloud projects get-iam-policy <project-id>

# MISC
## Testable permissions in resource
gcloud iam list-testable-permissions --filter "NOT apiDisabled: true" <resource>
## Grantable roles to a resource
gcloud iam list-grantable-roles <project URL>
```

### –ü–µ—Ä–µ–ª—ñ–∫ IAM —É —Ö–º–∞—Ä–Ω–∏—Ö –∞–∫—Ç–∏–≤–∞—Ö

–Ü—Å–Ω—É—é—Ç—å —Ä—ñ–∑–Ω—ñ —Å–ø–æ—Å–æ–±–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤—Å—ñ—Ö –¥–æ–∑–≤–æ–ª—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö (—Ç–∞–∫–∏—Ö —è–∫ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó, —Ç–µ–∫–∏, –ø—Ä–æ–µ–∫—Ç–∏...) –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ü—ñ—î—ó —Å–ª—É–∂–±–∏.

* –î–æ–∑–≤—ñ–ª **`cloudasset.assets.searchAllIamPolicies`** –º–æ–∂–µ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ **–≤—Å—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ iam** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ä–µ—Å—É—Ä—Å—É.

```bash
gcloud asset search-all-iam-policies #By default uses current configured project
gcloud asset search-all-iam-policies --scope folders/1234567
gcloud asset search-all-iam-policies --scope organizations/123456
gcloud asset search-all-iam-policies --scope projects/project-id-123123
```

* –î–æ–∑–≤—ñ–ª **`cloudasset.assets.analyzeIamPolicy`** –º–æ–∂–µ –∑–∞–ø–∏—Ç–∞—Ç–∏ **–≤—Å—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ iam** –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–∞ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ä–µ—Å—É—Ä—Å—É.

```bash
# Needs perm "cloudasset.assets.analyzeIamPolicy" over the asset
gcloud asset analyze-iam-policy --organization=<org-id> \
--identity='user:email@hacktricks.xyz'
gcloud asset analyze-iam-policy --folder=<folder-id> \
--identity='user:email@hacktricks.xyz'
gcloud asset analyze-iam-policy --project=<project-name> \
--identity='user:email@hacktricks.xyz'
```

* –î–æ–∑–≤—ñ–ª **`cloudasset.assets.searchAllResources`** –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–ª—ñ—á—É–≤–∞—Ç–∏ –≤—Å—ñ —Ä–µ—Å—É—Ä—Å–∏ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó, —Ç–µ–∫–∏ –∞–±–æ –ø—Ä–æ–µ–∫—Ç—É. –í–∫–ª—é—á–µ–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ IAM (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ä–æ–ª—ñ).

```bash
gcloud asset search-all-resources --scope projects/<proj-name>
gcloud asset search-all-resources --scope folders/1234567
gcloud asset search-all-resources --scope organizations/123456
```

* –î–æ–∑–≤—ñ–ª **`cloudasset.assets.analyzeMove`** –º–æ–∂–µ –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–∏–º –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫, —â–æ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —Ä–µ—Å—É—Ä—Å, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ–µ–∫—Ç.

```bash
gcloud asset analyze-move --project=<proj-name> \
--destination-organization=609216679593
```

* –Ø –ø—Ä–∏–ø—É—Å–∫–∞—é, —â–æ –¥–æ–∑–≤—ñ–ª **`cloudasset.assets.queryIamPolicy`** —Ç–∞–∫–æ–∂ –º–æ–∂–µ –Ω–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø–æ—à—É–∫—É –¥–æ–∑–≤–æ–ª—ñ–≤ –¥–ª—è –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª—ñ–≤

```bash
# But, when running something like this
gcloud asset query --project=<proj> --statement='SELECT * FROM compute_googleapis_com_Instance'
# I get the error
ERROR: (gcloud.asset.query) UNAUTHENTICATED: QueryAssets API is only supported for SCC premium customers. See https://cloud.google.com/security-command-center/pricing
```

### –ü–µ—Ä–µ–ª—ñ–∫ –¥–æ–∑–≤–æ–ª—ñ–≤ testIamPermissions

{% hint style="danger" %}
–Ø–∫—â–æ –≤–∏ **–Ω–µ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ IAM** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –º–µ—Ç–æ–¥—ñ–≤ —ñ –≤–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ö–æ–º–∞–Ω–¥—ñ –ß–µ—Ä–≤–æ–Ω–æ–≥–æ, –≤–∏ –º–æ–∂–µ—Ç–µ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** [**https://github.com/carlospolop/bf\_my\_gcp\_perms**](https://github.com/carlospolop/bf\_my\_gcp\_perms) **–¥–ª—è –ø–µ—Ä–µ–±–æ—Ä—É –≤–∞—à–∏—Ö –ø–æ—Ç–æ—á–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤.**

–ü—Ä–æ—Ç–µ —Å–ª—ñ–¥ –∑–∞—É–≤–∞–∂–∏—Ç–∏, —â–æ —Å–ª—É–∂–±–∞ **`cloudresourcemanager.googleapis.com`** –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–∞.
{% endhint %}

### –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤

–ù–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —è–∫ **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ IAM –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**:

{% content-ref url="../gcp-privilege-escalation/gcp-iam-privesc.md" %}
[gcp-iam-privesc.md](../gcp-privilege-escalation/gcp-iam-privesc.md)
{% endcontent-ref %}

### –ù–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –ø–µ—Ä–µ–ª—ñ–∫ <a href="#service-account-impersonation" id="service-account-impersonation"></a>

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-iam-principals-and-org-unauthenticated-enum.md" %}
[gcp-iam-principals-and-org-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-iam-principals-and-org-unauthenticated-enum.md)
{% endcontent-ref %}

### –ü—ñ—Å–ª—è–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ–π–Ω–∞ —Ñ–∞–∑–∞ <a href="#service-account-impersonation" id="service-account-impersonation"></a>

{% content-ref url="../gcp-post-exploitation/gcp-iam-post-exploitation.md" %}
[gcp-iam-post-exploitation.md](../gcp-post-exploitation/gcp-iam-post-exploitation.md)
{% endcontent-ref %}

### –ù–∞–ø–æ–ª–µ–≥–ª–∏–≤—ñ—Å—Ç—å

–Ø–∫—â–æ —É –≤–∞—Å —î –≤–∏—Å–æ–∫—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó, –≤–∏ –º–æ–∂–µ—Ç–µ:

* –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—ñ –°–ê (–∞–±–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—â–æ –≤–∏ –≤ Workspace)
* –ù–∞–¥–∞—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–∞–º, —è–∫—ñ –∫–æ–Ω—Ç—Ä–æ–ª—é—é—Ç—å—Å—è –≤–∞–º–∏, –±—ñ–ª—å—à–µ –¥–æ–∑–≤–æ–ª—ñ–≤
* –ù–∞–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –≤—Ä–∞–∑–ª–∏–≤–∏–º –°–ê (SSRF –≤ vm, –≤—Ä–∞–∑–ª–∏–≤–∞ Cloud Function...)
* ...

## –ü–æ–ª—ñ—Ç–∏–∫–∏ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó

–î–ª—è –≤—Å—Ç—É–ø—É –≤ —Ç–µ, —â–æ —Ç–∞–∫–µ –ü–æ–ª—ñ—Ç–∏–∫–∏ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

{% content-ref url="../gcp-basic-information/" %}
[gcp-basic-information](../gcp-basic-information/)
{% endcontent-ref %}

–ü–æ–ª—ñ—Ç–∏–∫–∏ IAM –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ –¥–æ–∑–≤–æ–ª–∏, —è–∫—ñ –º–∞—é—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–∏ —â–æ–¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ —á–µ—Ä–µ–∑ —Ä–æ–ª—ñ, —è–∫—ñ –Ω–∞–¥–∞—é—Ç—å –≥—Ä–∞–Ω—É–ª—å–æ–≤–∞–Ω—ñ –¥–æ–∑–≤–æ–ª–∏. –ü–æ–ª—ñ—Ç–∏–∫–∏ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó **–æ–±–º–µ–∂—É—é—Ç—å, —è–∫ —Ü—ñ —Å–ª—É–∂–±–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –∞–±–æ —è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –≤–∏–º–∫–Ω–µ–Ω—ñ**. –¶–µ –¥–æ–ø–æ–º–∞–≥–∞—î –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å—É –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ GCP.

```bash
gcloud resource-manager org-policies list --organization=ORGANIZATION_ID
gcloud resource-manager org-policies list --folder=FOLDER_ID
gcloud resource-manager org-policies list --project=PROJECT_ID
```

### –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤

–ù–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —è–∫ **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**:

{% content-ref url="../gcp-privilege-escalation/gcp-orgpolicy-privesc.md" %}
[gcp-orgpolicy-privesc.md](../gcp-privilege-escalation/gcp-orgpolicy-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **—Ä–µ–∫–ª–∞–º—É –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
