# GCP - Enumeraci贸n de Cloud Run

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de HackTricks en AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**swag oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Cloud Run <a href="#revisando-las-configuraciones-de-cloud-run" id="revisando-las-configuraciones-de-cloud-run"></a>

Cloud Run es una plataforma de c贸mputo administrada sin servidor que te permite **ejecutar contenedores** directamente sobre la infraestructura escalable de Google.

Puedes ejecutar tu contenedor o, si est谩s utilizando Go, Node.js, Python, Java, .NET Core o Ruby, puedes utilizar la opci贸n de [implementaci贸n basada en c贸digo fuente](https://cloud.google.com/run/docs/deploying-source-code) que **construye el contenedor por ti**.

Google ha construido Cloud Run para **funcionar bien junto con otros servicios en Google Cloud**, por lo que puedes construir aplicaciones completas.

### Servicios y trabajos <a href="#servicios-y-trabajos" id="servicios-y-trabajos"></a>

En Cloud Run, tu c贸digo puede ejecutarse continuamente como un _**servicio**_ o como un _**trabajo**_. Tanto los servicios como los trabajos se ejecutan en el mismo entorno y pueden utilizar las mismas integraciones con otros servicios en Google Cloud.

* **Servicios de Cloud Run.** Se utilizan para ejecutar c贸digo que responde a solicitudes web o eventos.
* **Trabajos de Cloud Run.** Se utilizan para ejecutar c贸digo que realiza un trabajo y se detiene cuando el trabajo est谩 hecho.

## Servicio de Cloud Run

Google [Cloud Run](https://cloud.google.com/run) es otra oferta sin servidor donde tambi茅n puedes buscar variables de entorno. Cloud Run crea un peque帽o servidor web, que se ejecuta en el puerto 8080 dentro del contenedor de forma predeterminada, que espera una solicitud HTTP. Cuando se recibe la solicitud, se ejecuta un trabajo y el registro del trabajo se muestra a trav茅s de una respuesta HTTP.

### Detalles relevantes

* Por **defecto**, el **acceso** al servidor web es **p煤blico**, pero tambi茅n puede ser **limitado al tr谩fico interno** (VPC...)\
Adem谩s, la **autenticaci贸n** para contactar con el servidor web puede ser **permitir a todos** o **requerir autenticaci贸n a trav茅s de IAM**.
* Por defecto, el **cifrado** utiliza una **clave administrada por Google**, pero tambi茅n se puede **elegir** una **CMEK** (Clave de Cifrado Administrada por el Cliente) de **KMS**.
* Por **defecto**, la cuenta de servicio utilizada es la **predeterminada de Compute Engine** que tiene acceso de **Editor** sobre el proyecto y tiene el **谩mbito `cloud-platform`.**
* Es posible definir **variables de entorno en texto claro** para la ejecuci贸n e incluso **montar secretos de la nube** o **agregar secretos de la nube a variables de entorno.**
* Tambi茅n es posible **agregar conexiones con Cloud SQL** y **montar un sistema de archivos.**
* Las **URLs** de los servicios implementados son similares a **`https://<nombre-servicio>-<aleatorio>.a.run.app`**
* Un Servicio de Run puede tener **m谩s de 1 versi贸n o revisi贸n** y **dividir el tr谩fico** entre varias revisiones.

### Enumeraci贸n
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Trabajos de Cloud Run

Los trabajos de Cloud Run son m谩s adecuados para **contenedores que se ejecutan hasta su finalizaci贸n y no atienden solicitudes**. Los trabajos no tienen la capacidad de atender solicitudes o escuchar en un puerto. Esto significa que, a diferencia de los servicios de Cloud Run, los trabajos no deben incluir un servidor web. En su lugar, los contenedores de trabajos deben finalizar cuando hayan terminado.
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Escalada de Privilegios

En la siguiente p谩gina, puedes verificar c贸mo **abusar de los permisos de Cloud Run para escalar privilegios**:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Acceso No Autenticado

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Post Explotaci贸n

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Persistencia

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Referencias

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
