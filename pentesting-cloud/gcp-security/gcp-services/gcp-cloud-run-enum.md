# GCP - Cloud Run æšä¸¾

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆçš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)** ä¸Šå…³æ³¨æˆ‘ä»¬**ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run æ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨æ‰˜ç®¡è®¡ç®—å¹³å°ï¼Œå…è®¸æ‚¨ç›´æ¥åœ¨ Google çš„å¯æ‰©å±•åŸºç¡€è®¾æ–½ä¸Š**è¿è¡Œå®¹å™¨**ã€‚

æ‚¨å¯ä»¥è¿è¡Œæ‚¨çš„å®¹å™¨ï¼Œæˆ–è€…å¦‚æœæ‚¨ä½¿ç”¨ Goã€Node.jsã€Pythonã€Javaã€.NET Core æˆ– Rubyï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[åŸºäºæºä»£ç éƒ¨ç½²](https://cloud.google.com/run/docs/deploying-source-code)é€‰é¡¹ï¼Œè¯¥é€‰é¡¹ä¼š**ä¸ºæ‚¨æ„å»ºå®¹å™¨**ã€‚

Google å·²ç»æ„å»ºäº† Cloud Runï¼Œä»¥ä¾¿ä¸ Google Cloud ä¸Šçš„å…¶ä»–æœåŠ¡**è‰¯å¥½é…åˆ**ï¼Œå› æ­¤æ‚¨å¯ä»¥æ„å»ºåŠŸèƒ½é½å…¨çš„åº”ç”¨ç¨‹åºã€‚

### æœåŠ¡å’Œä½œä¸š <a href="#services-and-jobs" id="services-and-jobs"></a>

åœ¨ Cloud Run ä¸Šï¼Œæ‚¨çš„ä»£ç å¯ä»¥ä½œä¸º**æœåŠ¡**æˆ–**ä½œä¸š**è¿è¡Œã€‚æœåŠ¡å’Œä½œä¸šéƒ½åœ¨ç›¸åŒçš„ç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥ä¸ Google Cloud ä¸Šçš„å…¶ä»–æœåŠ¡è¿›è¡Œé›†æˆã€‚

* **Cloud Run æœåŠ¡ã€‚** ç”¨äºè¿è¡Œå“åº” Web è¯·æ±‚æˆ–äº‹ä»¶çš„ä»£ç ã€‚
* **Cloud Run ä½œä¸šã€‚** ç”¨äºè¿è¡Œæ‰§è¡Œå·¥ä½œï¼ˆä½œä¸šï¼‰å¹¶åœ¨å·¥ä½œå®Œæˆæ—¶é€€å‡ºçš„ä»£ç ã€‚

## Cloud Run æœåŠ¡

Google [Cloud Run](https://cloud.google.com/run) æ˜¯å¦ä¸€ä¸ªæ— æœåŠ¡å™¨æä¾›ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æœç´¢ç¯å¢ƒå˜é‡ã€‚Cloud Run åˆ›å»ºä¸€ä¸ªå°å‹ Web æœåŠ¡å™¨ï¼Œé»˜è®¤åœ¨å®¹å™¨å†…éƒ¨çš„ç«¯å£ 8080 ä¸Šè¿è¡Œï¼Œç­‰å¾… HTTP GET è¯·æ±‚ã€‚å½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä¼šæ‰§è¡Œä½œä¸šï¼Œå¹¶é€šè¿‡ HTTP å“åº”è¾“å‡ºä½œä¸šæ—¥å¿—ã€‚

### ç›¸å…³ç»†èŠ‚

* **é»˜è®¤æƒ…å†µä¸‹**ï¼Œå¯¹ Web æœåŠ¡å™¨çš„**è®¿é—®**æ˜¯**å…¬å¼€**çš„ï¼Œä½†ä¹Ÿå¯ä»¥**é™åˆ¶ä¸ºå†…éƒ¨æµé‡**ï¼ˆVPC...ï¼‰\
æ­¤å¤–ï¼Œè”ç³» Web æœåŠ¡å™¨çš„**èº«ä»½éªŒè¯**å¯ä»¥æ˜¯**å…è®¸æ‰€æœ‰**æˆ–**é€šè¿‡ IAM è¦æ±‚èº«ä»½éªŒè¯**ã€‚
* é»˜è®¤æƒ…å†µä¸‹ï¼Œ**åŠ å¯†**ä½¿ç”¨**Google ç®¡ç†çš„å¯†é’¥**ï¼Œä½†ä¹Ÿå¯ä»¥é€‰æ‹©æ¥è‡ª**KMS çš„ CMEK**ï¼ˆå®¢æˆ·ç®¡ç†çš„åŠ å¯†å¯†é’¥ï¼‰ã€‚
* é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„**æœåŠ¡å¸å·**æ˜¯å…·æœ‰å¯¹é¡¹ç›®çš„**ç¼–è¾‘å™¨**è®¿é—®æƒé™å¹¶å…·æœ‰**`cloud-platform`**èŒƒå›´çš„**Compute Engine é»˜è®¤å¸å·**ã€‚
* å¯ä»¥ä¸ºæ‰§è¡Œå®šä¹‰**æ˜æ–‡ç¯å¢ƒå˜é‡**ï¼Œç”šè‡³**æŒ‚è½½äº‘ç§˜å¯†**æˆ–**å°†äº‘ç§˜å¯†æ·»åŠ åˆ°ç¯å¢ƒå˜é‡**ã€‚
* è¿˜å¯ä»¥**ä¸ Cloud SQL å»ºç«‹è¿æ¥**å’Œ**æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ**ã€‚
* éƒ¨ç½²çš„æœåŠ¡çš„**URL**ç±»ä¼¼äº**`https://<svc-name>-<random>.a.run.app`**
* Run æœåŠ¡å¯ä»¥æœ‰**å¤šä¸ªç‰ˆæœ¬æˆ–ä¿®è®¢ç‰ˆ**ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å¤šä¸ªä¿®è®¢ç‰ˆä¹‹é—´**åˆ†é…æµé‡**ã€‚

### æšä¸¾
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run ä»»åŠ¡

Cloud Run ä»»åŠ¡æ›´é€‚åˆäº**è¿è¡Œå®Œæˆä¸”ä¸æä¾›è¯·æ±‚æœåŠ¡çš„å®¹å™¨**ã€‚ ä»»åŠ¡æ— æ³•æä¾›è¯·æ±‚æœåŠ¡æˆ–ç›‘å¬ç«¯å£ã€‚ è¿™æ„å‘³ç€ä¸Cloud RunæœåŠ¡ä¸åŒï¼Œä»»åŠ¡ä¸åº”æ†ç»‘WebæœåŠ¡å™¨ã€‚ ç›¸åï¼Œä»»åŠ¡å®¹å™¨åº”åœ¨å®Œæˆä»»åŠ¡åé€€å‡ºã€‚

### æšä¸¾
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## ææƒ

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨äº‘è¿è¡Œæƒé™ä»¥æå‡ç‰¹æƒ**ï¼š

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## æœªç»èº«ä»½éªŒè¯è®¿é—®

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## åæ¸—é€

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## æŒä¹…æ€§

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## å‚è€ƒ

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
