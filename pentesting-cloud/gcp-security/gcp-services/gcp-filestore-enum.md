# GCP - Enumeraci贸n de Filestore

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informaci贸n B谩sica

Google Cloud Filestore es un servicio de almacenamiento de archivos gestionado para aplicaciones que requieren una **interfaz de sistema de archivos y un sistema de archivos compartido para datos**. Filestore proporciona recursos compartidos de archivos de alto rendimiento que puedes montar en diferentes servicios de GCP. Es particularmente 煤til para aplicaciones y flujos de trabajo que dependen de interfaces y sem谩nticas de sistemas de archivos tradicionales, como procesamiento de medios, gesti贸n de contenido y copias de seguridad de bases de datos.

Puedes pensar en esto como cualquier otro **repositorio de documentos compartidos NFS** - una fuente potencial de informaci贸n sensible.

### Conexiones

Al crear una instancia de Filestore es posible **seleccionar la red donde ser谩 accesible**.

Adem谩s, por **defecto todos los clientes en la red VPC seleccionada y regi贸n podr谩n acceder a ella**, sin embargo, es posible **restringir el acceso tambi茅n por direcci贸n IP** o rango e indicar el privilegio de acceso (Admin, Admin Viewer, Editor, Viewer) que el cliente obtendr谩 **dependiendo de la direcci贸n IP.**

Tambi茅n puede ser accesible a trav茅s de una **Conexi贸n de Acceso a Servicio Privado:**

* Son por red VPC y se pueden utilizar en todos los servicios gestionados como Memorystore, Tensorflow y SQL.
* Son **entre tu red VPC y una red propiedad de Google usando un emparejamiento VPC**, permitiendo que tus instancias y servicios se comuniquen exclusivamente **usando direcciones IP internas**.
* Crean un proyecto aislado para ti en el lado del proveedor de servicios, lo que significa que ning煤n otro cliente lo comparte. Se te facturar谩 solo por los recursos que provisiones.
* El emparejamiento VPC importar谩 nuevas rutas a tu VPC

### Copias de Seguridad

Es posible crear **copias de seguridad de los recursos compartidos de archivos**. Estas pueden ser **restauradas en el origen** de la nueva instancia de Fileshare o en **nuevas**.

### Encriptaci贸n

Por defecto se utilizar谩 una **clave de encriptaci贸n gestionada por Google** para encriptar los datos, pero es posible seleccionar una **clave de encriptaci贸n gestionada por el cliente (CMEK)**.

### Enumeraci贸n

Si encuentras un filestore disponible en el proyecto, puedes **montarlo** desde tu instancia de Compute comprometida. Usa el siguiente comando para ver si existe alguno.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Ten en cuenta que un servicio de filestore podr铆a estar en una **subred completamente nueva creada para 茅l** (dentro de una Private Service Access Connection, que es un **VPC peer**).\
Por lo tanto, podr铆as necesitar **enumerar VPC peers** para tambi茅n ejecutar nmap sobre esos rangos de red.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
```markdown
{% endcode %}
{% endhint %}

### Escalaci贸n de Privilegios & Post Explotaci贸n

No hay formas de escalar privilegios en GCP abusando directamente de este servicio, pero utilizando algunos trucos de **Post Explotaci贸n es posible acceder a los datos** y quiz谩s puedas encontrar algunas credenciales para escalar privilegios:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```
