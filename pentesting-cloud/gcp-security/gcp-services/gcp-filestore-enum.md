# GCP - Filestore Enum

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

Google Cloud Filestore to **zarzdzana usuga przechowywania plik贸w** dostosowana do aplikacji potrzebujcych zar贸wno **interfejsu systemu plik贸w, jak i wsp贸dzielonego systemu plik贸w dla danych**. Ta usuga wyr贸偶nia si oferowaniem udzia贸w plik贸w o wysokiej wydajnoci, kt贸re mo偶na zintegrowa z r贸偶nymi usugami GCP. Jej u偶yteczno przejawia si w scenariuszach, gdzie tradycyjne interfejsy i semantyka systemu plik贸w s kluczowe, takich jak przetwarzanie medi贸w, zarzdzanie treci i tworzenie kopii zapasowych baz danych.

Mo偶esz to por贸wna do dowolnego **repozytorium dokument贸w wsp贸dzielonych NFS** - potencjalnego 藕r贸da poufnych informacji.

### Poczenia

Podczas tworzenia instancji Filestore mo偶na **wybra sie, w kt贸rej bdzie dostpna**.

Co wicej, **domylnie wszyscy klienci w wybranej sieci VPC i regionie bd mieli do niej dostp**, jednak偶e mo偶liwe jest **ograniczenie dostpu r贸wnie偶 przez adres IP** lub zakres oraz okrelenie uprawnie dostpu (Administrator, Administrator Widz, Edytor, Widz) dla klienta w zale偶noci od adresu IP.

Mo偶na r贸wnie偶 uzyska do niej dostp za porednictwem **Poczenia z Dostpem do Usugi Prywatnej:**

* Dotycz konkretnej sieci VPC i mog by u偶ywane we wszystkich usugach zarzdzanych, takich jak Memorystore, Tensorflow i SQL.
* S **midzy twoj sieci VPC a sieci nale偶c do Google za pomoc poczenia VPC peering**, umo偶liwiajc twoim instancjom i usugom komunikacj wycznie **za pomoc adres贸w IP wewntrznych**.
* Tworz izolowany projekt dla ciebie po stronie producenta usugi, co oznacza, 偶e nie dziel go inni klienci. Bdziesz paci tylko za zasoby, kt贸re przydzielasz.
* Poczenie VPC peering importuje nowe trasy do twojej sieci VPC

### Kopie zapasowe

Mo偶liwe jest tworzenie **kopii zapasowych udzia贸w plik贸w**. Mog one by p贸藕niej **przywracane w oryginalnej** nowej instancji Fileshare lub w **nowych**.

### Szyfrowanie

Domylnie u偶ywany jest **klucz szyfrowania zarzdzany przez Google** do szyfrowania danych, ale mo偶liwe jest wybranie **klucza szyfrowania zarzdzanego przez klienta (CMEK)**.

### Wyliczanie

Jeli znajdziesz dostpny filestore w projekcie, mo偶esz go **zamontowa** z wewntrz skompromitowanej instancji obliczeniowej. U偶yj poni偶szej komendy, aby sprawdzi, czy istnieje jakikolwiek.
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Nale偶y pamita, 偶e usuga filestore mo偶e znajdowa si w **cakowicie nowej podsieci utworzonej dla niej** (w ramach Poczenia Dostpu do Usugi Prywatnej, kt贸re jest **peerem VPC**).\
Dlatego mo偶e by konieczne **wyliczenie peer贸w VPC** w celu uruchomienia nmap na tych zakresach sieciowych.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
### Eskalacja uprawnie i eksploatacja po wamaniu

Nie ma bezporednich sposob贸w na eskalacj uprawnie w GCP poprzez nadu偶ycie tego usugi, ale za pomoc niekt贸rych **sztuczek eksploatacji po wamaniu mo偶na uzyska dostp do danych** i by mo偶e znajdziesz pewne powiadczenia, aby eskalowa uprawnienia:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Trwao

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
