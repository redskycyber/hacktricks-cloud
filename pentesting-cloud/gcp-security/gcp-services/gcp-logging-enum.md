# GCP - GÃ¼nlÃ¼k Sorgulama

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## Temel Bilgiler

Bu hizmet, kullanÄ±cÄ±larÄ±n GCP'den **gÃ¼nlÃ¼k verilerini ve olaylarÄ±nÄ±** depolamasÄ±na, aramasÄ±na, analiz etmesine, izlemesine ve uyarÄ± almasÄ±na olanak tanÄ±r.

Cloud Logging, diÄŸer GCP hizmetleriyle tam entegre olup, GCP kaynaklarÄ±nÄ±zdan gelen gÃ¼nlÃ¼kleri merkezi bir depo olarak saÄŸlar. Otomatik olarak App Engine, Compute Engine ve Cloud Functions gibi Ã§eÅŸitli GCP hizmetlerinden gÃ¼nlÃ¼kleri toplayabilirsiniz. AyrÄ±ca, Cloud Logging ajanÄ±nÄ± veya API'sÄ±nÄ± kullanarak yerinde veya diÄŸer bulutlarda Ã§alÄ±ÅŸan uygulamalar iÃ§in de Cloud Logging'i kullanabilirsiniz.

Ana Ã–zellikler:

* **GÃ¼nlÃ¼k Verilerinin MerkezileÅŸtirilmesi:** UygulamalarÄ±nÄ±zÄ±n ve altyapÄ±nÄ±zÄ±n bÃ¼tÃ¼nsel bir gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ sunan Ã§eÅŸitli kaynaklardan gÃ¼nlÃ¼k verilerini birleÅŸtirin.
* **GerÃ§ek ZamanlÄ± GÃ¼nlÃ¼k YÃ¶netimi:** HÄ±zlÄ± analiz ve yanÄ±t iÃ§in gÃ¼nlÃ¼kleri gerÃ§ek zamanlÄ± olarak akÄ±ÅŸ halinde tutun.
* **GÃ¼Ã§lÃ¼ Veri Analizi:** BÃ¼yÃ¼k miktardaki gÃ¼nlÃ¼k verilerini hÄ±zlÄ± bir ÅŸekilde sÃ¼zerek geliÅŸmiÅŸ filtreleme ve arama yeteneklerini kullanÄ±n.
* **BigQuery ile Entegrasyon:** AyrÄ±ntÄ±lÄ± analiz ve sorgulama iÃ§in gÃ¼nlÃ¼kleri BigQuery'ye aktarÄ±n.
* **GÃ¼nlÃ¼k TabanlÄ± Metrikler:** GÃ¼nlÃ¼k verilerinizden Ã¶lÃ§Ã¼m ve uyarÄ±lar iÃ§in Ã¶zel metrikler oluÅŸturun.

### GÃ¼nlÃ¼k AkÄ±ÅŸÄ±

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption><p><a href="https://betterstack.com/community/guides/logging/gcp-logging/">https://betterstack.com/community/guides/logging/gcp-logging/</a></p></figcaption></figure>

Temel olarak, sinkler ve gÃ¼nlÃ¼k tabanlÄ± metrikler bir gÃ¼nlÃ¼ÄŸÃ¼n nereye depolanacaÄŸÄ±nÄ± belirler.

### GCP Logging TarafÄ±ndan Desteklenen YapÄ±landÄ±rmalar

Cloud Logging, Ã§eÅŸitli iÅŸletme ihtiyaÃ§larÄ±na uyacak ÅŸekilde yÃ¼ksek dÃ¼zeyde yapÄ±landÄ±rÄ±labilir:

1. **GÃ¼nlÃ¼k KovalarÄ± (Web'deki gÃ¼nlÃ¼k depolama):** GÃ¼nlÃ¼k saklama sÃ¼resini yÃ¶netmek iÃ§in Cloud Logging'de kovalar tanÄ±mlayÄ±n, bÃ¶ylece gÃ¼nlÃ¼k giriÅŸlerinizin ne kadar sÃ¼reyle saklanacaÄŸÄ± konusunda kontrol saÄŸlayabilirsiniz.
* VarsayÄ±lan olarak, `_Default` ve `_Required` adÄ±nda kovalar oluÅŸturulur (bir tanesi diÄŸerinin olmayanÄ± kaydeder).
*   **\_Required** ÅŸu ÅŸekildedir:

{% code overflow="wrap" %}
```bash
LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
```
{% endcode %}
* Verilerin **saklama sÃ¼resi** kova baÅŸÄ±na yapÄ±landÄ±rÄ±lÄ±r ve en az **1 gÃ¼n olmalÄ±dÄ±r**. Ancak, **\_Required'in saklama sÃ¼resi 400 gÃ¼n** olarak yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r ve deÄŸiÅŸtirilemez.
* GÃ¼nlÃ¼k KovalarÄ±'nÄ±n **Cloud Storage'da gÃ¶rÃ¼nmediÄŸini** unutmayÄ±n.
2. **GÃ¼nlÃ¼k Sinkleri (Web'deki gÃ¼nlÃ¼k yÃ¶nlendirici):** Filtreye dayalÄ± olarak gÃ¼nlÃ¼k giriÅŸlerini Pub/Sub, BigQuery veya Cloud Storage gibi Ã§eÅŸitli hedeflere **dÄ±ÅŸa aktarmak** iÃ§in sinkler oluÅŸturun.
* VarsayÄ±lan olarak, `_Default` ve `_Required` iÃ§in sinkler oluÅŸturulur:
* ```bash
_Required  logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Required  LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
_Default   logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Default   NOT LOG_ID("cloudaudit.googleapis.com/activity") AND NOT LOG_ID("externalaudit.googleapis.com/activity") AND NOT LOG_ID("cloudaudit.googleapis.com/system_event") AND NOT LOG_ID("externalaudit.googleapis.com/system_event") AND NOT LOG_ID("cloudaudit.googleapis.com/access_transparency") AND NOT LOG_ID("externalaudit.googleapis.com/access_transparency")
```
* **DÄ±ÅŸlama Filtreleri:** Belirli gÃ¼nlÃ¼k giriÅŸlerinin alÄ±nmasÄ±nÄ± Ã¶nlemek iÃ§in **dÄ±ÅŸlama filtreleri** ayarlamak mÃ¼mkÃ¼ndÃ¼r, bu da maliyetleri dÃ¼ÅŸÃ¼rÃ¼r ve gereksiz gÃ¼rÃ¼ltÃ¼yÃ¼ azaltÄ±r.
3. **GÃ¼nlÃ¼k TabanlÄ± Metrikler:** GÃ¼nlÃ¼k iÃ§eriÄŸine dayalÄ± olarak **Ã¶zel metrikler** yapÄ±landÄ±rarak gÃ¼nlÃ¼k verilerine dayalÄ± uyarÄ± ve izleme yapÄ±n.
4. **GÃ¼nlÃ¼k gÃ¶rÃ¼nÃ¼mleri:** GÃ¼nlÃ¼k gÃ¶rÃ¼nÃ¼mleri, gÃ¼nlÃ¼k kovalarÄ±nÄ±z iÃ§indeki gÃ¼nlÃ¼klere kimin eriÅŸimi olduÄŸu konusunda geliÅŸmiÅŸ ve ayrÄ±ntÄ±lÄ± kontrol saÄŸlar.
* Cloud Logging, her kova iÃ§in otomatik olarak `_AllLogs` gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ oluÅŸturur, bu gÃ¶rÃ¼nÃ¼m tÃ¼m gÃ¼nlÃ¼kleri gÃ¶sterir. Cloud Logging ayrÄ±ca `_Default` kovasÄ± iÃ§in `_Default` adÄ±nda bir gÃ¶rÃ¼nÃ¼m oluÅŸturur. `_Default` kovasÄ± iÃ§in `_Default` gÃ¶rÃ¼nÃ¼mÃ¼, Veri EriÅŸim denetim gÃ¼nlÃ¼klerini hariÃ§ tutarak tÃ¼m gÃ¼nlÃ¼kleri gÃ¶sterir. `_AllLogs` ve `_Default` gÃ¶rÃ¼nÃ¼mleri dÃ¼zenlenemez.

Bir kimseye yalnÄ±zca belirli bir GÃ¼nlÃ¼k gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ kullanma izni vermek iÃ§in aÅŸaÄŸÄ±daki gibi bir IAM politikasÄ± kullanmak mÃ¼mkÃ¼ndÃ¼r:
```json
{
"bindings": [
{
"members": [
"user:username@gmail.com"
],
"role": "roles/logging.viewAccessor",
"condition": {
"title": "Bucket reader condition example",
"description": "Grants logging.viewAccessor role to user username@gmail.com for the VIEW_ID log view.",
"expression":
"resource.name == \"projects/PROJECT_ID/locations/LOCATION/buckets/BUCKET_NAME/views/VIEW_ID\""
}
}
],
"etag": "BwWd_6eERR4=",
"version": 3
}
```
### Saptama

`gcloud` komut satÄ±rÄ± aracÄ±, kaynaklarÄ±nÄ±zÄ± ve hizmetlerinizi yÃ¶netmenize olanak saÄŸlayan GCP ekosisteminin ayrÄ±lmaz bir parÃ§asÄ±dÄ±r. Ä°ÅŸte `gcloud`'u kullanarak gÃ¼nlÃ¼k yapÄ±landÄ±rmalarÄ±nÄ±zÄ± ve eriÅŸim gÃ¼nlÃ¼klerinizi nasÄ±l yÃ¶netebileceÄŸinizi gÃ¶steren bir Ã¶rnek.

{% code overflow="wrap" %}
```bash
# List buckets
gcloud logging buckets list
gcloud logging buckets describe <bucket-name> --location <location>

# List log entries: only logs that contain log entries are listed.
gcloud logging logs list

# Get log metrics
gcloud logging metrics list
gcloud logging metrics describe <metric-name>

# Get log sinks
gcloud logging sinks list
gcloud logging sinks describe <sink-name>

# Get log views
gcloud logging views list --bucket <bucket> --location global
gcloud logging views describe --bucket <bucket> --location global <view-id> # view-id is usually the same as the bucket name

# Get log links
gcloud logging links list --bucket _Default --location global
gcloud logging links describe <link-id> --bucket _Default --location global
```
{% endcode %}

**`cloudresourcemanager`**'Ä±n gÃ¼nlÃ¼klerini kontrol etmek iÃ§in bir Ã¶rnek (izinleri BF iÃ§in kullanÄ±lan): [https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512](https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512)

**`testIamPermissions`**'Ä±n gÃ¼nlÃ¼kleri yok:

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

### Son AÅŸama SaldÄ±rÄ±sÄ±

{% content-ref url="../gcp-post-exploitation/gcp-logging-post-exploitation.md" %}
[gcp-logging-post-exploitation.md](../gcp-post-exploitation/gcp-logging-post-exploitation.md)
{% endcontent-ref %}

### SÃ¼reklilik

{% content-ref url="../gcp-persistence/gcp-logging-persistence.md" %}
[gcp-logging-persistence.md](../gcp-persistence/gcp-logging-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://cloud.google.com/logging/docs/logs-views#gcloud](https://cloud.google.com/logging/docs/logs-views#gcloud)
* [https://betterstack.com/community/guides/logging/gcp-logging/](https://betterstack.com/community/guides/logging/gcp-logging/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
