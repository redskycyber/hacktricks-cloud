# GCP - ë¡œê¹… ì—´ê±°

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ **íŒ”ë¡œìš°**í•˜ì„¸ìš”. ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

ì´ ì„œë¹„ìŠ¤ëŠ” GCPì˜ **ë¡œê·¸ ë°ì´í„° ë° ì´ë²¤íŠ¸**ë¥¼ ì €ì¥, ê²€ìƒ‰, ë¶„ì„, ëª¨ë‹ˆí„°ë§ ë° ê²½ê³ í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

Cloud Loggingì€ ë‹¤ë¥¸ GCP ì„œë¹„ìŠ¤ì™€ ì™„ì „íˆ í†µí•©ë˜ì–´ GCP ë¦¬ì†ŒìŠ¤ì˜ ëª¨ë“  ë¡œê·¸ë¥¼ ìœ„í•œ ì¤‘ì•™ ì €ì¥ì†Œë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ëŠ” App Engine, Compute Engine ë° Cloud Functionsê³¼ ê°™ì€ ë‹¤ì–‘í•œ GCP ì„œë¹„ìŠ¤ì—ì„œ ë¡œê·¸ë¥¼ **ìë™ìœ¼ë¡œ ìˆ˜ì§‘**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ Cloud Logging ì—ì´ì „íŠ¸ ë˜ëŠ” APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¨í”„ë ˆë¯¸ìŠ¤ ë˜ëŠ” ë‹¤ë¥¸ í´ë¼ìš°ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•´ì„œë„ Cloud Loggingì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì£¼ìš” ê¸°ëŠ¥:

* **ë¡œê·¸ ë°ì´í„° ì¤‘ì•™í™”:** ë‹¤ì–‘í•œ ì†ŒìŠ¤ì—ì„œ ë¡œê·¸ ë°ì´í„°ë¥¼ ì§‘ê³„í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ë° ì¸í”„ë¼ì˜ ì „ì²´ì ì¸ ìƒíƒœë¥¼ ì œê³µí•©ë‹ˆë‹¤.
* **ì‹¤ì‹œê°„ ë¡œê·¸ ê´€ë¦¬:** ì‹¤ì‹œê°„ìœ¼ë¡œ ë¡œê·¸ë¥¼ ìŠ¤íŠ¸ë¦¬ë°í•˜ì—¬ ì¦‰ê°ì ì¸ ë¶„ì„ ë° ëŒ€ì‘ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
* **ê°•ë ¥í•œ ë°ì´í„° ë¶„ì„:** ê³ ê¸‰ í•„í„°ë§ ë° ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ëŒ€ëŸ‰ì˜ ë¡œê·¸ ë°ì´í„°ë¥¼ ì‹ ì†í•˜ê²Œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **BigQueryì™€ì˜ í†µí•©:** ìì„¸í•œ ë¶„ì„ ë° ì¿¼ë¦¬ë¥¼ ìœ„í•´ ë¡œê·¸ë¥¼ BigQueryë¡œ ë‚´ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ë¡œê·¸ ê¸°ë°˜ ë©”íŠ¸ë¦­:** ë¡œê·¸ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ì ì •ì˜ ë©”íŠ¸ë¦­ì„ ìƒì„±í•˜ì—¬ ëª¨ë‹ˆí„°ë§ ë° ê²½ê³ ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¡œê·¸ íë¦„

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption><p><a href="https://betterstack.com/community/guides/logging/gcp-logging/">https://betterstack.com/community/guides/logging/gcp-logging/</a></p></figcaption></figure>

ê¸°ë³¸ì ìœ¼ë¡œ ì‹±í¬ì™€ ë¡œê·¸ ê¸°ë°˜ ë©”íŠ¸ë¦­ì€ ë¡œê·¸ë¥¼ ì €ì¥í•  ìœ„ì¹˜ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.

### GCP Loggingì—ì„œ ì§€ì›í•˜ëŠ” êµ¬ì„±

Cloud Loggingì€ ë‹¤ì–‘í•œ ìš´ì˜ ìš”êµ¬ì— ë§ê²Œ ë§¤ìš° êµ¬ì„± ê°€ëŠ¥í•©ë‹ˆë‹¤:

1. **ë¡œê·¸ ë²„í‚· (ì›¹ì—ì„œ ë¡œê·¸ ì €ì¥):** Cloud Loggingì—ì„œ ë¡œê·¸ ë³´ì¡´ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ë¡œê·¸ ë²„í‚·ì„ ì •ì˜í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¡œê·¸ í•­ëª©ì˜ ë³´ì¡´ ê¸°ê°„ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ê¸°ë³¸ì ìœ¼ë¡œ `_Default` ë° `_Required` ë²„í‚·ì´ ìƒì„±ë©ë‹ˆë‹¤ (í•˜ë‚˜ëŠ” ë‹¤ë¥¸ ê²ƒì„ ê¸°ë¡í•©ë‹ˆë‹¤).
*   **\_Required**ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
```
{% endcode %}
* ë°ì´í„°ì˜ **ë³´ì¡´ ê¸°ê°„**ì€ ë²„í‚·ë§ˆë‹¤ êµ¬ì„±ë˜ë©° **ìµœì†Œ 1ì¼ ì´ìƒ**ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **\_Requiredì˜ ë³´ì¡´ ê¸°ê°„ì€ 400ì¼**ì´ë©° ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
* ë¡œê·¸ ë²„í‚·ì€ **Cloud Storageì—ì„œ ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.**
2. **ë¡œê·¸ ì‹±í¬ (ì›¹ì—ì„œ ë¡œê·¸ ë¼ìš°í„°):** ë¡œê·¸ í•„í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¡œê·¸ í•­ëª©ì„ Pub/Sub, BigQuery ë˜ëŠ” Cloud Storageì™€ ê°™ì€ ë‹¤ì–‘í•œ ëŒ€ìƒìœ¼ë¡œ **ë‚´ë³´ë‚´ëŠ” ì‹±í¬**ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
* **ê¸°ë³¸ì ìœ¼ë¡œ** `_Default` ë° `_Required` ë²„í‚·ì— ëŒ€í•œ ì‹±í¬ê°€ ìƒì„±ë©ë‹ˆë‹¤:
* ```bash
_Required  logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Required  LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
_Default   logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Default   NOT LOG_ID("cloudaudit.googleapis.com/activity") AND NOT LOG_ID("externalaudit.googleapis.com/activity") AND NOT LOG_ID("cloudaudit.googleapis.com/system_event") AND NOT LOG_ID("externalaudit.googleapis.com/system_event") AND NOT LOG_ID("cloudaudit.googleapis.com/access_transparency") AND NOT LOG_ID("externalaudit.googleapis.com/access_transparency")
```
* **ì œì™¸ í•„í„°:** íŠ¹ì • ë¡œê·¸ í•­ëª©ì´ ìˆ˜ì§‘ë˜ì§€ ì•Šë„ë¡ **ì œì™¸ í•„í„°ë¥¼ ì„¤ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¹„ìš©ì„ ì ˆê°í•˜ê³  ë¶ˆí•„ìš”í•œ ë…¸ì´ì¦ˆë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. **ë¡œê·¸ ê¸°ë°˜ ë©”íŠ¸ë¦­:** ë¡œê·¸ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ **ì‚¬ìš©ì ì •ì˜ ë©”íŠ¸ë¦­**ì„ êµ¬ì„±í•˜ì—¬ ë¡œê·¸ ë°ì´í„°ì— ê¸°ë°˜í•œ ê²½ê³  ë° ëª¨ë‹ˆí„°ë§ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. **ë¡œê·¸ ë·°:** ë¡œê·¸ ë·°ëŠ” ë¡œê·¸ ë²„í‚· ë‚´ì—ì„œ ë¡œê·¸ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ê³ ê¸‰ ë° **ì„¸ë¶„í™”ëœ ì œì–´**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
* Cloud Loggingì€ ëª¨ë“  ë²„í‚·ì— ëŒ€í•´ ìë™ìœ¼ë¡œ `_AllLogs` ë·°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ ë·°ëŠ” ëª¨ë“  ë¡œê·¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. Cloud Loggingì€ `_Default` ë²„í‚·ì— ëŒ€í•œ `_Default` ë·°ë„ ìƒì„±í•©ë‹ˆë‹¤. `_Default` ë²„í‚·ì˜ `_Default` ë·°ëŠ” ë°ì´í„° ì•¡ì„¸ìŠ¤ ê°ì‚¬ ë¡œê·¸ë¥¼ ì œì™¸í•œ ëª¨ë“  ë¡œê·¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. `_AllLogs` ë° `_Default` ë·°ëŠ” í¸ì§‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

IAM ì •ì±…ì„ ì‚¬ìš©í•˜ì—¬ ì£¼ì²´ê°€ **íŠ¹ì • ë¡œê·¸ ë·°ë§Œ ì‚¬ìš©**í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
```json
{
"bindings": [
{
"members": [
"user:username@gmail.com"
],
"role": "roles/logging.viewAccessor",
"condition": {
"title": "Bucket reader condition example",
"description": "Grants logging.viewAccessor role to user username@gmail.com for the VIEW_ID log view.",
"expression":
"resource.name == \"projects/PROJECT_ID/locations/LOCATION/buckets/BUCKET_NAME/views/VIEW_ID\""
}
}
],
"etag": "BwWd_6eERR4=",
"version": 3
}
```
### ì—´ê±°

`gcloud` ëª…ë ¹ì¤„ ë„êµ¬ëŠ” GCP ìƒíƒœê³„ì˜ í•µì‹¬ ë¶€ë¶„ìœ¼ë¡œ, ë¦¬ì†ŒìŠ¤ì™€ ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ë‹¤ìŒì€ `gcloud`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê¹… êµ¬ì„±ê³¼ ì•¡ì„¸ìŠ¤ ë¡œê·¸ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
# List buckets
gcloud logging buckets list
gcloud logging buckets describe <bucket-name> --location <location>

# List log entries: only logs that contain log entries are listed.
gcloud logging logs list

# Get log metrics
gcloud logging metrics list
gcloud logging metrics describe <metric-name>

# Get log sinks
gcloud logging sinks list
gcloud logging sinks describe <sink-name>

# Get log views
gcloud logging views list --bucket <bucket> --location global
gcloud logging views describe --bucket <bucket> --location global <view-id> # view-id is usually the same as the bucket name

# Get log links
gcloud logging links list --bucket _Default --location global
gcloud logging links describe <link-id> --bucket _Default --location global
```
{% endcode %}

**`cloudresourcemanager`**ì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤ (ê¶Œí•œ BFì— ì‚¬ìš©ë¨): [https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512](https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512)

**`testIamPermissions`**ì˜ ë¡œê·¸ëŠ” ì—†ìŠµë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

### ì‚¬í›„ ì¹¨íˆ¬

{% content-ref url="../gcp-post-exploitation/gcp-logging-post-exploitation.md" %}
[gcp-logging-post-exploitation.md](../gcp-post-exploitation/gcp-logging-post-exploitation.md)
{% endcontent-ref %}

### ì§€ì†ì„±

{% content-ref url="../gcp-persistence/gcp-logging-persistence.md" %}
[gcp-logging-persistence.md](../gcp-persistence/gcp-logging-persistence.md)
{% endcontent-ref %}

## ì°¸ê³  ìë£Œ

* [https://cloud.google.com/logging/docs/logs-views#gcloud](https://cloud.google.com/logging/docs/logs-views#gcloud)
* [https://betterstack.com/community/guides/logging/gcp-logging/](https://betterstack.com/community/guides/logging/gcp-logging/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œì—ì„œ ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* HackTricksì—ì„œ **íšŒì‚¬ ê´‘ê³ ë¥¼ ë³´ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì¸ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ì„** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ ê¸°ë²•ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
