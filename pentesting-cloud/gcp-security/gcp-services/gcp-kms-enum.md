# GCP - KMS Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki Ã¶zel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## KMS

[**Cloud Key Management Service (Bulut Anahtar YÃ¶netimi Hizmeti)**](https://cloud.google.com/kms/docs/), **ÅŸifreleme ve hassas verilerin ÅŸifrelenmesi** gibi iÅŸlemler iÃ§in **ÅŸifreleme anahtarlarÄ±nÄ±n gÃ¼venli depolama alanÄ±** olarak hizmet verir. Bu anahtarlar, yapÄ±landÄ±rÄ±lmÄ±ÅŸ yÃ¶netim imkanÄ± saÄŸlayan anahtar halkalarÄ± iÃ§inde dÃ¼zenlenir. AyrÄ±ca, eriÅŸim kontrolÃ¼, izinlerin gÃ¼venlik gereksinimleriyle tam olarak uyumlu olmasÄ±nÄ± saÄŸlamak iÃ§in, bireysel anahtar dÃ¼zeyinde veya tÃ¼m anahtar halkasÄ± iÃ§in ayrÄ±ntÄ±lÄ± olarak yapÄ±landÄ±rÄ±labilir.

KMS anahtar halkalarÄ±, **varsayÄ±lan olarak kÃ¼resel olarak oluÅŸturulur**, bu da o anahtar halkasÄ±ndaki anahtarlarÄ±n herhangi bir bÃ¶lgeden eriÅŸilebilir olduÄŸu anlamÄ±na gelir. Bununla birlikte, belirli bÃ¶lgelerde **belirli anahtar halkalarÄ± oluÅŸturmak mÃ¼mkÃ¼ndÃ¼r**.

### Anahtar Koruma Seviyesi

* **YazÄ±lÄ±m anahtarlarÄ±**: YazÄ±lÄ±m anahtarlarÄ±, **tamamen yazÄ±lÄ±m aracÄ±lÄ±ÄŸÄ±yla KMS tarafÄ±ndan oluÅŸturulur ve yÃ¶netilir**. Bu anahtarlar, **herhangi bir donanÄ±m gÃ¼venlik modÃ¼lÃ¼ (HSM) tarafÄ±ndan korunmaz** ve **test ve geliÅŸtirme amaÃ§larÄ±** iÃ§in kullanÄ±labilir. YazÄ±lÄ±m anahtarlarÄ±, dÃ¼ÅŸÃ¼k gÃ¼venlik saÄŸladÄ±ÄŸÄ± ve saldÄ±rÄ±lara karÅŸÄ± hassas olduÄŸu iÃ§in **Ã¼retimde Ã¶nerilmez**.
* **Bulut barÄ±ndÄ±rÄ±lan anahtarlar**: Bulut barÄ±ndÄ±rÄ±lan anahtarlar, KMS tarafÄ±ndan bulutta **yÃ¼ksek kullanÄ±labilirlik ve gÃ¼venilir bir altyapÄ± kullanÄ±larak oluÅŸturulur ve yÃ¶netilir**. Bu anahtarlar, **HSM'ler tarafÄ±ndan korunur**, ancak HSM'ler **belirli bir mÃ¼ÅŸteriye Ã¶zel deÄŸildir**. Bulut barÄ±ndÄ±rÄ±lan anahtarlar, Ã§oÄŸu Ã¼retim kullanÄ±m durumu iÃ§in uygundur.
* **Harici anahtarlar**: Harici anahtarlar, KMS dÄ±ÅŸÄ±nda **oluÅŸturulur ve yÃ¶netilir** ve ÅŸifreleme iÅŸlemlerinde kullanÄ±lmak Ã¼zere KMS'ye aktarÄ±lÄ±r. Harici anahtarlar, mÃ¼ÅŸterinin tercihine baÄŸlÄ± olarak **bir donanÄ±m gÃ¼venlik modÃ¼lÃ¼nde (HSM) veya bir yazÄ±lÄ±m kitaplÄ±ÄŸÄ±nda** saklanabilir.

### Anahtar AmaÃ§larÄ±

* **Simetrik ÅŸifreleme/ÅŸifre Ã§Ã¶zme**: Hem ÅŸifreleme hem de ÅŸifre Ã§Ã¶zme iÅŸlemleri iÃ§in **tek bir anahtar kullanÄ±larak verilerin ÅŸifrelenmesi ve ÅŸifre Ã§Ã¶zÃ¼lmesi** iÃ§in kullanÄ±lÄ±r. Simetrik anahtarlar, bÃ¼yÃ¼k veri hacimlerinin ÅŸifrelenmesi ve ÅŸifre Ã§Ã¶zÃ¼lmesi iÃ§in hÄ±zlÄ± ve verimlidir.
* **Desteklenen**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Asimetrik Ä°mzalama**: Anahtar paylaÅŸÄ±mÄ± olmadan iki taraf arasÄ±nda gÃ¼venli iletiÅŸim iÃ§in kullanÄ±lÄ±r. Asimetrik anahtarlar, bir **genel anahtar ve bir Ã¶zel anahtar** Ã§iftinden oluÅŸur. Genel anahtar baÅŸkalarÄ±yla paylaÅŸÄ±lÄ±rken, Ã¶zel anahtar gizli tutulur.
* **Desteklenen**: [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Asimetrik Åifre Ã‡Ã¶zme**: Bir ileti veya verinin doÄŸruluÄŸunu doÄŸrulamak iÃ§in kullanÄ±lÄ±r. Bir dijital imza, bir Ã¶zel anahtar kullanÄ±larak oluÅŸturulur ve karÅŸÄ±lÄ±k gelen genel anahtar kullanÄ±larak doÄŸrulanabilir.
* **Desteklenen**: [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **MAC Ä°mzalama**: Bir gizli anahtar kullanÄ±larak **veri bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ ve doÄŸruluÄŸunu saÄŸlamak iÃ§in bir mesaj kimlik doÄŸrulama kodu (MAC) oluÅŸturulmasÄ±** iÃ§in kullanÄ±lÄ±r. HMAC, aÄŸ protokollerinde ve yazÄ±lÄ±m uygulamalarÄ±nda mesaj kimlik doÄŸrulamasÄ± iÃ§in yaygÄ±n olarak kullanÄ±lÄ±r.
* **Desteklenen**: [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### DÃ¶nÃ¼ÅŸÃ¼m SÃ¼resi ve ProgramlanmÄ±ÅŸ Yok Etme SÃ¼resi

**VarsayÄ±lan olarak**, her **90 gÃ¼n** ancak **kolayca** ve **tamamen Ã¶zelleÅŸtirilebilir**.

"ProgramlanmÄ±ÅŸ yok etme" sÃ¼resi, kullanÄ±cÄ±nÄ±n anahtarÄ± **silme talep ettiÄŸi andan** anahtarÄ±n **silindiÄŸi ana kadar geÃ§en sÃ¼redir**. Anahtar oluÅŸturulduktan sonra deÄŸiÅŸtirilemez (varsayÄ±lan 1 gÃ¼n).

### Birincil SÃ¼rÃ¼m

Her KMS anahtarÄ±nÄ±n birden fazla sÃ¼rÃ¼mÃ¼ olabilir, bunlardan biri **varsayÄ±lan** olmalÄ±dÄ±r, bu, KMS anahtarÄ±yla etkileÅŸimde **sÃ¼rÃ¼m belirtilmediÄŸinde kullanÄ±lacak olan sÃ¼rÃ¼m** olacaktÄ±r.

### NumaralandÄ±rma

**AnahtarlarÄ± listeleme izinlerine sahipseniz**, bunlara nasÄ±l eriÅŸebileceÄŸinizi aÅŸaÄŸÄ±daki gibi yapabilirsiniz:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Yetki YÃ¼kseltme

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### SaldÄ±rÄ± SonrasÄ±

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
