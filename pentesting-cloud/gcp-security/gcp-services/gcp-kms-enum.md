# GCP - KMS Enum

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** me na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## KMS

[**Cloud Key Management Service**](https://cloud.google.com/kms/docs/) slu쬴 kao sigurno skladi코te za **kriptografske klju캜eve**, koji su neophodni za operacije kao 코to su **코ifrovanje i de코ifrovanje osetljivih podataka**. Ovi klju캜evi su organizovani unutar prstenova klju캜eva, 코to omogu캖ava strukturirano upravljanje. Osim toga, kontrola pristupa mo쬰 biti pa쬷jivo konfigurisana, ili na nivou pojedina캜nog klju캜a ili za ceo prsten klju캜eva, obezbe캠uju캖i da dozvole budu precizno uskla캠ene sa sigurnosnim zahtevima.

KMS prstenovi klju캜eva su **podrazumevano kreirani kao globalni**, 코to zna캜i da su klju캜evi unutar tog prstena klju캜eva dostupni iz bilo koje regije. Me캠utim, mogu캖e je kreirati specifi캜ne prstenove klju캜eva u **specifi캜nim regionima**.

### Nivo za코tite klju캜eva

* **Softverski klju캜evi**: Softverski klju캜evi su **kreirani i upravljani od strane KMS-a isklju캜ivo u softveru**. Ovi klju캜evi **nisu za코ti캖eni hardverskim sigurnosnim modulom (HSM)** i mogu se koristiti u svrhe **testiranja i razvoja**. Softverski klju캜evi se **ne preporu캜uju za produkciju** jer pru쬬ju nisku sigurnost i podlo쬹i su napadima.
* **Klju캜evi sme코teni u oblaku**: Klju캜evi sme코teni u oblaku su **kreirani i upravljani od strane KMS-a** u oblaku koriste캖i visoko dostupnu i pouzdanu infrastrukturu. Ovi klju캜evi su **za코ti캖eni HSM-ovima**, ali HSM-ovi **nisu posve캖eni odre캠enom korisniku**. Klju캜evi sme코teni u oblaku su pogodni za ve캖inu slu캜ajeva upotrebe u produkciji.
* **Spoljni klju캜evi**: Spoljni klju캜evi su **kreirani i upravljani van KMS-a**, i uvoze se u KMS radi kori코캖enja u kriptografskim operacijama. Spoljni klju캜evi **mogu biti sme코teni u hardverskom sigurnosnom modulu (HSM) ili softverskoj biblioteci, u zavisnosti od preferencija korisnika**.

### Namene klju캜eva

* **Simetri캜no 코ifrovanje/de코ifrovanje**: Koristi se za **코ifrovanje i de코ifrovanje podataka kori코캖enjem jednog klju캜a za obe operacije**. Simetri캜ni klju캜evi su brzi i efikasni za 코ifrovanje i de코ifrovanje velikih koli캜ina podataka.
* **Podr쬬no**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Asimetri캜no potpisivanje**: Koristi se za sigurnu komunikaciju izme캠u dve strane bez deljenja klju캜a. Asimetri캜ni klju캜evi dolaze u paru, sastoje se od **javno dostupnog klju캜a i privatnog klju캜a**. Javni klju캜 se deli sa drugima, dok se privatni klju캜 캜uva tajnim.
* **Podr쬬no**: [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Asimetri캜no de코ifrovanje**: Koristi se za proveru autenti캜nosti poruke ili podataka. Digitalni potpis se kreira kori코캖enjem privatnog klju캜a i mo쬰 se proveriti kori코캖enjem odgovaraju캖eg javnog klju캜a.
* **Podr쬬no**: [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Potpisivanje MAC-om**: Koristi se za obezbe캠ivanje **integriteta i autenti캜nosti podataka kori코캖enjem tajnog klju캜a za kreiranje koda za autentifikaciju poruke (MAC)**. HMAC se 캜esto koristi za autentifikaciju poruka u mre쬹im protokolima i softverskim aplikacijama.
* **Podr쬬no**: [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### Period rotacije i period programiran za uni코tenje

Podrazumevano, svakih **90 dana**, ali se mo쬰 **lako** i **potpuno prilagoditi**.

Period "Programiran za uni코tenje" je **vreme od trenutka kada korisnik zatra쬴 brisanje klju캜a** do trenutka kada klju캜 bude **obrisan**. Nakon 코to je klju캜 kreiran, ovo vreme se ne mo쬰 promeniti (podrazumevano 1 dan).

### Primarna verzija

Svaki KMS klju캜 mo쬰 imati nekoliko verzija, od kojih jedna mora biti **podrazumevana**, ova 캖e se koristiti kada **verzija nije navedena prilikom interakcije sa KMS klju캜em**.

### Enumeracija

Ako imate **dozvole za listanje klju캜eva**, ovako mo쬰te pristupiti njima:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Eskalacija privilegija

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Post eksploatacija

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Reference

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
