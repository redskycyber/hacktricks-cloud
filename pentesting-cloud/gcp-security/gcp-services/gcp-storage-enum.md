# GCP - å­˜å‚¨æšä¸¾

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## å­˜å‚¨

Google Cloud Platform (GCP) å­˜å‚¨æ˜¯ä¸€ç§**åŸºäºäº‘çš„å­˜å‚¨è§£å†³æ–¹æ¡ˆ**ï¼Œä¸ºéç»“æ„åŒ–æ•°æ®æä¾›é«˜åº¦è€ç”¨å’Œå¯ç”¨çš„å¯¹è±¡å­˜å‚¨ã€‚å®ƒæä¾›åŸºäºæ€§èƒ½ã€å¯ç”¨æ€§å’Œæˆæœ¬çš„**å¤šç§å­˜å‚¨ç±»åˆ«**ï¼ŒåŒ…æ‹¬æ ‡å‡†å‹ã€è¿‘çº¿å‹ã€å†·çº¿å‹å’Œå½’æ¡£å‹ã€‚GCPå­˜å‚¨è¿˜æä¾›é«˜çº§åŠŸèƒ½ï¼Œå¦‚**ç”Ÿå‘½å‘¨æœŸç­–ç•¥ã€ç‰ˆæœ¬æ§åˆ¶å’Œè®¿é—®æ§åˆ¶**ï¼Œä»¥æœ‰æ•ˆç®¡ç†å’Œä¿æŠ¤æ•°æ®ã€‚

å­˜å‚¨æ¡¶å¯ä»¥å­˜å‚¨åœ¨ä¸€ä¸ªåŒºåŸŸã€ä¸¤ä¸ªåŒºåŸŸæˆ–**å¤šåŒºåŸŸï¼ˆé»˜è®¤ï¼‰**ã€‚

### å­˜å‚¨ç±»å‹

* **æ ‡å‡†å­˜å‚¨**ï¼šè¿™æ˜¯é»˜è®¤çš„å­˜å‚¨é€‰é¡¹ï¼Œ**æä¾›å¯¹é¢‘ç¹è®¿é—®æ•°æ®çš„é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿè®¿é—®**ã€‚é€‚ç”¨äºå¹¿æ³›çš„ç”¨ä¾‹ï¼ŒåŒ…æ‹¬æä¾›ç½‘ç«™å†…å®¹ã€æµåª’ä½“å’Œæ‰˜ç®¡æ•°æ®åˆ†æç®¡é“ã€‚
* **è¿‘çº¿å­˜å‚¨**ï¼šè¿™ä¸ªå­˜å‚¨ç±»æä¾›**è¾ƒä½çš„å­˜å‚¨æˆæœ¬**å’Œ**ç•¥é«˜çš„è®¿é—®æˆæœ¬**ã€‚å®ƒé’ˆå¯¹ä¸å¸¸è®¿é—®çš„æ•°æ®è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæœ€çŸ­å­˜å‚¨æœŸé™ä¸º30å¤©ã€‚å®ƒéå¸¸é€‚åˆå¤‡ä»½å’Œå­˜æ¡£ç›®çš„ã€‚
* **å†·çº¿å­˜å‚¨**ï¼šè¿™ä¸ªå­˜å‚¨ç±»é’ˆå¯¹**é•¿æœŸå­˜å‚¨ä¸å¸¸è®¿é—®çš„æ•°æ®**è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæœ€çŸ­å­˜å‚¨æœŸé™ä¸º90å¤©ã€‚å®ƒæä¾›æ¯”è¿‘çº¿å­˜å‚¨**æ›´ä½çš„å­˜å‚¨æˆæœ¬**ï¼Œä½†**è®¿é—®æˆæœ¬æ›´é«˜**ã€‚
* **å½’æ¡£å­˜å‚¨**ï¼šè¿™ä¸ªå­˜å‚¨ç±»ä¸“ä¸º**éå¸¸ä¸å¸¸è®¿é—®çš„å†·æ•°æ®**è®¾è®¡ï¼Œæœ€çŸ­å­˜å‚¨æœŸé™ä¸º365å¤©ã€‚å®ƒæä¾›äº†æ‰€æœ‰GCPå­˜å‚¨é€‰é¡¹ä¸­**æœ€ä½çš„å­˜å‚¨æˆæœ¬**ï¼Œä½†**è®¿é—®æˆæœ¬æœ€é«˜**ã€‚å®ƒé€‚ç”¨äºéœ€è¦å› åˆè§„æˆ–ç›‘ç®¡åŸå› è€Œé•¿æœŸä¿ç•™çš„æ•°æ®ã€‚
* **è‡ªåŠ¨åˆ†ç±»**ï¼šå¦‚æœæ‚¨**ä¸çŸ¥é“å°†è¦è®¿é—®æ•°æ®çš„é¢‘ç‡**ï¼Œå¯ä»¥é€‰æ‹©è‡ªåŠ¨åˆ†ç±»ï¼ŒGCPå°†**è‡ªåŠ¨ä¸ºæ‚¨æ›´æ”¹å­˜å‚¨ç±»å‹ä»¥æœ€å°åŒ–æˆæœ¬**ã€‚

### è®¿é—®æ§åˆ¶

**é»˜è®¤æƒ…å†µä¸‹**ï¼Œå»ºè®®é€šè¿‡**IAM**æ§åˆ¶è®¿é—®ï¼Œä½†ä¹Ÿå¯ä»¥**å¯ç”¨ACLsçš„ä½¿ç”¨**ã€‚\
å¦‚æœæ‚¨é€‰æ‹©ä»…ä½¿ç”¨IAMï¼ˆé»˜è®¤ï¼‰ï¼Œå¹¶ä¸”**è¿‡å»äº†90å¤©**ï¼Œæ‚¨**å°†æ— æ³•ä¸ºå­˜å‚¨æ¡¶å¯ç”¨ACLs**ã€‚

### ç‰ˆæœ¬æ§åˆ¶

å¯ä»¥å¯ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼Œè¿™å°†**åœ¨å­˜å‚¨æ¡¶å†…ä¿å­˜æ–‡ä»¶çš„æ—§ç‰ˆæœ¬**ã€‚å¯ä»¥é…ç½®**æ‚¨æƒ³è¦ä¿ç•™çš„ç‰ˆæœ¬æ•°é‡**ï¼Œç”šè‡³**éå½“å‰ç‰ˆæœ¬ï¼ˆæ—§ç‰ˆæœ¬ï¼‰çš„å­˜æ´»æ—¶é—´**ã€‚å»ºè®®**æ ‡å‡†ç±»å‹ä¸º7å¤©**ã€‚

**éå½“å‰ç‰ˆæœ¬çš„å…ƒæ•°æ®è¢«ä¿ç•™**ã€‚æ­¤å¤–ï¼Œ**éå½“å‰ç‰ˆæœ¬çš„ACLsä¹Ÿè¢«ä¿ç•™**ï¼Œå› æ­¤æ—§ç‰ˆæœ¬å¯èƒ½å…·æœ‰ä¸å½“å‰ç‰ˆæœ¬ä¸åŒçš„ACLsã€‚

åœ¨[**æ–‡æ¡£**](https://cloud.google.com/storage/docs/object-versioning)ä¸­äº†è§£æ›´å¤šã€‚

### ä¿ç•™ç­–ç•¥

æŒ‡æ˜æ‚¨å¸Œæœ›**ç¦æ­¢åœ¨å­˜å‚¨æ¡¶å†…åˆ é™¤å¯¹è±¡çš„æ—¶é—´é•¿åº¦**ï¼ˆè‡³å°‘å¯¹äºåˆè§„æ€§éå¸¸æœ‰ç”¨ï¼‰ã€‚\
**ç‰ˆæœ¬æ§åˆ¶æˆ–ä¿ç•™ç­–ç•¥åªèƒ½åŒæ—¶å¯ç”¨ä¸€ä¸ª**ã€‚

### åŠ å¯†

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹è±¡ä½¿ç”¨Googleç®¡ç†çš„å¯†é’¥è¿›è¡Œ**åŠ å¯†**ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨**æ¥è‡ªKMSçš„å¯†é’¥**ã€‚

### å…¬å…±è®¿é—®

å¯ä»¥ç»™**å¤–éƒ¨ç”¨æˆ·**ï¼ˆæ— è®ºæ˜¯å¦ç™»å½•GCPï¼‰**è®¿é—®å­˜å‚¨æ¡¶å†…å®¹**ã€‚\
é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºå­˜å‚¨æ¡¶æ—¶ï¼Œå°†**ç¦ç”¨å…¬å¼€æš´éœ²å­˜å‚¨æ¡¶çš„é€‰é¡¹**ï¼Œä½†å¦‚æœæœ‰è¶³å¤Ÿçš„æƒé™ï¼Œå¯ä»¥æ›´æ”¹æ­¤è®¾ç½®ã€‚

è®¿é—®å­˜å‚¨æ¡¶çš„**URLæ ¼å¼**ä¸º **`https://storage.googleapis.com/<bucket-name>` æˆ– `https://<bucket_name>.storage.googleapis.com`**ï¼ˆä¸¤è€…éƒ½æœ‰æ•ˆï¼‰ã€‚

### HMACå¯†é’¥

HMACå¯†é’¥æ˜¯ä¸€ç§_å‡­è¯_ç±»å‹ï¼Œå¯ä»¥**ä¸Cloud Storageä¸­çš„æœåŠ¡è´¦æˆ·æˆ–ç”¨æˆ·è´¦æˆ·å…³è”**ã€‚æ‚¨ä½¿ç”¨HMACå¯†é’¥åˆ›å»º_ç­¾å_ï¼Œç„¶åå°†å…¶åŒ…å«åœ¨å¯¹Cloud Storageçš„è¯·æ±‚ä¸­ã€‚ç­¾åè¡¨æ˜**ç»™å®šè¯·æ±‚ç”±ç”¨æˆ·æˆ–æœåŠ¡è´¦æˆ·æˆæƒ**ã€‚

HMACå¯†é’¥æœ‰ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼Œä¸€ä¸ª_è®¿é—®ID_å’Œä¸€ä¸ª_å¯†é’¥_ã€‚

*   **è®¿é—®ID**ï¼šä¸ç‰¹å®šæœåŠ¡æˆ–ç”¨æˆ·è´¦æˆ·å…³è”çš„å­—æ¯æ•°å­—å­—ç¬¦ä¸²ã€‚å½“é“¾æ¥åˆ°æœåŠ¡è´¦æˆ·æ—¶ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä¸º61ä¸ªå­—ç¬¦ï¼Œå½“é“¾æ¥åˆ°ç”¨æˆ·è´¦æˆ·æ—¶ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä¸º24ä¸ªå­—ç¬¦ã€‚ä»¥ä¸‹æ˜¯è®¿é—®IDçš„ä¸€ä¸ªç¤ºä¾‹ï¼š

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **å¯†é’¥**ï¼šä¸€ä¸ª40å­—ç¬¦çš„Base-64ç¼–ç å­—ç¬¦ä¸²ï¼Œä¸ç‰¹å®šçš„è®¿é—®IDå…³è”ã€‚å¯†é’¥æ˜¯ä¸€ä¸ªé¢„å…±äº«å¯†é’¥ï¼Œåªæœ‰æ‚¨å’ŒCloud StorageçŸ¥é“ã€‚æ‚¨ä½¿ç”¨æ‚¨çš„å¯†é’¥ä½œä¸ºè®¤è¯è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†æ¥åˆ›å»ºç­¾åã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¯†é’¥çš„ç¤ºä¾‹ï¼š

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

**è®¿é—®IDå’Œå¯†é’¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªHMACå¯†é’¥**ï¼Œä½†å¯†é’¥æ˜¯æ›´æ•æ„Ÿçš„ä¿¡æ¯ï¼Œå› ä¸ºå®ƒç”¨äº**åˆ›å»ºç­¾å**ã€‚

### æšä¸¾
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list
```
å¦‚æœåœ¨åˆ—å‡ºå­˜å‚¨æ¡¶æ—¶é‡åˆ°æƒé™æ‹’ç»é”™è¯¯ï¼Œæ‚¨å¯èƒ½ä»ç„¶å¯ä»¥è®¿é—®å†…å®¹ã€‚å› æ­¤ï¼Œç°åœ¨æ‚¨çŸ¥é“äº†å­˜å‚¨æ¡¶çš„å‘½åè§„åˆ™ï¼Œæ‚¨å¯ä»¥ç”Ÿæˆä¸€ç³»åˆ—å¯èƒ½çš„åç§°å¹¶å°è¯•è®¿é—®å®ƒä»¬ï¼š
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
### æƒé™æå‡

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨å­˜å‚¨æƒé™æ¥æå‡æƒé™**ï¼š

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### æœªç»è®¤è¯çš„æšä¸¾

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### åæœŸåˆ©ç”¨

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### æŒä¹…æ€§

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF ç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
