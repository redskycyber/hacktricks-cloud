# GCP - Wyliczanie magazynu

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>

## Magazyn

Google Cloud Platform (GCP) Storage to **rozwizanie magazynowania w chmurze**, kt贸re zapewnia wysok trwao i dostpno magazynu obiektowego dla danych bez struktury. Oferuje **r贸偶ne klasy magazynowania** oparte na wydajnoci, dostpnoci i kosztach, w tym Standard, Nearline, Coldline i Archive. GCP Storage zapewnia r贸wnie偶 zaawansowane funkcje, takie jak **polityki cyklu 偶ycia, wersjonowanie i kontrola dostpu**, umo偶liwiajce skuteczne zarzdzanie i zabezpieczanie danych.

Kubeek mo偶e by przechowywany w regionie, w 2 regionach lub **w wielu regionach (domylnie)**.

### Rodzaje magazynu

* **Standardowe magazynowanie**: Jest to domylna opcja magazynowania, kt贸ra **oferuje wysok wydajno i niski czas dostpu do czsto u偶ywanych danych**. Nadaje si do szerokiego zakresu zastosowa, w tym do udostpniania treci witryny, strumieniowania multimedi贸w i hostowania potok贸w analizy danych.
* **Magazynowanie Nearline**: Ta klasa magazynowania oferuje **ni偶sze koszty magazynowania** i **nieco wy偶sze koszty dostpu** ni偶 Standardowe magazynowanie. Jest zoptymalizowana dla danych u偶ywanych rzadko, z minimalnym czasem przechowywania wynoszcym 30 dni. Nadaje si do cel贸w tworzenia kopii zapasowych i archiwizacji.
* **Magazynowanie Coldline**: Ta klasa magazynowania jest zoptymalizowana dla **dugoterminowego przechowywania danych u偶ywanych rzadko**, z minimalnym czasem przechowywania wynoszcym 90 dni. Oferuje **ni偶sze koszty magazynowania** ni偶 Magazynowanie Nearline, ale z **wy偶szymi kosztami dostpu**.
* **Magazynowanie Archive**: Ta klasa magazynowania jest przeznaczona dla zimnych danych, kt贸re s **bardzo rzadko u偶ywane**, z minimalnym czasem przechowywania wynoszcym 365 dni. Oferuje **najni偶sze koszty magazynowania spor贸d wszystkich opcji magazynowania GCP**, ale z **najwy偶szymi kosztami dostpu**. Nadaje si do dugoterminowego przechowywania danych, kt贸re musz by przechowywane ze wzgld贸w zgodnoci lub regulacyjnych.
* **Autoklasa**: Jeli **nie wiesz, jak czsto bdziesz korzysta** z danych, mo偶esz wybra Autoklas, a GCP **automatycznie zmieni rodzaj magazynu, aby zminimalizowa koszty**.

### Kontrola dostpu

Domylnie **zaleca si** kontrolowanie dostpu za pomoc **IAM**, ale mo偶na r贸wnie偶 **wczy korzystanie z list ACL**.\
Jeli wybierzesz korzystanie tylko z IAM (domylnie) i **upynie 90 dni**, nie bdziesz m贸g wczy list ACL dla kubeka.

### Wersjonowanie

Mo偶liwe jest wczenie wersjonowania, co spowoduje **zapisanie starych wersji plik贸w wewntrz kubeka**. Mo偶na skonfigurowa **liczb wersji, kt贸re chcesz zachowa**, a nawet **jak dugo** chcesz, aby **nieaktualne** wersje (stare wersje) byy przechowywane. Zalecane jest **7 dni dla typu Standard**.

**Metadane nieaktualnej wersji s przechowywane**. Ponadto, **listy ACL nieaktualnych wersji s r贸wnie偶 przechowywane**, wic starsze wersje mog mie inne listy ACL ni偶 bie偶ca wersja.

Dowiedz si wicej w [**dokumentacji**](https://cloud.google.com/storage/docs/object-versioning).

### Polityka retencji

Okrel, jak **dugo** chcesz **zabroni usuwanie obiekt贸w wewntrz kubeka** (bardzo przydatne przynajmniej dla cel贸w zgodnoci).\
Tylko jedno z **wersjonowania lub polityki retencji mo偶e by wczone w tym samym czasie**.

### Szyfrowanie

Domylnie obiekty s **szyfrowane za pomoc zarzdzanych przez Google kluczy**, ale mo偶na r贸wnie偶 u偶y **klucza z KMS**.

### Publiczny dostp

Mo偶liwe jest udostpnienie **zewntrznym u偶ytkownikom** (zalogowanym do GCP lub nie) **dostpu do zawartoci kubeka**. \
Domylnie, po utworzeniu kubeka, opcja publicznego udostpniania kubeka bdzie **wyczona**, ale z wystarczajcymi uprawnieniami mo偶na j zmieni.

**Format URL** do dostpu do kubeka to **`https://storage.googleapis.com/<nazwa-kubeka>` lub `https://<nazwa-kubeka>.storage.googleapis.com`** (oba s poprawne).

### Klucze HMAC

Klucz HMAC to rodzaj _powiadczenia_ i mo偶e by **powizany z kontem usugi lub kontem u偶ytkownika w Cloud Storage**. U偶ywasz klucza HMAC do tworzenia _podpis贸w_, kt贸re s nastpnie doczane do 偶da do Cloud Storage. Podpisy pokazuj, 偶e **dane 偶danie jest autoryzowane przez u偶ytkownika lub konto usugi**.

Klucze HMAC maj dwie podstawowe czci: _identyfikator dostpu_ i _sekret_.

*   **Identyfikator dostpu**: Alfanumeryczny cig powizany z okrelonym kontem usugi lub u偶ytkownika. Gdy jest powizany z kontem usugi, cig ma dugo 61 znak贸w, a gdy jest powizany z kontem u偶ytkownika, cig ma dugo 24 znak贸w. Poni偶ej przedstawiono przykad identyfikatora dostpu:

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **Sekret**: 40-znakowy cig zakodowany w Base-64, kt贸ry jest powizany z okrelonym identyfikatorem dostpu. Sekret to klucz wczeniej udostpniony, kt贸ry znaj tylko ty i Cloud Storage. U偶ywasz swojego sekretu do tworzenia podpis贸w w ramach procesu uwierzytelniania. Poni偶ej przedstawiono przykad sekretu:

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

Zar贸wno **identyfikator dostpu, jak i sekret jednoznacznie identyfikuj klucz HMAC**, ale sekret jest znacznie bardziej poufn informacj, poniewa偶 jest u偶ywany do **tworzenia podpis贸w**.

### Wyliczanie
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list
```
Jeli otrzymasz bd o odmowie dostpu podczas wywietlania kubek贸w, mo偶esz nadal mie dostp do ich zawartoci. Teraz, gdy znasz konwencj nazewnictwa kubek贸w, mo偶esz wygenerowa list mo偶liwych nazw i spr贸bowa uzyska do nich dostp:
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
### Eskalacja uprawnie

Na nastpnej stronie mo偶esz sprawdzi, jak **wykorzysta uprawnienia do przechowywania danych w celu eskalacji uprawnie**:

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### Enumeracja bez uwierzytelnienia

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### Po eksploatacji

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### Trwao

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
