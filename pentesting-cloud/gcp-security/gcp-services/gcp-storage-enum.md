# GCP - Depolama Enum

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nleri**]'ni edinin (https://peass.creator-spring.com)
* [**The PEASS Family**]'yi keÅŸfedin (https://opensea.io/collection/the-peass-family), Ã¶zel [**NFT'lerimiz**]'in bulunduÄŸu koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **Twitter** ğŸ¦ [**@carlospolopm**]'i takip edin (https://twitter.com/carlospolopm)**.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**]'e (https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**]'a (https://github.com/carlospolop/hacktricks-cloud) destek olun.

</details>

## Depolama

Google Cloud Platform (GCP) Depolama, yapÄ±landÄ±rÄ±lmamÄ±ÅŸ veriler iÃ§in **yÃ¼ksek dayanÄ±klÄ±lÄ±k ve kullanÄ±labilirlik saÄŸlayan bulut tabanlÄ± bir depolama Ã§Ã¶zÃ¼mÃ¼** sunar. Performans, kullanÄ±labilirlik ve maliyet temelinde **Ã§eÅŸitli depolama sÄ±nÄ±flarÄ±** sunar; Bunlar arasÄ±nda Standart, Nearline, Coldline ve Archive bulunmaktadÄ±r. GCP Depolama ayrÄ±ca **yaÅŸam dÃ¶ngÃ¼sÃ¼ politikalarÄ±, sÃ¼rÃ¼mleme ve eriÅŸim kontrolÃ¼** gibi geliÅŸmiÅŸ Ã¶zellikler sunarak verileri etkili bir ÅŸekilde yÃ¶netmeyi ve gÃ¼vence altÄ±na almayÄ± saÄŸlar.

Kova bir bÃ¶lgede, 2 bÃ¶lgede veya **Ã§oklu bÃ¶lgede (varsayÄ±lan olarak)** saklanabilir.

### Depolama TÃ¼rleri

* **Standart Depolama**: Bu, sÄ±k eriÅŸilen verilere **yÃ¼ksek performanslÄ±, dÃ¼ÅŸÃ¼k gecikmeli eriÅŸim** sunan varsayÄ±lan depolama seÃ§eneÄŸidir. Web sitesi iÃ§eriÄŸi sunma, medya akÄ±ÅŸÄ± ve veri analitiÄŸi boru hatlarÄ±nÄ± barÄ±ndÄ±rma gibi geniÅŸ bir kullanÄ±m alanÄ± iÃ§in uygundur.
* **Nearline Depolama**: Bu depolama sÄ±nÄ±fÄ±, Standart Depolamadan **daha dÃ¼ÅŸÃ¼k depolama maliyetleri** ve **biraz daha yÃ¼ksek eriÅŸim maliyetleri** sunar. En az 30 gÃ¼n depolama sÃ¼resine sahip olan nadiren eriÅŸilen veriler iÃ§in optimize edilmiÅŸtir. Yedekleme ve arÅŸivleme amaÃ§larÄ± iÃ§in idealdir.
* **Coldline Depolama**: Bu depolama sÄ±nÄ±fÄ±, **nadir eriÅŸilen verilerin uzun vadeli depolanmasÄ±** iÃ§in optimize edilmiÅŸtir ve en az 90 gÃ¼n depolama sÃ¼resine sahiptir. Nearline Depolamadan daha **dÃ¼ÅŸÃ¼k depolama maliyetleri** sunar, ancak **daha yÃ¼ksek eriÅŸim maliyetleriyle**.
* **Archive Depolama**: Bu depolama sÄ±nÄ±fÄ±, **Ã§ok nadiren eriÅŸilen soÄŸuk veriler** iÃ§in tasarlanmÄ±ÅŸ olup en az 365 gÃ¼n depolama sÃ¼resine sahiptir. TÃ¼m GCP depolama seÃ§eneklerinin **en dÃ¼ÅŸÃ¼k depolama maliyetlerini** sunar, ancak **en yÃ¼ksek eriÅŸim maliyetleriyle**. Uzun vadeli saklanmasÄ± gereken uyumluluk veya dÃ¼zenleyici nedenlerle veriler iÃ§in uygundur.
* **Otomatik SÄ±nÄ±f**: Verilere **ne kadar eriÅŸeceÄŸinizi bilmiyorsanÄ±z** Otomatik SÄ±nÄ±fÄ± seÃ§ebilir ve GCP, maliyetleri en aza indirmek iÃ§in **otomatik olarak depolama tÃ¼rÃ¼nÃ¼ deÄŸiÅŸtirir**.

### EriÅŸim KontrolÃ¼

VarsayÄ±lan olarak, eriÅŸimi **IAM** aracÄ±lÄ±ÄŸÄ±yla kontrol etmek **tavsiye edilir**, ancak **ACL'lerin kullanÄ±mÄ±nÄ± etkinleÅŸtirmek** de mÃ¼mkÃ¼ndÃ¼r.\
Sadece IAM'Ä± (varsayÄ±lan) kullanmayÄ± seÃ§erseniz ve **90 gÃ¼n geÃ§erse**, kovaya **ACL'leri etkinleÅŸtiremezsiniz**.

### SÃ¼rÃ¼mleme

SÃ¼rÃ¼mleme etkinleÅŸtirilebilir, bu **dosyanÄ±n eski sÃ¼rÃ¼mlerini kovada saklar**. **Saklamak istediÄŸiniz sÃ¼rÃ¼m sayÄ±sÄ±nÄ±** ve hatta **eski sÃ¼rÃ¼mlerin (eski sÃ¼rÃ¼mler) ne kadar sÃ¼reyle yaÅŸamasÄ±nÄ± istediÄŸinizi** yapÄ±landÄ±rabilirsiniz. Ã–nerilen **Standart tÃ¼r iÃ§in 7 gÃ¼n**'dÃ¼r.

**Eski sÃ¼rÃ¼mÃ¼n metadatasÄ± saklanÄ±r**. DahasÄ±, **eski sÃ¼rÃ¼mlerin ACL'leri de saklanÄ±r**, bu nedenle eski sÃ¼rÃ¼mler mevcut sÃ¼rÃ¼mden farklÄ± ACL'lere sahip olabilir.

Daha fazlasÄ±nÄ± [**belgelerde**](https://cloud.google.com/storage/docs/object-versioning) Ã¶ÄŸrenin.

### Saklama PolitikasÄ±

Kovadaki Nesnelerin **silinmesini yasaklamak istediÄŸiniz sÃ¼reyi** belirtin (en azÄ±ndan uyumluluk iÃ§in Ã§ok yararlÄ±).\
**SÃ¼rÃ¼mleme veya saklama politikasÄ±ndan yalnÄ±zca biri aynÄ± anda etkin olabilir**.

### Åifreleme

VarsayÄ±lan olarak nesneler **Google tarafÄ±ndan yÃ¶netilen anahtarlar kullanÄ±larak ÅŸifrelenir**, ancak ayrÄ±ca bir **KMS anahtarÄ±** da kullanabilirsiniz.

### Genel EriÅŸim

**Harici kullanÄ±cÄ±lara** (GCP'de oturum aÃ§mÄ±ÅŸ veya aÃ§mamÄ±ÅŸ) **kova iÃ§eriÄŸine eriÅŸim vermek mÃ¼mkÃ¼ndÃ¼r**. \
Bir kova oluÅŸturulduÄŸunda, kovanÄ±n **genel olarak aÃ§Ä±ÄŸa Ã§Ä±karÄ±lmasÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rakma seÃ§eneÄŸi varsayÄ±lan olarak devre dÄ±ÅŸÄ± bÄ±rakÄ±lÄ±r, ancak yeterli izinlerle deÄŸiÅŸtirilebilir.

Bir kovaya eriÅŸmek iÃ§in bir URL'nin **biÃ§imi** ÅŸudur: **`https://storage.googleapis.com/<kova-adÄ±>` veya `https://<kova_adÄ±>.storage.googleapis.com`** (her ikisi de geÃ§erlidir).

### HMAC AnahtarlarÄ±

HMAC anahtarÄ± bir tÃ¼r _kimlik bilgisi_ ve **Cloud Depolama'da bir hizmet hesabÄ± veya kullanÄ±cÄ± hesabÄ± ile iliÅŸkilendirilebilir**. Bir HMAC anahtarÄ± oluÅŸturmak iÃ§in HMAC anahtarÄ±nÄ± kullanÄ±rsÄ±nÄ±z ve bu da Cloud Depolama'ya yapÄ±lan isteklere dahil edilir. Ä°mzalar, **belirli bir isteÄŸin kullanÄ±cÄ± veya hizmet hesabÄ± tarafÄ±ndan yetkilendirildiÄŸini gÃ¶sterir**.

HMAC anahtarlarÄ±nÄ±n iki temel parÃ§asÄ± vardÄ±r, bir _eriÅŸim kimliÄŸi_ ve bir _gizli_.

*   **EriÅŸim KimliÄŸi**: Belirli bir hizmet veya kullanÄ±cÄ± hesabÄ±na baÄŸlÄ± alfasayÄ±sal bir dizedir. Bir hizmet hesabÄ±na baÄŸlandÄ±ÄŸÄ±nda, dize 61 karakter uzunluÄŸundadÄ±r ve bir kullanÄ±cÄ± hesabÄ±na baÄŸlandÄ±ÄŸÄ±nda, dize 24 karakter uzunluÄŸundadÄ±r. AÅŸaÄŸÄ±daki, bir eriÅŸim kimliÄŸinin bir Ã¶rneÄŸini gÃ¶stermektedir:

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **Gizli**: Belirli bir eriÅŸim kimliÄŸine baÄŸlÄ± olan 40 karakterlik Base-64 kodlanmÄ±ÅŸ bir dizedir. Gizli, yalnÄ±zca sizin ve Cloud Depolama'nÄ±n bildiÄŸi bir Ã¶nceden paylaÅŸÄ±lmÄ±ÅŸ anahtardÄ±r. Kimlik doÄŸrulama sÃ¼recinin bir parÃ§asÄ± olarak imzalar oluÅŸturmak iÃ§in gizlinizi kullanÄ±rsÄ±nÄ±z. AÅŸaÄŸÄ±daki, bir gizli Ã¶rneÄŸini gÃ¶stermektedir:

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

**EriÅŸim kimliÄŸi ve gizli, bir HMAC anahtarÄ±nÄ± benzersiz ÅŸekilde tanÄ±mlar**, ancak gizli, imzalar oluÅŸturmak iÃ§in kullanÄ±ldÄ±ÄŸÄ±ndan daha hassas bilgidir.
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list
```
EÄŸer kovalarÄ± listelerken izin reddedildi hatasÄ± alÄ±rsanÄ±z, iÃ§eriÄŸe hala eriÅŸiminiz olabilir. DolayÄ±sÄ±yla, kovalarÄ±n ad konvansiyonu hakkÄ±nda bilgi sahibi olduktan sonra olasÄ± adlar listesi oluÅŸturabilir ve bunlara eriÅŸmeyi deneyebilirsiniz:
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
Ä°zinler `storage.objects.list` ve `storage.objects.get` ile, tÃ¼m klasÃ¶rleri ve dosyalarÄ± listeleyip indirmek iÃ§in bu Python betiÄŸi ile baÅŸarÄ±lÄ± olmalÄ±sÄ±nÄ±z:
```python
import requests
import xml.etree.ElementTree as ET

def list_bucket_objects(bucket_name, prefix='', marker=None):
url = f"https://storage.googleapis.com/{bucket_name}?prefix={prefix}"
if marker:
url += f"&marker={marker}"
response = requests.get(url)
xml_data = response.content
root = ET.fromstring(xml_data)
ns = {'ns': 'http://doc.s3.amazonaws.com/2006-03-01'}
for contents in root.findall('.//ns:Contents', namespaces=ns):
key = contents.find('ns:Key', namespaces=ns).text
print(key)
next_marker = root.find('ns:NextMarker', namespaces=ns)
if next_marker is not None:
next_marker_value = next_marker.text
list_bucket_objects(bucket_name, prefix, next_marker_value)

list_bucket_objects('<storage-name>')
```
### AyrÄ±calÄ±k YÃ¼kseltme

AÅŸaÄŸÄ±daki sayfada **ayrÄ±calÄ±klarÄ± yÃ¼kseltmek iÃ§in depolama izinlerini kÃ¶tÃ¼ye kullanma** yÃ¶ntemlerini kontrol edebilirsiniz:

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### Kimlik DoÄŸrulamasÄ±z SÄ±ralama

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### SaldÄ±rÄ± SonrasÄ± Ä°ÅŸlemler

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### KalÄ±cÄ±lÄ±k

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya beni **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'da **takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
