# GCP - Enumeracja Pub/Sub

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Pub/Sub <a href="#reviewing-cloud-pubsub" id="reviewing-cloud-pubsub"></a>

[Google **Cloud Pub/Sub**](https://cloud.google.com/pubsub/) jest opisany jako usÅ‚uga uÅ‚atwiajÄ…ca wymianÄ™ wiadomoÅ›ci miÄ™dzy niezaleÅ¼nymi aplikacjami. GÅ‚Ã³wne komponenty obejmujÄ… **tematy**, do ktÃ³rych aplikacje mogÄ… siÄ™ **subskrybowaÄ‡**. Subskrybowane aplikacje majÄ… moÅ¼liwoÅ›Ä‡ **wysyÅ‚ania i odbierania wiadomoÅ›ci**. KaÅ¼da wiadomoÅ›Ä‡ skÅ‚ada siÄ™ z rzeczywistej treÅ›ci wraz z powiÄ…zanymi metadanymi.

**Temat to kolejka**, do ktÃ³rej bÄ™dÄ… wysyÅ‚ane wiadomoÅ›ci, podczas gdy **subskrypcje** to **obiekty**, ktÃ³re uÅ¼ytkownicy bÄ™dÄ… uÅ¼ywaÄ‡ do **dostÄ™pu do wiadomoÅ›ci w tematach**. MoÅ¼e istnieÄ‡ wiÄ™cej niÅ¼ **1 subskrypcja na temat**, a istniejÄ… 4 rodzaje subskrypcji:

* **Pull**: UÅ¼ytkownik(i) tej subskrypcji muszÄ… pobieraÄ‡ wiadomoÅ›ci.
* **Push**: Wskazany jest adres URL punktu koÅ„cowego, a wiadomoÅ›ci zostanÄ… natychmiast wysÅ‚ane do niego.
* **Tabela BigQuery**: Podobnie jak push, ale wiadomoÅ›ci sÄ… umieszczane w tabeli BigQuery.
* **Cloud Storage**: Dostarczaj wiadomoÅ›ci bezpoÅ›rednio do istniejÄ…cego kubeÅ‚ka.

DomyÅ›lnie **subskrypcja wygasa po 31 dniach**, chociaÅ¼ moÅ¼na jÄ… ustawiÄ‡ na nieskoÅ„czonoÅ›Ä‡.

DomyÅ›lnie wiadomoÅ›Ä‡ jest **przechowywana przez 7 dni**, ale ten czas moÅ¼na **zwiÄ™kszyÄ‡ do 31 dni**. JeÅ›li nie zostanie **potwierdzona (ACK)** w ciÄ…gu 10 sekund, wraca do kolejki. MoÅ¼na rÃ³wnieÅ¼ ustawiÄ‡, Å¼e potwierdzone wiadomoÅ›ci powinny nadal byÄ‡ przechowywane.

DomyÅ›lnie temat jest szyfrowany za pomocÄ… **zarzÄ…dzanego przez Google klucza szyfrowania**. MoÅ¼na jednak rÃ³wnieÅ¼ wybraÄ‡ **CMEK** (Customer Managed Encryption Key) z KMS.

**Skrzynka na martwe listy**: Subskrypcje mogÄ… skonfigurowaÄ‡ **maksymalnÄ… liczbÄ™ prÃ³b dostarczenia**. Gdy wiadomoÅ›Ä‡ nie moÅ¼e zostaÄ‡ dostarczona, jest **ponownie publikowana w okreÅ›lonym temacie martwej listy**.

### Snapshoty i schematy

Snapshot to funkcja, ktÃ³ra **przechwytuje stan subskrypcji w okreÅ›lonym momencie**. Jest to w zasadzie spÃ³jna **kopia niepotwierdzonych wiadomoÅ›ci w subskrypcji**. TworzÄ…c snapshot, zachowujesz stan potwierdzenia wiadomoÅ›ci subskrypcji, co pozwala na wznowienie konsumpcji wiadomoÅ›ci od momentu utworzenia snapshotu, nawet po usuniÄ™ciu oryginalnych wiadomoÅ›ci.\
JeÅ›li masz duÅ¼o szczÄ™Å›cia, snapshot moÅ¼e zawieraÄ‡ **stare poufne informacje** z chwili utworzenia snapshotu.

Podczas tworzenia tematu moÅ¼na wskazaÄ‡, Å¼e **wiadomoÅ›ci tematu muszÄ… byÄ‡ zgodne ze schematem**.

### Wyliczanie
```bash
# Get a list of topics in the project
gcloud pubsub topics list
gcloud pubsub topics describe <topic>
gcloud pubsub topics list-subscriptions <topic>
gcloud pubsub topics get-iam-policy <topic>

# Get a list of subscriptions across all topics
gcloud pubsub subscriptions list
gcloud pubsub subscriptions describe <subscription>
gcloud pubsub subscriptions get-iam-policy <subscription>

# Get list of schemas
gcloud pubsub schemas list
gcloud pubsub schemas describe <schema>
gcloud pubsub schemas list-revisions <schema>

# Get list of snapshots
gcloud pubsub snapshots list
gcloud pubsub snapshots describe <snapshot>
```
JednakÅ¼e, moÅ¼esz uzyskaÄ‡ lepsze wyniki [**proszÄ…c o wiÄ™kszy zestaw danych**](https://cloud.google.com/pubsub/docs/replay-overview), w tym starsze wiadomoÅ›ci. Wymaga to speÅ‚nienia pewnych warunkÃ³w i moÅ¼e wpÅ‚ywaÄ‡ na aplikacje, wiÄ™c upewnij siÄ™, Å¼e naprawdÄ™ wiesz, co robisz.

### Eskalacja uprawnieÅ„ i wykorzystanie po wÅ‚amaniu

{% content-ref url="../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md" %}
[gcp-pub-sub-post-exploitation.md](../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md)
{% endcontent-ref %}

## Pub/Sub Lite

[**Pub/Sub Lite**](https://cloud.google.com/pubsub/docs/choosing-pubsub-or-lite) to usÅ‚uga wiadomoÅ›ci z **lokalnym przechowywaniem**. Pub/Sub Lite **kosztuje uÅ‚amek** Pub/Sub i jest przeznaczony do **strumieniowania o duÅ¼ej objÄ™toÅ›ci** (do 10 milionÃ³w wiadomoÅ›ci na sekundÄ™) oraz do systemÃ³w opartych na zdarzeniach, gdzie gÅ‚Ã³wnym czynnikiem jest niski koszt.

W PubSub Lite istniejÄ… **tematy** i **subskrypcje**, nie ma **migawek** ani **schematÃ³w**, a sÄ…:

* **Rezerwacje**: Rezerwacje Pub/Sub Lite to funkcja, ktÃ³ra umoÅ¼liwia uÅ¼ytkownikom rezerwacjÄ™ pojemnoÅ›ci w okreÅ›lonym regionie dla ich strumieni wiadomoÅ›ci.
* **Operacje**: Odnosi siÄ™ do dziaÅ‚aÅ„ i zadaÅ„ zwiÄ…zanych z zarzÄ…dzaniem i administrowaniem Pub/Sub Lite.

### Wyliczanie
```bash
# lite-topics
gcloud pubsub lite-topics list
gcloud pubsub lite-topics describe <topic>
gcloud pubsub lite-topics list-subscriptions <topic>

# lite-subscriptions
gcloud pubsub lite-subscriptions list
gcloud pubsub lite-subscriptions describe <subscription>

# lite-reservations
gcloud pubsub lite-reservations list
gcloud pubsub lite-reservations describe <topic>
gcloud pubsub lite-reservations list-topics <topic>

# lite-operations
gcloud pubsub lite-operations list
gcloud pubsub lite-operations describe <topic>
```
<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
