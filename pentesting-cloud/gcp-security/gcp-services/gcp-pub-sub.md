# GCP - Pub/Sub

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å¾—ã‚‹ï¼</strong></summary>

* **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„**å ´åˆã‚„ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥æ‰‹ã—ãŸã„**å ´åˆã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ã”ç¢ºèªãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>

## Pub/Sub <a href="#reviewing-cloud-pubsub" id="reviewing-cloud-pubsub"></a>

Google [**Cloud Pub/Sub**](https://cloud.google.com/pubsub/)ã¯ã€ç‹¬ç«‹ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€å—ä¿¡**ã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚åŸºæœ¬çš„ã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯**ãƒˆãƒ”ãƒƒã‚¯**ã«**ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒ–**ã—ã¦**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€å—ä¿¡**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ã¨ã„ãã¤ã‹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã§æ§‹æˆã•ã‚Œã¾ã™ï¼‰ã€‚

**ãƒˆãƒ”ãƒƒã‚¯ã¯ã‚­ãƒ¥ãƒ¼**ã§ã‚ã‚Šã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã‚‹å ´æ‰€ã§ã™ã€‚ä¸€æ–¹ã€**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³**ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**ãƒˆãƒ”ãƒƒã‚¯å†…ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹**ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ã§ã™ã€‚1ã¤ã®ãƒˆãƒ”ãƒƒã‚¯ã«ã¯è¤‡æ•°ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ãŒã§ãã€3ã¤ã®ã‚¿ã‚¤ãƒ—ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚

* **Pull**: ã“ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* **Push**: URLã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæŒ‡å®šã•ã‚Œã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ç›´ã¡ã«é€ä¿¡ã•ã‚Œã¾ã™ã€‚
* **BigQueryãƒ†ãƒ¼ãƒ–ãƒ«**: Pushã¨åŒæ§˜ã§ã™ãŒã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯BigQueryãƒ†ãƒ¼ãƒ–ãƒ«ã«æ ¼ç´ã•ã‚Œã¾ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯**7æ—¥é–“ä¿æŒ**ã•ã‚Œã¾ã™ãŒã€ã“ã®æœŸé–“ã¯**æœ€å¤§31æ—¥é–“ã¾ã§å»¶é•·**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€10ç§’ä»¥å†…ã«**ACKãŒãªã„å ´åˆã¯ã‚­ãƒ¥ãƒ¼ã«æˆ»ã•ã‚Œã¾ã™**ã€‚

ãƒˆãƒ”ãƒƒã‚¯ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§**GoogleãŒç®¡ç†ã™ã‚‹æš—å·åŒ–ã‚­ãƒ¼**ã‚’ä½¿ç”¨ã—ã¦æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚ãŸã ã—ã€KMSã‹ã‚‰**CMEKï¼ˆé¡§å®¢ç®¡ç†å‹æš—å·åŒ–ã‚­ãƒ¼ï¼‰**ã‚’é¸æŠã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

**ãƒ‡ãƒƒãƒ‰ãƒ¬ã‚¿ãƒ¼**: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã¯**é…ä¿¡è©¦è¡Œå›æ•°ã®æœ€å¤§å€¤**ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé…ä¿¡ã§ããªã„å ´åˆã€æŒ‡å®šã•ã‚ŒãŸãƒ‡ãƒƒãƒ‰ãƒ¬ã‚¿ãƒ¼ãƒˆãƒ”ãƒƒã‚¯ã«**å†å…¬é–‹**ã•ã‚Œã¾ã™ã€‚

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ã‚¹ã‚­ãƒ¼ãƒ

ãƒˆãƒ”ãƒƒã‚¯ã«ã¯**ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**ãŒã‚ã‚Šã€ãã“ã«ã¯**å¤ã„æ©Ÿå¯†æƒ…å ±**ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯ã€**ACKã•ã‚Œã¦ã„ãªã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**ã¨ãã‚Œä»¥é™ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿æŒã—ã¾ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯1é€±é–“ç”Ÿå­˜ã—ã¾ã™ï¼‰ã€‚

ãƒˆãƒ”ãƒƒã‚¯ã‚’ä½œæˆã™ã‚‹éš›ã«ã€**ãƒˆãƒ”ãƒƒã‚¯ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚¹ã‚­ãƒ¼ãƒã«å¾“ã†å¿…è¦ãŒã‚ã‚‹**ã¨æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### åˆ—æŒ™
```bash
# Get a list of topics in the project
gcloud pubsub topics list
gcloud pubsub topics describe <topic>
gcloud pubsub topics list-subscriptions <topic>
gcloud pubsub topics get-iam-policy <topic>

# Get a list of subscriptions across all topics
gcloud pubsub subscriptions list
gcloud pubsub subscriptions describe <subscription>
gcloud pubsub subscriptions get-iam-policy <subscription>

# Get list of schemas
gcloud pubsub schemas list
gcloud pubsub schemas describe <snapshot>

# Get list of snapshots
gcloud pubsub snapshots list
gcloud pubsub snapshots describe <snapshot>
```
ãŸã ã—ã€ã‚ˆã‚Šè‰¯ã„çµæœã‚’å¾—ã‚‹ãŸã‚ã«ã¯ã€[**ã‚ˆã‚Šå¤§ããªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’è¦æ±‚ã™ã‚‹**](https://cloud.google.com/pubsub/docs/replay-overview)ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã¯ã„ãã¤ã‹ã®å‰ææ¡ä»¶ãŒã‚ã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€è‡ªåˆ†ãŒä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹æœ¬å½“ã«ç†è§£ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

{% code overflow="wrap" %}
```bash
# Publish a message in a topic
gcloud pubsub topics publish <topic_name> --message "Hello!"

# This will retrive a non ACKed message (and won't ACK it)
gcloud pubsub subscriptions create my_subscription --topic <topic_name>
gcloud pubsub subscriptions pull <FULL SUBSCRIPTION NAME>

# Crete push subscription and recieve all the messages instantly in your web server
gcloud pubsub subscriptions create <subscription name> --topic <topic name> --push-endpoint <URL to push to>
```
{% endcode %}

## Pub/Sub Lite

[**Pub/Sub Lite**](https://cloud.google.com/pubsub/docs/choosing-pubsub-or-lite)ã¯ã€**ã‚¾ãƒ¼ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**ã‚’å‚™ãˆãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚Pub/Sub Liteã¯Pub/Subã®ä¸€éƒ¨ã§ã‚ã‚Šã€**ä½ã‚³ã‚¹ãƒˆ**ã§ã‚ã‚ŠãªãŒã‚‰ã€é«˜ã„ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼ˆæœ€å¤§10,000,000ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸/ç§’ï¼‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚„ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•å‹ã‚·ã‚¹ãƒ†ãƒ ã«é©ã—ã¦ã„ã¾ã™ã€‚

Pub/Sub Liteã§ã¯ã€**ãƒˆãƒ”ãƒƒã‚¯**ã¨**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³**ãŒã‚ã‚Šã¾ã™ãŒã€**ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**ã‚„**ã‚¹ã‚­ãƒ¼ãƒ**ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãŸã€ä»¥ä¸‹ã®æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ï¼š

* **äºˆç´„**: Pub/Sub Liteã®äºˆç´„ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ãŸã‚ã«ç‰¹å®šã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§å®¹é‡ã‚’äºˆç´„ã™ã‚‹ã“ã¨ãŒã§ãã‚‹æ©Ÿèƒ½ã§ã™ã€‚
* **æ“ä½œ**: Pub/Sub Liteã®ç®¡ç†ã¨ç®¡ç†ã«é–¢é€£ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã‚¿ã‚¹ã‚¯ã‚’æŒ‡ã—ã¾ã™ã€‚

### åˆ—æŒ™
```bash
# lite-topics
gcloud pubsub lite-topics list
gcloud pubsub lite-topics describe <topic>
gcloud pubsub lite-topics list-subscriptions <topic>

# lite-subscriptions
gcloud pubsub lite-subscriptions list
gcloud pubsub lite-subscriptions describe <subscription>

# lite-reservations
gcloud pubsub lite-reservations list
gcloud pubsub lite-reservations describe <topic>
gcloud pubsub lite-reservations list-topics <topic>

# lite-operations
gcloud pubsub lite-operations list
gcloud pubsub lite-operations describe <topic>
```
<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* ã‚‚ã— **HackTricks ã§ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„** ã¾ãŸã¯ **PEASS ã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„** ã¾ãŸã¯ **HackTricks ã‚’ PDF ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼ã® PEASS & HackTricks ã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com) ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã™
* ğŸ’¬ [**Discord ã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã¾ãŸã¯ [**telegram ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã« **å‚åŠ ** ã™ã‚‹ã‹ã€ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm) ã‚’ **ãƒ•ã‚©ãƒ­ãƒ¼** ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€PR ã‚’** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ã¨** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
