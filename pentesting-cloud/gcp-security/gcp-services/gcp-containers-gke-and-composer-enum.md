# GCP - ì»¨í…Œì´ë„ˆ, GKE ë° Composer Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ì»¨í…Œì´ë„ˆ

GCP ì»¨í…Œì´ë„ˆì—ì„œëŠ” GCPê°€ ì œê³µí•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ì„œë¹„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì—ì„œëŠ” ê°€ì¥ ì¼ë°˜ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ì—´ê±°í•˜ëŠ” ë°©ë²•ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gcloud container images list
gcloud container images list --repository us.gcr.io/<project-name> #Search in other subdomains repositories
gcloud container images describe <name>
gcloud container subnets list-usable
gcloud container clusters list
gcloud container clusters describe <name>
gcloud container clusters get-credentials [NAME]

# Run a container locally
docker run --rm -ti gcr.io/<project-name>/secret:v1 sh

# Login & Download
sudo docker login -u oauth2accesstoken -p $(gcloud auth print-access-token) https://HOSTNAME
## where HOSTNAME is gcr.io, us.gcr.io, eu.gcr.io, or asia.gcr.io.
sudo docker pull HOSTNAME/<project-name>/<image-name>
```
### ê¶Œí•œ ìƒìŠ¹ (Privesc)

ë‹¤ìŒ í˜ì´ì§€ì—ì„œëŠ” **ì»¨í…Œì´ë„ˆ ê¶Œí•œì„ ë‚¨ìš©í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹**í•˜ëŠ” ë°©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../gcp-privilege-escalation/gcp-container-privesc.md" %}
[gcp-container-privesc.md](../gcp-privilege-escalation/gcp-container-privesc.md)
{% endcontent-ref %}

## ë…¸ë“œ í’€ (Node Pools)

ì´ê²ƒë“¤ì€ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•˜ëŠ” ë¨¸ì‹  (ë…¸ë“œ)ì˜ í’€ì…ë‹ˆë‹¤.
```bash
# Pool of machines used by the cluster
gcloud container node-pools list --zone <zone> --cluster <cluster>
gcloud container node-pools describe --cluster <cluster> --zone <zone> <node-pool>
```
## Composer

ì´ê²ƒì€ **Airflow**ì˜ GCP ê´€ë¦¬ ë²„ì „ì…ë‹ˆë‹¤.
```bash
gcloud composer environments list --locations <loc>
gcloud composer environments describe --location <loc> <environment>s
```
### ê¶Œí•œ ìƒìŠ¹

ë‹¤ìŒ í˜ì´ì§€ì—ì„œëŠ” **composer ê¶Œí•œì„ ë‚¨ìš©í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ëŠ” ë°©ë²•**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../gcp-privilege-escalation/gcp-composer-privesc.md" %}
[gcp-composer-privesc.md](../gcp-privilege-escalation/gcp-composer-privesc.md)
{% endcontent-ref %}

## Kubernetes

Kubernetesê°€ ë¬´ì—‡ì¸ì§€ì— ëŒ€í•œ ì •ë³´ëŠ” ë‹¤ìŒ í˜ì´ì§€ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤:

{% content-ref url="../../kubernetes-security/" %}
[kubernetes-security](../../kubernetes-security/)
{% endcontent-ref %}

ë¨¼ì €, í”„ë¡œì íŠ¸ì— Kubernetes í´ëŸ¬ìŠ¤í„°ê°€ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
gcloud container clusters list
```
ë§Œì•½ í´ëŸ¬ìŠ¤í„°ê°€ ìˆë‹¤ë©´, `gcloud`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ `~/.kube/config` íŒŒì¼ì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ íŒŒì¼ì€ K8s í´ëŸ¬ìŠ¤í„°ì™€ ìƒí˜¸ ì‘ìš©í•˜ê¸° ìœ„í•œ ì›ì‹œ CLIì¸ [kubectl](https://kubernetes.io/docs/reference/kubectl/overview/)ì„ ì‚¬ìš©í•  ë•Œ ì¸ì¦í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì„ ì‹œë„í•´ë³´ì„¸ìš”.
```
gcloud container clusters get-credentials [CLUSTER NAME] --region [REGION]
```
ê·¸ëŸ° ë‹¤ìŒ ìƒì„±ëœ ìê²© ì¦ëª…ì„ í™•ì¸í•˜ê¸° ìœ„í•´ `~/.kube/config` íŒŒì¼ì„ ì‚´í´ë³´ì‹­ì‹œì˜¤. ì´ íŒŒì¼ì€ í™œì„± `gcloud` ì„¸ì…˜ê³¼ ë™ì¼í•œ ì‹ ì›ì„ ê¸°ë°˜ìœ¼ë¡œ ì•¡ì„¸ìŠ¤ í† í°ì„ ìë™ìœ¼ë¡œ ê°±ì‹ í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ë¬¼ë¡  ì´ë¥¼ ìœ„í•´ì„œëŠ” ì˜¬ë°”ë¥¸ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.

ì´ ì„¤ì •ì´ ì™„ë£Œë˜ë©´ ë‹¤ìŒ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
kubectl cluster-info
```
`gcloud`ë¥¼ ì‚¬ìš©í•œ ì»¨í…Œì´ë„ˆì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://cloud.google.com/sdk/gcloud/reference/container/)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

GCPì—ì„œ Kubernetesë¥¼ ì—´ê±°í•˜ê¸° ìœ„í•œ ê°„ë‹¨í•œ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤: [https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_k8s\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_k8s\_enum)

### TLS ë¶€íŠ¸ìŠ¤íŠ¸ë© ê¶Œí•œ ìƒìŠ¹

ì´ˆê¸°ì— ì´ ê¶Œí•œ ìƒìŠ¹ ê¸°ìˆ ì€ GKE í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ **ê¶Œí•œ ìƒìŠ¹**ì„ í—ˆìš©í•˜ì—¬ ê³µê²©ìê°€ **í´ëŸ¬ìŠ¤í„°ë¥¼ ì™„ì „íˆ ì œì–´**í•  ìˆ˜ ìˆê²Œ í–ˆìŠµë‹ˆë‹¤.

ì´ëŠ” GKEê°€ ë©”íƒ€ë°ì´í„°ì—ì„œ [TLS ë¶€íŠ¸ìŠ¤íŠ¸ë© ìê²© ì¦ëª…](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/)ì„ ì œê³µí•˜ê¸° ë•Œë¬¸ì— ê°€ëŠ¥í•œë°, ì´ëŠ” **ì–´ë–¤ podë¥¼ ê³µê²©í•˜ë©´ ëˆ„êµ¬ë‚˜ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ì‚¬ìš©ëœ ê¸°ìˆ ì€ ë‹¤ìŒ ê²Œì‹œë¬¼ì—ì„œ ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

* [https://www.4armed.com/blog/hacking-kubelet-on-gke/](https://www.4armed.com/blog/hacking-kubelet-on-gke/)
* [https://www.4armed.com/blog/kubeletmein-kubelet-hacking-tool/](https://www.4armed.com/blog/kubeletmein-kubelet-hacking-tool/)
* [https://rhinosecuritylabs.com/cloud-security/kubelet-tls-bootstrap-privilege-escalation/](https://rhinosecuritylabs.com/cloud-security/kubelet-tls-bootstrap-privilege-escalation/)

ë˜í•œ ì´ ë„êµ¬ëŠ” ì´ ê³¼ì •ì„ ìë™í™”í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤: [https://github.com/4ARMED/kubeletmein](https://github.com/4ARMED/kubeletmein)

ê·¸ëŸ¬ë‚˜ ì´ ê¸°ìˆ ì€ **ë©”íƒ€ë°ì´í„° ìê²© ì¦ëª…ì„ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ ë…¸ë“œì— ëŒ€í•œ CSR**(ì¸ì¦ì„œ ì„œëª… ìš”ì²­)ì„ ìƒì„±í•  ìˆ˜ ìˆì—ˆê¸° ë•Œë¬¸ì— ê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤. ì´ ìš”ì²­ì€ **ìë™ìœ¼ë¡œ ìŠ¹ì¸**ë˜ì—ˆìŠµë‹ˆë‹¤.\
ì œ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” **ì´ëŸ¬í•œ ìš”ì²­ì´ ë” ì´ìƒ ìë™ìœ¼ë¡œ ìŠ¹ì¸ë˜ì§€ ì•ŠëŠ” ê²ƒ**ì„ í™•ì¸í–ˆìœ¼ë¯€ë¡œ ì´ ê¸°ìˆ ì´ ì—¬ì „íˆ ìœ íš¨í•œì§€ í™•ì‹¤í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### Kubelet APIì—ì„œì˜ Secrets <a href="#the-kubelet-api-git-secrets-redux" id="the-kubelet-api-git-secrets-redux"></a>

[**ì´ ê²Œì‹œë¬¼**](https://blog.assetnote.io/2022/05/06/cloudflare-pages-pt3/)ì—ì„œëŠ” GKE ë‚´ì˜ podì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” Kubelet API ì£¼ì†Œë¥¼ í†µí•´ ì‹¤í–‰ ì¤‘ì¸ podì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.
```
curl -v -k http://10.124.200.1:10255/pods
```
APIê°€ ë¦¬ì†ŒìŠ¤ ìˆ˜ì •ì„ í—ˆìš©í•˜ì§€ ì•Šë”ë¼ë„, ì‘ë‹µì—ì„œ **ë¯¼ê°í•œ ì •ë³´**ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. [**Kiterunner**](https://github.com/assetnote/kiterunner)ë¥¼ ì‚¬ìš©í•˜ì—¬ /pods ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family)ì¸ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ ì €ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
