# GCP - äº‘å‡½æ•°æšä¸¾

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## äº‘å‡½æ•° <a href="#reviewing-cloud-functions" id="reviewing-cloud-functions"></a>

[Google Cloud Functions](https://cloud.google.com/functions/)æ—¨åœ¨æ‰˜ç®¡æ‚¨çš„ä»£ç ï¼Œ**ä»¥å“åº”äº‹ä»¶æ‰§è¡Œ**ï¼Œæ— éœ€ç®¡ç†ä¸»æœºæ“ä½œç³»ç»Ÿã€‚æ­¤å¤–ï¼Œè¿™äº›å‡½æ•°æ”¯æŒå­˜å‚¨ç¯å¢ƒå˜é‡ï¼Œä»£ç å¯ä»¥åˆ©ç”¨è¿™äº›å˜é‡ã€‚

### å­˜å‚¨

äº‘å‡½æ•°çš„**ä»£ç å­˜å‚¨åœ¨GCPå­˜å‚¨æ¡¶**ä¸­ã€‚å› æ­¤ï¼Œä»»ä½•åœ¨GCPä¸Šå…·æœ‰**å­˜å‚¨æ¡¶è¯»å–æƒé™**çš„äººéƒ½å¯ä»¥**è¯»å–äº‘å‡½æ•°ä»£ç **ã€‚\
ä»£ç å­˜å‚¨åœ¨ç±»ä¼¼ä»¥ä¸‹çš„å­˜å‚¨æ¡¶ä¸­ï¼š

`gcf-sources-<number>-<region>/<function-name>-<uuid>/version-<n>/function-source.zip`\
ä¾‹å¦‚ï¼š\
`gcf-sources-645468741258-us-central1/function-1-003dcbdf-32e1-430f-a5ff-785a6e238c76/version-4/function-source.zip`

{% hint style="warning" %}
ä»»ä½•å…·æœ‰**å­˜å‚¨äº‘å‡½æ•°çš„å­˜å‚¨æ¡¶çš„å†™å…¥æƒé™**çš„ç”¨æˆ·éƒ½å¯ä»¥**è¦†ç›–æ‰§è¡Œçš„ä»£ç **ã€‚
{% endhint %}

### SA

å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ**å°†é™„åŠ åˆ°äº‘å‡½æ•°çš„æ˜¯å…·æœ‰å¯¹é¡¹ç›®çš„ç¼–è¾‘æƒé™çš„App Engineé»˜è®¤æœåŠ¡å¸æˆ·**ã€‚

### è§¦å‘å™¨ã€URLå’Œèº«ä»½éªŒè¯

åˆ›å»ºäº‘å‡½æ•°æ—¶éœ€è¦æŒ‡å®š**è§¦å‘å™¨**ã€‚ä¸€ä¸ªå¸¸è§çš„è§¦å‘å™¨æ˜¯**HTTPS**ï¼Œè¿™å°†**åˆ›å»ºä¸€ä¸ªURLï¼Œé€šè¿‡Webæµè§ˆå™¨å¯ä»¥è§¦å‘å‡½æ•°**ã€‚\
å…¶ä»–è§¦å‘å™¨åŒ…æ‹¬pub/subã€Storageã€Filestoreç­‰...

URLæ ¼å¼ä¸º**`https://<region>-<project-gcp-name>.cloudfunctions.net/<func_name>`**

å½“ä½¿ç”¨HTTPSè§¦å‘å™¨æ—¶ï¼Œè¿˜ä¼šæŒ‡ç¤º**è°ƒç”¨è€…æ˜¯å¦éœ€è¦å…·æœ‰IAMæˆæƒ**æ¥è°ƒç”¨å‡½æ•°ï¼Œæˆ–è€…**æ¯ä¸ªäºº**éƒ½å¯ä»¥è°ƒç”¨å®ƒï¼š

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

### äº‘å‡½æ•°å†…éƒ¨

ä»£ç **ä¸‹è½½åˆ°**æ–‡ä»¶å¤¹**`/workspace`**ä¸­ï¼Œæ–‡ä»¶åä¸äº‘å‡½æ•°ä¸­çš„æ–‡ä»¶åç›¸åŒï¼Œå¹¶ä½¿ç”¨ç”¨æˆ·`www-data`æ‰§è¡Œã€‚\
ç£ç›˜**æœªä»¥åªè¯»æ–¹å¼æŒ‚è½½**ã€‚

### æšä¸¾
```bash
# List functions
gcloud functions list
gcloud functions describe <func_name> # Check triggers to see how is this function invoked
gcloud functions get-iam-policy <func_name>

# Get logs of previous runs. By default, limits to 10 lines
gcloud functions logs read <func_name> --limit [NUMBER]

# Call a function
curl https://<region>-<project>.cloudfunctions.net/<func_name>
gcloud functions call <func_name> --data='{"message": "Hello World!"}'

# If you know the name of projects you could try to BF cloud functions names

# Get events that could be used to trigger a cloud function
gcloud functions event-types list

# Access function with authentication
curl -X POST https://<region>-<project>.cloudfunctions.net/<func_name> \
-H "Authorization: bearer $(gcloud auth print-identity-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
### ææƒ

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨äº‘å‡½æ•°æƒé™ä»¥æå‡ç‰¹æƒ**ï¼š

{% content-ref url="../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md" %}
[gcp-cloudfunctions-privesc.md](../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md)
{% endcontent-ref %}

### æœªç»èº«ä»½éªŒè¯çš„è®¿é—®

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md" %}
[gcp-cloud-functions-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md)
{% endcontent-ref %}

### åæ¸—é€

{% content-ref url="../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md" %}
[gcp-cloud-functions-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md)
{% endcontent-ref %}

### æŒä¹…æ€§

{% content-ref url="../gcp-persistence/gcp-cloud-functions-persistence.md" %}
[gcp-cloud-functions-persistence.md](../gcp-persistence/gcp-cloud-functions-persistence.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
