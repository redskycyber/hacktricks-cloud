# GCP - KMS Manager Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* **HackTricks**ã®[**GitHubãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã™ã‚‹ã€‚

</details>

## KMS

[**Cloud Key Management Service**](https://cloud.google.com/kms/docs/)ã¯ã€**æš—å·åŒ–ãŠã‚ˆã³å¾©å·åŒ–ã«ä½¿ç”¨ã•ã‚Œã‚‹æš—å·éµ**ãªã©ã‚’**ä¿å­˜ã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒª**ã§ã™ã€‚å€‹ã€…ã®éµã¯éµãƒªãƒ³ã‚°ã«ä¿å­˜ã•ã‚Œã€éµãƒªãƒ³ã‚°ã¾ãŸã¯éµãƒ¬ãƒ™ãƒ«ã§ç´°ã‹ã„æ¨©é™ã‚’é©ç”¨ã§ãã¾ã™ã€‚

KMSéµãƒªãƒ³ã‚°ã¯**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ä½œæˆã•ã‚Œ**ã€ãã®éµãƒªãƒ³ã‚°å†…ã®éµã¯ã©ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚ãŸã ã—ã€**ç‰¹å®šã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**ã§ç‰¹å®šã®éµãƒªãƒ³ã‚°ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

### éµã®ä¿è­·ãƒ¬ãƒ™ãƒ«

* **ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢éµ**: ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢éµã¯**å®Œå…¨ã«ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§KMSã«ã‚ˆã£ã¦ä½œæˆãŠã‚ˆã³ç®¡ç†ã•ã‚Œã¾ã™**ã€‚ã“ã‚Œã‚‰ã®éµã¯**ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆHSMï¼‰ã«ã‚ˆã£ã¦ä¿è­·ã•ã‚Œã¦ã„ã¾ã›ã‚“**ã€‚ãƒ†ã‚¹ãƒˆã‚„é–‹ç™ºç›®çš„ã«ä½¿ç”¨ã§ãã¾ã™ãŒã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒä½ãæ”»æ’ƒã«å¯¾ã—ã¦è„†å¼±ã§ã‚ã‚‹ãŸã‚ã€**æœ¬ç•ªç’°å¢ƒã§ã®ä½¿ç”¨ã¯æ¨å¥¨ã•ã‚Œã¾ã›ã‚“**ã€‚
* **ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ›ã‚¹ãƒˆå‹éµ**: ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ›ã‚¹ãƒˆå‹éµã¯ã€é«˜å¯ç”¨æ€§ã‹ã¤ä¿¡é ¼æ€§ã®é«˜ã„ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ä½¿ç”¨ã—ã¦**ã‚¯ãƒ©ã‚¦ãƒ‰ã§KMSã«ã‚ˆã£ã¦ä½œæˆãŠã‚ˆã³ç®¡ç†ã•ã‚Œã¾ã™**ã€‚ã“ã‚Œã‚‰ã®éµã¯**HSMã«ã‚ˆã£ã¦ä¿è­·ã•ã‚Œã¦ã„ã¾ã™**ãŒã€HSMã¯**ç‰¹å®šã®é¡§å®¢ã«å°‚ç”¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ›ã‚¹ãƒˆå‹éµã¯ã€ã»ã¨ã‚“ã©ã®æœ¬ç•ªç’°å¢ƒã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«é©ã—ã¦ã„ã¾ã™ã€‚
* **å¤–éƒ¨éµ**: å¤–éƒ¨éµã¯**KMSã®å¤–éƒ¨ã§ä½œæˆãŠã‚ˆã³ç®¡ç†ã•ã‚Œ**ã€æš—å·åŒ–æ“ä½œã«ä½¿ç”¨ã™ã‚‹ãŸã‚ã«KMSã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚å¤–éƒ¨éµã¯**é¡§å®¢ã®å¥½ã¿ã«å¿œã˜ã¦ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆHSMï¼‰ã¾ãŸã¯ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä¿å­˜ã§ãã¾ã™**ã€‚

### éµã®ç›®çš„

* **å¯¾ç§°æš—å·åŒ–/å¾©å·åŒ–**: **å˜ä¸€ã®éµã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ãŠã‚ˆã³å¾©å·åŒ–ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™**ã€‚å¯¾ç§°éµã¯ã€å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ãŠã‚ˆã³å¾©å·åŒ–ã™ã‚‹ãŸã‚ã«è¿…é€Ÿã‹ã¤åŠ¹ç‡çš„ã§ã™ã€‚
* **å¯¾å¿œ**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **éå¯¾ç§°ç½²å**: äºŒè€…é–“ã®å®‰å…¨ãªé€šä¿¡ã«ä½¿ç”¨ã•ã‚Œã€éµã‚’å…±æœ‰ã™ã‚‹ã“ã¨ãªãè¡Œã„ã¾ã™ã€‚éå¯¾ç§°éµã¯ã€**å…¬é–‹éµã¨ç§˜å¯†éµ**ã®ãƒšã‚¢ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚å…¬é–‹éµã¯ä»–è€…ã¨å…±æœ‰ã•ã‚Œã€ç§˜å¯†éµã¯ç§˜å¯†ã«ä¿ãŸã‚Œã¾ã™ã€‚
* **å¯¾å¿œ:** [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **éå¯¾ç§°å¾©å·åŒ–**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ãƒ‡ãƒ¼ã‚¿ã®çœŸæ­£æ€§ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã¯ç§˜å¯†éµã‚’ä½¿ç”¨ã—ã¦ä½œæˆã•ã‚Œã€å¯¾å¿œã™ã‚‹å…¬é–‹éµã‚’ä½¿ç”¨ã—ã¦æ¤œè¨¼ã§ãã¾ã™ã€‚
* **å¯¾å¿œ:** [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **MACç½²å**: **ç§˜å¯†éµã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èªè¨¼ã‚³ãƒ¼ãƒ‰ï¼ˆMACï¼‰ã‚’ä½œæˆã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ã®å®Œå…¨æ€§ã¨çœŸæ­£æ€§ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™**ã€‚HMACã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èªè¨¼ã«ä¸€èˆ¬çš„ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* **å¯¾å¿œ:** [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### å›è»¢æœŸé–“ & ç ´å£Šäºˆå®šæœŸé–“

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**ã§ã¯ã€**90æ—¥ã”ã¨**ã§ã™ãŒã€**ç°¡å˜ã«**ã‹ã¤**å®Œå…¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ã§ã™**ã€‚

ã€Œç ´å£Šäºˆå®šã€æœŸé–“ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéµã®å‰Šé™¤ã‚’è¦æ±‚ã—ã¦ã‹ã‚‰éµãŒ**å‰Šé™¤ã•ã‚Œã‚‹**ã¾ã§ã®**æ™‚é–“**ã§ã™ã€‚éµãŒä½œæˆã•ã‚ŒãŸå¾Œã¯å¤‰æ›´ã§ãã¾ã›ã‚“ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯1æ—¥ï¼‰ã€‚

### åˆ—æŒ™

**éµã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹æ¨©é™ãŒã‚ã‚‹å ´åˆ**ã€ä»¥ä¸‹ã®æ–¹æ³•ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### æ¨©é™æ˜‡æ ¼

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

## å‚è€ƒæ–‡çŒ®

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ã§AWSã®ãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã™ã‚‹ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* **HackTricks**ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>
