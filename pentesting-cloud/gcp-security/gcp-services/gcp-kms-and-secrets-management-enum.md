# GCP - KMS ç®¡ç†å™¨æšä¸¾

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹  AWS é»‘å®¢æ”»å‡»</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFT é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š **å…³æ³¨** æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## KMS

[**Cloud Key Management Service**](https://cloud.google.com/kms/docs/) æ˜¯ä¸€ä¸ªå­˜å‚¨åŠ å¯†å¯†é’¥çš„ä»“åº“ï¼Œä¾‹å¦‚ç”¨äº **åŠ å¯†å’Œè§£å¯†æ•æ„Ÿæ–‡ä»¶** çš„å¯†é’¥ã€‚å•ä¸ªå¯†é’¥å­˜å‚¨åœ¨å¯†é’¥ç¯ä¸­ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä»»ä¸€çº§åˆ«åº”ç”¨ç²’åº¦æƒé™ã€‚

KMS å¯†é’¥ç¯é»˜è®¤åˆ›å»ºä¸ºå…¨çƒæ€§çš„ï¼Œè¿™æ„å‘³ç€è¯¥å¯†é’¥ç¯å†…çš„å¯†é’¥å¯ä»¥ä»ä»»ä½•åŒºåŸŸè®¿é—®ã€‚ç„¶è€Œï¼Œå¯ä»¥åœ¨ **ç‰¹å®šåŒºåŸŸ** åˆ›å»ºç‰¹å®šçš„å¯†é’¥ç¯ã€‚

### å¯†é’¥ä¿æŠ¤çº§åˆ«

* **è½¯ä»¶å¯†é’¥**ï¼šè½¯ä»¶å¯†é’¥å®Œå…¨ç”± KMS åœ¨è½¯ä»¶ä¸­ **åˆ›å»ºå’Œç®¡ç†**ã€‚è¿™äº›å¯†é’¥ **æ²¡æœ‰é€šè¿‡ä»»ä½•ç¡¬ä»¶å®‰å…¨æ¨¡å— (HSM) ä¿æŠ¤**ï¼Œå¯ç”¨äº **æµ‹è¯•å’Œå¼€å‘ç›®çš„**ã€‚è½¯ä»¶å¯†é’¥ **ä¸æ¨èç”¨äºç”Ÿäº§**ï¼Œå› ä¸ºå®ƒä»¬æä¾›çš„å®‰å…¨æ€§ä½ï¼Œå®¹æ˜“å—åˆ°æ”»å‡»ã€‚
* **äº‘æ‰˜ç®¡å¯†é’¥**ï¼šäº‘æ‰˜ç®¡å¯†é’¥ç”± KMS åœ¨äº‘ä¸­ä½¿ç”¨é«˜å¯ç”¨å’Œå¯é çš„åŸºç¡€è®¾æ–½ **åˆ›å»ºå’Œç®¡ç†**ã€‚è¿™äº›å¯†é’¥ **å— HSM ä¿æŠ¤**ï¼Œä½† HSM **ä¸ä¸“ç”¨äºç‰¹å®šå®¢æˆ·**ã€‚äº‘æ‰˜ç®¡å¯†é’¥é€‚ç”¨äºå¤§å¤šæ•°ç”Ÿäº§ç”¨ä¾‹ã€‚
* **å¤–éƒ¨å¯†é’¥**ï¼šå¤–éƒ¨å¯†é’¥åœ¨ KMS å¤–éƒ¨ **åˆ›å»ºå’Œç®¡ç†**ï¼Œå¹¶å¯¼å…¥åˆ° KMS ä¸­ç”¨äºåŠ å¯†æ“ä½œã€‚å¤–éƒ¨å¯†é’¥ **å¯ä»¥å­˜å‚¨åœ¨ç¡¬ä»¶å®‰å…¨æ¨¡å— (HSM) æˆ–è½¯ä»¶åº“ä¸­ï¼Œå…·ä½“å–å†³äºå®¢æˆ·çš„åå¥½**ã€‚

### å¯†é’¥ç”¨é€”

* **å¯¹ç§°åŠ å¯†/è§£å¯†**ï¼šä½¿ç”¨å•ä¸ªå¯†é’¥è¿›è¡Œæ•°æ®çš„ **åŠ å¯†å’Œè§£å¯†**ã€‚å¯¹ç§°å¯†é’¥åœ¨åŠ å¯†å’Œè§£å¯†å¤§é‡æ•°æ®æ—¶å¿«é€Ÿä¸”é«˜æ•ˆã€‚
* **æ”¯æŒ**ï¼š[cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **éå¯¹ç§°ç­¾å**ï¼šç”¨äºåœ¨ä¸¤æ–¹ä¹‹é—´çš„å®‰å…¨é€šä¿¡ï¼Œæ— éœ€å…±äº«å¯†é’¥ã€‚éå¯¹ç§°å¯†é’¥æˆå¯¹å‡ºç°ï¼ŒåŒ…æ‹¬ **å…¬é’¥å’Œç§é’¥**ã€‚å…¬é’¥ä¸ä»–äººå…±äº«ï¼Œè€Œç§é’¥ä¿å¯†ã€‚
* **æ”¯æŒ**ï¼š[cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **éå¯¹ç§°è§£å¯†**ï¼šç”¨äºéªŒè¯æ¶ˆæ¯æˆ–æ•°æ®çš„çœŸå®æ€§ã€‚ä½¿ç”¨ç§é’¥åˆ›å»ºæ•°å­—ç­¾åï¼Œå¹¶å¯ä»¥ä½¿ç”¨ç›¸åº”çš„å…¬é’¥è¿›è¡ŒéªŒè¯ã€‚
* **æ”¯æŒ**ï¼š[cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **MAC ç­¾å**ï¼šé€šè¿‡ä½¿ç”¨ç§˜å¯†å¯†é’¥åˆ›å»ºæ¶ˆæ¯è®¤è¯ç  (MAC) æ¥ç¡®ä¿ **æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§**ã€‚HMAC å¸¸ç”¨äºç½‘ç»œåè®®å’Œè½¯ä»¶åº”ç”¨ä¸­çš„æ¶ˆæ¯è®¤è¯ã€‚
* **æ”¯æŒ**ï¼š[cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### æ—‹è½¬å‘¨æœŸ & è®¡åˆ’é”€æ¯å‘¨æœŸ

**é»˜è®¤æƒ…å†µä¸‹**ï¼Œæ¯ **90 å¤©**ï¼Œä½†å¯ä»¥ **è½»æ¾** ä¸” **å®Œå…¨è‡ªå®šä¹‰**ã€‚

"è®¡åˆ’é”€æ¯" å‘¨æœŸæ˜¯ä»ç”¨æˆ·è¯·æ±‚åˆ é™¤å¯†é’¥åˆ°å¯†é’¥è¢« **åˆ é™¤** çš„ **æ—¶é—´**ã€‚åˆ›å»ºå¯†é’¥åæ— æ³•æ›´æ”¹ï¼ˆé»˜è®¤ä¸º 1 å¤©ï¼‰ã€‚

### æšä¸¾

æ‹¥æœ‰ **åˆ—å‡ºå¯†é’¥çš„æƒé™**ï¼Œè¿™æ˜¯æ‚¨å¯ä»¥è®¿é—®å®ƒä»¬çš„æ–¹å¼ï¼š
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### æƒé™æå‡

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
