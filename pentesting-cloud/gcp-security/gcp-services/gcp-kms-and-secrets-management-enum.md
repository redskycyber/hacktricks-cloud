# GCP - KMS Manager Enum

<details>

<summary><strong>Soutenez HackTricks et obtenez des avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts Github.**

</details>

## KMS

[**Cloud Key Management Service**](https://cloud.google.com/kms/docs/) est un r√©f√©rentiel pour **stocker des cl√©s cryptographiques**, telles que celles utilis√©es pour **chiffrer et d√©chiffrer des fichiers sensibles**. Les cl√©s individuelles sont stock√©es dans des anneaux de cl√©s, et des autorisations granulaires peuvent √™tre appliqu√©es √† l'un ou l'autre niveau.

Les anneaux de cl√©s KMS sont **par d√©faut cr√©√©s comme globaux**, ce qui signifie que les cl√©s √† l'int√©rieur de cet anneau de cl√©s sont accessibles depuis n'importe quelle r√©gion. Cependant, il est possible de cr√©er des anneaux de cl√©s sp√©cifiques dans **des r√©gions sp√©cifiques**.

### Niveau de protection des cl√©s

* **Cl√©s logicielles** : Les cl√©s logicielles sont **cr√©√©es et g√©r√©es par KMS enti√®rement en logiciel**. Ces cl√©s ne sont **pas prot√©g√©es par un module de s√©curit√© mat√©riel (HSM)** et peuvent √™tre utilis√©es √† des fins de **test et de d√©veloppement**. Les cl√©s logicielles ne sont **pas recommand√©es pour une utilisation en production** car elles offrent une faible s√©curit√© et sont susceptibles d'√™tre attaqu√©es.
* **Cl√©s h√©berg√©es dans le cloud** : Les cl√©s h√©berg√©es dans le cloud sont **cr√©√©es et g√©r√©es par KMS** dans le cloud √† l'aide d'une infrastructure hautement disponible et fiable. Ces cl√©s sont **prot√©g√©es par des HSM**, mais les HSM ne sont **pas d√©di√©s √† un client sp√©cifique**. Les cl√©s h√©berg√©es dans le cloud conviennent √† la plupart des cas d'utilisation en production.
* **Cl√©s externes** : Les cl√©s externes sont **cr√©√©es et g√©r√©es en dehors de KMS**, et sont import√©es dans KMS pour une utilisation dans des op√©rations cryptographiques. Les cl√©s externes **peuvent √™tre stock√©es dans un module de s√©curit√© mat√©riel (HSM) ou une biblioth√®que logicielle, selon la pr√©f√©rence du client**.

### Objectifs des cl√©s

* **Chiffrement/d√©chiffrement sym√©trique** : Utilis√© pour **chiffrer et d√©chiffrer des donn√©es √† l'aide d'une seule cl√© pour les deux op√©rations**. Les cl√©s sym√©triques sont rapides et efficaces pour chiffrer et d√©chiffrer de grands volumes de donn√©es.
  * **Pris en charge** : [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Signature asym√©trique** : Utilis√©e pour une communication s√©curis√©e entre deux parties sans partager la cl√©. Les cl√©s asym√©triques se pr√©sentent sous forme de paire, compos√©e d'une **cl√© publique et d'une cl√© priv√©e**. La cl√© publique est partag√©e avec d'autres, tandis que la cl√© priv√©e est gard√©e secr√®te.
  * **Pris en charge** : [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **D√©chiffrement asym√©trique** : Utilis√© pour v√©rifier l'authenticit√© d'un message ou de donn√©es. Une signature num√©rique est cr√©√©e √† l'aide d'une cl√© priv√©e et peut √™tre v√©rifi√©e √† l'aide de la cl√© publique correspondante.
  * **Pris en charge** : [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Signature MAC** : Utilis√©e pour assurer l'int√©grit√© et l'authenticit√© des donn√©es en cr√©ant un code d'authentification de message (MAC) √† l'aide d'une cl√© secr√®te. HMAC est couramment utilis√© pour l'authentification de message dans les protocoles de r√©seau et les applications logicielles.
  * **Pris en charge** : [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### P√©riode de rotation et p√©riode programm√©e pour la destruction

Par **d√©faut**, tous les **90 jours** mais cela peut √™tre **facilement** et **compl√®tement personnalis√©**.

La p√©riode "Programm√©e pour la destruction" est le **temps depuis que l'utilisateur demande la suppression de la cl√©** et jusqu'√† ce que la cl√© soit **supprim√©e**. Elle ne peut pas √™tre modifi√©e apr√®s la cr√©ation de la cl√© (par d√©faut 1 jour).

### √ânum√©ration

En ayant les **autorisations pour lister les cl√©s**, voici comment y acc√©der :

```bash
# Liste des anneaux de cl√©s globaux disponibles
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# Liste des cl√©s √† l'int√©rieur d'un anneau de cl√©s
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Chiffrer un fichier en utilisant l'une de vos cl√©s
gcloud kms decrypt --ciphertext-file=[INFILE] \
    --plaintext-file=[OUTFILE] \
    --key [KEY] \
    --keyring [KEYRING] \
    --location global

# D√©chiffrer un fichier en utilisant l'une de vos cl√©s
gcloud kms decrypt --ciphertext-file=[INFILE] \
    --plaintext-file=[OUTFILE] \
    --key [KEY] \
    --keyring [KEYRING] \
    --location global
```

### √âl√©vation de privil√®ges

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>Soutenez HackTricks et obtenez des avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4