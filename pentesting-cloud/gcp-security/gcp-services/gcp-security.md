# GCP - Seguridad

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informaci贸n B谩sica

La Seguridad de Google Cloud Platform (GCP) abarca una **amplia suite de herramientas** y pr谩cticas dise帽adas para garantizar la **seguridad** de los recursos y datos dentro del entorno de Google Cloud, dividida en cuatro secciones principales: **Centro de Seguridad, Detecciones y Controles, Protecci贸n de Datos y Confianza Cero.**

## **Centro de Seguridad**

El Centro de Seguridad de Google Cloud Platform (GCP) (SCC) es una **herramienta de gesti贸n de seguridad y riesgos para los recursos de GCP** que permite a las organizaciones obtener visibilidad y control sobre sus activos en la nube. Ayuda a **detectar y responder a amenazas** ofreciendo an谩lisis de seguridad exhaustivos, **identificando configuraciones incorrectas**, asegurando el **cumplimiento** con est谩ndares de seguridad e **integr谩ndose** con otras herramientas de seguridad para la detecci贸n y respuesta automatizadas de amenazas.

* **Resumen**: Panel para **visualizar una descripci贸n general** de todos los resultados del Centro de Seguridad.
* Amenazas: \[Se requiere Premium] Panel para visualizar todas las **amenazas detectadas. Consulta m谩s sobre Amenazas a continuaci贸n**
* **Vulnerabilidades**: Panel para **visualizar las configuraciones incorrectas encontradas en la cuenta de GCP**.
* **Cumplimiento**: \[Se requiere Premium] Esta secci贸n permite **probar tu entorno de GCP contra varios controles de cumplimiento** (como PCI-DSS, NIST 800-53, CIS benchmarks...) sobre la organizaci贸n.
* **Activos**: Esta secci贸n **muestra todos los activos en uso**, muy 煤til para los administradores de sistemas (y tal vez para un atacante) para ver qu茅 se est谩 ejecutando en una sola p谩gina.
* **Hallazgos**: Esto **agrega** en una **tabla hallazgos** de diferentes secciones de Seguridad de GCP (no solo del Centro de Seguridad) para poder visualizar f谩cilmente hallazgos que importan.
* **Fuentes**: Muestra un **resumen de hallazgos** de todas las diferentes secciones de seguridad de GCP **por secci贸n**.
* **Postura**: \[Se requiere Premium] La Postura de Seguridad permite **definir, evaluar y monitorear la seguridad del entorno de GCP**. Funciona creando pol铆ticas que definen restricciones o limitaciones que controlan/monitorean los recursos en GCP. Hay varias plantillas de postura predefinidas que se pueden encontrar en [https://cloud.google.com/security-command-center/docs/security-posture-overview?authuser=2#predefined-policy](https://cloud.google.com/security-command-center/docs/security-posture-overview?authuser=2#predefined-policy)

### **Amenazas**

Desde la perspectiva de un atacante, esta es probablemente la **caracter铆stica m谩s interesante ya que podr铆a detectar al atacante**. Sin embargo, ten en cuenta que esta caracter铆stica requiere **Premium** (lo que significa que la empresa deber谩 pagar m谩s), por lo que **quiz谩s ni siquiera est茅 habilitada**.&#x20;

Existen 3 tipos de mecanismos de detecci贸n de amenazas:

* **Amenazas de Eventos**: Hallazgos producidos al coincidir eventos de **Cloud Logging** basados en **reglas creadas** internamente por Google. Tambi茅n puede escanear **registros de Google Workspace**.
* Es posible encontrar la descripci贸n de todas las [**reglas de detecci贸n en la documentaci贸n**](https://cloud.google.com/security-command-center/docs/concepts-event-threat-detection-overview?authuser=2#how\_works)
* **Amenazas de Contenedores**: Hallazgos producidos despu茅s de analizar el comportamiento de bajo nivel del kernel de contenedores.
* **Amenazas Personalizadas**: Reglas creadas por la empresa.

Es posible encontrar respuestas recomendadas a las amenazas detectadas de ambos tipos en [https://cloud.google.com/security-command-center/docs/how-to-investigate-threats?authuser=2#event\_response](https://cloud.google.com/security-command-center/docs/how-to-investigate-threats?authuser=2#event\_response)

### Enumeraci贸n

{% code overflow="wrap" %}
```bash
# Get a source
gcloud scc sources describe <org-number> --source=5678
## If the response is that the service is disabled or that the source is not found, then, it isn't enabled

# Get notifications
gcloud scc notifications list <org-number>

# Get findings (if not premium these are just vulnerabilities)
gcloud scc findings list <org-number>
```
## Detecciones y Controles

* **Chronicle SecOps**: Una suite avanzada de operaciones de seguridad dise帽ada para ayudar a los equipos a aumentar la velocidad e impacto de las operaciones de seguridad, incluyendo la detecci贸n, investigaci贸n y respuesta a amenazas.
* **reCAPTCHA Enterprise**: Un servicio que protege los sitios web de actividades fraudulentas como el scraping, el stuffing de credenciales y los ataques automatizados al distinguir entre usuarios humanos y bots.
* **Web Security Scanner**: Una herramienta de escaneo de seguridad automatizado que detecta vulnerabilidades y problemas de seguridad comunes en aplicaciones web alojadas en Google Cloud u otro servicio web.
* **Risk Manager**: Una herramienta de gobierno, riesgo y cumplimiento (GRC) que ayuda a las organizaciones a evaluar, documentar y comprender su postura de riesgo en Google Cloud.
* **Binary Authorization**: Un control de seguridad para contenedores que garantiza que solo se implementen im谩genes de contenedores confiables en cl煤steres de Kubernetes Engine de acuerdo con las pol铆ticas establecidas por la empresa.
* **Notificaciones de Asesoramiento**: Un servicio que proporciona alertas y avisos sobre posibles problemas de seguridad, vulnerabilidades y acciones recomendadas para mantener seguros los recursos.
* **Aprobaci贸n de Acceso**: Una funci贸n que permite a las organizaciones requerir aprobaci贸n expl铆cita antes de que los empleados de Google puedan acceder a sus datos o configuraciones, proporcionando una capa adicional de control y auditabilidad.
* **Managed Microsoft AD**: Un servicio que ofrece Active Directory (AD) de Microsoft administrado que permite a los usuarios utilizar sus aplicaciones y cargas de trabajo existentes dependientes de Microsoft AD en Google Cloud.

## Protecci贸n de Datos

* **Protecci贸n de Datos Sensibles**: Herramientas y pr谩cticas destinadas a salvaguardar datos sensibles, como informaci贸n personal o propiedad intelectual, contra accesos o exposiciones no autorizados.
* **Prevenci贸n de P茅rdida de Datos (DLP)**: Un conjunto de herramientas y procesos utilizados para identificar, monitorear y proteger datos en uso, en movimiento y en reposo mediante inspecci贸n profunda de contenido y la aplicaci贸n de un conjunto integral de reglas de protecci贸n de datos.
* **Servicio de Autoridad de Certificaci贸n**: Un servicio escalable y seguro que simplifica y automatiza la gesti贸n, implementaci贸n y renovaci贸n de certificados SSL/TLS para servicios internos y externos.
* **Gesti贸n de Claves**: Un servicio basado en la nube que le permite gestionar claves criptogr谩ficas para sus aplicaciones, incluida la creaci贸n, importaci贸n, rotaci贸n, uso y destrucci贸n de claves de cifrado. M谩s informaci贸n en:

{% content-ref url="gcp-kms-enum.md" %}
[gcp-kms-enum.md](gcp-kms-enum.md)
{% endcontent-ref %}

* **Gestor de Certificados**: Un servicio que gestiona e implementa certificados SSL/TLS, garantizando conexiones seguras y cifradas a sus servicios web y aplicaciones.
* **Gestor de Secretos**: Un sistema de almacenamiento seguro y conveniente para claves API, contrase帽as, certificados y otros datos sensibles, que permite el acceso y la gesti贸n f谩ciles y seguros de estos secretos en aplicaciones. M谩s informaci贸n en:

{% content-ref url="../../gcp-pentesting/gcp-services/gcp-secrets-manager-enum.md" %}
[gcp-secrets-manager-enum.md](../../gcp-pentesting/gcp-services/gcp-secrets-manager-enum.md)
{% endcontent-ref %}

## Confianza Cero

* **BeyondCorp Enterprise**: Una plataforma de seguridad de confianza cero que permite el acceso seguro a aplicaciones internas sin la necesidad de una VPN tradicional, bas谩ndose en la verificaci贸n de la confianza del usuario y del dispositivo antes de otorgar acceso.
* **Solucionador de Problemas de Pol铆ticas**: Una herramienta dise帽ada para ayudar a los administradores a comprender y resolver problemas de acceso en su organizaci贸n al identificar por qu茅 un usuario tiene acceso a ciertos recursos o por qu茅 se deneg贸 el acceso, ayudando as铆 en la aplicaci贸n de pol铆ticas de confianza cero.
* **Proxy con Conciencia de Identidad (IAP)**: Un servicio que controla el acceso a aplicaciones en la nube y m谩quinas virtuales que se ejecutan en Google Cloud, localmente u en otras nubes, bas谩ndose en la identidad y el contexto de la solicitud en lugar de en la red desde la cual se origina la solicitud.
* **Controles de Servicio de VPC**: Per铆metros de seguridad que proporcionan capas adicionales de protecci贸n a recursos y servicios alojados en la Virtual Private Cloud (VPC) de Google Cloud, evitando la exfiltraci贸n de datos y proporcionando un control de acceso granular.
* **Gestor de Contexto de Acceso**: Parte de BeyondCorp Enterprise de Google Cloud, esta herramienta ayuda a definir y hacer cumplir pol铆ticas de control de acceso detalladas basadas en la identidad del usuario y el contexto de su solicitud, como el estado de seguridad del dispositivo, la direcci贸n IP, y m谩s.
