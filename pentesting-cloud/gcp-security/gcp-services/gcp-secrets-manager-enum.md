# GCP - Enumeraci贸n de Secrets Manager

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Red Team de HackTricks en AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Secret Manager

Google [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/) es una soluci贸n tipo b贸veda para almacenar contrase帽as, claves API, certificados, archivos (m谩ximo 64KB) y otros datos sensibles.

Un secreto puede tener **diferentes versiones que almacenan datos diferentes**.

Los secretos por **defecto** est谩n **encriptados usando una clave gestionada por Google**, pero es **posible seleccionar una clave de KMS** para encriptar el secreto.

En cuanto a la **rotaci贸n**, es posible configurar **mensajes para ser enviados a pub-sub cada cierto n煤mero de d铆as**, el c贸digo que escucha esos mensajes puede **rotar el secreto**.

Es posible configurar un d铆a para la **eliminaci贸n autom谩tica**, cuando se **alcanza** el d铆a indicado, el **secreto se eliminar谩 autom谩ticamente**.

### Enumeraci贸n
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### Escalada de privilegios

En la siguiente p谩gina puedes ver c贸mo **abusar de los permisos de secretmanager para escalar privilegios.**

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### Post Explotaci贸n

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md" %}
[gcp-secretmanager-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md" %}
[gcp-secret-manager-persistence.md](../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md)
{% endcontent-ref %}

### Uso indebido de rotaci贸n

Un atacante podr铆a actualizar el secreto para **detener las rotaciones** (para que no se modifique), o **hacer rotaciones mucho menos frecuentes** (para que el secreto no se modifique) o **publicar el mensaje de rotaci贸n en un pub/sub diferente**, o modificar el c贸digo de rotaci贸n que se est谩 ejecutando (esto ocurre en un servicio diferente, probablemente en una Funci贸n en la Nube, por lo que el atacante necesitar谩 acceso privilegiado sobre la Funci贸n en la Nube u otro servicio)
