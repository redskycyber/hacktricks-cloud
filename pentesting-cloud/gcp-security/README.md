# GCP рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рдЬрдорд╛ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ.

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

**GCP рдкрд░рд┐рд╡реЗрд╢ рдХреА рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ**, рдЖрдкрдХреЛ рдХреБрдЫ **рдореВрд▓ рдмрд╛рддреЗрдВ рдЬрд╛рдирдиреА рдЪрд╛рд╣рд┐рдП** рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ рдХрд┐ рдЖрдкрдХреЛ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ, рдХреИрд╕реЗ рдорд┐рд╕рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рдиреНрд╕ рдХреЛ рдвреВрдВрдврдирд╛ рд╣реИ рдФрд░ рдЙрдирдХрд╛ рд╢реЛрд╖рдг рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИред

**рд╕рдВрдЧрдарди** рдХреА рд╣рд╛рдпрд░рд╛рд░реНрдХреА, **рдЕрдиреБрдорддрд┐рдпрд╛рдВ** рдФрд░ рдЕрдиреНрдп рдореВрд▓ рдЕрд╡рдзрд╛рд░рдгрд╛рдПрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореЗрдВ рд╕рдордЭрд╛рдИ рдЧрдИ рд╣реИрдВ:

{% content-ref url="gcp-basic-information.md" %}
[gcp-basic-information.md](gcp-basic-information.md)
{% endcontent-ref %}

## рд╕реАрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд▓реИрдмреНрд╕

* [https://gcpgoat.joshuajebaraj.com/](https://gcpgoat.joshuajebaraj.com/)
* [https://github.com/ine-labs/GCPGoat](https://github.com/ine-labs/GCPGoat)
* [https://github.com/lacioffi/GCP-pentest-lab/](https://github.com/lacioffi/GCP-pentest-lab/)
* [https://github.com/carlospolop/gcp\_privesc\_scripts](https://github.com/carlospolop/gcp\_privesc\_scripts)

## GCP рдкреЗрдВрдЯреЗрд╕реНрдЯрд░/рд░реЗрдб рдЯреАрдо рдореЗрдердбреЛрд▓реЙрдЬреА

GCP рдкрд░рд┐рд╡реЗрд╢ рдХрд╛ рдСрдбрд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЬрд╛рдирдирд╛ рдмрд╣реБрдд рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ: рдХреМрди рд╕реА **рд╕реЗрд╡рд╛рдПрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИрдВ**, рдХреНрдпрд╛ **рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ**, рдХрд┐рд╕рдХреЗ рдкрд╛рд╕ рдХрд┐рд╕ рдЪреАрдЬрд╝ рдХреА **рдкрд╣реБрдВрдЪ** рд╣реИ, рдФрд░ GCP рдХреА рдЖрдВрддрд░рд┐рдХ рд╕реЗрд╡рд╛рдПрдВ рдФрд░ **рдмрд╛рд╣рд░реА рд╕реЗрд╡рд╛рдПрдВ** рдХреИрд╕реЗ рдЬреБрдбрд╝реА рд╣реБрдИ рд╣реИрдВред

рд░реЗрдб рдЯреАрдо рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, GCP рдкрд░рд┐рд╡реЗрд╢ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХрд╛ **рдкрд╣рд▓рд╛ рдХрджрдо** рдХреБрдЫ **рдкреНрд░рдорд╛рдг-рдкрддреНрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛** рд╣реИред рдпрд╣рд╛рдВ рдХреБрдЫ рд╡рд┐рдЪрд╛рд░ рд╣реИрдВ рдХрд┐ рдЖрдк рдРрд╕рд╛ рдХреИрд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* github (рдпрд╛ рдЗрд╕реА рддрд░рд╣) рдореЗрдВ **рд▓реАрдХ** - OSINT
* **рд╕рд╛рдорд╛рдЬрд┐рдХ** рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ (рдкреЗрдЬ рджреЗрдЦреЗрдВ [**Workspace Security**](../workspace-security.md))
* **рдкрд╛рд╕рд╡рд░реНрдб** рдкреБрди: рдЙрдкрдпреЛрдЧ (рдкрд╛рд╕рд╡рд░реНрдб рд▓реАрдХ)
* GCP-Hosted Applications рдореЗрдВ Vulnerabilities
* [**Server Side Request Forgery**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд╕рд╛рде
* **Local File Read**
* `/home/USERNAME/.config/gcloud/*`
* `C:\Users\USERNAME\.config\gcloud\*`
* 3rd parties **breached**
* **рдЖрдВрддрд░рд┐рдХ** рдХрд░реНрдордЪрд╛рд░реА

рдпрд╛ **рдЙрдЬрд╛рдЧрд░ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рд╕реЗрд╡рд╛ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдХреЗ**:

{% content-ref url="gcp-unaunthenticated-enum-and-access/" %}
[gcp-unaunthenticated-enum-and-access](gcp-unaunthenticated-enum-and-access/)
{% endcontent-ref %}

рдпрд╛ рдпрджрд┐ рдЖрдк **рд╕рдореАрдХреНрд╖рд╛** рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдЖрдк рдЗрди рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ **рдкреНрд░рдорд╛рдг-рдкрддреНрд░ рдорд╛рдВрдЧ рд╕рдХрддреЗ рд╣реИрдВ**:

{% content-ref url="gcp-permissions-for-a-pentest.md" %}
[gcp-permissions-for-a-pentest.md](gcp-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
рдкреНрд░рдорд╛рдг-рдкрддреНрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ **рд╡реЗ рдкреНрд░рдорд╛рдг-рдкрддреНрд░ рдХрд┐рд╕рдХреЗ рд╣реИрдВ**, рдФрд░ **рдЙрдирдХреА рдХрд┐рд╕ рдЪреАрдЬрд╝ рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдХреБрдЫ рдореВрд▓ рдЧрдгрдирд╛ рдХрд░рдиреА рд╣реЛрдЧреА:
{% endhint %}

## рдореВрд▓ рдЧрдгрдирд╛

### **SSRF**

GCP рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЛ **рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд hacktricks рдкреЗрдЬ рджреЗрдЦреЗрдВ:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Whoami

GCP рдореЗрдВ рдЖрдк рдХрдИ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк рдХреМрди рд╣реИрдВ:
```bash
#If you are inside a compromise machine
gcloud auth list
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=$(gcloud auth print-access-token)" https://www.googleapis.com/oauth2/v1/tokeninfo
gcloud auth print-identity-token #Get info from the token

#If you compromised a metadata token or somehow found an OAuth token
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=<token>" https://www.googleapis.com/oauth2/v1/tokeninfo
```
### рд╕рдВрдЧрдарди рдЧрдгрдирд╛
```bash
# Get organizations
gcloud organizations list #The DIRECTORY_CUSTOMER_ID is the Workspace ID
gcloud resource-manager folders list --organization <org_number> # Get folders
gcloud projects list # Get projects
```
### рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рдФрд░ IAM рдПрдиреНрдпреБрдореЗрд░реЗрд╢рди

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдВ рд╣реИрдВ, рддреЛ **GCP рдЦрд╛рддреЗ рдХреЗ рднреАрддрд░ рдкреНрд░рддреНрдпреЗрдХ рдЗрдХрд╛рдИ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛** рдЖрдкрдХреЛ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ рдХрд┐ рдЖрдк рдФрд░ рдЕрдиреНрдп рдкрд╣рдЪрд╛рди рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреИрд╕реЗ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ IAM рдХреЛ рдПрдиреНрдпреБрдореЗрд░реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдВ рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрдиреНрд╣реЗрдВ **рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдХреЗ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рдПрдиреНрдпреБрдореЗрд░реЗрд╢рди рдФрд░ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕рд┐рдВрдЧ **рдХреИрд╕реЗ рдХрд░реЗрдВ** рдЗрд╕рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
рдЕрдм рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдЕрдкрдиреА рдкреНрд░рдорд╛рдгрд┐рдХрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ **рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рд╣реИ** (рдФрд░ рдпрджрд┐ рдЖрдк рдПрдХ рд░реЗрдб рдЯреАрдо рд╣реИрдВ рддреЛ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдк **рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓реЗ рд╣реИрдВ**), рддреЛ рдпрд╣ рд╕рдордп рд╣реИ рдХрд┐ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рдП рдХрд┐ рдХреМрди рд╕реА рд╕реЗрд╡рд╛рдПрдВ рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИрдВред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЦрдВрдб рдореЗрдВ рдЖрдк рдХреБрдЫ **рд╕рд╛рдорд╛рдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдПрдиреНрдпреБрдореЗрд░реЗрд╢рди рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред**
{% endhint %}

## рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдПрдиреНрдпреБрдореЗрд░реЗрд╢рди, рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди рдФрд░ рдкрд░реНрд╕рд┐рд╕реНрдЯреЗрдВрд╕

GCP рдореЗрдВ рдЕрджреНрднреБрдд рдорд╛рддреНрд░рд╛ рдореЗрдВ рд╕реЗрд╡рд╛рдПрдВ рд╣реИрдВ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдкрд░ рдЖрдкрдХреЛ **рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА, рдПрдиреНрдпреБрдореЗрд░реЗрд╢рди** рдЪреАрдЯрд╢реАрдЯреНрд╕, **рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓рдиреЗ рд╕реЗ рдмрдЪрдиреЗ**, **рдкрд░реНрд╕рд┐рд╕реНрдЯреЗрдВрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ**, рдФрд░ рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдиреНрдп **рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди** рдЯреНрд░рд┐рдХреНрд╕ рдорд┐рд▓реЗрдВрдЧреА:

{% content-ref url="gcp-services/" %}
[gcp-services](gcp-services/)
{% endcontent-ref %}

{% content-ref url="gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](gcp-non-svc-persistance.md)
{% endcontent-ref %}

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдкрдХреЛ рд╕рднреА рдХрд╛рдо **рдореИрдиреНрдпреБрдЕрд▓реА** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ **рдирд╣реАрдВ** рд╣реИ, рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЗ рдиреАрдЪреЗ рдЖрдкрдХреЛ [**рдСрдЯреЛрдореИрдЯрд┐рдХ рдЯреВрд▓реНрд╕**](./#automatic-tools) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ **рдЦрдВрдб рдорд┐рд▓реЗрдЧрд╛**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдЪрд░рдг рдореЗрдВ рдЖрдкрдиреЗ рд╢рд╛рдпрдж **рдФрд░ рдЕрдзрд┐рдХ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЙрдЬрд╛рдЧрд░ рд╣реИрдВ,** рдЖрдк рдЙрдирдХрд╛ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="gcp-unaunthenticated-enum-and-access/" %}
[gcp-unaunthenticated-enum-and-access](gcp-unaunthenticated-enum-and-access/)
{% endcontent-ref %}

## рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдирд╛

рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдкрдиреЗ рдХреБрдЫ рдХреНрд▓рд╛рдЙрдб рдкреНрд░рдорд╛рдгрд┐рдХрддрд╛рдПрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реА рд╣реИрдВ рдпрд╛ рдХреНрд▓рд╛рдЙрдб рдХреЗ рднреАрддрд░ рдХреБрдЫ рд╕реЗрд╡рд╛ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ, рддреЛ рд╕рдмрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХрд╛ **рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛** рд╣реИ рдЬреЛ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдЦрд╛рддреЗ рдХреЗ рдкрд╛рд╕ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдкрд╣рд▓реА рдмрд╛рдд рдЬреЛ рдЖрдкрдХреЛ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рд╡рд╣ рд╣реИ рдЕрдкрдиреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рдПрдиреНрдпреБрдореЗрд░реЗрд╢рди рдХрд░рдирд╛ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдПрдиреНрдпреБрдореЗрд░реЗрд╢рди рдХреЗ рджреМрд░рд╛рди, рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ **рдЕрдиреБрдорддрд┐рдпрд╛рдВ "рд╕рдВрдЧрдарди" рдХреЗ рдЙрдЪреНрдЪрддрдо рд╕реНрддрд░ рдкрд░ рднреА рд╕реЗрдЯ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ**ред

{% content-ref url="gcp-privilege-escalation/" %}
[gcp-privilege-escalation](gcp-privilege-escalation/)
{% endcontent-ref %}

## рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрдЬрд╛рдЧрд░ рд╕реЗрд╡рд╛рдПрдВ

GCP рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдПрдиреНрдпреБрдореЗрд░реЗрд╢рди рдХрд░рддреЗ рд╕рдордп рдЖрдкрдиреЗ рдХреБрдЫ рдРрд╕реА рд╕реЗрд╡рд╛рдПрдВ рдкрд╛рдИ рд╣реЛрдВрдЧреА рдЬреЛ **рдЗрдВрдЯрд░рдиреЗрдЯ рдХреЗ рд▓рд┐рдП рддрддреНрд╡реЛрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд░рд╣реА рд╣реИрдВ** (VM/Containers рдкреЛрд░реНрдЯреНрд╕, рдбреЗрдЯрд╛рдмреЗрд╕ рдпрд╛ рдХрддрд╛рд░ рд╕реЗрд╡рд╛рдПрдВ, рд╕реНрдиреИрдкрд╢реЙрдЯреНрд╕ рдпрд╛ рдмрдХреЗрдЯреНрд╕...).\
рдкреЗрдВрдЯреЗрд╕реНрдЯрд░/рд░реЗрдб рдЯреАрдорд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдкрдХреЛ рд╣рдореЗрд╢рд╛ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЖрдк **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА / рдХрдордЬреЛрд░рд┐рдпрд╛рдВ** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЖрдкрдХреЛ **AWS рдЦрд╛рддреЗ рдореЗрдВ рдЖрдЧреЗ рдХреА рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдЗрд╕ рдкреБрд╕реНрддрдХ рдореЗрдВ рдЖрдкрдХреЛ **рдЬрд╛рдирдХрд╛рд░реА** рдорд┐рд▓рдиреА рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреИрд╕реЗ **рдЙрдЬрд╛рдЧрд░ AWS рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЦреЛрдЬреЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рдЬрд╛рдВрдЪреЗрдВ**ред рдЙрдЬрд╛рдЧрд░ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ **рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдореИрдВ рдЖрдкрдХреЛ **рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реЗрд╡рд╛** рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдВ **рдЦреЛрдЬ** рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреВрдВрдЧрд╛:

{% embed url="https://book.hacktricks.xyz/" %}

## рдСрдЯреЛрдореИрдЯрд┐рдХ рдЯреВрд▓реНрд╕

* **GCloud рдХрдВрд╕реЛрд▓** рдореЗрдВ, [https://console.cloud.google.com/iam-admin/asset-inventory/dashboard](https://console.cloud.google.com/iam-admin/asset-inventory/dashboard) рдкрд░ рдЖрдк рдкреНрд░реЛрдЬреЗрдХреНрдЯ рджреНрд╡рд╛рд░рд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдФрд░ IAMs рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред
* рдпрд╣рд╛рдВ рдЖрдк рдЗрд╕ API рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: [https://cloud.google.com/asset-inventory/docs/supported-asset-types](https://cloud.google.com/asset-inventory/docs/supported-asset-types)
* рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреМрди рд╕реЗ **рдЯреВрд▓реНрд╕** [**рдХрдИ рдХреНрд▓рд╛рдЙрдбреНрд╕ рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ**](../pentesting-cloud-methodology.md)ред
* [**gcp\_scanner**](https://github.com/google/gcp\_scanner): рдпрд╣ рдПрдХ GCP рд╕рдВрд╕рд╛рдзрди рд╕реНрдХреИрдирд░ рд╣реИ рдЬреЛ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдХреБрдЫ рдкреНрд░рдорд╛рдгрд┐рдХрддрд╛рдПрдВ GCP рдкрд░ рдХрд┐рд╕ **рд╕реНрддрд░ рдХреА рдкрд╣реБрдВрдЪ рд░рдЦрддреА рд╣реИрдВ**ред
```bash
# Install
git clone https://github.com/google/gcp_scanner.git
cd gcp_scanner
virtualenv -p python3 venv
source venv/bin/activate
pip install -r requirements.txt
# Execute with gcloud creds
python3 __main__.py -o /tmp/output/ -g "$HOME/.config/gcloud"
```
* [**gcp\_enum**](https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp\_enum): gcloud cli рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ GCP рдкрд░реНрдпрд╛рд╡рд░рдг рдХрд╛ рдЕрдиреБрдХреНрд░рдордг рдХрд░рдиреЗ рд╡рд╛рд▓реА Bash рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдлрд╛рдЗрд▓ рдореЗрдВ рд╕рд╣реЗрдЬрдирд╛ред
* [**GCP-IAM-Privilege-Escalation**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation): рдЙрдЪреНрдЪ IAM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рдЕрдиреБрдХреНрд░рдордг рдХрд░рдиреЗ рдФрд░ GCP рдореЗрдВ рдЙрдирдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ (рдореИрдВ рдЕрдиреБрдХреНрд░рдордг рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛ рдирд╣реАрдВ рдкрд╛рдпрд╛)ред

## gcloud config & debug
```bash
# Login so gcloud can use your credentials
gcloud auth login
gcloud config set project security-devbox
gcloud auth print-access-token

# Login so SDKs can use your user credentials
gcloud auth application-default login
gcloud auth application-default set-quota-project security-devbox
gcloud auth application-default print-access-token

# Update gcloud
gcloud components update
```
### gcloud, gsutil... рдиреЗрдЯрд╡рд░реНрдХ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ

рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдЖрдк **`gcloud`** cli рдХреЗ рд╕рд╛рде **рдкреИрд░рд╛рдореАрдЯрд░** **`--log-http`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯреВрд▓ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ **рд░рд┐рдХреНрд╡реЗрд╕реНрдЯреНрд╕** рдХреЛ **рдкреНрд░рд┐рдВрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдк рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ рдХрд┐ рд▓реЙрдЧреНрд╕ рдЯреЛрдХрди рдореВрд▓реНрдп рдХреЛ рд░рд┐рдбреИрдХреНрдЯ рдХрд░реЗрдВ рддреЛ `gcloud config set log_http_redact_token false` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рдВрдЪрд╛рд░ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
gcloud config set proxy/address 127.0.0.1
gcloud config set proxy/port 8080
gcloud config set proxy/type http
gcloud config set auth/disable_ssl_validation True

# If you don't want to completely disable ssl_validation use:
gcloud config set core/custom_ca_certs_file cert.pem

# Back to normal
gcloud config unset proxy/address
gcloud config unset proxy/port
gcloud config unset proxy/type
gcloud config unset auth/disable_ssl_validation
gcloud config unset core/custom_ca_certs_file
```
### gcloud рдореЗрдВ OAuth рдЯреЛрдХрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛

**рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реЗ рдирд┐рдХрд╛рд▓реЗ рдЧрдП рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯ OAuth рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЖрдк рдмрд╕ рдпрд╣ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Via env vars
export CLOUDSDK_AUTH_ACCESS_TOKEN=<token>
gcloud projects list

# Via setup
echo "<token>" > /some/path/to/token
gcloud config set auth/access_token_file /some/path/to/token
gcloud projects list
gcloud config unset auth/access_token_file
```
## рд╕рдВрджрд░реНрдн

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рддрд░рдХреАрдмреЗрдВ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
