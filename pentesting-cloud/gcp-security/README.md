# GCP Pentesting

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å¾—ã‚‹ï¼</strong></summary>

* ã‚‚ã—ã€ã‚ãªãŸã®**ä¼šç¤¾ã‚’ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã§å®£ä¼ã—ãŸã„**å ´åˆã‚„ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„**å ´åˆã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¥½ã—ã¿ã¾ã—ã‚‡ã†
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¾ã—ã‚‡ã† ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€PRã‚’æå‡ºã—ã¦** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ã¨** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«å‚åŠ ã—ã¾ã—ã‚‡ã†ã€‚**

</details>

## åŸºæœ¬æƒ…å ±

**GCP**ç’°å¢ƒã®**ãƒšãƒ³ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã™ã‚‹å‰ã«**ã€ä½•ã‚’ã™ã¹ãã‹ã€ãƒŸã‚¹ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹æ–¹æ³•ã€ãã‚Œã‚‰ã‚’æ‚ªç”¨ã™ã‚‹æ–¹æ³•ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã€ã„ãã¤ã‹ã®**åŸºæœ¬çš„ãªäº‹é …ã‚’çŸ¥ã£ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚

çµ„ç¹”ã®éšå±¤ã€æ¨©é™ãªã©ã®æ¦‚å¿µã«ã¤ã„ã¦ã¯ã€æ¬¡ã®ãƒªãƒ³ã‚¯ã§èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ï¼š

{% content-ref url="gcp-basic-information.md" %}
[gcp-basic-information.md](gcp-basic-information.md)
{% endcontent-ref %}

## å­¦ç¿’ç”¨ã®ãƒ©ãƒœ

* [https://gcpgoat.joshuajebaraj.com/](https://gcpgoat.joshuajebaraj.com/)
* [https://github.com/ine-labs/GCPGoat](https://github.com/ine-labs/GCPGoat)
* [https://github.com/carlospolop/gcp\_privesc\_scripts](https://github.com/carlospolop/gcp\_privesc\_scripts)

## GCPãƒšãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼/ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã®æ–¹æ³•è«–

GCPç’°å¢ƒã‚’ç›£æŸ»ã™ã‚‹ãŸã‚ã«ã¯ã€ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹**ã‚µãƒ¼ãƒ“ã‚¹**ã€**å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®**ã€èª°ãŒ**ä½•ã«ã‚¢ã‚¯ã‚»ã‚¹**ã§ãã‚‹ã‹ã€å†…éƒ¨ã®GCPã‚µãƒ¼ãƒ“ã‚¹ã¨**å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹**ãŒã©ã®ã‚ˆã†ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ã‚’çŸ¥ã‚‹ã“ã¨ãŒéå¸¸ã«é‡è¦ã§ã™ã€‚

ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã®è¦–ç‚¹ã‹ã‚‰ã¯ã€GCPç’°å¢ƒã‚’**ä¾µå®³ã™ã‚‹æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—**ã¯ã€ã„ãã¤ã‹ã®**è³‡æ ¼æƒ…å ±ã‚’å…¥æ‰‹ã™ã‚‹**ã“ã¨ã§ã™ã€‚ä»¥ä¸‹ã«ã€ãã‚Œã‚’è¡Œã†ãŸã‚ã®ã„ãã¤ã‹ã®ã‚¢ã‚¤ãƒ‡ã‚¢ãŒã‚ã‚Šã¾ã™ï¼š

* GitHubï¼ˆã¾ãŸã¯åŒæ§˜ã®å ´æ‰€ï¼‰ã§ã®**æƒ…å ±æ¼æ´©** - OSINT
* **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°**ï¼ˆ[**Workspace Security**](../workspace-security.md)ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ï¼‰
* **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å†åˆ©ç”¨**ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æ¼æ´©ï¼‰
* GCPãƒ›ã‚¹ãƒˆã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§
* [**ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒª**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf)ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
* **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Š**
* `/home/USERNAME/.config/gcloud/*`
* `C:\Users\USERNAME\.config\gcloud\*`
* ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãŒ**ä¾µå®³ã•ã‚ŒãŸ**å ´åˆ
* **å†…éƒ¨ã®**å¾“æ¥­å“¡

ã¾ãŸã¯ã€**èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚µãƒ¼ãƒ“ã‚¹**ã‚’ä¾µå®³ã™ã‚‹ã“ã¨ã§ï¼š

{% content-ref url="gcp-unauthenticated-enum/" %}
[gcp-unauthenticated-enum](gcp-unauthenticated-enum/)
{% endcontent-ref %}

ã¾ãŸã¯ã€**ãƒ¬ãƒ“ãƒ¥ãƒ¼**ã‚’è¡Œã£ã¦ã„ã‚‹å ´åˆã¯ã€æ¬¡ã®å½¹å‰²ã§**è³‡æ ¼æƒ…å ±ã‚’è¦æ±‚**ã™ã‚‹ã ã‘ã§ã™ï¼š

{% content-ref url="gcp-permissions-for-a-pentest.md" %}
[gcp-permissions-for-a-pentest.md](gcp-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
è³‡æ ¼æƒ…å ±ã‚’å…¥æ‰‹ã—ãŸå¾Œã€ãã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ãŒ**èª°ã«å±ã—ã¦ã„ã‚‹ã‹**ã€ãã—ã¦**ä½•ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹**ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€åŸºæœ¬çš„ãªåˆ—æŒ™ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
{% endhint %}

## åŸºæœ¬çš„ãªåˆ—æŒ™

### **SSRF**

GCPãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®åˆ—æŒ™æ–¹æ³•ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€æ¬¡ã®ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã®ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Whoami

GCPã§ã¯ã€æ¬¡ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è©¦ã—ã¦è‡ªåˆ†ãŒèª°ã§ã‚ã‚‹ã‹ã‚’æ¨æ¸¬ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
#If you are inside a compromise machine
gcloud auth list
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=$(gcloud auth print-access-token)" https://www.googleapis.com/oauth2/v1/tokeninfo
gcloud auth print-identity-token #Get info from the token

#If you compromised a metadata token or somehow found an OAuth token
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=<token>" https://www.googleapis.com/oauth2/v1/tokeninfo
```
### çµ„ç¹”ã®åˆ—æŒ™

To enumerate an organization in GCP, you can use the following techniques:

GCPã§çµ„ç¹”ã‚’åˆ—æŒ™ã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### 1. Google Cloud Directory API

The Google Cloud Directory API allows you to retrieve information about the organization, including its name, ID, and domain. You can use this API to gather valuable information for further enumeration.

Google Cloud Directory APIã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€çµ„ç¹”ã®åå‰ã€IDã€ãƒ‰ãƒ¡ã‚¤ãƒ³ãªã©ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®APIã‚’ä½¿ç”¨ã—ã¦ã€ã•ã‚‰ãªã‚‹åˆ—æŒ™ã®ãŸã‚ã®è²´é‡ãªæƒ…å ±ã‚’åé›†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### 2. Google Cloud Resource Manager API

The Google Cloud Resource Manager API provides methods to retrieve and manage GCP resources, including organizations. You can use this API to list all the projects and folders within an organization, which can help you understand the structure and scope of the organization.

Google Cloud Resource Manager APIã¯ã€çµ„ç¹”ã‚’å«ã‚€GCPãƒªã‚½ãƒ¼ã‚¹ã‚’å–å¾—ãŠã‚ˆã³ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã®APIã‚’ä½¿ç”¨ã—ã¦ã€çµ„ç¹”å†…ã®ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒªã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€çµ„ç¹”ã®æ§‹é€ ã¨ç¯„å›²ã‚’ç†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

#### 3. Google Cloud Asset Inventory

Google Cloud Asset Inventory provides a comprehensive view of the assets in your organization, including resources, IAM policies, and access control lists (ACLs). You can use this service to gather information about the organization's assets and their permissions.

Google Cloud Asset Inventoryã¯ã€çµ„ç¹”å†…ã®ãƒªã‚½ãƒ¼ã‚¹ã€IAMãƒãƒªã‚·ãƒ¼ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒªã‚¹ãƒˆï¼ˆACLï¼‰ãªã©ã€çµ„ç¹”ã®ã‚¢ã‚»ãƒƒãƒˆã®åŒ…æ‹¬çš„ãªãƒ“ãƒ¥ãƒ¼ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã€çµ„ç¹”ã®ã‚¢ã‚»ãƒƒãƒˆã¨ãã®æ¨©é™ã«é–¢ã™ã‚‹æƒ…å ±ã‚’åé›†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### 4. Google Cloud IAM

Google Cloud IAM (Identity and Access Management) allows you to manage access to GCP resources. By analyzing the IAM policies and roles assigned to different users and service accounts within the organization, you can gain insights into the organization's access control model.

Google Cloud IAMï¼ˆIdentity and Access Managementï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€GCPãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚çµ„ç¹”å†…ã®ç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸIAMãƒãƒªã‚·ãƒ¼ã¨ãƒ­ãƒ¼ãƒ«ã‚’åˆ†æã™ã‚‹ã“ã¨ã§ã€çµ„ç¹”ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ¢ãƒ‡ãƒ«ã«ã¤ã„ã¦ã®æ´å¯Ÿã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### 5. Google Cloud Identity-Aware Proxy (IAP)

Google Cloud Identity-Aware Proxy (IAP) provides secure access to applications running on GCP. By analyzing the IAP configurations, you can identify the applications and services accessible within the organization.

Google Cloud Identity-Aware Proxyï¼ˆIAPï¼‰ã¯ã€GCPã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®å®‰å…¨ãªã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚IAPã®è¨­å®šã‚’åˆ†æã™ã‚‹ã“ã¨ã§ã€çµ„ç¹”å†…ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### 6. Google Cloud DNS

Google Cloud DNS allows you to manage DNS zones and records. By enumerating the DNS records associated with the organization's domain, you can gather information about the organization's infrastructure and services.

Google Cloud DNSã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€DNSã‚¾ãƒ¼ãƒ³ã¨ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚çµ„ç¹”ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«é–¢é€£ã™ã‚‹DNSãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’åˆ—æŒ™ã™ã‚‹ã“ã¨ã§ã€çµ„ç¹”ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã¨ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã™ã‚‹æƒ…å ±ã‚’åé›†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

These techniques can help you gather valuable information about the organization's structure, assets, access control, and infrastructure, which can be useful for further penetration testing and security assessments.

ã“ã‚Œã‚‰ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯ã€çµ„ç¹”ã®æ§‹é€ ã€ã‚¢ã‚»ãƒƒãƒˆã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€ãŠã‚ˆã³ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã«é–¢ã™ã‚‹è²´é‡ãªæƒ…å ±ã‚’åé›†ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚ã“ã‚Œã¯ã€ã•ã‚‰ãªã‚‹ä¾µå…¥ãƒ†ã‚¹ãƒˆã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã«å½¹ç«‹ã¤ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
```bash
# Get organizations
gcloud organizations list #The DIRECTORY_CUSTOMER_ID is the Workspace ID
gcloud resource-manager folders list --organization <org_number> # Get folders
gcloud projects list # Get projects
```
### ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¨IAMã®åˆ—æŒ™

ååˆ†ãªæ¨©é™ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã€GCPã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®å„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ç‰¹æ¨©ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€è‡ªåˆ†ã‚„ä»–ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒä½•ãŒã§ãã‚‹ã‹ã€ç‰¹æ¨©ã‚’ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ãƒˆã™ã‚‹æ–¹æ³•ã‚’ç†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

IAMã‚’åˆ—æŒ™ã™ã‚‹ãŸã‚ã®ååˆ†ãªæ¨©é™ãŒãªã„å ´åˆã€ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒã‚’è¡Œã£ã¦ãã‚Œã‚‰ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã§ã€**åˆ—æŒ™ã¨ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒã®æ–¹æ³•**ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
ä»Šã€ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã«é–¢ã™ã‚‹æƒ…å ±ãŒã‚ã‚‹ï¼ˆã‚‚ã—èµ¤ãƒãƒ¼ãƒ ã§ã‚ã‚Œã°ã€**æ¤œå‡ºã•ã‚Œã¦ã„ãªã„**ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ï¼‰ã€‚ç’°å¢ƒã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®æ–¹æ³•ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚\
ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã„ãã¤ã‹ã®ä¸€èˆ¬çš„ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ—æŒ™ã™ã‚‹æ–¹æ³•ã‚’ç¢ºèªã§ãã¾ã™ã€‚
{% endhint %}

## ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ—æŒ™ã€ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€æ°¸ç¶šåŒ–

GCPã«ã¯é©šãã»ã©å¤šãã®ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€ã„ãã¤ã‹ã®ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã™ã‚‹**åŸºæœ¬æƒ…å ±ã€åˆ—æŒ™ã®ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ**ã€**æ¤œå‡ºã‚’å›é¿ã™ã‚‹æ–¹æ³•**ã€**æ°¸ç¶šæ€§ã®ç¢ºä¿**ã€ãŠã‚ˆã³ãã®ä»–ã®**ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**ã®ãƒˆãƒªãƒƒã‚¯ã‚’ç¢ºèªã§ãã¾ã™ã€‚

{% content-ref url="gcp-services/" %}
[gcp-services](gcp-services/)
{% endcontent-ref %}

{% content-ref url="gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](gcp-non-svc-persistance.md)
{% endcontent-ref %}

æ‰‹ä½œæ¥­ã§ã™ã¹ã¦ã®ä½œæ¥­ã‚’è¡Œã†å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã“ã®ãƒã‚¹ãƒˆã®ä¸‹éƒ¨ã«ã¯[**è‡ªå‹•ãƒ„ãƒ¼ãƒ«ã«é–¢ã™ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³**](./#automatic-tools)ãŒã‚ã‚Šã¾ã™ã€‚

ã•ã‚‰ã«ã€ã“ã®æ®µéšã§**èªè¨¼ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãŒã•ã‚‰ã«è¦‹ã¤ã‹ã‚‹**ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

{% content-ref url="gcp-unauthenticated-enum/" %}
[gcp-unauthenticated-enum](gcp-unauthenticated-enum/)
{% endcontent-ref %}

## ç‰¹æ¨©ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ã‚¯ãƒ©ã‚¦ãƒ‰ã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’å–å¾—ã—ãŸã‚Šã€ã‚¯ãƒ©ã‚¦ãƒ‰å†…ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¾µå®³ã—ãŸã‚Šã—ãŸå ´åˆã€æœ€ã‚‚ä¸€èˆ¬çš„ãªæ–¹æ³•ã¯ã€ä¾µå®³ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒæŒã¤**è¨­å®šãƒŸã‚¹ã®ç‰¹æ¨©ã‚’æ‚ªç”¨ã™ã‚‹**ã“ã¨ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€ã¾ãšã¯ç‰¹æ¨©ã‚’åˆ—æŒ™ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã¾ãŸã€ã“ã®åˆ—æŒ™ä¸­ã«ã¯ã€**æ¨©é™ãŒæœ€ä¸Šä½ã®ã€Œçµ„ç¹”ã€ãƒ¬ãƒ™ãƒ«ã§è¨­å®šã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§**ã‚‚ã‚ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚

{% content-ref url="gcp-privilege-escalation/" %}
[gcp-privilege-escalation](gcp-privilege-escalation/)
{% endcontent-ref %}

## å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹

GCPã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ—æŒ™ã™ã‚‹éš›ã«ã€ãã‚Œã‚‰ã®ä¸€éƒ¨ãŒ**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«è¦ç´ ã‚’å…¬é–‹ã—ã¦ã„ã‚‹**ã“ã¨ãŒã‚ã‹ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ˆVM/ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ãƒˆã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ã‚­ãƒ¥ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚„ãƒã‚±ãƒƒãƒˆãªã©ï¼‰ã€‚\
ãƒšãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼ã‚„ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã®å ´åˆã€ã“ã‚Œã‚‰ãŒ**AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ã•ã‚‰ãªã‚‹ã‚¢ã‚¯ã‚»ã‚¹**ã‚’æä¾›ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ãã‚Œã‚‰ã«**æ©Ÿå¯†æƒ…å ±ã‚„è„†å¼±æ€§**ãŒãªã„ã‹å¸¸ã«ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®æœ¬ã§ã¯ã€**å…¬é–‹ã•ã‚ŒãŸAWSã‚µãƒ¼ãƒ“ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹æ–¹æ³•ã‚„ãã‚Œã‚‰ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹æ–¹æ³•**ã«ã¤ã„ã¦ã®æƒ…å ±ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚å…¬é–‹ã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚µãƒ¼ãƒ“ã‚¹ã®è„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ç‰¹å®šã®**ã‚µãƒ¼ãƒ“ã‚¹**ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

{% embed url="https://book.hacktricks.xyz/" %}

## è‡ªå‹•ãƒ„ãƒ¼ãƒ«

* **GCloudã‚³ãƒ³ã‚½ãƒ¼ãƒ«**ã®[https://console.cloud.google.com/iam-admin/asset-inventory/dashboard](https://console.cloud.google.com/iam-admin/asset-inventory/dashboard)ã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã¨IAMã‚’ç¢ºèªã§ãã¾ã™ã€‚
* ã“ã“ã§ã¯ã€ã“ã®APIã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‚¢ã‚»ãƒƒãƒˆã‚’ç¢ºèªã§ãã¾ã™ï¼š[https://cloud.google.com/asset-inventory/docs/supported-asset-types](https://cloud.google.com/asset-inventory/docs/supported-asset-types)
* [**gcp\_scanner**](https://github.com/google/gcp\_scanner)ï¼šã“ã‚Œã¯GCPãƒªã‚½ãƒ¼ã‚¹ã‚¹ã‚­ãƒ£ãƒŠã§ã‚ã‚Šã€GCPä¸Šã§ç‰¹å®šã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ãŒã©ã®ã‚ˆã†ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’æŒã£ã¦ã„ã‚‹ã‹ã‚’åˆ¤æ–­ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚
```bash
# Install
git clone https://github.com/google/gcp_scanner.git
cd gcp_scanner
virtualenv -p python3 venv
source venv/bin/activate
pip install -r requirements.txt
# Execute with gcloud creds
python3 __main__.py -o /tmp/output/ -g "$HOME/.config/gcloud"
```
* [**gcp\_enum**](https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp\_enum): GCPç’°å¢ƒã‚’åˆ—æŒ™ã™ã‚‹ãŸã‚ã®Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚gcloud cliã‚’ä½¿ç”¨ã—ã¦çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚
* [**GCP-IAM-Privilege-Escalation**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation): é«˜ã„IAMç‰¹æ¨©ã‚’åˆ—æŒ™ã—ã€ãã‚Œã‚‰ã‚’æ‚ªç”¨ã—ã¦GCPã§ç‰¹æ¨©ã‚’ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆåˆ—æŒ™ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ãã¾ã›ã‚“ã§ã—ãŸï¼‰ã€‚

## gcloud config & debug
```bash
# Login so gcloud can use your credentials
gcloud auth login
gcloud config set project security-devbox
gcloud auth print-access-token

# Login so SDKs can use your user credentials
gcloud auth application-default login
gcloud auth application-default set-quota-project security-devbox
gcloud auth application-default print-access-token

# Update gcloud
gcloud components update
```
### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼ gcloud, gsutil...

`gcloud` cliã§**`--log-http`**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ„ãƒ¼ãƒ«ãŒå®Ÿè¡Œã—ã¦ã„ã‚‹**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ã‚’**è¡¨ç¤º**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ­ã‚°ãŒãƒˆãƒ¼ã‚¯ãƒ³ã®å€¤ã‚’ä¼ã›ã‚‹ã“ã¨ã‚’æœ›ã¾ãªã„å ´åˆã¯ã€`gcloud config set log_http_redact_token false`ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

ã•ã‚‰ã«ã€é€šä¿¡ã‚’å‚å—ã™ã‚‹ã«ã¯:
```bash
gcloud config set proxy/address 127.0.0.1
gcloud config set proxy/port 8080
gcloud config set proxy/type http
gcloud config set auth/disable_ssl_validation True

# If you don't want to completely disable ssl_validation use:
gcloud config set core/custom_ca_certs_file cert.pem

# Back to normal
gcloud config unset proxy/address
gcloud config unset proxy/port
gcloud config unset proxy/type
gcloud config unset auth/disable_ssl_validation
gcloud config unset core/custom_ca_certs_file
```
## å‚è€ƒæ–‡çŒ®

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å¾—ã‚‹ï¼</strong></summary>

* **ä¼šç¤¾ã‚’ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã§å®£ä¼ã—ãŸã„**å ´åˆã‚„ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„**å ´åˆã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ã”è¦§ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€PRã‚’** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ãŠã‚ˆã³** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
