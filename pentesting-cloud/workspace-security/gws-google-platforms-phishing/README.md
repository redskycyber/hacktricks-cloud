# GWS - Google PlatformlarÄ±na KarÅŸÄ± BalÄ±kÃ§Ä±lÄ±k

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya beni **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## Genel BalÄ±kÃ§Ä±lÄ±k Metodolojisi

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Google GruplarÄ± BalÄ±kÃ§Ä±lÄ±ÄŸÄ±

GÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re, varsayÄ±lan olarak, iÅŸ yeri Ã¼yeleri [**gruplar oluÅŸturabilir**](https://groups.google.com/all-groups) **ve insanlarÄ± bu gruplara davet edebilirler**. Daha sonra kullanÄ±cÄ±ya gÃ¶nderilecek e-postayÄ± **bazÄ± baÄŸlantÄ±lar ekleyerek** deÄŸiÅŸtirebilirsiniz. E-posta, bir google adresinden geleceÄŸi iÃ§in **gerÃ§ek** gÃ¶rÃ¼necek ve insanlar baÄŸlantÄ±ya tÄ±klayabilirler.

AyrÄ±ca, **FROM** adresini **Google grup e-postasÄ±** olarak ayarlamak ve grup iÃ§indeki kullanÄ±cÄ±lara daha fazla e-posta gÃ¶ndermek de mÃ¼mkÃ¼ndÃ¼r, aÅŸaÄŸÄ±daki resimde olduÄŸu gibi grup **`google--support@googlegroups.com`** oluÅŸturuldu ve grup Ã¼yelerine bir e-posta gÃ¶nderildi (bu Ã¼yeler herhangi bir onay olmaksÄ±zÄ±n eklendi)

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Google Sohbet BalÄ±kÃ§Ä±lÄ±ÄŸÄ±

Bir kiÅŸiyle **sohbet baÅŸlatabilir** veya **konuÅŸma daveti gÃ¶nderebilirsiniz**. AyrÄ±ca, "Google Destek" gibi herhangi bir adÄ± olabilen bir **Alan** oluÅŸturabilir ve Ã¼yeleri **davet edebilirsiniz**. Kabul ederlerse, Google Destek ile konuÅŸtuklarÄ±nÄ± dÃ¼ÅŸÃ¼nebilirler:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**Ancak testlerimde davet edilen Ã¼yeler davet almadÄ±lar bile.**
{% endhint %}

Bu nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± geÃ§miÅŸte ÅŸurada kontrol edebilirsiniz: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Google Belge BalÄ±kÃ§Ä±lÄ±ÄŸÄ±

GeÃ§miÅŸte, **gÃ¶rÃ¼nÃ¼ÅŸte meÅŸru bir belge** oluÅŸturmak ve ardÄ±ndan bir yorumda **@user@gmail.com gibi bir e-posta belirtmek** mÃ¼mkÃ¼ndÃ¼. Google, bu e-posta adresine belgede adlarÄ±nÄ±n geÃ§tiÄŸini bildiren bir e-posta gÃ¶nderdi.\
GÃ¼nÃ¼mÃ¼zde bu iÅŸe yaramaz ancak kurban e-postaya belgeye eriÅŸim izni verirseniz Google bunu bildiren bir e-posta gÃ¶nderecektir. Birini belirttiÄŸinizde gÃ¶rÃ¼nen mesaj ÅŸudur:

<figure><img src="../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
KurbanlarÄ±n, dÄ±ÅŸ belgenin kendileriyle paylaÅŸÄ±ldÄ±ÄŸÄ±nÄ± bildiren e-postalarÄ±n e-postalarÄ±na ulaÅŸmasÄ±na izin vermeyen koruma mekanizmalarÄ± olabilir.
{% endhint %}

## Google Takvim BalÄ±kÃ§Ä±lÄ±ÄŸÄ±

Åirketi hedef alan bir **takvim etkinliÄŸi oluÅŸturabilir** ve saldÄ±rdÄ±ÄŸÄ±nÄ±z ÅŸirketin e-posta adreslerini sahip olduÄŸunuz kadar ekleyebilirsiniz. Bu takvim etkinliÄŸini, mevcut zamandan **5 veya 15 dakika** sonra planlayÄ±n. EtkinliÄŸi gerÃ§ek gibi gÃ¶sterin ve **okumalarÄ± gerektiÄŸini belirten bir yorum ve baÅŸlÄ±k ekleyin** (balÄ±kÃ§Ä±lÄ±k baÄŸlantÄ±sÄ±yla).

Bu tarayÄ±cÄ±da gÃ¶rÃ¼necek bir uyarÄ±dÄ±r ve toplantÄ± baÅŸlÄ±ÄŸÄ± "Ä°nsanlarÄ± Ä°ÅŸten Ã‡Ä±karma" olduÄŸundan, daha fazla balÄ±kÃ§Ä±lÄ±ÄŸa benzer bir baÅŸlÄ±k belirleyebilirsiniz (ve hatta e-postanÄ±za iliÅŸkilendirilen adÄ± deÄŸiÅŸtirebilirsiniz).

<figure><img src="../../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Daha az ÅŸÃ¼pheli gÃ¶rÃ¼nmesi iÃ§in:

* AlÄ±cÄ±larÄ±n **davet edilen diÄŸer kiÅŸileri gÃ¶rememesini** saÄŸlayÄ±n
* **Etkinlikle ilgili e-postalar gÃ¶ndermeyin**. Sonra insanlar sadece 5 dakika iÃ§inde bir toplantÄ± uyarÄ±sÄ± ve o baÄŸlantÄ±yÄ± okumalarÄ± gerektiÄŸine dair uyarÄ±larÄ±nÄ± gÃ¶recekler.
* API'yi kullanarak, **insanlarÄ±n** etkinliÄŸi **kabul ettiÄŸini** ve hatta **onlarÄ±n adÄ±na yorumlar oluÅŸturduÄŸunuzu** belirtebilirsiniz.

## Uygulama Betikleri YÃ¶nlendirme BalÄ±kÃ§Ä±lÄ±ÄŸÄ±

[https://script.google.com/](https://script.google.com/) adresinde bir betik oluÅŸturabilir ve herkesin eriÅŸebileceÄŸi bir web uygulamasÄ± olarak aÃ§Ä±ÄŸa Ã§Ä±karabilirsiniz. Bu sayfa, **`script.google.com`** gibi meÅŸru bir alan adÄ± kullanacaktÄ±r.  \
AÅŸaÄŸÄ±daki gibi bazÄ± kodlarla bir saldÄ±rgan, sayfada durmadan herhangi bir iÃ§eriÄŸi yÃ¼kleyen bir betik oluÅŸturabilir:

{% code overflow="wrap" %}
```javascript
function doGet() {
return HtmlService.createHtmlOutput('<meta http-equiv="refresh" content="0;url=https://cloud.hacktricks.xyz/pentesting-cloud/workspace-security/gws-google-platforms-phishing#app-scripts-redirect-phishing">')
.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```
{% endcode %}

Ã–rneÄŸin [https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec](https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec) adresine eriÅŸtiÄŸinizde:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Ä°Ã§eriÄŸin bir iframe iÃ§inde yÃ¼klendiÄŸi uyarÄ±sÄ±nÄ±n gÃ¶rÃ¼neceÄŸini unutmayÄ±n.
{% endhint %}

## App Scripts OAuth Phishing

Belgelerle iliÅŸkilendirilmiÅŸ App Scripts oluÅŸturarak kurbanÄ±n OAuth belirteci Ã¼zerinden eriÅŸim elde etmeye Ã§alÄ±ÅŸmak mÃ¼mkÃ¼ndÃ¼r, daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="gws-app-scripts.md" %}
[gws-app-scripts.md](gws-app-scripts.md)
{% endcontent-ref %}

## OAuth UygulamalarÄ± Phishing

Ã–nceki tekniklerden herhangi biri, kullanÄ±cÄ±nÄ±n yÃ¼ksek ayrÄ±calÄ±klÄ± izinler isteyen bir **Google OAuth uygulamasÄ±na** eriÅŸmesini saÄŸlamak iÃ§in kullanÄ±labilir. KullanÄ±cÄ± **kaynaÄŸa gÃ¼venirse**, uygulamaya da **gÃ¼venebilir** (yÃ¼ksek ayrÄ±calÄ±klÄ± izinler istese bile).

{% hint style="info" %}
Google'Ä±n, uygulamanÄ±n gÃ¼venilir olmadÄ±ÄŸÄ±nÄ± belirten Ã§irkin bir uyarÄ± sunacaÄŸÄ±nÄ± ve Workspace yÃ¶neticilerinin insanlarÄ±n OAuth uygulamalarÄ±nÄ± kabul etmesini engelleyebileceÄŸini unutmayÄ±n.
{% endhint %}

**Google**, kullanÄ±cÄ±lar adÄ±na Ã§eÅŸitli **Google hizmetleriyle etkileÅŸimde bulunabilen uygulamalar oluÅŸturmaya izin verir**: Gmail, Drive, GCP...

Bir uygulamanÄ±n **diÄŸer kullanÄ±cÄ±lar adÄ±na hareket etmesi** iÃ§in, geliÅŸtirici, uygulamanÄ±n kullanÄ±cÄ± verilerine eriÅŸmek iÃ§in ihtiyaÃ§ duyduÄŸu kapsamlarÄ± (izinleri) belirtmek Ã¼zere bir **OAuth uygulamasÄ± oluÅŸturmalÄ±dÄ±r**.\
Bir **kullanÄ±cÄ±** o **uygulamayÄ± kullanmak istediÄŸinde**, belirtilen kapsamlarda verilerine eriÅŸeceÄŸi uygulamayÄ± **kabul etmesi istenecektir**.

Bu, teknik olmayan kullanÄ±cÄ±larÄ±, sonuÃ§larÄ± anlamayabilecekleri **duyarlÄ± bilgilere eriÅŸen uygulamalarÄ± kullanmaya** yÃ¶nlendirmenin Ã§ok etkili bir yoludur. Ancak, kuruluÅŸ hesaplarÄ±nda bunun Ã¶nlenmesi iÃ§in yÃ¶ntemler bulunmaktadÄ±r.

### DoÄŸrulanmamÄ±ÅŸ Uygulama UyarÄ±sÄ±

BahsedildiÄŸi gibi, Google her zaman kullanÄ±cÄ±nÄ±n, uygulamanÄ±n adÄ±na verdikleri izinleri kabul etmesi iÃ§in bir **uyarÄ± penceresi sunacaktÄ±r**. Ancak, uygulama **tehlikeli** olarak kabul edilirse, Google, kullanÄ±cÄ±nÄ±n uygulamaya izin vermesini **daha zor hale getiren tehlikeli** olduÄŸunu belirten bir **uyarÄ± penceresi** gÃ¶sterecektir.

Bu uyarÄ±, ÅŸu tÃ¼r uygulamalarda gÃ¶rÃ¼nÃ¼r:

* Ã–zel verilere eriÅŸebilen herhangi bir kapsam kullanÄ±r (Gmail, Drive, GCP, BigQuery...)
* 100'den az kullanÄ±cÄ±ya sahip uygulamalar (100'den fazla kullanÄ±cÄ±ya sahip uygulamalar iÃ§in doÄŸrulanmamÄ±ÅŸ uyarÄ±yÄ± gÃ¶stermeyi durdurmak iÃ§in bir inceleme sÃ¼reci de gereklidir)

### Ä°lginÃ§ Kapsamlar

[**Burada**](https://developers.google.com/identity/protocols/oauth2/scopes) tÃ¼m Google OAuth kapsamlarÄ±nÄ±n bir listesini bulabilirsiniz.

* **cloud-platform**: **Google Cloud Platform** hizmetlerindeki verilerinizi gÃ¶rÃ¼ntÃ¼leyin ve yÃ¶netin. GCP'de kullanÄ±cÄ±yÄ± taklit edebilirsiniz.
* **admin.directory.user.readonly**: KuruluÅŸunuzun GSuite dizinini gÃ¶rÃ¼ntÃ¼leyin ve indirin. TÃ¼m kullanÄ±cÄ±larÄ±n adlarÄ±nÄ±, telefon numaralarÄ±nÄ±, takvim URL'lerini alÄ±n.

### Bir OAuth UygulamasÄ± OluÅŸturma

**OAuth Ä°stemci KimliÄŸi oluÅŸturmaya baÅŸlayÄ±n**

1. [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) adresine gidin ve onay ekranÄ±nÄ± yapÄ±landÄ±rmak iÃ§in tÄ±klayÄ±n.
2. ArdÄ±ndan, **kullanÄ±cÄ± tÃ¼rÃ¼nÃ¼n** **iÃ§sel** (yalnÄ±zca kuruluÅŸunuzdaki kiÅŸiler iÃ§in) veya **harici** olup olmadÄ±ÄŸÄ± sorulacaktÄ±r. Ä°htiyaÃ§larÄ±nÄ±za uygun olanÄ± seÃ§in
* Ä°Ã§sel, kuruluÅŸun bir kullanÄ±cÄ±sÄ±nÄ± zaten ele geÃ§irdiyseniz ve baÅŸka birini avlamak iÃ§in bu UygulamayÄ± oluÅŸturuyorsanÄ±z ilginÃ§ olabilir.
3. Uygulamaya bir **ad**, bir **destek e-postasÄ±** (daha fazla anonimleÅŸmek iÃ§in bir googlegroup e-postasÄ± ayarlayabileceÄŸinizi unutmayÄ±n), bir **logo**, **yetkilendirilmiÅŸ alanlar** ve diÄŸer **gÃ¼ncelleÅŸtirmeler iÃ§in bir e-posta** verin.
4. **OAuth kapsamlarÄ±nÄ± seÃ§in**.
* Bu sayfa, hassas olmayan izinler, hassas izinler ve kÄ±sÄ±tlÄ± izinler olmak Ã¼zere Ã¼Ã§e ayrÄ±lmÄ±ÅŸtÄ±r. Yeni bir izin eklediÄŸinizde, kategorisine eklenir. Ä°stenen izinlere baÄŸlÄ± olarak, kullanÄ±cÄ±ya ne kadar hassas olduklarÄ±nÄ± belirten farklÄ± uyarÄ±lar gÃ¶rÃ¼necektir.
* Hem **`admin.directory.user.readonly`** hem de **`cloud-platform`** hassas izinlerdir.
5. **Test kullanÄ±cÄ±larÄ± ekleyin.** UygulamanÄ±n durumu test aÅŸamasÄ±ndayken, yalnÄ±zca bu kullanÄ±cÄ±lar uygulamaya eriÅŸebilecekler, bu nedenle **avlamayÄ± yapacaÄŸÄ±nÄ±z e-postayÄ± eklemeyi** unutmayÄ±n.

Åimdi, **daha Ã¶nce oluÅŸturulan OAuth Ä°stemci KimliÄŸi** kullanÄ±larak bir web uygulamasÄ± iÃ§in **kimlik bilgileri alalÄ±m**:

1. [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) adresine geri dÃ¶nÃ¼n, bu sefer farklÄ± bir seÃ§enek gÃ¶rÃ¼necektir.
2. **Web uygulamasÄ± iÃ§in kimlik bilgileri oluÅŸturmayÄ± seÃ§in**
3. Gerekli **Javascript kÃ¶kenleri** ve **yÃ¶nlendirme URI'leri** ayarlayÄ±n
* Her ikisi iÃ§in de test iÃ§in **`http://localhost:8000/callback`** gibi bir ÅŸey ayarlayabilirsiniz
4. Uygulama **kimlik bilgilerinizi alÄ±n**

Son olarak, **OAuth uygulama kimlik bilgilerini kullanan bir web uygulamasÄ±nÄ± Ã§alÄ±ÅŸtÄ±ralÄ±m**. Bir Ã¶rnek [https://github.com/carlospolop/gcp\_oauth\_phishing\_example](https://github.com/carlospolop/gcp\_oauth\_phishing\_example) adresinde bulunabilir.
```bash
git clone ttps://github.com/carlospolop/gcp_oauth_phishing_example
cd gcp_oauth_phishing_example
pip install flask requests google-auth-oauthlib
python3 app.py --client-id "<client_id>" --client-secret "<client_secret>"
```
**`http://localhost:8000`** adresine gidin, Google ile GiriÅŸ yap dÃ¼ÄŸmesine tÄ±klayÄ±n, ÅŸÃ¶yle bir mesajla karÅŸÄ±laÅŸacaksÄ±nÄ±z:

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

Uygulama **eriÅŸim ve yenileme belirteÃ§lerini** gÃ¶sterecek, bu belirteÃ§ler kolayca kullanÄ±labilir. Bu belirteÃ§leri nasÄ±l kullanacaÄŸÄ±nÄ±z hakkÄ±nda daha fazla bilgi iÃ§in ÅŸu adrese bakÄ±n:

{% content-ref url="../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

#### `glcoud` KullanÄ±mÄ±

Web konsolu yerine gcloud kullanarak bir ÅŸeyler yapmak mÃ¼mkÃ¼ndÃ¼r, ÅŸu adrese bakÄ±n:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md" %}
[gcp-clientauthconfig-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md)
{% endcontent-ref %}

## Referanslar

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - G Suite Hackleme: Koyu Uygulama BetiÄŸi Sihirinin GÃ¼cÃ¼
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch ve Beau Bullock - Tamam Google, GSuite'i NasÄ±l KÄ±rmalÄ±yÄ±m?

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u takip edin**.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
