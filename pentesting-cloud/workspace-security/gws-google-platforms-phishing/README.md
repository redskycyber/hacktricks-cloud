# GWS - Google PlatformlarÄ±na YÃ¶nelik Kimlik AvÄ±

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki Ã¶zel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

## Genel Kimlik AvÄ± Metodolojisi

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Google GruplarÄ± Kimlik AvÄ±

GÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re, varsayÄ±lan olarak, Ã§alÄ±ÅŸma alanÄ± Ã¼yeleri [**gruplar oluÅŸturabilir**](https://groups.google.com/all-groups) **ve insanlarÄ± bu gruplara davet edebilir**. ArdÄ±ndan, kullanÄ±cÄ±ya gÃ¶nderilecek e-postayÄ± **bazÄ± baÄŸlantÄ±lar ekleyerek** deÄŸiÅŸtirebilirsiniz. **E-posta, bir Google adresinden** geleceÄŸi iÃ§in **gerÃ§ek gibi** gÃ¶rÃ¼necek ve insanlar baÄŸlantÄ±ya tÄ±klayabilir.

AyrÄ±ca, **GÃ–NDEREN** adresini **Google grup e-postasÄ±** olarak ayarlayarak, grup iÃ§indeki kullanÄ±cÄ±lara **daha fazla e-posta gÃ¶ndermek** mÃ¼mkÃ¼ndÃ¼r. AÅŸaÄŸÄ±daki resimde olduÄŸu gibi grup **`google--support@googlegroups.com`** oluÅŸturuldu ve grup Ã¼yelerine (herhangi bir onay olmaksÄ±zÄ±n eklenen) bir **e-posta gÃ¶nderildi**.

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Google Sohbet Kimlik AvÄ±

Bir kiÅŸiyle **sohbet baÅŸlatabilir** veya **konuÅŸma daveti** gÃ¶nderebilirsiniz. DahasÄ±, herhangi bir adÄ± (Ã¶rneÄŸin "Google Destek") olabilen bir **Alan** oluÅŸturmak ve Ã¼yelerini davet etmek mÃ¼mkÃ¼ndÃ¼r. Kabul ederlerse, Google Destek ile konuÅŸtuÄŸunu dÃ¼ÅŸÃ¼nebilirler:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Ancak, testlerimde davet edilen Ã¼yeler davet bile almadÄ±.
{% endhint %}

Bu, geÃ§miÅŸte nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±zÄ± kontrol edebileceÄŸiniz bir videoda gÃ¶sterilmiÅŸtir: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Google DokÃ¼man Kimlik AvÄ±

GeÃ§miÅŸte, **gÃ¶rÃ¼nÃ¼ÅŸte meÅŸru bir belge** oluÅŸturmak ve bir yorumda **@user@gmail.com gibi bir e-postayÄ±** belirtmek mÃ¼mkÃ¼ndÃ¼. Google, bu e-posta adresine belgede bahsedildiÄŸini bildiren bir e-posta gÃ¶nderdi.\
GÃ¼nÃ¼mÃ¼zde bu iÅŸe yaramaz, ancak **kurbanÄ±n belgeye eriÅŸim izni verirseniz** Google bir e-posta gÃ¶nderecektir. Birini bahsettiÄŸinizde gÃ¶rÃ¼nen mesaj budur:

<figure><img src="../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
KurbanlarÄ±n, dÄ±ÅŸarÄ±dan bir belgenin kendileriyle paylaÅŸÄ±ldÄ±ÄŸÄ±nÄ± bildiren e-postalarÄ±n e-postalarÄ±na ulaÅŸmasÄ±na izin vermeyen bir koruma mekanizmasÄ± olabilir.
{% endhint %}

## Google Takvim Kimlik AvÄ±

Åirketi hedef alan herhangi bir kiÅŸinin e-posta adresini **ekleyebileceÄŸiniz kadar Ã§ok e-posta adresini iÃ§eren bir takvim etkinliÄŸi oluÅŸturabilirsiniz**. Bu takvim etkinliÄŸini mevcut zamandan **5 veya 15 dakika** sonra planlayÄ±n. EtkinliÄŸi gerÃ§ek gibi gÃ¶sterin ve **okunmasÄ± gereken bir ÅŸey olduÄŸunu belirten bir yorum ve baÅŸlÄ±k ekleyin** (kimlik avÄ± baÄŸlantÄ±sÄ±yla).

Bu, tarayÄ±cÄ±da "Ä°nsanlarÄ± Ä°ÅŸten Ã‡Ä±karma" baÅŸlÄ±klÄ± bir toplantÄ±yla ilgili olarak gÃ¶rÃ¼necek bir uyarÄ±dÄ±r, bu nedenle daha fazla kimlik avÄ± gibi bir baÅŸlÄ±k belirleyebilirsiniz (ve hatta e-postanÄ±za iliÅŸkilendirilen adÄ± deÄŸiÅŸtirebilirsiniz).

<figure><img src="../../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Daha az ÅŸÃ¼pheli gÃ¶rÃ¼nmesi iÃ§in:

* AlÄ±cÄ±larÄ±n **davet edilen diÄŸer kiÅŸileri gÃ¶rememesini** saÄŸlayÄ±n
* **Etkinlikle ilgili e-postalar gÃ¶ndermeyin**. Bu durumda, insanlar sadece 5 dakika iÃ§inde bir toplantÄ± uyarÄ±sÄ± ve o baÄŸlantÄ±yÄ± okumalarÄ± gerektiÄŸi konusunda bir uyarÄ± gÃ¶recekler.
* API kullanarak, **kiÅŸilerin** etkinliÄŸi **kabul ettiÄŸini** ve hatta **onlarÄ±n adÄ±na yorumlar oluÅŸturabileceÄŸinizi** belirtebilirsiniz.

## Uygulama Komut DosyasÄ± YÃ¶nlendirme Kimlik AvÄ±

[https://script.google.com/](https://script.google.com/) adresinde bir komut dosyasÄ± oluÅŸturabilir ve herkesin eriÅŸebileceÄŸi ÅŸekilde **web uygulamasÄ± olarak aÃ§Ä±ÄŸa Ã§Ä±karabilirsiniz**. Bu, meÅŸru alan **`script.google.com`** kullanacaktÄ±r.  \
AÅŸaÄŸÄ±daki gibi bazÄ± kodlarla saldÄ±rgan, bu sayfada durmadan herhangi bir iÃ§eriÄŸi yÃ¼kleyebilir:

{% code overflow="wrap" %}
```javascript
function doGet() {
return HtmlService.createHtmlOutput('<meta http-equiv="refresh" content="0;url=https://cloud.hacktricks.xyz/pentesting-cloud/workspace-security/gws-google-platforms-phishing#app-scripts-redirect-phishing">')
.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```
{% endcode %}

Ã–rneÄŸin [https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec](https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec) adresine eriÅŸtiÄŸinizde:

<figure><img src="../../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Ä°Ã§erik bir iframe iÃ§inde yÃ¼klendiÄŸi iÃ§in bir uyarÄ± gÃ¶rÃ¼necektir.
{% endhint %}

## App Scripts OAuth Phishing

KurbanÄ±n OAuth belirteci Ã¼zerinde eriÅŸim elde etmek iÃ§in belgelere baÄŸlÄ± App Scripts oluÅŸturmak mÃ¼mkÃ¼ndÃ¼r. Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="gws-app-scripts.md" %}
[gws-app-scripts.md](gws-app-scripts.md)
{% endcontent-ref %}

## OAuth UygulamalarÄ± Phishing

Ã–nceki tekniklerden herhangi biri, kullanÄ±cÄ±nÄ±n **Google OAuth uygulamasÄ±na** eriÅŸmesini saÄŸlamak iÃ§in kullanÄ±labilir. KullanÄ±cÄ± **kaynaÄŸa** gÃ¼veniyorsa, **uygulamaya** gÃ¼venebilir (yÃ¼ksek ayrÄ±calÄ±klÄ± izinler istese bile).

{% hint style="info" %}
Google, uygulamanÄ±n gÃ¼venilmez olduÄŸunu belirten Ã§irkin bir uyarÄ± sunar ve Workspace yÃ¶neticileri OAuth uygulamalarÄ±nÄ± kabul etmeyi engelleyebilir.
{% endhint %}

**Google**, birÃ§ok **Google hizmetiyle** kullanÄ±cÄ±lar adÄ±na etkileÅŸimde bulunabilen uygulamalar oluÅŸturmanÄ±za izin verir: Gmail, Drive, GCP...

**DiÄŸer kullanÄ±cÄ±lar adÄ±na hareket etmek iÃ§in** bir uygulama oluÅŸturulduÄŸunda, geliÅŸtiricinin **GCP iÃ§inde OAuth uygulamasÄ± oluÅŸturmasÄ±** ve uygulamanÄ±n kullanÄ±cÄ± verilerine eriÅŸmesi gereken kapsamlarÄ± (izinleri) belirtmesi gerekir.\
Bir **kullanÄ±cÄ±**, **uygulamayÄ± kullanmak** istediÄŸinde, kapsamlarda belirtilen verilere eriÅŸimin uygulamaya **kabul edilmesi** istenecektir.

Bu, teknik olmayan kullanÄ±cÄ±larÄ± **hassas bilgilere eriÅŸen uygulamalarÄ± kullanmaya** ikna etmek iÃ§in Ã§ok cazip bir yÃ¶ntemdir Ã§Ã¼nkÃ¼ sonuÃ§larÄ± anlamayabilirler. Bununla birlikte, kuruluÅŸ hesaplarÄ±nda bunun Ã¶nlenmesi iÃ§in yÃ¶ntemler vardÄ±r.

### DoÄŸrulanmamÄ±ÅŸ Uygulama uyarÄ±sÄ±

BahsedildiÄŸi gibi, Google her zaman kullanÄ±cÄ±nÄ±n uygulamaya verdikleri izinleri kabul etmeleri iÃ§in bir **uyarÄ±yÄ± kullanÄ±cÄ±ya sunar**. Ancak, uygulama **tehlikeli** olarak kabul edilirse, Google, kullanÄ±cÄ±nÄ±n uygulamaya izinleri vermesini **daha zorlaÅŸtÄ±ran** ve **tehlikeli olduÄŸunu belirten bir uyarÄ±yÄ± ilk olarak gÃ¶sterecektir**.

Bu uyarÄ±, aÅŸaÄŸÄ±daki uygulamalarda gÃ¶rÃ¼nÃ¼r:

* Ã–zel verilere eriÅŸebilen herhangi bir kapsam kullanÄ±r (Gmail, Drive, GCP, BigQuery...)
* 100'den az kullanÄ±cÄ±sÄ± olan uygulamalar (100'den fazla uygulama iÃ§in doÄŸrulanmamÄ±ÅŸ uyarÄ±yÄ± gÃ¶stermeyi durdurmak iÃ§in bir inceleme sÃ¼reci de gereklidir)

### Ä°lginÃ§ Kapsamlar

[**Burada**](https://developers.google.com/identity/protocols/oauth2/scopes) Google OAuth kapsamlarÄ±nÄ±n bir listesini bulabilirsiniz.

* **cloud-platform**: Google Cloud Platform hizmetlerindeki verilerinizi gÃ¶rÃ¼ntÃ¼leyin ve yÃ¶netin. GCP'de kullanÄ±cÄ±yÄ± taklit edebilirsiniz.
* **admin.directory.user.readonly**: KuruluÅŸunuzun GSuite dizinini gÃ¶rÃ¼ntÃ¼leyin ve indirin. TÃ¼m kullanÄ±cÄ±larÄ±n adlarÄ±nÄ±, telefonlarÄ±nÄ±, takvim URL'lerini alÄ±n.

### Bir OAuth UygulamasÄ± OluÅŸturma

**Ã–nce bir OAuth Ä°stemci KimliÄŸi oluÅŸturmaya baÅŸlayalÄ±m**

1. [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) adresine gidin ve onay ekranÄ±nÄ± yapÄ±landÄ±rmak iÃ§in tÄ±klayÄ±n.
2. ArdÄ±ndan, **kullanÄ±cÄ± tÃ¼rÃ¼**nÃ¼n **iÃ§sel** (yalnÄ±zca kuruluÅŸunuzdaki kiÅŸiler iÃ§in) veya **harici** olduÄŸu sorulacaktÄ±r. Ä°htiyaÃ§larÄ±nÄ±za uygun olanÄ± seÃ§in
* Ä°Ã§sel, zaten bir kuruluÅŸ kullanÄ±cÄ±sÄ±nÄ± etkilemiÅŸseniz ve baÅŸka birini avlamak iÃ§in bu UygulamayÄ± oluÅŸturuyorsanÄ±z ilginÃ§ olabilir.
3. Uygulamaya bir **ad**, bir **destek e-postasÄ±** (daha fazla anonimleÅŸmek iÃ§in bir googlegroup e-postasÄ± ayarlayabilirsiniz), bir **logo**, **yetkilendirilmiÅŸ alanlar** ve diÄŸer bir **e-posta** iÃ§in **gÃ¼ncellemeler** verin.
4. **OAuth kapsamlarÄ±nÄ± seÃ§in**.
* Bu sayfa, hassas olmayan izinler, hassas izinler ve kÄ±sÄ±tlÄ± izinler olmak Ã¼zere Ã¼Ã§e ayrÄ±lmÄ±ÅŸtÄ±r. Yeni bir izin eklediÄŸinizde, kategorisine eklenir. Ä°stenen izinlere baÄŸlÄ± olarak, kullanÄ±cÄ±ya bu izinlerin ne kadar hassas olduÄŸunu belirten farklÄ± bir uyarÄ± gÃ¶rÃ¼necektir.
* **`admin.directory.user.readonly`** ve **`cloud-platform`** izinleri hassas izinlerdir.
5. **Test kullanÄ±cÄ±larÄ±nÄ± ekleyin**. UygulamanÄ±n durumu test olduÄŸu sÃ¼rece, yalnÄ±zca bu kullanÄ±cÄ±lar uygulamaya eriÅŸebileceÄŸinden, **avlamayÄ± planladÄ±ÄŸÄ±nÄ±z e-postayÄ± eklemeyi unutmayÄ±n**.

Åimdi, **Ã¶nceden oluÅŸturulan OAuth Ä°stemci KimliÄŸi** kullanarak bir **web uygulamasÄ± iÃ§in kimlik bilgileri alalÄ±m**:

1. [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) adresine geri dÃ¶nÃ¼n, bu sefer farklÄ± bir seÃ§enek gÃ¶rÃ¼necektir.
2. **Web uygulamasÄ± iÃ§in kimlik bilgileri oluÅŸturmayÄ±** seÃ§in
3. Gerekli **Javascript kÃ¶kenlerini** ve **yÃ¶nlendirme URI'lerini** ayarlayÄ±n
* Test iÃ§in **`http://localhost:8000/callback`** gibi bir ÅŸey ayarlayabilirsiniz
4. Uygulama **kimlik bilgilerinizi** alÄ±n

Son olarak, OAuth uygulama kimlik bilgilerini kullanan bir web uygulamasÄ± Ã§alÄ±ÅŸtÄ±ralÄ±m. Bir Ã¶rneÄŸi [https://github.com/carlospolop/gcp\_oauth\_phishing\_example](https://github.com/carlospolop/gcp\_oauth\_phishing\_example) adresinde bulabilirsiniz.
```bash
git clone ttps://github.com/carlospolop/gcp_oauth_phishing_example
cd gcp_oauth_phishing_example
pip install flask requests google-auth-oauthlib
python3 app.py --client-id "<client_id>" --client-secret "<client_secret>"
```
**`http://localhost:8000`** adresine gidin ve Google ile GiriÅŸ Yap dÃ¼ÄŸmesine tÄ±klayÄ±n, aÅŸaÄŸÄ±daki gibi bir mesajla karÅŸÄ±laÅŸacaksÄ±nÄ±z:

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

Uygulama, kolayca kullanÄ±labilecek **eriÅŸim ve yenileme belirteÃ§lerini** gÃ¶sterecektir. Bu belirteÃ§leri nasÄ±l kullanacaÄŸÄ±nÄ±z hakkÄ±nda daha fazla bilgi iÃ§in ÅŸu adrese bakÄ±n:

{% content-ref url="../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

#### `glcoud` Kullanarak

Web konsolu yerine gcloud kullanarak da bir ÅŸeyler yapmak mÃ¼mkÃ¼ndÃ¼r, ÅŸu adrese bakÄ±n:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md" %}
[gcp-clientauthconfig-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md)
{% endcontent-ref %}

## Referanslar

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - G Suite Hackleme: KÃ¶tÃ¼ AmaÃ§lÄ± Uygulama Komut DosyasÄ± SihirbazÄ±nÄ±n GÃ¼cÃ¼
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch ve Beau Bullock - Tamam Google, GSuite'i NasÄ±l KÄ±rmalÄ±yÄ±m?

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± yapmak veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINA**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
