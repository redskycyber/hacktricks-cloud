# GWS - Fising Google platforme

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** me na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Generi캜ka metodologija za ribarenje

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Ribarenje na Google grupama

Navodno, prema podrazumevanim postavkama, u 캜lanovima Workspace-a [**mogu kreirati grupe**](https://groups.google.com/all-groups) **i pozvati ljude u njih**. Zatim mo쬰te izmeniti e-po코tu koja 캖e biti poslata korisniku **dodavanjem nekih linkova**. **E-po코ta 캖e do캖i sa google adrese**, pa 캖e izgledati **legitimno** i ljudi bi mogli kliknuti na link.

Tako캠e je mogu캖e postaviti **FROM** adresu kao **Google grupnu e-po코tu** kako bi se poslalo **vi코e e-po코te korisnicima unutar grupe**, kao na slede캖oj slici gde je grupa **`google--support@googlegroups.com`** kreirana i **poslata je e-po코ta svim 캜lanovima** grupe (koji su dodati bez ikakvog pristanka)

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Ribarenje na Google Chat-u

Mo쬯a 캖ete mo캖i ili **zapoceti razgovor** sa osobom samo imaju캖i njihovu e-po코tu ili poslati **poziv za razgovor**. Osim toga, mogu캖e je **kreirati prostor** koji mo쬰 imati bilo koje ime (npr. "Google podr코ka") i **pozvati** 캜lanove u njega. Ako prihvate, mogu pomisliti da razgovaraju sa Google podr코kom:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**Me캠utim, u mom testiranju pozvani 캜lanovi 캜ak nisu ni primili poziv.**
{% endhint %}

Mo쬰te proveriti kako je ovo funkcionisalo u pro코losti na: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Ribarenje na Google Docs-u

Ranije je bilo mogu캖e kreirati **navodno legitimni dokument** i u komentaru **pomenuti neku e-po코tu (kao @user@gmail.com)**. Google **bi poslao e-po코tu na tu e-po코tu** obave코tavaju캖i da su pomenuti u dokumentu.\
Danas to ne funkcioni코e, ali ako **date rtvi pristup dokumentu putem e-po코te**, Google 캖e poslati e-po코tu koja to potvr캠uje. Ovo je poruka koja se pojavi kada nekoga pomenete:

<figure><img src="../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
콯rtve mogu imati mehanizam za코tite koji ne dozvoljava da e-po코te koje ukazuju da im je deljen spoljni dokument stignu do njihove e-po코te.
{% endhint %}

## Ribarenje na Google kalendaru

Mo쬰te **kreirati doga캠aj u kalendaru** i dodati koliko god e-po코ta kompanije koju napadate imate. Zakazati ovaj doga캠aj u **5 ili 15 minuta** od trenutnog vremena. U캜inite da doga캠aj izgleda legitimno i **stavite komentar i naslov koji ukazuju da trebaju ne코to pro캜itati** (sa **phishing linkom**).

Ovo je upozorenje koje 캖e se pojaviti u pregleda캜u sa naslovom sastanka "Otpu코tanje ljudi", pa mo쬰te postaviti naslov koji vi코e li캜i na ribarenje (i 캜ak promeniti ime povezano sa va코om e-po코tom).

<figure><img src="../../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Da izgleda manje sumnjivo:

* Podesite tako da **primaoci ne mogu videti druge pozvane osobe**
* **NE 코aljite e-po코tu koja obave코tava o doga캠aju**. Tada 캖e ljudi videti samo upozorenje o sastanku za 5 minuta i da trebaju pro캜itati taj link.
* Navodno, koriste캖i API, mo쬰te postaviti da **ljudi** su **prihvatili** doga캠aj i 캜ak kreirati **komentare u njihovo ime**.

## Ribarenje preusmeravanjem putem App Scripts-a

Mogu캖e je kreirati skriptu na [https://script.google.com/](https://script.google.com/) i **izlo쬴ti je kao veb aplikaciju dostupnu svima** koja 캖e koristiti legitimnu domenu **`script.google.com`**.  \
Zatim, sa nekim kodom poput slede캖eg, napada캜 mo쬰 u캜initi da skripta u캜itava proizvoljni sadr쬬j na ovoj stranici bez prestanka pristupa domenu:

{% code overflow="wrap" %}
```javascript
function doGet() {
return HtmlService.createHtmlOutput('<meta http-equiv="refresh" content="0;url=https://cloud.hacktricks.xyz/pentesting-cloud/workspace-security/gws-google-platforms-phishing#app-scripts-redirect-phishing">')
.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```
{% endcode %}

Na primer, pristupanjem [https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec](https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec) vide캖ete:

<figure><img src="../../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Imajte na umu da 캖e se pojaviti upozorenje jer se sadr쬬j u캜itava unutar iframe-a.
{% endhint %}

## Phishing putem App Scripts OAuth

Mogu캖e je kreirati App Scripts koji su povezani sa dokumentima kako bi se poku코alo dobiti pristup rtvinom OAuth token-u, za vi코e informacija pogledajte:

{% content-ref url="gws-app-scripts.md" %}
[gws-app-scripts.md](gws-app-scripts.md)
{% endcontent-ref %}

## Phishing putem OAuth aplikacija

Bilo koja od prethodnih tehnika mo쬰 se koristiti kako bi se korisnik naterao da pristupi **Google OAuth aplikaciji** koja 캖e **zahtevati** od korisnika neki **pristup**. Ako korisnik **veruje** **izvoru**, mo쬰 **verovati** i **aplikaciji** (캜ak i ako tra쬴 privilegovane dozvole).

{% hint style="info" %}
Imajte na umu da Google prikazuje ru쬹u poruku upozorenja koja ukazuje da aplikacija nije pouzdana u nekoliko slu캜ajeva, a administratori Workspace-a 캜ak mogu spre캜iti ljude da prihvate OAuth aplikacije.
{% endhint %}

**Google** omogu캖ava kreiranje aplikacija koje mogu **interagovati u ime korisnika** sa raznim **Google uslugama**: Gmail, Drive, GCP...

Kada se kreira aplikacija koja **deluje u ime drugih korisnika**, programer mora kreirati **OAuth aplikaciju unutar GCP-a** i navesti opsege (dozvole) koje aplikacija treba da ima za pristup korisni캜kim podacima.\
Kada **korisnik** 쬰li **koristiti** tu **aplikaciju**, bi캖e mu **zatra쬰no** da **prihvati** da aplikacija ima pristup njihovim podacima navedenim u opsezima.

Ovo je veoma zanimljiv na캜in da se **phish**-uju korisnici koji nisu tehni캜ki potkovani da koriste **aplikacije koje pristupaju osetljivim informacijama**, jer mo쬯a ne razumeju posledice. Me캠utim, u organizacijama postoje na캜ini da se to spre캜i.

### Upozorenje o neproverenoj aplikaciji

Kao 코to je ve캖 pomenuto, Google 캖e uvek prikazati **upozorenje korisniku da prihvati** dozvole koje daje aplikaciji u njegovo ime. Me캠utim, ako se smatra da je aplikacija **opasna**, Google 캖e prvo prikazati **upozorenje** koje ukazuje da je **opasna** i **te쬰** 캖e korisniku biti da dodeli dozvole aplikaciji.

Ovo upozorenje se pojavljuje u aplikacijama koje:

* Koriste bilo koji opseg koji mo쬰 pristupiti privatnim podacima (Gmail, Drive, GCP, BigQuery...)
* Aplikacije sa manje od 100 korisnika (za aplikacije sa vi코e od 100 korisnika tako캠e je potreban postupak pregleda kako bi se prestalo prikazivanje upozorenja o neproverenoj aplikaciji)

### Interesantni opsezi

[**Ovde**](https://developers.google.com/identity/protocols/oauth2/scopes) mo쬰te prona캖i listu svih Google OAuth opsega.

* **cloud-platform**: Pregledajte i upravljajte svojim podacima na raznim **Google Cloud Platform** uslugama. Mo쬰te se predstavljati kao korisnik u GCP-u.
* **admin.directory.user.readonly**: Pregledajte i preuzmite direktorijum GSuite organizacije. Dobijte imena, telefone, URL-ove kalendara svih korisnika.

### Kreiranje OAuth aplikacije

**Zapo캜nite kreiranje OAuth Client ID-ja**

1. Idite na [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) i kliknite na konfigurisanje ekrana saglasnosti.
2. Zatim 캖e vam biti postavljeno pitanje da li je **tip korisnika** **interni** (samo za ljude u va코oj organizaciji) ili **eksterni**. Izaberite ono 코to vam odgovara
* Interno mo쬰 biti interesantno ako ste ve캖 kompromitovali korisnika organizacije i kreirate ovu aplikaciju da biste phish-ovali jo코 jednog.
3. Dajte **ime** aplikaciji, **podr코ku putem e-po코te** (imajte na umu da mo쬰te postaviti googlegroup e-po코tu da biste poku코ali da se malo vi코e anonimizujete), **logo**, **ovla코캖ene domene** i drugu **e-po코tu** za **a쬿riranja**.
4. **Izaberite** **OAuth opsege**.
* Ova stranica je podeljena na neosetljive dozvole, osetljive dozvole i ograni캜ene dozvole. Svaki put kada dodate novu dozvolu, ona se dodaje u svoju kategoriju. Zavisno od tra쬰nih dozvola, korisniku 캖e se prikazati razli캜iti upitnici koji ukazuju na to koliko su ove dozvole osetljive.
* I **`admin.directory.user.readonly`** i **`cloud-platform`** su osetljive dozvole.
5. **Dodajte test korisnike.** Sve dok je status aplikacije u testiranju, samo ovi korisnici 캖e mo캖i pristupiti aplikaciji, pa se pobrinite da **dodate e-po코tu koju 캖ete phish-ovati**.

Sada 캖emo dobiti **poverila캜ke podatke za veb aplikaciju** koriste캖i **prethodno kreirani OAuth Client ID**:

1. Vratite se na [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient), ovog puta 캖e se pojaviti druga opcija.
2. Izaberite da **kreirate poverila캜ke podatke za veb aplikaciju**
3. Postavite potrebne **JavaScript origin** i **redirect URI**-je
* Mo쬰te postaviti ne코to poput **`http://localhost:8000/callback`** za testiranje
4. Dobijte **poverila캜ke podatke** za va코u aplikaciju

Na kraju, pokrenimo **veb aplikaciju koja 캖e koristiti poverila캜ke podatke OAuth aplikacije**. Primer mo쬰te prona캖i na [https://github.com/carlospolop/gcp\_oauth\_phishing\_example](https://github.com/carlospolop/gcp\_oauth\_phishing\_example).
```bash
git clone ttps://github.com/carlospolop/gcp_oauth_phishing_example
cd gcp_oauth_phishing_example
pip install flask requests google-auth-oauthlib
python3 app.py --client-id "<client_id>" --client-secret "<client_secret>"
```
Idite na **`http://localhost:8000`**, kliknite na dugme Prijavi se sa Google-om, bi캖ete **upitani** porukom poput ove:

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

Aplikacija 캖e prikazati **pristupni i osve쬬vaju캖i token** koji se lako mogu koristiti. Za vi코e informacija o **kako koristiti ove tokene pogledajte**:

{% content-ref url="../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

#### Kori코캖enje `glcoud`

Mogu캖e je ne코to uraditi koriste캖i gcloud umesto web konzole, pogledajte:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md" %}
[gcp-clientauthconfig-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md)
{% endcontent-ref %}

## Reference

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hakovanje G Suite: Mo캖 tamne magije aplikacija skripti
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch i Beau Bullock - OK Google, Kako da napravim Red Team GSuite?

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini da podr쬴te HackTricks:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
