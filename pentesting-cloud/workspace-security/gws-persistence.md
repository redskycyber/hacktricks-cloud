# GWS - 지속성

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 **제로부터 영웅까지 AWS 해킹 배우기**!</summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고**하거나 **PDF로 HackTricks 다운로드**하려면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구입하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [Discord 그룹](https://discord.gg/hRep4RUj7f)** 또는 [**텔레그램 그룹**](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)을 **팔로우**하세요.
* **해킹 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>

{% hint style="danger" %}
설정을 변경하는 이 섹션의 모든 작업은 **보안 경보를 이메일로 생성**하며 계정과 동기화된 모바일로 **푸시 알림을 전송**합니다.
{% endhint %}

## **Gmail에서의 지속성**

* 구글로부터의 **보안 알림을 숨기기 위한 필터**를 생성할 수 있습니다.
* `from: (no-reply@accounts.google.com) "Security Alert"`
* 이렇게 하면 보안 이메일이 이메일에 도달하는 것을 방지합니다(하지만 모바일로의 푸시 알림은 방지하지 않음)

<details>

<summary>Gmail 필터 생성 단계</summary>

([여기](https://support.google.com/mail/answer/6579)에서의 지침)

1. [Gmail](https://mail.google.com/)을 엽니다.
2. 상단의 검색 상자에서 **검색 옵션 표시**를 클릭합니다 ![photos tune](https://lh3.googleusercontent.com/cD6YR_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36) .
3. 검색 기준을 입력합니다. 검색이 올바르게 작동하는지 확인하려면 **검색**을 클릭하여 나타나는 이메일을 확인하세요.
4. 검색 창 하단에서 **필터 생성**을 클릭합니다.
5. 필터가 수행할 작업을 선택합니다.
6. **필터 생성**을 클릭합니다.

현재 필터를 확인하려면(삭제하려면) [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)에서 확인하세요.

</details>

<figure><img src="../../.gitbook/assets/image (331).png" alt=""><figcaption></figcaption></figure>

* **민감한 정보를 전달하기 위한 전달 주소 생성** - 수동 액세스가 필요합니다.
* [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)에서 전달 주소 생성
* 수신 주소는 이를 확인해야 합니다.
* 그런 다음, 모든 이메일을 전달하도록 설정하되 사본을 유지하도록 설정하세요(변경 사항 저장을 클릭하는 것을 잊지 마세요):

<figure><img src="../../.gitbook/assets/image (332).png" alt=""><figcaption></figcaption></figure>

특정 이메일만 다른 이메일 주소로 전달하도록 필터를 생성하는 것도 가능합니다.

## 앱 비밀번호

**구글 사용자 세션을 침해**하고 사용자가 **2단계 인증**을 사용하는 경우 [**앱 비밀번호를 생성**](https://support.google.com/accounts/answer/185833?hl=en)할 수 있습니다(단계를 보려면 링크를 따르세요). **앱 비밀번호는 더 이상 구글에서 권장되지 않으며** 사용자가 **Google 계정 비밀번호를 변경하면 취소**됩니다.

**오픈 세션이 있더라도 사용자의 비밀번호를 알아야만 앱 비밀번호를 생성할 수 있습니다.**

{% hint style="info" %}
앱 비밀번호는 **2단계 인증이 활성화된 계정에서만 사용**할 수 있습니다.
{% endhint %}

## 2-FA 및 유사한 설정 변경

**2-FA를 해제하거나 새로운 기기**(또는 전화번호)를 등록할 수 있습니다. 이 페이지에서 [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**에서 가능합니다.**\
**기기에 보안 푸시 알림이 도달하는 것을 방지**하려면 사용자의 스마트폰에서 **로그아웃**할 수 있습니다(비록 이상할 수 있지만) 여기서 다시 로그인할 수 없습니다.

**기기를 찾는 것도 가능합니다.**

**오픈 세션이 있더라도 사용자의 비밀번호를 알아야만 이러한 설정을 변경할 수 있습니다.**

## OAuth 앱을 통한 지속성

사용자의 계정을 **침해**했다면, 모든 가능한 권한을 **OAuth 앱에 부여**하기만 하면 됩니다. 유일한 문제는 Workspace가 **검토되지 않은 외부 및/또는 내부 OAuth 앱을 허용하지 않도록 구성**될 수 있다는 것입니다.\
Workspace 조직에서는 일반적으로 외부 OAuth 앱을 기본적으로 신뢰하지 않지만 내부 앱은 신뢰하기 때문에, 조직 내에서 **새로운 OAuth 애플리케이션을 생성할 권한이 충분하다면** 외부 앱이 금지된 경우, 새로 생성하고 **그 새로운 내부 OAuth 앱을 사용하여 지속성을 유지**할 수 있습니다.

OAuth 앱에 대한 자세한 내용은 다음 페이지를 확인하세요:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing/](gws-google-platforms-phishing/)
{% endcontent-ref %}

## 위임을 통한 지속성

**공격자가 제어하는 다른 계정에 계정을 위임**할 수 있습니다(허용된 경우). Workspace **조직**에서는 이 옵션이 **활성화**되어야 합니다. 모든 사람에 대해 비활성화될 수 있으며, 특정 사용자/그룹에 대해 활성화되거나 모든 사람에 대해(일반적으로 특정 사용자/그룹에 대해만 활성화되거나 완전히 비활성화됩니다).

<details>

<summary>Workspace 관리자인 경우 이를 활성화하려면 확인하세요</summary>

(문서에서 [복사된 정보](https://support.google.com/a/answer/7223765))

조직(예: 귀하의 직장 또는 학교)의 관리자로서 사용자가 Gmail 계정을 위임할 수 있는지 여부를 제어합니다. 모든 사람이 계정을 위임할 수 있도록 할 수 있습니다. 또는 특정 부서의 사람들만 위임 설정을 할 수 있도록 할 수 있습니다. 예를 들어:

* 행정 보조 역할을 수행하는 사람을 Gmail 계정의 대리자로 추가하여 그들이 귀하를 대신하여 이메일을 읽고 보낼 수 있도록 합니다.
* 판매 부서와 같은 그룹을 대리자로 추가하여 모든 사람이 하나의 Gmail 계정에 액세스할 수 있도록 합니다.

사용자는 도메인이나 조직 단위에 관계없이 동일한 조직의 다른 사용자에게만 액세스를 위임할 수 있습니다.

### 위임 제한 및 제한사항

* **Google 그룹에 메일함 액세스 권한 부여** 옵션: 이 옵션을 사용하려면 위임된 계정의 OU 및 각 그룹 구성원의 OU에 대해 활성화되어야 합니다. 이 옵션이 활성화되지 않은 OU에 속한 그룹 구성원은 위임된 계정에 액세스할 수 없습니다.
* 일반적인 사용에서 40명의 위임된 사용자가 동시에 Gmail 계정에 액세스할 수 있습니다. 하나 이상의 대리자가 평균 이상으로 사용하는 경우 이 숫자가 줄어들 수 있습니다.
* Gmail을 자주 액세스하는 자동화 프로세스는 동시에 계정에 액세스할 수 있는 대리자 수를 줄일 수도 있습니다. 이러한 프로세스에는 Gmail을 자주 액세스하는 API 또는 브라우저 확장 프로그램이 포함됩니다.
* 단일 Gmail 계정은 최대 1,000명의 고유 대리자를 지원합니다. 그룹은 한 대리자로서 제한에 포함됩니다.
* 위임은 Gmail 계정의 제한을 증가시키지 않습니다. 위임된 사용자가 있는 Gmail 계정은 표준 Gmail 계정 제한 및 정책을 따릅니다. 자세한 내용은 [Gmail 제한 및 정책](https://support.google.com/a/topic/28609)을 참조하세요.
### 단계 1: 사용자의 Gmail 대리자 기능 활성화

**시작하기 전에:** 특정 사용자에게 설정을 적용하려면 [조직 단위](https://support.google.com/a/topic/1227584)에 그들의 계정을 넣으십시오.

1. [로그인](https://admin.google.com/)하여 [Google Admin 콘솔](https://support.google.com/a/answer/182076)에 로그인합니다.
   
   현재 계정 CarlosPolop@gmail.com이 아닌 _관리자 계정_으로 로그인합니다.
2. 관리자 콘솔에서 메뉴로 이동합니다 ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![그리고](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn) **앱**![그리고](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![그리고](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![그리고](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**사용자 설정**.
3. 모든 사용자에게 설정을 적용하려면 최상위 조직 단위를 선택한 채로 둡니다. 그렇지 않으면 하위 [조직 단위](https://support.google.com/a/topic/1227584)를 선택합니다.
4. **메일 대리자**를 클릭합니다.
5. **도메인 내의 다른 사용자에게 메일함 액세스를 위임할 수 있도록 허용** 상자를 확인합니다.
6. (선택 사항) 사용자가 자신의 계정에서 보낸 위임된 메시지에 포함될 발신자 정보를 지정하도록 허용하려면 **이 설정을 사용자가 사용자 정의할 수 있도록 허용** 상자를 확인합니다.
7. 대리자가 보낸 메시지에 포함될 기본 발신자 정보 옵션을 선택합니다:&#x20;
   * **계정 소유자 및 이메일 보낸 대리자 표시**—메시지에 Gmail 계정 소유자와 대리자의 이메일 주소가 포함됩니다.
   * **계정 소유자만 표시**—메시지에 Gmail 계정 소유자의 이메일 주소만 포함됩니다. 대리자 이메일 주소는 포함되지 않습니다.
8. (선택 사항) 사용자가 그룹을 대리자로 추가할 수 있도록 하려면 **사용자가 Google 그룹에 메일함 액세스 권한을 부여할 수 있도록 허용** 상자를 확인합니다.
9. **저장**을 클릭합니다. 하위 조직 단위를 구성한 경우 상위 조직 단위의 설정을 **상속**하거나 **재정의**할 수 있습니다.
10. (선택 사항) 다른 조직 단위에 대해 Gmail 대리자 기능을 활성화하려면 단계 3~9를 반복합니다.

변경 사항은 최대 24시간이 소요될 수 있지만 일반적으로 더 빨리 발생합니다. [더 알아보기](https://support.google.com/a/answer/7514107)

### 단계 2: 사용자가 계정에 대리자 설정하기

대리자 기능을 활성화한 후 사용자는 자신의 Gmail 설정으로 이동하여 대리자를 지정할 수 있습니다. 대리자는 사용자를 대신하여 메시지를 읽고 보내고 받을 수 있습니다. &#x20;

자세한 내용은 사용자에게 [이메일 위임 및 협업](https://support.google.com/a/users/answer/138350)을 안내하십시오.

</details>

<details>

<summary>일반 사용자의 경우, 액세스를 위임하려는 지침을 확인하려면 여기를 클릭하십시오</summary>

(문서에서 복사된 정보 [**from the docs**](https://support.google.com/mail/answer/138350))

최대 10명의 대리자를 추가할 수 있습니다.

귀하의 직장, 학교 또는 기타 조직을 통해 Gmail을 사용하는 경우:

* 조직 내에서 최대 1000명의 대리자를 추가할 수 있습니다.
* 일반적인 사용에서 40명의 대리자가 동시에 Gmail 계정에 액세스할 수 있습니다.&#x20;
* API 또는 브라우저 확장 프로그램과 같은 자동화된 프로세스를 사용하는 경우, 몇 명의 대리자가 동시에 Gmail 계정에 액세스할 수 있습니다.

1. 컴퓨터에서 [Gmail](https://mail.google.com/)을 엽니다. Gmail 앱에서는 대리자를 추가할 수 없습니다.
2. 오른쪽 상단에서 설정을 클릭합니다 ![설정](https://lh3.googleusercontent.com/p3J-ZSPOLtuBBR\_ofWTFDfdgAYQgi8mR5c76ie8XQ2wjegk7-yyU5zdRVHKybQgUlQ=w36-h36) ![그리고](https://lh3.googleusercontent.com/3\_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36) **모든 설정 보기**.
3. **계정 및 가져오기** 또는 **계정** 탭을 클릭합니다.
4. "귀하의 계정에 액세스 권한 부여" 섹션에서 **다른 계정 추가**를 클릭합니다. 직장이나 학교를 통해 Gmail을 사용하는 경우, 귀하의 조직이 이메일 위임을 제한할 수 있습니다. 이 설정이 표시되지 않으면 관리자에게 문의하십시오.
* "귀하의 계정에 액세스 권한 부여"가 표시되지 않으면 제한됩니다.
5. 추가하려는 사람의 이메일 주소를 입력합니다. 직장, 학교 또는 다른 조직을 통해 Gmail을 사용하고 귀하의 관리자가 허용하는 경우, 그룹의 이메일 주소를 입력할 수 있습니다. 이 그룹은 귀하의 조직과 동일한 도메인을 가져야 합니다. 그룹의 외부 구성원은 위임 액세스가 거부됩니다. \
\
**중요:** 위임하는 계정이 새 계정이거나 암호가 재설정된 경우, 관리자는 처음으로 로그인할 때 암호를 변경해야 합니다.

* [관리자가 사용자를 만드는 방법 알아보기](https://support.google.com/a/answer/33310).
* [관리자가 암호를 재설정하는 방법 알아보기](https://support.google.com/a/answer/33319).

6\. **다음 단계**를 클릭합니다 ![그리고](https://lh3.googleusercontent.com/QbWcYKta5vh\_4-OgUeFmK-JOB0YgLLoGh69P478nE6mKdfpWQniiBabjF7FVoCVXI0g=h36) **액세스 부여용 이메일 보내기**.

추가한 사람은 확인을 요청하는 이메일을 받게 됩니다. 초대장은 일주일 후에 만료됩니다.

그룹을 추가한 경우, 그룹의 모든 구성원은 확인하지 않고 대리자가 됩니다.&#x20;

참고: 위임이 적용되기까지 최대 24시간이 소요될 수 있습니다.

</details>

## 안드로이드 앱을 통한 지속성

**피해자의 Google 계정 내에서 세션이 활성화**된 경우 **Play Store**로 이동하여 이미 업로드한 **악성 코드를** 직접 **폰에 설치**하여 지속성을 유지하고 피해자의 폰에 액세스할 수 있습니다.

## **앱 스크립트를** 통한 지속성

앱 스크립트에서 **시간 기반 트리거**를 생성할 수 있으므로 사용자가 스크립트를 수락하면 사용자가 액세스하지 않아도 **트리거**됩니다. 이에 대한 자세한 정보는 다음을 확인하십시오:

{% content-ref url="gws-google-platforms-phishing/gws-app-scripts.md" %}
[gws-app-scripts.md](gws-google-platforms-phishing/gws-app-scripts.md)
{% endcontent-ref %}

## 참고 자료

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - G Suite 해킹: Dark Apps Script Magic의 힘
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch 및 Beau Bullock - OK Google, 나에게 GSuite Red Team을 어떻게 하라고?

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>로부터 제로에서 영웅까지 AWS 해킹을 배우세요</summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고**하거나 **PDF로 HackTricks 다운로드**하려면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구입하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [디스코드 그룹](https://discord.gg/hRep4RUj7f)** 또는 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나 **트위터** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)을 팔로우하세요.
* **HackTricks** 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 저장소에 PR을 제출하여 해킹 기법을 공유하세요.

</details>
