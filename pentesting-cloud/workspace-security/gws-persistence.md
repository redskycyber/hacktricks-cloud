# GWS - Persistence

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** mnie na **Twitterze**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w GitHub.

</details>

{% hint style="danger" %}
Wszystkie dziaania wymienione w tej sekcji, kt贸re zmieniaj ustawienia, spowoduj **alert bezpieczestwa wysany na adres e-mail i nawet powiadomienie push na dowolne zsynchronizowane urzdzenie mobilne**.
{% endhint %}

## **Trwao w Gmailu**

* Mo偶esz tworzy **filtry, aby ukry** powiadomienia o bezpieczestwie od Google
* `from: (no-reply@accounts.google.com) "Security Alert"`
* Spowoduje to, 偶e wiadomoci o bezpieczestwie nie dotr na skrzynk e-mailow (ale nie uniemo偶liwi powiadomie push na urzdzeniu mobilnym)

<details>

<summary>Kroki do utworzenia filtra w Gmailu</summary>

(Instrukcje z [**tutaj**](https://support.google.com/mail/answer/6579))

1. Otw贸rz [Gmail](https://mail.google.com/).
2. W polu wyszukiwania na g贸rze kliknij opcje wyszukiwania ![photos tune](https://lh3.googleusercontent.com/cD6YR\_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1\_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36) .
3. Wprowad藕 kryteria wyszukiwania. Jeli chcesz sprawdzi, czy wyszukiwanie dziaa poprawnie, zobacz, jakie wiadomoci si pojawiaj, klikajc **Szukaj**.
4. Na dole okna wyszukiwania kliknij **Utw贸rz filtr**.
5. Wybierz, co chcesz, aby filtr robi.
6. Kliknij **Utw贸rz filtr**.

Sprawd藕 swoje obecne filtry (aby je usun) pod adresem [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (142).png" alt=""><figcaption></figcaption></figure>

* Utw贸rz **adres przekierowania do przekazywania wra偶liwych informacji** (lub wszystkiego) - wymaga rcznego dostpu.
* Utw贸rz adres przekierowania na stronie [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* Adres odbiorcy musi potwierdzi to przekierowanie
* Nastpnie ustaw przekierowanie wszystkich wiadomoci, zachowujc kopi (pamitaj, aby klikn Zapisz zmiany):

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Mo偶na r贸wnie偶 tworzy filtry i przekazywa tylko okrelone wiadomoci na inny adres e-mail.

## Hasa aplikacji

Jeli udao ci si **zakra do sesji u偶ytkownika Google** i u偶ytkownik mia **2FA**, mo偶esz **wygenerowa** [**haso aplikacji**](https://support.google.com/accounts/answer/185833?hl=en) (kliknij link, aby zobaczy kroki). Nale偶y jednak zauwa偶y, 偶e **hasa aplikacji nie s ju偶 zalecane przez Google i s uniewa偶niane**, gdy u偶ytkownik **zmienia haso do konta Google.**

**Nawet jeli masz otwart sesj, bdziesz musia zna haso u偶ytkownika, aby utworzy haso aplikacji.**

{% hint style="info" %}
Hasa aplikacji mo偶na **u偶ywa tylko z kontami, na kt贸rych wczona jest weryfikacja dwuetapowa**.
{% endhint %}

## Zmiana 2-FA i podobne

Mo偶liwe jest r贸wnie偶 **wyczenie 2-FA lub zarejestrowanie nowego urzdzenia** (lub numeru telefonu) na tej stronie [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**.**\
**Mo偶liwe jest r贸wnie偶 generowanie kluczy dostpu (dodawanie wasnego urzdzenia), zmiana hasa, dodawanie numer贸w telefon贸w do weryfikacji i odzyskiwania, zmiana adresu e-mail do odzyskiwania i zmiana pyta zabezpieczajcych).**

{% hint style="danger" %}
Aby **zapobiec dotarciu powiadomie push o bezpieczestwie** do telefonu u偶ytkownika, mo偶na go **wylogowa z jego smartfona** (cho byoby to dziwne), poniewa偶 nie mo偶na go ponownie zalogowa std.

Mo偶liwe jest r贸wnie偶 **lokalizowanie urzdzenia**.
{% endhint %}

**Nawet jeli masz otwart sesj, bdziesz musia zna haso u偶ytkownika, aby zmieni te ustawienia.**

## Trwao za pomoc aplikacji OAuth

Jeli **zakra si do konta u偶ytkownika**, mo偶esz po prostu **zaakceptowa** udzielenie wszystkich mo偶liwych uprawnie **aplikacji OAuth**. Jedynym problemem jest to, 偶e Workspace mo偶e by skonfigurowane tak, aby **nie zezwala na niezweryfikowane zewntrzne i/lub wewntrzne aplikacje OAuth.**\
Jest do powszechne, 偶e Organizacje Workspace domylnie nie ufaj zewntrznym aplikacjom OAuth, ale ufaj wewntrznym, wic jeli masz **wystarczajce uprawnienia do wygenerowania nowej aplikacji OAuth** wewntrz organizacji i zewntrzne aplikacje s niedozwolone, wygeneruj j i **u偶yj tej nowej wewntrznej aplikacji OAuth do utrzymania trwaoci**.

Sprawd藕 nastpujc stron, aby uzyska wicej informacji na temat aplikacji OAuth:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Trwao za pomoc delegacji

Mo偶esz po prostu **delegowa konto** do innego konta kontrolowanego przez atakujcego (jeli masz do tego uprawnienia). W organizacjach Workspace ta opcja musi by **wczona**. Mo偶e by wyczona dla wszystkich, wczona dla niekt贸rych u偶ytkownik贸w/grup lub dla wszystkich (zwykle jest wczona tylko dla niekt贸rych u偶ytkownik贸w/grup lub cakowicie wyczona).

<details>

<summary>Jeli jeste administratorem Workspace, sprawd藕 to, aby wczy t funkcj</summary>

(Informacje [skopiowane z dokumentacji](https://support.google.com/a/answer/7223765))

Jako administrator Twojej organizacji (na przykad

#### Krok 1: Wcz delegacj Gmail dla swoich u偶ytkownik贸w

**Przed rozpoczciem:** Aby zastosowa ustawienie dla okrelonych u偶ytkownik贸w, umie ich konta w [jednostce organizacyjnej](https://support.google.com/a/topic/1227584).

1. [Zaloguj si](https://admin.google.com/) do [konsoli administratora Google](https://support.google.com/a/answer/182076).

Zaloguj si za pomoc konta _administratora_, a nie swojego bie偶cego konta CarlosPolop@gmail.com. 2. W konsoli administratora przejd藕 do Menu ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![a nastpnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **Aplikacje**![a nastpnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![a nastpnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![a nastpnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Ustawienia u偶ytkownika**. 3. Aby zastosowa ustawienie dla wszystkich, pozostaw wybran najwy偶sz jednostk organizacyjn. W przeciwnym razie wybierz podrzdn [jednostk organizacyjn](https://support.google.com/a/topic/1227584). 4. Kliknij **Delegacja poczty**. 5. Zaznacz pole **Pozw贸l u偶ytkownikom delegowa dostp do swojej skrzynki pocztowej innym u偶ytkownikom w domenie**. 6. (Opcjonalnie) Aby umo偶liwi u偶ytkownikom okrelanie informacji nadawcy, kt贸re s zawarte w delegowanych wiadomociach wysyanych z ich konta, zaznacz pole **Pozw贸l u偶ytkownikom dostosowa to ustawienie**. 7. Wybierz opcj dla domylnych informacji nadawcy, kt贸re s zawarte w wiadomociach wysyanych przez delegat贸w:

* **Poka偶 waciciela konta i delegata, kt贸ry wysa wiadomo** - Wiadomoci zawieraj adresy e-mail waciciela konta Gmail i delegata.
* **Poka偶 tylko waciciela konta** - Wiadomoci zawieraj tylko adres e-mail waciciela konta Gmail. Adres e-mail delegata nie jest uwzgldniony.

8. (Opcjonalnie) Aby umo偶liwi u偶ytkownikom dodanie grupy w Grupach jako delegata, zaznacz pole **Pozw贸l u偶ytkownikom udzieli dostpu do swojej skrzynki pocztowej grupie Google**.
9. Kliknij **Zapisz**. Jeli skonfigurowae podrzdn jednostk organizacyjn, mo偶esz **dziedziczy** lub **nadpisa** ustawienia jednostki organizacyjnej nadrzdnej.
10. (Opcjonalnie) Aby wczy delegacj Gmail dla innych jednostek organizacyjnych, powt贸rz kroki 3-9.

Zmiany mog zajmowa do 24 godzin, ale zazwyczaj nastpuj szybciej. [Dowiedz si wicej](https://support.google.com/a/answer/7514107)

#### Krok 2: U偶ytkownicy ustawiaj delegat贸w dla swoich kont

Po wczeniu delegacji, u偶ytkownicy przechodz do ustawie Gmail, aby przypisa delegat贸w. Delegaci mog nastpnie czyta, wysya i odbiera wiadomoci w imieniu u偶ytkownika.

Aby uzyska szczeg贸owe informacje, skieruj u偶ytkownik贸w do [Delegowanie i wsp贸praca w e-mailach](https://support.google.com/a/users/answer/138350).

</details>

<details>

<summary>Dla zwykego u偶ytkownika, sprawd藕 tutaj instrukcje, jak spr贸bowa przekaza dostp</summary>

(Informacje skopiowane [**z dokumentacji**](https://support.google.com/mail/answer/138350))

Mo偶esz doda do 10 delegat贸w.

Jeli korzystasz z Gmaila w ramach swojej pracy, szkoy lub innej organizacji:

* Mo偶esz doda do 1000 delegat贸w w ramach swojej organizacji.
* Przy typowym u偶ytkowaniu, 40 delegat贸w mo偶e mie dostp do konta Gmail jednoczenie.
* Jeli korzystasz z proces贸w automatycznych, takich jak interfejsy API lub rozszerzenia przegldarki, kilku delegat贸w mo偶e mie dostp do konta Gmail jednoczenie.

1. Na swoim komputerze otw贸rz [Gmail](https://mail.google.com/). Nie mo偶esz dodawa delegat贸w z aplikacji Gmail.
2. W prawym g贸rnym rogu kliknij Ustawienia ![Ustawienia](https://lh3.googleusercontent.com/p3J-ZSPOLtuBBR\_ofWTFDfdgAYQgi8mR5c76ie8XQ2wjegk7-yyU5zdRVHKybQgUlQ=w36-h36) ![a nastpnie](https://lh3.googleusercontent.com/3\_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36) **Zobacz wszystkie ustawienia**.
3. Kliknij zakadk **Konta i import** lub **Konta**.
4. W sekcji "Udziel dostpu do swojego konta" kliknij **Dodaj inne konto**. Jeli korzystasz z Gmaila w ramach swojej pracy lub szkoy, twoja organizacja mo偶e ogranicza delegacj e-maili. Jeli nie widzisz tej opcji, skontaktuj si z administratorem.

* Jeli nie widzisz opcji Udziel dostpu do swojego konta, oznacza to, 偶e jest ona ograniczona.

5. Wprowad藕 adres e-mail osoby, kt贸r chcesz doda. Jeli korzystasz z Gmaila w ramach swojej pracy, szkoy lub innej organizacji, i administrator na to pozwala, mo偶esz wprowadzi adres e-mail grupy. Ta grupa musi mie tak sam domen jak twoja organizacja. Zewntrzni czonkowie grupy s pozbawieni dostpu do delegacji.\
   \
   **Wa偶ne:** Jeli konto, kt贸re delegujesz, jest nowe lub haso zostao zresetowane, administrator musi wyczy wymaganie zmiany hasa przy pierwszym logowaniu.

* [Dowiedz si, jak administrator mo偶e utworzy u偶ytkownika](https://support.google.com/a/answer/33310).
* [Dowiedz si, jak administrator mo偶e zresetowa hasa](https://support.google.com/a/answer/33319).

6. Kliknij **Nastpny krok** ![a nastpnie](https://lh3.googleusercontent.com/QbWcYKta5vh\_4-OgUeFmK-JOB0YgLLoGh69P478nE6mKdfpWQniiBabjF7FVoCVXI0g=h36) \*\*Wylij e-mail w celu udzielen

* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do repozytori贸w** [**HackTricks**](https://github.com/carlospolop/hacktricks) **i** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **na GitHubie.**

</details>
