# AWS - Temel Bilgiler

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## KuruluÅŸ HiyerarÅŸisi

![](<../../../.gitbook/assets/image (54).png>)

### Hesaplar

AWS'de, **kuruluÅŸunuzun tÃ¼m hesaplarÄ±nÄ±n ebeveyn konteyneri olan bir kÃ¶k hesap** bulunmaktadÄ±r. Bununla birlikte, kaynaklarÄ± daÄŸÄ±tmak iÃ§in bu hesabÄ± kullanmanÄ±za gerek yoktur, farklÄ± AWS altyapÄ±larÄ±nÄ± birbirinden ayÄ±rmak iÃ§in **baÅŸka hesaplar oluÅŸturabilirsiniz**.

Bu, bir **gÃ¼venlik** aÃ§Ä±sÄ±ndan Ã§ok ilginÃ§tir, Ã§Ã¼nkÃ¼ **bir hesap diÄŸer hesaplarÄ±n kaynaklarÄ±na eriÅŸemez** (Ã¶zel olarak oluÅŸturulmadÄ±kÃ§a), bu ÅŸekilde daÄŸÄ±tÄ±mlar arasÄ±nda sÄ±nÄ±rlar oluÅŸturabilirsiniz.

Bu nedenle, bir kuruluÅŸta **iki tÃ¼r hesap** bulunur (AWS hesaplarÄ±ndan ve KullanÄ±cÄ± hesaplarÄ±ndan bahsediyoruz): yÃ¶netim hesabÄ± olarak belirlenen tek bir hesap ve bir veya daha fazla Ã¼ye hesap.

*   **YÃ¶netim hesabÄ± (kÃ¶k hesap)**, kuruluÅŸu oluÅŸturmak iÃ§in kullandÄ±ÄŸÄ±nÄ±z hesaptÄ±r. KuruluÅŸun yÃ¶netim hesabÄ±ndan aÅŸaÄŸÄ±daki iÅŸlemleri yapabilirsiniz:

* KuruluÅŸta hesap oluÅŸturma
* KuruluÅŸa diÄŸer mevcut hesaplarÄ± davet etme
* HesaplarÄ± kuruluÅŸtan kaldÄ±rma
* Davetleri yÃ¶netme
* KuruluÅŸ iÃ§indeki varlÄ±klara (kÃ¶kler, OU'lar veya hesaplar) politikalar uygulama
* Desteklenen AWS hizmetleriyle entegrasyonu etkinleÅŸtirerek tÃ¼m hesaplarda hizmet iÅŸlevselliÄŸi saÄŸlama.
* Bu kÃ¶k kullanÄ±cÄ± olarak giriÅŸ yapmak, bu kÃ¶k hesap/organizasyonu oluÅŸturmak iÃ§in kullanÄ±lan e-posta ve ÅŸifre ile mÃ¼mkÃ¼ndÃ¼r.

YÃ¶netim hesabÄ±, bir Ã¶deme hesabÄ±nÄ±n sorumluluklarÄ±nÄ± Ã¼stlenir ve Ã¼ye hesaplarÄ±n biriktirdiÄŸi tÃ¼m Ã¼cretleri Ã¶demekten sorumludur. Bir kuruluÅŸun yÃ¶netim hesabÄ±nÄ± deÄŸiÅŸtiremezsiniz.
* **Ãœye hesaplar**, bir kuruluÅŸun geri kalan tÃ¼m hesaplarÄ±nÄ± oluÅŸturur. Bir hesap aynÄ± anda yalnÄ±zca bir kuruluÅŸun Ã¼yesi olabilir. Bir hesaba bir politika ekleyerek yalnÄ±zca o hesaba kontroller uygulayabilirsiniz.
* Ãœye hesaplar **geÃ§erli bir e-posta adresi** kullanmalÄ± ve bir **isim** sahip olabilir, genel olarak faturalandÄ±rmayÄ± yÃ¶netemezler (ancak eriÅŸime sahip olabilirler).
```
aws organizations create-account --account-name testingaccount --email testingaccount@lalala1233fr.com
```
### **Organizasyon Birimleri**

Hesaplar **Organizasyon Birimleri (OU)** iÃ§inde gruplandÄ±rÄ±labilir. BÃ¶ylece, Organizasyon Birimi iÃ§in **politikalar** oluÅŸturabilir ve bu politikalarÄ±n **tÃ¼m alt hesaplara uygulanmasÄ±nÄ± saÄŸlayabilirsiniz**. UnutmayÄ±n ki bir OU, diÄŸer OU'larÄ± alt birim olarak iÃ§erebilir.
```bash
# You can get the root id from aws organizations list-roots
aws organizations create-organizational-unit --parent-id r-lalala --name TestOU
```
### Hizmet Kontrol PolitikasÄ± (SCP)

Bir **hizmet kontrol politikasÄ± (SCP)**, SCP'nin etkilendiÄŸi hesaplardaki kullanÄ±cÄ±larÄ±n ve rollerin kullanabileceÄŸi hizmetleri ve eylemleri belirleyen bir politikadÄ±r. SCP'ler, IAM izin politikalarÄ±na benzer ancak **herhangi bir izin vermezler**. Bunun yerine, SCP'ler bir kuruluÅŸ, organizasyon birimi (OU) veya hesap iÃ§in **maksimum izinleri belirtir**. Bir SCP'yi kuruluÅŸ kÃ¶kÃ¼ne veya bir OU'ya eklediÄŸinizde, SCP, Ã¼ye hesaplardaki varlÄ±klar iÃ§in izinleri sÄ±nÄ±rlar.

Bu, **kÃ¶k kullanÄ±cÄ±nÄ±n bile durdurulabileceÄŸi tek yoldur**. Ã–rneÄŸin, kullanÄ±cÄ±larÄ±n CloudTrail'i devre dÄ±ÅŸÄ± bÄ±rakmasÄ±nÄ± veya yedeklemeleri silmesini engellemek iÃ§in kullanÄ±labilir.\
Bunu atlamak iÃ§in, SCP'leri yapÄ±landÄ±ran **ana hesabÄ±n da ele geÃ§irilmesi** gerekmektedir (ana hesap engellenemez).

{% hint style="warning" %}
SCPler yalnÄ±zca hesaptaki **ilgili kiÅŸileri kÄ±sÄ±tlar**, bu nedenle diÄŸer hesaplar etkilenmez. Bu, bir SCP'nin `s3:GetObject` reddini kullanmanÄ±n, hesabÄ±nÄ±zdaki **genel bir S3 kovasÄ±na eriÅŸimi** durdurmaya yetmeyeceÄŸi anlamÄ±na gelir.
{% endhint %}

SCP Ã¶rnekleri:

* KÃ¶k hesabÄ± tamamen reddet
* YalnÄ±zca belirli bÃ¶lgelere izin ver
* YalnÄ±zca beyaz listelenen hizmetlere izin ver
*   GuardDuty, CloudTrail ve S3 Genel Blok EriÅŸimini devre dÄ±ÅŸÄ± bÄ±rakmayÄ± reddet
*   GÃ¼venlik/olay yanÄ±t rollerinin silinmesini veya deÄŸiÅŸtirilmesini reddet
* Yedeklemelerin silinmesini reddet
* IAM kullanÄ±cÄ±larÄ± ve eriÅŸim anahtarlarÄ± oluÅŸturmayÄ± reddet

JSON Ã¶rneklerini [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html) adresinde bulabilirsiniz.

### ARN

**Amazon Kaynak AdÄ±** (ARN), AWS iÃ§indeki her kaynaÄŸÄ±n benzersiz adÄ±dÄ±r ve aÅŸaÄŸÄ±daki gibi oluÅŸturulur:
```
arn:partition:service:region:account-id:resource-type/resource-id
arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env
```
AWS'de 4 bÃ¶lÃ¼m bulunmaktadÄ±r, ancak bunlarÄ± Ã§aÄŸÄ±rmak iÃ§in sadece 3 yol vardÄ±r:

* AWS Standart: `aws`
* AWS Ã‡in: `aws-cn`
* AWS ABD halka aÃ§Ä±k Ä°nternet (GovCloud): `aws-us-gov`
* AWS Gizli (US SÄ±nÄ±flandÄ±rÄ±lmÄ±ÅŸ): `aws`

## IAM - Kimlik ve EriÅŸim YÃ¶netimi

IAM, AWS hesabÄ±nÄ±z iÃ§inde **Kimlik DoÄŸrulama**, **Yetkilendirme** ve **EriÅŸim KontrolÃ¼** yÃ¶netmenize olanak saÄŸlayan bir hizmettir.

* **Kimlik DoÄŸrulama** - Bir kimliÄŸi tanÄ±mlama ve bu kimliÄŸin doÄŸrulanmasÄ± sÃ¼recidir. Bu sÃ¼reÃ§, TanÄ±mlama ve DoÄŸrulama olarak alt bÃ¶lÃ¼mlere ayrÄ±labilir.
* **Yetkilendirme** - Bir kimliÄŸin doÄŸrulandÄ±ktan sonra bir sistem iÃ§inde neye eriÅŸebileceÄŸini belirler.
* **EriÅŸim KontrolÃ¼** - GÃ¼venli bir kaynaÄŸa eriÅŸimin nasÄ±l ve hangi sÃ¼reÃ§te saÄŸlandÄ±ÄŸÄ±dÄ±r.

IAM, AWS hesabÄ±nÄ±zdaki kaynaklarÄ±nÄ±za kimliklerin kimlik doÄŸrulama, yetkilendirme ve eriÅŸim kontrol mekanizmalarÄ±nÄ± yÃ¶netme, kontrol etme ve yÃ¶netme yeteneÄŸiyle tanÄ±mlanabilir.

### [AWS hesabÄ± kÃ¶k kullanÄ±cÄ±sÄ±](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_root-user.html) <a href="#id_root" id="id_root"></a>

Amazon Web Services (AWS) hesabÄ± oluÅŸturduÄŸunuzda, hesapta tÃ¼m AWS hizmetlerine ve kaynaklarÄ±na **tam eriÅŸime sahip olan** tek bir oturum aÃ§ma kimliÄŸiyle baÅŸlarsÄ±nÄ±z. Bu, AWS hesabÄ±nÄ±n _**kÃ¶k kullanÄ±cÄ±sÄ±**_ olarak adlandÄ±rÄ±lÄ±r ve hesabÄ± oluÅŸturmak iÃ§in kullandÄ±ÄŸÄ±nÄ±z **e-posta adresi ve ÅŸifreyle oturum aÃ§Ä±larak** eriÅŸilir.

Yeni bir **yÃ¶netici kullanÄ±cÄ±nÄ±n**, kÃ¶k kullanÄ±cÄ±dan **daha az izne sahip olacaÄŸÄ±nÄ±** unutmayÄ±n.

GÃ¼venlik aÃ§Ä±sÄ±ndan, baÅŸka kullanÄ±cÄ±lar oluÅŸturmanÄ±z ve bunu kullanmaktan kaÃ§Ä±nmanÄ±z Ã¶nerilir.

### [IAM kullanÄ±cÄ±larÄ±](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_users.html) <a href="#id_iam-users" id="id_iam-users"></a>

IAM _kullanÄ±cÄ±sÄ±_, AWS'de oluÅŸturduÄŸunuz ve AWS ile etkileÅŸimde bulunan **kiÅŸiyi veya uygulamayÄ± temsil eden bir varlÄ±ktÄ±r**. AWS'deki bir kullanÄ±cÄ± adÄ± ve kimlik bilgileri (ÅŸifre ve en fazla iki eriÅŸim anahtarÄ±) iÃ§erir.

Bir IAM kullanÄ±cÄ±sÄ± oluÅŸturduÄŸunuzda, uygun izin politikalarÄ±na sahip bir kullanÄ±cÄ± grubunun bir Ã¼yesi yaparak **izinler** verirsiniz (Ã¶nerilen) veya kullanÄ±cÄ±ya **doÄŸrudan politikalar ekleyerek** izinler verirsiniz.

KullanÄ±cÄ±lar, konsol Ã¼zerinden giriÅŸ yapmak iÃ§in **MFA etkinleÅŸtirilebilir**. MFA etkinleÅŸtirilmiÅŸ kullanÄ±cÄ±larÄ±n API anahtarlarÄ± MFA tarafÄ±ndan korunmaz. KullanÄ±cÄ±larÄ±n API anahtarlarÄ±nÄ±n eriÅŸimini MFA kullanarak **sÄ±nÄ±rlamak istiyorsanÄ±z**, belirli eylemleri gerÃ§ekleÅŸtirmek iÃ§in politikada MFA'nÄ±n bulunmasÄ± gerektiÄŸini belirtmeniz gerekir (Ã¶rnek [**burada**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html)).

#### CLI

* **EriÅŸim AnahtarÄ± KimliÄŸi**: AKHDNAPO86BSHKDIRYT gibi 20 rastgele bÃ¼yÃ¼k harf ve sayÄ± kombinasyonu
* **Gizli eriÅŸim anahtarÄ± kimliÄŸi**: S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtU gibi 40 rastgele bÃ¼yÃ¼k ve kÃ¼Ã§Ã¼k harf kombinasyonu (kaybolan gizli eriÅŸim anahtarÄ± kimlikleri geri alÄ±namaz).

EriÅŸim AnahtarÄ±nÄ± **deÄŸiÅŸtirmeniz gerektiÄŸinde** izlemeniz gereken sÃ¼reÃ§ ÅŸudur:\
_Yeni bir eriÅŸim anahtarÄ± oluÅŸtur -> Yeni anahtarÄ± sisteme/uygulamaya uygula -> orijinalini etkisizleÅŸtir olarak iÅŸaretle -> Yeni eriÅŸim anahtarÄ±nÄ±n Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± test et ve doÄŸrula -> Eski eriÅŸim anahtarÄ±nÄ± sil_

### MFA - Ã‡oklu FaktÃ¶r Kimlik DoÄŸrulama

Bu, mevcut yÃ¶ntemlerinize (ÅŸifre gibi) ek olarak **kimlik doÄŸrulama iÃ§in ek bir faktÃ¶r oluÅŸturmak** iÃ§in kullanÄ±lÄ±r, bÃ¶ylece Ã§ok faktÃ¶rlÃ¼ bir kimlik doÄŸrulama seviyesi oluÅŸturulur.\
Ãœcretsiz bir sanal uygulama veya fiziksel bir cihaz kullanabilirsiniz. AWS'de bir MFA etkinleÅŸtirmek iÃ§in Ã¼cretsiz olarak google kimlik doÄŸrulama gibi uygulamalarÄ± kullanabilirsiniz.

MFA koÅŸullarÄ±na sahip politikalar aÅŸaÄŸÄ±dakilere eklenir:

* Bir IAM kullanÄ±cÄ±sÄ± veya grup
* Bir Amazon S3 kovasÄ±, Amazon SQS kuyruÄŸu veya Amazon SNS konusu gibi bir kaynak
* Bir kullanÄ±cÄ± tarafÄ±ndan alÄ±nabilecek bir IAM rolÃ¼nÃ¼n gÃ¼ven politikasÄ±

MFA kontrolÃ¼ yapan bir kaynaÄŸa **CLI Ã¼zerinden eriÅŸmek isterseniz**, **`GetSessionToken`** Ã§aÄŸrÄ±sÄ± yapmanÄ±z gerekir. Bu, MFA hakkÄ±nda bilgi iÃ§eren bir belirteÃ§ verir.\
**`AssumeRole` kimlik bilgileri bu bilgiyi iÃ§ermez**.
```bash
aws sts get-session-token --serial-number <arn_device> --token-code <code>
```
[**Burada belirtildiÄŸi gibi**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html), **MFA'nÄ±n kullanÄ±lamadÄ±ÄŸÄ± birÃ§ok farklÄ± durum** vardÄ±r.

### [IAM kullanÄ±cÄ± gruplarÄ±](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) <a href="#id_iam-groups" id="id_iam-groups"></a>

IAM [kullanÄ±cÄ± grubu](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html), birden fazla kullanÄ±cÄ±ya aynÄ± anda politikalarÄ± **eklemek iÃ§in bir yol** saÄŸlar, bu da bu kullanÄ±cÄ±larÄ±n izinlerini yÃ¶netmeyi kolaylaÅŸtÄ±rabilir. **Roller ve gruplar bir grubun parÃ§asÄ± olamaz**.

Bir **kimlik tabanlÄ± politikayÄ± bir kullanÄ±cÄ± grubuna** ekleyebilirsiniz, bÃ¶ylece kullanÄ±cÄ± grubundaki **tÃ¼m kullanÄ±cÄ±lar politikanÄ±n izinlerini alÄ±r**. Bir **kullanÄ±cÄ± grubunu** (Ã¶rneÄŸin bir kaynak tabanlÄ± politika gibi) bir **`Principal`** olarak tanÄ±mlayamazsÄ±nÄ±z Ã§Ã¼nkÃ¼ gruplar izinlerle ilgilidir, kimlik doÄŸrulama ile ilgili deÄŸildir ve prensipler kimlik doÄŸrulanan IAM varlÄ±klarÄ±dÄ±r.

Ä°ÅŸte kullanÄ±cÄ± gruplarÄ±nÄ±n bazÄ± Ã¶nemli Ã¶zellikleri:

* Bir kullanÄ±cÄ± **grubu**, birÃ§ok kullanÄ±cÄ±yÄ± **iÃ§erebilir** ve bir **kullanÄ±cÄ±**, birden fazla gruba **ait olabilir**.
* **KullanÄ±cÄ± gruplarÄ± iÃ§ iÃ§e olamaz**; sadece kullanÄ±cÄ±larÄ±, baÅŸka kullanÄ±cÄ± gruplarÄ±nÄ± iÃ§eremezler.
* AWS hesabÄ±ndaki tÃ¼m kullanÄ±cÄ±larÄ± otomatik olarak iÃ§eren bir varsayÄ±lan kullanÄ±cÄ± grubu yoktur. BÃ¶yle bir kullanÄ±cÄ± grubuna sahip olmak istiyorsanÄ±z, bunu oluÅŸturmalÄ± ve her yeni kullanÄ±cÄ±yÄ± buna atamalÄ±sÄ±nÄ±z.
* Bir AWS hesabÄ±ndaki IAM kaynaklarÄ±nÄ±n sayÄ±sÄ± ve boyutu, gruplarÄ±n sayÄ±sÄ± ve bir kullanÄ±cÄ±nÄ±n Ã¼ye olabileceÄŸi gruplarÄ±n sayÄ±sÄ± gibi, sÄ±nÄ±rlÄ±dÄ±r. Daha fazla bilgi iÃ§in [IAM ve AWS STS kotalarÄ±](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_iam-quotas.html)'na bakÄ±n.

### [IAM rolleri](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles.html) <a href="#id_iam-roles" id="id_iam-roles"></a>

Bir IAM **rolÃ¼**, AWS'de ne yapabileceÄŸini ve yapamayacaÄŸÄ±nÄ± belirleyen izin politikalarÄ±na sahip bir **kullanÄ±cÄ±** gibi Ã§ok **benzerdir**. Ancak, bir rolÃ¼n **herhangi bir kimlik bilgisi** (parola veya eriÅŸim anahtarlarÄ±) ile iliÅŸkili deÄŸildir. Bir kiÅŸiyle benzersiz olarak iliÅŸkilendirilmek yerine, bir rol, ihtiyacÄ± olan herhangi bir kiÅŸi tarafÄ±ndan geÃ§ici olarak **Ã¼stlenilebilir (ve yeterli izinlere sahip olabilir)**. Bir **IAM kullanÄ±cÄ±sÄ±, belirli bir gÃ¶rev iÃ§in farklÄ± izinleri geÃ§ici olarak** Ã¼stlenebilir. Bir rol, IAM yerine harici bir kimlik saÄŸlayÄ±cÄ± kullanarak oturum aÃ§an bir [**federasyon kullanÄ±cÄ±sÄ±na**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_providers.html) atanabilir.

Bir IAM rolÃ¼, **iki tÃ¼r politikadan** oluÅŸur: BoÅŸ olamayan bir **gÃ¼ven politikasÄ±**, rolÃ¼ **kimin Ã¼stlenebileceÄŸini tanÄ±mlayan** ve boÅŸ olamayan bir **izin politikasÄ±**, rolÃ¼n **neye eriÅŸebileceÄŸini tanÄ±mlayan**.

#### AWS GÃ¼venlik Kimlik DoÄŸrulama Hizmeti (STS)

AWS GÃ¼venlik Kimlik DoÄŸrulama Hizmeti (STS), **sÄ±nÄ±rlÄ± ayrÄ±calÄ±klÄ± geÃ§ici kimlik bilgilerinin verilmesini kolaylaÅŸtÄ±ran** bir web hizmetidir. Ã–zellikle ÅŸunlar iÃ§in uyarlanmÄ±ÅŸtÄ±r:

### [IAM'deki geÃ§ici kimlik bilgileri](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_temp.html) <a href="#id_temp-creds" id="id_temp-creds"></a>

**GeÃ§ici kimlik bilgileri Ã§oÄŸunlukla IAM rolleriyle kullanÄ±lÄ±r**, ancak baÅŸka kullanÄ±mlarÄ± da vardÄ±r. Standart IAM kullanÄ±cÄ±nÄ±zÄ±n izinlerinden daha kÄ±sÄ±tlÄ± bir izin setine sahip geÃ§ici kimlik bilgileri isteyebilirsiniz. Bu, daha kÄ±sÄ±tlÄ± kimlik bilgileriyle izin verilmeyen gÃ¶revleri yanlÄ±ÅŸlÄ±kla gerÃ§ekleÅŸtirmenizi **engeller**. GeÃ§ici kimlik bilgilerinin bir avantajÄ±, kimlik bilgilerinin belirli bir sÃ¼re sonra otomatik olarak sÃ¼resinin dolmasÄ±dÄ±r. Kimlik bilgilerinin geÃ§erli olduÄŸu sÃ¼reyi kontrol edebilirsiniz.

### Politikalar

#### Politika Ä°zinleri

Ä°zinleri atamak iÃ§in kullanÄ±lÄ±r. Ä°ki tÃ¼r vardÄ±r:

* AWS tarafÄ±ndan Ã¶nceden yapÄ±landÄ±rÄ±lmÄ±ÅŸ yÃ¶netilen politikalar
* MÃ¼ÅŸteri tarafÄ±ndan yapÄ±landÄ±rÄ±lan politikalar: Siz tarafÄ±ndan yapÄ±landÄ±rÄ±lÄ±r. AWS tarafÄ±ndan Ã¶nceden yapÄ±landÄ±rÄ±lmÄ±ÅŸ politikalara dayalÄ± politikalar oluÅŸturabilirsiniz (birini deÄŸiÅŸtirerek ve kendi politikanÄ±zÄ± oluÅŸturarak), politika oluÅŸturucuyu (izinleri verme ve reddetme konusunda size yardÄ±mcÄ± olan bir GUI gÃ¶rÃ¼nÃ¼mÃ¼) veya kendi politikanÄ±zÄ± yazarak.

**VarsayÄ±lan eriÅŸim** reddedilir, aÃ§Ä±k bir rol belirtilmiÅŸse eriÅŸim saÄŸlanÄ±r.\
Tek bir "Reddetme" varsa, "Ä°zin Ver"i geÃ§ersiz kÄ±lar, yalnÄ±zca AWS hesabÄ±nÄ±n kÃ¶k gÃ¼venlik kimlik bilgilerini kullanan istekler iÃ§in (varsayÄ±lan olarak izin verilenler) geÃ§erlidir.
```javascript
{
"Version": "2012-10-17",  //Version of the policy
"Statement": [  //Main element, there can be more than 1 entry in this array
{
"Sid": "Stmt32894y234276923" //Unique identifier (optional)
"Effect": "Allow", //Allow or deny
"Action": [  //Actions that will be allowed or denied
"ec2:AttachVolume",
"ec2:DetachVolume"
],
"Resource": [ //Resource the action and effect will be applied to
"arn:aws:ec2:*:*:volume/*",
"arn:aws:ec2:*:*:instance/*"
],
"Condition": { //Optional element that allow to control when the permission will be effective
"ArnEquals": {"ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/instance-id"}
}
}
]
}
```
[Global alanlar, herhangi bir hizmet iÃ§in koÅŸullar iÃ§in kullanÄ±labilecek belgeler burada belgelenmiÅŸtir](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_policies\_condition-keys.html#condition-keys-resourceaccount).\
[Hizmet baÅŸÄ±na koÅŸullar iÃ§in kullanÄ±labilecek belirli alanlar burada belgelenmiÅŸtir](https://docs.aws.amazon.com/service-authorization/latest/reference/reference\_policies\_actions-resources-contextkeys.html).

#### SatÄ±r Ä°Ã§i Ä°zinler

Bu tÃ¼r politikalar, bir kullanÄ±cÄ±ya, gruba veya role **doÄŸrudan atanÄ±r**. ArdÄ±ndan, diÄŸerleri gibi Politikalar listesinde gÃ¶rÃ¼nmezler.\
SatÄ±r iÃ§i politikalar, bir politika ile uygulanan kimlik arasÄ±nda **katÄ± bir birbirine karÅŸÄ±lÄ±k iliÅŸkisini sÃ¼rdÃ¼rmek isterseniz** kullanÄ±ÅŸlÄ±dÄ±r. Ã–rneÄŸin, bir politikadaki izinlerin yanlÄ±ÅŸlÄ±kla amaÃ§lanan kimlik yerine baÅŸka bir kimliÄŸe atandÄ±ÄŸÄ±ndan emin olmak istersiniz. Bir satÄ±r iÃ§i politika kullandÄ±ÄŸÄ±nÄ±zda, politikadaki izinler yanlÄ±ÅŸlÄ±kla yanlÄ±ÅŸ kimliÄŸe eklenemez. AyrÄ±ca, AWS YÃ¶netim Konsolu'nu kullanarak o kimliÄŸi silerseniz, kimliÄŸe gÃ¶mÃ¼lÃ¼ politikalar da silinir. Ã‡Ã¼nkÃ¼ bunlar temel varlÄ±k parÃ§asÄ±dÄ±r.

#### Kaynak Kova PolitikalarÄ±

Bunlar, **kaynaklarda tanÄ±mlanabilen politikalardÄ±r**. **AWS'nin tÃ¼m kaynaklarÄ± bunlarÄ± desteklemez**.

Bir ilgiliye aÃ§Ä±k bir reddi olmadÄ±ÄŸÄ± ve bir kaynak politikasÄ± onlara eriÅŸim izni verdiÄŸi sÃ¼rece, izin verilirler.

### IAM SÄ±nÄ±rlarÄ±

IAM sÄ±nÄ±rlarÄ±, bir kullanÄ±cÄ±nÄ±n veya rolÃ¼n eriÅŸimine **sÄ±nÄ±rlama getirmek iÃ§in kullanÄ±labilir**. Bu ÅŸekilde, farklÄ± bir politika tarafÄ±ndan kullanÄ±cÄ±ya verilen farklÄ± bir izin kÃ¼mesi olsa bile, iÅŸlem **baÅŸarÄ±sÄ±z olur** ve kullanmaya Ã§alÄ±ÅŸÄ±rsa.

Bir sÄ±nÄ±rlama, kullanÄ±cÄ±ya eklenen bir politika yalnÄ±zca **kullanÄ±cÄ±nÄ±n veya rolÃ¼n sahip olabileceÄŸi maksimum izin seviyesini belirtir**. Yani, kullanÄ±cÄ±nÄ±n YÃ¶netici eriÅŸimi olsa bile, sÄ±nÄ±rlama onun yalnÄ±zca S3 kovalarÄ±nÄ± okuyabileceÄŸini belirtiyorsa, yapabileceÄŸi maksimum budur.

**Bu**, **SCPs** ve **en az ayrÄ±calÄ±k** ilkesini takip etmek, kullanÄ±cÄ±larÄ±n ihtiyaÃ§larÄ±ndan daha fazla izne sahip olmadÄ±ÄŸÄ±ndan emin olmanÄ±n yollarÄ±dÄ±r.

### Oturum PolitikalarÄ±

Bir oturum politikasÄ±, bir rolÃ¼n **bir oturumda varsayÄ±ldÄ±ÄŸÄ± zaman ayarlanan bir politikadÄ±r**. Bu, oturum politikasÄ±nÄ±n izinleri **vermez, ancak politikada belirtilenlere kÄ±sÄ±tlar** (maksimum izinler rolÃ¼n sahip olduÄŸu izinlerdir).

Bu, **gÃ¼venlik Ã¶nlemleri** iÃ§in kullanÄ±ÅŸlÄ±dÄ±r: Bir yÃ¶netici Ã§ok ayrÄ±calÄ±klÄ± bir rolÃ¼ varsaydÄ±ÄŸÄ±nda, oturum politikasÄ±nda yalnÄ±zca politikada belirtilen izinlere sÄ±nÄ±rlama getirebilir, bÃ¶ylece oturum tehlikeye atÄ±ldÄ±ÄŸÄ±nda sadece belirtilen izinlere sahip olur.
```bash
aws sts assume-role \
--role-arn <value> \
--role-session-name <value> \
[--policy-arns <arn_custom_policy1> <arn_custom_policy2>]
[--policy <file://policy.json>]
```
Not: VarsayÄ±lan olarak, AWS Ã¼Ã§Ã¼ncÃ¼ nedenlerden dolayÄ± oluÅŸturulacak oturumlar iÃ§in oturum politikalarÄ± ekleyebilir. Ã–rneÄŸin, [kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ cognito varsayÄ±lan rollerinde](../aws-services/aws-cognito-enum/cognito-identity-pools.md#accessing-iam-roles) (geliÅŸmiÅŸ kimlik doÄŸrulama kullanarak) AWS, oturum politikasÄ± ile oturum kimlik bilgileri oluÅŸturur ve bu oturumun eriÅŸebileceÄŸi hizmetleri [aÅŸaÄŸÄ±daki listede](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services) sÄ±nÄ±rlar.

Bu nedenle, "... Ã§Ã¼nkÃ¼ hiÃ§bir oturum politikasÄ± izin vermiyor ..." hatasÄ±yla karÅŸÄ±laÅŸÄ±rsanÄ±z ve rolÃ¼n eylemi gerÃ§ekleÅŸtirmek iÃ§in eriÅŸimi varsa, bunun nedeni bir oturum politikasÄ±nÄ±n engellemesidir.

### Kimlik Federasyonu

Kimlik federasyonu, AWS'ye dÄ±ÅŸ kaynaklÄ± kimlik saÄŸlayÄ±cÄ±lardan gelen kullanÄ±cÄ±larÄ±n AWS kaynaklarÄ±na gÃ¼venli bir ÅŸekilde eriÅŸmesine olanak tanÄ±rken geÃ§erli bir IAM kullanÄ±cÄ± hesabÄ±ndan AWS kullanÄ±cÄ± kimlik bilgilerini saÄŸlamadan eriÅŸmelerini saÄŸlar.
Bir kimlik saÄŸlayÄ±cÄ±nÄ±n bir Ã¶rneÄŸi, kendi kurumsal **Microsoft Active Directory**'niz (SAML aracÄ±lÄ±ÄŸÄ±yla) veya **OpenID** hizmetleri (Ã¶rneÄŸin **Google**) olabilir. Federasyon eriÅŸimi, iÃ§indeki kullanÄ±cÄ±larÄ±n AWS'ye eriÅŸmesine izin verir.

Bu gÃ¼veni yapÄ±landÄ±rmak iÃ§in, **IAM Kimlik SaÄŸlayÄ±cÄ±** oluÅŸturulur (SAML veya OAuth) ve **diÄŸer platforma gÃ¼ven** saÄŸlar. ArdÄ±ndan, en az bir **IAM rolÃ¼ (gÃ¼venen) Kimlik SaÄŸlayÄ±cÄ±ya atanÄ±r**. GÃ¼venilen platformdan bir kullanÄ±cÄ± AWS'ye eriÅŸirse, belirtilen rol olarak eriÅŸecektir.

Ancak genellikle Ã¼Ã§Ã¼ncÃ¼ taraf platformdaki kullanÄ±cÄ±nÄ±n grubuna baÄŸlÄ± olarak **farklÄ± bir rol vermek isteyeceksiniz**. ArdÄ±ndan, birkaÃ§ **IAM rolÃ¼ Ã¼Ã§Ã¼ncÃ¼ taraf Kimlik SaÄŸlayÄ±cÄ±ya gÃ¼venebilir** ve Ã¼Ã§Ã¼ncÃ¼ taraf platform, kullanÄ±cÄ±larÄ±n bir rolÃ¼ veya diÄŸerini Ã¼stlenmesine izin veren taraftÄ±r.

<figure><img src="../../../.gitbook/assets/image (1) (2).png" alt=""><figcaption></figcaption></figure>

### IAM Kimlik Merkezi

AWS IAM Kimlik Merkezi (AWS Single Sign-On'un halefi), AWS Kimlik ve EriÅŸim YÃ¶netimi (IAM) yeteneklerini geniÅŸleterek, **kullanÄ±cÄ±larÄ±n AWS hesaplarÄ±na ve bulut uygulamalarÄ±na eriÅŸimlerini yÃ¶neten kullanÄ±cÄ±larÄ±n yÃ¶netimini bir araya getiren merkezi bir yer** saÄŸlar.

GiriÅŸ alanÄ± `<kullanÄ±cÄ±_giriÅŸi>.awsapps.com` gibi bir ÅŸey olacak.

KullanÄ±cÄ±larÄ± giriÅŸ yapmak iÃ§in kullanÄ±labilecek 3 kimlik kaynaÄŸÄ± vardÄ±r:

* Kimlik Merkezi Dizini: Normal AWS kullanÄ±cÄ±larÄ±
* Active Directory: FarklÄ± baÄŸlayÄ±cÄ±larÄ± destekler
* Harici Kimlik SaÄŸlayÄ±cÄ±: TÃ¼m kullanÄ±cÄ±lar ve gruplar harici bir Kimlik SaÄŸlayÄ±cÄ±dan gelir (IdP)

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

Kimlik Merkezi dizini durumunda, **Kimlik Merkezi bir kullanÄ±cÄ±lar ve gruplar listesine sahip olacak** ve bunlara **kuruluÅŸun tÃ¼m hesaplarÄ±ndan herhangi birine politikalar atayabilecektir**.

Kimlik Merkezi kullanÄ±cÄ±/grubuna bir hesaba eriÅŸim vermek iÃ§in, **Kimlik Merkezine gÃ¼venen bir SAML Kimlik SaÄŸlayÄ±cÄ± oluÅŸturulacak** ve belirtilen politikalarla birlikte **Kimlik SaÄŸlayÄ±cÄ±ya gÃ¼venen bir rol** hedef hesapta oluÅŸturulacaktÄ±r.

#### AwsSSOInlinePolicy

IAM Kimlik Merkezi aracÄ±lÄ±ÄŸÄ±yla oluÅŸturulan roller iÃ§in **inline politikalar aracÄ±lÄ±ÄŸÄ±yla izinler vermek mÃ¼mkÃ¼ndÃ¼r**. AWS Kimlik Merkezi'nde **inline politikalarla verilen hesaplarda oluÅŸturulan roller**, bu izinlere sahip olacaktÄ±r ve bu izinler **`AwsSSOInlinePolicy`** adlÄ± bir inline politikada bulunacaktÄ±r.

Bu nedenle, **`AwsSSOInlinePolicy`** adÄ±nda bir inline politikaya sahip 2 rol gÃ¶rÃ¼rseniz, **aynÄ± izinlere sahip olmadÄ±ÄŸÄ± anlamÄ±na gelir**.

### Hesaplar ArasÄ± GÃ¼ven ve Roller

**Bir kullanÄ±cÄ±** (gÃ¼venen), bazÄ± politikalarla birlikte Hesaplar ArasÄ± Rol oluÅŸturabilir ve ardÄ±ndan, **baÅŸka bir kullanÄ±cÄ±ya** (gÃ¼venilen) hesabÄ±na **eriÅŸim izni verebilir**, ancak yalnÄ±zca **yeni rol politikalarÄ±nda belirtilen eriÅŸime sahip olur**. Bunun iÃ§in sadece yeni bir Rol oluÅŸturmanÄ±z ve Hesaplar ArasÄ± Rol'Ã¼ seÃ§meniz yeterlidir. Hesaplar ArasÄ± EriÅŸim iÃ§in iki seÃ§enek sunar. Sahip olduÄŸunuz AWS hesaplarÄ± arasÄ±nda eriÅŸim saÄŸlamak ve sahip olduÄŸunuz bir hesap ile Ã¼Ã§Ã¼ncÃ¼ taraf bir AWS hesabÄ± arasÄ±nda eriÅŸim saÄŸlamak.
Bu gÃ¼veni oluÅŸturmak iÃ§in **gÃ¼venilen kullanÄ±cÄ±yÄ± belirtmek ve bazÄ± genel bir ÅŸeyler koymamak** Ã¶nerilir, Ã§Ã¼nkÃ¼ aksi takdirde federasyon kullanÄ±cÄ±larÄ± gibi diÄŸer kimlik doÄŸrulanan kullanÄ±cÄ±lar da bu gÃ¼veni kÃ¶tÃ¼ye kullanabilir.

### AWS Basit AD

Desteklenmeyenler:

* GÃ¼ven Ä°liÅŸkileri
* AD YÃ¶netim Merkezi
* Tam PS API desteÄŸi
* AD Geri DÃ¶nÃ¼ÅŸÃ¼m Kutusu
* Grup YÃ¶netilen Hizmet HesaplarÄ±
* Åema UzantÄ±larÄ±
* Ä°ÅŸletim Sistemine veya Ã–rneklerine DoÄŸrudan EriÅŸim Yok

#### Web Federasyonu veya OpenID Kimlik DoÄŸrulama

Uygulama, geÃ§ici kimlik bilgileri oluÅŸturmak iÃ§in AssumeRoleWithWebIdentity'yi kullanÄ±r. Bununla birlikte, bu, AWS konsoluna eriÅŸim saÄŸlamaz, yalnÄ±zca AWS iÃ§indeki kaynaklara eriÅŸim saÄŸlar.

### DiÄŸer IAM seÃ§enekleri

* Minimum uzunluk ve ÅŸifre gereksinimleri gibi seÃ§eneklerle bir ÅŸifre politikasÄ± ayarlayabilirsiniz.
* Mevcut kimlik bilgileri hakkÄ±nda bilgi iÃ§eren "Kimlik Bilgileri Raporunu" indirebilirsiniz (kullanÄ±cÄ± oluÅŸturma zamanÄ±, ÅŸifre etkin mi...). Kimlik bilgileri raporu, en fazla **dÃ¶rt saatte bir** olmak Ã¼zere sÄ±k sÄ±k oluÅŸturulabilir.

AWS Kimlik ve EriÅŸim YÃ¶netimi (IAM), tÃ¼m AWS hizmetlerine yÃ¶nelik **inceden inceye eriÅŸim kontrolÃ¼** saÄŸlar. IAM ile **kimin hangi hizmetlere ve kaynaklara eriÅŸebileceÄŸini** ve hangi koÅŸullar altÄ±nda belirleyebilirsiniz. IAM politikalarÄ± ile iÅŸ gÃ¼cÃ¼nÃ¼z ve sistemlerinizin izinlerini yÃ¶neterek **en az ayrÄ±calÄ±klÄ± izinleri saÄŸlarsÄ±nÄ±z**.

### IAM Kimlik Ã–nekleri

[**Bu sayfada**](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_identifiers.html#identifiers-unique-ids) anahtarlarÄ±n doÄŸasÄ±na baÄŸlÄ± olarak IAM Kimlik Ã–neklerini bulabilirsiniz:

| ABIA | [AWS STS hizmet taÅŸÄ±yÄ±cÄ± belirteci](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_bearer.html) |
| ---- | ----------------------------------------------------------------------------------------------------------------- |
| ACCA | BaÄŸlama Ã¶zgÃ¼ kimlik bilgisi                                                                                         |
| AGPA | KullanÄ±cÄ± grubu                                                                                                    |
| AIDA | IAM kullanÄ±cÄ±sÄ±                                                                                                   |
| AIPA | Amazon EC2 Ã¶rnek profili                                                                                          |
| AKIA | EriÅŸim anahtarÄ±                                                                                                   |
| ANPA | YÃ¶netilen politika                                                                                                |
| ANVA | YÃ¶netilen politikadaki sÃ¼rÃ¼m                                                                                      |
| APKA | Genel anahtar                                                                                                     |
| AROA | Rol                                                                                                               |
| ASCA | Sertifika                                                                                                         |
| ASIA | [GeÃ§ici (AWS STS) eriÅŸim anahtar kimlikleri](https://docs.aws.amazon.com/STS/latest/APIReference/API\_Credentials.html) bu Ã¶neki kullanÄ±r, ancak yalnÄ±zca gizli eriÅŸim anahtarÄ± ve oturum belirteciyle birlikte benzersizdir. |

### HesaplarÄ± denetlemek iÃ§in Ã¶nerilen izinler

AÅŸaÄŸÄ±daki yetkiler, Ã§eÅŸitli meta veri okuma eriÅŸimini saÄŸlar:

* `arn:aws:iam::aws:policy/SecurityAudit`
* `arn:aws:iam::aws:policy/job-function/ViewOnlyAccess`
* `codebuild:ListProjects`
* `config:Describe*`
* `cloudformation:ListStack
```
[default]
aws_access_key_id = AKIA5ZDCUJHF83HDTYUT
aws_secret_access_key = uOcdhof683fbOUGFYEQug8fUGIf68greoihef

[Admin]
aws_access_key_id = AKIA8YDCu7TGTR356SHYT
aws_secret_access_key = uOcdhof683fbOUGFYEQuR2EIHG34UY987g6ff7
region = eu-west-2
```
EÄŸer **farklÄ± AWS hesaplarÄ±na** eriÅŸmeniz gerekiyorsa ve profiliniz bu hesaplarda **bir rolÃ¼ Ã¼stlenme yetkisi** verildiyse, her seferinde STS'yi manuel olarak Ã§aÄŸÄ±rmak (`aws sts assume-role --role-arn <role-arn> --role-session-name sessname`) ve kimlik bilgilerini yapÄ±landÄ±rmak zorunda deÄŸilsiniz.

`~/.aws/config` dosyasÄ±nÄ± kullanarak [**hangi rollerin Ã¼stlenileceÄŸini belirtebilirsiniz**](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html) ve ardÄ±ndan `--profile` parametresini kullanarak (kullanÄ±cÄ± iÃ§in `assume-role` iÅŸlemi ÅŸeffaf bir ÅŸekilde gerÃ§ekleÅŸtirilecektir) normal ÅŸekilde devam edebilirsiniz.\
Bir yapÄ±landÄ±rma dosyasÄ± Ã¶rneÄŸi:
```
[profile acc2]
region=eu-west-2
role_arn=arn:aws:iam::<account-id>:role/<role-path>
role_session_name = <session_name>
source_profile = <profile_with_assume_role>
sts_regional_endpoints = regional
```
Bu yapÄ±landÄ±rma dosyasÄ±yla aws cli'yi aÅŸaÄŸÄ±daki gibi kullanabilirsiniz:
```
aws --profile acc2 ...
```
EÄŸer tarayÄ±cÄ± iÃ§in buna benzer bir ÅŸey arÄ±yorsanÄ±z, [AWS Extend Switch Roles](https://chrome.google.com/webstore/detail/aws-extend-switch-roles/jpmkfafbacpgapdghgdpembnojdlgkdl?hl=en) adlÄ± eklentiyi kontrol edebilirsiniz.

## Referanslar

* [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html)
* [https://aws.amazon.com/iam/](https://aws.amazon.com/iam/)
* [https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerimizden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin**.
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
