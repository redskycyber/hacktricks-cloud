# AWS Pentesting

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)\*\* ä¸Šå…³æ³¨æˆ‘ä»¬\*\*ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

åœ¨å¼€å§‹å¯¹ **AWS** ç¯å¢ƒè¿›è¡Œæ¸—é€æµ‹è¯•ä¹‹å‰ï¼Œæœ‰ä¸€äº› **åŸºæœ¬äº‹é¡¹** æ‚¨éœ€è¦äº†è§£å…³äº AWS çš„å·¥ä½œåŸç†ï¼Œä»¥å¸®åŠ©æ‚¨ç†è§£éœ€è¦åšä»€ä¹ˆï¼Œå¦‚ä½•æŸ¥æ‰¾é…ç½®é”™è¯¯ä»¥åŠå¦‚ä½•åˆ©ç”¨å®ƒä»¬ã€‚

ç»„ç»‡å±‚æ¬¡ç»“æ„ã€IAM å’Œå…¶ä»–åŸºæœ¬æ¦‚å¿µç­‰æ¦‚å¿µåœ¨ä»¥ä¸‹ä½ç½®æœ‰è§£é‡Šï¼š

{% content-ref url="aws-basic-information/" %}
[aws-basic-information](aws-basic-information/)
{% endcontent-ref %}

## å­¦ä¹ å®éªŒ

* [https://github.com/RhinoSecurityLabs/cloudgoat](https://github.com/RhinoSecurityLabs/cloudgoat)
* [https://github.com/BishopFox/iam-vulnerable](https://github.com/BishopFox/iam-vulnerable)
* [https://github.com/nccgroup/sadcloud](https://github.com/nccgroup/sadcloud)
* [https://github.com/bridgecrewio/terragoat](https://github.com/bridgecrewio/terragoat)
* [https://github.com/ine-labs/AWSGoat](https://github.com/ine-labs/AWSGoat)
* [http://flaws.cloud/](http://flaws.cloud/)
* [http://flaws2.cloud/](http://flaws2.cloud/)

ç”¨äºæ¨¡æ‹Ÿæ”»å‡»çš„å·¥å…·ï¼š

* [https://github.com/Datadog/stratus-red-team/](https://github.com/Datadog/stratus-red-team/)
* [https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main](https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main)

## AWS æ¸—é€æµ‹è¯•å‘˜/çº¢é˜Ÿæ–¹æ³•è®º

è¦å®¡è®¡ AWS ç¯å¢ƒï¼Œéå¸¸é‡è¦çš„æ˜¯è¦çŸ¥é“ï¼šæ­£åœ¨ä½¿ç”¨å“ªäº›**æœåŠ¡**ï¼Œæ­£åœ¨**æš´éœ²**ä»€ä¹ˆï¼Œè°æœ‰**è®¿é—®æƒé™**ï¼Œä»¥åŠå†…éƒ¨ AWS æœåŠ¡å’Œ**å¤–éƒ¨æœåŠ¡**å¦‚ä½•è¿æ¥ã€‚

ä»çº¢é˜Ÿçš„è§’åº¦æ¥çœ‹ï¼Œ**å…¥ä¾µ AWS ç¯å¢ƒçš„ç¬¬ä¸€æ­¥**æ˜¯è®¾æ³•è·å–ä¸€äº›**å‡­æ®**ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›è·å–å‡­æ®çš„æ–¹æ³•ï¼š

* åœ¨ githubï¼ˆæˆ–ç±»ä¼¼ç½‘ç«™ï¼‰ä¸­çš„**æ³„æ¼** - OSINT
* **ç¤¾ä¼š**å·¥ç¨‹
* **å¯†ç **é‡ç”¨ï¼ˆå¯†ç æ³„æ¼ï¼‰
* AWS æ‰˜ç®¡åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´
* [**æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) å¹¶è®¿é—®å…ƒæ•°æ®ç«¯ç‚¹
* **æœ¬åœ°æ–‡ä»¶è¯»å–**
* `/home/USERNAME/.aws/credentials`
* `C:\Users\USERNAME\.aws\credentials`
* ç¬¬ä¸‰æ–¹**é­åˆ°å…¥ä¾µ**
* **å†…éƒ¨**å‘˜å·¥
* [**Cognito** ](aws-services/aws-cognito-enum/#cognito)å‡­æ®

æˆ–é€šè¿‡**å…¥ä¾µæš´éœ²çš„æœªç»èº«ä»½éªŒè¯æœåŠ¡**ï¼š

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

æˆ–è€…å¦‚æœæ‚¨æ­£åœ¨è¿›è¡Œ**å®¡æŸ¥**ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹è§’è‰²**è¯·æ±‚å‡­æ®**ï¼š

{% content-ref url="aws-permissions-for-a-pentest.md" %}
[aws-permissions-for-a-pentest.md](aws-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
åœ¨æˆåŠŸè·å–å‡­æ®åï¼Œæ‚¨éœ€è¦çŸ¥é“è¿™äº›å‡­æ®å±äº**è°**ï¼Œä»¥åŠä»–ä»¬æœ‰ä»€ä¹ˆ**è®¿é—®æƒé™**ï¼Œå› æ­¤æ‚¨éœ€è¦æ‰§è¡Œä¸€äº›åŸºæœ¬æšä¸¾ï¼š
{% endhint %}

## åŸºæœ¬æšä¸¾

### SSRF

å¦‚æœåœ¨ AWS å†…éƒ¨çš„æŸå°æœºå™¨ä¸­å‘ç° SSRFï¼Œè¯·æŸ¥çœ‹æ­¤é¡µé¢è·å–æŠ€å·§ï¼š

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Whoami

æ‚¨éœ€è¦äº†è§£çš„ç¬¬ä¸€ä»¶äº‹ä¹‹ä¸€æ˜¯æ‚¨æ˜¯è°ï¼ˆæ‚¨åœ¨å“ªä¸ªå¸æˆ·ä¸­ä»¥åŠæœ‰å…³ AWS ç¯å¢ƒçš„å…¶ä»–ä¿¡æ¯ï¼‰ï¼š

```bash
# Easiest way, but might be monitored?
aws sts get-caller-identity
aws iam get-user # This will get your own user

# If you have a Key ID
aws sts get-access-key-info --access-key-id=ASIA1234567890123456

# Get inside error message
aws sns publish --topic-arn arn:aws:sns:us-east-1:*account id*:aaa --message aaa

# From metadata
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`
curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/dynamic/instance-identity/document
```

{% hint style="danger" %}
æ³¨æ„å…¬å¸å¯èƒ½ä½¿ç”¨**canary tokens**æ¥è¯†åˆ«**ä»¤ç‰Œè¢«ç›—ç”¨å’Œä½¿ç”¨**çš„æƒ…å†µã€‚å»ºè®®åœ¨ä½¿ç”¨ä»¤ç‰Œä¹‹å‰æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦ä¸ºcanary tokenã€‚\
æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[**æ­¤é¡µé¢**](aws-services/aws-security-and-detection-services/aws-cloudtrail-enum.md#honeytokens-bypass)ã€‚
{% endhint %}

### æœºæ„æšä¸¾

{% content-ref url="aws-services/aws-organizations-enum.md" %}
[aws-organizations-enum.md](aws-services/aws-organizations-enum.md)
{% endcontent-ref %}

### IAM æšä¸¾

å¦‚æœæ‚¨æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™**æ£€æŸ¥AWSè´¦æˆ·å†…æ¯ä¸ªå®ä½“çš„æƒé™**å°†å¸®åŠ©æ‚¨äº†è§£æ‚¨å’Œå…¶ä»–èº«ä»½å¯ä»¥åšä»€ä¹ˆä»¥åŠå¦‚ä½•**æå‡æƒé™**ã€‚

å¦‚æœæ‚¨æ²¡æœ‰è¶³å¤Ÿçš„æƒé™æ¥æšä¸¾IAMï¼Œæ‚¨å¯ä»¥**æš´åŠ›ç ´è§£**å®ƒä»¬ä»¥æ‰¾å‡ºã€‚\
æŸ¥çœ‹å¦‚ä½•è¿›è¡Œæšä¸¾å’Œæš´åŠ›ç ´è§£çš„æ–¹æ³•ï¼š

{% content-ref url="aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](aws-services/aws-iam-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
ç°åœ¨æ‚¨**å·²ç»è·å¾—æœ‰å…³æ‚¨çš„å‡­æ®çš„ä¸€äº›ä¿¡æ¯**ï¼ˆå¦‚æœæ‚¨æ˜¯çº¢é˜Ÿï¼Œå¸Œæœ›æ‚¨**å°šæœªè¢«å‘ç°**ï¼‰ã€‚ç°åœ¨æ˜¯æ—¶å€™å¼„æ¸…æ¥šç¯å¢ƒä¸­æ­£åœ¨ä½¿ç”¨å“ªäº›æœåŠ¡äº†ã€‚\
åœ¨ä»¥ä¸‹éƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ä¸€äº›**æšä¸¾ä¸€äº›å¸¸è§æœåŠ¡**çš„æ–¹æ³•ã€‚
{% endhint %}

## æœåŠ¡æšä¸¾ã€åæ¸—é€å’ŒæŒä¹…æ€§

AWSæ‹¥æœ‰å¤§é‡æœåŠ¡ï¼Œåœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å°†æ‰¾åˆ°æœ‰å…³**åŸºæœ¬ä¿¡æ¯ã€æšä¸¾**é€ŸæŸ¥è¡¨ï¼Œå¦‚ä½•**é¿å…æ£€æµ‹**ï¼Œè·å–**æŒä¹…æ€§**ä»¥åŠå…¶ä»–å…³äºå…¶ä¸­ä¸€äº›æœåŠ¡çš„**åæ¸—é€**æŠ€å·§ï¼š

{% content-ref url="aws-services/" %}
[aws-services](aws-services/)
{% endcontent-ref %}

è¯·æ³¨æ„ï¼Œæ‚¨**ä¸éœ€è¦**æ‰‹åŠ¨æ‰§è¡Œæ‰€æœ‰å·¥ä½œï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°å…³äº[**è‡ªåŠ¨åŒ–å·¥å…·**](./#automated-tools)çš„**éƒ¨åˆ†**ã€‚

æ­¤å¤–ï¼Œåœ¨æ­¤é˜¶æ®µï¼Œæ‚¨å¯èƒ½å‘ç°**æ›´å¤šæœåŠ¡æš´éœ²ç»™æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·**ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿåˆ©ç”¨å®ƒä»¬ï¼š

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

## ææƒ

å¦‚æœæ‚¨è‡³å°‘å¯ä»¥**æ£€æŸ¥è‡ªå·±å¯¹ä¸åŒèµ„æºçš„æƒé™**ï¼Œåˆ™å¯ä»¥**æ£€æŸ¥æ˜¯å¦èƒ½å¤Ÿè·å¾—è¿›ä¸€æ­¥çš„æƒé™**ã€‚æ‚¨è‡³å°‘åº”å…³æ³¨ä»¥ä¸‹æƒé™ï¼š

{% content-ref url="aws-privilege-escalation/" %}
[aws-privilege-escalation](aws-privilege-escalation/)
{% endcontent-ref %}

## å…¬å¼€æš´éœ²çš„æœåŠ¡

åœ¨æšä¸¾AWSæœåŠ¡æ—¶ï¼Œæ‚¨å¯èƒ½å‘ç°å…¶ä¸­ä¸€äº›æœåŠ¡**å‘äº’è”ç½‘å…¬å¼€å…ƒç´ **ï¼ˆVM/å®¹å™¨ç«¯å£ã€æ•°æ®åº“æˆ–é˜Ÿåˆ—æœåŠ¡ã€å¿«ç…§æˆ–å­˜å‚¨æ¡¶...ï¼‰ã€‚\
ä½œä¸ºæ¸—é€æµ‹è¯•å‘˜/çº¢é˜Ÿäººå‘˜ï¼Œæ‚¨åº”å§‹ç»ˆæ£€æŸ¥æ˜¯å¦å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°**æ•æ„Ÿä¿¡æ¯/æ¼æ´**ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¸ºæ‚¨æä¾›**è¿›ä¸€æ­¥è®¿é—®AWSè´¦æˆ·**çš„æœºä¼šã€‚

åœ¨æœ¬ä¹¦ä¸­ï¼Œæ‚¨åº”è¯¥æ‰¾åˆ°æœ‰å…³å¦‚ä½•æ‰¾åˆ°**æš´éœ²çš„AWSæœåŠ¡ä»¥åŠå¦‚ä½•æ£€æŸ¥å®ƒä»¬**çš„**ä¿¡æ¯**ã€‚å…³äºå¦‚ä½•åœ¨æš´éœ²çš„ç½‘ç»œæœåŠ¡ä¸­æ‰¾åˆ°**æ¼æ´**ï¼Œæˆ‘å»ºè®®æ‚¨**æœç´¢**ç‰¹å®š**æœåŠ¡**çš„å†…å®¹ï¼š

{% embed url="https://book.hacktricks.xyz/" %}

## å…¥ä¾µç»„ç»‡

### æ¥è‡ªæ ¹/ç®¡ç†è´¦æˆ·

å½“ç®¡ç†è´¦æˆ·åœ¨ç»„ç»‡ä¸­åˆ›å»ºæ–°è´¦æˆ·æ—¶ï¼Œæ–°è´¦æˆ·ä¸­ä¼šåˆ›å»ºä¸€ä¸ª**æ–°è§’è‰²**ï¼Œé»˜è®¤å‘½åä¸º\*\*`OrganizationAccountAccessRole`**ï¼Œå¹¶ä¸º**ç®¡ç†è´¦æˆ·**æˆäºˆ**AdministratorAccess\*\*ç­–ç•¥ä»¥è®¿é—®æ–°è´¦æˆ·ã€‚

<figure><img src="../../.gitbook/assets/image (3) (3) (2).png" alt=""><figcaption></figcaption></figure>

å› æ­¤ï¼Œä¸ºäº†ä½œä¸ºç®¡ç†å‘˜è®¿é—®å­è´¦æˆ·ï¼Œæ‚¨éœ€è¦ï¼š

* **å…¥ä¾µ\*\*\*\*ç®¡ç†**è´¦æˆ·å¹¶æ‰¾åˆ°**å­è´¦æˆ·çš„ID**å’Œ**è§’è‰²çš„åç§°**ï¼ˆé»˜è®¤ä¸ºOrganizationAccountAccessRoleï¼‰ï¼Œå…è®¸ç®¡ç†è´¦æˆ·ä½œä¸ºç®¡ç†å‘˜è®¿é—®ã€‚
* è¦æŸ¥æ‰¾å­è´¦æˆ·ï¼Œè¯·è½¬åˆ°AWSæ§åˆ¶å°ä¸­çš„ç»„ç»‡éƒ¨åˆ†æˆ–è¿è¡Œ`aws organizations list-accounts`ã€‚
* æ‚¨æ— æ³•ç›´æ¥æ‰¾åˆ°è§’è‰²çš„åç§°ï¼Œå› æ­¤è¯·æ£€æŸ¥æ‰€æœ‰è‡ªå®šä¹‰IAMç­–ç•¥ï¼Œå¹¶æœç´¢ä»»ä½•å…è®¸\*\*`sts:AssumeRole`è¦†ç›–å…ˆå‰å‘ç°çš„å­è´¦æˆ·\*\*çš„ç­–ç•¥ã€‚
* **å…¥ä¾µ**ç®¡ç†è´¦æˆ·ä¸­å…·æœ‰\*\*`sts:AssumeRole`æƒé™**çš„**ä¸»ä½“\*\*ï¼Œä»¥è¦†ç›–å­è´¦æˆ·ä¸­çš„è§’è‰²ï¼ˆå³ä½¿è¯¥è´¦æˆ·å…è®¸æ¥è‡ªç®¡ç†è´¦æˆ·çš„ä»»ä½•äººå†’å……ï¼Œä¹Ÿéœ€è¦ç‰¹å®šçš„`sts:AssumeRole`æƒé™ï¼‰ã€‚

## è‡ªåŠ¨åŒ–å·¥å…·

### ä¾¦å¯Ÿ

* [**aws-recon**](https://github.com/darkbitio/aws-recon)ï¼šä¸€ä¸ªç”¨Rubyç¼–å†™çš„å¤šçº¿ç¨‹AWSå®‰å…¨é‡ç‚¹**æ¸…å•æ”¶é›†å·¥å…·**ã€‚

```bash
# Install
gem install aws_recon

# Recon and get json
AWS_PROFILE=<profile> aws_recon \
--services S3,EC2 \
--regions global,us-east-1,us-east-2 \
--verbose
```

* [**cloudlist**](https://github.com/projectdiscovery/cloudlist): Cloudlistæ˜¯ä¸€ä¸ªç”¨äºä»äº‘æä¾›å•†è·å–èµ„äº§ï¼ˆä¸»æœºåã€IPåœ°å€ï¼‰çš„**å¤šäº‘å·¥å…·**ã€‚
* [**cloudmapper**](https://github.com/duo-labs/cloudmapper): CloudMapperå¸®åŠ©æ‚¨åˆ†ææ‚¨çš„Amazon Web Services (AWS)ç¯å¢ƒã€‚å®ƒç°åœ¨åŒ…å«äº†æ›´å¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬å®‰å…¨é—®é¢˜çš„å®¡è®¡ã€‚

```bash
# Installation steps in github
# Create a config.json file with the aws info, like:
{
"accounts": [
{
"default": true,
"id": "<account id>",
"name": "dev"
}
],
"cidrs":
{
"2.2.2.2/28": {"name": "NY Office"}
}
}

# Enumerate
python3 cloudmapper.py collect --profile dev
## Number of resources discovered
python3 cloudmapper.py stats --accounts dev

# Create HTML report
## In the report you will find all the info already
python3 cloudmapper.py report --accounts dev

# Identify potential issues
python3 cloudmapper.py audit --accounts dev --json > audit.json
python3 cloudmapper.py audit --accounts dev --markdow > audit.md
python3 cloudmapper.py iam_report --accounts dev

# Identify admins
## The permissions search for are in https://github.com/duo-labs/cloudmapper/blob/4df9fd7303e0337ff16a08f5e58f1d46047c4a87/shared/iam_audit.py#L163-L175
python3 cloudmapper.py find_admins --accounts dev

# Identify unused elements
python3 cloudmapper.py find_unused --accounts dev

# Identify publivly exposed resources
python3 cloudmapper.py public --accounts dev

python cloudmapper.py prepare #Prepare webserver
python cloudmapper.py webserver #Show webserver
```

* [**cartography**](https://github.com/lyft/cartography): Cartographyæ˜¯ä¸€ä¸ªPythonå·¥å…·ï¼Œå®ƒåœ¨ç”±Neo4jæ•°æ®åº“æ”¯æŒçš„ç›´è§‚å›¾å½¢è§†å›¾ä¸­ consolidaäº†åŸºç¡€è®¾æ–½èµ„äº§åŠå…¶ä¹‹é—´çš„å…³ç³»ã€‚

```bash
# Install
pip install cartography
## At the time of this writting you need neo4j version 3.5.*

# Get AWS info
AWS_PROFILE=dev cartography --neo4j-uri bolt://127.0.0.1:7687 --neo4j-password-prompt  --neo4j-user neo4j
```

* [**starbase**](https://github.com/JupiterOne/starbase): Starbaseæ”¶é›†æ¥è‡ªå„ç§æœåŠ¡å’Œç³»ç»Ÿï¼ˆåŒ…æ‹¬äº‘åŸºç¡€è®¾æ–½ã€SaaSåº”ç”¨ç¨‹åºã€å®‰å…¨æ§åˆ¶ç­‰ï¼‰çš„èµ„äº§å’Œå…³ç³»ï¼Œå‘ˆç°ä¸ºç›´è§‚çš„å›¾å½¢è§†å›¾ï¼Œæ”¯æŒNeo4jæ•°æ®åº“ã€‚
* [**aws-inventory**](https://github.com/nccgroup/aws-inventory): ï¼ˆä½¿ç”¨python2ï¼‰è¿™æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå°è¯•å‘ç°è´¦æˆ·ä¸­åˆ›å»ºçš„æ‰€æœ‰[**AWSèµ„æº**](https://docs.aws.amazon.com/general/latest/gr/glos-chap.html#resource)ã€‚
* [**aws\_public\_ips**](https://github.com/arkadiyt/aws\_public\_ips): è¿™æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºè·å–ä¸AWSè´¦æˆ·å…³è”çš„æ‰€æœ‰å…¬å…±IPåœ°å€ï¼ˆIPv4/IPv6ï¼‰ã€‚

### ææƒä¸åˆ©ç”¨

* [**SkyArk**](https://github.com/cyberark/SkyArk)**:** å‘ç°æ‰«æçš„AWSç¯å¢ƒä¸­æœ€å…·ç‰¹æƒçš„ç”¨æˆ·ï¼ŒåŒ…æ‹¬AWSå½±å­ç®¡ç†å‘˜ã€‚å®ƒä½¿ç”¨PowerShellã€‚æ‚¨å¯ä»¥åœ¨[https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1](https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1)ä¸­çš„\*\*`Check-PrivilegedPolicy`**å‡½æ•°ä¸­æ‰¾åˆ°**ç‰¹æƒç­–ç•¥çš„å®šä¹‰\*\*ã€‚
* [**pacu**](https://github.com/RhinoSecurityLabs/pacu): Pacuæ˜¯ä¸€ä¸ªå¼€æº**AWSåˆ©ç”¨æ¡†æ¶**ï¼Œæ—¨åœ¨é’ˆå¯¹äº‘ç¯å¢ƒè¿›è¡Œæ”»å‡»æ€§å®‰å…¨æµ‹è¯•ã€‚å®ƒå¯ä»¥**æšä¸¾**ã€å‘ç°**é…ç½®é”™è¯¯**å¹¶**åˆ©ç”¨**å®ƒä»¬ã€‚æ‚¨å¯ä»¥åœ¨[https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134](https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134)ä¸­çš„\*\*`user_escalation_methods`**å­—å…¸å†…æ‰¾åˆ°**ç‰¹æƒæƒé™çš„å®šä¹‰\*\*ã€‚
* è¯·æ³¨æ„ï¼Œpacuä»…æ£€æŸ¥æ‚¨è‡ªå·±çš„ææƒè·¯å¾„ï¼ˆè€Œä¸æ˜¯æ•´ä¸ªè´¦æˆ·ï¼‰ã€‚

```bash
# Install
## Feel free to use venvs
pip3 install pacu

# Use pacu CLI
pacu
> import_keys <profile_name> # import 1 profile from .aws/credentials
> import_keys --all # import all profiles
> list # list modules
> exec iam__enum_permissions # Get permissions
> exec iam__privesc_scan # List privileged permissions
```

* [**PMapper**](https://github.com/nccgroup/PMapper): Principal Mapper (PMapper) æ˜¯ä¸€ä¸ªç”¨äºè¯†åˆ« AWS è´¦æˆ·æˆ– AWS ç»„ç»‡ä¸­ AWS Identity and Access Management (IAM) é…ç½®é£é™©çš„è„šæœ¬å’Œåº“ã€‚å®ƒå°†è´¦æˆ·ä¸­çš„ä¸åŒ IAM ç”¨æˆ·å’Œè§’è‰²å»ºæ¨¡ä¸ºä¸€ä¸ªæœ‰å‘å›¾ï¼Œä»è€Œå¯ä»¥æ£€æŸ¥**ç‰¹æƒå‡çº§**å’Œæ”»å‡»è€…å¯èƒ½é‡‡å–çš„å…¶ä»–è·¯å¾„ä»¥è·å–å¯¹ AWS ä¸­èµ„æºæˆ–æ“ä½œçš„è®¿é—®æƒé™ã€‚æ‚¨å¯ä»¥åœ¨ [https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing](https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing) ä¸­ä»¥ `_edges.py` ç»“å°¾çš„æ–‡ä»¶åä¸­æ£€æŸ¥ç”¨äºæŸ¥æ‰¾æƒé™å‡çº§è·¯å¾„çš„æƒé™ã€‚

```bash
# Install
pip install principalmapper

# Get data
pmapper --profile dev graph create
pmapper --profile dev graph display # Show basic info
# Generate graph
pmapper --profile dev visualize # Generate svg graph file (can also be png, dot and graphml)
pmapper --profile dev visualize --only-privesc # Only privesc permissions

# Generate analysis
pmapper --profile dev analysis
## Run queries
pmapper --profile dev query 'who can do iam:CreateUser'
pmapper --profile dev query 'preset privesc *' # Get privescs with admins

# Get organization hierarchy data
pmapper --profile dev orgs create
pmapper --profile dev orgs display
```

* [**cloudsplaining**](https://github.com/salesforce/cloudsplaining): Cloudsplainingæ˜¯ä¸€ç§AWS IAMå®‰å…¨è¯„ä¼°å·¥å…·ï¼Œç”¨äºè¯†åˆ«æœ€å°æƒé™çš„è¿è§„æƒ…å†µå¹¶ç”Ÿæˆé£é™©ä¼˜å…ˆçš„HTMLæŠ¥å‘Šã€‚\
  å®ƒå°†æ˜¾ç¤ºæ½œåœ¨çš„**è¿‡åº¦æˆæƒ**çš„å®¢æˆ·ã€å†…è”å’Œaws **ç­–ç•¥**ä»¥åŠå“ªäº›**ä¸»ä½“å¯ä»¥è®¿é—®å®ƒä»¬**ã€‚ï¼ˆå®ƒä¸ä»…æ£€æŸ¥æƒé™æå‡ï¼Œè¿˜æ£€æŸ¥å…¶ä»–ç±»å‹çš„æœ‰è¶£æƒé™ï¼Œå»ºè®®ä½¿ç”¨ï¼‰ã€‚

```bash
# Install
pip install cloudsplaining

# Download IAM policies to check
## Only the ones attached with the versions used
cloudsplaining download --profile dev

# Analyze the IAM policies
cloudsplaining scan --input-file /private/tmp/cloudsplaining/dev.json --output /tmp/files/
```

* [**cloudjack**](https://github.com/prevade/cloudjack): CloudJackè¯„ä¼°AWSè´¦æˆ·çš„**å­åŸŸåŠ«æŒæ¼æ´**ï¼Œå› ä¸ºRoute53å’ŒCloudFronté…ç½®æ˜¯è§£è€¦çš„ã€‚
* [**ccat**](https://github.com/RhinoSecurityLabs/ccat): åˆ—å‡ºECRä»“åº“ -> æ‹‰å–ECRä»“åº“ -> åé—¨ -> æ¨é€å¸¦åé—¨çš„é•œåƒ
* [**Dufflebag**](https://github.com/bishopfox/dufflebag): Dufflebagæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºåœ¨å…¬å…±å¼¹æ€§å—å­˜å‚¨ï¼ˆ**EBSï¼‰å¿«ç…§ä¸­æœç´¢**å¯èƒ½è¢«æ„å¤–é—ç•™çš„ç§˜å¯†ã€‚

### å®¡è®¡

* [**cloudsploit**](https://github.com/aquasecurity/cloudsploit)**:** Aquaçš„CloudSploitæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨æ£€æµ‹äº‘åŸºç¡€è®¾æ–½è´¦æˆ·ä¸­çš„**å®‰å…¨é£é™©**ï¼ŒåŒ…æ‹¬ï¼šAmazon Web Services (AWS)ã€Microsoft Azureã€Google Cloud Platform (GCP)ã€Oracle Cloud Infrastructure (OCI)å’ŒGitHubï¼ˆä¸æœç´¢ShadowAdminsï¼‰ã€‚

```bash
./index.js --csv=file.csv --console=table --config ./config.js

# Compiance options: --compliance {hipaa,cis,cis1,cis2,pci}
## use "cis" for cis level 1 and 2
```

* [**Prowler**](https://github.com/prowler-cloud/prowler): Prowleræ˜¯ä¸€ä¸ªå¼€æºå®‰å…¨å·¥å…·ï¼Œç”¨äºæ‰§è¡ŒAWSå®‰å…¨æœ€ä½³å®è·µè¯„ä¼°ã€å®¡è®¡ã€äº‹ä»¶å“åº”ã€æŒç»­ç›‘æ§ã€åŠ å›ºå’Œå–è¯å‡†å¤‡ã€‚

```bash
# Install python3, jq and git
# Install
pip install prowler
prowler -v

# Run
prowler <provider>
prowler aws --profile custom-profile [-M csv json json-asff html]
```

* [**CloudFox**](https://github.com/BishopFox/cloudfox): CloudFoxå¸®åŠ©æ‚¨åœ¨é™Œç”Ÿçš„äº‘ç¯å¢ƒä¸­è·å¾—æƒ…å¢ƒæ„è¯†ã€‚è¿™æ˜¯ä¸€ä¸ªå¼€æºå‘½ä»¤è¡Œå·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å’Œå…¶ä»–æ”»å‡»æ€§å®‰å…¨ä¸“ä¸šäººå‘˜åœ¨äº‘åŸºç¡€è®¾æ–½ä¸­æ‰¾åˆ°å¯åˆ©ç”¨çš„æ”»å‡»è·¯å¾„ã€‚

```bash
cloudfox aws --profile [profile-name] all-checks
```

* [**ScoutSuite**](https://github.com/nccgroup/ScoutSuite): Scout Suite æ˜¯ä¸€ä¸ªå¼€æºçš„å¤šäº‘å®‰å…¨å®¡è®¡å·¥å…·ï¼Œå¯ç”¨äºè¯„ä¼°äº‘ç¯å¢ƒçš„å®‰å…¨å§¿åŠ¿ã€‚

```bash
# Install
virtualenv -p python3 venv
source venv/bin/activate
pip install scoutsuite
scout --help

# Get info
scout aws -p dev
```

* [**cs-suite**](https://github.com/SecurityFTW/cs-suite): äº‘å®‰å…¨å¥—ä»¶ï¼ˆä½¿ç”¨python2.7ï¼Œçœ‹èµ·æ¥æœªç»´æŠ¤ï¼‰
* [**Zeus**](https://github.com/DenizParlak/Zeus): Zeusæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºAWS EC2 / S3 / CloudTrail / CloudWatch / KMSæœ€ä½³åŠ å›ºå®è·µï¼ˆçœ‹èµ·æ¥æœªç»´æŠ¤ï¼‰ã€‚å®ƒä»…æ£€æŸ¥ç³»ç»Ÿä¸­é»˜è®¤é…ç½®çš„å‡­æ®ã€‚

### æŒç»­å®¡è®¡

* [**cloud-custodian**](https://github.com/cloud-custodian/cloud-custodian): Cloud Custodianæ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å…¬å…±äº‘è´¦æˆ·å’Œèµ„æºçš„è§„åˆ™å¼•æ“ã€‚å®ƒå…è®¸ç”¨æˆ·**å®šä¹‰ç­–ç•¥ä»¥å®ç°è‰¯å¥½ç®¡ç†çš„äº‘åŸºç¡€æ¶æ„**ï¼Œæ—¢å®‰å…¨åˆç»è¿‡ä¼˜åŒ–æˆæœ¬ã€‚å®ƒå°†ç»„ç»‡ä¸­çš„è®¸å¤šä¸´æ—¶è„šæœ¬æ•´åˆä¸ºä¸€ä¸ªè½»é‡çµæ´»çš„å·¥å…·ï¼Œå…·æœ‰ç»Ÿä¸€çš„åº¦é‡å’ŒæŠ¥å‘Šã€‚
* [**pacbot**](https://github.com/tmobile/pacbot)**: ç­–ç•¥å³ä»£ç æœºå™¨äººï¼ˆPacBotï¼‰æ˜¯ä¸€ä¸ªç”¨äºäº‘çš„æŒç»­åˆè§„ç›‘æ§ã€åˆè§„æŠ¥å‘Šå’Œå®‰å…¨è‡ªåŠ¨åŒ–**çš„å¹³å°ã€‚åœ¨PacBotä¸­ï¼Œå®‰å…¨å’Œåˆè§„ç­–ç•¥è¢«å®ç°ä¸ºä»£ç ã€‚PacBotå‘ç°çš„æ‰€æœ‰èµ„æºéƒ½ä¼šæ ¹æ®è¿™äº›ç­–ç•¥è¿›è¡Œè¯„ä¼°ï¼Œä»¥è¡¡é‡ç­–ç•¥ç¬¦åˆåº¦ã€‚PacBotçš„**è‡ªåŠ¨ä¿®å¤**æ¡†æ¶æä¾›äº†è‡ªåŠ¨å“åº”ç­–ç•¥è¿è§„è¡Œä¸ºçš„èƒ½åŠ›ï¼Œé‡‡å–é¢„å®šä¹‰çš„æ“ä½œã€‚
* [**streamalert**](https://github.com/airbnb/streamalert)**:** StreamAlertæ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨çš„ã€**å®æ—¶**æ•°æ®åˆ†ææ¡†æ¶ï¼Œä½¿æ‚¨èƒ½å¤Ÿ**æ‘„å–ã€åˆ†æå’Œè­¦æŠ¥**æ¥è‡ªä»»ä½•ç¯å¢ƒçš„æ•°æ®ï¼Œ**ä½¿ç”¨æ‚¨å®šä¹‰çš„æ•°æ®æºå’Œè­¦æŠ¥é€»è¾‘**ã€‚è®¡ç®—æœºå®‰å…¨å›¢é˜Ÿä½¿ç”¨StreamAlertæ¯å¤©æ‰«ææ•°åƒå…†å­—èŠ‚çš„æ—¥å¿—æ•°æ®ï¼Œç”¨äºæ£€æµ‹å’Œå“åº”äº‹ä»¶ã€‚

## è°ƒè¯•ï¼šæ•è·AWS cliè¯·æ±‚

```bash
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080

# Capture with burp nor verifying ssl
aws --no-verify-ssl ...

# Dowload brup cert and transform it to pem
curl http://127.0.0.1:8080/cert --output Downloads/certificate.cer
openssl x509 -inform der -in Downloads/certificate.cer -out Downloads/certificate.pem

# Indicate the ca cert to trust
export AWS_CA_BUNDLE=~/Downloads/certificate.pem

# Run aws cli normally trusting burp cert
aws ...
```

## å‚è€ƒèµ„æ–™

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudsecdocs.com/aws/defensive/tooling/audit/](https://cloudsecdocs.com/aws/defensive/tooling/audit/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
