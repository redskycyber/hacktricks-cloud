# AWS æ¸—é€æµ‹è¯•

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºè‹±é›„</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)ç³»åˆ—
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## åŸºæœ¬ä¿¡æ¯

**åœ¨å¼€å§‹æ¸—é€æµ‹è¯•** **AWS** ç¯å¢ƒä¹‹å‰ï¼Œæœ‰ä¸€äº› **åŸºç¡€çŸ¥è¯†ä½ éœ€è¦äº†è§£** å…³äºAWSçš„å·¥ä½œæ–¹å¼ï¼Œä»¥å¸®åŠ©ä½ ç†è§£ä½ éœ€è¦åšä»€ä¹ˆï¼Œå¦‚ä½•æ‰¾åˆ°é…ç½®é”™è¯¯ä»¥åŠå¦‚ä½•åˆ©ç”¨å®ƒä»¬ã€‚

ç»„ç»‡å±‚æ¬¡ç»“æ„ã€IAMå’Œå…¶ä»–åŸºæœ¬æ¦‚å¿µçš„è§£é‡Šåœ¨ï¼š

{% content-ref url="aws-basic-information/" %}
[aws-basic-information](aws-basic-information/)
{% endcontent-ref %}

## å­¦ä¹ å®éªŒå®¤

* [https://github.com/RhinoSecurityLabs/cloudgoat](https://github.com/RhinoSecurityLabs/cloudgoat)
* [https://hackingthe.cloud/aws/capture\_the\_flag/cicdont/](https://hackingthe.cloud/aws/capture\_the\_flag/cicdont/)
* [https://github.com/BishopFox/iam-vulnerable](https://github.com/BishopFox/iam-vulnerable)
* [https://github.com/nccgroup/sadcloud](https://github.com/nccgroup/sadcloud)
* [https://github.com/bridgecrewio/terragoat](https://github.com/bridgecrewio/terragoat)
* [https://github.com/ine-labs/AWSGoat](https://github.com/ine-labs/AWSGoat)
* [http://flaws.cloud/](http://flaws.cloud/)
* [http://flaws2.cloud/](http://flaws2.cloud/)

æ¨¡æ‹Ÿæ”»å‡»çš„å·¥å…·ï¼š

* [https://github.com/Datadog/stratus-red-team/](https://github.com/Datadog/stratus-red-team/)
* [https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main](https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main)

## AWS æ¸—é€æµ‹è¯•å‘˜/çº¢é˜Ÿæ–¹æ³•è®º

ä¸ºäº†å®¡è®¡AWSç¯å¢ƒï¼Œéå¸¸é‡è¦çš„æ˜¯è¦çŸ¥é“ï¼šæ­£åœ¨ä½¿ç”¨å“ªäº› **æœåŠ¡**ï¼Œä»€ä¹ˆæ˜¯ **è¢«æš´éœ²çš„**ï¼Œè°å¯¹ä»€ä¹ˆæœ‰ **è®¿é—®æƒé™**ï¼Œä»¥åŠå†…éƒ¨AWSæœåŠ¡å’Œ **å¤–éƒ¨æœåŠ¡** å¦‚ä½•è¿æ¥ã€‚

ä»çº¢é˜Ÿçš„è§’åº¦æ¥çœ‹ï¼Œ**é¦–å…ˆä¾µå…¥AWSç¯å¢ƒçš„æ­¥éª¤** æ˜¯è®¾æ³•è·å¾—ä¸€äº› **å‡­è¯**ã€‚è¿™é‡Œæœ‰ä¸€äº›æ–¹æ³•ï¼š

* **æ³„éœ²** åœ¨githubï¼ˆæˆ–ç±»ä¼¼çš„ï¼‰- OSINT
* **ç¤¾äº¤** å·¥ç¨‹
* **å¯†ç ** é‡ç”¨ï¼ˆå¯†ç æ³„éœ²ï¼‰
* æ‰˜ç®¡åœ¨AWSçš„åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´
* [**æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ **](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) è®¿é—®å…ƒæ•°æ®ç«¯ç‚¹
* **æœ¬åœ°æ–‡ä»¶è¯»å–**
* `/home/USERNAME/.aws/credentials`
* `C:\Users\USERNAME\.aws\credentials`
* ç¬¬ä¸‰æ–¹ **è¢«å…¥ä¾µ**
* **å†…éƒ¨** å‘˜å·¥
* [**Cognito**](aws-services/aws-cognito-enum/#cognito) å‡­è¯

æˆ–è€…é€šè¿‡ **ä¾µå…¥æœªç»è®¤è¯çš„æœåŠ¡** æš´éœ²ï¼š

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

æˆ–è€…å¦‚æœä½ æ­£åœ¨åšä¸€ä¸ª **å®¡æŸ¥**ï¼Œä½ å¯ä»¥ç›´æ¥ **è¯·æ±‚å‡­è¯** ä¸è¿™äº›è§’è‰²ï¼š

{% content-ref url="aws-permissions-for-a-pentest.md" %}
[aws-permissions-for-a-pentest.md](aws-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
åœ¨ä½ è®¾æ³•è·å¾—å‡­è¯ä¹‹åï¼Œä½ éœ€è¦çŸ¥é“ **è¿™äº›å‡­è¯å±äºè°**ï¼Œä»¥åŠ **ä»–ä»¬æœ‰è®¿é—®æƒé™**ï¼Œæ‰€ä»¥ä½ éœ€è¦è¿›è¡Œä¸€äº›åŸºæœ¬çš„æšä¸¾ï¼š
{% endhint %}

## åŸºæœ¬æšä¸¾

### SSRF

å¦‚æœä½ åœ¨AWSå†…éƒ¨çš„æœºå™¨ä¸Šå‘ç°äº†SSRFï¼Œè¯·æŸ¥çœ‹æ­¤é¡µé¢è·å–æŠ€å·§ï¼š

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Whoami

ä½ éœ€è¦çŸ¥é“çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä½ æ˜¯è°ï¼ˆåœ¨å“ªä¸ªè´¦æˆ·ä¸­ä»¥åŠå…¶ä»–å…³äºAWSç¯å¢ƒçš„ä¿¡æ¯ï¼‰ï¼š
```bash
# Easiest way, but might be monitored?
aws sts get-caller-identity
aws iam get-user # This will get your own user

# If you have a Key ID
aws sts get-access-key-info --access-key-id=ASIA1234567890123456

# Get inside error message
aws sns publish --topic-arn arn:aws:sns:us-east-1:*account id*:aaa --message aaa

# From metadata
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`
curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/dynamic/instance-identity/document
```
{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œå…¬å¸å¯èƒ½ä¼šä½¿ç”¨**é‡‘ä¸é›€ä»¤ç‰Œ**æ¥è¯†åˆ«**ä»¤ç‰Œä½•æ—¶è¢«ç›—ç”¨**ã€‚å»ºè®®åœ¨ä½¿ç”¨ä»¤ç‰Œä¹‹å‰æ£€æŸ¥å®ƒæ˜¯å¦ä¸ºé‡‘ä¸é›€ä»¤ç‰Œã€‚
æ›´å¤šä¿¡æ¯è¯·[**æŸ¥çœ‹æ­¤é¡µé¢**](aws-services/aws-security-and-detection-services/aws-cloudtrail-enum.md#honeytokens-bypass)ã€‚
{% endhint %}

### ç»„ç»‡æšä¸¾

{% content-ref url="../aws-pentesting/aws-services/aws-organizations-enum.md" %}
[aws-organizations-enum.md](../aws-pentesting/aws-services/aws-organizations-enum.md)
{% endcontent-ref %}

### IAM æšä¸¾

å¦‚æœæ‚¨æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œ**æ£€æŸ¥ AWS è´¦æˆ·å†…æ¯ä¸ªå®ä½“çš„æƒé™**å°†å¸®åŠ©æ‚¨äº†è§£æ‚¨å’Œå…¶ä»–èº«ä»½å¯ä»¥åšä»€ä¹ˆä»¥åŠå¦‚ä½•**æå‡æƒé™**ã€‚

å¦‚æœæ‚¨æ²¡æœ‰è¶³å¤Ÿçš„æƒé™æ¥æšä¸¾ IAMï¼Œæ‚¨å¯ä»¥**å°è¯•æš´åŠ›ç ´è§£å®ƒä»¬**æ¥å¼„æ¸…æ¥šã€‚
æŸ¥çœ‹**å¦‚ä½•è¿›è¡Œæšä¸¾å’Œæš´åŠ›ç ´è§£**ï¼š

{% content-ref url="aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](aws-services/aws-iam-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
ç°åœ¨æ‚¨**å·²ç»äº†è§£äº†ä¸€äº›å…³äºæ‚¨çš„å‡­è¯çš„ä¿¡æ¯**ï¼ˆå¦‚æœæ‚¨æ˜¯çº¢é˜Ÿï¼Œå¸Œæœ›æ‚¨**æ²¡æœ‰è¢«å‘ç°**ï¼‰ã€‚æ˜¯æ—¶å€™å¼„æ¸…æ¥šç¯å¢ƒä¸­æ­£åœ¨ä½¿ç”¨å“ªäº›æœåŠ¡äº†ã€‚
åœ¨ä»¥ä¸‹éƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ä¸€äº›**æšä¸¾å¸¸è§æœåŠ¡çš„æ–¹æ³•**ã€‚
{% endhint %}

## æœåŠ¡æšä¸¾ã€æ¸—é€ååˆ©ç”¨å’ŒæŒä¹…åŒ–

AWS æ‹¥æœ‰æƒŠäººæ•°é‡çš„æœåŠ¡ï¼Œåœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å°†æ‰¾åˆ°æœ‰å…³å…¶ä¸­ä¸€äº›æœåŠ¡çš„**åŸºæœ¬ä¿¡æ¯ã€æšä¸¾**æŠ€å·§è¡¨ï¼Œå¦‚ä½•**é¿å…è¢«æ£€æµ‹**ï¼Œè·å¾—**æŒä¹…åŒ–**ï¼Œä»¥åŠå…¶ä»–**æ¸—é€å**æŠ€å·§ï¼š

{% content-ref url="aws-services/" %}
[aws-services](aws-services/)
{% endcontent-ref %}

è¯·æ³¨æ„ï¼Œæ‚¨**ä¸**éœ€è¦**æ‰‹åŠ¨**æ‰§è¡Œæ‰€æœ‰å·¥ä½œï¼Œåœ¨æœ¬æ–‡ä¸‹æ–¹æ‚¨å¯ä»¥æ‰¾åˆ°å…³äº[**è‡ªåŠ¨åŒ–å·¥å…·**](./#automated-tools)çš„**éƒ¨åˆ†**ã€‚

æ­¤å¤–ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°**æ›´å¤šå¯¹æœªç»è®¤è¯çš„ç”¨æˆ·å…¬å¼€çš„æœåŠ¡**ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿåˆ©ç”¨å®ƒä»¬ï¼š

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

## æƒé™æå‡

å¦‚æœæ‚¨è‡³å°‘å¯ä»¥**æ£€æŸ¥è‡ªå·±å¯¹ä¸åŒèµ„æºçš„æƒé™**ï¼Œæ‚¨å¯ä»¥**æ£€æŸ¥æ˜¯å¦èƒ½å¤Ÿè·å¾—æ›´å¤šæƒé™**ã€‚æ‚¨è‡³å°‘åº”è¯¥å…³æ³¨ä»¥ä¸‹é¡µé¢ä¸­æŒ‡å‡ºçš„æƒé™ï¼š

{% content-ref url="aws-privilege-escalation/" %}
[aws-privilege-escalation](aws-privilege-escalation/)
{% endcontent-ref %}

## å…¬å¼€æš´éœ²çš„æœåŠ¡

åœ¨æšä¸¾ AWS æœåŠ¡æ—¶ï¼Œæ‚¨å¯èƒ½å‘ç°å…¶ä¸­ä¸€äº›æœåŠ¡**å‘äº’è”ç½‘å…¬å¼€å…ƒç´ **ï¼ˆVM/å®¹å™¨ç«¯å£ã€æ•°æ®åº“æˆ–é˜Ÿåˆ—æœåŠ¡ã€å¿«ç…§æˆ–å­˜å‚¨æ¡¶ç­‰ï¼‰ã€‚
ä½œä¸ºæ¸—é€æµ‹è¯•äººå‘˜/çº¢é˜Ÿæˆå‘˜ï¼Œæ‚¨åº”å§‹ç»ˆæ£€æŸ¥æ˜¯å¦å¯ä»¥åœ¨å®ƒä»¬ä¸Šæ‰¾åˆ°**æ•æ„Ÿä¿¡æ¯/æ¼æ´**ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¸ºæ‚¨æä¾›**è¿›ä¸€æ­¥è®¿é—® AWS è´¦æˆ·**çš„é€”å¾„ã€‚

åœ¨æœ¬ä¹¦ä¸­ï¼Œæ‚¨åº”è¯¥æ‰¾åˆ°æœ‰å…³å¦‚ä½•æ‰¾åˆ°**å…¬å¼€çš„ AWS æœåŠ¡ä»¥åŠå¦‚ä½•æ£€æŸ¥å®ƒä»¬**çš„**ä¿¡æ¯**ã€‚å…³äºå¦‚ä½•åœ¨**å…¬å¼€çš„ç½‘ç»œæœåŠ¡ä¸­æ‰¾åˆ°æ¼æ´**ï¼Œæˆ‘å»ºè®®æ‚¨**æœç´¢**ç‰¹å®š**æœåŠ¡**ï¼š

{% embed url="https://book.hacktricks.xyz/" %}

## å±å®³ç»„ç»‡

### ä»æ ¹/ç®¡ç†è´¦æˆ·

å½“ç®¡ç†è´¦æˆ·åœ¨ç»„ç»‡ä¸­åˆ›å»ºæ–°è´¦æˆ·æ—¶ï¼Œä¼šåœ¨æ–°è´¦æˆ·ä¸­åˆ›å»ºä¸€ä¸ª**æ–°è§’è‰²**ï¼Œé»˜è®¤å‘½åä¸º**`OrganizationAccountAccessRole`**ï¼Œå¹¶æˆäºˆ**ç®¡ç†è´¦æˆ·**ä»¥ç®¡ç†å‘˜èº«ä»½è®¿é—®æ–°è´¦æˆ·çš„**AdministratorAccess**ç­–ç•¥ã€‚

<figure><img src="../../.gitbook/assets/image (3) (3) (2).png" alt=""><figcaption></figcaption></figure>

å› æ­¤ï¼Œè¦ä»¥ç®¡ç†å‘˜èº«ä»½è®¿é—®å­è´¦æˆ·ï¼Œæ‚¨éœ€è¦ï¼š

* **å±å®³** **ç®¡ç†**è´¦æˆ·å¹¶æ‰¾åˆ°**å­è´¦æˆ·çš„** **ID** å’Œå…è®¸ç®¡ç†è´¦æˆ·ä»¥ç®¡ç†å‘˜èº«ä»½è®¿é—®çš„**è§’è‰²**çš„**åç§°**ï¼ˆé»˜è®¤ä¸ºOrganizationAccountAccessRoleï¼‰ã€‚
* è¦æ‰¾åˆ°å­è´¦æˆ·ï¼Œè¯·è½¬åˆ° aws æ§åˆ¶å°ä¸­çš„ç»„ç»‡éƒ¨åˆ†æˆ–è¿è¡Œ `aws organizations list-accounts`
* æ‚¨æ— æ³•ç›´æ¥æ‰¾åˆ°è§’è‰²çš„åç§°ï¼Œå› æ­¤è¯·æ£€æŸ¥æ‰€æœ‰è‡ªå®šä¹‰ IAM ç­–ç•¥å¹¶æœç´¢ä»»ä½•å…è®¸**`sts:AssumeRole` è¦†ç›–å…ˆå‰å‘ç°çš„å­è´¦æˆ·**çš„ç­–ç•¥ã€‚
* **å±å®³**ç®¡ç†è´¦æˆ·ä¸­æ‹¥æœ‰**`sts:AssumeRole` æƒé™çš„** **ä¸»ä½“**ï¼Œä»¥ä¾¿åœ¨å­è´¦æˆ·ä¸­çš„è§’è‰²ä¸Šï¼ˆå³ä½¿è´¦æˆ·å…è®¸æ¥è‡ªç®¡ç†è´¦æˆ·çš„ä»»ä½•äººæ¨¡æ‹Ÿï¼Œç”±äºå®ƒæ˜¯å¤–éƒ¨è´¦æˆ·ï¼Œç‰¹å®šçš„ `sts:AssumeRole` æƒé™æ˜¯å¿…éœ€çš„ï¼‰ã€‚

## è‡ªåŠ¨åŒ–å·¥å…·

### Recon

* [**aws-recon**](https://github.com/darkbitio/aws-recon): ä¸€ä¸ªç”¨ Ruby ç¼–å†™çš„å¤šçº¿ç¨‹ AWS å®‰å…¨é‡ç‚¹**åº“å­˜æ”¶é›†å·¥å…·**ã€‚
```bash
# Install
gem install aws_recon

# Recon and get json
AWS_PROFILE=<profile> aws_recon \
--services S3,EC2 \
--regions global,us-east-1,us-east-2 \
--verbose
```
* [**cloudlist**](https://github.com/projectdiscovery/cloudlist): Cloudlist æ˜¯ä¸€ä¸ª**å¤šäº‘å·¥å…·ï¼Œç”¨äºä»äº‘æä¾›å•†è·å–èµ„äº§**ï¼ˆä¸»æœºåï¼ŒIP åœ°å€ï¼‰ã€‚
* [**cloudmapper**](https://github.com/duo-labs/cloudmapper): CloudMapper å¸®åŠ©æ‚¨åˆ†ææ‚¨çš„ Amazon Web Services (AWS) ç¯å¢ƒã€‚å®ƒç°åœ¨åŒ…å«äº†æ›´å¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹å®‰å…¨é—®é¢˜çš„å®¡è®¡ã€‚
```bash
# Installation steps in github
# Create a config.json file with the aws info, like:
{
"accounts": [
{
"default": true,
"id": "<account id>",
"name": "dev"
}
],
"cidrs":
{
"2.2.2.2/28": {"name": "NY Office"}
}
}

# Enumerate
python3 cloudmapper.py collect --profile dev
## Number of resources discovered
python3 cloudmapper.py stats --accounts dev

# Create HTML report
## In the report you will find all the info already
python3 cloudmapper.py report --accounts dev

# Identify potential issues
python3 cloudmapper.py audit --accounts dev --json > audit.json
python3 cloudmapper.py audit --accounts dev --markdow > audit.md
python3 cloudmapper.py iam_report --accounts dev

# Identify admins
## The permissions search for are in https://github.com/duo-labs/cloudmapper/blob/4df9fd7303e0337ff16a08f5e58f1d46047c4a87/shared/iam_audit.py#L163-L175
python3 cloudmapper.py find_admins --accounts dev

# Identify unused elements
python3 cloudmapper.py find_unused --accounts dev

# Identify publivly exposed resources
python3 cloudmapper.py public --accounts dev

python cloudmapper.py prepare #Prepare webserver
python cloudmapper.py webserver #Show webserver
```
* [**cartography**](https://github.com/lyft/cartography): Cartography æ˜¯ä¸€ä¸ª Python å·¥å…·ï¼Œå®ƒæ•´åˆäº†åŸºç¡€è®¾æ–½èµ„äº§åŠå…¶ä¹‹é—´çš„å…³ç³»ï¼Œé€šè¿‡ Neo4j æ•°æ®åº“æä¾›ç›´è§‚çš„å›¾å½¢è§†å›¾ã€‚
```bash
# Install
pip install cartography
## At the time of this writting you need neo4j version 3.5.*

# Get AWS info
AWS_PROFILE=dev cartography --neo4j-uri bolt://127.0.0.1:7687 --neo4j-password-prompt  --neo4j-user neo4j
```
* [**starbase**](https://github.com/JupiterOne/starbase)ï¼šStarbase ä»åŒ…æ‹¬äº‘åŸºç¡€è®¾æ–½ã€SaaSåº”ç”¨ç¨‹åºã€å®‰å…¨æ§åˆ¶ç­‰åœ¨å†…çš„æœåŠ¡å’Œç³»ç»Ÿä¸­æ”¶é›†èµ„äº§å’Œå…³ç³»ï¼Œå¹¶é€šè¿‡ Neo4j æ•°æ®åº“æ”¯æŒï¼Œæä¾›ç›´è§‚çš„å›¾å½¢è§†å›¾ã€‚
* [**aws-inventory**](https://github.com/nccgroup/aws-inventory)ï¼šï¼ˆä½¿ç”¨ python2ï¼‰è¿™æ˜¯ä¸€ä¸ªå°è¯•**å‘ç°æ‰€æœ‰**åœ¨ä¸€ä¸ªè´¦æˆ·ä¸­åˆ›å»ºçš„ [**AWS èµ„æº**](https://docs.aws.amazon.com/general/latest/gr/glos-chap.html#resource) çš„å·¥å…·ã€‚
* [**aws\_public\_ips**](https://github.com/arkadiyt/aws\_public\_ips)ï¼šè¿™æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨äº**è·å–ä¸ AWS è´¦æˆ·å…³è”çš„æ‰€æœ‰å…¬å…± IP åœ°å€**ï¼ˆåŒ…æ‹¬ IPv4/IPv6ï¼‰ã€‚

### æƒé™æå‡ä¸åˆ©ç”¨

* [**SkyArk**](https://github.com/cyberark/SkyArk)**ï¼š** å‘ç°æ‰«æçš„ AWS ç¯å¢ƒä¸­æœ€å…·ç‰¹æƒçš„ç”¨æˆ·ï¼ŒåŒ…æ‹¬ AWS Shadow Adminsã€‚å®ƒä½¿ç”¨ powershellã€‚ä½ å¯ä»¥åœ¨ [https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1](https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1) ä¸­çš„ **`Check-PrivilegedPolicy`** å‡½æ•°æ‰¾åˆ°**ç‰¹æƒç­–ç•¥çš„å®šä¹‰**ã€‚
* [**pacu**](https://github.com/RhinoSecurityLabs/pacu)ï¼šPacu æ˜¯ä¸€ä¸ªå¼€æºçš„**AWS æ¼æ´åˆ©ç”¨æ¡†æ¶**ï¼Œä¸“ä¸ºå¯¹äº‘ç¯å¢ƒè¿›è¡Œæ”»å‡»æ€§å®‰å…¨æµ‹è¯•è€Œè®¾è®¡ã€‚å®ƒå¯ä»¥**æšä¸¾**ã€å‘ç°**é…ç½®é”™è¯¯**å¹¶**åˆ©ç”¨**å®ƒä»¬ã€‚ä½ å¯ä»¥åœ¨ [https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134](https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134) çš„ **`user_escalation_methods`** å­—å…¸ä¸­æ‰¾åˆ°**ç‰¹æƒæƒé™çš„å®šä¹‰**ã€‚
* è¯·æ³¨æ„ï¼Œpacu **ä»…æ£€æŸ¥ä½ è‡ªå·±çš„æƒé™æå‡è·¯å¾„**ï¼ˆä¸æ˜¯è´¦æˆ·èŒƒå›´å†…çš„ï¼‰ã€‚
```bash
# Install
## Feel free to use venvs
pip3 install pacu

# Use pacu CLI
pacu
> import_keys <profile_name> # import 1 profile from .aws/credentials
> import_keys --all # import all profiles
> list # list modules
> exec iam__enum_permissions # Get permissions
> exec iam__privesc_scan # List privileged permissions
```
* [**PMapper**](https://github.com/nccgroup/PMapper): Principal Mapper (PMapper) æ˜¯ä¸€ä¸ªç”¨äºè¯†åˆ« AWS è´¦æˆ·æˆ– AWS ç»„ç»‡çš„ AWS èº«ä»½ä¸è®¿é—®ç®¡ç†ï¼ˆIAMï¼‰é…ç½®é£é™©çš„è„šæœ¬å’Œåº“ã€‚å®ƒå°†è´¦æˆ·ä¸­çš„ä¸åŒ IAM ç”¨æˆ·å’Œè§’è‰²å»ºæ¨¡ä¸ºæœ‰å‘å›¾ï¼Œè¿™ä½¿å¾—å¯ä»¥æ£€æŸ¥**æƒé™æå‡**é£é™©ä»¥åŠæ”»å‡»è€…å¯èƒ½é‡‡å–çš„æ›¿ä»£è·¯å¾„ä»¥è·å–å¯¹ AWS ä¸­èµ„æºæˆ–æ“ä½œçš„è®¿é—®æƒé™ã€‚æ‚¨å¯ä»¥åœ¨ [https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing](https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing) ä¸­ä»¥ `_edges.py` ç»“å°¾çš„æ–‡ä»¶åä¸­æ£€æŸ¥**ç”¨äºæŸ¥æ‰¾æƒé™æå‡**è·¯å¾„çš„æƒé™ã€‚
```bash
# Install
pip install principalmapper

# Get data
pmapper --profile dev graph create
pmapper --profile dev graph display # Show basic info
# Generate graph
pmapper --profile dev visualize # Generate svg graph file (can also be png, dot and graphml)
pmapper --profile dev visualize --only-privesc # Only privesc permissions

# Generate analysis
pmapper --profile dev analysis
## Run queries
pmapper --profile dev query 'who can do iam:CreateUser'
pmapper --profile dev query 'preset privesc *' # Get privescs with admins

# Get organization hierarchy data
pmapper --profile dev orgs create
pmapper --profile dev orgs display
```
* [**cloudsplaining**](https://github.com/salesforce/cloudsplaining): Cloudsplaining æ˜¯ä¸€ä¸ª AWS IAM å®‰å…¨è¯„ä¼°å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿè¯†åˆ«æœ€å°æƒé™åŸåˆ™çš„è¿è§„æƒ…å†µï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªé£é™©ä¼˜å…ˆçº§çš„ HTML æŠ¥å‘Šã€‚\
å®ƒä¼šå‘æ‚¨å±•ç¤ºå¯èƒ½**æƒé™è¿‡å¤§**çš„å®¢æˆ·ã€å†…è”å’Œ aws **ç­–ç•¥**ï¼Œä»¥åŠå“ªäº›**ä¸»ä½“æœ‰æƒè®¿é—®å®ƒä»¬**ã€‚ï¼ˆå®ƒä¸ä»…æ£€æŸ¥æƒé™æå‡ï¼Œè¿˜æ£€æŸ¥å…¶ä»–ç§ç±»çš„æœ‰è¶£æƒé™ï¼Œæ¨èä½¿ç”¨ï¼‰ã€‚
```bash
# Install
pip install cloudsplaining

# Download IAM policies to check
## Only the ones attached with the versions used
cloudsplaining download --profile dev

# Analyze the IAM policies
cloudsplaining scan --input-file /private/tmp/cloudsplaining/dev.json --output /tmp/files/
```
* [**cloudjack**](https://github.com/prevade/cloudjack): CloudJack ç”¨äºè¯„ä¼° AWS è´¦æˆ·æ˜¯å¦å­˜åœ¨å›  Route53 å’Œ CloudFront é…ç½®è§£è€¦è€Œå¯¼è‡´çš„**å­åŸŸååŠ«æŒæ¼æ´**ã€‚
* [**ccat**](https://github.com/RhinoSecurityLabs/ccat): åˆ—å‡º ECR ä»“åº“ -> æ‹‰å– ECR ä»“åº“ -> æ¤å…¥åé—¨ -> æ¨é€å¸¦åé—¨çš„é•œåƒ
* [**Dufflebag**](https://github.com/bishopfox/dufflebag): Dufflebag æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒ**æœç´¢**å…¬å…±å¼¹æ€§å—å­˜å‚¨ï¼ˆ**EBS**ï¼‰å¿«ç…§ä¸­å¯èƒ½æ„å¤–é—ç•™çš„**ç§˜å¯†**ã€‚

### å®¡è®¡

* [**cloudsploit**](https://github.com/aquasecurity/cloudsploit)**:** CloudSploit ç”± Aqua æä¾›ï¼Œæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨å…è®¸æ£€æµ‹äº‘åŸºç¡€è®¾æ–½è´¦æˆ·ä¸­çš„**å®‰å…¨é£é™©**ï¼ŒåŒ…æ‹¬ï¼šäºšé©¬é€Šç½‘ç»œæœåŠ¡ï¼ˆAWSï¼‰ã€å¾®è½¯ Azureã€è°·æ­Œäº‘å¹³å°ï¼ˆGCPï¼‰ã€ç”²éª¨æ–‡äº‘åŸºç¡€è®¾æ–½ï¼ˆOCIï¼‰å’Œ GitHubï¼ˆå®ƒä¸å¯»æ‰¾ ShadowAdminsï¼‰ã€‚
```bash
./index.js --csv=file.csv --console=table --config ./config.js

# Compiance options: --compliance {hipaa,cis,cis1,cis2,pci}
## use "cis" for cis level 1 and 2
```
* [**Prowler**](https://github.com/prowler-cloud/prowler): Prowler æ˜¯ä¸€ä¸ªå¼€æºå®‰å…¨å·¥å…·ï¼Œç”¨äºæ‰§è¡Œ AWS å®‰å…¨æœ€ä½³å®è·µè¯„ä¼°ã€å®¡è®¡ã€äº‹ä»¶å“åº”ã€æŒç»­ç›‘æ§ã€åŠ å›ºå’Œå–è¯å‡†å¤‡ã€‚
```bash
# Install python3, jq and git
# Install
pip install prowler
prowler -v

# Run
prowler <provider>
prowler aws --profile custom-profile [-M csv json json-asff html]
```
* [**CloudFox**](https://github.com/BishopFox/cloudfox): CloudFox å¯ä»¥å¸®åŠ©æ‚¨åœ¨ä¸ç†Ÿæ‚‰çš„äº‘ç¯å¢ƒä¸­è·å¾—æ€åŠ¿æ„ŸçŸ¥ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å’Œå…¶ä»–æ”»å‡»æ€§å®‰å…¨ä¸“ä¸šäººå‘˜åœ¨äº‘åŸºç¡€è®¾æ–½ä¸­æ‰¾åˆ°å¯åˆ©ç”¨çš„æ”»å‡»è·¯å¾„ã€‚
```bash
cloudfox aws --profile [profile-name] all-checks
```
* [**ScoutSuite**](https://github.com/nccgroup/ScoutSuite): Scout Suite æ˜¯ä¸€ä¸ªå¼€æºçš„å¤šäº‘å®‰å…¨å®¡è®¡å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿè¯„ä¼°äº‘ç¯å¢ƒçš„å®‰å…¨æ€åŠ¿ã€‚
```bash
# Install
virtualenv -p python3 venv
source venv/bin/activate
pip install scoutsuite
scout --help

# Get info
scout aws -p dev
```
* [**cs-suite**](https://github.com/SecurityFTW/cs-suite): Cloud Security Suiteï¼ˆä½¿ç”¨python2.7ï¼Œçœ‹èµ·æ¥æ²¡æœ‰ç»´æŠ¤ï¼‰
* [**Zeus**](https://github.com/DenizParlak/Zeus): Zeus æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äº AWS EC2 / S3 / CloudTrail / CloudWatch / KMS æœ€ä½³åŠ å›ºå®è·µï¼ˆçœ‹èµ·æ¥æ²¡æœ‰ç»´æŠ¤ï¼‰ã€‚å®ƒåªæ£€æŸ¥ç³»ç»Ÿå†…é»˜è®¤é…ç½®çš„å‡­è¯ã€‚

### æŒç»­å®¡è®¡

* [**cloud-custodian**](https://github.com/cloud-custodian/cloud-custodian): Cloud Custodian æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å…¬å…±äº‘è´¦æˆ·å’Œèµ„æºçš„è§„åˆ™å¼•æ“ã€‚å®ƒå…è®¸ç”¨æˆ·**å®šä¹‰ç­–ç•¥ä»¥å®ç°è‰¯å¥½ç®¡ç†çš„äº‘åŸºç¡€è®¾æ–½**ï¼Œæ—¢å®‰å…¨åˆèƒ½ä¼˜åŒ–æˆæœ¬ã€‚å®ƒå°†è®¸å¤šç»„ç»‡çš„ä¸´æ—¶è„šæœ¬æ•´åˆæˆä¸€ä¸ªè½»é‡çº§ä¸”çµæ´»çš„å·¥å…·ï¼Œæä¾›ç»Ÿä¸€çš„æŒ‡æ ‡å’ŒæŠ¥å‘Šã€‚
* [**pacbot**](https://github.com/tmobile/pacbot)**: Policy as Code Bot (PacBot)** æ˜¯ä¸€ä¸ªå¹³å°ï¼Œç”¨äº**æŒç»­çš„åˆè§„ç›‘æ§ã€åˆè§„æŠ¥å‘Šå’Œäº‘çš„å®‰å…¨è‡ªåŠ¨åŒ–**ã€‚åœ¨ PacBot ä¸­ï¼Œå®‰å…¨å’Œåˆè§„æ”¿ç­–ä»¥ä»£ç å½¢å¼å®ç°ã€‚PacBot å‘ç°çš„æ‰€æœ‰èµ„æºéƒ½ä¼šæ ¹æ®è¿™äº›æ”¿ç­–è¿›è¡Œè¯„ä¼°ï¼Œä»¥è¡¡é‡æ”¿ç­–åˆè§„æ€§ã€‚PacBot **è‡ªåŠ¨ä¿®å¤**æ¡†æ¶æä¾›äº†è‡ªåŠ¨å“åº”æ”¿ç­–è¿è§„çš„èƒ½åŠ›ï¼Œé€šè¿‡é‡‡å–é¢„å®šä¹‰çš„è¡ŒåŠ¨ã€‚
* [**streamalert**](https://github.com/airbnb/streamalert)**:** StreamAlert æ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨çš„ã€**å®æ—¶**æ•°æ®åˆ†ææ¡†æ¶ï¼Œå®ƒä½¿æ‚¨èƒ½å¤Ÿ**æ‘„å–ã€åˆ†æå’Œè­¦æŠ¥**æ¥è‡ªä»»ä½•ç¯å¢ƒçš„æ•°æ®ï¼Œ**ä½¿ç”¨æ‚¨å®šä¹‰çš„æ•°æ®æºå’Œè­¦æŠ¥é€»è¾‘**ã€‚è®¡ç®—æœºå®‰å…¨å›¢é˜Ÿä½¿ç”¨ StreamAlert æ¯å¤©æ‰«ææ•°TBçš„æ—¥å¿—æ•°æ®è¿›è¡Œäº‹ä»¶æ£€æµ‹å’Œå“åº”ã€‚

## DEBUG: æ•è· AWS cli è¯·æ±‚
```bash
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080

# Capture with burp nor verifying ssl
aws --no-verify-ssl ...

# Dowload brup cert and transform it to pem
curl http://127.0.0.1:8080/cert --output Downloads/certificate.cer
openssl x509 -inform der -in Downloads/certificate.cer -out Downloads/certificate.pem

# Indicate the ca cert to trust
export AWS_CA_BUNDLE=~/Downloads/certificate.pem

# Run aws cli normally trusting burp cert
aws ...
```
## å‚è€ƒèµ„æ–™

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudsecdocs.com/aws/defensive/tooling/audit/](https://cloudsecdocs.com/aws/defensive/tooling/audit/)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ç›´è‡³æˆä¸ºé«˜æ‰‹ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
