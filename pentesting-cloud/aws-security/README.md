# AWSæ¸—é€æµ‹è¯•

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆçš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“ï¼Œ[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## åŸºæœ¬ä¿¡æ¯

åœ¨å¼€å§‹æ¸—é€æµ‹è¯•AWSç¯å¢ƒä¹‹å‰ï¼Œæ‚¨éœ€è¦äº†è§£ä¸€äº›å…³äºAWSå·¥ä½œåŸç†çš„åŸºæœ¬çŸ¥è¯†ï¼Œä»¥å¸®åŠ©æ‚¨ç†è§£éœ€è¦åšä»€ä¹ˆï¼Œå¦‚ä½•æŸ¥æ‰¾é…ç½®é”™è¯¯å¹¶åˆ©ç”¨å®ƒä»¬ã€‚

æœ‰å…³ç»„ç»‡å±‚æ¬¡ç»“æ„ã€IAMå’Œå…¶ä»–åŸºæœ¬æ¦‚å¿µçš„è§£é‡Šï¼Œè¯·å‚é˜…ï¼š

{% content-ref url="aws-basic-information/" %}
[aws-basic-information](aws-basic-information/)
{% endcontent-ref %}

## å­¦ä¹ å®éªŒ

* [https://github.com/RhinoSecurityLabs/cloudgoat](https://github.com/RhinoSecurityLabs/cloudgoat)
* [https://hackingthe.cloud/aws/capture\_the\_flag/cicdont/](https://hackingthe.cloud/aws/capture\_the\_flag/cicdont/)
* [https://github.com/BishopFox/iam-vulnerable](https://github.com/BishopFox/iam-vulnerable)
* [https://github.com/nccgroup/sadcloud](https://github.com/nccgroup/sadcloud)
* [https://github.com/bridgecrewio/terragoat](https://github.com/bridgecrewio/terragoat)
* [https://github.com/ine-labs/AWSGoat](https://github.com/ine-labs/AWSGoat)
* [http://flaws.cloud/](http://flaws.cloud/)
* [http://flaws2.cloud/](http://flaws2.cloud/)

æ¨¡æ‹Ÿæ”»å‡»çš„å·¥å…·ï¼š

* [https://github.com/Datadog/stratus-red-team/](https://github.com/Datadog/stratus-red-team/)
* [https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main](https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main)

## AWSæ¸—é€æµ‹è¯•/çº¢é˜Ÿæ–¹æ³•è®º

ä¸ºäº†å®¡è®¡AWSç¯å¢ƒï¼Œäº†è§£ä»¥ä¸‹ä¿¡æ¯éå¸¸é‡è¦ï¼šä½¿ç”¨äº†å“ªäº›æœåŠ¡ï¼Œæš´éœ²äº†ä»€ä¹ˆï¼Œè°æœ‰è®¿é—®æƒé™ï¼Œä»¥åŠå†…éƒ¨AWSæœåŠ¡å’Œå¤–éƒ¨æœåŠ¡å¦‚ä½•è¿æ¥ã€‚

ä»çº¢é˜Ÿçš„è§’åº¦æ¥çœ‹ï¼Œå…¥ä¾µAWSç¯å¢ƒçš„ç¬¬ä¸€æ­¥æ˜¯è®¾æ³•è·å–ä¸€äº›å‡­æ®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³äºå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„æƒ³æ³•ï¼š

* åœ¨githubï¼ˆæˆ–ç±»ä¼¼çš„åœ°æ–¹ï¼‰çš„æ³„æ¼ - OSINT
* ç¤¾äº¤å·¥ç¨‹
* å¯†ç é‡ç”¨ï¼ˆå¯†ç æ³„æ¼ï¼‰
* AWSæ‰˜ç®¡åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´
* [**æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼‰**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf)å¹¶è®¿é—®å…ƒæ•°æ®ç«¯ç‚¹
* æœ¬åœ°æ–‡ä»¶è¯»å–
* `/home/USERNAME/.aws/credentials`
* `C:\Users\USERNAME\.aws\credentials`
* ç¬¬ä¸‰æ–¹é­åˆ°**å…¥ä¾µ**
* **å†…éƒ¨**å‘˜å·¥
* [**Cognito** ](aws-services/aws-cognito-enum/#cognito)å‡­æ®

æˆ–é€šè¿‡å…¥ä¾µæœªç»èº«ä»½éªŒè¯çš„æœåŠ¡æ¥è·å¾—å‡­æ®ï¼š

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

æˆ–è€…å¦‚æœæ‚¨æ­£åœ¨è¿›è¡Œå®¡æŸ¥ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›è§’è‰²**è¦æ±‚å‡­æ®**ï¼š

{% content-ref url="aws-permissions-for-a-pentest.md" %}
[aws-permissions-for-a-pentest.md](aws-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
åœ¨æˆåŠŸè·å–å‡­æ®åï¼Œæ‚¨éœ€è¦çŸ¥é“è¿™äº›å‡­æ®å±äº**è°**ï¼Œä»¥åŠä»–ä»¬æœ‰è®¿é—®æƒé™çš„**å†…å®¹**ï¼Œå› æ­¤æ‚¨éœ€è¦æ‰§è¡Œä¸€äº›åŸºæœ¬æšä¸¾æ“ä½œï¼š
{% endhint %}

## åŸºæœ¬æšä¸¾

### SSRF

å¦‚æœæ‚¨åœ¨AWSå†…éƒ¨çš„æŸå°æœºå™¨ä¸Šå‘ç°äº†SSRFï¼Œè¯·æŸ¥çœ‹æ­¤é¡µé¢ä»¥è·å–ä¸€äº›æŠ€å·§ï¼š

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Whoami

æ‚¨éœ€è¦äº†è§£çš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ‚¨æ˜¯è°ï¼ˆæ‚¨åœ¨å“ªä¸ªå¸æˆ·ä¸­ï¼Œå…¶ä»–å…³äºAWSç¯å¢ƒçš„ä¿¡æ¯ï¼‰ï¼š
```bash
# Easiest way, but might be monitored?
aws sts get-caller-identity
aws iam get-user # This will get your own user

# If you have a Key ID
aws sts get-access-key-info --access-key-id=ASIA1234567890123456

# Get inside error message
aws sns publish --topic-arn arn:aws:sns:us-east-1:*account id*:aaa --message aaa

# From metadata
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`
curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/dynamic/instance-identity/document
```
{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œå…¬å¸å¯èƒ½ä½¿ç”¨**canary tokens**æ¥è¯†åˆ«**ä»¤ç‰Œæ˜¯å¦è¢«ç›—ç”¨å’Œä½¿ç”¨**ã€‚åœ¨ä½¿ç”¨ä»¤ç‰Œä¹‹å‰ï¼Œå»ºè®®æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦ä¸ºcanary tokenã€‚\
æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[**æ­¤é¡µé¢**](aws-services/aws-security-and-detection-services/aws-cloudtrail-enum.md#honeytokens-bypass)ã€‚
{% endhint %}

### ç»„ç»‡æšä¸¾

{% content-ref url="../aws-pentesting/aws-services/aws-organizations-enum.md" %}
[aws-organizations-enum.md](../aws-pentesting/aws-services/aws-organizations-enum.md)
{% endcontent-ref %}

### IAMæšä¸¾

å¦‚æœæ‚¨æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œ**æ£€æŸ¥AWSè´¦æˆ·ä¸­æ¯ä¸ªå®ä½“çš„æƒé™**å°†å¸®åŠ©æ‚¨äº†è§£æ‚¨å’Œå…¶ä»–èº«ä»½å¯ä»¥åšä»€ä¹ˆä»¥åŠå¦‚ä½•**å‡çº§æƒé™**ã€‚

å¦‚æœæ‚¨æ²¡æœ‰è¶³å¤Ÿçš„æƒé™æ¥æšä¸¾IAMï¼Œæ‚¨å¯ä»¥**æš´åŠ›ç ´è§£å®ƒä»¬**ä»¥æ‰¾å‡ºå®ƒä»¬ã€‚\
åœ¨ä»¥ä¸‹é“¾æ¥ä¸­æŸ¥çœ‹**å¦‚ä½•è¿›è¡Œæšä¸¾å’Œæš´åŠ›ç ´è§£**ï¼š

{% content-ref url="aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](aws-services/aws-iam-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
ç°åœ¨ï¼Œæ‚¨å¯¹å‡­æ®**æœ‰ä¸€äº›ä¿¡æ¯**ï¼ˆå¦‚æœæ‚¨æ˜¯çº¢é˜Ÿï¼Œå¸Œæœ›æ‚¨**æ²¡æœ‰è¢«å‘ç°**ï¼‰ã€‚ç°åœ¨æ˜¯æ—¶å€™å¼„æ¸…æ¥šç¯å¢ƒä¸­ä½¿ç”¨äº†å“ªäº›æœåŠ¡äº†ã€‚\
åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ä¸€äº›**æšä¸¾ä¸€äº›å¸¸è§æœåŠ¡çš„æ–¹æ³•**ã€‚
{% endhint %}

## æœåŠ¡æšä¸¾ã€åæ¸—é€å’ŒæŒä¹…æ€§

AWSæ‹¥æœ‰å¤§é‡çš„æœåŠ¡ï¼Œåœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å°†æ‰¾åˆ°ä¸€äº›å…³äºå…¶ä¸­ä¸€äº›æœåŠ¡çš„**åŸºæœ¬ä¿¡æ¯ã€æšä¸¾**é€ŸæŸ¥è¡¨ã€å¦‚ä½•**é¿å…è¢«æ£€æµ‹**ã€è·å–**æŒä¹…æ€§**å’Œå…¶ä»–**åæ¸—é€**æŠ€å·§ï¼š

{% content-ref url="aws-services/" %}
[aws-services](aws-services/)
{% endcontent-ref %}

è¯·æ³¨æ„ï¼Œæ‚¨**ä¸éœ€è¦**æ‰‹åŠ¨æ‰§è¡Œæ‰€æœ‰å·¥ä½œï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°å…³äº[**è‡ªåŠ¨åŒ–å·¥å…·**](./#automated-tools)çš„**éƒ¨åˆ†**ã€‚

æ­¤å¤–ï¼Œåœ¨æ­¤é˜¶æ®µï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°**æ›´å¤šæœåŠ¡æš´éœ²ç»™æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·**ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿåˆ©ç”¨å®ƒä»¬ï¼š

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

## ææƒ

å¦‚æœæ‚¨è‡³å°‘å¯ä»¥**æ£€æŸ¥è‡ªå·±å¯¹ä¸åŒèµ„æºçš„æƒé™**ï¼Œæ‚¨å¯ä»¥**æ£€æŸ¥æ˜¯å¦èƒ½å¤Ÿè·å¾—æ›´é«˜çš„æƒé™**ã€‚æ‚¨è‡³å°‘åº”å…³æ³¨ä»¥ä¸‹æƒé™ï¼š

{% content-ref url="aws-privilege-escalation/" %}
[aws-privilege-escalation](aws-privilege-escalation/)
{% endcontent-ref %}

## å…¬å¼€æš´éœ²çš„æœåŠ¡

åœ¨æšä¸¾AWSæœåŠ¡æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°å…¶ä¸­ä¸€äº›æœåŠ¡**å°†å…ƒç´ æš´éœ²ç»™äº’è”ç½‘**ï¼ˆè™šæ‹Ÿæœº/å®¹å™¨ç«¯å£ã€æ•°æ®åº“æˆ–é˜Ÿåˆ—æœåŠ¡ã€å¿«ç…§æˆ–å­˜å‚¨æ¡¶...ï¼‰ã€‚\
ä½œä¸ºæ¸—é€æµ‹è¯•å‘˜/çº¢é˜Ÿæˆå‘˜ï¼Œæ‚¨åº”å§‹ç»ˆæ£€æŸ¥æ˜¯å¦å¯ä»¥åœ¨è¿™äº›æœåŠ¡ä¸Šæ‰¾åˆ°**æ•æ„Ÿä¿¡æ¯/æ¼æ´**ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¸ºæ‚¨æä¾›è¿›ä¸€æ­¥è®¿é—®AWSè´¦æˆ·çš„**æƒé™**ã€‚

åœ¨æœ¬ä¹¦ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æœ‰å…³å¦‚ä½•æ‰¾åˆ°**å…¬å¼€æš´éœ²çš„AWSæœåŠ¡ä»¥åŠå¦‚ä½•æ£€æŸ¥å®ƒä»¬**çš„**ä¿¡æ¯**ã€‚å…³äºå¦‚ä½•åœ¨**å…¬å¼€ç½‘ç»œæœåŠ¡ä¸­æ‰¾åˆ°æ¼æ´**ï¼Œæˆ‘å»ºè®®æ‚¨åœ¨ä»¥ä¸‹é“¾æ¥ä¸­**æœç´¢**ç‰¹å®šçš„**æœåŠ¡**ï¼š

{% embed url="https://book.hacktricks.xyz/" %}

## å…¥ä¾µç»„ç»‡

### ä»æ ¹/ç®¡ç†è´¦æˆ·å¼€å§‹

å½“ç®¡ç†è´¦æˆ·åœ¨ç»„ç»‡ä¸­åˆ›å»ºæ–°è´¦æˆ·æ—¶ï¼Œä¼šåœ¨æ–°è´¦æˆ·ä¸­åˆ›å»ºä¸€ä¸ª**æ–°è§’è‰²**ï¼Œé»˜è®¤å‘½åä¸º**`OrganizationAccountAccessRole`**ï¼Œå¹¶ä¸º**ç®¡ç†è´¦æˆ·**æˆäºˆ**AdministratorAccess**ç­–ç•¥ä»¥è®¿é—®æ–°è´¦æˆ·ã€‚

<figure><img src="../../.gitbook/assets/image (3) (3) (2).png" alt=""><figcaption></figcaption></figure>

å› æ­¤ï¼Œä¸ºäº†ä»¥ç®¡ç†å‘˜èº«ä»½è®¿é—®å­è´¦æˆ·ï¼Œæ‚¨éœ€è¦ï¼š

* **å…¥ä¾µ**ç®¡ç†è´¦æˆ·å¹¶æ‰¾åˆ°**å­è´¦æˆ·çš„ID**å’Œ**è§’è‰²çš„åç§°**ï¼ˆé»˜è®¤ä¸ºOrganizationAccountAccessRoleï¼‰ï¼Œè¯¥è§’è‰²å…è®¸ç®¡ç†è´¦æˆ·ä»¥ç®¡ç†å‘˜èº«ä»½è®¿é—®ã€‚
* è¦æŸ¥æ‰¾å­è´¦æˆ·ï¼Œè¯·è½¬åˆ°AWSæ§åˆ¶å°ä¸­çš„ç»„ç»‡éƒ¨åˆ†æˆ–è¿è¡Œ`aws organizations list-accounts`
* æ‚¨æ— æ³•ç›´æ¥æ‰¾åˆ°è§’è‰²çš„åç§°ï¼Œå› æ­¤è¯·æ£€æŸ¥æ‰€æœ‰è‡ªå®šä¹‰IAMç­–ç•¥ï¼Œå¹¶æœç´¢ä»»ä½•å…è®¸**`sts:AssumeRole`è®¿é—®å…ˆå‰å‘ç°çš„å­è´¦æˆ·**çš„ç­–ç•¥ã€‚
* åœ¨ç®¡ç†è´¦æˆ·ä¸­**å…¥ä¾µ**ä¸€ä¸ªå…·æœ‰**`sts:AssumeRole`æƒé™**çš„**ä¸»ä½“**ï¼Œä»¥ä¾¿åœ¨å­è´¦æˆ·ä¸­ä½¿ç”¨è¯¥è§’è‰²ï¼ˆå³ä½¿è¯¥è´¦æˆ·å…è®¸æ¥è‡ªç®¡ç†è´¦æˆ·çš„ä»»ä½•äººå†’å……ï¼Œä¹Ÿéœ€è¦ç‰¹å®šçš„`sts:AssumeRole`æƒé™ï¼‰ã€‚

## è‡ªåŠ¨åŒ–å·¥å…·

### ä¾¦å¯Ÿ

* [**aws-recon**](https://github.com/darkbitio/aws-recon)ï¼šä¸€ä¸ªç”¨Rubyç¼–å†™çš„å¤šçº¿ç¨‹AWSå®‰å…¨**åº“å­˜æ”¶é›†å·¥å…·**ã€‚
```bash
# Install
gem install aws_recon

# Recon and get json
AWS_PROFILE=<profile> aws_recon \
--services S3,EC2 \
--regions global,us-east-1,us-east-2 \
--verbose
```
* [**cloudlist**](https://github.com/projectdiscovery/cloudlist): Cloudlistæ˜¯ä¸€ä¸ªç”¨äºä»äº‘æä¾›å•†è·å–èµ„äº§ï¼ˆä¸»æœºåã€IPåœ°å€ï¼‰çš„å¤šäº‘å·¥å…·ã€‚
* [**cloudmapper**](https://github.com/duo-labs/cloudmapper): CloudMapperå¸®åŠ©æ‚¨åˆ†æAmazon Web Servicesï¼ˆAWSï¼‰ç¯å¢ƒã€‚å®ƒç°åœ¨åŒ…å«æ›´å¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬å®‰å…¨é—®é¢˜çš„å®¡è®¡ã€‚
```bash
# Installation steps in github
# Create a config.json file with the aws info, like:
{
"accounts": [
{
"default": true,
"id": "<account id>",
"name": "dev"
}
],
"cidrs":
{
"2.2.2.2/28": {"name": "NY Office"}
}
}

# Enumerate
python3 cloudmapper.py collect --profile dev
## Number of resources discovered
python3 cloudmapper.py stats --accounts dev

# Create HTML report
## In the report you will find all the info already
python3 cloudmapper.py report --accounts dev

# Identify potential issues
python3 cloudmapper.py audit --accounts dev --json > audit.json
python3 cloudmapper.py audit --accounts dev --markdow > audit.md
python3 cloudmapper.py iam_report --accounts dev

# Identify admins
## The permissions search for are in https://github.com/duo-labs/cloudmapper/blob/4df9fd7303e0337ff16a08f5e58f1d46047c4a87/shared/iam_audit.py#L163-L175
python3 cloudmapper.py find_admins --accounts dev

# Identify unused elements
python3 cloudmapper.py find_unused --accounts dev

# Identify publivly exposed resources
python3 cloudmapper.py public --accounts dev

python cloudmapper.py prepare #Prepare webserver
python cloudmapper.py webserver #Show webserver
```
* [**cartography**](https://github.com/lyft/cartography): Cartographyæ˜¯ä¸€ä¸ªä½¿ç”¨Neo4jæ•°æ®åº“æä¾›ç›´è§‚å›¾å½¢è§†å›¾çš„Pythonå·¥å…·ï¼Œç”¨äºæ•´åˆåŸºç¡€è®¾æ–½èµ„äº§åŠå…¶ä¹‹é—´çš„å…³ç³»ã€‚
```bash
# Install
pip install cartography
## At the time of this writting you need neo4j version 3.5.*

# Get AWS info
AWS_PROFILE=dev cartography --neo4j-uri bolt://127.0.0.1:7687 --neo4j-password-prompt  --neo4j-user neo4j
```
* [**starbase**](https://github.com/JupiterOne/starbase): Starbaseå°†æ¥è‡ªäº‘åŸºç¡€è®¾æ–½ã€SaaSåº”ç”¨ç¨‹åºã€å®‰å…¨æ§åˆ¶ç­‰æœåŠ¡å’Œç³»ç»Ÿçš„èµ„äº§å’Œå…³ç³»æ”¶é›†åˆ°ä¸€ä¸ªç›´è§‚çš„å›¾å½¢è§†å›¾ä¸­ï¼Œæ”¯æŒNeo4jæ•°æ®åº“ã€‚
* [**aws-inventory**](https://github.com/nccgroup/aws-inventory): ï¼ˆä½¿ç”¨python2ï¼‰è¿™æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå°è¯•å‘ç°åœ¨è´¦æˆ·ä¸­åˆ›å»ºçš„æ‰€æœ‰[**AWSèµ„æº**](https://docs.aws.amazon.com/general/latest/gr/glos-chap.html#resource)ã€‚
* [**aws\_public\_ips**](https://github.com/arkadiyt/aws\_public\_ips): è¿™æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºè·å–ä¸AWSè´¦æˆ·å…³è”çš„æ‰€æœ‰å…¬å…±IPåœ°å€ï¼ˆIPv4/IPv6ï¼‰ã€‚

### ææƒå’Œåˆ©ç”¨

* [**SkyArk**](https://github.com/cyberark/SkyArk)**:** åœ¨æ‰«æçš„AWSç¯å¢ƒä¸­å‘ç°æœ€é«˜æƒé™çš„ç”¨æˆ·ï¼ŒåŒ…æ‹¬AWSå½±å­ç®¡ç†å‘˜ã€‚å®ƒä½¿ç”¨powershellã€‚æ‚¨å¯ä»¥åœ¨[https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1](https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1)ä¸­çš„å‡½æ•°**`Check-PrivilegedPolicy`**ä¸­æ‰¾åˆ°**ç‰¹æƒç­–ç•¥çš„å®šä¹‰**ã€‚
* [**pacu**](https://github.com/RhinoSecurityLabs/pacu): Pacuæ˜¯ä¸€ä¸ªå¼€æºçš„**AWSåˆ©ç”¨æ¡†æ¶**ï¼Œä¸“ä¸ºé’ˆå¯¹äº‘ç¯å¢ƒè¿›è¡Œæ”»å‡»æ€§å®‰å…¨æµ‹è¯•è€Œè®¾è®¡ã€‚å®ƒå¯ä»¥**æšä¸¾**ã€å‘ç°**é…ç½®é”™è¯¯**å¹¶å¯¹å…¶è¿›è¡Œ**åˆ©ç”¨**ã€‚æ‚¨å¯ä»¥åœ¨[https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134](https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134)ä¸­çš„**`user_escalation_methods`**å­—å…¸ä¸­æ‰¾åˆ°**ç‰¹æƒæƒé™çš„å®šä¹‰**ã€‚
* è¯·æ³¨æ„ï¼Œpacuä»…æ£€æŸ¥æ‚¨è‡ªå·±çš„ææƒè·¯å¾„ï¼ˆä¸æ˜¯æ•´ä¸ªè´¦æˆ·èŒƒå›´ï¼‰ã€‚
```bash
# Install
## Feel free to use venvs
pip3 install pacu

# Use pacu CLI
pacu
> import_keys <profile_name> # import 1 profile from .aws/credentials
> import_keys --all # import all profiles
> list # list modules
> exec iam__enum_permissions # Get permissions
> exec iam__privesc_scan # List privileged permissions
```
* [**PMapper**](https://github.com/nccgroup/PMapper)ï¼šPrincipal Mapperï¼ˆPMapperï¼‰æ˜¯ä¸€ä¸ªç”¨äºè¯†åˆ«AWSè´¦æˆ·æˆ–AWSç»„ç»‡ä¸­AWS Identity and Access Managementï¼ˆIAMï¼‰é…ç½®é£é™©çš„è„šæœ¬å’Œåº“ã€‚å®ƒå°†è´¦æˆ·ä¸­çš„ä¸åŒIAMç”¨æˆ·å’Œè§’è‰²å»ºæ¨¡ä¸ºæœ‰å‘å›¾ï¼Œä»è€Œå¯ä»¥æ£€æŸ¥**ç‰¹æƒå‡çº§**ä»¥åŠæ”»å‡»è€…å¯èƒ½é‡‡å–çš„å…¶ä»–è·¯å¾„æ¥è®¿é—®AWSä¸­çš„èµ„æºæˆ–æ“ä½œã€‚æ‚¨å¯ä»¥åœ¨[https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing](https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing)ä¸­çš„ä»¥`_edges.py`ç»“å°¾çš„æ–‡ä»¶ä¸­æ£€æŸ¥ç”¨äºæŸ¥æ‰¾ç‰¹æƒå‡çº§è·¯å¾„çš„æƒé™ã€‚
```bash
# Install
pip install principalmapper

# Get data
pmapper --profile dev graph create
pmapper --profile dev graph display # Show basic info
# Generate graph
pmapper --profile dev visualize # Generate svg graph file (can also be png, dot and graphml)
pmapper --profile dev visualize --only-privesc # Only privesc permissions

# Generate analysis
pmapper --profile dev analysis
## Run queries
pmapper --profile dev query 'who can do iam:CreateUser'
pmapper --profile dev query 'preset privesc *' # Get privescs with admins

# Get organization hierarchy data
pmapper --profile dev orgs create
pmapper --profile dev orgs display
```
* [**cloudsplaining**](https://github.com/salesforce/cloudsplaining): Cloudsplainingæ˜¯ä¸€æ¬¾AWS IAMå®‰å…¨è¯„ä¼°å·¥å…·ï¼Œç”¨äºè¯†åˆ«æœ€å°æƒé™çš„è¿è§„æƒ…å†µå¹¶ç”ŸæˆæŒ‰é£é™©ä¼˜å…ˆæ’åºçš„HTMLæŠ¥å‘Šã€‚\
å®ƒå°†æ˜¾ç¤ºæ½œåœ¨çš„**è¿‡åº¦æˆæƒ**çš„å®¢æˆ·ã€å†…è”å’ŒAWS **ç­–ç•¥**ä»¥åŠå…·æœ‰è®¿é—®æƒé™çš„**ä¸»ä½“**ã€‚ï¼ˆå®ƒä¸ä»…æ£€æŸ¥æƒé™æå‡ï¼Œè¿˜æ£€æŸ¥å…¶ä»–ç±»å‹çš„æœ‰è¶£æƒé™ï¼Œæ¨èä½¿ç”¨ï¼‰ã€‚
```bash
# Install
pip install cloudsplaining

# Download IAM policies to check
## Only the ones attached with the versions used
cloudsplaining download --profile dev

# Analyze the IAM policies
cloudsplaining scan --input-file /private/tmp/cloudsplaining/dev.json --output /tmp/files/
```
* [**cloudjack**](https://github.com/prevade/cloudjack): CloudJackè¯„ä¼°AWSè´¦æˆ·çš„**å­åŸŸåŠ«æŒæ¼æ´**ï¼Œè¿™æ˜¯ç”±äºè§£è€¦çš„Route53å’ŒCloudFronté…ç½®å¼•èµ·çš„ã€‚
* [**ccat**](https://github.com/RhinoSecurityLabs/ccat): åˆ—å‡ºECRä»“åº“ -> æ‹‰å–ECRä»“åº“ -> åé—¨æ“ä½œ -> æ¨é€å¸¦åé—¨çš„é•œåƒ
* [**Dufflebag**](https://github.com/bishopfox/dufflebag): Dufflebagæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºåœ¨å…¬å…±çš„å¼¹æ€§å—å­˜å‚¨ï¼ˆ**EBSï¼‰å¿«ç…§ä¸­**æœç´¢**å¯èƒ½è¢«æ„å¤–é—ç•™çš„ç§˜å¯†ã€‚

### å®¡è®¡

* [**cloudsploit**](https://github.com/aquasecurity/cloudsploit)**:** Aquaçš„CloudSploitæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨æ£€æµ‹äº‘åŸºç¡€è®¾æ–½è´¦æˆ·ä¸­çš„**å®‰å…¨é£é™©**ï¼ŒåŒ…æ‹¬ï¼šAmazon Web Services (AWS)ï¼ŒMicrosoft Azureï¼ŒGoogle Cloud Platform (GCP)ï¼ŒOracle Cloud Infrastructure (OCI)å’ŒGitHubï¼ˆå®ƒä¸ä¼šæŸ¥æ‰¾ShadowAdminsï¼‰ã€‚
```bash
./index.js --csv=file.csv --console=table --config ./config.js

# Compiance options: --compliance {hipaa,cis,cis1,cis2,pci}
## use "cis" for cis level 1 and 2
```
* [**Prowler**](https://github.com/prowler-cloud/prowler): Prowleræ˜¯ä¸€ä¸ªå¼€æºå®‰å…¨å·¥å…·ï¼Œç”¨äºæ‰§è¡ŒAWSå®‰å…¨æœ€ä½³å®è·µè¯„ä¼°ã€å®¡è®¡ã€äº‹ä»¶å“åº”ã€æŒç»­ç›‘æ§ã€åŠ å›ºå’Œå–è¯å‡†å¤‡å·¥ä½œã€‚
```bash
# Install python3, jq and git
# Install
pip install prowler
prowler -v

# Run
prowler <provider>
prowler aws --profile custom-profile [-M csv json json-asff html]
```
* [**CloudFox**](https://github.com/BishopFox/cloudfox): CloudFoxå¸®åŠ©æ‚¨åœ¨é™Œç”Ÿçš„äº‘ç¯å¢ƒä¸­è·å¾—æƒ…å¢ƒæ„è¯†ã€‚è¿™æ˜¯ä¸€ä¸ªå¼€æºçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å’Œå…¶ä»–æ”»å‡»æ€§å®‰å…¨ä¸“ä¸šäººå‘˜åœ¨äº‘åŸºç¡€è®¾æ–½ä¸­æ‰¾åˆ°å¯åˆ©ç”¨çš„æ”»å‡»è·¯å¾„ã€‚
```bash
cloudfox aws --profile [profile-name] all-checks
```
* [**ScoutSuite**](https://github.com/nccgroup/ScoutSuite): Scout Suiteæ˜¯ä¸€ä¸ªå¼€æºçš„å¤šäº‘å®‰å…¨å®¡è®¡å·¥å…·ï¼Œå¯ä»¥è¯„ä¼°äº‘ç¯å¢ƒçš„å®‰å…¨çŠ¶å†µã€‚
```bash
# Install
virtualenv -p python3 venv
source venv/bin/activate
pip install scoutsuite
scout --help

# Get info
scout aws -p dev
```
* [**cs-suite**](https://github.com/SecurityFTW/cs-suite): äº‘å®‰å…¨å¥—ä»¶ï¼ˆä½¿ç”¨python2.7ï¼Œçœ‹èµ·æ¥æ²¡æœ‰ç»´æŠ¤ï¼‰
* [**Zeus**](https://github.com/DenizParlak/Zeus): Zeusæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºAWS EC2 / S3 / CloudTrail / CloudWatch / KMSæœ€ä½³ç¡¬åŒ–å®è·µï¼ˆçœ‹èµ·æ¥æ²¡æœ‰ç»´æŠ¤ï¼‰ã€‚å®ƒä»…æ£€æŸ¥ç³»ç»Ÿä¸­é»˜è®¤é…ç½®çš„å‡­æ®ã€‚

### æŒç»­å®¡è®¡

* [**cloud-custodian**](https://github.com/cloud-custodian/cloud-custodian): Cloud Custodianæ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å…¬å…±äº‘è´¦æˆ·å’Œèµ„æºçš„è§„åˆ™å¼•æ“ã€‚å®ƒå…è®¸ç”¨æˆ·å®šä¹‰ç­–ç•¥ï¼Œä»¥å®ç°è‰¯å¥½ç®¡ç†çš„äº‘åŸºç¡€æ¶æ„ï¼Œæ—¢å®‰å…¨åˆä¼˜åŒ–æˆæœ¬ã€‚å®ƒå°†ç»„ç»‡ä¸­çš„è®¸å¤šä¸´æ—¶è„šæœ¬æ•´åˆåˆ°ä¸€ä¸ªè½»é‡çµæ´»çš„å·¥å…·ä¸­ï¼Œå¹¶æä¾›ç»Ÿä¸€çš„åº¦é‡å’ŒæŠ¥å‘Šã€‚
* [**pacbot**](https://github.com/tmobile/pacbot)**: Policy as Code Bot (PacBot)**æ˜¯ä¸€ä¸ªç”¨äºäº‘çš„**æŒç»­åˆè§„ç›‘æ§ã€åˆè§„æŠ¥å‘Šå’Œå®‰å…¨è‡ªåŠ¨åŒ–**çš„å¹³å°ã€‚åœ¨PacBotä¸­ï¼Œå®‰å…¨å’Œåˆè§„ç­–ç•¥è¢«å®ç°ä¸ºä»£ç ã€‚PacBotè¯„ä¼°æ‰€æœ‰è¢«å‘ç°çš„èµ„æºæ˜¯å¦ç¬¦åˆè¿™äº›ç­–ç•¥ï¼Œä»¥è¡¡é‡ç­–ç•¥çš„ä¸€è‡´æ€§ã€‚PacBotçš„**è‡ªåŠ¨ä¿®å¤**æ¡†æ¶æä¾›äº†æ ¹æ®é¢„å®šä¹‰æ“ä½œè‡ªåŠ¨å“åº”ç­–ç•¥è¿è§„çš„èƒ½åŠ›ã€‚
* [**streamalert**](https://github.com/airbnb/streamalert)**:** StreamAlertæ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨çš„ã€**å®æ—¶**çš„æ•°æ®åˆ†ææ¡†æ¶ï¼Œä½¿æ‚¨èƒ½å¤Ÿæ ¹æ®æ‚¨å®šä¹‰çš„æ•°æ®æºå’Œè­¦æŠ¥é€»è¾‘**æ¥æ”¶ã€åˆ†æå’Œè­¦æŠ¥**ä»»ä½•ç¯å¢ƒä¸­çš„æ•°æ®ã€‚è®¡ç®—æœºå®‰å…¨å›¢é˜Ÿä½¿ç”¨StreamAlertæ¯å¤©æ‰«ææ•°TBçš„æ—¥å¿—æ•°æ®ä»¥è¿›è¡Œäº‹ä»¶æ£€æµ‹å’Œå“åº”ã€‚

## DEBUG: æ•è·AWS cliè¯·æ±‚
```bash
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080

# Capture with burp nor verifying ssl
aws --no-verify-ssl ...

# Dowload brup cert and transform it to pem
curl http://127.0.0.1:8080/cert --output Downloads/certificate.cer
openssl x509 -inform der -in Downloads/certificate.cer -out Downloads/certificate.pem

# Indicate the ca cert to trust
export AWS_CA_BUNDLE=~/Downloads/certificate.pem

# Run aws cli normally trusting burp cert
aws ...
```
## å‚è€ƒèµ„æ–™

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudsecdocs.com/aws/defensive/tooling/audit/](https://cloudsecdocs.com/aws/defensive/tooling/audit/)

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ PDF ç‰ˆçš„ HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
