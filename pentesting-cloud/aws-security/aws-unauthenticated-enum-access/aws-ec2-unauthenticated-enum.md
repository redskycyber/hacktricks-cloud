# AWS - EC2æœªç»èº«ä»½éªŒè¯çš„æšä¸¾

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## EC2å’Œç›¸å…³æœåŠ¡

åœ¨æ­¤é¡µé¢ä¸­æŸ¥çœ‹æ›´å¤šå…³äºæ­¤çš„ä¿¡æ¯ï¼š

{% content-ref url="../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### å…¬å…±ç«¯å£

å¯ä»¥å°†**è™šæ‹Ÿæœºçš„ä»»ä½•ç«¯å£æš´éœ²ç»™äº’è”ç½‘**ã€‚æ ¹æ®æš´éœ²çš„ç«¯å£ä¸­è¿è¡Œçš„å†…å®¹ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šæ»¥ç”¨å®ƒã€‚

#### SSRF

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### å…¬å…±AMIå’ŒEBSå¿«ç…§

AWSå…è®¸**ä»»ä½•äººä¸‹è½½AMIå’Œå¿«ç…§**ã€‚æ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°ä»æ‚¨è‡ªå·±çš„è´¦æˆ·åˆ—å‡ºè¿™äº›èµ„æºï¼š

{% code overflow="wrap" %}
```bash
# Public AMIs
aws ec2 describe-images --executable-users all

## Search AMI by ownerID
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `967541184254/`) == `true`]'

## Search AMI by substr ("shared" in the example)
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `shared`) == `true`]'

# Public EBS snapshots (hard-drive copies)
aws ec2 describe-snapshots --restorable-by-user-ids all
aws ec2 describe-snapshots --restorable-by-user-ids all | jq '.Snapshots[] | select(.OwnerId == "099720109477")'
```
#### å…¬å…±URLæ¨¡æ¿

{% code-tabs %}
{% code-tabs-item title="URLæ¨¡æ¿" %}
```
https://<aws_region>.console.aws.amazon.com/ec2/v2/home?region=<aws_region>#Instances:search=<instance_id>
```
{% endcode-tabs-item %}
{% endcode-tabs %}

#### Description

#### æè¿°

The AWS EC2 service allows users to launch and manage virtual servers in the cloud. In some cases, these EC2 instances may be misconfigured and allow unauthenticated access to sensitive information.

AWS EC2æœåŠ¡å…è®¸ç”¨æˆ·åœ¨äº‘ä¸­å¯åŠ¨å’Œç®¡ç†è™šæ‹ŸæœåŠ¡å™¨ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™äº›EC2å®ä¾‹å¯èƒ½é…ç½®é”™è¯¯ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è®¿é—®æ•æ„Ÿä¿¡æ¯ã€‚

#### Impact

#### å½±å“

An attacker can exploit this misconfiguration to gain unauthorized access to sensitive data stored on the EC2 instance. This can include confidential customer information, intellectual property, or other sensitive data.

æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªé…ç½®é”™è¯¯æ¥æœªç»æˆæƒåœ°è®¿é—®å­˜å‚¨åœ¨EC2å®ä¾‹ä¸Šçš„æ•æ„Ÿæ•°æ®ã€‚è¿™å¯èƒ½åŒ…æ‹¬æœºå¯†å®¢æˆ·ä¿¡æ¯ã€çŸ¥è¯†äº§æƒæˆ–å…¶ä»–æ•æ„Ÿæ•°æ®ã€‚

#### Recommendation

#### å»ºè®®

It is recommended to ensure that EC2 instances are properly configured with appropriate access controls and authentication mechanisms. Regular security assessments and audits should be conducted to identify and remediate any misconfigurations.

å»ºè®®ç¡®ä¿EC2å®ä¾‹ä»¥é€‚å½“çš„è®¿é—®æ§åˆ¶å’Œèº«ä»½éªŒè¯æœºåˆ¶è¿›è¡Œæ­£ç¡®é…ç½®ã€‚åº”å®šæœŸè¿›è¡Œå®‰å…¨è¯„ä¼°å’Œå®¡è®¡ï¼Œä»¥è¯†åˆ«å’Œçº æ­£ä»»ä½•é…ç½®é”™è¯¯ã€‚

#### References

#### å‚è€ƒèµ„æ–™

- [AWS EC2 Documentation](https://docs.aws.amazon.com/ec2/index.html)

{% endcode %}
```bash
# EC2
ec2-{ip-seperated}.compute-1.amazonaws.com
# ELB
http://{user_provided}-{random_id}.{region}.elb.amazonaws.com:80/443
https://{user_provided}-{random_id}.{region}.elb.amazonaws.com
```
### æšä¸¾å…·æœ‰å…¬å…±IPçš„EC2å®ä¾‹

{% code overflow="wrap" %}
```bash
aws ec2 describe-instances --query "Reservations[].Instances[?PublicIpAddress!=null].PublicIpAddress" --output text
```
{% endcode %}

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
