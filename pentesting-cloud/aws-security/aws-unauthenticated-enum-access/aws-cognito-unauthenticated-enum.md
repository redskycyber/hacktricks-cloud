# AWS - Cognito Enumeraci贸n No Autenticada

<details>

<summary><strong>Aprende hacking de AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Cognito No Autenticado

Cognito es un servicio de AWS que permite a los desarrolladores **otorgar a los usuarios de su aplicaci贸n acceso a servicios de AWS**. Los desarrolladores otorgar谩n **roles de IAM a usuarios autenticados** en su aplicaci贸n (potencialmente las personas podr谩n simplemente registrarse) y tambi茅n pueden otorgar un **rol de IAM a usuarios no autenticados**.

Para informaci贸n b谩sica sobre Cognito consulta:

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### M贸dulos de Pacu para pentesting y enumeraci贸n

[Pacu](https://github.com/RhinoSecurityLabs/pacu), el marco de explotaci贸n de AWS, ahora incluye los m贸dulos "cognito__enum" y "cognito__attack" que automatizan la enumeraci贸n de todos los activos de Cognito en una cuenta e identifican configuraciones d茅biles, atributos de usuario utilizados para el control de acceso, etc., y tambi茅n automatizan la creaci贸n de usuarios (incluyendo soporte para MFA) y la escalada de privilegios basada en atributos personalizados modificables, credenciales de pool de identidades utilizables, roles asumibles en tokens de identidad, etc.

Para una descripci贸n de las funciones de los m贸dulos, consulta la parte 2 del [art铆culo del blog](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2). Para instrucciones de instalaci贸n, consulta la p谩gina principal de [Pacu](https://github.com/RhinoSecurityLabs/pacu).

### Uso

Ejemplo de uso de cognito__attack para intentar la creaci贸n de usuario y todos los vectores de privesc contra un pool de identidad y cliente de pool de usuarios dado:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
Uso de ejemplo de cognito__enum para recopilar todos los grupos de usuarios, clientes de grupos de usuarios, grupos de identidad, usuarios, etc. visibles en la cuenta actual de AWS:
```bash
Pacu (new:test) > run cognito__enum
```
### ID del Pool de Identidad

Los Pools de Identidad pueden otorgar **roles de IAM a usuarios no autenticados** que solo **conozcan el ID del Pool de Identidad** (lo cual es bastante com煤n de **encontrar**), y un atacante con esta informaci贸n podr铆a intentar **acceder a ese rol de IAM** y explotarlo.\
Adem谩s, los roles de IAM tambi茅n podr铆an asignarse a **usuarios autenticados** que acceden al Pool de Identidad. Si un atacante puede **registrar un usuario** o ya tiene **acceso al proveedor de identidad** utilizado en el pool de identidad, podr铆a acceder al **rol de IAM que se otorga a usuarios autenticados** y abusar de sus privilegios.

[**Consulta c贸mo hacerlo aqu铆**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### ID del Pool de Usuarios

Por defecto, Cognito permite **registrar nuevos usuarios**. Poder registrar un usuario podr铆a darte **acceso** a la **aplicaci贸n subyacente** o al **rol de acceso IAM autenticado de un Pool de Identidad** que acepta como proveedor de identidad el Pool de Usuarios de Cognito. [**Consulta c贸mo hacerlo aqu铆**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
