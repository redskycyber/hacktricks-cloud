# AWS - Enumeraci贸n no autenticada de Cognito

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Cognito no autenticado

Cognito es un servicio de AWS que permite a los desarrolladores **conceder a los usuarios de sus aplicaciones acceso a los servicios de AWS**. Los desarrolladores otorgar谩n **roles IAM a los usuarios autenticados** en su aplicaci贸n (potencialmente las personas podr谩n simplemente registrarse) y tambi茅n pueden otorgar un **rol IAM a los usuarios no autenticados**.

Para obtener informaci贸n b谩sica sobre Cognito, consulta:

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### M贸dulos de Pacu para pentesting y enumeraci贸n

[Pacu](https://github.com/RhinoSecurityLabs/pacu), el marco de explotaci贸n de AWS, ahora incluye los m贸dulos "cognito__enum" y "cognito__attack" que automatizan la enumeraci贸n de todos los activos de Cognito en una cuenta y se帽alan configuraciones d茅biles, atributos de usuario utilizados para el control de acceso, etc., y tambi茅n automatizan la creaci贸n de usuarios (incluido el soporte de MFA) y la escalada de privilegios basada en atributos personalizables modificables, credenciales de grupo de identidades utilizables, roles asumibles en tokens de identidad, etc.

Para obtener una descripci贸n de las funciones de los m贸dulos, consulta la parte 2 de la [publicaci贸n del blog](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2). Para instrucciones de instalaci贸n, consulta la p谩gina principal de [Pacu](https://github.com/RhinoSecurityLabs/pacu).

### Uso

Uso de muestra de cognito__attack para intentar la creaci贸n de usuarios y todos los vectores de escalada de privilegios contra un grupo de identidades y cliente de grupo de usuarios espec铆ficos:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
Ejemplo de uso de cognito__enum para recopilar todos los grupos de usuarios, clientes de grupos de usuarios, grupos de identidades, usuarios, etc. visibles en la cuenta actual de AWS:
```bash
Pacu (new:test) > run cognito__enum
```
### ID de grupo de identidad

Los Grupos de Identidad pueden otorgar **roles IAM a usuarios no autenticados** que solo **conozcan el ID del Grupo de Identidad** (lo cual es bastante com煤n de **encontrar**), y un atacante con esta informaci贸n podr铆a intentar **acceder a ese rol IAM** y explotarlo.\
Adem谩s, los roles IAM tambi茅n podr铆an asignarse a **usuarios autenticados** que accedan al Grupo de Identidad. Si un atacante puede **registrar un usuario** o ya tiene **acceso al proveedor de identidad** utilizado en el grupo de identidad, podr铆a acceder al **rol IAM que se otorga a los usuarios autenticados** y abusar de sus privilegios.

[**Ver c贸mo hacerlo aqu铆**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### ID de grupo de usuarios

Por defecto, Cognito permite **registrar nuevos usuarios**. Poder registrar un usuario podr铆a darte **acceso** a la **aplicaci贸n subyacente** o al **rol de acceso IAM autenticado de un Grupo de Identidad** que acepta como proveedor de identidad el Grupo de Usuarios de Cognito. [**Ver c贸mo hacerlo aqu铆**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**repositorios de HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
