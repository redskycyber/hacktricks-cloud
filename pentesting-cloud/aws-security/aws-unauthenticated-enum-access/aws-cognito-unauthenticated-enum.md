# AWS - Cognito Enumeracja nieuwierzytelnionych

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Nieuwierzytelniony Cognito

Cognito to usuga AWS, kt贸ra umo偶liwia programistom **udzielanie u偶ytkownikom aplikacji dostpu do usug AWS**. Programici przyznaj **role IAM uwierzytelnionym u偶ytkownikom** w swojej aplikacji (potencjalnie ludzie bd mogli tylko si zarejestrowa), a tak偶e mog przyzna **rol IAM nieuwierzytelnionym u偶ytkownikom**.

Aby uzyska podstawowe informacje na temat Cognito, sprawd藕:

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### Moduy Pacu do pentestowania i enumeracji

[Pacu](https://github.com/RhinoSecurityLabs/pacu), framework eksploatacji AWS, teraz zawiera moduy "cognito__enum" i "cognito__attack", kt贸re automatyzuj enumeracj wszystkich zasob贸w Cognito w koncie, wykrywaj sabe konfiguracje, atrybuty u偶ytkownik贸w u偶ywane do kontroli dostpu, itp., a tak偶e automatyzuj tworzenie u偶ytkownik贸w (w tym obsug MFA) i eskalacj uprawnie na podstawie modyfikowalnych niestandardowych atrybut贸w, u偶ytecznych powiadcze puli to偶samoci, roli przyjmowalnych w tokenach ID, itp.

Aby uzyska opis funkcji modu贸w, zobacz cz 2 [wpisu na blogu](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2). Instrukcje instalacji znajduj si na g贸wnej stronie [Pacu](https://github.com/RhinoSecurityLabs/pacu).

### U偶ycie

Przykadowe u偶ycie moduu cognito__attack do pr贸by tworzenia u偶ytkownika i wszystkich wektor贸w eskalacji uprawnie dla okrelonej puli to偶samoci i klienta puli u偶ytkownik贸w:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
Przykadowe u偶ycie cognito__enum do zebrania wszystkich pul u偶ytkownik贸w, klient贸w pul u偶ytkownik贸w, pul to偶samoci, u偶ytkownik贸w itp. widocznych w bie偶cym koncie AWS:

```plaintext
cognito__enum
```

Ten polecenie wywietli wszystkie dostpne informacje o pulach u偶ytkownik贸w, klientach pul u偶ytkownik贸w, pulach to偶samoci, u偶ytkownikach itp. w bie偶cym koncie AWS.
```bash
Pacu (new:test) > run cognito__enum
```
### Identity Pool ID

Identity Pools mog przyznawa **role IAM nieuwierzytelnionym u偶ytkownikom**, kt贸rzy znaj tylko **Identity Pool ID** (co jest do powszechne do **znalezienia**), a atakujcy posiadajcy te informacje mog pr贸bowa **uzyska dostp do tej roli IAM** i go wykorzysta. 
Ponadto, role IAM mog by przypisane r贸wnie偶 do **uwierzytelnionych u偶ytkownik贸w**, kt贸rzy maj dostp do Identity Pool. Jeli atakujcy mo偶e **zarejestrowa u偶ytkownika** lub ju偶 ma **dostp do dostawcy to偶samoci** u偶ywanego w Identity Pool, mo偶e uzyska dostp do **roli IAM przypisanej do uwierzytelnionych** u偶ytkownik贸w i wykorzysta jej uprawnienia.

[**Sprawd藕, jak to zrobi tutaj**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### User Pool ID

Domylnie Cognito pozwala na **rejestracj nowego u偶ytkownika**. Mo偶liwo rejestracji u偶ytkownika mo偶e da ci **dostp** do **podstawowej aplikacji** lub do **uwierzytelnionej roli IAM z Identity Pool**, kt贸ra akceptuje jako dostawc to偶samoci Cognito User Pool. [**Sprawd藕, jak to zrobi tutaj**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCYJNY**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
