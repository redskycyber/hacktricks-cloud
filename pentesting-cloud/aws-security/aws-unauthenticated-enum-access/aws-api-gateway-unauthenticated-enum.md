# AWS - Enumeracja nieuwierzytelnionych dostÄ™pÃ³w do bramy API

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

### OminiÄ™cie wywoÅ‚ania API

Zgodnie z prezentacjÄ… [Attack Vectors for APIs Using AWS API Gateway Lambda Authorizers - Alexandre & Leonardo](https://www.youtube.com/watch?v=bsPKk7WDOnE), autoryzatory Lambda moÅ¼na skonfigurowaÄ‡ **za pomocÄ… skÅ‚adni IAM**, aby nadaÄ‡ uprawnienia do wywoÅ‚ywania punktÃ³w koÅ„cowych API. Oto fragment [**dokumentacji**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Permission",
"Action": [
"execute-api:Execution-operation"
],
"Resource": [
"arn:aws:execute-api:region:account-id:api-id/stage/METHOD_HTTP_VERB/Resource-path"
]
}
]
}
```
Problem z tym sposobem nadawania uprawnieÅ„ do wywoÅ‚ywania punktÃ³w koÅ„cowych polega na tym, Å¼e **"\*" oznacza "cokolwiek"** i nie ma obsÅ‚ugi skÅ‚adni regex.

PrzykÅ‚ady:

* ReguÅ‚a taka jak `arn:aws:execute-apis:sa-east-1:accid:api-id/prod/*/dashboard/*`, aby umoÅ¼liwiÄ‡ kaÅ¼demu uÅ¼ytkownikowi dostÄ™p do `/dashboard/user/{username}`, umoÅ¼liwi im rÃ³wnieÅ¼ dostÄ™p do innych Å›cieÅ¼ek, takich jak `/admin/dashboard/createAdmin`, na przykÅ‚ad.

{% hint style="warning" %}
NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e **"\*" nie przestaje siÄ™ rozszerzaÄ‡ za pomocÄ… ukoÅ›nikÃ³w**, dlatego jeÅ›li uÅ¼yjesz "\*" w api-id, na przykÅ‚ad, moÅ¼e on rÃ³wnieÅ¼ oznaczaÄ‡ "dowolny etap" lub "dowolnÄ… metodÄ™", o ile koÅ„cowe wyraÅ¼enie regularne jest wciÄ…Å¼ poprawne.\
WiÄ™c `arn:aws:execute-apis:sa-east-1:accid:*/prod/GET/dashboard/*`\
MoÅ¼e zatwierdziÄ‡ Å¼Ä…danie POST do etapu testowego dla Å›cieÅ¼ki `/prod/GET/dashboard/admin`, na przykÅ‚ad.
{% endhint %}

Zawsze powinieneÅ› mieÄ‡ jasno okreÅ›lone, do czego chcesz udzieliÄ‡ dostÄ™pu, a nastÄ™pnie sprawdziÄ‡, czy istniejÄ… inne moÅ¼liwe scenariusze z uprawnieniami udzielonymi.

WiÄ™cej informacji, oprÃ³cz [**dokumentacji**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html), moÅ¼na znaleÅºÄ‡ kod do implementacji autoryzatorÃ³w w [**tym oficjalnym repozytorium aws na githubie**](https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints/tree/master/blueprints).

### Wstrzykiwanie polityki IAM

W tej samej [**rozmowie**](https://www.youtube.com/watch?v=bsPKk7WDOnE) ujawniono fakt, Å¼e jeÅ›li kod uÅ¼ywa **wejÅ›cia uÅ¼ytkownika** do **generowania polityk IAM**, moÅ¼na wÅ‚Ä…czyÄ‡ tam znaki wieloznaczne (oraz inne, takie jak "." lub konkretne ciÄ…gi znakÃ³w) w celu **ominiÄ™cia ograniczeÅ„**.

### Szablon publicznego adresu URL
```
https://{random_id}.execute-api.{region}.amazonaws.com/{user_provided}
```
<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
