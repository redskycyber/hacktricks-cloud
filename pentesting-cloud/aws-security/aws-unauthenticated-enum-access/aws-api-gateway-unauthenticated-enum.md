# AWS - API Gateway Unauthenticated Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)</strong>ì—ì„œ <strong>ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°</strong>!</summary>

ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

### API Invoke ìš°íšŒ

[Attack Vectors for APIs Using AWS API Gateway Lambda Authorizers - Alexandre & Leonardo](https://www.youtube.com/watch?v=bsPKk7WDOnE)ì—ì„œ ì–¸ê¸‰ëœ ëŒ€ë¡œ, Lambda AuthorizersëŠ” **IAM êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬** API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•  ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” [**ë¬¸ì„œì—ì„œ ê°€ì ¸ì˜¨ ê²ƒ**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html)ì…ë‹ˆë‹¤:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Permission",
"Action": [
"execute-api:Execution-operation"
],
"Resource": [
"arn:aws:execute-api:region:account-id:api-id/stage/METHOD_HTTP_VERB/Resource-path"
]
}
]
}
```
ì´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•  ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ë°©ë²•ì˜ ë¬¸ì œëŠ” **"\*"ì´ "ì•„ë¬´ ê²ƒì´ë‚˜"ë¥¼ ì˜ë¯¸**í•˜ë©° **ì •ê·œ í‘œí˜„ì‹ êµ¬ë¬¸ì´ ë” ì´ìƒ ì§€ì›ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.

ì¼ë¶€ ì˜ˆì‹œ:

* `/dashboard/user/{username}`ì— ëŒ€í•œ ê° ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ `arn:aws:execute-apis:sa-east-1:accid:api-id/prod/*/dashboard/*`ì™€ ê°™ì€ ê·œì¹™ì€ `/admin/dashboard/createAdmin`ê³¼ ê°™ì€ ë‹¤ë¥¸ ê²½ë¡œì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

{% hint style="warning" %}
**"\*"ì€ ìŠ¬ë˜ì‹œì™€ í•¨ê»˜ ê³„ì† í™•ì¥ë˜ì§€ ì•ŠìŒ**ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤. ë”°ë¼ì„œ ì˜ˆë¥¼ ë“¤ì–´ api-idì—ì„œ "\*"ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ìµœì¢… ì •ê·œ í‘œí˜„ì‹ì´ ì—¬ì „íˆ ìœ íš¨í•˜ë‹¤ë©´ "ì–´ë–¤ stage" ë˜ëŠ” "ì–´ë–¤ method"ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\
ë”°ë¼ì„œ `arn:aws:execute-apis:sa-east-1:accid:*/prod/GET/dashboard/*`\
ì˜ˆë¥¼ ë“¤ì–´ `/prod/GET/dashboard/admin` ê²½ë¡œë¡œ í…ŒìŠ¤íŠ¸ ìŠ¤í…Œì´ì§€ì— ëŒ€í•œ POST ìš”ì²­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

í•­ìƒ ëˆ„êµ¬ì—ê²Œ ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í• ì§€ ëª…í™•íˆí•˜ê³  ë‚˜ì„œ ë¶€ì—¬ëœ ê¶Œí•œìœ¼ë¡œ ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ê°€ ê°€ëŠ¥í•œì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

ë” ë§ì€ ì •ë³´ëŠ” [**ë¬¸ì„œ**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html) ì™¸ì—ë„ [**ì´ ê³µì‹ aws github**](https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints/tree/master/blueprints)ì—ì„œ ê¶Œí•œ ë¶€ì—¬ìë¥¼ êµ¬í˜„í•˜ëŠ” ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### IAM ì •ì±… ì£¼ì…

ë™ì¼í•œ [**í† í¬**](https://www.youtube.com/watch?v=bsPKk7WDOnE)ì—ì„œ ì½”ë“œê°€ **ì‚¬ìš©ì ì…ë ¥**ì„ ì‚¬ìš©í•˜ì—¬ **IAM ì •ì±…ì„ ìƒì„±**í•˜ëŠ” ê²½ìš°, ì™€ì¼ë“œì¹´ë“œ(ê·¸ë¦¬ê³  "." ë˜ëŠ” íŠ¹ì • ë¬¸ìì—´ê³¼ ê°™ì€ ë‹¤ë¥¸ ë¬¸ì)ê°€ **ì œí•œì„ ìš°íšŒ**í•˜ê¸° ìœ„í•´ í¬í•¨ë  ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì´ ë…¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤.

### ê³µê°œ URL í…œí”Œë¦¿
```
https://{random_id}.execute-api.{region}.amazonaws.com/{user_provided}
```
### ê³µê°œ API Gateway URLì—ì„œ ê³„ì • ID ê°€ì ¸ì˜¤ê¸°

S3 ë²„í‚·, ë°ì´í„° êµí™˜ ë° ëŒë‹¤ URL ê²Œì´íŠ¸ì›¨ì´ì™€ ë§ˆì°¬ê°€ì§€ë¡œ, ê³µê°œ API Gateway URLì—ì„œ **`aws:ResourceAccount`** **ì •ì±… ì¡°ê±´ í‚¤**ë¥¼ ë‚¨ìš©í•˜ì—¬ ê³„ì • IDë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì •ì±…ì˜ **`aws:ResourceAccount`** ì„¹ì…˜ì—ì„œ ì™€ì¼ë“œì¹´ë“œë¥¼ ë‚¨ìš©í•˜ì—¬ ê³„ì • IDë¥¼ í•œ ë¬¸ìì”© ì°¾ì•„ë‚´ëŠ” ê²ƒì…ë‹ˆë‹¤.\
ì´ ê¸°ìˆ ì€ ë˜í•œ **íƒœê·¸ ê°’**ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ í•´ì¤ë‹ˆë‹¤. íƒœê·¸ í‚¤ë¥¼ ì•Œê³  ìˆë‹¤ë©´(ì¼ë¶€ ê¸°ë³¸ì ìœ¼ë¡œ í¥ë¯¸ë¡œìš´ íƒœê·¸ê°€ ìˆìŒ).

ë” ë§ì€ ì •ë³´ëŠ” [**ì›ë³¸ ì—°êµ¬**](https://blog.plerion.com/conditional-love-for-aws-metadata-enumeration/) ë° ì´ ì·¨ì•½ì ì„ ìë™í™”í•˜ëŠ” ë„êµ¬ [**conditional-love**](https://github.com/plerionhq/conditional-love/)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜** íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
