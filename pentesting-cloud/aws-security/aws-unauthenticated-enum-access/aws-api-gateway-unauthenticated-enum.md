# AWS - Api Gateway ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±°

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

### API Invoke ìš°íšŒ

[Attack Vectors for APIs Using AWS API Gateway Lambda Authorizers - Alexandre & Leonardo](https://www.youtube.com/watch?v=bsPKk7WDOnE)ì—ì„œ ì–¸ê¸‰í•œ ëŒ€ë¡œ, Lambda AuthorizersëŠ” API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•  ê¶Œí•œì„ ë¶€ì—¬í•˜ê¸° ìœ„í•´ **IAM êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬** êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” [**ë¬¸ì„œì—ì„œ ê°€ì ¸ì˜¨ ê²ƒ**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html)ì…ë‹ˆë‹¤:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Permission",
"Action": [
"execute-api:Execution-operation"
],
"Resource": [
"arn:aws:execute-api:region:account-id:api-id/stage/METHOD_HTTP_VERB/Resource-path"
]
}
]
}
```
ì´ë ‡ê²Œ ì—”ë“œí¬ì¸íŠ¸ì— ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ë°©ë²•ì˜ ë¬¸ì œëŠ” **"\*"ì´ "ì•„ë¬´ ê²ƒì´ë‚˜"ë¥¼ ì˜ë¯¸**í•˜ë©°, **ì •ê·œì‹ êµ¬ë¬¸ì„ ë” ì´ìƒ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.

ì¼ë¶€ ì˜ˆì‹œ:

* `arn:aws:execute-apis:sa-east-1:accid:api-id/prod/*/dashboard/*`ì™€ ê°™ì€ ê·œì¹™ì€ ê° ì‚¬ìš©ìê°€ `/dashboard/user/{username}`ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ í•˜ì§€ë§Œ, `/admin/dashboard/createAdmin`ê³¼ ê°™ì€ ë‹¤ë¥¸ ê²½ë¡œì—ë„ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

{% hint style="warning" %}
**"\*"ëŠ” ìŠ¬ë˜ì‹œë¡œ í™•ì¥ì´ ë©ˆì¶”ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒ**ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤. ë”°ë¼ì„œ, ì˜ˆë¥¼ ë“¤ì–´ api-idì— "\*"ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ìµœì¢…ì ì¸ ì •ê·œì‹ì´ ì—¬ì „íˆ ìœ íš¨í•˜ë‹¤ë©´ "ì–´ë–¤ ìŠ¤í…Œì´ì§€"ë‚˜ "ì–´ë–¤ ë©”ì†Œë“œ"ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\
ë”°ë¼ì„œ `arn:aws:execute-apis:sa-east-1:accid:*/prod/GET/dashboard/*`\
ì˜ˆë¥¼ ë“¤ì–´, `/prod/GET/dashboard/admin` ê²½ë¡œë¡œì˜ í…ŒìŠ¤íŠ¸ ìŠ¤í…Œì´ì§€ì— ëŒ€í•œ POST ìš”ì²­ì„ ìœ íš¨í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

í•­ìƒ ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•˜ë ¤ëŠ” ë‚´ìš©ì„ ëª…í™•íˆí•˜ê³ , ë¶€ì—¬ëœ ê¶Œí•œìœ¼ë¡œ ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ê°€ ê°€ëŠ¥í•œì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

ë” ë§ì€ ì •ë³´ëŠ” [**ë¬¸ì„œ**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html) ì™¸ì—ë„, [**ì´ ê³µì‹ aws github**](https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints/tree/master/blueprints)ì—ì„œ ì¸ì¦ìë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### IAM ì •ì±… ì¸ì ì…˜

ë™ì¼í•œ [**ë°œí‘œ**](https://www.youtube.com/watch?v=bsPKk7WDOnE)ì—ì„œëŠ” ì½”ë“œê°€ **ì‚¬ìš©ì ì…ë ¥**ì„ ì‚¬ìš©í•˜ì—¬ **IAM ì •ì±…ì„ ìƒì„±**í•˜ëŠ” ê²½ìš°, ì™€ì¼ë“œì¹´ë“œ(ê·¸ë¦¬ê³  "." ë˜ëŠ” íŠ¹ì • ë¬¸ìì—´ê³¼ ê°™ì€ ë‹¤ë¥¸ ë¬¸ì)ë¥¼ í¬í•¨í•˜ì—¬ **ì œí•œì„ ìš°íšŒ**í•  ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì´ ë…¸ì¶œë©ë‹ˆë‹¤.

### ê³µê°œ URL í…œí”Œë¦¿
```
https://{random_id}.execute-api.{region}.amazonaws.com/{user_provided}
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
