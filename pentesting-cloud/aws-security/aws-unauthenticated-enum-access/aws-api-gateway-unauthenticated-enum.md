# AWS - Enumeracja nieuwierzytelnionych dostÄ™pÃ³w do bramy API

<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**Grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

### OminiÄ™cie wywoÅ‚ania API

Zgodnie z prezentacjÄ… [Attack Vectors for APIs Using AWS API Gateway Lambda Authorizers - Alexandre & Leonardo](https://www.youtube.com/watch?v=bsPKk7WDOnE), Autoryzatory Lambda moÅ¼na skonfigurowaÄ‡ **za pomocÄ… skÅ‚adni IAM** w celu udzielenia uprawnieÅ„ do wywoÅ‚ywania punktÃ³w koÅ„cowych interfejsu API. To zostaÅ‚o zaczerpniÄ™te [**z dokumentacji**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Permission",
"Action": [
"execute-api:Execution-operation"
],
"Resource": [
"arn:aws:execute-api:region:account-id:api-id/stage/METHOD_HTTP_VERB/Resource-path"
]
}
]
}
```
Problem z tym sposobem nadawania uprawnieÅ„ do wywoÅ‚ywania punktÃ³w koÅ„cowych polega na tym, Å¼e **"\*" oznacza "cokolwiek"** i **nie ma juÅ¼ obsÅ‚ugi skÅ‚adni regex**.

PrzykÅ‚ady:

* ReguÅ‚a taka jak `arn:aws:execute-apis:sa-east-1:accid:api-id/prod/*/dashboard/*` w celu umoÅ¼liwienia kaÅ¼demu uÅ¼ytkownikowi dostÄ™pu do `/dashboard/user/{username}` umoÅ¼liwi im dostÄ™p do innych tras, takich jak `/admin/dashboard/createAdmin` na przykÅ‚ad.

{% hint style="warning" %}
ZauwaÅ¼, Å¼e **"\*" nie zatrzymuje siÄ™ na ukoÅ›nikach**, dlatego jeÅ›li uÅ¼yjesz "\*" w api-id na przykÅ‚ad, moÅ¼e on rÃ³wnieÅ¼ wskazywaÄ‡ "dowolny etap" lub "dowolnÄ… metodÄ™", o ile koÅ„cowe wyraÅ¼enie regularne jest wciÄ…Å¼ poprawne.\
WiÄ™c `arn:aws:execute-apis:sa-east-1:accid:*/prod/GET/dashboard/*`\
MoÅ¼e zatwierdziÄ‡ Å¼Ä…danie POST do etapu testowego na Å›cieÅ¼kÄ™ `/prod/GET/dashboard/admin` na przykÅ‚ad.
{% endhint %}

Zawsze powinieneÅ› jasno okreÅ›liÄ‡, do czego chcesz zezwoliÄ‡ na dostÄ™p, a nastÄ™pnie sprawdziÄ‡, czy inne scenariusze sÄ… moÅ¼liwe z udzielonymi uprawnieniami.

Aby uzyskaÄ‡ wiÄ™cej informacji, oprÃ³cz [**dokumentacji**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html), moÅ¼esz znaleÅºÄ‡ kod do implementacji autoryzatorÃ³w w [**tym oficjalnym githubie aws**](https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints/tree/master/blueprints).

### Wstrzykiwanie polityki IAM

W tej samej [**prezentacji**](https://www.youtube.com/watch?v=bsPKk7WDOnE) ujawniono fakt, Å¼e jeÅ›li kod uÅ¼ywa **wejÅ›cia uÅ¼ytkownika** do **generowania polityk IAM**, symbole wieloznaczne (i inne, takie jak "." lub konkretne ciÄ…gi znakÃ³w) mogÄ… byÄ‡ wÅ‚Ä…czone w celu **ominiÄ™cia ograniczeÅ„**.

### Szablon publicznego adresu URL
```
https://{random_id}.execute-api.{region}.amazonaws.com/{user_provided}
```
### Uzyskaj identyfikator konta z publicznego adresu URL bramy API

Podobnie jak w przypadku kubeÅ‚kÃ³w S3, wymiany danych i adresÃ³w URL funkcji Lambda, moÅ¼liwe jest znalezienie identyfikatora konta naduÅ¼ywajÄ…c **`aws:ResourceAccount`** **Klucza Warunku Polityki** z publicznego adresu URL bramy API. MoÅ¼na to zrobiÄ‡, znajdujÄ…c identyfikator konta po jednym znaku, naduÅ¼ywajÄ…c symboli wieloznacznych w sekcji **`aws:ResourceAccount`** polityki.\
Ta technika pozwala rÃ³wnieÅ¼ uzyskaÄ‡ **wartoÅ›ci tagÃ³w**, jeÅ›li znasz klucz tagu (istnieje kilka domyÅ›lnie interesujÄ…cych).

WiÄ™cej informacji moÅ¼na znaleÅºÄ‡ w [**oryginalnym badaniu**](https://blog.plerion.com/conditional-love-for-aws-metadata-enumeration/) oraz narzÄ™dziu [**conditional-love**](https://github.com/plerionhq/conditional-love/) do zautomatyzowania tego wykorzystania.

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**Grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na GitHubie.

</details>
