# AWS - Redshiftç‰¹æ¨©æ˜‡æ ¼

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å¾—ã‚‹ï¼</strong></summary>

* **HackTricksã§ä¼šç¤¾ã®åºƒå‘Šã‚’è¦‹ãŸã„**å ´åˆã‚„ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™ºè¦‹ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>

## Redshift

RDSã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã¯æ¬¡ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

{% content-ref url="../aws-services/aws-databases/aws-redshift-enum.md" %}
[aws-redshift-enum.md](../aws-services/aws-databases/aws-redshift-enum.md)
{% endcontent-ref %}

### `redshift:DescribeClusters`, `redshift:GetClusterCredentials`

ã“ã‚Œã‚‰ã®æ¨©é™ã‚’æŒã¤ã¨ã€**ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¹ã‚¿ã®æƒ…å ±**ï¼ˆåå‰ã¨ã‚¯ãƒ©ã‚¹ã‚¿ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å«ã‚€ï¼‰ã‚’å–å¾—ã—ã€ãã‚Œã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®**è³‡æ ¼æƒ…å ±**ã‚’å–å¾—ã§ãã¾ã™ï¼š
```bash
# Get creds
aws redshift get-cluster-credentials --db-user postgres --cluster-identifier redshift-cluster-1
# Connect, even if the password is a base64 string, that is the password
psql -h redshift-cluster-1.asdjuezc439a.us-east-1.redshift.amazonaws.com -U "IAM:<username>" -d template1 -p 5439
```
**æ½œåœ¨çš„ãªå½±éŸ¿:** ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®æ©Ÿå¯†æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### `redshift:DescribeClusters`, `redshift:GetClusterCredentialsWithIAM`

ã“ã‚Œã‚‰ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€**ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¹ã‚¿ã®æƒ…å ±**ã‚’å–å¾—ã—ã€ãã‚Œã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®**è³‡æ ¼æƒ…å ±**ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
ãªãŠã€postgresãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€è³‡æ ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚ŒãŸIAMã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒæŒã¤**æ¨©é™**ã‚’æŒã¡ã¾ã™ã€‚
```bash
# Get creds
aws redshift get-cluster-credentials-with-iam --cluster-identifier redshift-cluster-1
# Connect, even if the password is a base64 string, that is the password
psql -h redshift-cluster-1.asdjuezc439a.us-east-1.redshift.amazonaws.com -U "IAMR:AWSReservedSSO_AdministratorAccess_4601154638985c45" -d template1 -p 5439
```
**æ½œåœ¨çš„ãªå½±éŸ¿:** ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®æ©Ÿå¯†æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### `redshift:DescribeClusters`, `redshift:ModifyCluster?`

aws cliã‹ã‚‰å†…éƒ¨ã®postgresï¼ˆredshiftï¼‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®**ãƒã‚¹ã‚¿ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´**ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼ˆã“ã‚Œã‚‰ã®æ¨©é™ãŒå¿…è¦ãªã¯ãšã§ã™ãŒã€ã¾ã ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã›ã‚“ï¼‰ã€‚
```
aws redshift modify-cluster â€“cluster-identifier <identifier-for-the cluster> â€“master-user-password â€˜master-passwordâ€™;
```
**æ½œåœ¨çš„ãªå½±éŸ¿:** ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®æ©Ÿå¯†æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

{% hint style="warning" %}
ä»¥ä¸‹ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€**ä½¿ç”¨ã™ã‚‹ãƒ­ãƒ¼ãƒ«ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚Redshiftã‚¯ãƒ©ã‚¹ã‚¿ã«ã¯ã€ä½¿ç”¨ã§ãã‚‹AWSãƒ­ãƒ¼ãƒ«ã®ãƒªã‚¹ãƒˆãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ARNã‚’çŸ¥ã£ã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ­ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã€Œ**default**ã€ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã•ã‚‰ã«ã€[**ã“ã“ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«**](https://docs.aws.amazon.com/redshift/latest/mgmt/authorizing-redshift-service.html)ã€Redshiftã§ã¯ãƒ­ãƒ¼ãƒ«ã‚’é€£çµã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼ˆæœ€åˆã®ãƒ­ãƒ¼ãƒ«ãŒ2ç•ªç›®ã®ãƒ­ãƒ¼ãƒ«ã‚’ä»®å®šã§ãã‚‹å ´åˆï¼‰ã€‚ãŸã ã—ã€**ã‚«ãƒ³ãƒ**ã§ãã‚Œã‚‰ã‚’**åŒºåˆ‡ã‚‹**ã“ã¨ã§è¿½åŠ ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å–å¾—ã§ãã¾ã™: `iam_role 'arn:aws:iam::123456789012:role/RoleA,arn:aws:iam::210987654321:role/RoleB';`
{% endhint %}

### ãƒ©ãƒ ãƒ€

[https://docs.aws.amazon.com/redshift/latest/dg/r\_CREATE\_EXTERNAL\_FUNCTION.html](https://docs.aws.amazon.com/redshift/latest/dg/r\_CREATE\_EXTERNAL\_FUNCTION.html)ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€Redshiftã‹ã‚‰ãƒ©ãƒ ãƒ€é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ç”¨ã—ã¾ã™:
```sql
CREATE EXTERNAL FUNCTION exfunc_sum2(INT,INT)
RETURNS INT
STABLE
LAMBDA 'lambda_function'
IAM_ROLE default;
```
### S3

[https://docs.aws.amazon.com/redshift/latest/dg/tutorial-loading-run-copy.html](https://docs.aws.amazon.com/redshift/latest/dg/tutorial-loading-run-copy.html)ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€S3ãƒã‚±ãƒƒãƒˆã¸ã®**èª­ã¿æ›¸ããŒå¯èƒ½**ã§ã™ã€‚
```sql
# Read
copy table from 's3://<your-bucket-name>/load/key_prefix'
credentials 'aws_iam_role=arn:aws:iam::<aws-account-id>:role/<role-name>'
region '<region>'
options;

# Write
unload ('select * from venue')
to 's3://mybucket/tickit/unload/venue_'
iam_role default;
```
### Dynamo

[https://docs.aws.amazon.com/redshift/latest/dg/t\_Loading-data-from-dynamodb.html](https://docs.aws.amazon.com/redshift/latest/dg/t\_Loading-data-from-dynamodb.html)ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€**DynamoDBã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—**ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
```sql
copy favoritemovies
from 'dynamodb://ProductCatalog'
iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';
```
{% hint style="warning" %}
ãƒ‡ãƒ¼ã‚¿ã‚’æä¾›ã™ã‚‹Amazon DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã€[REGION](https://docs.aws.amazon.com/redshift/latest/dg/copy-parameters-data-source-s3.html#copy-region)ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€Amazon DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹AWSãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ãªã„é™ã‚Šã€ã‚¯ãƒ©ã‚¹ã‚¿ã¨åŒã˜AWSãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

### EMR

[https://docs.aws.amazon.com/redshift/latest/dg/loading-data-from-emr.html](https://docs.aws.amazon.com/redshift/latest/dg/loading-data-from-emr.html)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* ã‚‚ã—ã‚‚ã‚ãªãŸã®**ä¼šç¤¾ã‚’HackTricksã§å®£ä¼ã—ãŸã„**å ´åˆã‚„ã€**æœ€æ–°ç‰ˆã®PEASSã‚„HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **HackTricks**ã¨**HackTricks Cloud**ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
