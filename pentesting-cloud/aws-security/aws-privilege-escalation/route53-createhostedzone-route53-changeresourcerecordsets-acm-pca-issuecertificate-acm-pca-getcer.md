# AWS - Escalaci贸n de Privilegios en Route53

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Red Team de HackTricks para AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

Para m谩s informaci贸n sobre Route53 consulta:

{% content-ref url="../aws-services/aws-route53-enum.md" %}
[aws-route53-enum.md](../aws-services/aws-route53-enum.md)
{% endcontent-ref %}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

{% hint style="info" %}
Para realizar este ataque, la cuenta objetivo ya debe tener configurada una [**Autoridad de Certificaci贸n Privada del Administrador de Certificados de AWS**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** en la cuenta, y las instancias EC2 en los VPC(s) deben haber importado ya los certificados para confiar en ella. Con esta infraestructura en su lugar, se puede realizar el siguiente ataque para interceptar el tr谩fico de la API de AWS.
{% endhint %}

Otros permisos **recomendados pero no necesarios para la parte de enumeraci贸n**: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Suponiendo que hay un VPC de AWS con m煤ltiples aplicaciones nativas de la nube comunic谩ndose entre s铆 y con la API de AWS. Dado que la comunicaci贸n entre los microservicios a menudo est谩 cifrada con TLS, debe haber una CA privada para emitir los certificados v谩lidos para esos servicios. **Si se utiliza ACM-PCA** para eso y el adversario logra **acceder para controlar tanto route53 como la CA privada de acm-pca** con el conjunto m铆nimo de permisos descritos anteriormente, puede **secuestrar las llamadas de la aplicaci贸n a la API de AWS** tomando control de sus permisos IAM.

Esto es posible porque:

* Los SDKs de AWS no tienen [Pinning de Certificados](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning)
* Route53 permite crear Zona Privada Alojada y registros DNS para nombres de dominio de las APIs de AWS
* La CA Privada en ACM-PCA no puede ser restringida para firmar solo certificados para Nombres Comunes espec铆ficos

**Impacto Potencial:** Escalaci贸n de privilegios indirecta interceptando informaci贸n sensible en el tr谩fico.

#### Explotaci贸n <a href="#discovery" id="discovery"></a>

Encuentra los pasos de explotaci贸n en la investigaci贸n original: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Red Team de HackTricks para AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
