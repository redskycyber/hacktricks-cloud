# route53:CreateHostedZone, route53:ChangeResourceRecordSets, acm-pca:IssueCertificate, acm-pca:GetCer

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

**ç ”ç©¶å†…å®¹å¤åˆ¶è‡ªï¼š** [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)****

## åŠ«æŒAWS APIè°ƒç”¨

### ä½¿ç”¨Route53ä¿®æ”¹å’ŒACM-PCAè¯ä¹¦

å‘å¸ƒäº2022å¹´3æœˆ11æ—¥

ä¸ä¹…å‰ï¼Œæˆ‘å¯¹AWSä¸­å¯èƒ½çš„ä¸­é—´äººæ”»å‡»å¨èƒè¿›è¡Œäº†ä¸€äº›ç ”ç©¶ã€‚è¿™ç¯‡åšå®¢æ–‡ç« æè¿°äº†è¿™é¡¹ç ”ç©¶çš„ç»“æœï¼Œå¹¶å±•ç¤ºäº†ä¸€ç§åœ¨AWS VPCä¸­æå‡IAMæƒé™çš„æœ‰è¶£æ–¹æ³•ã€‚

è®©æˆ‘ä»¬ä»æ”»å‡»è€…æ¥ç®¡å…è®¸å¯¹Route53è¿›è¡Œä¿®æ”¹å¹¶ä»ACM-PCAç­¾å‘ç”±ç§æœ‰CAç­¾åçš„è¯ä¹¦çš„IAMè§’è‰²çš„å…ˆå†³æ¡ä»¶å¼€å§‹ã€‚

è§’è‰²å¿…é¡»å…·å¤‡çš„æœ€ä½IAMæƒé™ä»¥è¿›è¡Œç›¸åŒçš„åˆ©ç”¨æ˜¯ï¼š
```
route53:CreateHostedZone
route53:ChangeResourceRecordSets
acm-pca:IssueCertificate
acm-pca:GetCertificate
```
å…¶ä»–å¯¹æšä¸¾æœ‰ç”¨ä½†ä¸æ˜¯å¿…éœ€çš„IAMæƒé™åŒ…æ‹¬ï¼š
```
route53:GetHostedZone
route53:ListHostedZones
acm-pca:ListCertificateAuthorities
ec2:DescribeVpcs
```
### å‘ç° <a href="#discovery" id="discovery"></a>

å‘ç°å§‹äºå°è¯•ä½¿ç”¨route53ï¼Œé¦–å…ˆä¸ºamazonaws.comåˆ›å»ºæ‰˜ç®¡åŒºåŸŸï¼Œä½†å¤±è´¥äº†ï¼š

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_1.png)

æˆ‘å°è¯•äº†å¯¹us-east-1.amazonaws.comè¿›è¡ŒåŒæ ·çš„æ“ä½œï¼Œç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_2.png)

ä½†ä»¤æˆ‘æƒŠè®¶çš„æ˜¯ï¼Œsecretsmanager.us-east-1.amazonaws.comå´æˆåŠŸäº†ï¼š

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_3.png)

ç°åœ¨ï¼Œå¯ä»¥ä¸ºsecretsmanager.us-east-1.amazonaws.comåˆ›å»ºä¸€ä¸ªæŒ‡å‘VPCå†…éƒ¨æŸä¸ªIPçš„Aè®°å½•ï¼š

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_4.png)

æ¨¡æ‹Ÿå—å®³è€…åœ¨å—å®³æœºå™¨ä¸Šåˆ—å‡ºç§˜å¯†ï¼Œåœ¨æ”»å‡»è€…çš„æœºå™¨ä¸Šï¼Œæˆ‘ä»¬æ¥æ”¶åˆ°çš„æ˜¯TLSåŠ å¯†çš„æµé‡ï¼š

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_5.png)

é€šä¿¡æ˜¯TLSåŠ å¯†çš„ï¼Œä½†å¦‚æœVPCä¸­çš„åº”ç”¨ç¨‹åºä¿¡ä»»ACM-PCAç®¡ç†çš„ç§æœ‰CAï¼Œå¹¶ä¸”æ”»å‡»è€…æœ‰æƒé™æ§åˆ¶ACM-PCAä¸­çš„ç§æœ‰CAï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½è¿›è¡Œå®Œå…¨çš„ä¸­é—´äººæ”»å‡»å¹¶æå‡IAMæƒé™ã€‚

### åˆ©ç”¨ <a href="#exploitation" id="exploitation"></a>

æ‚¨å¯ä»¥åœ¨è¿™é‡Œè§‚çœ‹æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ï¼š

[https://youtu.be/I-IakgPyEtk](https://youtu.be/I-IakgPyEtk)

å¦‚æœæ‚¨æ›´å–œæ¬¢é˜…è¯»å¹¶æŸ¥çœ‹æˆªå›¾ï¼Œè¯·ç»§ç»­ã€‚

ä¸ºäº†æ¼”ç¤ºç›®çš„ï¼Œå‡è®¾æ”»å‡»è€…å·²ç»æ”»ç ´äº†ä¸€ä¸ªå…·æœ‰ä»¥ä¸‹IAMè§’è‰²çš„ec2ï¼š

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_7.png)

åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œec2ä¸åº”è¯¥æ‹¥æœ‰å¦‚æ­¤å¹¿æ³›çš„æƒé™ï¼Œä½†ä½ å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å¼€å‘è€…æˆ–DevOpsè§’è‰²æ‹¥æœ‰è¿™æ ·çš„æƒé™ã€‚

è¢«æ”»ç ´çš„ec2æ‹¥æœ‰ç‰¹æƒIAMè§’è‰²ï¼Œå†…éƒ¨IPä¸º10.0.0.87ï¼Œå—å®³è€…åº”ç”¨ç¨‹åºè¿è¡Œåœ¨IPä¸º10.0.0.224çš„ec2ä¸Šã€‚

ç°åœ¨åœ¨æ”»å‡»è€…æ‹¥æœ‰çš„æœºå™¨ä¸Šï¼Œæˆ‘ä»¬ä¸ºsecretsmanager.us-east-1.amazonaws.comåˆ›å»ºæ‰˜ç®¡åŒºåŸŸï¼š

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_8.png)

ç„¶åè®¾ç½®ä¸€ä¸ªæŒ‡å‘10.0.0.87çš„secretsmanager.us-east-1.amazonaws.comçš„Aè®°å½•ï¼š

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_9.png)

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_10.png)

æˆ‘ä»¬çŸ¥é“ACM-PCAä¸­å®šä¹‰äº†ä¸€ä¸ªç§æœ‰CAï¼š

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_11.png)

è¿è¡Œåœ¨å—å®³æœºå™¨ï¼ˆ10.0.0.224ï¼‰ä¸Šçš„Javaåº”ç”¨ç¨‹åºä¿¡ä»»è¿™ä¸ªç§æœ‰CAæ¥ç­¾ç½²ç½‘ç»œæœåŠ¡è¯ä¹¦ã€‚ç§æœ‰CAåœ¨Java TrustStoreä¸­ã€‚

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_12.png)

ç°åœ¨åœ¨æ”»å‡»è€…çš„æœºå™¨ä¸Šï¼Œæˆ‘ä»¬ç”Ÿæˆç§é’¥å’ŒCSRã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨acm-caæ¥ç­¾å‘ä¸€ä¸ªç”±ç§æœ‰CAç­¾åçš„è¯ä¹¦ã€‚APIä»¥ç­¾åè¯ä¹¦ARNå“åº”ï¼š ![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_13.png) ![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_14.png)

ç„¶åï¼Œæ”»å‡»è€…ä»ACM-PCAæ£€ç´¢ç­¾åè¯ä¹¦ï¼š

![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_15.png)

ä¸ºäº†æ¨¡æ‹Ÿå—å®³è€…æœºå™¨ä¸Šçš„Javaåº”ç”¨ç¨‹åºå¯¹Secrets Managerçš„è°ƒç”¨ï¼Œæˆ‘é€šè¿‡mavenè¿è¡Œäº†JUnitæµ‹è¯•ï¼Œåœ¨ä¸‹é¢çš„æˆªå›¾ä¸­ä½ å¯ä»¥çœ‹åˆ°æ²¡æœ‰å¼‚å¸¸ï¼Œè¿™æ„å‘³ç€è¯ä¹¦æ˜¯å—ä¿¡ä»»çš„ï¼š ![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_16.png)

æœ€åï¼Œåœ¨ncatç›‘å¬å™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”±Javaåº”ç”¨ç¨‹åºçš„AWS SDKå‘é€çš„HTTPè¯·æ±‚ã€‚ ![aws\_hijack](https://github.com/niebardzo/niebardzo.github.io/raw/master/img/2022-03-11-aws-hijack\_17.png)

å¦‚ä½•ä½¿ç”¨è¿™ç§æ–¹æ³•æå‡IAMæƒé™ï¼Ÿæˆ‘ä»¬æ²¡æœ‰æƒé™å¯¹ä»»ä½•s3å¯¹è±¡æ‰§è¡Œs3:GetObjectæˆ–å¯¹secretsmanageræ‰§è¡Œsecretsmanager:GetSecretValueï¼Œä½†å¦‚æœæˆ‘ä»¬å—…æ¢åˆ°S3æˆ–secretsmanagerçš„æµé‡ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°ç›¸åº”çš„VPCEï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å¯¹å­˜å‚¨åœ¨S3ä¸­çš„å¯¹è±¡æˆ–å­˜å‚¨åœ¨secretsmanagerä¸­çš„ç§˜å¯†çš„è®¿é—®æƒé™ã€‚
### ç»“è®º <a href="#conclusions" id="conclusions"></a>

å»ºè®®é¿å…å¯¹äºåˆ›å»ºç§æœ‰æ‰˜ç®¡åŒºåŸŸæˆ–ä¸å—é™çš„route53:ChangeResourceRecordSetsæˆäºˆè¿‡å®½çš„route53 IAMæƒé™ã€‚ç”±äºACM-PCAä¸å…è®¸å¯¹ç§æœ‰CAå¯ä»¥ç­¾åå“ªä¸ªåŸŸçš„è¯ä¹¦æ–½åŠ é™åˆ¶ï¼Œå› æ­¤ä¹Ÿå»ºè®®ç‰¹åˆ«æ³¨æ„acm-pca:IssueCertificate IAMæƒé™ã€‚

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWSçº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
