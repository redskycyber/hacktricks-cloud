# AWS - Codepipeline Privesc

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## codepipeline

Para m谩s informaci贸n sobre codepipeline revisa:

{% content-ref url="../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md" %}
[aws-datapipeline-codepipeline-codebuild-and-codecommit.md](../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md)
{% endcontent-ref %}

### `iam:PassRole`, `codepipeline:CreatePipeline`, `codebuild:CreateProject, codepipeline:StartPipelineExecution`

Al crear un code pipeline puedes indicar un **rol IAM de codepipeline para ejecutar**, por lo tanto, podr铆as comprometerlos.

Adem谩s de los permisos anteriores necesitar铆as **acceso al lugar donde se almacena el c贸digo** (S3, ECR, github, bitbucket...)

Prob茅 esto haciendo el proceso en la p谩gina web, los permisos indicados anteriormente son los que no son de List/Get necesarios para crear un codepipeline, pero para crearlo en la web tambi茅n necesitar谩s: `codebuild:ListCuratedEnvironmentImages, codebuild:ListProjects, codebuild:ListRepositories, codecommit:ListRepositories, events:PutTargets, codepipeline:ListPipelines, events:PutRule, codepipeline:ListActionTypes, cloudtrail:<varios>`

Durante la **creaci贸n del proyecto de compilaci贸n** puedes indicar un **comando para ejecutar** (驴rev shell?) y ejecutar la fase de compilaci贸n como **usuario privilegiado**, esa es la configuraci贸n que el atacante necesita para comprometer:

![](<../../../.gitbook/assets/image (53).png>)

![](<../../../.gitbook/assets/image (64).png>)

### ?`codebuild:UpdateProject, codepipeline:UpdatePipeline, codepipeline:StartPipelineExecution`

Podr铆a ser posible modificar el rol utilizado y el comando ejecutado en un codepipeline con los permisos anteriores.

### `codepipeline:pollforjobs`

[AWS menciona](https://docs.aws.amazon.com/codepipeline/latest/APIReference/API\_PollForJobs.html):

> Cuando se llama a esta API, CodePipeline **devuelve credenciales temporales para el bucket de S3** utilizado para almacenar artefactos para el pipeline, si la acci贸n requiere acceso a ese bucket de S3 para artefactos de entrada o salida. Esta API tambi茅n **devuelve cualquier valor secreto definido para la acci贸n**.

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
