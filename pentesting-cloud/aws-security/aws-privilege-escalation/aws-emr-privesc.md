# AWS - Î‘Î½Î­Î²Î±ÏƒÎ¼Î± Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ EMR

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ hacking ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î•Î¬Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± hacking tricks ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>

## EMR

Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ **Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ EMR** ÏƒÏ„Î¿:

{% content-ref url="../aws-services/aws-emr-enum.md" %}
[aws-emr-enum.md](../aws-services/aws-emr-enum.md)
{% endcontent-ref %}

### `iam:PassRole`, `elasticmapreduce:RunJobFlow`

ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Îµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î­Î½Î± Î½Î­Î¿ cluster EMR ÎµÏ€Î¹ÏƒÏ…Î½Î¬Ï€Ï„Î¿Î½Ï„Î±Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚ EC2** ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÎ¹ Î½Î± ÎºÎ»Î­ÏˆÎµÎ¹ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î¬ Ï„Î¿Ï….\
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î³Î¹Î± Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÏ„Îµ Î±Ï…Ï„ÏŒ Î¸Î± Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ Î½Î± **Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î¿ Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏŒ ÎºÎ»ÎµÎ¹Î´Î¯ ssh Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ ÎµÎ¹ÏƒÎ±Ï‡Î¸ÎµÎ¯ ÏƒÏ„Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ** Î® Î½Î± ÎµÎ¹ÏƒÎ±Î³Î¬Î³ÎµÏ„Îµ Î­Î½Î±, ÎºÎ±Î¹ Î½Î± ÎµÎ¯ÏƒÏ„Îµ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± **Î±Î½Î¿Î¯Î¾ÎµÏ„Îµ Ï„Î· Î¸ÏÏÎ± 22 ÏƒÏ„Î¿Î½ ÎºÏÏÎ¹Î¿ ÎºÏŒÎ¼Î²Î¿** (Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÏ„Îµ Î±Ï…Ï„ÏŒ Î¼Îµ Ï„Î± Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬ `EmrManagedMasterSecurityGroup` ÎºÎ±Î¹/Î® `ServiceAccessSecurityGroup` Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ `--ec2-attributes`).
```bash
# Import EC2 ssh key (you will need extra permissions for this)
ssh-keygen -b 2048 -t rsa -f /tmp/sshkey -q -N ""
chmod 400 /tmp/sshkey
base64 /tmp/sshkey.pub > /tmp/pub.key
aws ec2 import-key-pair \
--key-name "privesc" \
--public-key-material file:///tmp/pub.key


aws emr create-cluster \
--release-label emr-5.15.0 \
--instance-type m4.large \
--instance-count 1 \
--service-role EMR_DefaultRole \
--ec2-attributes InstanceProfile=EMR_EC2_DefaultRole,KeyName=privesc

# Wait 1min and connect via ssh to an EC2 instance of the cluster)
aws emr describe-cluster --cluster-id <id>
# In MasterPublicDnsName you can find the DNS to connect to the master instance
## You cna also get this info listing EC2 instances
```
Î Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÏ„Îµ Ï€ÏÏ‚ Î­Î½Î±Ï‚ **ÏÏŒÎ»Î¿Ï‚ EMR** ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ `--service-role` ÎºÎ±Î¹ Î­Î½Î±Ï‚ **ÏÏŒÎ»Î¿Ï‚ ec2** ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ `--ec2-attributes` Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ `InstanceProfile`. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î±Ï…Ï„Î® Î· Ï„ÎµÏ‡Î½Î¹ÎºÎ® ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î¼ÏŒÎ½Î¿ Ï„Î·Î½ ÎºÎ»Î¿Ï€Î® Ï„Ï‰Î½ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î·ÏÎ¯Ï‰Î½ Ï„Î¿Ï… ÏÏŒÎ»Î¿Ï… EC2 (ÎºÎ±Î¸ÏÏ‚ Î¸Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Î¼Î­ÏƒÏ‰ ssh) ÎºÎ±Î¹ ÏŒÏ‡Î¹ Ï„Î¿Ï… IAM ÏÏŒÎ»Î¿Ï… Ï„Î¿Ï… EMR.

**Î Î¹Î¸Î±Î½Î­Ï‚ Î•Ï€Î¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚:** Î‘Î½Î­Î²Î±ÏƒÎ¼Î± ÏƒÏ„Î¿Î½ ÏÏŒÎ»Î¿ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ EC2 Ï€Î¿Ï… ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹.

### `elasticmapreduce:CreateEditor`, `iam:ListRoles`, `elasticmapreduce:ListClusters`, `iam:PassRole`, `elasticmapreduce:DescribeEditor`, `elasticmapreduce:OpenEditorInConsole`

ÎœÎµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¼ÎµÏ„Î±Î²ÎµÎ¯ ÏƒÏ„Î¿ **AWS console**, Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± Notebook ÎºÎ±Î¹ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï…Ï„ÏŒ Î³Î¹Î± Î½Î± ÎºÎ»Î­ÏˆÎµÎ¹ Ï„Î¿Î½ IAM ÏÏŒÎ»Î¿.

{% hint style="danger" %}
Î‘ÎºÏŒÎ¼Î± ÎºÎ¹ Î±Î½ ÎµÏ€Î¹ÏƒÏ…Î½Î¬ÏˆÎµÏ„Îµ Î­Î½Î±Î½ IAM ÏÏŒÎ»Î¿ ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï„Î¿Ï… notebook ÏƒÏ„Î¹Ï‚ Î´Î¿ÎºÎ¹Î¼Î­Ï‚ Î¼Î¿Ï… Ï€Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ± ÏŒÏ„Î¹ Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ± Î½Î± ÎºÎ»Î­ÏˆÏ‰ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± AWS ÎºÎ±Î¹ ÏŒÏ‡Î¹ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶Î¿Î½Ï„Î±Î¹ Î¼Îµ Ï„Î¿Î½ ÏƒÏ‡ÎµÏ„Î¹ÎºÏŒ ÏÏŒÎ»Î¿ IAM.
{% endhint %}

**Î Î¹Î¸Î±Î½Î­Ï‚ Î•Ï€Î¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚:** Î‘Î½Î­Î²Î±ÏƒÎ¼Î± ÏƒÏ„Î¿Î½ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î¿ ÏÏŒÎ»Î¿ AWS arn:aws:iam::420254708011:instance-profile/prod-EditorInstanceProfile

### `elasticmapreduce:OpenEditorInConsole`

ÎœÏŒÎ½Î¿ Î¼Îµ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ Î¬Î´ÎµÎ¹Î±, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ **Jupyter Notebook ÎºÎ±Î¹ Î½Î± ÎºÎ»Î­ÏˆÎµÎ¹ Ï„Î¿Î½ IAM ÏÏŒÎ»Î¿** Ï€Î¿Ï… Ï„Î¿Ï… Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯.\
Î— Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· URL Ï„Î¿Ï… notebook ÎµÎ¯Î½Î±Î¹ `https://<notebook-id>.emrnotebooks-prod.eu-west-1.amazonaws.com/<notebook-id>/lab/`

{% hint style="danger" %}
Î‘ÎºÏŒÎ¼Î± ÎºÎ¹ Î±Î½ ÎµÏ€Î¹ÏƒÏ…Î½Î¬ÏˆÎµÏ„Îµ Î­Î½Î±Î½ IAM ÏÏŒÎ»Î¿ ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï„Î¿Ï… notebook ÏƒÏ„Î¹Ï‚ Î´Î¿ÎºÎ¹Î¼Î­Ï‚ Î¼Î¿Ï… Ï€Î±ÏÎ±Ï„Î®ÏÎ·ÏƒÎ± ÏŒÏ„Î¹ Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ± Î½Î± ÎºÎ»Î­ÏˆÏ‰ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± AWS ÎºÎ±Î¹ ÏŒÏ‡Î¹ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶Î¿Î½Ï„Î±Î¹ Î¼Îµ Ï„Î¿Î½ ÏƒÏ‡ÎµÏ„Î¹ÎºÏŒ ÏÏŒÎ»Î¿ IAM`.
{% endhint %}

**Î Î¹Î¸Î±Î½Î­Ï‚ Î•Ï€Î¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚:** Î‘Î½Î­Î²Î±ÏƒÎ¼Î± ÏƒÏ„Î¿Î½ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î¿ ÏÏŒÎ»Î¿ AWS arn:aws:iam::420254708011:instance-profile/prod-EditorInstanceProfile

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ hacking ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î•Î¬Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks Î® Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF, ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Î³Î¹Î± Ï„Î¿ hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>
