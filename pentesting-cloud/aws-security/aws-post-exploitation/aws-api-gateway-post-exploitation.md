# AWS - API Gateway SonrasÄ± SÄ±zma

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olacak ÅŸekilde AWS hacklemeyi Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## API Gateway

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="../aws-services/aws-api-gateway-enum.md" %}
[aws-api-gateway-enum.md](../aws-services/aws-api-gateway-enum.md)
{% endcontent-ref %}

### EriÅŸimi olmayan API'lere EriÅŸim

[https://us-east-1.console.aws.amazon.com/vpc/home#CreateVpcEndpoint](https://us-east-1.console.aws.amazon.com/vpc/home?region=us-east-1#CreateVpcEndpoint:) adresinde `com.amazonaws.us-east-1.execute-api` hizmeti ile bir uÃ§ nokta oluÅŸturabilir, uÃ§ noktayÄ± eriÅŸiminizin olduÄŸu bir aÄŸda (muhtemelen bir EC2 makinesi aracÄ±lÄ±ÄŸÄ±yla) aÃ§abilir ve tÃ¼m baÄŸlantÄ±lara izin veren bir gÃ¼venlik grubu atayabilirsiniz.\
ArdÄ±ndan, EC2 makinesinden uÃ§ noktaya eriÅŸebilir ve dolayÄ±sÄ±yla daha Ã¶nce aÃ§Ä±lmamÄ±ÅŸ olan gateway API'sÄ±nÄ± Ã§aÄŸÄ±rabilirsiniz.

### KullanÄ±m PlanlarÄ± DoS

**NumaralandÄ±rma** bÃ¶lÃ¼mÃ¼nde **anahtarlarÄ±n kullanÄ±m planÄ±nÄ± nasÄ±l alacaÄŸÄ±nÄ±zÄ±** gÃ¶rebilirsiniz. EÄŸer anahtara sahipseniz ve aylÄ±k olarak X kullanÄ±ma **sÄ±nÄ±rlÄ±ysa**, sadece kullanarak bir DoS saldÄ±rÄ±sÄ±na neden olabilirsiniz.

**API AnahtarÄ±** sadece **`x-api-key`** adÄ±nda bir **HTTP baÅŸlÄ±ÄŸÄ±** iÃ§inde **yer almalÄ±dÄ±r**.

### `apigateway:UpdateGatewayResponse`, `apigateway:CreateDeployment`

`apigateway:UpdateGatewayResponse` ve `apigateway:CreateDeployment` izinlerine sahip bir saldÄ±rgan, **mevcut bir Gateway Response'u deÄŸiÅŸtirerek hassas bilgileri sÄ±zdÄ±ran veya kÃ¶tÃ¼ amaÃ§lÄ± betikler Ã§alÄ±ÅŸtÄ±ran Ã¶zel baÅŸlÄ±klar veya yanÄ±t ÅŸablonlarÄ± ekleyebilir**.

{% code overflow="wrap" %}
```bash
API_ID="your-api-id"
RESPONSE_TYPE="DEFAULT_4XX"

# Update the Gateway Response
aws apigateway update-gateway-response --rest-api-id $API_ID --response-type $RESPONSE_TYPE --patch-operations op=replace,path=/responseTemplates/application~1json,value="{\"message\":\"$context.error.message\", \"malicious_header\":\"malicious_value\"}"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
{% endcode %}

**Potansiyel Etki**: Hassas bilgilerin sÄ±zdÄ±rÄ±lmasÄ±, kÃ¶tÃ¼ amaÃ§lÄ± betiklerin yÃ¼rÃ¼tÃ¼lmesi veya API kaynaklarÄ±na izinsiz eriÅŸim.

{% hint style="info" %}
Test edilmesi gerekmektedir
{% endhint %}

### `apigateway:UpdateStage`, `apigateway:CreateDeployment`

`apigateway:UpdateStage` ve `apigateway:CreateDeployment` izinlerine sahip bir saldÄ±rgan, **mevcut bir API Gateway aÅŸamasÄ±nÄ± deÄŸiÅŸtirerek trafiÄŸi farklÄ± bir aÅŸamaya yÃ¶nlendirebilir veya Ã¶nbellek ayarlarÄ±nÄ± deÄŸiÅŸtirerek Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ verilere izinsiz eriÅŸim saÄŸlayabilir**.

{% code overflow="wrap" %}
```bash
API_ID="your-api-id"
STAGE_NAME="Prod"

# Update the API Gateway stage
aws apigateway update-stage --rest-api-id $API_ID --stage-name $STAGE_NAME --patch-operations op=replace,path=/cacheClusterEnabled,value=true,op=replace,path=/cacheClusterSize,value="0.5"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
{% endcode %}

**Potansiyel Etki**: Ã–n belleÄŸe alÄ±nmÄ±ÅŸ verilere izinsiz eriÅŸim, API trafiÄŸini bozmak veya onu ele geÃ§irmek.

{% hint style="info" %}
Test edilmesi gerekmektedir
{% endhint %}

### `apigateway:PutMethodResponse`, `apigateway:CreateDeployment`

`apigateway:PutMethodResponse` ve `apigateway:CreateDeployment` izinlerine sahip bir saldÄ±rgan, **mevcut bir API Gateway REST API yÃ¶nteminin yÃ¶ntem yanÄ±tÄ±nÄ± deÄŸiÅŸtirerek hassas bilgiler sÄ±zdÄ±ran veya kÃ¶tÃ¼ amaÃ§lÄ± betikler Ã§alÄ±ÅŸtÄ±ran Ã¶zel baÅŸlÄ±klar veya yanÄ±t ÅŸablonlarÄ± ekleyebilir**.
```bash
API_ID="your-api-id"
RESOURCE_ID="your-resource-id"
HTTP_METHOD="GET"
STATUS_CODE="200"

# Update the method response
aws apigateway put-method-response --rest-api-id $API_ID --resource-id $RESOURCE_ID --http-method $HTTP_METHOD --status-code $STATUS_CODE --response-parameters "method.response.header.malicious_header=true"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
**Potansiyel Etki**: Hassas bilgilerin sÄ±zdÄ±rÄ±lmasÄ±, kÃ¶tÃ¼ amaÃ§lÄ± komut dosyalarÄ±nÄ±n yÃ¼rÃ¼tÃ¼lmesi veya API kaynaklarÄ±na izinsiz eriÅŸim.

{% hint style="info" %}
Test edilmesi gerekiyor
{% endhint %}

### `apigateway:UpdateRestApi`, `apigateway:CreateDeployment`

`apigateway:UpdateRestApi` ve `apigateway:CreateDeployment` izinlerine sahip bir saldÄ±rgan, **API Gateway REST API ayarlarÄ±nÄ± deÄŸiÅŸtirerek gÃ¼nlÃ¼ÄŸÃ¼ devre dÄ±ÅŸÄ± bÄ±rakabilir veya minimum TLS sÃ¼rÃ¼mÃ¼nÃ¼ deÄŸiÅŸtirerek API'nin gÃ¼venliÄŸini zayÄ±flatabilir**.
```bash
API_ID="your-api-id"

# Update the REST API settings
aws apigateway update-rest-api --rest-api-id $API_ID --patch-operations op=replace,path=/minimumTlsVersion,value='TLS_1.0',op=replace,path=/apiKeySource,value='AUTHORIZER'

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
**Potansiyel Etki**: API'nin gÃ¼venliÄŸini zayÄ±flatma, yetkisiz eriÅŸime izin verme veya hassas bilgilerin ortaya Ã§Ä±kmasÄ±na neden olma potansiyeli.

{% hint style="info" %}
Test edilmesi gerekiyor
{% endhint %}

### `apigateway:CreateApiKey`, `apigateway:UpdateApiKey`, `apigateway:CreateUsagePlan`, `apigateway:CreateUsagePlanKey`

Ä°zinlere sahip bir saldÄ±rgan, `apigateway:CreateApiKey`, `apigateway:UpdateApiKey`, `apigateway:CreateUsagePlan` ve `apigateway:CreateUsagePlanKey` ile **yeni API anahtarlarÄ± oluÅŸturabilir, bunlarÄ± kullanÄ±m planlarÄ±yla iliÅŸkilendirebilir ve ardÄ±ndan bu anahtarlarÄ± yetkisiz API eriÅŸimi iÃ§in kullanabilir**.
```bash
# Create a new API key
API_KEY=$(aws apigateway create-api-key --enabled --output text --query 'id')

# Create a new usage plan
USAGE_PLAN=$(aws apigateway create-usage-plan --name "MaliciousUsagePlan" --output text --query 'id')

# Associate the API key with the usage plan
aws apigateway create-usage-plan-key --usage-plan-id $USAGE_PLAN --key-id $API_KEY --key-type API_KEY
```
**Potansiyel Etki**: API kaynaklarÄ±na izinsiz eriÅŸim, gÃ¼venlik kontrollerini atlatma.

{% hint style="info" %}
Test yapÄ±lmasÄ± gerekmektedir
{% endhint %}

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hacklemeyi Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>
