# AWS - Explotaci贸n Posterior de S3

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de HackTricks en AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## S3

Para obtener m谩s informaci贸n, consulta:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Informaci贸n Sensible

A veces podr谩s encontrar informaci贸n sensible legible en los buckets. Por ejemplo, secretos de estado de terraform.

### Pivotaje

Diferentes plataformas podr铆an estar utilizando S3 para almacenar activos sensibles.\
Por ejemplo, **airflow** podr铆a estar almacenando **c贸digo DAGs** all铆, o las **p谩ginas web** podr铆an ser servidas directamente desde S3. Un atacante con permisos de escritura podr铆a **modificar el c贸digo** del bucket para **pivotar** hacia otras plataformas, o **apoderarse de cuentas** modificando archivos JS.

### Ransomware en S3

En este escenario, el **atacante crea una clave KMS (Key Management Service) en su propia cuenta de AWS** u otra cuenta comprometida. Luego hace que esta **clave sea accesible para cualquier persona en el mundo**, permitiendo que cualquier usuario, rol o cuenta de AWS cifre objetos usando esta clave. Sin embargo, los objetos no pueden ser descifrados.

El atacante identifica un **bucket de S3 como objetivo y obtiene acceso de nivel de escritura** a 茅l utilizando varios m茅todos. Esto podr铆a deberse a una configuraci贸n deficiente del bucket que lo expone p煤blicamente o al atacante obteniendo acceso al entorno de AWS en s铆. El atacante suele apuntar a buckets que contienen informaci贸n sensible como informaci贸n de identificaci贸n personal (PII), informaci贸n de salud protegida (PHI), registros, copias de seguridad y m谩s.

Para determinar si el bucket puede ser objetivo de ransomware, el atacante verifica su configuraci贸n. Esto incluye verificar si se ha habilitado **la versi贸n de objetos de S3** y si se ha habilitado **la eliminaci贸n con autenticaci贸n multifactor (MFA delete)**. Si la versi贸n de objetos no est谩 habilitada, el atacante puede proceder. Si la versi贸n de objetos est谩 habilitada pero la eliminaci贸n con MFA est谩 deshabilitada, el atacante puede **deshabilitar la versi贸n de objetos**. Si tanto la versi贸n de objetos como la eliminaci贸n con MFA est谩n habilitadas, se vuelve m谩s dif铆cil para el atacante hacer ransomware en ese bucket espec铆fico.

Utilizando la API de AWS, el atacante **reemplaza cada objeto en el bucket con una copia cifrada usando su clave KMS**. Esto cifra efectivamente los datos en el bucket, haci茅ndolos inaccesibles sin la clave.

Para ejercer m谩s presi贸n, el atacante programa la eliminaci贸n de la clave KMS utilizada en el ataque. Esto le da al objetivo una ventana de 7 d铆as para recuperar sus datos antes de que se elimine la clave y los datos se pierdan permanentemente.

Finalmente, el atacante podr铆a cargar un archivo final, generalmente llamado "ransom-note.txt", que contiene instrucciones para el objetivo sobre c贸mo recuperar sus archivos. Este archivo se carga sin cifrado, probablemente para llamar la atenci贸n del objetivo y hacerle saber del ataque de ransomware.

**Para m谩s informaci贸n** [**consulta la investigaci贸n original**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de HackTricks en AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
