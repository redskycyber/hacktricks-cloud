# AWS - SSM äº‹ååˆ©ç”¨

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## MitM SSM

### æ‹¦æˆªå‘é€åˆ°EC2å®ä¾‹çš„SSMæ¶ˆæ¯ <a href="#intercept-ec2-messages" id="intercept-ec2-messages"></a>

æ‹¥æœ‰EC2å®ä¾‹çš„IAMå‡­è¯ï¼Œæ‚¨å¯ä»¥æ‹¦æˆªEC2æ¶ˆæ¯å’ŒSSMä¼šè¯ï¼Œå› ä¸ºSSMçš„è®¤è¯å¤„ç†æ–¹å¼ã€‚

[**SSM Agent**](https://github.com/aws/amazon-ssm-agent) æŒç»­è°ƒç”¨ **`ec2messages:GetMessages`**ï¼Œä¿æŒ**è¿æ¥å¼€æ”¾** **20ç§’**ã€‚å¦‚æœå‘é€äº†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€šè¿‡ [**`ssm:SendCommand`**](https://docs.aws.amazon.com/cli/latest/reference/ssm/send-command.html)ï¼Œå®ƒå°†é€šè¿‡è¿™ä¸ªå¼€æ”¾çš„è¿æ¥æ¥æ”¶ã€‚

**æ”»å‡»è€…**å¯ä»¥é€šè¿‡æ›´é¢‘ç¹åœ°è°ƒç”¨ **`ec2messages:GetMessages`** æ¥æ‹¦æˆªEC2æ¶ˆæ¯ã€‚è¿™ä¸ª[**æ¦‚å¿µéªŒè¯**](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-document-interception)é€šè¿‡ç›‘å¬send-commandæ¶ˆæ¯æ¥æ¼”ç¤ºè¿™ä¸€ç‚¹ã€‚æ”»å‡»è€…è¿˜å¯ä»¥**å‘é€ä»»ä½•ä»–ä»¬æƒ³è¦çš„å“åº”**ç»™è¿™äº›æ¶ˆæ¯ã€‚

æ”»å‡»è€…ä¹Ÿå¯ä»¥**å‘é€ä»»ä½•ä»–å–œæ¬¢çš„å“åº”**ç»™è¿™äº›æ¶ˆæ¯ã€‚

### æ‹¦æˆªSSMä¼šè¯æ¶ˆæ¯

è¿™æ›´å¤æ‚ï¼Œæ¶‰åŠå¤šä¸ªWebSocketè¿æ¥å’Œä¸€ä¸ªç‹¬ç‰¹çš„äºŒè¿›åˆ¶åè®®ã€‚å½“**SSM Agentå¯åŠ¨**æ—¶ï¼Œå®ƒ**åˆ›å»º**ä¸€ä¸ª**WebSocket**è¿æ¥åˆ°AWSã€‚å½“ç”¨æˆ·å¯åŠ¨ä¸€ä¸ªSSMä¼šè¯([ssm:StartSession](https://docs.aws.amazon.com/cli/latest/reference/ssm/start-session.html))æ—¶ï¼Œ**æ§åˆ¶é€šé“å¯åŠ¨ä¸€ä¸ªæ•°æ®é€šé“**ç”¨äºç”¨æˆ·-EC2å®ä¾‹é€šä¿¡ã€‚

SSM Agentçš„æºä»£ç ï¼Œå¯åœ¨[è¿™é‡Œ](https://github.com/aws/amazon-ssm-agent)æ‰¾åˆ°ï¼Œå¯ä»¥ç”¨æ¥åˆ¶ä½œäºŒè¿›åˆ¶æ ¼å¼çš„æ¶ˆæ¯ï¼Œå°±åƒ[è¿™æ ·](https://github.com/aws/amazon-ssm-agent/blob/21c85d674bbb44dd13cd8738d1b9d86658a6b18e/agent/session/contracts/agentmessage.go#L73)ã€‚

**æ‹¦æˆªSSMä¼šè¯æ¯”EC2æ¶ˆæ¯æ›´å¯é **ï¼Œå› ä¸º**æ§åˆ¶é€šé“æ˜¯é•¿æœŸå­˜åœ¨çš„**ï¼ŒAWSåªä¸**æœ€æ–°çš„ä¸€ä¸ª**é€šä¿¡ã€‚è¿™ä¸ª[æ¦‚å¿µéªŒè¯](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-session-interception)å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ§åˆ¶é€šé“å¹¶ä¸ä¼šè¯äº’åŠ¨ã€‚

ä»æ»¥ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œ**æ‹¦æˆªSSMä¼šè¯æ¯”EC2æ¶ˆæ¯æ›´å¯é **ã€‚åŸå› æ˜¯**æ§åˆ¶é€šé“æ˜¯é•¿æœŸå­˜åœ¨çš„**ï¼Œå°±åƒEC2æ¶ˆæ¯ä¸€æ ·ï¼ŒAWSåªä¼šä¸**æœ€æ–°çš„ä¸€ä¸ª**é€šä¿¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„æ§åˆ¶é€šé“å¹¶ç›‘å¬ä¼ å…¥çš„ä¼šè¯ã€‚ä½¿ç”¨SSM Agentæºä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¶ä½œäºŒè¿›åˆ¶æ ¼å¼çš„æ¶ˆæ¯ï¼ˆå¦‚æœä½ çœ‹[æ¦‚å¿µéªŒè¯](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-session-interception)ï¼Œä½ ä¼šæ³¨æ„åˆ°æˆ‘å®é™…ä¸Šåªæ˜¯å°†Goç¿»è¯‘æˆPythonï¼‰ï¼Œå¹¶ä¸ä¼šè¯äº’åŠ¨ã€‚

ä¹Ÿæœ‰å¯èƒ½çªƒå–å‘½ä»¤ï¼ˆ**æ•æ„Ÿä¿¡æ¯**ï¼‰å¹¶æä¾›æ”»å‡»è€…çš„è¾“å‡ºã€‚

## å‚è€ƒèµ„æ–™

* [https://frichetten.com/blog/ssm-agent-tomfoolery/](https://frichetten.com/blog/ssm-agent-tomfoolery/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
