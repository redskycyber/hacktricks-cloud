# AWS - SSMåæ¸—é€

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS Family**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„è´¦å· ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## MitM SSM

### æ‹¦æˆªå‘é€ç»™EC2å®ä¾‹çš„SSMæ¶ˆæ¯ <a href="#intercept-ec2-messages" id="intercept-ec2-messages"></a>

é€šè¿‡è·å¾—EC2å®ä¾‹çš„IAMå‡­è¯ï¼Œæ‚¨å¯ä»¥æ‹¦æˆªEC2æ¶ˆæ¯å’ŒSSMä¼šè¯ï¼Œè¿™æ˜¯ç”±äºSSMçš„èº«ä»½éªŒè¯å¤„ç†æ–¹å¼ã€‚

[**SSM Agent**](https://github.com/aws/amazon-ssm-agent)ä¸æ–­è°ƒç”¨**`ec2messages:GetMessages`**ï¼Œä¿æŒ**è¿æ¥æ‰“å¼€**20ç§’ã€‚å¦‚æœå‘é€äº†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€šè¿‡[**`ssm:SendCommand`**](https://docs.aws.amazon.com/cli/latest/reference/ssm/send-command.html)ï¼Œå®ƒå°†é€šè¿‡æ­¤æ‰“å¼€çš„è¿æ¥æ¥æ”¶åˆ°ã€‚

æ”»å‡»è€…å¯ä»¥é€šè¿‡æ›´é¢‘ç¹åœ°è°ƒç”¨**`ec2messages:GetMessages`**æ¥æ‹¦æˆªEC2æ¶ˆæ¯ã€‚è¿™ä¸ª[**æ¦‚å¿µéªŒè¯**](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-document-interception)æ¼”ç¤ºäº†é€šè¿‡ç›‘å¬å‘é€å‘½ä»¤æ¶ˆæ¯æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æ”»å‡»è€…è¿˜å¯ä»¥å‘æ¶ˆæ¯å‘é€ä»»ä½•å“åº”ã€‚

æ”»å‡»è€…è¿˜å¯ä»¥å‘æ¶ˆæ¯å‘é€ä»»ä½•å“åº”ã€‚

### æ‹¦æˆªSSMä¼šè¯æ¶ˆæ¯

è¿™æ›´å¤æ‚ï¼Œæ¶‰åŠå¤šä¸ªWebSocketè¿æ¥å’Œç‹¬ç‰¹çš„äºŒè¿›åˆ¶åè®®ã€‚å½“**SSM Agentå¯åŠ¨**æ—¶ï¼Œå®ƒä¼š**åˆ›å»º**ä¸AWSçš„**WebSocket**è¿æ¥ã€‚å½“ç”¨æˆ·å¯åŠ¨SSMä¼šè¯ï¼ˆ[ssm:StartSession](https://docs.aws.amazon.com/cli/latest/reference/ssm/start-session.html)ï¼‰æ—¶ï¼Œ**æ§åˆ¶é€šé“ä¼šä¸ºç”¨æˆ·-EC2å®ä¾‹é€šä¿¡**åˆå§‹åŒ–ä¸€ä¸ªæ•°æ®é€šé“ã€‚

SSM Agentçš„æºä»£ç ï¼Œå¯åœ¨[è¿™é‡Œ](https://github.com/aws/amazon-ssm-agent)æ‰¾åˆ°ï¼Œå¯ç”¨äºä»¥äºŒè¿›åˆ¶æ ¼å¼æ„å»ºæ¶ˆæ¯ï¼Œå¦‚[æ­¤å¤„](https://github.com/aws/amazon-ssm-agent/blob/21c85d674bbb44dd13cd8738d1b9d86658a6b18e/agent/session/contracts/agentmessage.go#L73)æ‰€ç¤ºã€‚

**æ‹¦æˆªSSMä¼šè¯æ¯”æ‹¦æˆªEC2æ¶ˆæ¯æ›´å¯é **ï¼Œå› ä¸º**æ§åˆ¶é€šé“æ˜¯é•¿æœŸå­˜åœ¨çš„**ï¼ŒAWSåªä¸**æœ€æ–°çš„é€šé“**é€šä¿¡ã€‚è¿™ä¸ª[æ¦‚å¿µéªŒè¯](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-session-interception)å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ§åˆ¶é€šé“å¹¶ä¸ä¼šè¯äº¤äº’ã€‚

ä»æ»¥ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œ**æ‹¦æˆªSSMä¼šè¯æ¯”æ‹¦æˆªEC2æ¶ˆæ¯æ›´å¯é **ã€‚åŸå› æ˜¯**æ§åˆ¶é€šé“æ˜¯é•¿æœŸå­˜åœ¨çš„**ï¼Œå°±åƒEC2æ¶ˆæ¯ä¸€æ ·ï¼ŒAWSåªä¸**æœ€æ–°çš„é€šé“**é€šä¿¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„æ§åˆ¶é€šé“å¹¶ç›‘å¬ä¼ å…¥çš„ä¼šè¯ã€‚ä½¿ç”¨SSM Agentçš„æºä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥äºŒè¿›åˆ¶æ ¼å¼æ„å»ºæ¶ˆæ¯ï¼ˆå¦‚æœæ‚¨æŸ¥çœ‹[æ¦‚å¿µéªŒè¯](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-session-interception)ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æˆ‘åªæ˜¯å°†Goç¿»è¯‘æˆäº†Pythonï¼‰ï¼Œå¹¶ä¸ä¼šè¯äº¤äº’ã€‚

è¿˜å¯ä»¥çªƒå–å‘½ä»¤ï¼ˆ**æ•æ„Ÿä¿¡æ¯**ï¼‰å¹¶æä¾›æ”»å‡»è€…çš„è¾“å‡ºã€‚

## å‚è€ƒèµ„æ–™

* [https://frichetten.com/blog/ssm-agent-tomfoolery/](https://frichetten.com/blog/ssm-agent-tomfoolery/)

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS Family**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„è´¦å· ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
