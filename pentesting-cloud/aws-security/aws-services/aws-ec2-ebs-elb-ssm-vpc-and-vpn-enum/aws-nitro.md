# AWS - Nitro

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­è¢«å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

AWS Nitroæ˜¯ä¸€å¥—**åˆ›æ–°æŠ€æœ¯**ï¼Œæ„æˆäº†AWS EC2å®ä¾‹çš„åŸºç¡€å¹³å°ã€‚ç”±äºšé©¬é€Šæ¨å‡ºï¼Œæ—¨åœ¨**å¢å¼ºå®‰å…¨æ€§ã€æ€§èƒ½å’Œå¯é æ€§**ï¼ŒNitroåˆ©ç”¨è‡ªå®šä¹‰**ç¡¬ä»¶ç»„ä»¶å’Œè½»é‡çº§hypervisor**ã€‚å®ƒå°†è®¸å¤šä¼ ç»Ÿè™šæ‹ŸåŒ–åŠŸèƒ½æŠ½è±¡åˆ°ä¸“ç”¨ç¡¬ä»¶å’Œè½¯ä»¶ä¸­ï¼Œ**å‡å°‘æ”»å‡»é¢**å¹¶æé«˜èµ„æºæ•ˆç‡ã€‚é€šè¿‡å¸è½½è™šæ‹ŸåŒ–åŠŸèƒ½ï¼ŒNitroä½¿EC2å®ä¾‹èƒ½å¤Ÿæä¾›**æ¥è¿‘è£¸é‡‘å±çš„æ€§èƒ½**ï¼Œç‰¹åˆ«é€‚ç”¨äºèµ„æºå¯†é›†å‹åº”ç”¨ç¨‹åºã€‚æ­¤å¤–ï¼ŒNitroå®‰å…¨èŠ¯ç‰‡ä¸“é—¨ç¡®ä¿**ç¡¬ä»¶å’Œå›ºä»¶çš„å®‰å…¨æ€§**ï¼Œè¿›ä¸€æ­¥å·©å›ºäº†å…¶å¼ºå¤§çš„æ¶æ„ã€‚

### Nitro Enclaves

**AWS Nitro Enclaves**æä¾›äº†ä¸€ä¸ªå®‰å…¨çš„ã€**éš”ç¦»çš„è®¡ç®—ç¯å¢ƒï¼Œä½äºAmazon EC2å®ä¾‹å†…éƒ¨**ï¼Œä¸“é—¨ç”¨äºå¤„ç†é«˜åº¦æ•æ„Ÿæ•°æ®ã€‚åˆ©ç”¨AWS Nitroç³»ç»Ÿï¼Œè¿™äº›é£åœ°ç¡®ä¿äº†å¼ºå¤§çš„**éš”ç¦»å’Œå®‰å…¨æ€§**ï¼Œéå¸¸é€‚åˆå¤„ç†è¯¸å¦‚PIIæˆ–è´¢åŠ¡è®°å½•ç­‰**æœºå¯†ä¿¡æ¯**ã€‚å®ƒä»¬å…·æœ‰æç®€ç¯å¢ƒï¼Œæ˜¾è‘—é™ä½äº†æ•°æ®æš´éœ²çš„é£é™©ã€‚æ­¤å¤–ï¼ŒNitro Enclavesæ”¯æŒåŠ å¯†è®¤è¯ï¼Œå…è®¸ç”¨æˆ·éªŒè¯åªæœ‰ç»æˆæƒçš„ä»£ç æ­£åœ¨è¿è¡Œï¼Œè¿™å¯¹äºä¿æŒä¸¥æ ¼çš„åˆè§„æ€§å’Œæ•°æ®ä¿æŠ¤æ ‡å‡†è‡³å…³é‡è¦ã€‚

{% hint style="danger" %}
Nitro Enclaveé•œåƒæ˜¯**ä»EC2å®ä¾‹å†…éƒ¨è¿è¡Œ**çš„ï¼Œæ‚¨æ— æ³•ä»AWS Webæ§åˆ¶å°çœ‹åˆ°EC2å®ä¾‹æ˜¯å¦åœ¨Nitro Enclaveä¸­è¿è¡Œé•œåƒã€‚
{% endhint %}

### Nitro Enclave CLIå®‰è£…

æŒ‰ç…§[**æ–‡æ¡£ä¸­çš„æ‰€æœ‰è¯´æ˜**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)ã€‚ä½†æ˜¯ï¼Œä»¥ä¸‹æ˜¯æœ€é‡è¦çš„æŒ‡ä»¤ï¼š
```bash
# Install tools
sudo amazon-linux-extras install aws-nitro-enclaves-cli -y
sudo yum install aws-nitro-enclaves-cli-devel -y

# Config perms
sudo usermod -aG ne $USER
sudo usermod -aG docker $USER

# Check installation
nitro-cli --version

# Start and enable the Nitro Enclaves allocator service.
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service
```
### Nitro Enclaveé•œåƒ

æ‚¨å¯ä»¥åœ¨Nitro Enclaveä¸­è¿è¡Œçš„é•œåƒåŸºäºdockeré•œåƒï¼Œå› æ­¤æ‚¨å¯ä»¥ä»dockeré•œåƒåˆ›å»ºæ‚¨çš„Nitro Enclaveé•œåƒï¼Œä¾‹å¦‚ï¼š
```bash
# You need to have the docker image accesible in your running local registry
# Or indicate the full docker image URL to access the image
nitro-cli build-enclave --docker-uri <docker-img>:<tag> --output-file nitro-img.eif
```
æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼ŒNitro Enclave å›¾åƒä½¿ç”¨æ‰©å±•å **`eif`**ï¼ˆEnclave Image Fileï¼‰ã€‚

è¾“å‡ºå°†ç±»ä¼¼äºï¼š
```
Using the locally available Docker image...
Enclave Image successfully created.
{
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
```
æ ¹æ®[**æ–‡æ¡£**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)ï¼Œä¸ºäº†è¿è¡Œä¸€ä¸ªenclaveé•œåƒï¼Œæ‚¨éœ€è¦ä¸ºå…¶åˆ†é…è‡³å°‘æ˜¯**`eif`**æ–‡ä»¶å ç”¨ç£ç›˜ç©ºé—´çš„4å€çš„å†…å­˜ã€‚
