# AWS - EC2, EBS, ELB, SSM, VPC & VPN æšä¸¾

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬**ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## VPC & ç½‘ç»œ

äº†è§£ VPC æ˜¯ä»€ä¹ˆä»¥åŠå…¶ç»„ä»¶åœ¨ï¼š

{% content-ref url="../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md" %}
[aws-vpc-and-networking-basic-information.md](../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md)
{% endcontent-ref %}

## EC2

Amazon EC2 ç”¨äºå¯åŠ¨**è™šæ‹ŸæœåŠ¡å™¨**ã€‚å®ƒå…è®¸é…ç½®**å®‰å…¨æ€§**å’Œ**ç½‘ç»œ**ï¼Œä»¥åŠç®¡ç†**å­˜å‚¨**ã€‚Amazon EC2 çš„çµæ´»æ€§ä½“ç°åœ¨å…¶èƒ½å¤Ÿå‘ä¸Šå’Œå‘ä¸‹æ‰©å±•èµ„æºï¼Œæœ‰æ•ˆåœ°é€‚åº”ä¸æ–­å˜åŒ–çš„éœ€æ±‚æˆ–æµè¡Œåº¦æ¿€å¢ã€‚è¿™ä¸ªç‰¹æ€§å‡å°‘äº†å¯¹ç²¾ç¡®æµé‡é¢„æµ‹çš„å¿…è¦æ€§ã€‚

åœ¨ EC2 ä¸­æšä¸¾çš„æœ‰è¶£å†…å®¹ï¼š

* è™šæ‹Ÿæœº
* SSH å¯†é’¥
* ç”¨æˆ·æ•°æ®
* ç°æœ‰çš„ EC2/AMI/å¿«ç…§
* ç½‘ç»œ
* ç½‘ç»œ
* å­ç½‘
* å…¬å…± IP
* å¼€æ”¾ç«¯å£
* ä¸ AWS å¤–éƒ¨å…¶ä»–ç½‘ç»œçš„é›†æˆè¿æ¥

### å®ä¾‹é…ç½®æ–‡ä»¶

ä½¿ç”¨**è§’è‰²**ä¸ºåœ¨**EC2 å®ä¾‹**ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæˆäºˆæƒé™éœ€è¦ä¸€äº›é¢å¤–é…ç½®ã€‚åœ¨ EC2 å®ä¾‹ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºè¢«è™šæ‹ŸåŒ–æ“ä½œç³»ç»ŸæŠ½è±¡å‡ºæ¥ï¼Œå› æ­¤æ‚¨éœ€è¦é¢å¤–çš„æ­¥éª¤æ¥ä¸º EC2 å®ä¾‹åˆ†é… AWS è§’è‰²åŠå…¶å…³è”çš„æƒé™ï¼Œå¹¶ä½¿å…¶å¯¹åº”ç”¨ç¨‹åºå¯ç”¨ã€‚

è¿™ä¸ªé¢å¤–æ­¥éª¤æ˜¯é™„åŠ åˆ°å®ä¾‹çš„**[_å®ä¾‹é…ç½®æ–‡ä»¶_**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_use\_switch-role-ec2\_instance-profiles.html)ï¼Œå®ä¾‹é…ç½®æ–‡ä»¶åŒ…å«è§’è‰²ï¼Œå¹¶å¯å‘åœ¨å®ä¾‹ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæä¾›è§’è‰²çš„ä¸´æ—¶å‡­è¯ã€‚ç„¶åï¼Œè¿™äº›ä¸´æ—¶å‡­è¯å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ API è°ƒç”¨ä¸­ä½¿ç”¨ï¼Œä»¥è®¿é—®èµ„æºå¹¶é™åˆ¶è®¿é—®ä»…é™äºè§’è‰²æŒ‡å®šçš„èµ„æºã€‚è¯·æ³¨æ„ï¼Œ**ä¸€ä¸ª EC2 å®ä¾‹åªèƒ½åˆ†é…ä¸€ä¸ªè§’è‰²**ï¼Œå®ä¾‹ä¸Šçš„æ‰€æœ‰åº”ç”¨ç¨‹åºå…±äº«ç›¸åŒçš„è§’è‰²å’Œæƒé™ã€‚

### å…ƒæ•°æ®ç«¯ç‚¹

AWS EC2 å…ƒæ•°æ®æ˜¯ EC2 å®ä¾‹åœ¨è¿è¡Œæ—¶å¯ç”¨çš„æœ‰å…³ Amazon Elastic Compute Cloudï¼ˆEC2ï¼‰å®ä¾‹çš„ä¿¡æ¯ã€‚æ­¤å…ƒæ•°æ®ç”¨äºæä¾›æœ‰å…³å®ä¾‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å®ä¾‹ IDã€å…¶è¿è¡Œçš„å¯ç”¨åŒºåŸŸã€ä¸å®ä¾‹å…³è”çš„ IAM è§’è‰²ä»¥åŠå®ä¾‹çš„ä¸»æœºåã€‚

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### æšä¸¾
```bash
# Get EC2 instances
aws ec2 describe-instances
aws ec2 describe-instance-status #Get status from running instances

# Get user data from each ec2 instance
for instanceid in $(aws ec2 describe-instances --profile <profile> --region us-west-2 | grep -Eo '"i-[a-zA-Z0-9]+' | tr -d '"'); do
echo "Instance ID: $instanceid"
aws ec2 describe-instance-attribute --profile <profile> --region us-west-2 --instance-id "$instanceid" --attribute userData | jq ".UserData.Value" | tr -d '"' | base64 -d
echo ""
echo "-------------------"
done

# Instance profiles
aws iam list-instance-profiles
aws iam list-instance-profiles-for-role --role-name <name>

# Get tags
aws ec2 describe-tags

# Get volumes
aws ec2 describe-volume-status
aws ec2 describe-volumes

# Get snapshots
aws ec2 describe-snapshots --owner-ids self

# Scheduled instances
aws ec2 describe-scheduled-instances

# Get custom images
aws ec2 describe-images --owners self

# Get Elastic IPs
aws ec2 describe-addresses

# Get current output
aws ec2 get-console-output --instance-id [id]

# Get VPN customer gateways
aws ec2 describe-customer-gateways
aws ec2 describe-vpn-gateways
aws ec2 describe-vpn-connections

# List conversion tasks to upload/download VMs
aws ec2 describe-conversion-tasks
aws ec2 describe-import-image-tasks

# Get Bundle Tasks
aws ec2 describe-bundle-tasks

# Get Classic Instances
aws ec2 describe-classic-link-instances

# Get Dedicated Hosts
aws ec2 describe-hosts

# Get SSH Key Pairs
aws ec2 describe-key-pairs

# Get Internet Gateways
aws ec2 describe-internet-gateways

# Get NAT Gateways
aws ec2 describe-nat-gateways

# Get subnetworks
aws ec2 describe-subnets

# Get FW rules
aws ec2 describe-network-acls

# Get security groups
aws ec2 describe-security-groups

# Get interfaces
aws ec2 describe-network-interfaces

# Get routes table
aws ec2 describe-route-tables

# Get VPCs
aws ec2 describe-vpcs
aws ec2 describe-vpc-peering-connections
```
### æœªç»èº«ä»½éªŒè¯çš„è®¿é—®

{% content-ref url="../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md" %}
[aws-ec2-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md)
{% endcontent-ref %}

### ææƒ

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨ EC2 æƒé™ä»¥æå‡ç‰¹æƒ**ï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ec2-privesc.md" %}
[aws-ec2-privesc.md](../../aws-privilege-escalation/aws-ec2-privesc.md)
{% endcontent-ref %}

### æ¼æ´åˆ©ç”¨å

{% content-ref url="../../../aws-pentesting/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/" %}
[aws-ec2-ebs-ssm-and-vpc-post-exploitation](../../../aws-pentesting/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/)
{% endcontent-ref %}

## EBS

äºšé©¬é€Š **EBS**ï¼ˆå¼¹æ€§å—å­˜å‚¨ï¼‰**å¿«ç…§**åŸºæœ¬ä¸Šæ˜¯ AWS EBS å·çš„é™æ€**å¤‡ä»½**ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä»¬æ˜¯åœ¨ç‰¹å®šæ—¶é—´ç‚¹å¤åˆ¶åˆ° EC2 å®ä¾‹çš„**ç£ç›˜**çš„**å‰¯æœ¬**ã€‚EBS å¿«ç…§å¯ä»¥è·¨åŒºåŸŸå’Œå¸æˆ·è¿›è¡Œå¤åˆ¶ï¼Œç”šè‡³å¯ä»¥ä¸‹è½½å¹¶åœ¨æœ¬åœ°è¿è¡Œã€‚

å¿«ç…§å¯èƒ½åŒ…å«**æ•æ„Ÿä¿¡æ¯**ï¼Œå¦‚**æºä»£ç æˆ– API å¯†é’¥**ï¼Œå› æ­¤ï¼Œå¦‚æœæœ‰æœºä¼šï¼Œå»ºè®®è¿›è¡Œæ£€æŸ¥ã€‚

### AMI ä¸ EBS çš„åŒºåˆ«

**AMI** ç”¨äº**å¯åŠ¨ EC2 å®ä¾‹**ï¼Œè€Œ EC2 **å¿«ç…§**ç”¨äº**å¤‡ä»½å’Œæ¢å¤å­˜å‚¨åœ¨ EBS å·ä¸Šçš„æ•°æ®**ã€‚è™½ç„¶ EC2 å¿«ç…§å¯ç”¨äºåˆ›å»ºæ–°çš„ AMIï¼Œä½†å®ƒä¸åŒäº AMIï¼Œå¹¶ä¸”ä¸åŒ…æ‹¬æœ‰å…³æ“ä½œç³»ç»Ÿã€åº”ç”¨æœåŠ¡å™¨æˆ–è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„å…¶ä»–è½¯ä»¶çš„ä¿¡æ¯ã€‚

### ææƒ

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨ EBS æƒé™ä»¥æå‡ç‰¹æƒ**ï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ebs-privesc.md" %}
[aws-ebs-privesc.md](../../aws-privilege-escalation/aws-ebs-privesc.md)
{% endcontent-ref %}

## SSM

**Amazon Simple Systems Manager (SSM)** å…è®¸è¿œç¨‹ç®¡ç† EC2 å®ä¾‹çš„æµ®åŠ¨ï¼Œä½¿å…¶ç®¡ç†å˜å¾—æ›´åŠ å®¹æ˜“ã€‚è¿™äº›å®ä¾‹ä¸­çš„æ¯ä¸ªéƒ½éœ€è¦è¿è¡Œ**SSM Agent æœåŠ¡ï¼Œå› ä¸ºè¯¥æœåŠ¡å°†ä» AWS API è·å–æ“ä½œå¹¶æ‰§è¡Œè¿™äº›æ“ä½œ**ã€‚

**SSM Agent** ä½¿ Systems Manager èƒ½å¤Ÿæ›´æ–°ã€ç®¡ç†å’Œé…ç½®è¿™äº›èµ„æºã€‚è¯¥ä»£ç†**å¤„ç†æ¥è‡ª AWS äº‘ä¸­ Systems Manager æœåŠ¡çš„è¯·æ±‚**ï¼Œç„¶åæŒ‰è¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹å¼è¿è¡Œå®ƒä»¬ã€‚

**SSM Agent**[ **é¢„å®‰è£…åœ¨æŸäº› AMI ä¸­**](https://docs.aws.amazon.com/systems-manager/latest/userguide/ami-preinstalled-agent.html)ï¼Œæˆ–è€…æ‚¨éœ€è¦[**æ‰‹åŠ¨å®‰è£…å®ƒä»¬**](https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-manual-agent-install.html)åœ¨å®ä¾‹ä¸Šã€‚æ­¤å¤–ï¼Œå®ä¾‹å†…éƒ¨ä½¿ç”¨çš„ IAM è§’è‰²éœ€è¦é™„åŠ ç­–ç•¥**AmazonEC2RoleforSSM**æ‰èƒ½è¿›è¡Œé€šä¿¡ã€‚

### æšä¸¾
```bash
aws ssm describe-instance-information
aws ssm describe-parameters
aws ssm describe-sessions --state [Active|History]
aws ssm describe-instance-patches --instance-id <id>
aws ssm describe-instance-patch-states --instance-ids <id>
aws ssm describe-instance-associations-status --instance-id <id>
```
æ‚¨å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åœ¨EC2å®ä¾‹ä¸­æ£€æŸ¥æ˜¯å¦æ­£åœ¨è¿è¡ŒSystems Managerï¼š
```bash
ps aux | grep amazon-ssm
```
### ææƒ

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨ SSM æƒé™æ¥æå‡ç‰¹æƒ**ï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ssm-privesc.md" %}
[aws-ssm-privesc.md](../../aws-privilege-escalation/aws-ssm-privesc.md)
{% endcontent-ref %}

### åæ¸—é€

ç±»ä¼¼ SSM æ¶ˆæ¯æ‹¦æˆªç­‰æŠ€æœ¯å¯ä»¥åœ¨ SSM åæ¸—é€é¡µé¢ä¸­æ‰¾åˆ°ï¼š

{% content-ref url="broken-reference/" %}
[broken-reference](broken-reference/)
{% endcontent-ref %}

## ELB

**å¼¹æ€§è´Ÿè½½å‡è¡¡**ï¼ˆELBï¼‰æ˜¯äºšé©¬é€Šç½‘ç»œæœåŠ¡ï¼ˆAWSï¼‰éƒ¨ç½²çš„**è´Ÿè½½å‡è¡¡æœåŠ¡**ã€‚ELB è‡ªåŠ¨**åˆ†å‘ä¼ å…¥çš„åº”ç”¨ç¨‹åºæµé‡**å¹¶æ‰©å±•èµ„æºä»¥æ»¡è¶³æµé‡éœ€æ±‚ã€‚

### æšä¸¾
```bash
# List internet-facing ELBs
aws elb describe-load-balancers
aws elb describe-load-balancers | jq '.LoadBalancerDescriptions[]| select( .Scheme | contains("internet-facing"))|.DNSName'

# DONT FORGET TO CHECK VERSION 2
aws elbv2 describe-load-balancers
aws elbv2 describe-load-balancers | jq '.LoadBalancers[].DNSName'
aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
```
## å¯åŠ¨æ¨¡æ¿å’Œè‡ªåŠ¨æ‰©å±•ç»„

### æšä¸¾

{% code overflow="wrap" %}
```bash
# Launch templates
aws ec2 describe-launch-templates
aws ec2 describe-launch-templates --launch-template-id <launch_template_id>
## Get details, like user data
aws ec2 describe-launch-template-versions --launch-template-id <launch_template_id>

# Autoscaling
aws autoscaling describe-auto-scaling-groups
aws autoscaling describe-auto-scaling-instances
aws autoscaling describe-launch-configurations
aws autoscaling describe-load-balancer-target-groups
aws autoscaling describe-load-balancers
```
{% endcode %}

## VPN

VPNå…è®¸è¿æ¥æ‚¨çš„**æœ¬åœ°ç½‘ç»œï¼ˆç«™ç‚¹åˆ°ç«™ç‚¹VPNï¼‰**æˆ–**å·¥ä½œäººå‘˜ç¬”è®°æœ¬ç”µè„‘ï¼ˆå®¢æˆ·ç«¯VPNï¼‰**ä¸**AWS VPC**ï¼Œä»¥ä¾¿è®¿é—®æœåŠ¡è€Œæ— éœ€å°†å…¶æš´éœ²åœ¨äº’è”ç½‘ä¸Šã€‚

#### åŸºæœ¬çš„AWS VPNç»„ä»¶

1. **å®¢æˆ·ç½‘å…³**ï¼š
* å®¢æˆ·ç½‘å…³æ˜¯æ‚¨åœ¨AWSä¸­åˆ›å»ºçš„èµ„æºï¼Œç”¨äºä»£è¡¨VPNè¿æ¥çš„æ‚¨çš„ä¸€ä¾§ã€‚
* å®ƒæœ¬è´¨ä¸Šæ˜¯ç«™ç‚¹åˆ°ç«™ç‚¹VPNè¿æ¥ä¸€ä¾§çš„ç‰©ç†è®¾å¤‡æˆ–è½¯ä»¶åº”ç”¨ç¨‹åºã€‚
* æ‚¨æä¾›è·¯ç”±ä¿¡æ¯å’Œæ‚¨ç½‘ç»œè®¾å¤‡ï¼ˆå¦‚è·¯ç”±å™¨æˆ–é˜²ç«å¢™ï¼‰çš„å…¬å…±IPåœ°å€ç»™AWSä»¥åˆ›å»ºå®¢æˆ·ç½‘å…³ã€‚
* å®ƒç”¨ä½œè®¾ç½®VPNè¿æ¥çš„å‚è€ƒç‚¹ï¼Œä¸ä¼šäº§ç”Ÿé¢å¤–è´¹ç”¨ã€‚
2. **è™šæ‹Ÿä¸“ç”¨ç½‘å…³**ï¼š
* è™šæ‹Ÿä¸“ç”¨ç½‘å…³ï¼ˆVPGï¼‰æ˜¯ç«™ç‚¹åˆ°ç«™ç‚¹VPNè¿æ¥Amazonä¸€ä¾§çš„VPNé›†ä¸­å™¨ã€‚
* å®ƒé™„åŠ åˆ°æ‚¨çš„VPCï¼Œå¹¶ç”¨ä½œVPNè¿æ¥çš„ç›®æ ‡ã€‚
* VPGæ˜¯VPNè¿æ¥çš„AWSç«¯ç‚¹ã€‚
* å®ƒå¤„ç†æ‚¨çš„VPCä¸æ‚¨æœ¬åœ°ç½‘ç»œä¹‹é—´çš„å®‰å…¨é€šä¿¡ã€‚
3. **ç«™ç‚¹åˆ°ç«™ç‚¹VPNè¿æ¥**ï¼š
* ç«™ç‚¹åˆ°ç«™ç‚¹VPNè¿æ¥é€šè¿‡å®‰å…¨çš„IPsec VPNéš§é“å°†æ‚¨çš„æœ¬åœ°ç½‘ç»œè¿æ¥åˆ°VPCã€‚
* è¿™ç§è¿æ¥éœ€è¦å®¢æˆ·ç½‘å…³å’Œè™šæ‹Ÿä¸“ç”¨ç½‘å…³ã€‚
* å®ƒç”¨äºæ‚¨çš„æ•°æ®ä¸­å¿ƒæˆ–ç½‘ç»œä¸æ‚¨çš„AWSç¯å¢ƒä¹‹é—´çš„å®‰å…¨ã€ç¨³å®šå’Œä¸€è‡´çš„é€šä¿¡ã€‚
* é€šå¸¸ç”¨äºå¸¸è§„ã€é•¿æœŸè¿æ¥ï¼Œå¹¶æ ¹æ®è¿æ¥ä¼ è¾“çš„æ•°æ®é‡è®¡è´¹ã€‚
4. **å®¢æˆ·ç«¯VPNç«¯ç‚¹**ï¼š
* å®¢æˆ·ç«¯VPNç«¯ç‚¹æ˜¯æ‚¨åœ¨AWSä¸­åˆ›å»ºçš„èµ„æºï¼Œç”¨äºå¯ç”¨å’Œç®¡ç†å®¢æˆ·ç«¯VPNä¼šè¯ã€‚
* ç”¨äºå…è®¸ä¸ªåˆ«è®¾å¤‡ï¼ˆå¦‚ç¬”è®°æœ¬ç”µè„‘ã€æ™ºèƒ½æ‰‹æœºç­‰ï¼‰å®‰å…¨è¿æ¥åˆ°AWSèµ„æºæˆ–æ‚¨çš„æœ¬åœ°ç½‘ç»œã€‚
* ä¸ç«™ç‚¹åˆ°ç«™ç‚¹VPNä¸åŒï¼Œå®ƒè®¾è®¡ç”¨äºä¸ªåˆ«å®¢æˆ·ç«¯è€Œä¸æ˜¯è¿æ¥æ•´ä¸ªç½‘ç»œã€‚
* ä½¿ç”¨å®¢æˆ·ç«¯VPNï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è®¾å¤‡ä½¿ç”¨VPNå®¢æˆ·ç«¯è½¯ä»¶å»ºç«‹å®‰å…¨è¿æ¥ã€‚

æ‚¨å¯ä»¥[**åœ¨æ­¤å¤„æ‰¾åˆ°æœ‰å…³AWS VPNçš„å¥½å¤„å’Œç»„ä»¶çš„æ›´å¤šä¿¡æ¯**](../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md#vpn)ã€‚

### æšä¸¾
```bash
# VPN endpoints
## Check used subnetwork, authentication, SGs, connected...
aws ec2 describe-client-vpn-endpoints

## Get AWS network info related to the vpn endpoint
aws ec2 describe-client-vpn-target-networks --client-vpn-endpoint-id <id>

## Get AWS subnet & ip range the VPN iconnected to
aws ec2 describe-client-vpn-routes --client-vpn-endpoint-id <id>

## Check authorization rules
aws ec2 describe-client-vpn-authorization-rules --client-vpn-endpoint-id <id>

## Get current connections to the VPN endpoint
aws ec2 describe-client-vpn-connections --client-vpn-endpoint-id <id>

# Get VPN gateways and check with which VPC each is connected
aws ec2 describe-vpn-gateways

# Get VPN site-to-site connections
aws ec2 describe-vpn-connections
```
### æœ¬åœ°æšä¸¾

**æœ¬åœ°ä¸´æ—¶å‡­è¯**

å½“ä½¿ç”¨AWS VPNå®¢æˆ·ç«¯è¿æ¥åˆ°VPNæ—¶ï¼Œç”¨æˆ·é€šå¸¸ä¼š**ç™»å½•AWS**ä»¥è·å–VPNè®¿é—®æƒé™ã€‚ç„¶åï¼Œä¸€äº›**AWSå‡­è¯ä¼šè¢«åˆ›å»ºå¹¶å­˜å‚¨**åœ¨æœ¬åœ°ä»¥å»ºç«‹VPNè¿æ¥ã€‚è¿™äº›å‡­è¯è¢«**å­˜å‚¨åœ¨** `$HOME/.config/AWSVPNClient/TemporaryCredentials/<region>/temporary-credentials.txt` ä¸­ï¼ŒåŒ…å«ä¸€ä¸ª**è®¿é—®å¯†é’¥**ï¼Œä¸€ä¸ª**ç§˜å¯†å¯†é’¥**å’Œä¸€ä¸ª**ä»¤ç‰Œ**ã€‚

è¿™äº›å‡­è¯å±äºç”¨æˆ· `arn:aws:sts::<acc-id>:assumed-role/aws-vpn-client-metrics-analytics-access-role/CognitoIdentityCredentials`ï¼ˆTODOï¼šè¿›ä¸€æ­¥ç ”ç©¶è¿™äº›å‡­è¯çš„æƒé™ï¼‰ã€‚

**opvné…ç½®æ–‡ä»¶**

å¦‚æœ**å»ºç«‹äº†VPNè¿æ¥**ï¼Œæ‚¨åº”è¯¥åœ¨ç³»ç»Ÿä¸­æœç´¢**`.opvn`**é…ç½®æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œæ‚¨å¯èƒ½ä¼šåœ¨**`$HOME/.config/AWSVPNClient/OpenVpnConfigs`** ä¸­æ‰¾åˆ°è¿™äº›**é…ç½®**ã€‚

#### **åæ¸—é€**

{% content-ref url="../../aws-post-exploitation/aws-vpn-post-exploitation.md" %}
[aws-vpn-post-exploitation.md](../../aws-post-exploitation/aws-vpn-post-exploitation.md)
{% endcontent-ref %}

## å‚è€ƒ

* [https://docs.aws.amazon.com/batch/latest/userguide/getting-started-ec2.html](https://docs.aws.amazon.com/batch/latest/userguide/getting-started-ec2.html)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ä¸Šå…³æ³¨**æˆ‘ä»¬ã€‚
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
