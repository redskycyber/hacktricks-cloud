# AWS - EC2, EBS, ELB, SSM, VPC & VPN æšä¸¾

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## VPC & ç½‘ç»œ

äº†è§£ä»€ä¹ˆæ˜¯VPCåŠå…¶ç»„ä»¶ï¼š

{% content-ref url="../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md" %}
[aws-vpc-and-networking-basic-information.md](../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md)
{% endcontent-ref %}

## EC2

æ‚¨å¯ä»¥ä½¿ç”¨Amazon EC2å¯åŠ¨**è™šæ‹ŸæœåŠ¡å™¨**ï¼Œé…ç½®**å®‰å…¨æ€§**å’Œ**ç½‘ç»œ**ï¼Œå¹¶ç®¡ç†**å­˜å‚¨**ã€‚Amazon EC2å…è®¸æ‚¨æ ¹æ®éœ€æ±‚å˜åŒ–æˆ–æµè¡Œåº¦çš„æ³¢åŠ¨è¿›è¡Œæ‰©å±•æˆ–ç¼©å‡ï¼Œå‡å°‘é¢„æµ‹æµé‡çš„éœ€æ±‚ã€‚

åœ¨EC2ä¸­æšä¸¾çš„æœ‰è¶£äº‹ç‰©ï¼š

* è™šæ‹Ÿæœº
* SSHå¯†é’¥
* ç”¨æˆ·æ•°æ®
* ç°æœ‰çš„EC2s/AMIs/å¿«ç…§
* ç½‘ç»œ
* ç½‘ç»œ
* å­ç½‘ç»œ
* å…¬å…±IP
* å¼€æ”¾ç«¯å£
* ä¸AWSå¤–éƒ¨å…¶ä»–ç½‘ç»œçš„é›†æˆè¿æ¥

### å®ä¾‹é…ç½®æ–‡ä»¶

ä½¿ç”¨**è§’è‰²**æˆäºˆæƒé™ç»™åœ¨**EC2å®ä¾‹**ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºéœ€è¦ä¸€äº›é¢å¤–çš„é…ç½®ã€‚åœ¨EC2å®ä¾‹ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºè¢«è™šæ‹ŸåŒ–æ“ä½œç³»ç»Ÿä»AWSä¸­æŠ½è±¡å‡ºæ¥ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªé¢å¤–çš„æ­¥éª¤æ¥å°†AWSè§’è‰²åŠå…¶å…³è”çš„æƒé™åˆ†é…ç»™EC2å®ä¾‹ï¼Œå¹¶ä½¿å…¶å¯¹å…¶åº”ç”¨ç¨‹åºå¯ç”¨ã€‚

è¿™ä¸ªé¢å¤–çš„æ­¥éª¤æ˜¯åˆ›å»ºä¸€ä¸ªé™„åŠ åˆ°å®ä¾‹çš„[_**å®ä¾‹é…ç½®æ–‡ä»¶**_](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html)ã€‚**å®ä¾‹é…ç½®æ–‡ä»¶åŒ…å«è§’è‰²**ï¼Œå¹¶ä¸”å¯ä»¥å‘å®ä¾‹ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæä¾›è§’è‰²çš„ä¸´æ—¶å‡­è¯ã€‚ç„¶åå¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„APIè°ƒç”¨ä¸­ä½¿ç”¨è¿™äº›ä¸´æ—¶å‡­è¯æ¥è®¿é—®èµ„æºï¼Œå¹¶ä¸”åªé™åˆ¶è®¿é—®è§’è‰²æŒ‡å®šçš„èµ„æºã€‚è¯·æ³¨æ„ï¼Œ**ä¸€æ¬¡åªèƒ½å‘EC2å®ä¾‹åˆ†é…ä¸€ä¸ªè§’è‰²**ï¼Œå¹¶ä¸”å®ä¾‹ä¸Šçš„æ‰€æœ‰åº”ç”¨ç¨‹åºå…±äº«ç›¸åŒçš„è§’è‰²å’Œæƒé™ã€‚

### å…ƒæ•°æ®ç«¯ç‚¹

AWS EC2å…ƒæ•°æ®æ˜¯åœ¨è¿è¡Œæ—¶å¯ä¾›Amazonå¼¹æ€§è®¡ç®—äº‘ï¼ˆEC2ï¼‰å®ä¾‹ä½¿ç”¨çš„å…³äºå®ä¾‹çš„ä¿¡æ¯ã€‚è¿™äº›å…ƒæ•°æ®ç”¨äºæä¾›æœ‰å…³å®ä¾‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å…¶å®ä¾‹IDã€å®ƒè¿è¡Œçš„å¯ç”¨åŒºã€ä¸å®ä¾‹å…³è”çš„IAMè§’è‰²ä»¥åŠå®ä¾‹çš„ä¸»æœºåã€‚

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### æšä¸¾
```bash
# Get EC2 instances
aws ec2 describe-instances
aws ec2 describe-instance-status #Get status from running instances

# Get user data from each ec2 instance
for instanceid in $(aws ec2 describe-instances --profile <profile> --region us-west-2 | grep -Eo '"i-[a-zA-Z0-9]+' | tr -d '"'); do
echo "Instance ID: $instanceid"
aws ec2 describe-instance-attribute --profile <profile> --region us-west-2 --instance-id "$instanceid" --attribute userData | jq ".UserData.Value" | tr -d '"' | base64 -d
echo ""
echo "-------------------"
done

# Instance profiles
aws iam list-instance-profiles
aws iam list-instance-profiles-for-role --role-name <name>

# Get tags
aws ec2 describe-tags

# Get volumes
aws ec2 describe-volume-status
aws ec2 describe-volumes

# Get snapshots
aws ec2 describe-snapshots --owner-ids self

# Scheduled instances
aws ec2 describe-scheduled-instances

# Get custom images
aws ec2 describe-images --owners self

# Get Elastic IPs
aws ec2 describe-addresses

# Get current output
aws ec2 get-console-output --instance-id [id]

# Get VPN customer gateways
aws ec2 describe-customer-gateways
aws ec2 describe-vpn-gateways
aws ec2 describe-vpn-connections

# List conversion tasks to upload/download VMs
aws ec2 describe-conversion-tasks
aws ec2 describe-import-image-tasks

# Get Bundle Tasks
aws ec2 describe-bundle-tasks

# Get Classic Instances
aws ec2 describe-classic-link-instances

# Get Dedicated Hosts
aws ec2 describe-hosts

# Get SSH Key Pairs
aws ec2 describe-key-pairs

# Get Internet Gateways
aws ec2 describe-internet-gateways

# Get NAT Gateways
aws ec2 describe-nat-gateways

# Get subnetworks
aws ec2 describe-subnets

# Get FW rules
aws ec2 describe-network-acls

# Get security groups
aws ec2 describe-security-groups

# Get interfaces
aws ec2 describe-network-interfaces

# Get routes table
aws ec2 describe-route-tables

# Get VPCs
aws ec2 describe-vpcs
aws ec2 describe-vpc-peering-connections
```
### æœªç»è®¤è¯çš„è®¿é—®

{% content-ref url="../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md" %}
[aws-ec2-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md)
{% endcontent-ref %}

### æƒé™æå‡

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥å¦‚ä½•**æ»¥ç”¨ EC2 æƒé™ä»¥æå‡æƒé™**ï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ec2-privesc.md" %}
[aws-ec2-privesc.md](../../aws-privilege-escalation/aws-ec2-privesc.md)
{% endcontent-ref %}

### åæœŸåˆ©ç”¨

{% content-ref url="../../../aws-pentesting/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/" %}
[aws-ec2-ebs-ssm-and-vpc-post-exploitation](../../../aws-pentesting/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/)
{% endcontent-ref %}

## EBS

Amazon **EBS**ï¼ˆå¼¹æ€§å—å­˜å‚¨ï¼‰**å¿«ç…§**åŸºæœ¬ä¸Šæ˜¯ AWS EBS å·çš„é™æ€**å¤‡ä»½**ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä»¬æ˜¯åœ¨ç‰¹å®šæ—¶é—´ç‚¹é™„åŠ åˆ° **EC2** å®ä¾‹çš„**ç£ç›˜**çš„**å‰¯æœ¬**ã€‚EBS å¿«ç…§å¯ä»¥è·¨åŒºåŸŸå’Œè´¦æˆ·å¤åˆ¶ï¼Œç”šè‡³å¯ä»¥ä¸‹è½½å¹¶åœ¨æœ¬åœ°è¿è¡Œã€‚

å¿«ç…§å¯èƒ½åŒ…å«**æ•æ„Ÿä¿¡æ¯**ï¼Œå¦‚**æºä»£ç æˆ– API å¯†é’¥**ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰æœºä¼šï¼Œå»ºè®®æ£€æŸ¥å®ƒã€‚

### AMI ä¸ EBS çš„åŒºåˆ«

**AMI** ç”¨äº**å¯åŠ¨ EC2 å®ä¾‹**ï¼Œè€Œ EC2 **å¿«ç…§**ç”¨äº**å¤‡ä»½å’Œæ¢å¤å­˜å‚¨åœ¨ EBS å·ä¸Šçš„æ•°æ®**ã€‚è™½ç„¶ EC2 å¿«ç…§å¯ä»¥ç”¨æ¥åˆ›å»ºæ–°çš„ AMIï¼Œä½†å®ƒä¸ AMI ä¸åŒï¼Œå®ƒä¸åŒ…æ‹¬æœ‰å…³æ“ä½œç³»ç»Ÿã€åº”ç”¨ç¨‹åºæœåŠ¡å™¨æˆ–è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„å…¶ä»–è½¯ä»¶çš„ä¿¡æ¯ã€‚

### æƒé™æå‡

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥å¦‚ä½•**æ»¥ç”¨ EBS æƒé™ä»¥æå‡æƒé™**ï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ebs-privesc.md" %}
[aws-ebs-privesc.md](../../aws-privilege-escalation/aws-ebs-privesc.md)
{% endcontent-ref %}

## SSM

**Amazon Simple Systems Manager (SSM)** å…è®¸è¿œç¨‹ç®¡ç† EC2 å®ä¾‹çš„æµ®åŠ¨ï¼Œä½¿å…¶ç®¡ç†æ›´åŠ å®¹æ˜“ã€‚è¿™äº›å®ä¾‹ä¸­çš„æ¯ä¸€ä¸ªéƒ½éœ€è¦è¿è¡Œ **SSM Agent æœåŠ¡ï¼Œå› ä¸ºæœåŠ¡å°†è·å–åŠ¨ä½œå¹¶é€šè¿‡ AWS API æ‰§è¡Œå®ƒä»¬**ã€‚

**SSM Agent** ä½¿ç³»ç»Ÿç®¡ç†å™¨èƒ½å¤Ÿæ›´æ–°ã€ç®¡ç†å’Œé…ç½®è¿™äº›èµ„æºã€‚ä»£ç†**å¤„ç†æ¥è‡ª AWS äº‘ä¸­çš„ç³»ç»Ÿç®¡ç†å™¨æœåŠ¡çš„è¯·æ±‚**ï¼Œç„¶åæŒ‰ç…§è¯·æ±‚ä¸­æŒ‡å®šçš„è¿è¡Œå®ƒä»¬ã€‚

**SSM Agent**[**é¢„å®‰è£…åœ¨æŸäº› AMI ä¸­**](https://docs.aws.amazon.com/systems-manager/latest/userguide/ami-preinstalled-agent.html) æˆ–è€…æ‚¨éœ€è¦åœ¨å®ä¾‹ä¸Š[**æ‰‹åŠ¨å®‰è£…å®ƒä»¬**](https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-manual-agent-install.html)ã€‚æ­¤å¤–ï¼Œå®ä¾‹å†…éƒ¨ä½¿ç”¨çš„ IAM è§’è‰²éœ€è¦é™„åŠ æœ‰æ”¿ç­– **AmazonEC2RoleforSSM** æ‰èƒ½è¿›è¡Œé€šä¿¡ã€‚

### æšä¸¾
```bash
aws ssm describe-instance-information
aws ssm describe-parameters
aws ssm describe-sessions --state [Active|History]
aws ssm describe-instance-patches --instance-id <id>
aws ssm describe-instance-patch-states --instance-ids <id>
aws ssm describe-instance-associations-status --instance-id <id>
```
æ‚¨å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥æ£€æŸ¥EC2å®ä¾‹æ˜¯å¦è¿è¡Œäº†Systems Managerï¼š
```bash
ps aux | grep amazon-ssm
```
### æƒé™æå‡

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨ SSM æƒé™ä»¥æå‡æƒé™**ï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ssm-privesc.md" %}
[aws-ssm-privesc.md](../../aws-privilege-escalation/aws-ssm-privesc.md)
{% endcontent-ref %}

### åæœŸåˆ©ç”¨

åƒ SSM æ¶ˆæ¯æ‹¦æˆªè¿™æ ·çš„æŠ€æœ¯å¯ä»¥åœ¨ SSM åæœŸåˆ©ç”¨é¡µé¢ä¸­æ‰¾åˆ°ï¼š

{% content-ref url="aws-ssm-post-exploitation.md" %}
[aws-ssm-post-exploitation.md](aws-ssm-post-exploitation.md)
{% endcontent-ref %}

## ELB

**Elastic Load Balancing**ï¼ˆELBï¼‰æ˜¯**äºšé©¬é€Šç½‘ç»œæœåŠ¡**ï¼ˆAWSï¼‰éƒ¨ç½²çš„**è´Ÿè½½å‡è¡¡æœåŠ¡**ã€‚ELB è‡ªåŠ¨**åˆ†é…è¿›å…¥çš„åº”ç”¨ç¨‹åºæµé‡**å¹¶æ‰©å±•èµ„æºä»¥æ»¡è¶³æµé‡éœ€æ±‚ã€‚

### æšä¸¾
```bash
# List internet-facing ELBs
aws elb describe-load-balancers
aws elb describe-load-balancers | jq '.LoadBalancerDescriptions[]| select( .Scheme | contains("internet-facing"))|.DNSName'

# DONT FORGET TO CHECK VERSION 2
aws elbv2 describe-load-balancers
aws elbv2 describe-load-balancers | jq '.LoadBalancers[].DNSName'
aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
```
## å¯åŠ¨æ¨¡æ¿ & è‡ªåŠ¨ä¼¸ç¼©ç»„

### æšä¸¾

{% code overflow="wrap" %}
```bash
# Launch templates
aws ec2 describe-launch-templates
aws ec2 describe-launch-templates --launch-template-id <launch_template_id>
## Get details, like user data
aws ec2 describe-launch-template-versions --launch-template-id <launch_template_id>

# Autoscaling
aws autoscaling describe-auto-scaling-groups
aws autoscaling describe-auto-scaling-instances
aws autoscaling describe-launch-configurations
aws autoscaling describe-load-balancer-target-groups
aws autoscaling describe-load-balancers
```
<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼Œè¯·æŸ¥çœ‹</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
