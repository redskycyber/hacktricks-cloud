# AWS - EC2, EBS, ELB, SSM, VPC & VPNæšä¸¾

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘**[**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ**[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## VPCå’Œç½‘ç»œ

äº†è§£ä»€ä¹ˆæ˜¯VPCä»¥åŠå…¶ç»„ä»¶ï¼š

{% content-ref url="../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md" %}
[aws-vpc-and-networking-basic-information.md](../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md)
{% endcontent-ref %}

## EC2

æ‚¨å¯ä»¥ä½¿ç”¨Amazon EC2æ¥å¯åŠ¨**è™šæ‹ŸæœåŠ¡å™¨**ï¼Œé…ç½®**å®‰å…¨æ€§**å’Œ**ç½‘ç»œ**ï¼Œä»¥åŠç®¡ç†**å­˜å‚¨**ã€‚Amazon EC2ä½¿æ‚¨èƒ½å¤Ÿæ ¹æ®éœ€æ±‚å˜åŒ–æˆ–æµè¡Œåº¦æ¿€å¢æ¥æ‰©å±•æˆ–ç¼©å‡è§„æ¨¡ï¼Œå‡å°‘äº†å¯¹æµé‡é¢„æµ‹çš„éœ€æ±‚ã€‚

åœ¨EC2ä¸­è¿›è¡Œæšä¸¾çš„æœ‰è¶£äº‹é¡¹ï¼š

* è™šæ‹Ÿæœº
* SSHå¯†é’¥
* ç”¨æˆ·æ•°æ®
* ç°æœ‰çš„EC2/AMI/å¿«ç…§
* ç½‘ç»œ
* ç½‘ç»œ
* å­ç½‘ç»œ
* å…¬å…±IP
* å¼€æ”¾ç«¯å£
* ä¸AWSä¹‹å¤–çš„å…¶ä»–ç½‘ç»œçš„é›†æˆè¿æ¥

### å®ä¾‹é…ç½®æ–‡ä»¶

ä½¿ç”¨**è§’è‰²**ä¸ºåœ¨**EC2å®ä¾‹**ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæˆäºˆæƒé™éœ€è¦ä¸€äº›é¢å¤–çš„é…ç½®ã€‚åœ¨EC2å®ä¾‹ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºé€šè¿‡è™šæ‹ŸåŒ–æ“ä½œç³»ç»Ÿä¸AWSåˆ†ç¦»ã€‚ç”±äºè¿™ç§é¢å¤–çš„åˆ†ç¦»ï¼Œæ‚¨éœ€è¦é¢å¤–çš„æ­¥éª¤æ¥ä¸ºEC2å®ä¾‹åˆ†é…AWSè§’è‰²åŠå…¶å…³è”çš„æƒé™ï¼Œå¹¶ä½¿å…¶å¯¹åº”ç”¨ç¨‹åºå¯ç”¨ã€‚

è¿™ä¸ªé¢å¤–çš„æ­¥éª¤æ˜¯åˆ›å»ºé™„åŠ åˆ°å®ä¾‹çš„[_**å®ä¾‹é…ç½®æ–‡ä»¶**_](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_use\_switch-role-ec2\_instance-profiles.html)ã€‚**å®ä¾‹é…ç½®æ–‡ä»¶åŒ…å«è§’è‰²**ï¼Œå¯ä»¥ä¸ºåœ¨å®ä¾‹ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæä¾›è§’è‰²çš„ä¸´æ—¶å‡­è¯ã€‚ç„¶åï¼Œè¿™äº›ä¸´æ—¶å‡­è¯å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„APIè°ƒç”¨ä¸­ä½¿ç”¨ï¼Œä»¥è®¿é—®èµ„æºå¹¶ä»…é™åˆ¶å¯¹è§’è‰²æŒ‡å®šçš„èµ„æºçš„è®¿é—®ã€‚è¯·æ³¨æ„ï¼Œ**ä¸€æ¬¡åªèƒ½ä¸ºEC2å®ä¾‹åˆ†é…ä¸€ä¸ªè§’è‰²**ï¼Œå¹¶ä¸”å®ä¾‹ä¸Šçš„æ‰€æœ‰åº”ç”¨ç¨‹åºå…±äº«ç›¸åŒçš„è§’è‰²å’Œæƒé™ã€‚

### å…ƒæ•°æ®ç»ˆç«¯

AWS EC2å…ƒæ•°æ®æ˜¯Amazon Elastic Compute Cloud (EC2)å®ä¾‹åœ¨è¿è¡Œæ—¶å¯ç”¨çš„æœ‰å…³å®ä¾‹çš„ä¿¡æ¯ã€‚æ­¤å…ƒæ•°æ®ç”¨äºæä¾›æœ‰å…³å®ä¾‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å®ä¾‹IDã€è¿è¡Œçš„å¯ç”¨åŒºã€ä¸å®ä¾‹å…³è”çš„IAMè§’è‰²å’Œå®ä¾‹çš„ä¸»æœºåã€‚

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### æšä¸¾
```bash
# Get EC2 instances
aws ec2 describe-instances
aws ec2 describe-instance-status #Get status from running instances

# Get user data from each ec2 instance
for instanceid in $(aws ec2 describe-instances --profile <profile> --region us-west-2 | grep -Eo '"i-[a-zA-Z0-9]+' | tr -d '"'); do
echo "Instance ID: $instanceid"
aws ec2 describe-instance-attribute --profile <profile> --region us-west-2 --instance-id "$instanceid" --attribute userData | jq ".UserData.Value" | tr -d '"' | base64 -d
echo ""
echo "-------------------"
done

# Instance profiles
aws iam list-instance-profiles
aws iam list-instance-profiles-for-role --role-name <name>

# Get tags
aws ec2 describe-tags

# Get volumes
aws ec2 describe-volume-status
aws ec2 describe-volumes

# Get snapshots
aws ec2 describe-snapshots --owner-ids self

# Scheduled instances
aws ec2 describe-scheduled-instances

# Get custom images
aws ec2 describe-images --owners self

# Get Elastic IPs
aws ec2 describe-addresses

# Get current output
aws ec2 get-console-output --instance-id [id]

# Get VPN customer gateways
aws ec2 describe-customer-gateways
aws ec2 describe-vpn-gateways
aws ec2 describe-vpn-connections

# List conversion tasks to upload/download VMs
aws ec2 describe-conversion-tasks
aws ec2 describe-import-image-tasks

# Get Bundle Tasks
aws ec2 describe-bundle-tasks

# Get Classic Instances
aws ec2 describe-classic-link-instances

# Get Dedicated Hosts
aws ec2 describe-hosts

# Get SSH Key Pairs
aws ec2 describe-key-pairs

# Get Internet Gateways
aws ec2 describe-internet-gateways

# Get NAT Gateways
aws ec2 describe-nat-gateways

# Get subnetworks
aws ec2 describe-subnets

# Get FW rules
aws ec2 describe-network-acls

# Get security groups
aws ec2 describe-security-groups

# Get interfaces
aws ec2 describe-network-interfaces

# Get routes table
aws ec2 describe-route-tables

# Get VPCs
aws ec2 describe-vpcs
aws ec2 describe-vpc-peering-connections
```
### ææƒ

åœ¨ä¸‹é¢çš„é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•æ»¥ç”¨ EC2 æƒé™ä»¥æå‡ç‰¹æƒï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ec2-privesc.md" %}
[aws-ec2-privesc.md](../../aws-privilege-escalation/aws-ec2-privesc.md)
{% endcontent-ref %}

### æœªç»èº«ä»½éªŒè¯çš„è®¿é—®

{% content-ref url="../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md" %}
[aws-ec2-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md)
{% endcontent-ref %}

### æ¼æ´åˆ©ç”¨å

{% content-ref url="../../../aws-pentesting/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/" %}
[aws-ec2-ebs-ssm-and-vpc-post-exploitation](../../../aws-pentesting/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/)
{% endcontent-ref %}

## EBS

Amazon **EBS**ï¼ˆå¼¹æ€§å—å­˜å‚¨ï¼‰**å¿«ç…§**åŸºæœ¬ä¸Šæ˜¯ AWS EBS å·çš„é™æ€**å¤‡ä»½**ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä»¬æ˜¯ç‰¹å®šæ—¶é—´ç‚¹ä¸Šé™„åŠ åˆ° EC2 å®ä¾‹çš„**ç£ç›˜**çš„**å‰¯æœ¬**ã€‚EBS å¿«ç…§å¯ä»¥åœ¨åŒºåŸŸå’Œå¸æˆ·ä¹‹é—´å¤åˆ¶ï¼Œç”šè‡³å¯ä»¥ä¸‹è½½å¹¶åœ¨æœ¬åœ°è¿è¡Œã€‚

å¿«ç…§å¯èƒ½åŒ…å«**æ•æ„Ÿä¿¡æ¯**ï¼Œä¾‹å¦‚æºä»£ç æˆ– API å¯†é’¥ï¼Œå› æ­¤ï¼Œå¦‚æœæœ‰æœºä¼šï¼Œå»ºè®®è¿›è¡Œæ£€æŸ¥ã€‚

### AMI å’Œ EBS çš„åŒºåˆ«

**AMI** ç”¨äº**å¯åŠ¨ EC2 å®ä¾‹**ï¼Œè€Œ EC2 **å¿«ç…§**ç”¨äº**å¤‡ä»½å’Œæ¢å¤å­˜å‚¨åœ¨ EBS å·ä¸Šçš„æ•°æ®**ã€‚è™½ç„¶ EC2 å¿«ç…§å¯ç”¨äºåˆ›å»ºæ–°çš„ AMIï¼Œä½†å®ƒä¸æ˜¯ AMIï¼Œä¹Ÿä¸åŒ…å«æœ‰å…³æ“ä½œç³»ç»Ÿã€åº”ç”¨ç¨‹åºæœåŠ¡å™¨æˆ–è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„å…¶ä»–è½¯ä»¶çš„ä¿¡æ¯ã€‚

### ææƒ

åœ¨ä¸‹é¢çš„é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•æ»¥ç”¨ EBS æƒé™ä»¥æå‡ç‰¹æƒï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ebs-privesc.md" %}
[aws-ebs-privesc.md](../../aws-privilege-escalation/aws-ebs-privesc.md)
{% endcontent-ref %}

## SSM

**Amazon Simple Systems Manager (SSM)** å…è®¸è¿œç¨‹ç®¡ç† EC2 å®ä¾‹ä»¥ä½¿å…¶ç®¡ç†æ›´åŠ ç®€å•ã€‚æ¯ä¸ªå®ä¾‹éƒ½éœ€è¦è¿è¡Œ **SSM Agent æœåŠ¡ï¼Œå› ä¸ºè¯¥æœåŠ¡å°†è·å–æ“ä½œå¹¶æ‰§è¡Œå®ƒä»¬**ã€‚

**SSM Agent** ä½¿å¾—ç³»ç»Ÿç®¡ç†å‘˜èƒ½å¤Ÿæ›´æ–°ã€ç®¡ç†å’Œé…ç½®è¿™äº›èµ„æºã€‚è¯¥ä»£ç†**åœ¨ AWS äº‘ä¸­çš„ç³»ç»Ÿç®¡ç†å‘˜æœåŠ¡ä¸­å¤„ç†è¯·æ±‚**ï¼Œç„¶åæŒ‰ç…§è¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹å¼è¿è¡Œå®ƒä»¬ã€‚

**SSM Agent**[ **é¢„å®‰è£…åœ¨æŸäº› AMI ä¸­**](https://docs.aws.amazon.com/systems-manager/latest/userguide/ami-preinstalled-agent.html)ï¼Œæˆ–è€…æ‚¨éœ€è¦[**æ‰‹åŠ¨å®‰è£…å®ƒä»¬**](https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-manual-agent-install.html)åœ¨å®ä¾‹ä¸Šã€‚æ­¤å¤–ï¼Œå®ä¾‹å†…éƒ¨ä½¿ç”¨çš„ IAM è§’è‰²éœ€è¦é™„åŠ ç­–ç•¥**AmazonEC2RoleforSSM**ä»¥ä¾¿è¿›è¡Œé€šä¿¡ã€‚

### æšä¸¾
```bash
aws ssm describe-instance-information
aws ssm describe-parameters
aws ssm describe-sessions --state [Active|History]
aws ssm describe-instance-patches --instance-id <id>
aws ssm describe-instance-patch-states --instance-ids <id>
aws ssm describe-instance-associations-status --instance-id <id>
```
æ‚¨å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åœ¨EC2å®ä¾‹ä¸­æ£€æŸ¥æ˜¯å¦æ­£åœ¨è¿è¡ŒSystems Managerï¼š
```bash
ps aux | grep amazon-ssm
```
### ææƒ

åœ¨ä¸‹é¢çš„é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•æ»¥ç”¨ SSM æƒé™æ¥æå‡æƒé™ï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ssm-privesc.md" %}
[aws-ssm-privesc.md](../../aws-privilege-escalation/aws-ssm-privesc.md)
{% endcontent-ref %}

### æ¼æ´åˆ©ç”¨å

SSM æ¶ˆæ¯æ‹¦æˆªç­‰æŠ€æœ¯å¯ä»¥åœ¨ SSM æ¼æ´åˆ©ç”¨åé¡µé¢ä¸­æ‰¾åˆ°ï¼š

{% content-ref url="aws-ssm-post-exploitation.md" %}
[aws-ssm-post-exploitation.md](aws-ssm-post-exploitation.md)
{% endcontent-ref %}

## ELB

**å¼¹æ€§è´Ÿè½½å‡è¡¡**ï¼ˆELBï¼‰æ˜¯ç”¨äºäºšé©¬é€Šç½‘ç»œæœåŠ¡ï¼ˆAWSï¼‰éƒ¨ç½²çš„**è´Ÿè½½å‡è¡¡æœåŠ¡**ã€‚ELB è‡ªåŠ¨**åˆ†å‘ä¼ å…¥çš„åº”ç”¨ç¨‹åºæµé‡**å¹¶æ ¹æ®æµé‡éœ€æ±‚æ‰©å±•èµ„æºã€‚

<figure><img src="https://lh6.googleusercontent.com/cRBL0xfhe4VRn6PU0Bs_NPx937HqgdYxYNkRAh0WmQFfVZfyYg6X1rhpJwmVIQXIEeepQcUoJipsdH-qmacm8Dw49H539e2ygb2A5hQWGjMh_SAEHOfhygtTLINR2h5l6p4NiiMMO7g0LTZiFpdBB9IeEA=s2048" alt=""><figcaption></figcaption></figure>

### æšä¸¾
```bash
# List internet-facing ELBs
aws elb describe-load-balancers
aws elb describe-load-balancers | jq '.LoadBalancerDescriptions[]| select( .Scheme | contains("internet-facing"))|.DNSName'

# DONT FORGET TO CHECK VERSION 2
aws elbv2 describe-load-balancers
aws elbv2 describe-load-balancers | jq '.LoadBalancers[].DNSName'
aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
```
## å¯åŠ¨æ¨¡æ¿å’Œè‡ªåŠ¨æ‰©å±•ç»„

### æšä¸¾

{% code overflow="wrap" %}
```bash
# Launch templates
aws ec2 describe-launch-templates
aws ec2 describe-launch-templates --launch-template-id <launch_template_id>
## Get details, like user data
aws ec2 describe-launch-template-versions --launch-template-id <launch_template_id>

# Autoscaling
aws autoscaling describe-auto-scaling-groups
aws autoscaling describe-auto-scaling-instances
aws autoscaling describe-launch-configurations
aws autoscaling describe-load-balancer-target-groups
aws autoscaling describe-load-balancers
```
{% endcode %}

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDFï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å¾—[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“ï¼Œ[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨ **Twitter** ä¸Š **å…³æ³¨** æˆ‘ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
