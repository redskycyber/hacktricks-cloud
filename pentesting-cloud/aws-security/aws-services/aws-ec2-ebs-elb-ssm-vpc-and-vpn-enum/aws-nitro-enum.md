# AWS - Nitro Enum

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

AWS Nitroæ˜¯ä¸€å¥—**åˆ›æ–°æŠ€æœ¯**ï¼Œæ„æˆäº†AWS EC2å®ä¾‹çš„åŸºç¡€å¹³å°ã€‚ç”±äºšé©¬é€Šå¼•å…¥ï¼Œæ—¨åœ¨**å¢å¼ºå®‰å…¨æ€§ã€æ€§èƒ½å’Œå¯é æ€§**ï¼ŒNitroåˆ©ç”¨è‡ªå®šä¹‰**ç¡¬ä»¶ç»„ä»¶å’Œè½»é‡çº§hypervisor**ã€‚å®ƒå°†è®¸å¤šä¼ ç»Ÿè™šæ‹ŸåŒ–åŠŸèƒ½æŠ½è±¡åˆ°ä¸“ç”¨ç¡¬ä»¶å’Œè½¯ä»¶ä¸­ï¼Œ**æœ€å°åŒ–æ”»å‡»é¢**å¹¶æé«˜èµ„æºæ•ˆç‡ã€‚é€šè¿‡å¸è½½è™šæ‹ŸåŒ–åŠŸèƒ½ï¼ŒNitroå…è®¸EC2å®ä¾‹æä¾›**æ¥è¿‘è£¸é‡‘å±æ€§èƒ½**ï¼Œç‰¹åˆ«é€‚ç”¨äºèµ„æºå¯†é›†å‹åº”ç”¨ç¨‹åºã€‚æ­¤å¤–ï¼ŒNitroå®‰å…¨èŠ¯ç‰‡ä¸“é—¨ç¡®ä¿**ç¡¬ä»¶å’Œå›ºä»¶çš„å®‰å…¨æ€§**ï¼Œè¿›ä¸€æ­¥å·©å›ºäº†å…¶å¼ºå¤§çš„æ¶æ„ã€‚

### Nitro Enclaves

**AWS Nitro Enclaves**æä¾›äº†ä¸€ä¸ªå®‰å…¨çš„ã€**éš”ç¦»çš„è®¡ç®—ç¯å¢ƒï¼Œä½äºAmazon EC2å®ä¾‹å†…éƒ¨**ï¼Œä¸“ä¸ºå¤„ç†é«˜åº¦æ•æ„Ÿæ•°æ®è€Œè®¾è®¡ã€‚åˆ©ç”¨AWS Nitroç³»ç»Ÿï¼Œè¿™äº›é£åœ°ç¡®ä¿äº†å¼ºå¤§çš„**éš”ç¦»å’Œå®‰å…¨æ€§**ï¼Œéå¸¸é€‚åˆå¤„ç†è¯¸å¦‚PIIæˆ–è´¢åŠ¡è®°å½•ç­‰**æœºå¯†ä¿¡æ¯**ã€‚å®ƒä»¬å…·æœ‰æç®€ç¯å¢ƒï¼Œæ˜¾è‘—é™ä½äº†æ•°æ®æš´éœ²çš„é£é™©ã€‚æ­¤å¤–ï¼ŒNitro Enclavesæ”¯æŒåŠ å¯†è®¤è¯ï¼Œå…è®¸ç”¨æˆ·éªŒè¯åªæœ‰ç»æˆæƒçš„ä»£ç åœ¨è¿è¡Œï¼Œè¿™å¯¹äºä¿æŒä¸¥æ ¼çš„åˆè§„æ€§å’Œæ•°æ®ä¿æŠ¤æ ‡å‡†è‡³å…³é‡è¦ã€‚

{% hint style="danger" %}
Nitro Enclaveé•œåƒæ˜¯**ä»EC2å®ä¾‹å†…éƒ¨è¿è¡Œ**çš„ï¼Œæ‚¨æ— æ³•ä»AWS Webæ§åˆ¶å°çœ‹åˆ°EC2å®ä¾‹æ˜¯å¦åœ¨Nitro Enclaveä¸­è¿è¡Œé•œåƒã€‚
{% endhint %}

## Nitro Enclave CLIå®‰è£…

æŒ‰ç…§[**æ–‡æ¡£ä¸­çš„æ‰€æœ‰è¯´æ˜**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)ã€‚ç„¶è€Œï¼Œä»¥ä¸‹æ˜¯æœ€é‡è¦çš„æŒ‡ä»¤ï¼š
```bash
# Install tools
sudo amazon-linux-extras install aws-nitro-enclaves-cli -y
sudo yum install aws-nitro-enclaves-cli-devel -y

# Config perms
sudo usermod -aG ne $USER
sudo usermod -aG docker $USER

# Check installation
nitro-cli --version

# Start and enable the Nitro Enclaves allocator service.
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service
```
## Nitro Enclaveé•œåƒ

æ‚¨å¯ä»¥åœ¨Nitro Enclaveä¸­è¿è¡Œçš„é•œåƒåŸºäºdockeré•œåƒï¼Œå› æ­¤æ‚¨å¯ä»¥ä»dockeré•œåƒåˆ›å»ºæ‚¨çš„Nitro Enclaveé•œåƒï¼Œä¾‹å¦‚ï¼š
```bash
# You need to have the docker image accesible in your running local registry
# Or indicate the full docker image URL to access the image
nitro-cli build-enclave --docker-uri <docker-img>:<tag> --output-file nitro-img.eif
```
æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼ŒNitro Enclave å›¾åƒä½¿ç”¨æ‰©å±•å **`eif`**ï¼ˆEnclave Image Fileï¼‰ã€‚

è¾“å‡ºå°†ç±»ä¼¼äºï¼š
```
Using the locally available Docker image...
Enclave Image successfully created.
{
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
```
### è¿è¡Œé•œåƒ

æ ¹æ®[**æ–‡æ¡£**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)ï¼Œä¸ºäº†è¿è¡Œä¸€ä¸ªenclaveé•œåƒï¼Œæ‚¨éœ€è¦ä¸ºå…¶åˆ†é…**è‡³å°‘æ˜¯`eif`æ–‡ä»¶å¤§å°çš„4å€å†…å­˜**ã€‚å¯ä»¥åœ¨æ–‡ä»¶ä¸­é…ç½®è¦åˆ†é…ç»™å®ƒçš„é»˜è®¤èµ„æºã€‚
```shell
/etc/nitro_enclaves/allocator.yaml
```
{% hint style="danger" %}
å§‹ç»ˆè®°ä½ï¼Œæ‚¨è¿˜éœ€è¦ä¸ºçˆ¶EC2å®ä¾‹**ä¿ç•™ä¸€äº›èµ„æº**ï¼
{% endhint %}

åœ¨äº†è§£è¦ä¸ºæ˜ åƒæä¾›çš„èµ„æºå¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œå¯ä»¥è¿è¡Œä¸€ä¸ªenclaveæ˜ åƒï¼š
```shell
# Restart the service so the new default values apply
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service

# Indicate the CPUs and memory to give
nitro-cli run-enclave --cpu-count 2 --memory 3072 --eif-path hello.eif --debug-mode --enclave-cid 16
```
### æšä¸¾éš”ç¦»åŒº

å¦‚æœæ‚¨å…¥ä¾µäº†ä¸€ä¸ª EC2 ä¸»æœºï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–æ­£åœ¨è¿è¡Œçš„éš”ç¦»åŒºé•œåƒåˆ—è¡¨ï¼š
```bash
nitro-cli describe-enclaves
```
è¿™æ˜¯å› ä¸ºéš”ç¦»çš„ä¸»è¦ç›®çš„ï¼Œæ‰€ä»¥**æ— æ³•åœ¨è¿è¡Œä¸­çš„éš”ç¦»é•œåƒå†…è·å– shell**ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨äº†å‚æ•° **`--debug-mode`**ï¼Œåˆ™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å…¶ **stdout**ï¼š
```shell
ENCLAVE_ID=$(nitro-cli describe-enclaves | jq -r ".[0].EnclaveID")
nitro-cli console --enclave-id ${ENCLAVE_ID}
```
### ç»ˆæ­¢é£åœ°

å¦‚æœæ”»å‡»è€…å…¥ä¾µäº†ä¸€ä¸ª EC2 å®ä¾‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä»–å°†æ— æ³•åœ¨å…¶ä¸­è·å– shellï¼Œä½†ä»–å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤**ç»ˆæ­¢å®ƒä»¬**ï¼š
```shell
nitro-cli terminate-enclave --enclave-id ${ENCLAVE_ID}
```
## Vsock

ä¸è¿è¡Œé•œåƒçš„**enclave**é€šä¿¡çš„å”¯ä¸€æ–¹å¼æ˜¯ä½¿ç”¨**vsocks**ã€‚

**è™šæ‹Ÿå¥—æ¥å­—ï¼ˆvsockï¼‰**æ˜¯Linuxä¸­çš„ä¸€ç§å¥—æ¥å­—ç³»åˆ—ï¼Œä¸“é—¨è®¾è®¡ç”¨äºä¿ƒè¿›è™šæ‹Ÿæœºï¼ˆ**VMs**ï¼‰ä¸å®ƒä»¬çš„**hypervisors**ä¹‹é—´ï¼Œæˆ–è€…VMsä¹‹é—´çš„**é€šä¿¡**ã€‚Vsockå®ç°äº†é«˜æ•ˆçš„**åŒå‘é€šä¿¡**ï¼Œè€Œæ— éœ€ä¾èµ–ä¸»æœºçš„ç½‘ç»œå †æ ˆã€‚è¿™ä½¿å¾—VMså¯ä»¥åœ¨æ²¡æœ‰ç½‘ç»œé…ç½®çš„æƒ…å†µä¸‹è¿›è¡Œé€šä¿¡ï¼Œ**ä½¿ç”¨32ä½ä¸Šä¸‹æ–‡IDï¼ˆCIDï¼‰å’Œç«¯å£å·**æ¥æ ‡è¯†å’Œç®¡ç†è¿æ¥ã€‚vsock APIæ”¯æŒæµå’Œæ•°æ®æŠ¥å¥—æ¥å­—ç±»å‹ï¼Œç±»ä¼¼äºTCPå’ŒUDPï¼Œä¸ºè™šæ‹Ÿç¯å¢ƒä¸­çš„ç”¨æˆ·çº§åº”ç”¨ç¨‹åºæä¾›äº†å¤šåŠŸèƒ½å·¥å…·ã€‚

{% hint style="success" %}
å› æ­¤ï¼Œvsockåœ°å€çœ‹èµ·æ¥åƒè¿™æ ·ï¼š`<CID>:<Port>`
{% endhint %}

è¦æŸ¥æ‰¾è¿è¡Œé•œåƒçš„enclaveçš„**CIDs**ï¼Œæ‚¨åªéœ€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¹¶è·å–**`EnclaveCID`**ï¼š

<pre class="language-bash"><code class="lang-bash">nitro-cli describe-enclaves

[
{
"EnclaveName": "secure-channel-example",
"EnclaveID": "i-0bc274f83ade02a62-enc18ef3d09c886748",
"ProcessID": 10131,
<strong>    "EnclaveCID": 16,
</strong>    "NumberOfCPUs": 2,
"CPUIDs": [
1,
3
],
"MemoryMiB": 1024,
"State": "RUNNING",
"Flags": "DEBUG_MODE",
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
]
</code></pre>

{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œä»ä¸»æœºä¸Šæ— æ³•çŸ¥é“CIDæ˜¯å¦æš´éœ²ä»»ä½•ç«¯å£ï¼é™¤éä½¿ç”¨ä¸€äº›**vsockç«¯å£æ‰«æå·¥å…·ï¼Œæ¯”å¦‚**[**https://github.com/carlospolop/Vsock-scanner**](https://github.com/carlospolop/Vsock-scanner)ã€‚
{% endhint %}

### VsockæœåŠ¡å™¨/ç›‘å¬å™¨

è¿™é‡Œæœ‰ä¸€äº›ç¤ºä¾‹ï¼š

* [https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/server.py](https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/server.py)

<details>

<summary>ç®€å•çš„Pythonç›‘å¬å™¨</summary>
```python
#!/usr/bin/env python3

# From
https://medium.com/@F.DL/understanding-vsock-684016cf0eb0

import socket

CID = socket.VMADDR_CID_HOST
PORT = 9999

s = socket.socket(socket.AF_VSOCK, socket.SOCK_STREAM)
s.bind((CID, PORT))
s.listen()
(conn, (remote_cid, remote_port)) = s.accept()

print(f"Connection opened by cid={remote_cid} port={remote_port}")

while True:
buf = conn.recv(64)
if not buf:
break

print(f"Received bytes: {buf}")
```
</details>
```bash
# Using socat
socat VSOCK-LISTEN:<port>,fork EXEC:"echo Hello from server!"
```
### Vsock å®¢æˆ·ç«¯

ç¤ºä¾‹ï¼š

* [https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/client.py](https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/client.py)

<details>

<summary>ç®€å•çš„ Python å®¢æˆ·ç«¯</summary>
```python
#!/usr/bin/env python3

#From https://medium.com/@F.DL/understanding-vsock-684016cf0eb0

import socket

CID = socket.VMADDR_CID_HOST
PORT = 9999

s = socket.socket(socket.AF_VSOCK, socket.SOCK_STREAM)
s.connect((CID, PORT))
s.sendall(b"Hello, world!")
s.close()
```
</details>
```bash
# Using socat
echo "Hello, vsock!" | socat - VSOCK-CONNECT:3:5000
```
### Vsock ä»£ç†

å·¥å…· vsock-proxy å…è®¸ä»£ç†ä¸€ä¸ª vsock ä»£ç†åˆ°å¦ä¸€ä¸ªåœ°å€ï¼Œä¾‹å¦‚ï¼š
```bash
vsock-proxy 8001 ip-ranges.amazonaws.com 443 --config your-vsock-proxy.yaml
```
è¿™å°†æŠŠ**vsockä¸­çš„æœ¬åœ°ç«¯å£8001**è½¬å‘åˆ°`ip-ranges.amazonaws.com:443`ï¼Œè€Œæ–‡ä»¶**`your-vsock-proxy.yaml`**å¯èƒ½åŒ…å«ä»¥ä¸‹å†…å®¹ï¼Œå…è®¸è®¿é—®`ip-ranges.amazonaws.com:443`ï¼š
```yaml
allowlist:
- {address: ip-ranges.amazonaws.com, port: 443}
```
å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ EC2 ä¸»æœºä½¿ç”¨çš„ vsock åœ°å€ï¼ˆ**`<CID>:<Port>`**ï¼‰ï¼ˆè¯·æ³¨æ„ `3:8001`ï¼Œ3 æ˜¯ CIDï¼Œ8001 æ˜¯ç«¯å£ï¼‰ï¼š

{% code overflow="wrap" %}
```bash
sudo ss -l -p -n | grep v_str
v_str LISTEN 0      0                                                                              3:8001                   *:*     users:(("vsock-proxy",pid=9458,fd=3))
```
{% endcode %}

## Nitro Enclave Attestation & KMS

Nitro Enclaves SDK å…è®¸ä¸€ä¸ª enclave ä» Nitro Hypervisor è¯·æ±‚ä¸€ä¸ª**åŠ å¯†ç­¾åçš„è¯æ˜æ–‡ä»¶**ï¼Œå…¶ä¸­åŒ…å«ç‰¹å®šäºè¯¥ enclave çš„**å”¯ä¸€æµ‹é‡å€¼**ã€‚è¿™äº›æµ‹é‡å€¼åŒ…æ‹¬**å“ˆå¸Œå’Œå¹³å°é…ç½®å¯„å­˜å™¨ (PCRs)**ï¼Œåœ¨è¯æ˜è¿‡ç¨‹ä¸­ç”¨äº**è¯æ˜ enclave çš„èº«ä»½**å¹¶ä¸å¤–éƒ¨æœåŠ¡**å»ºç«‹ä¿¡ä»»**ã€‚è¯æ˜æ–‡ä»¶é€šå¸¸åŒ…å«åƒ PCR0ã€PCR1 å’Œ PCR2 è¿™æ ·çš„å€¼ï¼Œåœ¨æ„å»ºå’Œä¿å­˜ enclave EIF æ—¶ä½ å·²ç»é‡åˆ°è¿‡ã€‚

ä»[**æ–‡æ¡£**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-3-cryptographic-attestation#a-unique-feature-on-nitro-enclaves)ä¸­ï¼Œè¿™äº›æ˜¯ PCR å€¼ï¼š

<table><thead><tr><th width="97">PCR</th><th width="221">å“ˆå¸Œå€¼...</th><th>æè¿°</th></tr></thead><tbody><tr><td>PCR0</td><td>Enclave image file</td><td>å¯¹å›¾åƒæ–‡ä»¶å†…å®¹çš„è¿ç»­æµ‹é‡ï¼Œä¸åŒ…æ‹¬éƒ¨åˆ†æ•°æ®ã€‚</td></tr><tr><td>PCR1</td><td>Linux å†…æ ¸å’Œå¼•å¯¼ç¨‹åº</td><td>å¯¹å†…æ ¸å’Œå¼•å¯¼ ramfs æ•°æ®çš„è¿ç»­æµ‹é‡ã€‚</td></tr><tr><td>PCR2</td><td>åº”ç”¨ç¨‹åº</td><td>å¯¹ç”¨æˆ·åº”ç”¨ç¨‹åºçš„è¿ç»­ã€æœ‰åºæµ‹é‡ï¼Œä¸åŒ…æ‹¬å¼•å¯¼ ramfsã€‚</td></tr><tr><td>PCR3</td><td>åˆ†é…ç»™çˆ¶å®ä¾‹çš„ IAM è§’è‰²</td><td>å¯¹åˆ†é…ç»™çˆ¶å®ä¾‹çš„ IAM è§’è‰²çš„è¿ç»­æµ‹é‡ã€‚ç¡®ä¿åªæœ‰å½“çˆ¶å®ä¾‹å…·æœ‰æ­£ç¡®çš„ IAM è§’è‰²æ—¶ï¼Œè¯æ˜è¿‡ç¨‹æ‰ä¼šæˆåŠŸã€‚</td></tr><tr><td>PCR4</td><td>çˆ¶å®ä¾‹çš„å®ä¾‹ ID</td><td>å¯¹çˆ¶å®ä¾‹çš„ ID çš„è¿ç»­æµ‹é‡ã€‚ç¡®ä¿åªæœ‰å½“çˆ¶å®ä¾‹å…·æœ‰ç‰¹å®šå®ä¾‹ ID æ—¶ï¼Œè¯æ˜è¿‡ç¨‹æ‰ä¼šæˆåŠŸã€‚</td></tr><tr><td>PCR8</td><td>Enclave image file ç­¾åè¯ä¹¦</td><td>å¯¹ä¸º enclave å›¾åƒæ–‡ä»¶æŒ‡å®šçš„ç­¾åè¯ä¹¦çš„æµ‹é‡ã€‚ç¡®ä¿åªæœ‰å½“ enclave æ˜¯ä»ç”±ç‰¹å®šè¯ä¹¦ç­¾åçš„ enclave å›¾åƒæ–‡ä»¶å¼•å¯¼æ—¶ï¼Œè¯æ˜è¿‡ç¨‹æ‰ä¼šæˆåŠŸã€‚</td></tr></tbody></table>

æ‚¨å¯ä»¥å°†**åŠ å¯†è¯æ˜**é›†æˆåˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¹¶åˆ©ç”¨ä¸**AWS KMS**ç­‰æœåŠ¡çš„é¢„æ„å»ºé›†æˆã€‚AWS KMS å¯ä»¥**éªŒè¯ enclave çš„è¯æ˜**ï¼Œå¹¶åœ¨å…¶å¯†é’¥ç­–ç•¥ä¸­æä¾›åŸºäºè¯æ˜çš„æ¡ä»¶é”® (`kms:RecipientAttestation:ImageSha384` å’Œ `kms:RecipientAttestation:PCR`)ã€‚è¿™äº›ç­–ç•¥ç¡®ä¿ AWS KMS ä»…åœ¨ enclave çš„è¯æ˜æ–‡ä»¶æœ‰æ•ˆä¸”ç¬¦åˆ**æŒ‡å®šæ¡ä»¶**æ—¶æ‰å…è®¸ä½¿ç”¨ KMS å¯†é’¥æ‰§è¡Œæ“ä½œã€‚

{% hint style="success" %}
è¯·æ³¨æ„ï¼Œè°ƒè¯•æ¨¡å¼ä¸‹çš„ Enclaves ç”Ÿæˆçš„è¯æ˜æ–‡ä»¶ä¸­çš„ PCR å€¼ç”±é›¶ (`000000000000000000000000000000000000000000000000`) ç»„æˆã€‚å› æ­¤ï¼Œæ£€æŸ¥è¿™äº›å€¼çš„ KMS ç­–ç•¥å°†å¤±è´¥ã€‚
{% endhint %}

### PCR ç»•è¿‡

ä»æ”»å‡»è€…çš„è§’åº¦æ¥çœ‹ï¼Œæ³¨æ„åˆ°ä¸€äº› PCR å¯èƒ½å…è®¸ä¿®æ”¹ä¸€äº›éƒ¨åˆ†æˆ–å…¨éƒ¨ enclave å›¾åƒå¹¶ä»ç„¶æœ‰æ•ˆï¼ˆä¾‹å¦‚ï¼ŒPCR4 åªæ£€æŸ¥çˆ¶å®ä¾‹çš„ IDï¼Œå› æ­¤åœ¨è¯¥ EC2 ä¸­è¿è¡Œä»»ä½• enclave å›¾åƒå°†å…è®¸æ»¡è¶³è¿™ä¸ªæ½œåœ¨çš„ PCR è¦æ±‚ï¼‰ã€‚

å› æ­¤ï¼Œå…¥ä¾µäº† EC2 å®ä¾‹çš„æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿè¿è¡Œå…¶ä»– enclave å›¾åƒä»¥ç»•è¿‡è¿™äº›ä¿æŠ¤æªæ–½ã€‚

å¦‚ä½•ä¿®æ”¹/åˆ›å»ºæ–°å›¾åƒä»¥ç»•è¿‡æ¯ä¸ªä¿æŠ¤æªæ–½ï¼ˆç‰¹åˆ«æ˜¯é‚£äº›ä¸å¤ªæ˜æ˜¾çš„ä¿æŠ¤æªæ–½ï¼‰çš„ç ”ç©¶ä»åœ¨è¿›è¡Œä¸­ã€‚

## å‚è€ƒèµ„æ–™

* [https://medium.com/@F.DL/understanding-vsock-684016cf0eb0](https://medium.com/@F.DL/understanding-vsock-684016cf0eb0)
* AWS çš„ Nitro æ•™ç¨‹çš„æ‰€æœ‰éƒ¨åˆ†ï¼š[https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬**ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
