# AWS - Lambda Enum

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'Ä± takip edin.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## Lambda

Amazon Web Services (AWS) Lambda, sunucu saÄŸlama veya yÃ¶netimi gerektirmeyen **bir hesaplama hizmeti** olarak tanÄ±mlanÄ±r. Kod yÃ¼rÃ¼tme iÃ§in gereken kaynak tahsisini otomatik olarak yÃ¶netme yeteneÄŸiyle, yÃ¼ksek kullanÄ±labilirlik, Ã¶lÃ§eklenebilirlik ve gÃ¼venlik gibi Ã¶zellikleri saÄŸlar. Lambda'nÄ±n Ã¶nemli bir yÃ¶nÃ¼, **sadece kullanÄ±lan hesaplama sÃ¼resine dayalÄ± olarak Ã¼cretlendirilmesidir**, baÅŸlangÄ±Ã§ yatÄ±rÄ±mlarÄ± veya uzun vadeli yÃ¼kÃ¼mlÃ¼lÃ¼kler gerektirmez.

Bir lambda'yÄ± Ã§aÄŸÄ±rmak iÃ§in **Cloudwatch** ile istediÄŸiniz kadar sÄ±k Ã§aÄŸrÄ± yapabilirsiniz, bir **URL** ucu aÃ§abilir ve Ã§aÄŸrÄ± yapabilirsiniz, **API Gateway** Ã¼zerinden Ã§aÄŸrÄ± yapabilirsiniz veya hatta bir **S3** kovasÄ±ndaki verilerdeki deÄŸiÅŸiklikler veya bir **DynamoDB** tablosundaki gÃ¼ncellemeler gibi **olaylara** dayalÄ± olarak Ã§aÄŸrÄ± yapabilirsiniz.

Bir lambda'nÄ±n kodu **`/var/task`** dizininde depolanÄ±r.

### Lambda Takma AdÄ± AÄŸÄ±rlÄ±klarÄ±

Bir Lambda'nÄ±n **birkaÃ§ sÃ¼rÃ¼mÃ¼** olabilir.\
Ve **takma adlar** aracÄ±lÄ±ÄŸÄ±yla **birden fazla** sÃ¼rÃ¼mÃ¼ aÃ§Ä±ÄŸa Ã§Ä±karabilir. Takma ad iÃ§indeki her bir sÃ¼rÃ¼mÃ¼n **aÄŸÄ±rlÄ±klarÄ±**, **hangi takma adÄ±n Ã§aÄŸrÄ±yÄ± alacaÄŸÄ±nÄ±** belirler (Ã¶rneÄŸin, 90%-10% olabilir).\
EÄŸer takma adlardan **birinin kodu savunmasÄ±zsa**, saldÄ±rÄ±yÄ± alacak olan sÃ¼rÃ¼mÃ¼ne kadar **istekler gÃ¶nderebilirsiniz**.

![](<../../../.gitbook/assets/image (16) (1).png>)

### Kaynak Ä°zinleri

Lambda kaynak izinleri, lambda'nÄ±n baÅŸka hizmetler/hesaplar tarafÄ±ndan Ã§aÄŸrÄ±lmasÄ±na izin verir.\
Ã–rneÄŸin, bir lambda'ya **URL Ã¼zerinden herkese eriÅŸim izni** vermek iÃ§in aÅŸaÄŸÄ±daki politika kullanÄ±labilir:

<figure><img src="https://lh4.googleusercontent.com/4PNFKBdzr3nMrPqeKkTslgwWDKxkXMdQ1SNdv7NPHykj3GX8wODrQyXOFbjk4fxHfZ8pDm5ijWgk2Vq2EGXiPRT3TQfZf1fHycvdEKBuDxJDYos1CJeMHXSeg86ZB-Ol7CNtten6xkVFQj6AhDUEWNQJrQ=s2048" alt=""><figcaption></figcaption></figure>

Veya API Gateway'in onu Ã§aÄŸÄ±rmasÄ±na izin vermek iÃ§in:

<figure><img src="https://lh3.googleusercontent.com/Su0JlR0wBqb-99Z4N_2-_kMlX0Xzx2n_GpZuOPW5IeXR3FYbm8OHFDM3Ora1BpXiSjHpDVUlq4yEyXwaI3nBuze6DJ-wRf2ATsCuWbq0wuBCd34E9uIpqwheE6Cc_PopviI_93O_j2ZKXc1-AJtsBoLVUw=s2048" alt=""><figcaption></figcaption></figure>

### Lambda VeritabanÄ± Proxy'leri

EÅŸzamanlÄ± yÃ¼zlerce lambda isteÄŸi olduÄŸunda, her birinin bir veritabanÄ±na baÄŸlanÄ±p baÄŸlantÄ±yÄ± kapatmasÄ± gerekiyorsa, bu Ã§alÄ±ÅŸmayacak (lambda'lar durumsuzdur, baÄŸlantÄ±larÄ± aÃ§Ä±k tutamaz).\
Bu durumda, Lambda iÅŸlevleriniz veritabanÄ± yerine RDS Proxy ile etkileÅŸimde bulunursa. EÅŸzamanlÄ± Lambda iÅŸlevleri tarafÄ±ndan oluÅŸturulan birÃ§ok eÅŸzamanlÄ± baÄŸlantÄ±yÄ± Ã¶lÃ§eklendirmek iÃ§in gereken baÄŸlantÄ± havuzunu yÃ¶netir. Bu, Lambda uygulamalarÄ±nÄ±zÄ±n her iÅŸlev Ã§aÄŸrÄ±sÄ± iÃ§in yeni baÄŸlantÄ±lar oluÅŸturmak yerine mevcut baÄŸlantÄ±larÄ± **yeniden kullanabilmesini** saÄŸlar.

### Lambda EFS Dosya Sistemleri

Verileri korumak ve hatta paylaÅŸmak iÃ§in **Lambda'lar EFS'e eriÅŸebilir ve onlarÄ± baÄŸlayabilir**, bÃ¶ylece Lambda ondan okuma ve yazma yapabilir.

### Lambda KatmanlarÄ±

Bir Lambda _katmanÄ±_, ek kod veya diÄŸer iÃ§eriÄŸi iÃ§erebilen bir .zip dosyasÄ± arÅŸividir. Bir katman, kÃ¼tÃ¼phaneler, [Ã¶zel Ã§alÄ±ÅŸma zamanÄ±](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html), veri veya yapÄ±landÄ±rma dosyalarÄ± iÃ§erebilir.

Bir fonksiyonda **beÅŸ katmana kadar** dahil edilebilir. Bir katmanÄ± bir iÅŸleve dahil ettiÄŸinizde, iÃ§erikler yÃ¼rÃ¼tme ortamÄ±ndaki `/opt` dizinine Ã§Ä±karÄ±lÄ±r.

VarsayÄ±lan olarak, oluÅŸturduÄŸunuz katmanlar AWS hesabÄ±nÄ±za **Ã¶zeldir**. Bir katmanÄ± diÄŸer hesaplarla paylaÅŸmayÄ± veya katmanÄ± **genel** yapmayÄ± seÃ§ebilirsiniz. FarklÄ± bir hesap tarafÄ±ndan yayÄ±nlanan bir katmanÄ± tÃ¼keten iÅŸlevleriniz, katman sÃ¼rÃ¼mÃ¼ silindikten sonra veya katmana eriÅŸim izniniz iptal edildikten sonra **katman sÃ¼rÃ¼mÃ¼nÃ¼ kullanmaya devam edebilir**. Ancak, silinen bir katman sÃ¼rÃ¼mÃ¼nÃ¼ kullanarak yeni bir iÅŸlev oluÅŸturamaz veya iÅŸlevleri gÃ¼ncelleyemezsiniz.

Bir konteyner gÃ¶rÃ¼ntÃ¼sÃ¼ olarak daÄŸÄ±tÄ±lan iÅŸlevler katmanlarÄ± kullanmaz. Bunun yerine, gÃ¶rÃ¼ntÃ¼yÃ¼ oluÅŸtururken tercih ettiÄŸiniz Ã§alÄ±ÅŸma zamanÄ±nÄ±, kÃ¼tÃ¼phaneleri ve diÄŸer baÄŸÄ±mlÄ±lÄ±klarÄ± konteyner gÃ¶rÃ¼ntÃ¼sÃ¼ne paketlersiniz.

### Lambda UzantÄ±larÄ±

Lambda uzantÄ±larÄ±, Ã§eÅŸitli **izleme, gÃ¶zlemleme, gÃ¼venlik ve yÃ¶netim araÃ§larÄ±yla entegre olarak** iÅŸlevleri geliÅŸtirir. Bu uzantÄ±lar, [.zip arÅŸivleri kullanarak Lambda katmanlarÄ±](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html) veya [konteyner gÃ¶rÃ¼ntÃ¼sÃ¼ daÄŸÄ±tÄ±mlarÄ±nda](https://aws.amazon.com/blogs/compute/working-with-lambda-layers-and-extensions-in-container-images/) dahil edilen, iki modda Ã§alÄ±ÅŸÄ±r: **dahili** ve **harici**.

* **Dahili uzantÄ±lar**, dil Ã¶zgÃ¼ ortam deÄŸiÅŸkenleri ve sarmalama betikleri kullanarak Ã§alÄ±ÅŸma zamanÄ± sÃ¼reciyle birleÅŸir ve baÅŸlangÄ±cÄ±nÄ± deÄŸiÅŸtirir. Bu Ã¶zelleÅŸtirme, **Java Correto 8 ve 11, Node.js 10 ve 12 ve .NET Core 3.1** gibi bir dizi Ã§alÄ±ÅŸma zamanÄ± iÃ§in geÃ§erlidir.
* **Harici uzantÄ±lar**, ayrÄ± sÃ¼reÃ§ler olarak Ã§alÄ±ÅŸÄ±r ve Lambda iÅŸlevinin yaÅŸam dÃ¶ngÃ¼sÃ¼yle uyumlu bir ÅŸekilde Ã§alÄ±ÅŸÄ±r. **Node.js 10 ve 12, Python 3.7 ve 3.8, Ruby 2.5 ve 2.7, Java Corretto 8 ve 11, .NET Core 3.1** ve **Ã¶zel Ã§alÄ±ÅŸma zamanlarÄ±** gibi Ã§eÅŸitli Ã§alÄ±ÅŸma zamanlarÄ±yla uyumludur.

### Saptama

AWS Lambda, sunucu oluÅŸturmadan ve yÃ¶netmeden kod Ã§alÄ±ÅŸtÄ±rmanÄ±za olanak tanÄ±yan bir hizmettir. Lambda fonksiyonlarÄ±, olay tetikleyicileriyle iliÅŸkilendirilir ve bu olaylar gerÃ§ekleÅŸtiÄŸinde Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r. Lambda hizmetini saptamak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. **AWS Management Console** Ã¼zerinden Lambda hizmetine eriÅŸin.
2. **Lambda fonksiyonlarÄ±** bÃ¶lÃ¼mÃ¼nde, mevcut fonksiyonlarÄ± listeleyin.
3. Her bir fonksiyonun ayrÄ±ntÄ±larÄ±nÄ± inceleyin ve hedeflenen bilgileri toplayÄ±n.
4. **Lambda fonksiyonlarÄ±na iliÅŸkin IAM rollerini** kontrol edin ve gerektiÄŸinde izinleri sÄ±nÄ±rlayÄ±n.
5. **Lambda fonksiyonlarÄ±nÄ±n tetikleyicilerini** kontrol edin ve hedeflenen olaylarÄ± belirleyin.
6. **Lambda fonksiyonlarÄ±nÄ±n gÃ¼nlÃ¼klerini** kontrol edin ve potansiyel gÃ¼venlik aÃ§Ä±klarÄ±nÄ± tespit etmek iÃ§in analiz yapÄ±n.
7. **Lambda fonksiyonlarÄ±nÄ±n baÄŸÄ±mlÄ±lÄ±klarÄ±nÄ±** kontrol edin ve gÃ¼ncel olmayan veya gÃ¼venlik aÃ§Ä±klarÄ± olan kÃ¼tÃ¼phaneleri tespit edin.
8. **Lambda fonksiyonlarÄ±nÄ±n yapÄ±landÄ±rma ayarlarÄ±nÄ±** kontrol edin ve gerektiÄŸinde gÃ¼venlik Ã¶nlemleri alÄ±n.
9. **Lambda fonksiyonlarÄ±nÄ±n ortam deÄŸiÅŸkenlerini** kontrol edin ve hassas bilgilerin sÄ±zmasÄ±nÄ± Ã¶nlemek iÃ§in gerekli Ã¶nlemleri alÄ±n.
10. **Lambda fonksiyonlarÄ±nÄ±n eriÅŸim izinlerini** kontrol edin ve gerektiÄŸinde sÄ±nÄ±rlayÄ±n.

Bu adÄ±mlarÄ± takip ederek AWS Lambda hizmetini saptayabilir ve gÃ¼venlik aÃ§Ä±klarÄ±nÄ± tespit edebilirsiniz.

```bash
aws lambda get-account-settings

# List functions and get extra config info
aws lambda list-functions
aws lambda get-function --function-name <function_name>
aws lambda get-function-configuration --function-name <function_name>
aws lambda list-function-event-invoke-configs --function-name <function_name>
## Check for creds in env vars
aws lambda list-functions | jq '.Functions[].Environment'
## Download & check the source code
aws lambda get-function --function-name "<func_name>" --query 'Code.Location'
wget -O lambda-function.zip <url-from-previous-query>

# Get Lambda URL (if any)
aws lambda list-function-url-configs --function-name <function_name>
aws lambda get-function-url-config --function-name <function_name>

# Get who has permissions to invoke the Lambda
aws lambda get-policy --function-name <function_name>

# Versions and Aliases
aws lambda list-versions-by-function --function-name <func_name>
aws lambda list-aliases --function-name <func_name>

# List layers
aws lambda list-layers
aws lambda list-layer-versions --layer-name <name>
aws lambda get-layer-version --layer-name <name> --version-number <ver>
aws lambda get-layer-version-by-arn --arn <name> #Get external ARNs

# List other metadata
aws lambda list-event-source-mappings
aws lambda list-code-signing-configs
aws lambda list-functions-by-code-signing-config --code-signing-config-arn <arn>
```

#### Elle Ã‡aÄŸÄ±rma

AWS Lambda iÅŸlevini manuel olarak Ã§aÄŸÄ±rmak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyin:

1. AWS YÃ¶netim Konsolu'na gidin ve Lambda hizmetine geÃ§in.
2. Lambda iÅŸlevinizi seÃ§in.
3. "Test" dÃ¼ÄŸmesine tÄ±klayÄ±n.
4. "Yeni test etkinliÄŸi oluÅŸtur" seÃ§eneÄŸini seÃ§in.
5. Test etkinliÄŸi adÄ±nÄ± ve giriÅŸ verilerini belirtin.
6. "Test etkinliÄŸini oluÅŸtur" dÃ¼ÄŸmesine tÄ±klayÄ±n.
7. Ä°ÅŸlevin sonuÃ§larÄ±nÄ± ve hata mesajlarÄ±nÄ± kontrol edin.

Bu adÄ±mlarÄ± takip ederek, AWS Lambda iÅŸlevinizi manuel olarak Ã§aÄŸÄ±rabilirsiniz.

```bash
# Invoke function
aws lambda invoke --function-name FUNCTION_NAME /tmp/out
## Some functions will expect parameters, they will access them with something like:
## target_policys = event['policy_names']
## user_name = event['user_name']
aws lambda invoke --function-name <name> --cli-binary-format raw-in-base64-out --payload '{"policy_names": ["AdministratorAccess], "user_name": "sdf"}' out.txt
```

#### AÃ§Ä±ÄŸa Ã§Ä±kan URL Ã¼zerinden

If you find an exposed URL of an AWS Lambda function, you can use it to gather information about the function and potentially exploit it. Here are some steps you can follow:

1. Access the exposed URL in a web browser or using a tool like cURL.
2. Look for any sensitive information that may be leaked in the response, such as AWS access keys or other credentials.
3. Analyze the response headers for any security-related information, such as server version or configuration details.
4. Test for common vulnerabilities, such as SSRF (Server-Side Request Forgery) or code injection, by manipulating the URL parameters or payload.
5. Enumerate the function's permissions and roles to understand its capabilities and potential attack surface.
6. Use the exposed URL to trigger the function and observe its behavior. This can help identify any potential security weaknesses or misconfigurations.
7. Document your findings and report them to the appropriate parties for remediation.

By leveraging an exposed URL, you can gain valuable insights into the AWS Lambda function and potentially uncover security vulnerabilities. However, it's important to always obtain proper authorization before conducting any security testing.

```bash
aws lambda list-function-url-configs --function-name <function_name> #Get lambda URL
aws lambda get-function-url-config   --function-name <function_name> #Get lambda URL
```

#### URL Ã¼zerinden Lambda iÅŸlevini Ã§aÄŸÄ±rma

Åimdi, yÃ¼rÃ¼tÃ¼lebilecek olasÄ± lambda iÅŸlevlerini bulma zamanÄ± geldi:

```
aws --region us-west-2 --profile level6 lambda list-functions
```

![](<../../../.gitbook/assets/image (21) (1).png>)

Bir "Level6" adÄ±nda bir lambda fonksiyonu mevcut. Onu nasÄ±l Ã§aÄŸÄ±racaÄŸÄ±mÄ±zÄ± bulalÄ±m:

```bash
aws --region us-west-2 --profile level6 lambda get-policy --function-name Level6
```

Åimdi, ismi ve kimliÄŸi bildiÄŸin iÃ§in Ä°smi alabilirsin:

```bash
aws --profile level6 --region us-west-2 apigateway get-stages --rest-api-id "s33ppypa75"
```

![](<../../../.gitbook/assets/image (20).png>)

Ve son olarak, iÅŸlevi Ã§aÄŸÄ±rarak eriÅŸin (dikkat edin, ID, Ad ve iÅŸlev adÄ± URL'de gÃ¶rÃ¼nÃ¼r): [https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6](https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6)

`URL:`**`https://<rest-api-id>.execute-api.<region>.amazonaws.com/<stageName>/<funcName>`**

#### DiÄŸer Tetikleyiciler

Bir lambda'yÄ± tetikleyebilecek birÃ§ok baÅŸka kaynak vardÄ±r

<figure><img src="../../../.gitbook/assets/image (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

### Privesc

AÅŸaÄŸÄ±daki sayfada, **yetkileri yÃ¼kseltmek iÃ§in Lambda izinlerini kÃ¶tÃ¼ye kullanmanÄ±n** nasÄ±l yapÄ±lacaÄŸÄ±nÄ± kontrol edebilirsiniz:

{% content-ref url="../aws-privilege-escalation/aws-lambda-privesc.md" %}
[aws-lambda-privesc.md](../aws-privilege-escalation/aws-lambda-privesc.md)
{% endcontent-ref %}

### Kimlik DoÄŸrulamasÄ±z EriÅŸim

{% content-ref url="../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md" %}
[aws-lambda-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md)
{% endcontent-ref %}

### SonrasÄ± SÄ±zma

{% content-ref url="../aws-post-exploitation/aws-lambda-post-exploitation/" %}
[aws-lambda-post-exploitation](../aws-post-exploitation/aws-lambda-post-exploitation/)
{% endcontent-ref %}

### KalÄ±cÄ±lÄ±k

{% content-ref url="../aws-persistence/aws-lambda-persistence/" %}
[aws-lambda-persistence](../aws-persistence/aws-lambda-persistence/)
{% endcontent-ref %}

## Referanslar

* [https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer](https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer)
* [https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/](https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
