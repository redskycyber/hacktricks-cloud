# AWS - Lambda Enum

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## Lambda

Amazon Web Services (AWS) Lambdaæ˜¯ä¸€é¡¹è®¡ç®—æœåŠ¡ï¼Œå…è®¸æ‚¨**æ— éœ€é¢„é…æˆ–ç®¡ç†æœåŠ¡å™¨å³å¯è¿è¡Œä»£ç **ã€‚Lambda **è‡ªåŠ¨ç®¡ç†è¿è¡Œä»£ç æ‰€éœ€çš„èµ„æº**ï¼Œå¹¶æä¾›é«˜å¯ç”¨æ€§ã€æ‰©å±•æ€§å’Œå®‰å…¨åŠŸèƒ½ã€‚ä½¿ç”¨Lambdaï¼Œ**æ‚¨åªéœ€ä¸ºæ¶ˆè€—çš„è®¡ç®—æ—¶é—´ä»˜è´¹**ï¼Œæ— éœ€å‰æœŸæˆæœ¬æˆ–é•¿æœŸæ‰¿è¯ºã€‚

è¦è°ƒç”¨lambdaï¼Œå¯ä»¥é€šè¿‡**Cloudwatch** **é¢‘ç¹åœ°è°ƒç”¨**ï¼Œ**æš´éœ²**ä¸€ä¸ª**URL**ç«¯ç‚¹å¹¶è°ƒç”¨å®ƒï¼Œé€šè¿‡**API Gateway**è°ƒç”¨å®ƒï¼Œç”šè‡³å¯ä»¥åŸºäº**äº‹ä»¶**è°ƒç”¨ï¼Œä¾‹å¦‚**S3**å­˜å‚¨æ¡¶ä¸­çš„æ•°æ®**å˜åŒ–**æˆ–**DynamoDB**è¡¨çš„æ›´æ–°ã€‚

Lambdaçš„**ä»£ç **å­˜å‚¨åœ¨**`/var/task`**ä¸­ã€‚

### Lambda åˆ«åæƒé‡

ä¸€ä¸ªLambdaå¯ä»¥æœ‰**å¤šä¸ªç‰ˆæœ¬**ã€‚\
å¹¶ä¸”å¯ä»¥é€šè¿‡**åˆ«å**æš´éœ²**å¤šäº1ä¸ª**ç‰ˆæœ¬ã€‚åœ¨åˆ«åå†…æš´éœ²çš„**æ¯ä¸ª**ç‰ˆæœ¬çš„**æƒé‡**å°†å†³å®š**å“ªä¸ªåˆ«åæ¥æ”¶è°ƒç”¨**ï¼ˆä¾‹å¦‚å¯ä»¥æ˜¯90%-10%ï¼‰ã€‚\
å¦‚æœ**å…¶ä¸­ä¸€ä¸ª**åˆ«åçš„ä»£ç **å­˜åœ¨æ¼æ´**ï¼Œæ‚¨å¯ä»¥å‘é€**è¯·æ±‚ç›´åˆ°æ¼æ´**ç‰ˆæœ¬æ¥æ”¶åˆ°æ”»å‡»ã€‚

![](<../../../.gitbook/assets/image (16) (1).png>)

### èµ„æºç­–ç•¥

Lambdaèµ„æºç­–ç•¥å…è®¸**æˆäºˆå…¶ä»–æœåŠ¡/è´¦æˆ·è°ƒç”¨**lambdaçš„æƒé™ã€‚\
ä¾‹å¦‚ï¼Œè¿™æ˜¯å…è®¸**ä»»ä½•äººé€šè¿‡URLè®¿é—®lambda**çš„ç­–ç•¥ï¼š

<figure><img src="https://lh4.googleusercontent.com/4PNFKBdzr3nMrPqeKkTslgwWDKxkXMdQ1SNdv7NPHykj3GX8wODrQyXOFbjk4fxHfZ8pDm5ijWgk2Vq2EGXiPRT3TQfZf1fHycvdEKBuDxJDYos1CJeMHXSeg86ZB-Ol7CNtten6xkVFQj6AhDUEWNQJrQ=s2048" alt=""><figcaption></figcaption></figure>

æˆ–è€…è¿™ä¸ªå…è®¸API Gatewayè°ƒç”¨å®ƒï¼š

<figure><img src="https://lh3.googleusercontent.com/Su0JlR0wBqb-99Z4N_2-_kMlX0Xzx2n_GpZuOPW5IeXR3FYbm8OHFDM3Ora1BpXiSjHpDVUlq4yEyXwaI3nBuze6DJ-wRf2ATsCuWbq0wuBCd34E9uIpqwheE6Cc_PopviI_93O_j2ZKXc1-AJtsBoLVUw=s2048" alt=""><figcaption></figcaption></figure>

### Lambda æ•°æ®åº“ä»£ç†

å½“æœ‰**æ•°ç™¾ä¸ª**å¹¶å‘çš„lambdaè¯·æ±‚æ—¶ï¼Œå¦‚æœæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦**è¿æ¥å¹¶å…³é—­æ•°æ®åº“çš„è¿æ¥**ï¼Œè¿™æ˜¯è¡Œä¸é€šçš„ï¼ˆlambdasæ˜¯æ— çŠ¶æ€çš„ï¼Œä¸èƒ½ä¿æŒè¿æ¥æ‰“å¼€ï¼‰ã€‚\
ç„¶åï¼Œå¦‚æœæ‚¨çš„**Lambdaå‡½æ•°ä¸RDSä»£ç†äº¤äº’**è€Œä¸æ˜¯æ‚¨çš„æ•°æ®åº“å®ä¾‹ã€‚å®ƒå¤„ç†äº†ç”±å¹¶å‘Lambdaå‡½æ•°åˆ›å»ºçš„è®¸å¤šåŒæ—¶è¿æ¥æ‰€éœ€çš„è¿æ¥æ± ã€‚è¿™å…è®¸æ‚¨çš„Lambdaåº”ç”¨ç¨‹åº**é‡ç”¨ç°æœ‰è¿æ¥**ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªå‡½æ•°è°ƒç”¨åˆ›å»ºæ–°è¿æ¥ã€‚

### Lambda EFS æ–‡ä»¶ç³»ç»Ÿ

ä¸ºäº†ä¿å­˜ç”šè‡³å…±äº«æ•°æ®ï¼Œ**Lambdaså¯ä»¥è®¿é—®EFSå¹¶æŒ‚è½½å®ƒä»¬**ï¼Œå› æ­¤Lambdaå°†èƒ½å¤Ÿä»ä¸­è¯»å–å’Œå†™å…¥ã€‚

### Lambda å±‚

Lambda _å±‚_ æ˜¯ä¸€ä¸ª.zipæ–‡ä»¶å­˜æ¡£ï¼Œ**å¯ä»¥åŒ…å«é¢å¤–çš„ä»£ç **æˆ–å…¶ä»–å†…å®¹ã€‚å±‚å¯ä»¥åŒ…å«åº“ã€[è‡ªå®šä¹‰è¿è¡Œæ—¶](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html)ã€æ•°æ®æˆ–é…ç½®æ–‡ä»¶ã€‚

æ¯ä¸ªå‡½æ•°æœ€å¤šå¯ä»¥åŒ…å«**äº”ä¸ªå±‚**ã€‚å½“æ‚¨åœ¨å‡½æ•°ä¸­åŒ…å«ä¸€ä¸ªå±‚æ—¶ï¼Œ**å†…å®¹ä¼šè¢«æå–åˆ°æ‰§è¡Œç¯å¢ƒä¸­çš„`/opt`ç›®å½•**ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨åˆ›å»ºçš„**å±‚æ˜¯ç§æœ‰**äºæ‚¨çš„AWSè´¦æˆ·çš„ã€‚æ‚¨å¯ä»¥é€‰æ‹©**ä¸å…¶ä»–è´¦æˆ·å…±äº«**å±‚æˆ–**ä½¿**å±‚**å…¬å¼€**ã€‚å¦‚æœæ‚¨çš„å‡½æ•°ä½¿ç”¨äº†ä¸åŒè´¦æˆ·å‘å¸ƒçš„å±‚ï¼Œå³ä½¿è¯¥å±‚ç‰ˆæœ¬å·²è¢«åˆ é™¤ï¼Œæˆ–è€…æ‚¨è®¿é—®è¯¥å±‚çš„æƒé™è¢«æ’¤é”€ï¼Œæ‚¨çš„å‡½æ•°ä¹Ÿå¯ä»¥**ç»§ç»­ä½¿ç”¨è¯¥å±‚ç‰ˆæœ¬**ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¸èƒ½ä½¿ç”¨å·²åˆ é™¤çš„å±‚ç‰ˆæœ¬åˆ›å»ºæ–°å‡½æ•°æˆ–æ›´æ–°å‡½æ•°ã€‚

ä½œä¸ºå®¹å™¨æ˜ åƒéƒ¨ç½²çš„å‡½æ•°ä¸ä½¿ç”¨å±‚ã€‚ç›¸åï¼Œæ‚¨åœ¨æ„å»ºæ˜ åƒæ—¶å°†é¦–é€‰çš„è¿è¡Œæ—¶ã€åº“å’Œå…¶ä»–ä¾èµ–é¡¹æ‰“åŒ…åˆ°å®¹å™¨æ˜ åƒä¸­ã€‚

### Lambda æ‰©å±•

Lambdaæ‰©å±•ä½¿æ‚¨èƒ½å¤Ÿå¢å¼ºæ‚¨çš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ‰©å±•å°†å‡½æ•°ä¸æ‚¨é¦–é€‰çš„ç›‘æ§ã€å¯è§‚å¯Ÿæ€§ã€å®‰å…¨å’Œæ²»ç†å·¥å…·é›†æˆã€‚æ‚¨å¯ä»¥ä½¿ç”¨[Lambdaå±‚](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html)å°†æ‰©å±•æ·»åŠ åˆ°.zipå­˜æ¡£å‡½æ•°ä¸­ï¼Œæˆ–è€…å°†å®ƒä»¬åŒ…å«åœ¨[ä½œä¸ºå®¹å™¨æ˜ åƒéƒ¨ç½²çš„å‡½æ•°](https://aws.amazon.com/blogs/compute/working-with-lambda-layers-and-extensions-in-container-images/)çš„æ˜ åƒä¸­ã€‚

* **å†…éƒ¨æ‰©å±•**ä½œä¸º**è¿è¡Œæ—¶**è¿›ç¨‹çš„**ä¸€éƒ¨åˆ†è¿è¡Œ**ï¼Œä¸æ‚¨çš„ä»£ç **åŒè¿›ç¨‹**ã€‚å®ƒä»¬å…è®¸æ‚¨ä½¿ç”¨ç‰¹å®šäºè¯­è¨€çš„ç¯å¢ƒå˜é‡å’ŒåŒ…è£…è„šæœ¬ä¿®æ”¹**è¿è¡Œæ—¶è¿›ç¨‹çš„å¯åŠ¨**ã€‚å†…éƒ¨æ‰©å±•æ”¯æŒçš„ç”¨ä¾‹åŒ…æ‹¬è‡ªåŠ¨ä»£ç æ£€æµ‹ã€‚
* **å¤–éƒ¨æ‰©å±•**å…è®¸æ‚¨**è¿è¡Œä¸è¿è¡Œæ—¶ä¸åŒçš„è¿›ç¨‹**ï¼Œä½†ä»åœ¨ä¸Lambdaå‡½æ•°**ç›¸åŒçš„æ‰§è¡Œç¯å¢ƒ**ä¸­ã€‚å¤–éƒ¨æ‰©å±•å¯ä»¥**åœ¨è¿è¡Œæ—¶è¿›ç¨‹ä¹‹å‰å¯åŠ¨**ï¼Œå¹¶ä¸”å¯ä»¥**åœ¨è¿è¡Œæ—¶å…³é—­åç»§ç»­**ã€‚å¤–éƒ¨æ‰©å±•æ”¯æŒçš„ç”¨ä¾‹åŒ…æ‹¬åœ¨è°ƒç”¨ä¹‹å‰è·å–ç§˜å¯†ï¼Œæˆ–è€…åœ¨å‡½æ•°è°ƒç”¨ä¹‹å¤–å°†é¥æµ‹æ•°æ®å‘é€åˆ°è‡ªå®šä¹‰ç›®çš„åœ°ã€‚è¿™äº›æ‰©å±•ä½œä¸ºLambdaå‡½æ•°çš„ä¼´éšè¿›ç¨‹è¿è¡Œã€‚
### æšä¸¾
```bash
aws lambda get-account-settings

# List functions and get extra config info
aws lambda list-functions
aws lambda get-function --function-name <function_name>
aws lambda get-function-configuration --function-name <function_name>
aws lambda list-function-event-invoke-configs --function-name <function_name>
## Check for creds in env vars
aws lambda list-functions | jq '.Functions[].Environment'
## Download & check the source code
aws lambda get-function --function-name "<func_name>" --query 'Code.Location'
wget -O lambda-function.zip <url-from-previous-query>

# Get Lambda URL (if any)
aws lambda list-function-url-configs --function-name <function_name>
aws lambda get-function-url-config --function-name <function_name>

# Get who has permissions to invoke the Lambda
aws lambda get-policy --function-name <function_name>

# Versions and Aliases
aws lambda list-versions-by-function --function-name <func_name>
aws lambda list-aliases --function-name <func_name>

# List layers
aws lambda list-layers
aws lambda list-layer-versions --layer-name <name>
aws lambda get-layer-version --layer-name <name> --version-number <ver>
aws lambda get-layer-version-by-arn --arn <name> #Get external ARNs

# List other metadata
aws lambda list-event-source-mappings
aws lambda list-code-signing-configs
aws lambda list-functions-by-code-signing-config --code-signing-config-arn <arn>
```
### è°ƒç”¨ Lambda

#### æ‰‹åŠ¨
```bash
# Invoke function
aws lambda invoke --function-name FUNCTION_NAME /tmp/out
## Some functions will expect parameters, they will access them with something like:
## target_policys = event['policy_names']
## user_name = event['user_name']
aws lambda invoke --function-name <name> --cli-binary-format raw-in-base64-out --payload '{"policy_names": ["AdministratorAccess], "user_name": "sdf"}' out.txt
```
#### é€šè¿‡æš´éœ²çš„URL
```bash
aws lambda list-function-url-configs --function-name <function_name> #Get lambda URL
aws lambda get-function-url-config   --function-name <function_name> #Get lambda URL
```
#### é€šè¿‡ URL è°ƒç”¨ Lambda å‡½æ•°

ç°åœ¨æ˜¯æ—¶å€™æ‰¾å‡ºå¯èƒ½æ‰§è¡Œçš„ Lambda å‡½æ•°äº†ï¼š
```
aws --region us-west-2 --profile level6 lambda list-functions
```
![](<../../../.gitbook/assets/image (21) (1).png>)

ä¸€ä¸ªåä¸º "Level6" çš„ lambda å‡½æ•°å¯ç”¨ã€‚è®©æˆ‘ä»¬æ‰¾å‡ºå¦‚ä½•è°ƒç”¨å®ƒï¼š
```bash
aws --region us-west-2 --profile level6 lambda get-policy --function-name Level6
```
![](<../../../.gitbook/assets/image (69).png>)

ç°åœ¨ï¼Œæ‚¨çŸ¥é“äº†åç§°å’ŒIDï¼Œæ‚¨å¯ä»¥è·å–åç§°ï¼š
```bash
aws --profile level6 --region us-west-2 apigateway get-stages --rest-api-id "s33ppypa75"
```
```markdown
![](<../../../.gitbook/assets/image (20).png>)

æœ€åè°ƒç”¨å‡½æ•°è®¿é—®ï¼ˆæ³¨æ„ IDã€Name å’Œ function-name å‡ºç°åœ¨ URL ä¸­ï¼‰ï¼š[https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6](https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6)

`URL:`**`https://<rest-api-id>.execute-api.<region>.amazonaws.com/<stageName>/<funcName>`**

#### å…¶ä»–è§¦å‘å™¨

è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ¥æºå¯ä»¥è§¦å‘ lambda

<figure><img src="../../../.gitbook/assets/image (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

### æƒé™æå‡

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥å¦‚ä½•**æ»¥ç”¨ Lambda æƒé™æ¥å‡çº§æƒé™**ï¼š

{% content-ref url="../../aws-pentesting/aws-privilege-escalation/aws-lambda-privesc.md" %}
[aws-lambda-privesc.md](../../aws-pentesting/aws-privilege-escalation/aws-lambda-privesc.md)
{% endcontent-ref %}

### æœªç»è®¤è¯çš„è®¿é—®

{% content-ref url="../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md" %}
[aws-lambda-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md)
{% endcontent-ref %}

### åæœŸåˆ©ç”¨

{% content-ref url="../../aws-pentesting/aws-post-exploitation/aws-lambda-post-exploitation/" %}
[aws-lambda-post-exploitation](../../aws-pentesting/aws-post-exploitation/aws-lambda-post-exploitation/)
{% endcontent-ref %}

### æŒä¹…æ€§

{% content-ref url="../../aws-pentesting/aws-persistence/aws-lambda-persistence/" %}
[aws-lambda-persistence](../../aws-pentesting/aws-persistence/aws-lambda-persistence/)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer](https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs**](https://opensea.io/collection/the-peass-family) æ”¶è—
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
```
