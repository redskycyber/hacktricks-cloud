# AWS - Lambda Enum

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)\*\* ä¸Šå…³æ³¨\*\*æˆ‘ä»¬ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## Lambda

äºšé©¬é€Šç½‘ç»œæœåŠ¡ï¼ˆAWSï¼‰Lambda è¢«æè¿°ä¸ºä¸€ç§**è®¡ç®—æœåŠ¡**ï¼Œå®ƒä½¿ä»£ç èƒ½å¤Ÿåœ¨æ— éœ€æœåŠ¡å™¨æä¾›æˆ–ç®¡ç†çš„æƒ…å†µä¸‹æ‰§è¡Œã€‚å®ƒä»¥**è‡ªåŠ¨å¤„ç†ä»£ç æ‰§è¡Œæ‰€éœ€çš„èµ„æºåˆ†é…**ä¸ºç‰¹ç‚¹ï¼Œç¡®ä¿å…·æœ‰é«˜å¯ç”¨æ€§ã€å¯ä¼¸ç¼©æ€§å’Œå®‰å…¨æ€§ç­‰åŠŸèƒ½ã€‚Lambda çš„ä¸€ä¸ªé‡è¦æ–¹é¢æ˜¯å…¶å®šä»·æ¨¡å‹ï¼Œå…¶ä¸­**è´¹ç”¨ä»…åŸºäºä½¿ç”¨çš„è®¡ç®—æ—¶é—´**ï¼Œæ¶ˆé™¤äº†å¯¹åˆå§‹æŠ•èµ„æˆ–é•¿æœŸä¹‰åŠ¡çš„éœ€æ±‚ã€‚

è¦è°ƒç”¨ä¸€ä¸ª Lambdaï¼Œå¯ä»¥é€šè¿‡ **Cloudwatch** é¢‘ç¹è°ƒç”¨å®ƒï¼Œ**å…¬å¼€**ä¸€ä¸ª **URL** ç«¯ç‚¹å¹¶è°ƒç”¨å®ƒï¼Œé€šè¿‡ **API Gateway** è°ƒç”¨å®ƒï¼Œç”šè‡³åŸºäº **äº‹ä»¶**ï¼ˆå¦‚å¯¹ **S3** å­˜å‚¨æ¡¶ä¸­æ•°æ®çš„æ›´æ”¹æˆ–å¯¹ **DynamoDB** è¡¨çš„æ›´æ–°ï¼‰è°ƒç”¨å®ƒã€‚

Lambda çš„ä»£ç å­˜å‚¨åœ¨ **`/var/task`** ä¸­ã€‚

### Lambda åˆ«åæƒé‡

ä¸€ä¸ª Lambda å¯ä»¥æœ‰**å¤šä¸ªç‰ˆæœ¬**ã€‚\
å®ƒå¯ä»¥é€šè¿‡**åˆ«å**å…¬å¼€**å¤šä¸ª**ç‰ˆæœ¬ã€‚åœ¨åˆ«åä¸­å…¬å¼€çš„**æ¯ä¸ªç‰ˆæœ¬**çš„**æƒé‡**å°†å†³å®š**å“ªä¸ªåˆ«åæ¥æ”¶è°ƒç”¨**ï¼ˆä¾‹å¦‚å¯ä»¥æ˜¯ 90%-10%ï¼‰ã€‚\
å¦‚æœ**ä¸€ä¸ª**åˆ«åçš„ä»£ç **å­˜åœ¨æ¼æ´**ï¼Œæ‚¨å¯ä»¥å‘é€**è¯·æ±‚ç›´åˆ°æœ‰æ¼æ´çš„**ç‰ˆæœ¬æ¥æ”¶åˆ°åˆ©ç”¨ã€‚

![](<../../../.gitbook/assets/image (16) (1).png>)

### èµ„æºç­–ç•¥

Lambda èµ„æºç­–ç•¥å…è®¸**æˆäºˆå…¶ä»–æœåŠ¡/å¸æˆ·è°ƒç”¨** Lambda çš„æƒé™ã€‚\
ä¾‹å¦‚ï¼Œè¿™æ˜¯å…è®¸**ä»»ä½•äººè®¿é—®é€šè¿‡ URL å…¬å¼€çš„ Lambda** çš„ç­–ç•¥ï¼š

<figure><img src="https://lh4.googleusercontent.com/4PNFKBdzr3nMrPqeKkTslgwWDKxkXMdQ1SNdv7NPHykj3GX8wODrQyXOFbjk4fxHfZ8pDm5ijWgk2Vq2EGXiPRT3TQfZf1fHycvdEKBuDxJDYos1CJeMHXSeg86ZB-Ol7CNtten6xkVFQj6AhDUEWNQJrQ=s2048" alt=""><figcaption></figcaption></figure>

æˆ–è€…å…è®¸ API Gateway è°ƒç”¨å®ƒçš„ç­–ç•¥ï¼š

<figure><img src="https://lh3.googleusercontent.com/Su0JlR0wBqb-99Z4N_2-_kMlX0Xzx2n_GpZuOPW5IeXR3FYbm8OHFDM3Ora1BpXiSjHpDVUlq4yEyXwaI3nBuze6DJ-wRf2ATsCuWbq0wuBCd34E9uIpqwheE6Cc_PopviI_93O_j2ZKXc1-AJtsBoLVUw=s2048" alt=""><figcaption></figcaption></figure>

### Lambda æ•°æ®åº“ä»£ç†

å½“æœ‰**æ•°ç™¾ä¸ªå¹¶å‘ Lambda è¯·æ±‚**æ—¶ï¼Œå¦‚æœæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦**è¿æ¥å’Œå…³é—­åˆ°æ•°æ®åº“çš„è¿æ¥**ï¼Œè¿™æ ¹æœ¬è¡Œä¸é€šï¼ˆLambda æ˜¯æ— çŠ¶æ€çš„ï¼Œæ— æ³•ä¿æŒè¿æ¥å¼€æ”¾ï¼‰ã€‚\
å› æ­¤ï¼Œå¦‚æœæ‚¨çš„**Lambda å‡½æ•°ä¸ RDS ä»£ç†äº¤äº’**è€Œä¸æ˜¯ä¸æ•°æ®åº“å®ä¾‹äº¤äº’ã€‚å®ƒå¤„ç†äº†ç”±å¹¶å‘ Lambda å‡½æ•°åˆ›å»ºçš„è®¸å¤šåŒæ—¶è¿æ¥æ‰€éœ€çš„è¿æ¥æ± ã€‚è¿™å…è®¸æ‚¨çš„ Lambda åº”ç”¨ç¨‹åº**é‡ç”¨ç°æœ‰è¿æ¥**ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªå‡½æ•°è°ƒç”¨åˆ›å»ºæ–°è¿æ¥ã€‚

### Lambda EFS æ–‡ä»¶ç³»ç»Ÿ

ä¸ºäº†ä¿ç•™ç”šè‡³å…±äº«æ•°æ®ï¼Œ**Lambda å¯ä»¥è®¿é—® EFS å¹¶æŒ‚è½½å®ƒä»¬**ï¼Œå› æ­¤ Lambda å°†èƒ½å¤Ÿä»ä¸­è¯»å–å’Œå†™å…¥ã€‚

### Lambda å±‚

Lambda çš„ _layer_ æ˜¯ä¸€ä¸ª .zip æ–‡ä»¶å­˜æ¡£ï¼Œ**å¯ä»¥åŒ…å«é™„åŠ ä»£ç **æˆ–å…¶ä»–å†…å®¹ã€‚ä¸€ä¸ªå±‚å¯ä»¥åŒ…å«åº“ã€[è‡ªå®šä¹‰è¿è¡Œæ—¶](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html)ã€æ•°æ®æˆ–é…ç½®æ–‡ä»¶ã€‚

æ¯ä¸ªå‡½æ•°æœ€å¤šå¯ä»¥åŒ…å«**äº”ä¸ªå±‚**ã€‚å½“æ‚¨åœ¨å‡½æ•°ä¸­åŒ…å«ä¸€ä¸ªå±‚æ—¶ï¼Œ**å†…å®¹ä¼šè¢«æå–åˆ°æ‰§è¡Œç¯å¢ƒä¸­çš„ `/opt` ç›®å½•**ä¸­ã€‚

**é»˜è®¤æƒ…å†µä¸‹**ï¼Œæ‚¨åˆ›å»ºçš„**å±‚**å¯¹æ‚¨çš„ AWS å¸æˆ·æ˜¯**ç§æœ‰**çš„ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä¸å…¶ä»–å¸æˆ·**å…±äº«**ä¸€ä¸ªå±‚ï¼Œæˆ–è€…å°†è¯¥å±‚**å…¬å¼€**ã€‚å¦‚æœæ‚¨çš„å‡½æ•°ä½¿ç”¨äº†å¦ä¸€ä¸ªå¸æˆ·å‘å¸ƒçš„å±‚ï¼Œæ‚¨çš„å‡½æ•°å¯ä»¥åœ¨**åˆ é™¤è¯¥å±‚ç‰ˆæœ¬åç»§ç»­ä½¿ç”¨è¯¥å±‚ç‰ˆæœ¬ï¼Œæˆ–è€…åœ¨æ‚¨çš„è®¿é—®æƒé™è¢«æ’¤é”€åç»§ç»­ä½¿ç”¨è¯¥å±‚**ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¸èƒ½ä½¿ç”¨å·²åˆ é™¤çš„å±‚ç‰ˆæœ¬åˆ›å»ºæ–°å‡½æ•°æˆ–æ›´æ–°å‡½æ•°ã€‚

ä½œä¸ºå®¹å™¨æ˜ åƒéƒ¨ç½²çš„å‡½æ•°ä¸ä½¿ç”¨å±‚ã€‚ç›¸åï¼Œåœ¨æ„å»ºæ˜ åƒæ—¶ï¼Œæ‚¨å°†é¦–é€‰çš„è¿è¡Œæ—¶ã€åº“å’Œå…¶ä»–ä¾èµ–é¡¹æ‰“åŒ…åˆ°å®¹å™¨æ˜ åƒä¸­ã€‚

### Lambda æ‰©å±•

Lambda æ‰©å±•é€šè¿‡ä¸å„ç§**ç›‘æ§ã€å¯è§‚å¯Ÿæ€§ã€å®‰å…¨æ€§å’Œæ²»ç†å·¥å…·**é›†æˆæ¥å¢å¼ºå‡½æ•°ã€‚è¿™äº›æ‰©å±•é€šè¿‡ [.zip å­˜æ¡£ä½¿ç”¨ Lambda å±‚](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html) æ·»åŠ ï¼Œæˆ–åŒ…å«åœ¨[å®¹å™¨æ˜ åƒéƒ¨ç½²](https://aws.amazon.com/blogs/compute/working-with-lambda-layers-and-extensions-in-container-images/)ä¸­ï¼Œä»¥**å†…éƒ¨**å’Œ**å¤–éƒ¨**ä¸¤ç§æ¨¡å¼è¿è¡Œã€‚

* **å†…éƒ¨æ‰©å±•**ä¸è¿è¡Œæ—¶è¿›ç¨‹åˆå¹¶ï¼Œä½¿ç”¨**ç‰¹å®šäºè¯­è¨€çš„ç¯å¢ƒå˜é‡**å’Œ**åŒ…è£…è„šæœ¬**æ“çºµå…¶å¯åŠ¨ã€‚è¿™ç§å®šåˆ¶é€‚ç”¨äºä¸€ç³»åˆ—è¿è¡Œæ—¶ï¼ŒåŒ…æ‹¬**Java Correto 8 å’Œ 11ã€Node.js 10 å’Œ 12ï¼Œä»¥åŠ .NET Core 3.1**ã€‚
* **å¤–éƒ¨æ‰©å±•**ä½œä¸ºç‹¬ç«‹è¿›ç¨‹è¿è¡Œï¼Œä¿æŒä¸ Lambda å‡½æ•°ç”Ÿå‘½å‘¨æœŸçš„æ“ä½œå¯¹é½ã€‚å®ƒä»¬ä¸å„ç§è¿è¡Œæ—¶å…¼å®¹ï¼Œå¦‚**Node.js 10 å’Œ 12ã€Python 3.7 å’Œ 3.8ã€Ruby 2.5 å’Œ 2.7ã€Java Corretto 8 å’Œ 11ã€.NET Core 3.1**ï¼Œä»¥åŠ**è‡ªå®šä¹‰è¿è¡Œæ—¶**ã€‚

### æšä¸¾

```bash
aws lambda get-account-settings

# List functions and get extra config info
aws lambda list-functions
aws lambda get-function --function-name <function_name>
aws lambda get-function-configuration --function-name <function_name>
aws lambda list-function-event-invoke-configs --function-name <function_name>
## Check for creds in env vars
aws lambda list-functions | jq '.Functions[].Environment'
## Download & check the source code
aws lambda get-function --function-name "<func_name>" --query 'Code.Location'
wget -O lambda-function.zip <url-from-previous-query>

# Get Lambda URL (if any)
aws lambda list-function-url-configs --function-name <function_name>
aws lambda get-function-url-config --function-name <function_name>

# Get who has permissions to invoke the Lambda
aws lambda get-policy --function-name <function_name>

# Versions and Aliases
aws lambda list-versions-by-function --function-name <func_name>
aws lambda list-aliases --function-name <func_name>

# List layers
aws lambda list-layers
aws lambda list-layer-versions --layer-name <name>
aws lambda get-layer-version --layer-name <name> --version-number <ver>
aws lambda get-layer-version-by-arn --arn <name> #Get external ARNs

# List other metadata
aws lambda list-event-source-mappings
aws lambda list-code-signing-configs
aws lambda list-functions-by-code-signing-config --code-signing-config-arn <arn>
```

### è°ƒç”¨lambda

#### æ‰‹åŠ¨

```bash
# Invoke function
aws lambda invoke --function-name FUNCTION_NAME /tmp/out
## Some functions will expect parameters, they will access them with something like:
## target_policys = event['policy_names']
## user_name = event['user_name']
aws lambda invoke --function-name <name> --cli-binary-format raw-in-base64-out --payload '{"policy_names": ["AdministratorAccess], "user_name": "sdf"}' out.txt
```

#### é€šè¿‡æš´éœ²çš„URL

```bash
aws lambda list-function-url-configs --function-name <function_name> #Get lambda URL
aws lambda get-function-url-config   --function-name <function_name> #Get lambda URL
```

#### é€šè¿‡URLè°ƒç”¨Lambdaå‡½æ•°

ç°åœ¨æ˜¯æ—¶å€™æ‰¾å‡ºå¯èƒ½è¦æ‰§è¡Œçš„Lambdaå‡½æ•°äº†ï¼š

```
aws --region us-west-2 --profile level6 lambda list-functions
```

ä¸€ä¸ªåä¸º"Level6"çš„lambdaå‡½æ•°å¯ç”¨ã€‚è®©æˆ‘ä»¬æ‰¾å‡ºå¦‚ä½•è°ƒç”¨å®ƒï¼š

```bash
aws --region us-west-2 --profile level6 lambda get-policy --function-name Level6
```

ç°åœ¨ï¼Œæ‚¨å·²ç»çŸ¥é“åç§°å’ŒIDï¼Œæ‚¨å¯ä»¥è·å–åç§°ï¼š

```bash
aws --profile level6 --region us-west-2 apigateway get-stages --rest-api-id "s33ppypa75"
```

![](<../../../.gitbook/assets/image (20).png>)

æœ€åè°ƒç”¨å‡½æ•°è®¿é—®ï¼ˆæ³¨æ„URLä¸­çš„IDã€åç§°å’Œå‡½æ•°åç§°ï¼‰ï¼š[https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6](https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6)

`URL:`**`https://<rest-api-id>.execute-api.<region>.amazonaws.com/<stageName>/<funcName>`**

#### å…¶ä»–è§¦å‘å™¨

æœ‰è®¸å¤šå…¶ä»–æ¥æºå¯ä»¥è§¦å‘ Lambda

<figure><img src="../../../.gitbook/assets/image (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

### ææƒ

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨ Lambda æƒé™ä»¥æå‡ç‰¹æƒ**ï¼š

{% content-ref url="../aws-privilege-escalation/aws-lambda-privesc.md" %}
[aws-lambda-privesc.md](../aws-privilege-escalation/aws-lambda-privesc.md)
{% endcontent-ref %}

### æœªç»èº«ä»½éªŒè¯çš„è®¿é—®

{% content-ref url="../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md" %}
[aws-lambda-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md)
{% endcontent-ref %}

### åæ¸—é€

{% content-ref url="../aws-post-exploitation/aws-lambda-post-exploitation/" %}
[aws-lambda-post-exploitation](../aws-post-exploitation/aws-lambda-post-exploitation/)
{% endcontent-ref %}

### æŒä¹…æ€§

{% content-ref url="../aws-persistence/aws-lambda-persistence/" %}
[aws-lambda-persistence](../aws-persistence/aws-lambda-persistence/)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer](https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer)
* [https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/](https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)ç³»åˆ—
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)\*\* ä¸Šå…³æ³¨æˆ‘ä»¬\*\*ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
