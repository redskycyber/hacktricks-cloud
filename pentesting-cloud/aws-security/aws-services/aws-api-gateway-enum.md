# AWS - API рдЧреЗрдЯрд╡реЗ рдЗрдирдо

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS рд░реЗрдб рдЯреАрдо рдПрдХреНрд╕рдкрд░реНрдЯ)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## API рдЧреЗрдЯрд╡реЗ

### рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

AWS API рдЧреЗрдЯрд╡реЗ рдПрдХ рд╡реНрдпрд╛рдкрдХ рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ рдбреЗрд╡рд▓рдкрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИ рддрд╛рдХрд┐ рд╡реЗ **рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░ API рдмрдирд╛ рд╕рдХреЗрдВ, рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░ рд╕рдХреЗрдВ, рдФрд░ рдкрд░реНрдпрд╡реЗрдХреНрд╖рдг рдХрд░ рд╕рдХреЗрдВ**ред рдпрд╣ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдбреЗрд╡рд▓рдкрд░реЛрдВ рдХреЛ рдирд┐рдпрдо рдФрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рдПрдХ рдврд╛рдВрдЪрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрд╣ рдврд╛рдВрдЪрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ **рдХрд┐ рдмрд╛рд╣реНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдбреЗрдЯрд╛ рдпрд╛ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдУрдВ рддрдХ рдХреИрд╕реЗ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ**ред

API рдЧреЗрдЯрд╡реЗ рдЖрдкрдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ **рдХрд┐ рдЖрдкрдХреА API рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдХреИрд╕реЗ рд╕рдВрднрд╛рд▓реЗ рдЬрд╛рдиреЗ рдЪрд╛рд╣рд┐рдП**, рдФрд░ рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд╡рд┐рдзрд┐рдпреЛрдВ (рдЬреИрд╕реЗ рдХрд┐ GET, POST, PUT, DELETE) рдФрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╕реНрдЯрдо API рдЗрдВрдбрдкреЙрдЗрдВрдЯ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдбреЗрд╡рд▓рдкрд░реЛрдВ рдХреЛ рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЗ рдЕрдкрдиреА API рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╣рдЬ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЗрдВрдЯ SDKs (рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдХрд┐рдЯреНрд╕) рднреА рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### API рдЧреЗрдЯрд╡реЗ рдкреНрд░рдХрд╛рд░

* **HTTP API**: OIDC рдФрд░ OAuth2 рдЬреИрд╕реА рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рд▓реЛ-рд▓реИрдЯреЗрдВрд╕реА рдФрд░ рд▓рд╛рдЧрдд-рдХреБрд╢рд▓ REST API рдмрдирд╛рдПрдВ, рдФрд░ рдореВрд▓рд┐рдХ CORS рд╕рдорд░реНрдерди рдХреЗ рд╕рд╛рдеред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: Lambda, HTTP рдмреИрдХрдПрдВрдбред
* **WebSocket API**: рдЪреИрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ рдбреИрд╢рдмреЛрд░реНрдб рдЬреИрд╕реЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдХреЗ рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдпреА рдХрдиреЗрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡реЗрдмрд╕реЙрдХреЗрдЯ API рдмрдирд╛рдПрдВред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: Lambda, HTTP, AWS рд╕реЗрд╡рд╛рдПрдВред
* **REST API**: REST API рд╡рд┐рдХрд╕рд┐рдд рдХрд░реЗрдВ рдЬрд╣рд╛рдВ рдЖрдкрдХреЛ рдЕрдиреБрд░реЛрдз рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкрд░ рдкреВрд░рд╛ рдирд┐рдпрдВрддреНрд░рдг рдорд┐рд▓рддрд╛ рд╣реИ рд╕рд╛рде рд╣реА API рдкреНрд░рдмрдВрдзрди рдХреНрд╖рдорддрд╛рдПрдВред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: Lambda, HTTP, AWS рд╕реЗрд╡рд╛рдПрдВред
* **REST API рдирд┐рдЬреА**: рдПрдХ REST API рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдХрд╛ рдХреЗрд╡рд▓ рдПрдХ VPC рдХреЗ рднреАрддрд░ рд╕реЗ рд╣реА рдкрд╣реБрдВрдЪ рд╣реЛрддреА рд╣реИред

### API рдЧреЗрдЯрд╡реЗ рдореБрдЦреНрдп рдШрдЯрдХ

1. **рд╕рдВрд╕рд╛рдзрди**: API рдЧреЗрдЯрд╡реЗ рдореЗрдВ, рд╕рдВрд╕рд╛рдзрди рд╡реЗ рдШрдЯрдХ рд╣реИрдВ рдЬреЛ **рдЖрдкрдХреА API рдХреА рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╣реИрдВ**ред рд╡реЗ **рдЖрдкрдХреА API рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдкрде рдпрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ** рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреА API рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рд╡рд┐рднрд┐рдиреНрди рдХреНрд░рд┐рдпрд╛рдПрдВ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреЗ рд╣реИрдВред рдПрдХ рд╕рдВрд╕рд╛рдзрди рд╣реИ рдкреНрд░рддреНрдпреЗрдХ рдкрде (рдЬреИрд╕реЗ, GET, POST, PUT, DELETE) **рдХреЗ рднреАрддрд░ рдкреНрд░рддреНрдпреЗрдХ рд╡рд┐рдзрд┐** (/, рдпрд╛ /users, рдпрд╛ /user/{id}ред
2. **рд╕реНрдЯреЗрдЬ**: API рдЧреЗрдЯрд╡реЗ рдореЗрдВ рд╕реНрдЯреЗрдЬ рдЖрдкрдХреА API рдХреЗ **рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ рд╡рд╛рддрд╛рд╡рд░рдг** рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рд╡рд┐рдХрд╛рд╕, рд╕реНрдЯреЗрдЬрд┐рдВрдЧ, рдпрд╛ рдЙрддреНрдкрд╛рджрдиред рдЖрдк рд╕реНрдЯреЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреА API рдХреЗ **рдПрдХ рд╕рд╛рде рдХрдИ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдФрд░ рдбрд┐рдкреНрд▓реЙрдп** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЖрдк рдирдП рд╕реБрд╡рд┐рдзрд╛рдПрдВ рдпрд╛ рдмрдЧ рдареАрдХ рдХрд░рдиреЗ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдмрд┐рдирд╛ рдЙрддреНрдкрд╛рджрди рд╡рд╛рддрд╛рд╡рд░рдг рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд┐рдПред рд╕реНрдЯреЗрдЬ рднреА **рд╕реНрдЯреЗрдЬ рдЪрд░рдг** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдХреБрдВрдЬреА-рдореВрд▓реНрдп рдЬреЛрдбрд╝реА рд╣реИрдВ рдЬреЛ рдЖрдкрдХреА API рдХреЗ рд╡рд░реНрддрдорд╛рди рд╕реНрдЯреЗрдЬ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЙрд╕рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рд╕реНрдЯреЗрдЬ рдЪрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ API рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рд▓реИрдореНрдмрдбрд╛ рдлрд╝рдВрдХреНрд╢рди рдпрд╛ рдЕрдиреНрдп рдмреИрдХрдПрдВрдб рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
* рд╕реНрдЯреЗрдЬ рдХреЛ API рдЧреЗрдЯрд╡реЗ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ URL рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
3. **рдСрдерд░рд╛рдЗрдЬрд╝рд░реНрд╕**: API рдЧреЗрдЯрд╡реЗ рдореЗрдВ рдСрдерд░рд╛рдЗрдЬрд╝рд░реНрд╕ рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИрдВ **рдЖрдкрдХреА API рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИрдВ рдЬреЛ рдЕрдиреБрд░реЛрдз рдХреЛ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреЙрд▓рд░ рдХреА рдкрд╣рдЪрд╛рди рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдЖрдк **AWS рд▓реИрдореНрдмрдбрд╛ рдлрд╝рдВрдХреНрд╢рди** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╕реНрдЯрдо рдСрдерд░рд╛рдЗрдЬрд╝рд░реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЖрдк рдЕрдкрдиреА рдЦреБрдж рдХреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдЕрдзрд┐рдХреГрддрд┐ рддрд░реНрдХ рдХреЛ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЬрдм рдПрдХ рдЕрдиреБрд░реЛрдз рдЖрддрд╛ рд╣реИ, API рдЧреЗрдЯрд╡реЗ рдЕрдиреБрд░реЛрдз рдХреА рдСрдерд░рд╛рдЗрдЬрд╝реЗрд╢рди рдЯреЛрдХрди рдХреЛ рд▓реИрдореНрдмрдбрд╛ рдСрдерд░рд╛рдЗрдЬрд╝рд░ рдХреЛ рдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЯреЛрдХрди рдХреЛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ IAM рдиреАрддрд┐ рд▓реМрдЯрд╛рддрд╛ рд╣реИ рдЬреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдХреЙрд▓рд░ рдХреЛ рдХреМрди-рдХреМрди рд╕реЗ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред API рдЧреЗрдЯрд╡реЗ рдЕрдзрд┐рдХрд╛рд░рд┐рдпреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рднреА рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ **AWS рдЖрдЗрдбреЗрдВрдЯрд┐рдЯреА рдФрд░ рдПрдХреНрд╕реЗрд╕ рдкреНрд░рдмрдВрдзрди (IAM)** рдФрд░ **рдЕрдореЗрдЬрд╝рди рдХреЛрдЧреНрдирд┐рдЯреЛ**ред
4. **рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐**: API рдЧреЗрдЯрд╡реЗ рдореЗрдВ рдПрдХ рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐ рдПрдХ JSON рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╣реИ рдЬреЛ **рдЖрдкрдХреА API рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ**ред рдпрд╣ рдПрдХ IAM рдиреАрддрд┐ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд╣реИ рд▓реЗрдХрд┐рди рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ API рдЧреЗрдЯрд╡реЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЖрдк рдПрдХ рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рдЖрдкрдХреА API рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ, рд╡реЗ рдХреМрди-рдХреМрди рд╕реА рд╡рд┐рдзрд┐рдпрд╛рдБ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдХрд┐рд╕ IP рдкрддреЛрдВ рдпрд╛ VPC рд╕реЗ рд╡реЗ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред **рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдСрдерд░рд╛рдЗрдЬрд╝рд░реНрд╕ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** рддрд╛рдХрд┐ рдЖрдкрдХреА API рдХреЗ рд▓рд┐рдП рдлрд╛рдЗрди-рдЧреНрд░реЗрдиреНрдб рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* рдЗрд╕реЗ рдкреНрд░рднрд╛рд╡реА рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП API рдХреЛ **рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдлрд┐рд░ рд╕реЗ рдбрд┐рдкреНрд▓реЙрдп рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП**ред

### рд▓реЙрдЧрд┐рдВрдЧ

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, **CloudWatch рд▓реЙрдЧ** рдмрдВрдж рд╣реИрдВ, **рдПрдХреНрд╕реЗрд╕ рд▓реЙрдЧрд┐рдВрдЧ** рдмрдВрдж рд╣реИ, рдФрд░ **X-рд░реЗ рдЯреНрд░реЗрд╕рд┐рдВрдЧ** рдн
```bash
# Generic info
aws apigateway get-account
aws apigateway get-domain-names
aws apigateway get-usage-plans
aws apigateway get-vpc-links
aws apigateway get-client-certificates

# Enumerate APIs
aws apigateway get-rest-apis # This will also show the resource policy (if any)
## Get stages
aws apigateway get-stages --rest-api-id <id>
## Get resources
aws apigateway get-resources --rest-api-id <id>
## Get API resource action per HTTP verb (check authorizers and api key required)
aws apigateway get-method --http-method GET --rest-api-id <api-id> --resource-id <resource-id>

## Call API
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>
## API authorizers
aws apigateway get-authorizers --rest-api-id <id>
## Models
aws apigateway get-models --rest-api-id <id>
## More info
aws apigateway get-gateway-responses --rest-api-id <id>
aws apigateway get-request-validators --rest-api-id <id>
aws apigateway get-deployments --rest-api-id <id>

# Get api keys generated
aws apigateway get-api-keys --include-value
aws apigateway get-api-key --api-key <id> --include-value # Get just 1
## Example use API key
curl -X GET -H "x-api-key: AJE&Ygenu4[..]" https://e83uuftdi8.execute-api.us-east-1.amazonaws.com/dev/test
## Usage plans
aws apigateway get-usage-plans #Get limit use info
aws apigateway get-usage-plan-keys --usage-plan-id <plan_id> #Get clear text values of api keys
aws apigateway get-usage-plan-key --usage-plan-id <plan_id> --key-id <key_id>
###Already consumed
aws apigateway get-usage --usage-plan-id <plan_id> --start-date 2023-07-01 --end-date 2023-07-12
```
{% endtab %}

{% tab title="apigatewayv2" %}рд╣рдореЗрдВ рдПрдкреАрдЖрдИ рдЧреЗрдЯрд╡реЗ рд╡рд░реНрдЬрди 2 рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рд╡рд░рдг рдкреНрд░рд╛рдкреНрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:
```bash
# Generic info
aws apigatewayv2 get-account --
aws apigatewayv2 get-domain-names
aws apigatewayv2 get-domain-name --domain-name <name>
aws apigatewayv2 get-usage-plans --
aws apigatewayv2 get-vpc-links
aws apigatewayv2 get-client-certificates --

# Enumerate APIs
aws apigatewayv2 get-apis # This will also show the resource policy (if any)
aws apigatewayv2 get-api --api-id <id>

## Get all the info from an api at once
aws apigatewayv2 export-api --api-id <id> --output-type YAML --specification OAS30 /tmp/api.yaml

## Get stages
aws apigatewayv2 get-stages --api-id <id>

## Get routes
aws apigatewayv2 get-routes --api-id <id>
aws apigatewayv2 get-route --api-id <id> --route-id <route-id>

## Get deployments
aws apigatewayv2 get-deployments --api-id <id>
aws apigatewayv2 get-deployment --api-id <id> --deployment-id <dep-id>

## Get integrations
aws apigatewayv2 get-integrations --api-id <id>

## Get authorizers
aws apigatewayv2 get-authorizers --api-id <id>
aws apigatewayv2 get-authorizer --api-id <id> --authorizer-id <uth-id>

## Get domain mappings
aws apigatewayv2 get-api-mappings --api-id <id> --domain-name <dom-name>
aws apigatewayv2 get-api-mapping --api-id <id> --api-mapping-id <map-id> --domain-name <dom-name>

## Get models
aws apigatewayv2 get-models --api-id <id>

## Call API
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>
```
{% endtab %}
{% endtabs %}

## API Gateway рдПрдВрдбрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдЕрдзрд┐рдХрд╛рд░рдг

### рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐

рдПрдкреАрдЖрдИ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рдХреМрди рдХреЙрд▓ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдЗрдВрдбрд┐рдХреЗрдЯреЗрдб рдЖрдИрдкреА рдХреЙрд▓ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛** рд╣реИ рдПрдВрдбрдкреЙрдЗрдВрдЯ `/resource_policy` рдХреЛ GET рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред

<figure><img src="../../../.gitbook/assets/image (92) (1) (1).png" alt=""><figcaption></figcaption></figure>

### IAM рдСрдерд░рд╛рдЗрдЬрд╝рд░

рдПрдХ рдкрде (рдПрдХ рд╕рдВрд╕рд╛рдзрди) рдХреЗ рднреАрддрд░ рдПрдХ рд╡рд┐рдзрд┐ рдХреЛ рдпрд╣ рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЙрд╕реЗ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП IAM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

<figure><img src="https://lh3.googleusercontent.com/GGx-kfqNXu6zMqGidnO8_eR88fYPpJG-wNuBBnedAJntiRUEPTEScl7OvWthGYRiI_msYCdC6oBFvJc827Tb4-4UogxpOyrEXyst-8IDzP9DC2NOtXSY7w58L0baCAcBQjSyvBhJREvWWCtiboNYPSKuEw=s2048" alt=""><figcaption></figcaption></figure>

рдЬрдм рдпрд╣ рд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЬрдм рдЖрдк рдЕрдзрд┐рдХрд╛рд░рдг рдХреЗ рдмрд┐рдирд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рддреНрд░реБрдЯрд┐ рдорд┐рд▓реЗрдЧреА `{"message":"Missing Authentication Token"}`ред

рдЕрдкреЗрдХреНрд╖рд┐рдд рдЯреЛрдХрди рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХрд╛ рдПрдХ рд╕рд░рд▓ рддрд░реАрдХрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ **Postman** рдХреЗ рдЕрдВрджрд░ **`Authorization`** рдкреНрд░рдХрд╛рд░ **`AWS Signature`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред

<figure><img src="../../../.gitbook/assets/image (3) (1) (3).png" alt=""><figcaption></figcaption></figure>

рдЙрд╕ рдЦрд╛рддреЗ рдХреА рдПрдХреНрд╕реЗрд╕ рдХреА рдФрд░ рд╕реАрдХреНрд░реЗрдЯ рдХреА рдХреБрдВрдЬреА рд╕реЗрдЯ рдХрд░реЗрдВ рдЬрд┐рд╕рдХрд╛ рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ рдЖрдк рдПрдкреАрдЖрдИ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рдПрдХ **Authorization** **рд╣реЗрдбрд░** рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ рдЬреИрд╕реЗ:
```
AWS4-HMAC-SHA256 Credential=AKIAYY7XU6ECUDOTWB7W/20220726/us-east-1/execute-api/aws4_request, SignedHeaders=host;x-amz-date, Signature=9f35579fa85c0d089c5a939e3d711362e92641e8c14cc571df8c71b4bc62a5c2
```
### Python рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреБрд░реЛрдз рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХрд░рдирд╛
```python

pip install requests
pip install requests-aws4auth
pip install boto3

import boto3
import requests
from requests_aws4auth import AWS4Auth

region = 'us-east-1'  # Region
service = 'execute-api'
access_key = 'YOUR_ACCESS_KEY'
secret_key = 'YOUR_SECRET_KEY'

url = 'https://<apiid>.execute-api.us-east-1.amazonaws.com/<stage>/<resource>'

session = boto3.Session(aws_access_key_id=access_key, aws_secret_access_key=secret_key)
credentials = session.get_credentials()
awsauth = AWS4Auth(credentials.access_key, credentials.secret_key, region, service, session_token=credentials.token)

response = requests.get(url, auth=awsauth)

print(response.text)

```
### рдХрд╕реНрдЯрдо рд▓реИрдореНрдмрдбрд╛ рдСрдерд░рд╛рдЗрдЬрд╝рд░

рдПрдХ рд▓реИрдореНрдмрдбрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЬреЛ рджрд┐рдП рдЧрдП рдЯреЛрдХрди рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реЛрдЧрд╛ рдФрд░ рдпрд╣ рдмрддрд╛рдПрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **API рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЕрдзрд┐рдХрд╛рд░реА рд╣реИрдВ**ред\
рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрд╕рд╛рдзрди рд╡рд┐рдзрд┐ рдХреЛ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдСрдерд░рд╛рдЗрдЬрд╝рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реА рд╣реЛрдЧреАред

<details>

<summary>рд▓реИрдореНрдмрдбрд╛ рдСрдерд░рд╛рдЗрдЬрд╝рд░ рдХреЛрдб рдЙрджрд╛рд╣рд░рдг</summary>
```python
import json

def lambda_handler(event, context):
token = event['authorizationToken']
method_arn = event['methodArn']

if not token:
return {
'statusCode': 401,
'body': 'Unauthorized'
}

try:
# Replace this with your own token validation logic
if token == "your-secret-token":
return generate_policy('user', 'Allow', method_arn)
else:
return generate_policy('user', 'Deny', method_arn)
except Exception as e:
print(e)
return {
'statusCode': 500,
'body': 'Internal Server Error'
}

def generate_policy(principal_id, effect, resource):
policy = {
'principalId': principal_id,
'policyDocument': {
'Version': '2012-10-17',
'Statement': [
{
'Action': 'execute-api:Invoke',
'Effect': effect,
'Resource': resource
}
]
}
}
return policy
```
</details>

рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХреЙрд▓ рдХрд░реЗрдВ:

<pre class="language-bash" data-overflow="wrap"><code class="lang-bash"><strong>curl "https://jhhqafgh6f.execute-api.eu-west-1.amazonaws.com/prod/custom_auth" -H 'Authorization: your-secret-token'
</strong></code></pre>

{% hint style="warning" %}
рд▓реИрдореНрдмрдбрд╛ рдХреЛрдб рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдпрд╣ рдЕрдзрд┐рдХреГрддрд┐ рд╡рд┐рдХрд▓реНрдк рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЛ рд╕рдХрддреА рд╣реИ
{% endhint %}

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ **рдПрдХ рдЗрдирдХрд╛рд░ рдиреАрддрд┐ рдЙрддреНрдкрдиреНрди рдФрд░ рд╡рд╛рдкрд╕ рднреЗрдЬреА рдЬрд╛рддреА рд╣реИ** рддреЛ API рдЧреЗрдЯрд╡реЗ рджреНрд╡рд╛рд░рд╛ рд╡рд╛рдкрд╕ рджрд┐рдпрд╛ рдЧрдпрд╛ рддреНрд░реБрдЯрд┐ рд╣реИ: `{"Message":"User is not authorized to access this resource with an explicit deny"}`

рдЗрд╕ рддрд░рд╣ рдЖрдк **рдЗрд╕ рдЕрдзрд┐рдХреГрддрд┐** рдХреЛ рдкрд╣рдЪрд╛рди рд╕рдХрддреЗ рд╣реИрдВред

### рдЖрд╡рд╢реНрдпрдХ API рдХреБрдВрдЬреА

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ API рдЗрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХреЛ рд╕реЗрдЯ рдХрд░рдирд╛ **рдЖрд╡рд╢реНрдпрдХ API рдХреБрдВрдЬреА** рдХреЛ рд╕рдВрдкрд░реНрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

<figure><img src="../../../.gitbook/assets/image (92) (1).png" alt=""><figcaption></figcaption></figure>

API рдЧреЗрдЯрд╡реЗ рдкреЛрд░реНрдЯрд▓ рдореЗрдВ API рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдФрд░ рдпрд╣ рднреА рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдпрд╣ рдХрд┐рддрдиреА рдмрд╛рд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб рдФрд░ рдкреНрд░рддрд┐ рдорд╛рд╣ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ)ред

рдПрдХ API рдХреБрдВрдЬреА рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЗрд╕реЗ рдПрдХ **рдЙрдкрдпреЛрдЧ рдпреЛрдЬрдирд╛** рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛, рдЗрд╕ рдЙрдкрдпреЛрдЧ рдпреЛрдЬрдирд╛ рдХреЛ **API рд╕реНрдЯреЗрдЬ** рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд API рд╕реНрдЯреЗрдЬ рдХреЛ рдПрдХ **рд╡рд┐рдзрд┐ рдзреАрдорд╛** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ **рдПрдВрдбрдкреЙрдЗрдВрдЯ** рдХреЛ рдЖрд╡рд╢реНрдпрдХ API рдХреБрдВрдЬреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдкрд╣реБрдВрдЪ

{% content-ref url="../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md" %}
[aws-api-gateway-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md)
{% endcontent-ref %}

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-apigateway-privesc.md" %}
[aws-apigateway-privesc.md](../aws-privilege-escalation/aws-apigateway-privesc.md)
{% endcontent-ref %}

## Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-api-gateway-post-exploitation.md" %}
[aws-api-gateway-post-exploitation.md](../aws-post-exploitation/aws-api-gateway-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../aws-persistence/aws-api-gateway-persistence.md" %}
[aws-api-gateway-persistence.md](../aws-persistence/aws-api-gateway-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> рдХреЗ рд╕рд╛рде рдЬреАрд░реЛ рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ!</summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ **HackTricks** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдХреЛ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
