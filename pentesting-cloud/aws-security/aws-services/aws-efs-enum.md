# AWS - EFS Enum

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** ğŸ’¬ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## EFS

### Basiese Inligting

Amazon Elastic File System (EFS) word deur AWS aangebied as 'n **volledig bestuurde, skaalbare en elastiese netwerk-lÃªersisteem**. Die diens fasiliteer die skep en konfigurasie van **lÃªersisteme** wat gelyktydig deur verskeie EC2-instanties en ander AWS-dienste benader kan word. Die sleutelkenmerke van EFS sluit in die vermoÃ« om outomaties te skaal sonder handmatige ingryping, die voorsiening van lae-latensie toegang, ondersteuning van hoÃ«-deursetwerklaste, waarborg van data-duursaamheid, en naadlose integrasie met verskeie AWS-sekuriteitsmeganismes.

Standaard sal die EFS-vouer wat gemount moet word, **`/`** wees, maar dit kan 'n **ander naam** hÃª.

### Netwerktoegang

'n EFS word in 'n VPC geskep en sal **standaard toeganklik wees in al die VPC-subnetwerke**. Die EFS sal egter 'n Sekuriteitsgroep hÃª. Om **toegang te gee aan 'n EC2** (of enige ander AWS-diens) om die EFS te mount, moet 'n inkomende NFS (2049-poort) **reÃ«l van die EC2 Sekuriteitsgroep toegelaat word in die EFS-sekuriteitsgroep**.

Sonder dit sal jy **nie in staat wees om die NFS-diens te kontak nie**.

Vir meer inligting oor hoe om dit te doen, kyk na: [https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount](https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount)

### Enumerasie
```bash
# Get filesystems and access policies (if any)
aws efs describe-file-systems
aws efs describe-file-system-policy --file-system-id <id>

# Get subnetworks and IP addresses where you can find the file system
aws efs describe-mount-targets --file-system-id <id>
aws efs describe-mount-target-security-groups --mount-target-id <id>
aws ec2 describe-security-groups --group-ids <sg_id>

# Get other access points
aws efs describe-access-points

# Get replication configurations
aws efs describe-replication-configurations

# Search for NFS in EC2 networks
sudo nmap -T4 -Pn -p 2049 --open 10.10.10.0/20 # or /16 to be sure
```
{% hint style="danger" %}
Dit mag wees dat die EFS-aanheggingspunt binne dieselfde VPC is, maar in 'n ander subnet. As jy seker wil maak dat jy alle **EFS-aanheggingspunte vind, sal dit beter wees om die `/16` netmasker te skandeer**.
{% endhint %}

### Monteer EFS

{% code overflow="wrap" %}
```bash
sudo mkdir /efs

## Mount found
sudo apt install nfs-common
sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport <IP>:/ /efs

## Mount with efs type
## You need to have installed the package amazon-efs-utils
sudo yum install amazon-efs-utils # If centos
sudo apt-get install amazon-efs-utils # If ubuntu
sudo mount -t efs <file-system-id/EFS DNS name>:/ /efs/
```
{% endcode %}

### IAM-toegang

Standaard sal enige persoon met netwerktoegang tot die EFS in staat wees om dit te monteer, te lees en te skryf, selfs as 'n root-gebruiker. Tog kan daar lÃªerstelselbeleide wees wat slegs beginsels met spesifieke toestemmings toelaat om toegang daartoe te verkry.\
Byvoorbeeld, hierdie lÃªerstelselbeleid sal selfs nie toelaat om die lÃªerstelsel te monteer as jy nie die IAM-toestemming het nie:
```json
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-2ca2ba76-5d83-40be-8557-8f6c19eaa797",
"Statement": [
{
"Sid": "efs-statement-e7f4b04c-ad75-4a7f-a316-4e5d12f0dbf5",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": "",
"Resource": "arn:aws:elasticfilesystem:us-east-1:318142138553:file-system/fs-0ab66ad201b58a018",
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
Of dit sal **anonieme toegang voorkom**:

<figure><img src="../../../.gitbook/assets/image (3) (6).png" alt=""><figcaption></figcaption></figure>

Merk op dat jy die tipe "efs" in die monteeropdrag MOET gebruik om lÃªersisteme wat deur IAM beskerm word, te monteer:
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
# To use a different pforile from ~/.aws/credentials
# You can use: -o tls,iam,awsprofile=namedprofile
```
### Toegangspunte

**Toegangspunte** is **toepassing**-spesifieke toegangspunte **na 'n EFS-lÃªersisteem** wat dit makliker maak om toepassingstoegang tot gedeelde datastelle te bestuur.

Wanneer jy 'n toegangspunt skep, kan jy die eienaar en POSIX-permissies **spesifiseer** vir die lÃªers en gids wat deur die toegangspunt geskep word. Jy kan ook 'n **aangepaste hoofgids definieer** vir die toegangspunt, deur Ã³f 'n bestaande gids te spesifiseer Ã³f 'n nuwe een met die gewenste permissies te skep. Dit stel jou in staat om toegang tot jou EFS-lÃªersisteem op 'n toepassing- of gebruikersbasis te **beheer**, wat dit makliker maak om jou gedeelde lÃªerdata te bestuur en te beveilig.

**Jy kan die LÃªersisteem vanaf 'n toegangspunt monteer met iets soos:**
```bash
# Use IAM if you need to use iam permissions
sudo mount -t efs -o tls,[iam],accesspoint=<access-point-id> \
<file-system-id/EFS DNS> /efs/
```
{% hint style="warning" %}
Let wel dat jy steeds die NFS-diens via die netwerk moet **kontak** om 'n toegangspunt te monteer, en as die EFS 'n lÃªersisteembeleid het, moet jy **genoeg IAM-toestemmings** hÃª om dit te monteer.
{% endhint %}

Toegangspunte kan vir die volgende doeleindes gebruik word:

* **Vereenvoudig bestuursregte**: Deur 'n POSIX-gebruiker en -groep vir elke toegangspunt te definieer, kan jy maklik toegangsregte vir verskillende toepassings of gebruikers bestuur sonder om die onderliggende lÃªersisteem se regte te wysig.
* **Handhaaf 'n hoofgids**: Toegangspunte kan toegang tot 'n spesifieke gids binne die EFS-lÃªersisteem beperk, om te verseker dat elke toepassing of gebruiker binne sy aangewese vouer werk. Dit help om onbedoelde blootstelling of wysiging van data te voorkom.
* **Makliker lÃªersisteemtoegang**: Toegangspunte kan gekoppel word aan 'n AWS Lambda-funksie of 'n AWS Fargate-taak, wat lÃªersisteemtoegang vir serverlose en gekonteneerde toepassings vereenvoudig.

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-efs-privesc.md" %}
[aws-efs-privesc.md](../aws-privilege-escalation/aws-efs-privesc.md)
{% endcontent-ref %}

## Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-efs-post-exploitation.md" %}
[aws-efs-post-exploitation.md](../aws-post-exploitation/aws-efs-post-exploitation.md)
{% endcontent-ref %}

## Volharding

{% content-ref url="../aws-persistence/aws-efs-persistence.md" %}
[aws-efs-persistence.md](../aws-persistence/aws-efs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy in HackTricks wil adverteer** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks-uitrusting**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** ğŸ’¬ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
