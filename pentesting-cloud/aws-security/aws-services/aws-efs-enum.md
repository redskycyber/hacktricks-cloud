# AWS - EFS Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## EFS

### Temel Bilgiler

Amazon Elastic File System (EFS), AWS tarafÄ±ndan **tamamen yÃ¶netilen, Ã¶lÃ§eklenebilir ve elastik bir aÄŸ dosya sistemi** olarak sunulur. Bu hizmet, birden fazla EC2 Ã¶rneÄŸi ve diÄŸer AWS hizmetleri tarafÄ±ndan eÅŸ zamanlÄ± olarak eriÅŸilebilen **dosya sistemlerinin** oluÅŸturulmasÄ±nÄ± ve yapÄ±landÄ±rÄ±lmasÄ±nÄ± kolaylaÅŸtÄ±rÄ±r. EFS'nin temel Ã¶zellikleri arasÄ±nda manuel mÃ¼dahale olmadan otomatik Ã¶lÃ§eklendirme, dÃ¼ÅŸÃ¼k gecikmeli eriÅŸim saÄŸlama, yÃ¼ksek verimli iÅŸ yÃ¼klerini destekleme, veri dayanÄ±klÄ±lÄ±ÄŸÄ±nÄ± garanti etme ve Ã§eÅŸitli AWS gÃ¼venlik mekanizmalarÄ±yla sorunsuz entegrasyon yer alÄ±r.

VarsayÄ±lan olarak, baÄŸlanacak EFS klasÃ¶rÃ¼ **`/`** olacaktÄ±r, ancak farklÄ± bir isme sahip olabilir.

### AÄŸ EriÅŸimi

Bir EFS bir VPC iÃ§inde oluÅŸturulur ve **varsayÄ±lan olarak tÃ¼m VPC alt aÄŸlardan eriÅŸilebilir**. Bununla birlikte, EFS'nin bir GÃ¼venlik Grubu olacaktÄ±r. EFS'ye baÄŸlanmak iÃ§in bir EC2'nin (veya baÅŸka bir AWS hizmetinin) EFS'yi baÄŸlamasÄ±na izin vermek iÃ§in, EFS gÃ¼venlik grubunda EC2 GÃ¼venlik Grubundan gelen bir NFS (2049 portu) giriÅŸ kuralÄ±na izin vermek gerekmektedir.

Bunun olmamasÄ± durumunda, NFS hizmetine **baÄŸlantÄ± kuramazsÄ±nÄ±z**.

Bunu nasÄ±l yapacaÄŸÄ±nÄ±z hakkÄ±nda daha fazla bilgi iÃ§in: [https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount](https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount)

### Enumerasyon
```bash
# Get filesystems and access policies (if any)
aws efs describe-file-systems
aws efs describe-file-system-policy --file-system-id <id>

# Get subnetworks and IP addresses where you can find the file system
aws efs describe-mount-targets --file-system-id <id>
aws efs describe-mount-target-security-groups --mount-target-id <id>
aws ec2 describe-security-groups --group-ids <sg_id>

# Get other access points
aws efs describe-access-points

# Get replication configurations
aws efs describe-replication-configurations

# Search for NFS in EC2 networks
sudo nmap -T4 -Pn -p 2049 --open 10.10.10.0/20 # or /16 to be sure
```
{% hint style="danger" %}
EFS baÄŸlama noktasÄ±nÄ±n aynÄ± VPC iÃ§inde fakat farklÄ± bir alt aÄŸda olmasÄ± mÃ¼mkÃ¼n olabilir. TÃ¼m **EFS noktalarÄ±nÄ± bulmak iÃ§in `/16` aÄŸ maskesini taramanÄ±z daha iyi olur**.
{% endhint %}

### EFS BaÄŸlama NoktasÄ±nÄ± BaÄŸla

{% code overflow="wrap" %}
```bash
sudo mkdir /efs

## Mount found
sudo apt install nfs-common
sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport <IP>:/ /efs

## Mount with efs type
## You need to have installed the package amazon-efs-utils
sudo yum install amazon-efs-utils # If centos
sudo apt-get install amazon-efs-utils # If ubuntu
sudo mount -t efs <file-system-id/EFS DNS name>:/ /efs/
```
{% endcode %}

### IAM EriÅŸimi

VarsayÄ±lan olarak, EFS'ye **aÄŸ eriÅŸimi olan herkes** kÃ¶k kullanÄ±cÄ± olarak bile onu **baÄŸlama, okuma ve yazma yeteneÄŸine sahip olacaktÄ±r**. Bununla birlikte, Dosya Sistemi politikalarÄ±, ona eriÅŸim izni olan **belirli izinlere sahip prensiplerle sÄ±nÄ±rlÄ± olabilir**.\
Ã–rneÄŸin, bu Dosya Sistemi politikasÄ±, **IAM iznine sahip deÄŸilseniz bile** dosya sistemini **baÄŸlamanÄ±za izin vermeyecektir**:
```json
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-2ca2ba76-5d83-40be-8557-8f6c19eaa797",
"Statement": [
{
"Sid": "efs-statement-e7f4b04c-ad75-4a7f-a316-4e5d12f0dbf5",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": "",
"Resource": "arn:aws:elasticfilesystem:us-east-1:318142138553:file-system/fs-0ab66ad201b58a018",
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
Veya bu, **anonim eriÅŸimi engelleyecektir**:

<figure><img src="../../../.gitbook/assets/image (3) (6).png" alt=""><figcaption></figcaption></figure>

IAM tarafÄ±ndan korunan dosya sistemlerini baÄŸlamak iÃ§in montaj komutunda "efs" tÃ¼rÃ¼nÃ¼ KESÄ°NLÄ°KLE kullanmanÄ±z gerektiÄŸini unutmayÄ±n:
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
# To use a different pforile from ~/.aws/credentials
# You can use: -o tls,iam,awsprofile=namedprofile
```
### EriÅŸim NoktalarÄ±

**EriÅŸim noktalarÄ±**, paylaÅŸÄ±lan veri kÃ¼melerine uygulama eriÅŸimini yÃ¶netmeyi kolaylaÅŸtÄ±ran **bir EFS dosya sistemi**ne Ã¶zgÃ¼ giriÅŸ noktalarÄ±dÄ±r.

Bir eriÅŸim noktasÄ± oluÅŸturduÄŸunuzda, eriÅŸim noktasÄ± Ã¼zerinden oluÅŸturulan dosya ve dizinler iÃ§in **sahibi ve POSIX izinlerini belirleyebilirsiniz**. AyrÄ±ca, eriÅŸim noktasÄ± iÃ§in **Ã¶zel bir kÃ¶k dizin tanÄ±mlayabilirsiniz**, ya mevcut bir dizini belirterek ya da istenen izinlerle yeni bir tane oluÅŸturarak. Bu, paylaÅŸÄ±lan dosya verilerinizi uygulama veya kullanÄ±cÄ± baÅŸÄ±na eriÅŸime gÃ¶re kontrol etmenizi saÄŸlar ve paylaÅŸÄ±lan dosya verilerinizi yÃ¶netmeyi ve gÃ¼vence altÄ±na almayÄ± kolaylaÅŸtÄ±rÄ±r.

**EriÅŸim noktasÄ±ndan Dosya Sistemini ÅŸu ÅŸekilde baÄŸlayabilirsiniz:**
```bash
# Use IAM if you need to use iam permissions
sudo mount -t efs -o tls,[iam],accesspoint=<access-point-id> \
<file-system-id/EFS DNS> /efs/
```
{% hint style="warning" %}
UnutmayÄ±n, bir eriÅŸim noktasÄ±nÄ± baÄŸlamaya Ã§alÄ±ÅŸsanÄ±z bile, NFS hizmetine aÄŸ Ã¼zerinden **ulaÅŸabilmeniz** gerekmektedir ve EFS'nin bir dosya sistemi **politikasÄ±** varsa, onu baÄŸlamak iÃ§in **yeterli IAM izinlerine** sahip olmanÄ±z gerekmektedir.
{% endhint %}

EriÅŸim noktalarÄ± aÅŸaÄŸÄ±daki amaÃ§lar iÃ§in kullanÄ±labilir:

* **Ä°zin yÃ¶netimini basitleÅŸtirme**: Her eriÅŸim noktasÄ± iÃ§in bir POSIX kullanÄ±cÄ±sÄ± ve grubu tanÄ±mlayarak, temel dosya sisteminin izinlerini deÄŸiÅŸtirmeden farklÄ± uygulamalarÄ±n veya kullanÄ±cÄ±larÄ±n eriÅŸim izinlerini kolayca yÃ¶netebilirsiniz.
* **KÃ¶k dizin zorunluluÄŸu**: EriÅŸim noktalarÄ±, EFS dosya sistemi iÃ§inde belirli bir dizine eriÅŸimi sÄ±nÄ±rlayabilir, bÃ¶ylece her uygulama veya kullanÄ±cÄ± belirlenen klasÃ¶rÃ¼nde Ã§alÄ±ÅŸÄ±r. Bu, kazara veri aÃ§Ä±ÄŸa Ã§Ä±kmasÄ±nÄ± veya deÄŸiÅŸtirilmesini Ã¶nlemeye yardÄ±mcÄ± olur.
* **Daha kolay dosya sistemi eriÅŸimi**: EriÅŸim noktalarÄ±, AWS Lambda iÅŸlevi veya AWS Fargate gÃ¶revi ile iliÅŸkilendirilebilir, bÃ¶ylece serverless ve konteyner tabanlÄ± uygulamalar iÃ§in dosya sistemi eriÅŸimi kolaylaÅŸÄ±r.

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-efs-privesc.md" %}
[aws-efs-privesc.md](../aws-privilege-escalation/aws-efs-privesc.md)
{% endcontent-ref %}

## SonrasÄ± SÄ±zma

{% content-ref url="../aws-post-exploitation/aws-efs-post-exploitation.md" %}
[aws-efs-post-exploitation.md](../aws-post-exploitation/aws-efs-post-exploitation.md)
{% endcontent-ref %}

## KalÄ±cÄ±lÄ±k

{% content-ref url="../aws-persistence/aws-efs-persistence.md" %}
[aws-efs-persistence.md](../aws-persistence/aws-efs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
