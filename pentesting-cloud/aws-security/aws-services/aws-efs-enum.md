# AWS - EFS Enum

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**PorodiÄnu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## EFS

### Osnovne informacije

Amazon Elastic File System (EFS) je predstavljen kao **potpuno upravljiv, skalabilan i elastiÄan mreÅ¾ni fajl sistem** od strane AWS-a. Usluga olakÅ¡ava kreiranje i konfigurisanje **fajl sistema** koji mogu biti istovremeno pristupani od strane viÅ¡e EC2 instanci i drugih AWS usluga. KljuÄne karakteristike EFS-a ukljuÄuju njegovu sposobnost automatskog skaliranja bez ruÄnog meÅ¡anja, obezbeÄ‘ivanje pristupa sa niskom latencijom, podrÅ¡ku za radne optereÄ‡enja visokog protoka, garantovanje trajnosti podataka i besprekorno integrisanje sa razliÄitim mehanizmima AWS sigurnosti.

Po **podrazumevanoj vrednosti**, EFS folder koji se montira Ä‡e biti **`/`** ali moÅ¾e imati **razliÄito ime**.

### Pristup mreÅ¾i

EFS se kreira u VPC-u i po **podrazumevanoj vrednosti je dostupan u svim VPC podmreÅ¾ama**. MeÄ‘utim, EFS Ä‡e imati Sigurnosnu grupu. Da bi se **omoguÄ‡io pristup EC2** (ili bilo kojoj drugoj AWS usluzi) za montiranje EFS-a, potrebno je **dozvoliti ulazno NFS pravilo (port 2049) iz Sigurnosne grupe EC2** u Sigurnosnoj grupi EFS-a.

Bez toga, **neÄ‡ete moÄ‡i da kontaktirate NFS uslugu**.

Za viÅ¡e informacija o tome kako to uraditi proverite: [https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount](https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount)

### Enumeracija
```bash
# Get filesystems and access policies (if any)
aws efs describe-file-systems
aws efs describe-file-system-policy --file-system-id <id>

# Get subnetworks and IP addresses where you can find the file system
aws efs describe-mount-targets --file-system-id <id>
aws efs describe-mount-target-security-groups --mount-target-id <id>
aws ec2 describe-security-groups --group-ids <sg_id>

# Get other access points
aws efs describe-access-points

# Get replication configurations
aws efs describe-replication-configurations

# Search for NFS in EC2 networks
sudo nmap -T4 -Pn -p 2049 --open 10.10.10.0/20 # or /16 to be sure
```
{% hint style="danger" %}
MoguÄ‡e je da je taÄka montiranja EFS-a unutar iste VPC, ali u drugoj podmreÅ¾i. Ako Å¾elite da budete sigurni da pronaÄ‘ete sve **EFS taÄke, bolje je skenirati `/16` netmasku**.
{% endhint %}

### Montiranje EFS-a

{% code overflow="wrap" %}
```bash
sudo mkdir /efs

## Mount found
sudo apt install nfs-common
sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport <IP>:/ /efs

## Mount with efs type
## You need to have installed the package amazon-efs-utils
sudo yum install amazon-efs-utils # If centos
sudo apt-get install amazon-efs-utils # If ubuntu
sudo mount -t efs <file-system-id/EFS DNS name>:/ /efs/
```
{% endcode %}

### IAM Pritup

Podrazumevano, svako ko ima pristup mreÅ¾i EFS-a moÄ‡i Ä‡e da montira, Äita i piÅ¡e u njega Äak i kao korisnik sa administratorskim pravima. MeÄ‘utim, politike sistema datoteka mogu biti postavljene tako da dozvole pristup samo principima sa odreÄ‘enim dozvolama. Na primer, ova politika sistema datoteka neÄ‡e dozvoliti ni montiranje sistema datoteka ako nemate IAM dozvolu:
```json
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-2ca2ba76-5d83-40be-8557-8f6c19eaa797",
"Statement": [
{
"Sid": "efs-statement-e7f4b04c-ad75-4a7f-a316-4e5d12f0dbf5",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": "",
"Resource": "arn:aws:elasticfilesystem:us-east-1:318142138553:file-system/fs-0ab66ad201b58a018",
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
Ili ovo Ä‡e **spreÄiti anoniman pristup**:

<figure><img src="../../../.gitbook/assets/image (278).png" alt=""><figcaption></figcaption></figure>

Imajte na umu da prilikom montiranja sistema datoteka zaÅ¡tiÄ‡enih IAM-om MORA se koristiti tip "efs" u mount naredbi:
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
# To use a different pforile from ~/.aws/credentials
# You can use: -o tls,iam,awsprofile=namedprofile
```
### Pristupne taÄke

**Pristupne taÄke** su **aplikacijski** specifiÄne ulazne taÄke **u EFS fajl sistem** koje olakÅ¡avaju upravljanje pristupom aplikacija deljenim skupovima podataka.

Prilikom kreiranja pristupne taÄke, moÅ¾ete **specificirati vlasnika i POSIX dozvole** za fajlove i direktorijume kreirane kroz pristupnu taÄku. TakoÄ‘e moÅ¾ete **definisati prilagoÄ‘eni koreni direktorijum** za pristupnu taÄku, ili specificiranjem postojeÄ‡eg direktorijuma ili kreiranjem novog sa Å¾eljenim dozvolama. Ovo vam omoguÄ‡ava da **kontroliÅ¡ete pristup vaÅ¡em EFS fajl sistemu na nivou aplikacije ili korisnika**, olakÅ¡avajuÄ‡i upravljanje i osiguravanje vaÅ¡ih deljenih fajlova.

**MoÅ¾ete montirati fajl sistem iz pristupne taÄke na sledeÄ‡i naÄin:**
```bash
# Use IAM if you need to use iam permissions
sudo mount -t efs -o tls,[iam],accesspoint=<access-point-id> \
<file-system-id/EFS DNS> /efs/
```
{% hint style="warning" %}
Imajte na umu da Äak i pokuÅ¡avajuÄ‡i da montirate pristupnu taÄku, i dalje morate biti u moguÄ‡nosti da **kontaktirate NFS servis putem mreÅ¾e**, i ako EFS ima **polisu sistema datoteka**, potrebne su vam **dovoljne IAM dozvole** da je montirate.
{% endhint %}

Pristupne taÄke mogu se koristiti u sledeÄ‡e svrhe:

* **Simplifikacija upravljanja dozvolama**: Definisanjem POSIX korisnika i grupe za svaku pristupnu taÄku, moÅ¾ete lako upravljati pristupnim dozvolama za razliÄite aplikacije ili korisnike bez modifikacije dozvola osnovnog sistema datoteka.
* **Nametanje korenskog direktorijuma**: Pristupne taÄke mogu ograniÄiti pristup na odreÄ‘eni direktorijum unutar EFS sistema datoteka, osiguravajuÄ‡i da svaka aplikacija ili korisnik radi unutar svog odreÄ‘enog foldera. Ovo pomaÅ¾e u spreÄavanju sluÄajnog izlaganja ili modifikacije podataka.
* **LakÅ¡i pristup sistemu datoteka**: Pristupne taÄke mogu biti povezane sa AWS Lambda funkcijom ili AWS Fargate zadatkom, pojednostavljujuÄ‡i pristup sistemu datoteka za serverless i kontejnerizovane aplikacije.

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-efs-privesc.md" %}
[aws-efs-privesc.md](../aws-privilege-escalation/aws-efs-privesc.md)
{% endcontent-ref %}

## Post Eksploatacija

{% content-ref url="../aws-post-exploitation/aws-efs-post-exploitation.md" %}
[aws-efs-post-exploitation.md](../aws-post-exploitation/aws-efs-post-exploitation.md)
{% endcontent-ref %}

## Persistencija

{% content-ref url="../aws-persistence/aws-efs-persistence.md" %}
[aws-efs-persistence.md](../aws-persistence/aws-efs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
