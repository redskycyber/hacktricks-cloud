# AWS - EFSæšä¸¾

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## EFS

### åŸºæœ¬ä¿¡æ¯

Amazon Elastic File Systemï¼ˆEFSï¼‰æ˜¯ç”±AWSæä¾›çš„å®Œå…¨**æ‰˜ç®¡ã€å¯æ‰©å±•å’Œå¼¹æ€§çš„ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ**ã€‚å®ƒå…è®¸åˆ›å»ºå’Œé…ç½®**è·¨å¤šä¸ª**EC2å®ä¾‹å’Œå…¶ä»–AWSæœåŠ¡å…±äº«çš„**æ–‡ä»¶ç³»ç»Ÿ**ã€‚EFSè‡ªåŠ¨æ‰©å±•ï¼Œæä¾›ä½å»¶è¿Ÿè®¿é—®ï¼Œæ”¯æŒé«˜ååé‡å·¥ä½œè´Ÿè½½ï¼Œç¡®ä¿æ•°æ®æŒä¹…æ€§ï¼Œå¹¶ä¸AWSå®‰å…¨åŠŸèƒ½é›†æˆã€‚

**é»˜è®¤æƒ…å†µä¸‹**ï¼Œè¦æŒ‚è½½çš„EFSæ–‡ä»¶å¤¹ä¸º**`/`**ï¼Œä½†å®ƒå¯ä»¥æœ‰**ä¸åŒçš„åç§°**ã€‚

### ç½‘ç»œè®¿é—®

EFSåœ¨VPCä¸­åˆ›å»ºï¼Œå¹¶ä¸”**é»˜è®¤æƒ…å†µä¸‹å¯ä»¥åœ¨æ‰€æœ‰VPCå­ç½‘ä¸­è®¿é—®**ã€‚ä½†æ˜¯ï¼ŒEFSå°†å…·æœ‰å®‰å…¨ç»„ã€‚ä¸ºäº†**å…è®¸EC2**ï¼ˆæˆ–ä»»ä½•å…¶ä»–AWSæœåŠ¡ï¼‰è®¿é—®æŒ‚è½½EFSï¼Œéœ€è¦åœ¨EFSå®‰å…¨ç»„ä¸­**å…è®¸æ¥è‡ªEC2å®‰å…¨ç»„çš„å…¥ç«™NFS**ï¼ˆ2049ç«¯å£ï¼‰**è§„åˆ™**ã€‚

å¦‚æœæ²¡æœ‰è¿™ä¸ªï¼Œæ‚¨**å°†æ— æ³•è”ç³»åˆ°NFSæœåŠ¡**ã€‚

æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ï¼š[https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount](https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount)

### æšä¸¾
```bash
# Get filesystems and access policies (if any)
aws efs describe-file-systems
aws efs describe-file-system-policy --file-system-id <id>

# Get subnetworks and IP addresses where you can find the file system
aws efs describe-mount-targets --file-system-id <id>
aws efs describe-mount-target-security-groups --mount-target-id <id>
aws ec2 describe-security-groups --group-ids <sg_id>

# Get other access points
aws efs describe-access-points

# Get replication configurations
aws efs describe-replication-configurations

# Search for NFS in EC2 networks
sudo nmap -T4 -Pn -p 2049 --open 10.10.10.0/20
```
### æŒ‚è½½EFS

{% code overflow="wrap" %}
```bash
sudo mkdir /efs

## Mount found
sudo apt install nfs-common
sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport <IP>:/ /efs

## Mount with efs type
## You need to have installed the package amazon-efs-utils
sudo yum install amazon-efs-utils # If centos
sudo apt-get install amazon-efs-utils # If ubuntu
sudo mount -t efs <file-system-id/EFS DNS name>:/ /efs/
```
{% endcode %}

### IAMè®¿é—®

é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•å…·æœ‰å¯¹EFSçš„ç½‘ç»œè®¿é—®æƒé™çš„äººéƒ½å¯ä»¥ä½œä¸ºrootç”¨æˆ·æŒ‚è½½ã€è¯»å–å’Œå†™å…¥å®ƒã€‚ç„¶è€Œï¼Œæ–‡ä»¶ç³»ç»Ÿç­–ç•¥å¯ä»¥é™åˆ¶åªå…è®¸å…·æœ‰ç‰¹å®šæƒé™çš„ä¸»ä½“è®¿é—®å®ƒã€‚\
ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ²¡æœ‰IAMæƒé™ï¼Œè¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿç­–ç•¥ç”šè‡³ä¸å…è®¸æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼š
```json
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-2ca2ba76-5d83-40be-8557-8f6c19eaa797",
"Statement": [
{
"Sid": "efs-statement-e7f4b04c-ad75-4a7f-a316-4e5d12f0dbf5",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": "",
"Resource": "arn:aws:elasticfilesystem:us-east-1:318142138553:file-system/fs-0ab66ad201b58a018",
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
æˆ–è€…è¿™å°†**é˜²æ­¢åŒ¿åè®¿é—®**ï¼š

<figure><img src="../../../.gitbook/assets/image (3) (6).png" alt=""><figcaption></figcaption></figure>

è¯·æ³¨æ„ï¼Œè¦æŒ‚è½½å— IAM ä¿æŠ¤çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå¿…é¡»åœ¨æŒ‚è½½å‘½ä»¤ä¸­ä½¿ç”¨ç±»å‹ "efs"ï¼š
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
# To use a different pforile from ~/.aws/credentials
# You can use: -o tls,iam,awsprofile=namedprofile
```
### è®¿é—®ç‚¹

**è®¿é—®ç‚¹**æ˜¯è¿›å…¥EFSæ–‡ä»¶ç³»ç»Ÿçš„**ç‰¹å®šåº”ç”¨ç¨‹åºå…¥å£**ï¼Œä½¿å¾—æ›´å®¹æ˜“ç®¡ç†åº”ç”¨ç¨‹åºå¯¹å…±äº«æ•°æ®é›†çš„è®¿é—®ã€‚

åˆ›å»ºè®¿é—®ç‚¹æ—¶ï¼Œæ‚¨å¯ä»¥**æŒ‡å®šæ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰è€…å’ŒPOSIXæƒé™**ã€‚æ‚¨è¿˜å¯ä»¥**å®šä¹‰è‡ªå®šä¹‰æ ¹ç›®å½•**ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šç°æœ‰ç›®å½•æˆ–åˆ›å»ºå…·æœ‰æ‰€éœ€æƒé™çš„æ–°ç›®å½•æ¥å®ç°ã€‚è¿™ä½¿å¾—æ‚¨å¯ä»¥**æŒ‰åº”ç”¨ç¨‹åºæˆ–ç”¨æˆ·çš„åŸºç¡€æ§åˆ¶å¯¹EFSæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®**ï¼Œä»è€Œæ›´å®¹æ˜“ç®¡ç†å’Œä¿æŠ¤å…±äº«æ–‡ä»¶æ•°æ®ã€‚

**æ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä»¥ä¸‹çš„æ–¹å¼æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼š**
```bash
# Use IAM if you need to use iam permissions
sudo mount -t efs -o tls,[iam],accesspoint=<access-point-id> \
<file-system-id/EFS DNS> /efs/
```
{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œå³ä½¿å°è¯•æŒ‚è½½è®¿é—®ç‚¹ï¼Œæ‚¨ä»ç„¶éœ€è¦èƒ½å¤Ÿé€šè¿‡ç½‘ç»œ**è”ç³»NFSæœåŠ¡**ï¼Œå¹¶ä¸”å¦‚æœEFSå…·æœ‰æ–‡ä»¶ç³»ç»Ÿ**ç­–ç•¥**ï¼Œåˆ™éœ€è¦**è¶³å¤Ÿçš„IAMæƒé™**æ¥æŒ‚è½½å®ƒã€‚
{% endhint %}

è®¿é—®ç‚¹å¯ç”¨äºä»¥ä¸‹ç›®çš„ï¼š

* **ç®€åŒ–æƒé™ç®¡ç†**ï¼šé€šè¿‡ä¸ºæ¯ä¸ªè®¿é—®ç‚¹å®šä¹‰ä¸€ä¸ªPOSIXç”¨æˆ·å’Œç»„ï¼Œæ‚¨å¯ä»¥è½»æ¾ç®¡ç†ä¸åŒåº”ç”¨ç¨‹åºæˆ–ç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œè€Œæ— éœ€ä¿®æ”¹åº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„æƒé™ã€‚
* **å¼ºåˆ¶æ ¹ç›®å½•**ï¼šè®¿é—®ç‚¹å¯ä»¥é™åˆ¶å¯¹EFSæ–‡ä»¶ç³»ç»Ÿä¸­ç‰¹å®šç›®å½•çš„è®¿é—®ï¼Œç¡®ä¿æ¯ä¸ªåº”ç”¨ç¨‹åºæˆ–ç”¨æˆ·åœ¨å…¶æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸­æ“ä½œã€‚è¿™æœ‰åŠ©äºé˜²æ­¢æ„å¤–çš„æ•°æ®æš´éœ²æˆ–ä¿®æ”¹ã€‚
* **æ›´å®¹æ˜“çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®**ï¼šè®¿é—®ç‚¹å¯ä»¥ä¸AWS Lambdaå‡½æ•°æˆ–AWS Fargateä»»åŠ¡å…³è”ï¼Œç®€åŒ–æ— æœåŠ¡å™¨å’Œå®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

## ææƒ

{% content-ref url="../aws-privilege-escalation/aws-efs-privesc.md" %}
[aws-efs-privesc.md](../aws-privilege-escalation/aws-efs-privesc.md)
{% endcontent-ref %}

## æ¼æ´åˆ©ç”¨å

{% content-ref url="../aws-post-exploitation/aws-efs-post-exploitation.md" %}
[aws-efs-post-exploitation.md](../aws-post-exploitation/aws-efs-post-exploitation.md)
{% endcontent-ref %}

## æŒä¹…åŒ–

{% content-ref url="../aws-persistence/aws-efs-persistence.md" %}
[aws-efs-persistence.md](../aws-persistence/aws-efs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**ï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
