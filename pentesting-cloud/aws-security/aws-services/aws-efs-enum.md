# AWS - EFS æšä¸¾

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºä¸“å®¶ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä»¥PDFæ ¼å¼ä¸‹è½½HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## EFS

### åŸºæœ¬ä¿¡æ¯

Amazon Elastic File System (EFS) æ˜¯AWSæä¾›çš„ä¸€ä¸ªå®Œå…¨**æ‰˜ç®¡çš„ã€å¯æ‰©å±•çš„ã€å¼¹æ€§çš„ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ**ã€‚å®ƒå…è®¸åˆ›å»ºå’Œé…ç½®**è·¨å¤šä¸ª** EC2å®ä¾‹å’Œå…¶ä»–AWSæœåŠ¡å…±äº«çš„**æ–‡ä»¶ç³»ç»Ÿ**ã€‚EFSè‡ªåŠ¨æ‰©å±•ï¼Œæä¾›ä½å»¶è¿Ÿè®¿é—®ï¼Œæ”¯æŒé«˜ååé‡å·¥ä½œè´Ÿè½½ï¼Œç¡®ä¿æ•°æ®æŒä¹…æ€§ï¼Œå¹¶ä¸AWSå®‰å…¨åŠŸèƒ½é›†æˆã€‚

**é»˜è®¤æƒ…å†µä¸‹**ï¼Œè¦æŒ‚è½½çš„EFSæ–‡ä»¶å¤¹å°†æ˜¯**`/`**ï¼Œä½†å®ƒå¯èƒ½æœ‰ä¸€ä¸ª**ä¸åŒçš„åç§°**ã€‚

### ç½‘ç»œè®¿é—®

EFSæ˜¯åœ¨VPCä¸­åˆ›å»ºçš„ï¼Œå¹¶ä¸”**é»˜è®¤æƒ…å†µä¸‹åœ¨æ‰€æœ‰VPCå­ç½‘ä¸­å¯è®¿é—®**ã€‚ç„¶è€Œï¼ŒEFSå°†æœ‰ä¸€ä¸ªå®‰å…¨ç»„ã€‚ä¸ºäº†**å…è®¸EC2**ï¼ˆæˆ–ä»»ä½•å…¶ä»–AWSæœåŠ¡ï¼‰æŒ‚è½½EFSï¼Œéœ€è¦åœ¨EFSå®‰å…¨ç»„ä¸­**å…è®¸æ¥è‡ªEC2å®‰å…¨ç»„çš„å…¥ç«™NFS**ï¼ˆ2049ç«¯å£ï¼‰**è§„åˆ™**ã€‚

å¦‚æœæ²¡æœ‰è¿™ä¸ªï¼Œæ‚¨**å°†æ— æ³•è”ç³»NFSæœåŠ¡**ã€‚

æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š[https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount](https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount)

### æšä¸¾
```bash
# Get filesystems and access policies (if any)
aws efs describe-file-systems
aws efs describe-file-system-policy --file-system-id <id>

# Get subnetworks and IP addresses where you can find the file system
aws efs describe-mount-targets --file-system-id <id>
aws efs describe-mount-target-security-groups --mount-target-id <id>
aws ec2 describe-security-groups --group-ids <sg_id>

# Get other access points
aws efs describe-access-points

# Get replication configurations
aws efs describe-replication-configurations

# Search for NFS in EC2 networks
sudo nmap -T4 -Pn -p 2049 --open 10.10.10.0/20 # or /16 to be sure
```
{% hint style="danger" %}
å¯èƒ½EFSæŒ‚è½½ç‚¹ä½äºåŒä¸€ä¸ªVPCä¸­ï¼Œä½†åœ¨ä¸åŒçš„å­ç½‘å†…ã€‚å¦‚æœä½ æƒ³ç¡®ä¿æ‰¾åˆ°æ‰€æœ‰**EFSç‚¹ï¼Œæœ€å¥½æ‰«æ`/16`å­ç½‘æ©ç **ã€‚
{% endhint %}

### æŒ‚è½½EFS

{% code overflow="wrap" %}
```bash
sudo mkdir /efs

## Mount found
sudo apt install nfs-common
sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport <IP>:/ /efs

## Mount with efs type
## You need to have installed the package amazon-efs-utils
sudo yum install amazon-efs-utils # If centos
sudo apt-get install amazon-efs-utils # If ubuntu
sudo mount -t efs <file-system-id/EFS DNS name>:/ /efs/
```
### IAM è®¿é—®æƒé™

**é»˜è®¤æƒ…å†µä¸‹**ï¼Œä»»ä½•æ‹¥æœ‰**EFS ç½‘ç»œè®¿é—®æƒé™**çš„äººéƒ½èƒ½å¤ŸæŒ‚è½½ã€**ä»¥ root ç”¨æˆ·èº«ä»½è¯»å†™**ã€‚ç„¶è€Œï¼Œå¯èƒ½ä¼šæœ‰æ–‡ä»¶ç³»ç»Ÿç­–ç•¥ï¼Œ**åªå…è®¸æ‹¥æœ‰ç‰¹å®šæƒé™çš„ä¸»ä½“**è®¿é—®å®ƒã€‚\
ä¾‹å¦‚ï¼Œå¦‚æœä½ **æ²¡æœ‰ IAM æƒé™**ï¼Œè¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿç­–ç•¥ç”šè‡³**ä¸å…è®¸æŒ‚è½½**æ–‡ä»¶ç³»ç»Ÿï¼š
```json
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-2ca2ba76-5d83-40be-8557-8f6c19eaa797",
"Statement": [
{
"Sid": "efs-statement-e7f4b04c-ad75-4a7f-a316-4e5d12f0dbf5",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": "",
"Resource": "arn:aws:elasticfilesystem:us-east-1:318142138553:file-system/fs-0ab66ad201b58a018",
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
æˆ–è€…è¿™å°†**é˜»æ­¢åŒ¿åè®¿é—®**ï¼š

<figure><img src="../../../.gitbook/assets/image (3) (6).png" alt=""><figcaption></figcaption></figure>

è¯·æ³¨æ„ï¼Œè¦æŒ‚è½½å—IAMä¿æŠ¤çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ‚¨å¿…é¡»åœ¨æŒ‚è½½å‘½ä»¤ä¸­ä½¿ç”¨ç±»å‹ "efs"ï¼š
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
# To use a different pforile from ~/.aws/credentials
# You can use: -o tls,iam,awsprofile=namedprofile
```
### è®¿é—®ç‚¹

**è®¿é—®ç‚¹**æ˜¯æŒ‡å‘**EFSæ–‡ä»¶ç³»ç»Ÿ**çš„**åº”ç”¨ç¨‹åº**ç‰¹å®šå…¥å£ç‚¹ï¼Œå®ƒç®€åŒ–äº†ç®¡ç†åº”ç”¨ç¨‹åºå¯¹å…±äº«æ•°æ®é›†çš„è®¿é—®ã€‚

åˆ›å»ºè®¿é—®ç‚¹æ—¶ï¼Œæ‚¨å¯ä»¥**æŒ‡å®šé€šè¿‡è®¿é—®ç‚¹åˆ›å»ºçš„æ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰è€…å’ŒPOSIXæƒé™**ã€‚æ‚¨è¿˜å¯ä»¥**å®šä¹‰è®¿é—®ç‚¹çš„è‡ªå®šä¹‰æ ¹ç›®å½•**ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šç°æœ‰ç›®å½•æˆ–åˆ›å»ºå…·æœ‰æ‰€éœ€æƒé™çš„æ–°ç›®å½•æ¥å®ç°ã€‚è¿™å…è®¸æ‚¨**æ ¹æ®åº”ç”¨ç¨‹åºæˆ–ç”¨æˆ·æ¥æ§åˆ¶å¯¹EFSæ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®**ï¼Œä»è€Œæ›´å®¹æ˜“åœ°ç®¡ç†å’Œä¿æŠ¤æ‚¨çš„å…±äº«æ–‡ä»¶æ•°æ®ã€‚

**æ‚¨å¯ä»¥é€šè¿‡ç±»ä¼¼ä»¥ä¸‹æ–¹å¼ä»è®¿é—®ç‚¹æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼š**
```bash
# Use IAM if you need to use iam permissions
sudo mount -t efs -o tls,[iam],accesspoint=<access-point-id> \
<file-system-id/EFS DNS> /efs/
```
{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œå³ä½¿å°è¯•æŒ‚è½½è®¿é—®ç‚¹ï¼Œæ‚¨ä»ç„¶éœ€è¦èƒ½å¤Ÿ**é€šè¿‡ç½‘ç»œè”ç³»NFSæœåŠ¡**ï¼Œå¦‚æœEFSæœ‰æ–‡ä»¶ç³»ç»Ÿ**ç­–ç•¥**ï¼Œæ‚¨éœ€è¦**è¶³å¤Ÿçš„IAMæƒé™**æ¥æŒ‚è½½å®ƒã€‚
{% endhint %}

è®¿é—®ç‚¹å¯ç”¨äºä»¥ä¸‹ç›®çš„ï¼š

* **ç®€åŒ–æƒé™ç®¡ç†**ï¼šé€šè¿‡ä¸ºæ¯ä¸ªè®¿é—®ç‚¹å®šä¹‰POSIXç”¨æˆ·å’Œç»„ï¼Œæ‚¨å¯ä»¥è½»æ¾ç®¡ç†ä¸åŒåº”ç”¨ç¨‹åºæˆ–ç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œæ— éœ€ä¿®æ”¹åº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„æƒé™ã€‚
* **å¼ºåˆ¶æ ¹ç›®å½•**ï¼šè®¿é—®ç‚¹å¯ä»¥é™åˆ¶å¯¹EFSæ–‡ä»¶ç³»ç»Ÿä¸­ç‰¹å®šç›®å½•çš„è®¿é—®ï¼Œç¡®ä¿æ¯ä¸ªåº”ç”¨ç¨‹åºæˆ–ç”¨æˆ·ä»…åœ¨å…¶æŒ‡å®šæ–‡ä»¶å¤¹å†…æ“ä½œã€‚è¿™æœ‰åŠ©äºé˜²æ­¢æ„å¤–æ•°æ®æ³„éœ²æˆ–ä¿®æ”¹ã€‚
* **æ›´å®¹æ˜“çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®**ï¼šè®¿é—®ç‚¹å¯ä»¥ä¸AWS Lambdaå‡½æ•°æˆ–AWS Fargateä»»åŠ¡å…³è”ï¼Œç®€åŒ–äº†æ— æœåŠ¡å™¨å’Œå®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ã€‚

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-efs-privesc.md" %}
[aws-efs-privesc.md](../aws-privilege-escalation/aws-efs-privesc.md)
{% endcontent-ref %}

## Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-efs-post-exploitation.md" %}
[aws-efs-post-exploitation.md](../aws-post-exploitation/aws-efs-post-exploitation.md)
{% endcontent-ref %}

## Persistence

{% content-ref url="../aws-persistence/aws-efs-persistence.md" %}
[aws-efs-persistence.md](../aws-persistence/aws-efs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**telegramç¾¤ç»„**](https://t.me/peass)æˆ–åœ¨**Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
