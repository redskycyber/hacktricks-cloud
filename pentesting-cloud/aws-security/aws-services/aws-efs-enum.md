# AWS - EFS Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## EFS

### ê¸°ë³¸ ì •ë³´

Amazon Elastic File System (EFS)ëŠ” AWSì—ì„œ **ì™„ì „íˆ ê´€ë¦¬ë˜ëŠ” í™•ì¥ ê°€ëŠ¥í•˜ê³  íƒ„ë ¥ì ì¸ ë„¤íŠ¸ì›Œí¬ íŒŒì¼ ì‹œìŠ¤í…œ**ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ëŠ” ì—¬ëŸ¬ EC2 ì¸ìŠ¤í„´ìŠ¤ ë° ê¸°íƒ€ AWS ì„œë¹„ìŠ¤ì—ì„œ ë™ì‹œì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” **íŒŒì¼ ì‹œìŠ¤í…œ**ì˜ ìƒì„±ê³¼ êµ¬ì„±ì„ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤. EFSì˜ ì£¼ìš” ê¸°ëŠ¥ì€ ìˆ˜ë™ ê°œì… ì—†ì´ ìë™ìœ¼ë¡œ í™•ì¥í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥, ì €ì§€ì—° ì•¡ì„¸ìŠ¤ ì œê³µ, ê³ ì²˜ë¦¬ëŸ‰ ì›Œí¬ë¡œë“œ ì§€ì›, ë°ì´í„° ë‚´êµ¬ì„± ë³´ì¥ ë° ë‹¤ì–‘í•œ AWS ë³´ì•ˆ ë©”ì»¤ë‹ˆì¦˜ê³¼ì˜ ì›í™œí•œ í†µí•©ì„ í¬í•¨í•©ë‹ˆë‹¤.

**ê¸°ë³¸ì ìœ¼ë¡œ**, ë§ˆìš´íŠ¸í•  EFS í´ë”ëŠ” **`/`**ì´ì§€ë§Œ **ë‹¤ë¥¸ ì´ë¦„**ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

### ë„¤íŠ¸ì›Œí¬ ì•¡ì„¸ìŠ¤

EFSëŠ” VPCì—ì„œ ìƒì„±ë˜ë©° **ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  VPC í•˜ìœ„ë„¤íŠ¸ì›Œí¬ì—ì„œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ê·¸ëŸ¬ë‚˜ EFSì—ëŠ” ë³´ì•ˆ ê·¸ë£¹ì´ ìˆìŠµë‹ˆë‹¤. EFSë¥¼ ë§ˆìš´íŠ¸í•  EC2 (ë˜ëŠ” ë‹¤ë¥¸ AWS ì„œë¹„ìŠ¤)ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ í•˜ë ¤ë©´ EFS ë³´ì•ˆ ê·¸ë£¹ì—ì„œ EC2 ë³´ì•ˆ ê·¸ë£¹ìœ¼ë¡œë¶€í„°ì˜ **inbound NFS** (2049 í¬íŠ¸) **ê·œì¹™ì„ í—ˆìš©**í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ë¥¼ í•˜ì§€ ì•Šìœ¼ë©´ **NFS ì„œë¹„ìŠ¤ì— ì—°ë½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**.

ì´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ ì°¸ì¡°í•˜ì„¸ìš”: [https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount](https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount)

### ì—´ê±°
```bash
# Get filesystems and access policies (if any)
aws efs describe-file-systems
aws efs describe-file-system-policy --file-system-id <id>

# Get subnetworks and IP addresses where you can find the file system
aws efs describe-mount-targets --file-system-id <id>
aws efs describe-mount-target-security-groups --mount-target-id <id>
aws ec2 describe-security-groups --group-ids <sg_id>

# Get other access points
aws efs describe-access-points

# Get replication configurations
aws efs describe-replication-configurations

# Search for NFS in EC2 networks
sudo nmap -T4 -Pn -p 2049 --open 10.10.10.0/20 # or /16 to be sure
```
{% hint style="danger" %}
EFS ë§ˆìš´íŠ¸ í¬ì¸íŠ¸ê°€ ë™ì¼í•œ VPC ë‚´ì— ìˆì§€ë§Œ ë‹¤ë¥¸ ì„œë¸Œë„·ì— ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ëª¨ë“  **EFS í¬ì¸íŠ¸ë¥¼ ì°¾ìœ¼ë ¤ë©´ `/16` ë„·ë§ˆìŠ¤í¬ë¥¼ ìŠ¤ìº”í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤**.
{% endhint %}

### EFS ë§ˆìš´íŠ¸í•˜ê¸°

{% code overflow="wrap" %}
```bash
sudo mkdir /efs

## Mount found
sudo apt install nfs-common
sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport <IP>:/ /efs

## Mount with efs type
## You need to have installed the package amazon-efs-utils
sudo yum install amazon-efs-utils # If centos
sudo apt-get install amazon-efs-utils # If ubuntu
sudo mount -t efs <file-system-id/EFS DNS name>:/ /efs/
```
{% endcode %}

### IAM ì•¡ì„¸ìŠ¤

ê¸°ë³¸ì ìœ¼ë¡œ EFSì— **ë„¤íŠ¸ì›Œí¬ ì•¡ì„¸ìŠ¤** ê¶Œí•œì´ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ìëŠ” **ë£¨íŠ¸ ì‚¬ìš©ìë¡œì„œ ë§ˆìš´íŠ¸, ì½ê¸° ë° ì“°ê¸°**ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ íŒŒì¼ ì‹œìŠ¤í…œ ì •ì±…ì„ í†µí•´ íŠ¹ì • ê¶Œí•œì„ ê°€ì§„ ì£¼ì²´ë§Œì´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì˜ˆë¥¼ ë“¤ì–´, ì´ íŒŒì¼ ì‹œìŠ¤í…œ ì •ì±…ì€ **IAM ê¶Œí•œì´ ì—†ëŠ” ê²½ìš°ì—ëŠ” íŒŒì¼ ì‹œìŠ¤í…œì„ ë§ˆìš´íŠ¸í•  ìˆ˜ ì—†ë„ë¡** ì„¤ì •í•©ë‹ˆë‹¤.
```json
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-2ca2ba76-5d83-40be-8557-8f6c19eaa797",
"Statement": [
{
"Sid": "efs-statement-e7f4b04c-ad75-4a7f-a316-4e5d12f0dbf5",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": "",
"Resource": "arn:aws:elasticfilesystem:us-east-1:318142138553:file-system/fs-0ab66ad201b58a018",
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
ë˜ëŠ” ì´ë ‡ê²Œ í•˜ë©´ **ìµëª… ì•¡ì„¸ìŠ¤ê°€ ë°©ì§€**ë©ë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (3) (6).png" alt=""><figcaption></figcaption></figure>

IAMìœ¼ë¡œ ë³´í˜¸ëœ íŒŒì¼ ì‹œìŠ¤í…œì„ ë§ˆìš´íŠ¸í•˜ë ¤ë©´ ë§ˆìš´íŠ¸ ëª…ë ¹ì—ì„œ "efs" ìœ í˜•ì„ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤:
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
# To use a different pforile from ~/.aws/credentials
# You can use: -o tls,iam,awsprofile=namedprofile
```
### ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸

**ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸**ëŠ” **EFS íŒŒì¼ ì‹œìŠ¤í…œ**ì— ëŒ€í•œ **ì‘ìš© í”„ë¡œê·¸ë¨ë³„ ì§„ì…ì **ìœ¼ë¡œ, ê³µìœ  ë°ì´í„° ì„¸íŠ¸ì— ëŒ€í•œ ì‘ìš© í”„ë¡œê·¸ë¨ ì•¡ì„¸ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê¸° ì‰½ê²Œ í•´ì¤ë‹ˆë‹¤.

ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ë¥¼ ìƒì„±í•  ë•Œ, ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ë¥¼ í†µí•´ ìƒì„±ë˜ëŠ” íŒŒì¼ê³¼ ë””ë ‰í† ë¦¬ì˜ **ì†Œìœ ìì™€ POSIX ê¶Œí•œì„ ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì›í•˜ëŠ” ê¶Œí•œìœ¼ë¡œ ê¸°ì¡´ ë””ë ‰í† ë¦¬ë¥¼ ì§€ì •í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ì—¬ **ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ì— ëŒ€í•œ ì‚¬ìš©ì ë˜ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ë³„ ì•¡ì„¸ìŠ¤ë¥¼ ì œì–´**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µìœ  íŒŒì¼ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê³  ë³´ì•ˆí•˜ëŠ” ê²ƒì´ ë”ìš± ìš©ì´í•´ì§‘ë‹ˆë‹¤.

**ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ì—ì„œ íŒŒì¼ ì‹œìŠ¤í…œì„ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:**
```bash
# Use IAM if you need to use iam permissions
sudo mount -t efs -o tls,[iam],accesspoint=<access-point-id> \
<file-system-id/EFS DNS> /efs/
```
{% hint style="warning" %}
NFS ì„œë¹„ìŠ¤ì— ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ë§Œ ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ë¥¼ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ EFSì— íŒŒì¼ ì‹œìŠ¤í…œ ì •ì±…ì´ ìˆëŠ” ê²½ìš° ë§ˆìš´íŠ¸í•˜ê¸° ìœ„í•´ ì¶©ë¶„í•œ IAM ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.
{% endhint %}

ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **ê¶Œí•œ ê´€ë¦¬ ê°„ì†Œí™”**: ê° ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ì— ëŒ€í•´ POSIX ì‚¬ìš©ìì™€ ê·¸ë£¹ì„ ì •ì˜í•¨ìœ¼ë¡œì¨ ê¸°ë³¸ íŒŒì¼ ì‹œìŠ¤í…œì˜ ê¶Œí•œì„ ìˆ˜ì •í•˜ì§€ ì•Šê³ ë„ ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë˜ëŠ” ì‚¬ìš©ìì˜ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ê°•ì œ**: ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ëŠ” EFS íŒŒì¼ ì‹œìŠ¤í…œ ë‚´ì˜ íŠ¹ì • ë””ë ‰í† ë¦¬ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì œí•œí•˜ì—¬ ê° ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ ì‚¬ìš©ìê°€ ì§€ì •ëœ í´ë” ë‚´ì—ì„œ ì‘ë™í•˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìš°ì—°í•œ ë°ì´í„° ë…¸ì¶œì´ë‚˜ ìˆ˜ì •ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ë” ì‰¬ìš´ íŒŒì¼ ì‹œìŠ¤í…œ ì•¡ì„¸ìŠ¤**: ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ëŠ” AWS Lambda í•¨ìˆ˜ ë˜ëŠ” AWS Fargate ì‘ì—…ê³¼ ì—°ê²°ë  ìˆ˜ ìˆì–´, ì„œë²„ë¦¬ìŠ¤ ë° ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íŒŒì¼ ì‹œìŠ¤í…œ ì•¡ì„¸ìŠ¤ë¥¼ ê°„ì†Œí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ê¶Œí•œ ìƒìŠ¹

{% content-ref url="../aws-privilege-escalation/aws-efs-privesc.md" %}
[aws-efs-privesc.md](../aws-privilege-escalation/aws-efs-privesc.md)
{% endcontent-ref %}

## ì‚¬í›„ ì¹¨íˆ¬

{% content-ref url="../aws-post-exploitation/aws-efs-post-exploitation.md" %}
[aws-efs-post-exploitation.md](../aws-post-exploitation/aws-efs-post-exploitation.md)
{% endcontent-ref %}

## ì§€ì†ì„±

{% content-ref url="../aws-persistence/aws-efs-persistence.md" %}
[aws-efs-persistence.md](../aws-persistence/aws-efs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* HackTricksì—ì„œ **íšŒì‚¬ ê´‘ê³ ë¥¼ ë³´ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìƒí’ˆ**](https://peass.creator-spring.com)ì„ êµ¬ë§¤í•˜ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
