# Cognito ì‚¬ìš©ì í’€

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì—ì„œ <strong>AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”</strong>!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œë¡œ **PR ì œì¶œ**í•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

ì‚¬ìš©ì í’€ì€ Amazon Cognitoì˜ ì‚¬ìš©ì ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤. ì‚¬ìš©ì í’€ì„ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ìë“¤ì´ Amazon Cognitoë¥¼ í†µí•´ **ì›¹ ë˜ëŠ” ëª¨ë°”ì¼ ì•±ì— ë¡œê·¸ì¸**í•˜ê±°ë‚˜ **ì œ3ì** ì‹ë³„ ê³µê¸‰ì(IdP)ë¥¼ í†µí•´ **ì—°í•©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì§ì ‘ ë¡œê·¸ì¸í•˜ë“  ì œ3ìë¥¼ í†µí•´ ë¡œê·¸ì¸í•˜ë“  ì‚¬ìš©ì í’€ì˜ ëª¨ë“  êµ¬ì„±ì›ì€ SDKë¥¼ í†µí•´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ë””ë ‰í„°ë¦¬ í”„ë¡œí•„ì„ ê°–ìŠµë‹ˆë‹¤.

ì‚¬ìš©ì í’€ì€ ë‹¤ìŒì„ ì œê³µí•©ë‹ˆë‹¤:

* ê°€ì… ë° ë¡œê·¸ì¸ ì„œë¹„ìŠ¤.
* ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‚´ì¥í˜• ì‚¬ìš©ì ì§€ì • ì›¹ UI.
* Facebook, Google, Amazon ë¡œê·¸ì¸, Apple ë¡œê·¸ì¸ ë° ì‚¬ìš©ì í’€ì˜ SAML ë° OIDC ì‹ë³„ ê³µê¸‰ìë¥¼ í†µí•œ ì†Œì…œ ë¡œê·¸ì¸.
* ì‚¬ìš©ì ë””ë ‰í„°ë¦¬ ê´€ë¦¬ ë° ì‚¬ìš©ì í”„ë¡œí•„.
* ë‹¤ì¤‘ ìš”ì†Œ ì¸ì¦(MFA), ì¹¨í•´ëœ ìê²© ì¦ëª… í™•ì¸, ê³„ì • íƒˆì·¨ ë°©ì§€, ì „í™” ë° ì´ë©”ì¼ í™•ì¸ê³¼ ê°™ì€ ë³´ì•ˆ ê¸°ëŠ¥.
* AWS Lambda íŠ¸ë¦¬ê±°ë¥¼ í†µí•œ ì‚¬ìš©ì ì •ì˜ ì›Œí¬í”Œë¡œ ë° ì‚¬ìš©ì ì´ì „.

ì¼ë°˜ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **ì†ŒìŠ¤ ì½”ë“œ**ì—ëŠ” ì‚¬ìš©ì í’€ IDì™€ í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ID(ê·¸ë¦¬ê³  ë•Œë¡œëŠ” **ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹„ë°€**?)ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” Cognito ì‚¬ìš©ì í’€ì— **ë¡œê·¸ì¸**í•˜ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.

### ì ì¬ì ì¸ ê³µê²©

* **ë“±ë¡**: ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ìëŠ” ìì²´ì ìœ¼ë¡œ ë“±ë¡í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìì‹ ì„ ìœ„í•´ ì‚¬ìš©ìë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ì‚¬ìš©ì ì—´ê±°**: ë“±ë¡ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ì ì´ë¦„ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²©ì— ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ë¡œê·¸ì¸ ë¸Œë£¨íŠ¸í¬ìŠ¤**: [**ì¸ì¦**](cognito-user-pools.md#authentication) ì„¹ì…˜ì—ì„œ ì‚¬ìš©ìê°€ **ë¡œê·¸ì¸**í•´ì•¼ í•˜ëŠ” **ëª¨ë“  ë°©ë²•**ì´ ë‚˜ì™€ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ë¸Œë£¨íŠ¸í¬ìŠ¤í•˜ì—¬ **ìœ íš¨í•œ ìê²© ì¦ëª…ì„ ì°¾ì„ ìˆ˜** ìˆìŠµë‹ˆë‹¤.

### íœí…ŒìŠ¤íŒ… ë„êµ¬

* [Pacu](https://github.com/RhinoSecurityLabs/pacu), AWS ì·¨ì•½ì  ë¶„ì„ í”„ë ˆì„ì›Œí¬,ëŠ” ì´ì œ ê³„ì •ì˜ ëª¨ë“  Cognito ìì‚°ì„ ì—´ê±°í•˜ê³  ì·¨ì•½í•œ êµ¬ì„±, ì•¡ì„¸ìŠ¤ ì œì–´ì— ì‚¬ìš©ë˜ëŠ” ì‚¬ìš©ì ì†ì„± ë“±ì„ ì‹ë³„í•˜ë©° (MFA ì§€ì› í¬í•¨) ì‚¬ìš©ì ìƒì„± ë° ìˆ˜ì • ê°€ëŠ¥í•œ ì‚¬ìš©ì ì§€ì • ì†ì„±, ì‚¬ìš© ê°€ëŠ¥í•œ ID í’€ ìê²© ì¦ëª…, ID í† í°ì˜ ê°€ì • ê°€ëŠ¥í•œ ì—­í•  ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ ê¶Œí•œ ìƒìŠ¹ì„ ìë™í™”í•˜ëŠ” "cognito\_\_enum" ë° "cognito\_\_attack" ëª¨ë“ˆì„ í¬í•¨í•©ë‹ˆë‹¤.

ëª¨ë“ˆ ê¸°ëŠ¥ì— ëŒ€í•œ ì„¤ëª…ì€ [ë¸”ë¡œê·¸ ê²Œì‹œë¬¼](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2)ì˜ 2ë¶€ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”. ì„¤ì¹˜ ì§€ì¹¨ì€ ì£¼ìš” [Pacu](https://github.com/RhinoSecurityLabs/pacu) í˜ì´ì§€ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

#### ì‚¬ìš©ë²•

ì£¼ì–´ì§„ ID í’€ ë° ì‚¬ìš©ì í’€ í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•´ ì‚¬ìš©ì ìƒì„± ë° ëª¨ë“  ê¶Œí•œ ìƒìŠ¹ ë²¡í„°ë¥¼ ì‹œë„í•˜ëŠ” ìƒ˜í”Œ cognito\_\_attack ì‚¬ìš©ë²•:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
ë‹¤ìŒì€ í˜„ì¬ AWS ê³„ì •ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ì í’€, ì‚¬ìš©ì í’€ í´ë¼ì´ì–¸íŠ¸, ID í’€, ì‚¬ìš©ì ë“±ì„ ìˆ˜ì§‘í•˜ê¸° ìœ„í•œ cognito\_\_enum ì‚¬ìš© ì˜ˆì‹œì…ë‹ˆë‹¤:
```bash
Pacu (new:test) > run cognito__enum
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner)ì€ Cognitoì— ëŒ€í•œ ë‹¤ì–‘í•œ ê³µê²©ì„ êµ¬í˜„í•œ Python CLI ë„êµ¬ë¡œ, ì›ì¹˜ ì•ŠëŠ” ê³„ì • ìƒì„± ë° ê³„ì • ì˜¤ë¼í´ì„ í¬í•¨í•©ë‹ˆë‹¤.

#### ì„¤ì¹˜
```bash
$ pip install cognito-scanner
```
#### ì‚¬ìš©ë²•
```bash
$ cognito-scanner --help
```
ë” ë§ì€ ì •ë³´ëŠ” https://github.com/padok-team/cognito-scannerì—ì„œ í™•ì¸í•˜ì„¸ìš”.

## ë“±ë¡

ì‚¬ìš©ì í’€ì€ **ê¸°ë³¸ì ìœ¼ë¡œ** **ìƒˆ ì‚¬ìš©ìë¥¼ ë“±ë¡**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
aws cognito-idp sign-up --client-id <client-id> \
--username <username> --password <password> \
--region <region> --no-sign-request
```
#### ëˆ„êµ¬ë‚˜ ë“±ë¡í•  ìˆ˜ ìˆëŠ” ê²½ìš°

ì‚¬ìš©ìì— ëŒ€í•œ **ë” ë§ì€ ì„¸ë¶€ ì •ë³´**ë¥¼ ì œê³µí•´ì•¼ í•œë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
An error occurred (InvalidParameterException) when calling the SignUp operation: Attributes did not conform to the schema: address: The attribute is required
```
ë‹¤ìŒì€ JSONê³¼ ê°™ì€ í•„ìš”í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```json
--user-attributes '[{"Name": "email", "Value": "carlospolop@gmail.com"}, {"Name":"gender", "Value": "M"}, {"Name": "address", "Value": "street"}, {"Name": "custom:custom_name", "Value":"supername&\"*$"}]'
```
ë‹¹ì‹ ì€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìë¥¼ **ì—´ê±°í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.** ì´ê²ƒì€ í•´ë‹¹ ì´ë¦„ìœ¼ë¡œ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìê°€ ìˆì„ ë•Œ ë‚˜íƒ€ë‚˜ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€ì…ë‹ˆë‹¤:
```
An error occurred (UsernameExistsException) when calling the SignUp operation: User already exists
```
{% hint style="info" %}
ì´ì „ ëª…ë ¹ì–´ì—ì„œ **ì‚¬ìš©ì ì •ì˜ ì†ì„±ì´ "custom:"ìœ¼ë¡œ ì‹œì‘**í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.\
ë˜í•œ ë“±ë¡í•  ë•Œ **ì‚¬ìš©ì ì •ì˜ ì†ì„±ì„ ìƒˆë¡œ ë§Œë“¤ ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì„ ì•Œì•„ë‘ì„¸ìš”**. **ê¸°ë³¸ ì†ì„±**(í•„ìˆ˜ ì†ì„±ì´ ì•„ë‹ˆë”ë¼ë„)ê³¼ **ì§€ì •ëœ ì‚¬ìš©ì ì •ì˜ ì†ì„±**ì—ë§Œ ê°’ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ IDê°€ ì¡´ì¬í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì´ë ‡ê²Œ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ IDê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```
An error occurred (ResourceNotFoundException) when calling the SignUp operation: User pool client 3ig612gjm56p1ljls1prq2miut does not exist.
```
#### ê´€ë¦¬ìë§Œ ì‚¬ìš©ìë¥¼ ë“±ë¡í•  ìˆ˜ ìˆëŠ” ê²½ìš°

ì´ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•˜ë©´ ì‚¬ìš©ìë¥¼ ë“±ë¡í•˜ê±°ë‚˜ ë‚˜ì—´í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤:
```
An error occurred (NotAuthorizedException) when calling the SignUp operation: SignUp is not permitted for this user pool
```
### ë“±ë¡ í™•ì¸

CognitoëŠ” **ì´ë©”ì¼ ë˜ëŠ” ì „í™”ë²ˆí˜¸ë¥¼ í™•ì¸í•¨ìœ¼ë¡œì¨ ìƒˆ ì‚¬ìš©ìë¥¼ í™•ì¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ìë¥¼ ìƒì„±í•  ë•Œ ì¼ë°˜ì ìœ¼ë¡œ **ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ ë° ì´ë©”ì¼ ë°/ë˜ëŠ” ì „í™”ë²ˆí˜¸**ê°€ í•„ìš”í•©ë‹ˆë‹¤. **ì œì–´í•˜ëŠ”** í•˜ë‚˜ë¥¼ ì„¤ì •í•˜ì—¬ ìƒˆë¡œ ìƒì„±ëœ ì‚¬ìš©ì **ê³„ì •**ì„ í™•ì¸í•˜ëŠ” ì½”ë“œë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
aws cognito-idp confirm-sign-up --client-id <cliet_id> \
--username aasdasd2 --confirmation-code <conf_code> \
--no-sign-request --region us-east-1
```
{% hint style="warning" %}
ìƒì„±ëœ ì‚¬ìš©ìë¥¼ í™•ì¸í•´ì•¼ í•  ë•Œ **ê°™ì€ ì´ë©”ì¼**ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ë”ë¼ë„ CognitoëŠ” ë™ì¼í•œ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì— ëŒ€í•´ **ì´ì˜ë¥¼ ì œê¸°í•˜ê³  ê³„ì • í™•ì¸ì„ í—ˆìš©í•˜ì§€ ì•Šì„ ê²ƒ**ì…ë‹ˆë‹¤.
{% endhint %}

### Privilege Escalation / Updating Attributes

ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ìëŠ” ë‹¤ìŒê³¼ ê°™ì´ **ì†ì„± ê°’**ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
aws cognito-idp update-user-attributes \
--region us-east-1 --no-sign-request \
--user-attributes Name=address,Value=street \
--access-token <access token>
```
#### ì‚¬ìš©ì ì§€ì • ì†ì„± ê¶Œí•œ ìƒìŠ¹

{% hint style="danger" %}
ê¸°ë³¸ì ìœ¼ë¡œ **ìì²´ ì†ì„± ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— (ì˜ˆ: `isAdmin`ê³¼ ê°™ì€) ì‚¬ìš©ì ì§€ì • ì†ì„±ì„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.** ìì²´ ì†ì„± ê°’ì„ ë³€ê²½í•˜ì—¬ **ê¶Œí•œì„ ìƒìŠ¹**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
{% endhint %}

#### ì´ë©”ì¼/ì‚¬ìš©ì ì´ë¦„ ìˆ˜ì • ê¶Œí•œ ìƒìŠ¹

ì‚¬ìš©ìì˜ **ì´ë©”ì¼ ë° ì „í™”ë²ˆí˜¸ë¥¼ ìˆ˜ì •**í•  ìˆ˜ ìˆì§€ë§Œ, ê³„ì •ì´ í™•ì¸ëœ ìƒíƒœë¡œ ìœ ì§€ë˜ë”ë¼ë„ í•´ë‹¹ ì†ì„±ì€ **í™•ì¸ë˜ì§€ ì•Šì€ ìƒíƒœë¡œ ì„¤ì •**ë©ë‹ˆë‹¤ (ë‹¤ì‹œ í™•ì¸í•´ì•¼ í•¨).

{% hint style="warning" %}
**ì´ë©”ì¼ ë˜ëŠ” ì „í™”ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.** í™•ì¸í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œë„ **ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.\
ì´ë©”ì¼ì´ ìˆ˜ì •ë˜ì—ˆê³  í™•ì¸ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë„ ID í† í° ë‚´ **`email`** **í•„ë“œ**ì— ë‚˜íƒ€ë‚˜ë©° **`email_verified`** í•„ë“œëŠ” **false**ê°€ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì•±ì´ **ì´ë¥¼ í™•ì¸í•˜ì§€ ì•ŠëŠ” ê²½ìš° ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ í‰ë‚´ ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ë˜í•œ, **`name`** í•„ë“œì— ì•„ë¬´ ê°’ì´ë‚˜ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ì´ë¦„ ì†ì„±ì„ ìˆ˜ì •**í•˜ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤. ì•±ì´ **`email`** ëŒ€ì‹  **í•´ë‹¹ í•„ë“œë¥¼ í™•ì¸í•˜ëŠ” ê²½ìš° (ë˜ëŠ” ë‹¤ë¥¸ ì†ì„±)** ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ **í‰ë‚´ ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
{% endhint %}

ì–´ì¨Œë“ , ì˜ˆë¥¼ ë“¤ì–´ ì´ë©”ì¼ì„ ìƒˆ ì´ë©”ì¼ë¡œ ë³€ê²½í•œ ê²½ìš° í•´ë‹¹ ì´ë©”ì¼ ì£¼ì†Œë¡œ ë°›ì€ ì½”ë“œë¡œ ì´ë©”ì¼ì„ **í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:
```bash
aws cognito-idp verify-user-attribute \
--access-token <access_token> \
--attribute-name email --code <code> \
--region <region> --no-sign-request
```
**`ì´ë©”ì¼`** ëŒ€ì‹  **`ì „í™”ë²ˆí˜¸`**ë¥¼ ì‚¬ìš©í•˜ì—¬ **ìƒˆ ì „í™”ë²ˆí˜¸**ë¥¼ ë³€ê²½/í™•ì¸í•©ë‹ˆë‹¤.

{% hint style="info" %}
ê´€ë¦¬ìëŠ” ë˜í•œ **ì‚¬ìš©ì ì„ í˜¸í•˜ëŠ” ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸** ì˜µì…˜ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ **ì‚¬ìš©ì ì´ë¦„ ë˜ëŠ” preferred\_usernameì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ í‘œì‹œí•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥**í•©ë‹ˆë‹¤.
{% endhint %}

### ë¹„ë°€ë²ˆí˜¸ ë³µêµ¬/ë³€ê²½

**ì‚¬ìš©ì ì´ë¦„ì„ ì•Œê³  ìˆë‹¤ë©´**(ë˜ëŠ” ì´ë©”ì¼ ë˜ëŠ” ì „í™”ë²ˆí˜¸ê°€ í—ˆìš©ë¨) í•´ë‹¹ ì‚¬ìš©ìì—ê²Œ ì½”ë“œê°€ ì „ì†¡ë˜ì–´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë‹¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³µêµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
aws cognito-idp forgot-password \
--client-id <client_id> \
--username <username/email/phone> --region <region>
```
{% hint style="info" %}
ì„œë²„ì˜ ì‘ë‹µì€ í•­ìƒ ê¸ì •ì ì¼ ê²ƒì´ë©°, ì‚¬ìš©ì ì´ë¦„ì´ ì¡´ì¬í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë° ì´ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
{% endhint %}

í•´ë‹¹ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
aws cognito-idp confirm-forgot-password \
--client-id <client_id> \
--username <username> \
--confirmation-code <conf_code> \
--password <pwd> --region <region>
```
ì´ì „ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œì•„ì•¼ë§Œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
aws cognito-idp change-password \
--previous-password <value> \
--proposed-password <value> \
--access-token <value>
```
## ì¸ì¦

ì‚¬ìš©ì í’€ì€ **ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ì¸ì¦**ì„ ì§€ì›í•©ë‹ˆë‹¤. **ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸**ê°€ ìˆëŠ” ê²½ìš° ë¡œê·¸ì¸í•  ìˆ˜ ìˆëŠ” **ë‹¤ì–‘í•œ ë°©ë²•**ë„ ì§€ì›ë©ë‹ˆë‹¤. ë˜í•œ, ì‚¬ìš©ìê°€ í’€ì—ì„œ ì¸ì¦ë˜ë©´ **3 ì¢…ë¥˜ì˜ í† í°**ì´ ì œê³µë©ë‹ˆë‹¤: **ID í† í°**, **ì•¡ì„¸ìŠ¤ í† í°** ë° **ë¦¬í”„ë ˆì‹œ í† í°**.

* [**ID í† í°**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-id-token.html): **ì¸ì¦ëœ ì‚¬ìš©ìì˜ ì‹ ì›**ì— ëŒ€í•œ í´ë ˆì„(claim)ì¸ `name`, `email`, `phone_number` ë“±ì„ í¬í•¨í•©ë‹ˆë‹¤. ID í† í°ì€ ë˜í•œ **ë¦¬ì†ŒìŠ¤ ì„œë²„ë‚˜ ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì‚¬ìš©ìë¥¼ ì¸ì¦**í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™¸ë¶€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ID í† í°ì˜ **ì„œëª…(signature)ì„ í™•ì¸**í•´ì•¼ë§Œ ID í† í° ë‚´ì˜ ì–´ë– í•œ í´ë ˆì„ë„ ì‹ ë¢°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ID í† í°ì€ ì‚¬ìš©ìì˜ ì†ì„± ê°’, ì‹¬ì§€ì–´ ì‚¬ìš©ì ì§€ì • ì†ì„±ê¹Œì§€ í¬í•¨í•˜ëŠ” í† í°ì…ë‹ˆë‹¤.
* [**ì•¡ì„¸ìŠ¤ í† í°**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html): **ì¸ì¦ëœ ì‚¬ìš©ìì— ëŒ€í•œ í´ë ˆì„**, ì‚¬ìš©ìì˜ ê·¸ë£¹ ëª©ë¡ ë° ìŠ¤ì½”í”„ ëª©ë¡ì„ í¬í•¨í•©ë‹ˆë‹¤. ì•¡ì„¸ìŠ¤ í† í°ì˜ ëª©ì ì€ ì‚¬ìš©ì í’€ì˜ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ì—ì„œ **API ì‘ì—…ì„ ìŠ¹ì¸**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì•¡ì„¸ìŠ¤ í† í°ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì‚¬ìš©ì ì†ì„±ì„ ì¶”ê°€, ë³€ê²½ ë˜ëŠ” ì‚­ì œí•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* [**ë¦¬í”„ë ˆì‹œ í† í°**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html): ë¦¬í”„ë ˆì‹œ í† í°ì„ ì‚¬ìš©í•˜ë©´ **ë¦¬í”„ë ˆì‹œ í† í°ì´ ë¬´íš¨í™”ë  ë•Œê¹Œì§€ ì‚¬ìš©ìì—ê²Œ ìƒˆë¡œìš´ ID í† í° ë° ì•¡ì„¸ìŠ¤ í† í°ì„ ì–»ì„ ìˆ˜** ìˆìŠµë‹ˆë‹¤. **ê¸°ë³¸ì ìœ¼ë¡œ**, ë¦¬í”„ë ˆì‹œ í† í°ì€ ì‚¬ìš©ìê°€ ì‚¬ìš©ì í’€ì— ë¡œê·¸ì¸í•œ í›„ **30ì¼ í›„ì— ë§Œë£Œ**ë©ë‹ˆë‹¤. ì‚¬ìš©ì í’€ì„ ìœ„í•œ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ ë•Œ ì‘ìš© í”„ë¡œê·¸ë¨ì˜ ë¦¬í”„ë ˆì‹œ í† í° ë§Œë£Œë¥¼ **60ë¶„ë¶€í„° 10ë…„ ì‚¬ì´ì˜ ê°’**ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ADMIN\_NO\_SRP\_AUTH ë° ADMIN\_USER\_PASSWORD\_AUTH

ì´ëŠ” ì„œë²„ ì¸¡ ì¸ì¦ íë¦„ì…ë‹ˆë‹¤:

* ì„œë²„ ì¸¡ ì•±ì€ `InitiateAuth` ëŒ€ì‹  **`AdminInitiateAuth` API ì‘ì—…**ì„ í˜¸ì¶œí•©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ **`cognito-idp:AdminInitiateAuth`** ë° **`cognito-idp:AdminRespondToAuthChallenge`**ì„ í¬í•¨í•˜ëŠ” ê¶Œí•œì´ ìˆëŠ” AWS ìê²© ì¦ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ í•„ìš”í•œ ì¸ì¦ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
* ì„œë²„ ì¸¡ ì•±ì´ **ì¸ì¦ ë§¤ê°œë³€ìˆ˜**ë¥¼ ê°€ì§€ê³  ìˆëŠ” ê²½ìš°, **`AdminRespondToAuthChallenge` API ì‘ì—…**ì„ í˜¸ì¶œí•©ë‹ˆë‹¤. `AdminRespondToAuthChallenge` API ì‘ì—…ì€ AWS ìê²© ì¦ëª…ì„ ì œê³µí•  ë•Œì—ë§Œ ì„±ê³µí•©ë‹ˆë‹¤.

ì´ **ë°©ë²•ì€ ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤**.

**ë¡œê·¸ì¸**í•˜ë ¤ë©´ ë‹¤ìŒì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤:

* ì‚¬ìš©ì í’€ ID
* í´ë¼ì´ì–¸íŠ¸ ID
* ì‚¬ìš©ì ì´ë¦„
* ë¹„ë°€ë²ˆí˜¸
* í´ë¼ì´ì–¸íŠ¸ ë¹„ë°€ (ì•±ì´ ë¹„ë°€ì„ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±ëœ ê²½ìš°ì—ë§Œ í•„ìš”)

{% hint style="info" %}
ì´ ë°©ë²•ìœ¼ë¡œ **ë¡œê·¸ì¸í•  ìˆ˜ ìˆë„ë¡**í•˜ë ¤ë©´ í•´ë‹¹ ì‘ìš© í”„ë¡œê·¸ë¨ì´ `ALLOW_ADMIN_USER_PASSWORD_AUTH`ë¡œ ë¡œê·¸ì¸ì„ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤.\
ë˜í•œ, ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë ¤ë©´ **`cognito-idp:AdminInitiateAuth`** ë° **`cognito-idp:AdminRespondToAuthChallenge`** ê¶Œí•œì´ ìˆëŠ” ìê²© ì¦ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.
{% endhint %}
```python
aws cognito-idp admin-initiate-auth \
--client-id <client-id> \
--auth-flow ADMIN_USER_PASSWORD_AUTH \
--region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'
--user-pool-id "<pool-id>"

# Check the python code to learn how to generate the hsecret_hash
```
<details>

<summary>ë¡œê·¸ì¸ìš© ì½”ë“œ</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.admin_initiate_auth(
UserPoolId=user_pool_id,
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_PASSWORD\_AUTH

ì´ ë°©ë²•ì€ ë˜ ë‹¤ë¥¸ ê°„ë‹¨í•˜ê³  ì „í†µì ì¸ ì‚¬ìš©ì ë° ì•”í˜¸ ì¸ì¦ íë¦„ì…ë‹ˆë‹¤. ì „í†µì ì¸ ì¸ì¦ ë°©ë²•ì„ Cognitoë¡œ ì´ì „í•˜ê³  ê·¸ í›„ì— ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„¤íŠ¸ì›Œí¬ë¡œ ì „ì†¡í•˜ì§€ ì•ŠëŠ” ALLOW\_USER\_SRP\_AUTH ë°©ë²•ì„ ëŒ€ì‹  ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤. ì´ ë°©ë²•ì€ ê¸°ë³¸ì ìœ¼ë¡œ **í™œì„±í™”ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤**.

ì½”ë“œ ë‚´ì˜ ì´ì „ ì¸ì¦ ë°©ë²•ê³¼ì˜ ì£¼ìš” ì°¨ì´ì ì€ ì‚¬ìš©ì í’€ IDë¥¼ ì•Œ í•„ìš”ê°€ ì—†ìœ¼ë©° Cognito ì‚¬ìš©ì í’€ì—ì„œ ì¶”ê°€ ê¶Œí•œì´ í•„ìš”í•˜ì§€ ì•Šë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

ë¡œê·¸ì¸í•˜ë ¤ë©´ ë‹¤ìŒì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤:

- í´ë¼ì´ì–¸íŠ¸ ID
- ì‚¬ìš©ì ì´ë¦„
- ë¹„ë°€ë²ˆí˜¸
- í´ë¼ì´ì–¸íŠ¸ ë¹„ë°€ (ì•±ì´ ë¹„ë°€ì„ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±ëœ ê²½ìš°ì—ë§Œ)

{% hint style="info" %}
ì´ ë°©ë²•ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ë ¤ë©´ í•´ë‹¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ALLOW\_USER\_PASSWORD\_AUTHë¡œ ë¡œê·¸ì¸ì„ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤.
{% endhint %}
```python
aws cognito-idp initiate-auth  --client-id <client-id> \
--auth-flow USER_PASSWORD_AUTH --region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'

# Check the python code to learn how to generate the secret_hash
```
<details>

<summary>ë¡œê·¸ì¸ì„ ìœ„í•œ Python ì½”ë“œ</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### ì‚¬ìš©ì\_SRP\_ì¸ì¦

ì´ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì´ì „ ê²ƒê³¼ ìœ ì‚¬í•˜ì§€ë§Œ **ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ë³´ë‚´ëŠ” ëŒ€ì‹ ** **ë„ì „ ì¸ì¦ì´ ìˆ˜í–‰**ë©ë‹ˆë‹¤ (ë”°ë¼ì„œ ì•”í˜¸ê°€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì•”í˜¸í™”ë˜ì–´ë„ ì „ì†¡ë˜ì§€ ì•ŠìŒ).\
ì´ **ë°©ë²•ì€** ê¸°ë³¸ì ìœ¼ë¡œ **í™œì„±í™”**ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

**ë¡œê·¸ì¸**í•˜ë ¤ë©´ ë‹¤ìŒì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤:

* ì‚¬ìš©ì í’€ ID
* í´ë¼ì´ì–¸íŠ¸ ID
* ì‚¬ìš©ì ì´ë¦„
* ë¹„ë°€ë²ˆí˜¸
* í´ë¼ì´ì–¸íŠ¸ ë¹„ë°€ (ì•±ì´ ë¹„ë°€ì„ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±ëœ ê²½ìš°ì—ë§Œ) 

<details>

<summary>ë¡œê·¸ì¸í•˜ëŠ” ì½”ë“œ</summary>
```python
from warrant.aws_srp import AWSSRP
import os

USERNAME='xxx'
PASSWORD='yyy'
POOL_ID='us-east-1_zzzzz'
CLIENT_ID = '12xxxxxxxxxxxxxxxxxxxxxxx'
CLIENT_SECRET = 'secreeeeet'
os.environ["AWS_DEFAULT_REGION"] = "<region>"

aws = AWSSRP(username=USERNAME, password=PASSWORD, pool_id=POOL_ID,
client_id=CLIENT_ID, client_secret=CLIENT_SECRET)
tokens = aws.authenticate_user()
id_token = tokens['AuthenticationResult']['IdToken']
refresh_token = tokens['AuthenticationResult']['RefreshToken']
access_token = tokens['AuthenticationResult']['AccessToken']
token_type = tokens['AuthenticationResult']['TokenType']
```
</details>

### REFRESH\_TOKEN\_AUTH & REFRESH\_TOKEN

**ì´ ë°©ë²•ì€ í•­ìƒ ìœ íš¨**í•©ë‹ˆë‹¤(ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ìŒ) ê·¸ëŸ¬ë‚˜ ìœ íš¨í•œ ë¦¬í”„ë ˆì‹œ í† í°ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
```bash
aws cognito-idp initiate-auth \
--client-id 3ig6h5gjm56p1ljls1prq2miut \
--auth-flow REFRESH_TOKEN_AUTH \
--region us-east-1 \
--auth-parameters 'REFRESH_TOKEN=<token>'
```
<details>

<summary>ì½”ë“œ ìƒˆë¡œ ê³ ì¹¨</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64

client_id = "<client-id>"
token = '<token>'

boto_client = boto3.client('cognito-idp', region_name='<region>')

def refresh(client_id, refresh_token):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='REFRESH_TOKEN_AUTH',
AuthParameters={
'REFRESH_TOKEN': refresh_token
}
)
except botocore.exceptions.ClientError as e:
return e.response


print(refresh(client_id, token))
```
</details>

### ì‚¬ìš©ì ì •ì˜ ì¸ì¦

ì´ ê²½ìš° **ì¸ì¦**ì€ **ëŒë‹¤ í•¨ìˆ˜ ì‹¤í–‰ì„ í†µí•´ ìˆ˜í–‰**ë©ë‹ˆë‹¤.

## ì¶”ê°€ ë³´ì•ˆ

### ê³ ê¸‰ ë³´ì•ˆ

ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ ìˆì§€ë§Œ í™œì„±í™”ëœ ê²½ìš°, CognitoëŠ” **ê³„ì • íƒˆì·¨ë¥¼ ê°ì§€**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í™•ë¥ ì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ **ë™ì¼í•œ ë„ì‹œ ë‚´ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë™ì¼í•œ ì‚¬ìš©ì ì—ì´ì „íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸**í•´ì•¼ í•©ë‹ˆë‹¤ (ê·¸ë¦¬ê³  ê°€ëŠ¥í•˜ë‹¤ë©´ IPë„).

### **MFA ê¸°ê¸° ê¸°ì–µ**

ì‚¬ìš©ìê°€ ë™ì¼í•œ ê¸°ê¸°ì—ì„œ ë¡œê·¸ì¸í•˜ëŠ” ê²½ìš° MFAê°€ ìš°íšŒë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, MFA ë³´í˜¸ë¥¼ ìš°íšŒí•˜ë ¤ë©´ ë™ì¼í•œ ë¸Œë¼ìš°ì €ì—ì„œ ë™ì¼í•œ ë©”íƒ€ë°ì´í„°(IP?)ë¡œ ë¡œê·¸ì¸í•˜ì‹­ì‹œì˜¤.

## ì‚¬ìš©ì í’€ ê·¸ë£¹ IAM ì—­í• 

**ì‚¬ìš©ìë¥¼ ì‚¬ìš©ì í’€** ê·¸ë£¹ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ **ì‚¬ìš©ì**ëŠ” **ë‹¤ë¥¸ IAM ì—­í• ì´ ë¶€ì—¬ëœ ì—¬ëŸ¬ ê·¸ë£¹ì— í• ë‹¹**ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë£¹ì´ IAM ì—­í• ì´ ë¶€ì—¬ëœ ê·¸ë£¹ ë‚´ì— ìˆë”ë¼ë„ í•´ë‹¹ ê·¸ë£¹ì˜ IAM ìê²© ì¦ëª…ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ **ì‚¬ìš©ì í’€ì´ Identity Poolì— ì‹ ë¢°**ë˜ì–´ì•¼ í•©ë‹ˆë‹¤(ê·¸ë¦¬ê³  í•´ë‹¹ Identity Poolì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ì•Œì•„ì•¼ í•¨).

ì‚¬ìš©ì í’€ì—ì„œ ì‚¬ìš©ìê°€ ì¸ì¦ë  ë•Œ **IdTokenì— í‘œì‹œëœ IAM ì—­í• ì„ ì–»ìœ¼ë ¤ë©´(`aws cognito-idp initiate-auth...`)** **Identity Provider ì¸ì¦ ê³µê¸‰ì**ê°€ **í† í°ì—ì„œ ì—­í• ì„ ì„ íƒí•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ë‚´ì•¼** í•©ë‹ˆë‹¤.

<figure><img src="../../../../.gitbook/assets/image (250).png" alt=""><figcaption></figcaption></figure>

ì‚¬ìš©ìê°€ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” **ì—­í• ì€ `IdToken` ë‚´ì—** ìˆìœ¼ë©°, ì‚¬ìš©ìëŠ” **`aws cognito-identity get-credentials-for-identity`ì—ì„œ `--custom-role-arn`**ì„ ì‚¬ìš©í•˜ì—¬ **ì–´ë–¤ ì—­í• ì— ëŒ€í•œ ìê²© ì¦ëª…ì„ ë°›ê³  ì‹¶ì€ì§€ ì„ íƒ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **ê¸°ë³¸ ì˜µì…˜ì´ êµ¬ì„±ëœ** ì˜µì…˜ì´ê³  IdTokenì—ì„œ ì—­í• ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ê³  ì‹œë„í•˜ë©´ **ì˜¤ë¥˜ê°€ ë°œìƒ**í•©ë‹ˆë‹¤(ì´ì „ êµ¬ì„±ì´ í•„ìš”í•œ ì´ìœ ì…ë‹ˆë‹¤):

{% code overflow="wrap" %}
```
An error occurred (InvalidParameterException) when calling the GetCredentialsForIdentity operation: Only SAML providers and providers with RoleMappings support custom role ARN.
```
{% endcode %}

{% hint style="warning" %}
**ì‚¬ìš©ì í’€ ê·¸ë£¹**ì— í• ë‹¹ëœ ì—­í• ì€ **ì‚¬ìš©ì í’€ì„ ì‹ ë¢°í•˜ëŠ” ID ê³µê¸‰ìì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼** í•©ë‹ˆë‹¤ (IAM ì—­í•  **ì„¸ì…˜ ìê²© ì¦ëª…ì´ í•´ë‹¹ì—ì„œ ì–»ì–´ì§ˆ ê²ƒ**ì´ê¸° ë•Œë¬¸ì—).
{% endhint %}
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"Federated": "cognito-identity.amazonaws.com"
},
"Action": "sts:AssumeRoleWithWebIdentity",
"Condition": {
"StringEquals": {
"cognito-identity.amazonaws.com:aud": "us-east-1:2361092e-9db6-a876-1027-10387c9de439"
},
"ForAnyValue:StringLike": {
"cognito-identity.amazonaws.com:amr": "authenticated"
}
}
}
]
}js
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì—ì„œ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”!</summary>

ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™¹**](https://peass.creator-spring.com)ì„ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
