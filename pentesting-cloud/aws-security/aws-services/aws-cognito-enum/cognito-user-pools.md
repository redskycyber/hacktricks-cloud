# Cognito User Pools

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±) ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'Ä± **takip edin**.
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## Temel Bilgiler

KullanÄ±cÄ± havuzu, Amazon Cognito'da bir kullanÄ±cÄ± dizinidir. Bir kullanÄ±cÄ± havuzu ile kullanÄ±cÄ±larÄ±nÄ±z, Amazon Cognito Ã¼zerinden web veya mobil uygulamanÄ±za **giriÅŸ yapabilir** veya **Ã¼Ã§Ã¼ncÃ¼ taraf** bir kimlik saÄŸlayÄ±cÄ± (IdP) aracÄ±lÄ±ÄŸÄ±yla **federasyon** yapabilir. KullanÄ±cÄ±larÄ±nÄ±z doÄŸrudan veya Ã¼Ã§Ã¼ncÃ¼ taraf aracÄ±lÄ±ÄŸÄ±yla giriÅŸ yapmÄ±ÅŸ olsun, kullanÄ±cÄ± havuzunun tÃ¼m Ã¼yeleri, bir SDK aracÄ±lÄ±ÄŸÄ±yla eriÅŸebileceÄŸiniz bir dizin profiline sahiptir.

KullanÄ±cÄ± havuzlarÄ±, aÅŸaÄŸÄ±dakileri saÄŸlar:

* KayÄ±t olma ve giriÅŸ yapma hizmetleri.
* KullanÄ±cÄ±larÄ±n giriÅŸ yapmasÄ± iÃ§in yerleÅŸik, Ã¶zelleÅŸtirilebilir bir web arayÃ¼zÃ¼.
* Facebook, Google, Amazon ile GiriÅŸ Yap ve Apple ile GiriÅŸ Yap, SAML ve OIDC kimlik saÄŸlayÄ±cÄ±larÄ± aracÄ±lÄ±ÄŸÄ±yla sosyal giriÅŸ yapma ve kullanÄ±cÄ± havuzunuzdan.
* KullanÄ±cÄ± dizini yÃ¶netimi ve kullanÄ±cÄ± profilleri.
* Ã‡ok faktÃ¶rlÃ¼ kimlik doÄŸrulama (MFA), tehlikede olan kimlik bilgileri iÃ§in kontrol, hesap ele geÃ§irmeye karÅŸÄ± koruma ve telefon ve e-posta doÄŸrulama gibi gÃ¼venlik Ã¶zellikleri.
* Ã–zelleÅŸtirilebilir iÅŸ akÄ±ÅŸlarÄ± ve AWS Lambda tetikleyicileri aracÄ±lÄ±ÄŸÄ±yla kullanÄ±cÄ± gÃ¶Ã§Ã¼.

UygulamalarÄ±n **kaynak kodu** genellikle ayrÄ±ca bir Cognito KullanÄ±cÄ± Havuzuna **giriÅŸ yapmak iÃ§in gereken kullanÄ±cÄ± havuzu kimliÄŸi** ve **istemci uygulama kimliÄŸi**ni (ve bazen **uygulama gizli anahtarÄ±nÄ±**?) iÃ§erir.

### Potansiyel saldÄ±rÄ±lar

* **KayÄ±t**: VarsayÄ±lan olarak bir kullanÄ±cÄ± kendini kaydedebilir, bu nedenle kendisi iÃ§in bir kullanÄ±cÄ± oluÅŸturabilir.
* **KullanÄ±cÄ± numaralandÄ±rma**: KayÄ±t iÅŸlevselliÄŸi, zaten var olan kullanÄ±cÄ± adlarÄ±nÄ± bulmak iÃ§in kullanÄ±labilir. Bu bilgi, brute-force saldÄ±rÄ±sÄ± iÃ§in faydalÄ± olabilir.
* **GiriÅŸ brute-force**: [**Kimlik doÄŸrulama**](cognito-user-pools.md#authentication) bÃ¶lÃ¼mÃ¼nde, bir kullanÄ±cÄ±nÄ±n **giriÅŸ yapmasÄ± gereken yÃ¶ntemlerin** tÃ¼mÃ¼ne sahipsiniz, bunlarÄ± brute-force deneyebilir ve **geÃ§erli kimlik bilgilerini bulabilirsiniz**.

### Pentest iÃ§in araÃ§lar

* [Pacu](https://github.com/RhinoSecurityLabs/pacu), AWS istismar Ã§erÃ§evesi, artÄ±k bir hesaptaki tÃ¼m Cognito varlÄ±klarÄ±nÄ±n numaralandÄ±rÄ±lmasÄ±nÄ± otomatikleÅŸtiren "cognito\_\_enum" ve "cognito\_\_attack" modÃ¼llerini iÃ§erir ve zayÄ±f yapÄ±landÄ±rmalarÄ±, eriÅŸim kontrolÃ¼ iÃ§in kullanÄ±lan kullanÄ±cÄ± Ã¶zniteliklerini vb. iÅŸaretler, ayrÄ±ca deÄŸiÅŸtirilebilir Ã¶zel Ã¶znitelikler, kullanÄ±labilir kimlik havuzu kimlik bilgileri, id belgelerindeki rol assumable roller vb. temelinde kullanÄ±cÄ± oluÅŸturmayÄ± (MFA desteÄŸi de dahil olmak Ã¼zere) ve ayrÄ±calÄ±k yÃ¼kseltmeyi otomatikleÅŸtirir.

ModÃ¼llerin iÅŸlevlerinin aÃ§Ä±klamasÄ± iÃ§in [blog yazÄ±sÄ±nÄ±n](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2) ikinci bÃ¶lÃ¼mÃ¼ne bakÄ±n. Kurulum talimatlarÄ± iÃ§in ana [Pacu](https://github.com/RhinoSecurityLabs/pacu) sayfasÄ±na bakÄ±n.

#### KullanÄ±m

Belirli bir kimlik havuzu ve kullanÄ±cÄ± havuzu istemcisi iÃ§in kullanÄ±cÄ± oluÅŸturma ve tÃ¼m ayrÄ±calÄ±k yÃ¼kseltme vektÃ¶rlerini denemek iÃ§in Ã¶rnek cognito\_\_attack kullanÄ±mÄ±:

```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```

Mevcut AWS hesabÄ±nda gÃ¶rÃ¼nen tÃ¼m kullanÄ±cÄ± havuzlarÄ±nÄ±, kullanÄ±cÄ± havuzu istemcilerini, kimlik havuzlarÄ±nÄ±, kullanÄ±cÄ±larÄ± vb. toplamak iÃ§in Ã¶rnek cognito\_\_enum kullanÄ±mÄ±:

```plaintext
cognito__enum
```

Bu komut, AWS hesabÄ±nda bulunan tÃ¼m kullanÄ±cÄ± havuzlarÄ±nÄ±, kullanÄ±cÄ± havuzu istemcilerini, kimlik havuzlarÄ±nÄ± ve kullanÄ±cÄ±larÄ± listeleyecektir.

```bash
Pacu (new:test) > run cognito__enum
```

* [Cognito Scanner](https://github.com/padok-team/cognito-scanner), Cognito Ã¼zerinde istenmeyen hesap oluÅŸturma ve hesap oracle gibi farklÄ± saldÄ±rÄ±larÄ± uygulayan bir Python tabanlÄ± bir CLI aracÄ±dÄ±r.

#### Kurulum

```bash
$ pip install cognito-scanner
```

#### KullanÄ±m

```plaintext
python3 cognito-user-pools.py -u <userpool-id> -r <region> -t <token>
```

#### AÃ§Ä±klama

Bu araÃ§, belirli bir AWS Cognito kullanÄ±cÄ± havuzunda kullanÄ±cÄ±larÄ± listelemek iÃ§in kullanÄ±lÄ±r. AracÄ±n Ã§alÄ±ÅŸmasÄ± iÃ§in, kullanÄ±cÄ± havuzu kimliÄŸi (`-u`), bÃ¶lge (`-r`) ve geÃ§erli bir eriÅŸim belirteci (`-t`) saÄŸlanmalÄ±dÄ±r.

#### Ã–rnekler

```plaintext
python3 cognito-user-pools.py -u us-west-2_abcd1234 -r us-west-2 -t eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

Bu Ã¶rnekte, `us-west-2` bÃ¶lgesindeki `us-west-2_abcd1234` kimlikli kullanÄ±cÄ± havuzundaki kullanÄ±cÄ±larÄ± listeleyecektir. EriÅŸim belirteci olarak `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c` kullanÄ±lacaktÄ±r.

```bash
$ cognito-scanner --help
```

Daha fazla bilgi iÃ§in https://github.com/padok-team/cognito-scanner adresini kontrol edin.

## KayÄ±t

KullanÄ±cÄ± HavuzlarÄ±, **varsayÄ±lan olarak** **yeni kullanÄ±cÄ±larÄ± kaydetmeye** izin verir.

```bash
aws cognito-idp sign-up --client-id <client-id> \
--username <username> --password <password> \
--region <region> --no-sign-request
```

#### EÄŸer herhangi biri kayÄ±t olabilirse

KullanÄ±cÄ± hakkÄ±nda daha fazla ayrÄ±ntÄ± saÄŸlamanÄ±z gerektiÄŸini belirten bir hata ile karÅŸÄ±laÅŸabilirsiniz:

```
An error occurred (InvalidParameterException) when calling the SignUp operation: Attributes did not conform to the schema: address: The attribute is required
```

AÅŸaÄŸÄ±daki gibi gerekli bilgileri bir JSON ile saÄŸlayabilirsiniz:

```json
--user-attributes '[{"Name": "email", "Value": "carlospolop@gmail.com"}, {"Name":"gender", "Value": "M"}, {"Name": "address", "Value": "street"}, {"Name": "custom:custom_name", "Value":"supername&\"*$"}]'
```

Bu iÅŸlevselliÄŸi aynÄ± zamanda **mevcut kullanÄ±cÄ±larÄ± sÄ±ralamak** iÃ§in de kullanabilirsiniz. Bu, kullanÄ±cÄ± adÄ±yla zaten mevcut olan bir kullanÄ±cÄ± olduÄŸunda alÄ±nan hata mesajÄ±dÄ±r:

```
An error occurred (UsernameExistsException) when calling the SignUp operation: User already exists
```

{% hint style="info" %}
Ã–nceki komutta **Ã¶zel Ã¶zniteliklerin "custom:" ile baÅŸladÄ±ÄŸÄ±na** dikkat edin.\
AyrÄ±ca, kayÄ±t olurken **kullanÄ±cÄ± iÃ§in yeni Ã¶zel Ã¶znitelikler oluÅŸturamazsÄ±nÄ±z**. YalnÄ±zca **varsayÄ±lan Ã¶zniteliklere** (zorunlu olmasalar bile) ve **belirtilen Ã¶zel Ã¶zniteliklere** deÄŸer verebilirsiniz.
{% endhint %}

Veya sadece bir istemci kimliÄŸinin var olup olmadÄ±ÄŸÄ±nÄ± test etmek iÃ§in. Ä°stemci kimliÄŸi mevcut deÄŸilse bu hata mesajÄ± alÄ±nÄ±r:

```
An error occurred (ResourceNotFoundException) when calling the SignUp operation: User pool client 3ig612gjm56p1ljls1prq2miut does not exist.
```

#### Sadece yÃ¶netici kullanÄ±cÄ±larÄ± kaydedebilirse

Bu hatayÄ± bulacaksÄ±nÄ±z ve kullanÄ±cÄ±larÄ± kaydetme veya sÄ±ralama yapamayacaksÄ±nÄ±z:

```
An error occurred (NotAuthorizedException) when calling the SignUp operation: SignUp is not permitted for this user pool
```

### KayÄ±t DoÄŸrulama

Cognito, yeni bir kullanÄ±cÄ±yÄ± **e-posta veya telefon numarasÄ±nÄ± doÄŸrulayarak doÄŸrulamanÄ±za izin verir**. Bu nedenle, genellikle bir kullanÄ±cÄ± oluÅŸtururken en azÄ±ndan kullanÄ±cÄ± adÄ± ve ÅŸifre ile birlikte **e-posta ve/veya telefon numarasÄ±** gereklidir. Sadece **kontrol ettiÄŸiniz birini** belirleyin, bÃ¶ylece yeni oluÅŸturulan kullanÄ±cÄ± **hesabÄ±nÄ±zÄ± doÄŸrulamak iÃ§in** kodu alÄ±rsÄ±nÄ±z:

```bash
aws cognito-idp confirm-sign-up --client-id <cliet_id> \
--username aasdasd2 --confirmation-code <conf_code> \
--no-sign-request --region us-east-1
```

{% hint style="warning" %}
GÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re aynÄ± e-posta ve telefon numarasÄ±nÄ± kullanabilirsiniz, ancak oluÅŸturulan kullanÄ±cÄ±yÄ± doÄŸrulamak iÃ§in Cognito aynÄ± bilgiyi kullanmanÄ±zÄ± engelleyecek ve hesabÄ± doÄŸrulamanÄ±za izin vermeyecektir.
{% endhint %}

### Yetki YÃ¼kseltme / Ã–znitelikleri GÃ¼ncelleme

VarsayÄ±lan olarak, bir kullanÄ±cÄ± **Ã¶znitelik deÄŸerini deÄŸiÅŸtirebilir**. Bunun iÃ§in ÅŸu ÅŸekilde bir ÅŸey yapabilir:

```bash
aws cognito-idp update-user-attributes \
--region us-east-1 --no-sign-request \
--user-attributes Name=address,Value=street \
--access-token <access token>
```

#### Ã–zel Ã¶znitelik ayrÄ±calÄ±ÄŸÄ± yÃ¼kseltme

{% hint style="danger" %}
VarsayÄ±lan olarak kendi Ã¶znitelik deÄŸerlerinizi deÄŸiÅŸtirebileceÄŸiniz iÃ§in, **isAdmin** gibi **Ã¶zel Ã¶znitelikler** bulabilirsiniz. Bu durumda, deÄŸeri kendiniz deÄŸiÅŸtirerek **ayrÄ±calÄ±klarÄ± yÃ¼kseltebilirsiniz**!
{% endhint %}

#### E-posta/kullanÄ±cÄ± adÄ± deÄŸiÅŸtirme ayrÄ±calÄ±ÄŸÄ± yÃ¼kseltme

Bu yÃ¶ntemi kullanarak bir kullanÄ±cÄ±nÄ±n e-posta ve telefon numarasÄ±nÄ± deÄŸiÅŸtirebilirsiniz, ancak hesap doÄŸrulanmÄ±ÅŸ kalsa bile bu Ã¶znitelikler **doÄŸrulanmamÄ±ÅŸ durumda** olacaktÄ±r (yeniden doÄŸrulamanÄ±z gerekmektedir).

{% hint style="warning" %}
E-posta veya telefon numarasÄ±yla giriÅŸ yapamayacaksÄ±nÄ±z, ancak kullanÄ±cÄ± adÄ±yla giriÅŸ yapabileceksiniz.\
E-posta deÄŸiÅŸtirildiyse ve doÄŸrulanmadÄ±ysa, ID Token iÃ§inde **`email`** **alanÄ±nda** gÃ¶rÃ¼necektir ve **`email_verified`** alanÄ± **false** olacaktÄ±r, ancak uygulama bunu kontrol etmiyorsa baÅŸka kullanÄ±cÄ±larÄ± taklit edebilirsiniz.

AyrÄ±ca, **`name`** alanÄ±na herhangi bir ÅŸey yazabilirsiniz, sadece **ad Ã¶zniteliÄŸini** deÄŸiÅŸtirerek. Bir uygulama, **`email`** (veya baÅŸka bir Ã¶znitelik) yerine bu alanÄ± kontrol ediyorsa, baÅŸka kullanÄ±cÄ±larÄ± taklit etme olasÄ±lÄ±ÄŸÄ±nÄ±z olabilir.
{% endhint %}

Neyse ki, e-postanÄ±zÄ± Ã¶rneÄŸin yeni bir e-posta adresine deÄŸiÅŸtirdiyseniz, o e-posta adresinde aldÄ±ÄŸÄ±nÄ±z kodu kullanarak e-postayÄ± **onaylayabilirsiniz**:

```bash
aws cognito-idp verify-user-attribute \
--access-token <access_token> \
--attribute-name email --code <code> \
--region <region> --no-sign-request
```

**`email`** yerine **`phone_number`** kullanarak **yeni bir telefon numarasÄ±** deÄŸiÅŸtirmek/doÄŸrulamak iÃ§in kullanÄ±lÄ±r.

{% hint style="info" %}
YÃ¶netici, **kullanÄ±cÄ±nÄ±n tercih ettiÄŸi bir kullanÄ±cÄ± adÄ±yla giriÅŸ yapma** seÃ§eneÄŸini etkinleÅŸtirebilir. Bu deÄŸeri **baÅŸka bir kullanÄ±cÄ±yÄ± taklit etmek iÃ§in kullanÄ±lan herhangi bir kullanÄ±cÄ± adÄ± veya tercih edilen kullanÄ±cÄ± adÄ±** olarak deÄŸiÅŸtiremezsiniz.
{% endhint %}

### Åifre Kurtarma/DeÄŸiÅŸtirme

Åifreyi sadece **kullanÄ±cÄ± adÄ±nÄ±** (veya e-postayÄ± veya telefonu) bilerek kurtarmak mÃ¼mkÃ¼ndÃ¼r ve bir kod oraya gÃ¶nderilecektir:

```bash
aws cognito-idp forgot-password \
--client-id <client_id> \
--username <username/email/phone> --region <region>
```

{% hint style="info" %}
Sunucunun yanÄ±tÄ± her zaman olumlu olacak, sanki kullanÄ±cÄ± adÄ± mevcutmuÅŸ gibi. Bu yÃ¶ntemi kullanarak kullanÄ±cÄ±larÄ± sÄ±ralayamazsÄ±nÄ±z.
{% endhint %}

Kod ile ÅŸifreyi deÄŸiÅŸtirebilirsiniz:

```bash
aws cognito-idp confirm-forgot-password \
--client-id <client_id> \
--username <username> \
--confirmation-code <conf_code> \
--password <pwd> --region <region>
```

Åifreyi deÄŸiÅŸtirmek iÃ§in **Ã¶nceki ÅŸifreyi bilmek** gerekmektedir:

```bash
aws cognito-idp change-password \
--previous-password <value> \
--proposed-password <value> \
--access-token <value>
```

## Kimlik DoÄŸrulama

Bir kullanÄ±cÄ± havuzu, **farklÄ± kimlik doÄŸrulama yÃ¶ntemlerini** destekler. EÄŸer bir **kullanÄ±cÄ± adÄ± ve ÅŸifre** varsa, giriÅŸ yapmak iÃ§in **farklÄ± yÃ¶ntemler** de desteklenir.\
AyrÄ±ca, bir kullanÄ±cÄ± Havuzunda kimlik doÄŸrulandÄ±ÄŸÄ±nda **3 tÃ¼r belirteÃ§ verilir**: **Kimlik Belirteci (ID Token)**, **EriÅŸim belirteci (Access Token)** ve **Yenileme belirteci (Refresh Token)**.

* [**Kimlik Belirteci (ID Token)**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-id-token.html): Kimlik doÄŸrulanmÄ±ÅŸ kullanÄ±cÄ±nÄ±n `ad`, `e-posta` ve `telefon numarasÄ±` gibi bilgileri iÃ§eren talepleri iÃ§erir. Kimlik belirteci ayrÄ±ca, kullanÄ±cÄ±larÄ± **kaynak sunucularÄ±nÄ±za veya sunucu uygulamalarÄ±nÄ±za kimlik doÄŸrulamak** iÃ§in de kullanÄ±labilir. Kimlik belirtecinin iÃ§indeki herhangi bir talebe gÃ¼venebilmeniz iÃ§in, dÄ±ÅŸ uygulamalarda kullanÄ±yorsanÄ±z kimlik belirtecinin **imzasÄ±nÄ± doÄŸrulamanÄ±z** gerekmektedir.
* Kimlik Belirteci, kullanÄ±cÄ±nÄ±n **Ã¶zellik deÄŸerlerini** iÃ§eren belirteÃ§tir, hatta Ã¶zel olanlarÄ± bile.
* [**EriÅŸim Belirteci (Access Token)**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html): Kimlik doÄŸrulanmÄ±ÅŸ kullanÄ±cÄ± hakkÄ±nda talepleri, kullanÄ±cÄ±nÄ±n **gruplarÄ±nÄ±n bir listesini ve kapsamlarÄ±n bir listesini** iÃ§erir. EriÅŸim belirtecinin amacÄ±, kullanÄ±cÄ± havuzundaki kullanÄ±cÄ±nÄ±n baÄŸlamÄ±nda API iÅŸlemlerini **yetkilendirmektir**. Ã–rneÄŸin, eriÅŸim belirteci kullanarak kullanÄ±cÄ±nÄ±n, kullanÄ±cÄ± Ã¶zelliklerini eklemesine, deÄŸiÅŸtirmesine veya silmesine **izin verebilirsiniz**.
* [**Yenileme Belirteci (Refresh Token)**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html): Yenileme belirteÃ§leriyle kullanÄ±cÄ± iÃ§in **yeni Kimlik Belirteci ve EriÅŸim Belirteci** alabilirsiniz, yenileme belirteci **geÃ§ersiz olana kadar**. VarsayÄ±lan olarak, yenileme belirteci, uygulama kullanÄ±cÄ±nÄ±zÄ±n kullanÄ±cÄ± havuzuna giriÅŸ yaptÄ±ktan **30 gÃ¼n sonra sÃ¼resi dolmaktadÄ±r**. KullanÄ±cÄ± havuzunuz iÃ§in bir uygulama oluÅŸturduÄŸunuzda, uygulamanÄ±n yenileme belirteci sÃ¼resini **60 dakika ile 10 yÄ±l arasÄ±nda herhangi bir deÄŸere** ayarlayabilirsiniz.

### ADMIN\_NO\_SRP\_AUTH & ADMIN\_USER\_PASSWORD\_AUTH

Bu, sunucu tarafÄ± kimlik doÄŸrulama akÄ±ÅŸÄ±dÄ±r:

* Sunucu tarafÄ±ndaki uygulama, **`AdminInitiateAuth` API iÅŸlemi**ni Ã§aÄŸÄ±rÄ±r (`InitiateAuth` yerine). Bu iÅŸlem, **`cognito-idp:AdminInitiateAuth`** ve **`cognito-idp:AdminRespondToAuthChallenge`** izinlerini iÃ§eren AWS kimlik bilgilerini gerektirir. Ä°ÅŸlem, gerekli kimlik doÄŸrulama parametrelerini dÃ¶ndÃ¼rÃ¼r.
* Sunucu tarafÄ±ndaki uygulama, **kimlik doÄŸrulama parametrelerine** sahip olduktan sonra **`AdminRespondToAuthChallenge` API iÅŸlemi**ni Ã§aÄŸÄ±rÄ±r. `AdminRespondToAuthChallenge` API iÅŸlemi, yalnÄ±zca AWS kimlik bilgilerini saÄŸladÄ±ÄŸÄ±nÄ±zda baÅŸarÄ±lÄ± olur.

Bu yÃ¶ntem, varsayÄ±lan olarak **etkin deÄŸildir**.

GiriÅŸ yapmak iÃ§in aÅŸaÄŸÄ±dakileri bilmelisiniz:

* kullanÄ±cÄ± havuzu kimlik bilgisi
* istemci kimliÄŸi
* kullanÄ±cÄ± adÄ±
* ÅŸifre
* istemci sÄ±rrÄ± (uygulama bir sÄ±r kullanacak ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸsa)

{% hint style="info" %}
Bu yÃ¶ntemle **giriÅŸ yapabilmek iÃ§in**, uygulamanÄ±n `ALLOW_ADMIN_USER_PASSWORD_AUTH` ile giriÅŸ yapmaya izin vermesi gerekmektedir.\
AyrÄ±ca, bu iÅŸlemi gerÃ§ekleÅŸtirmek iÃ§in **`cognito-idp:AdminInitiateAuth`** ve **`cognito-idp:AdminRespondToAuthChallenge`** izinlerine sahip kimlik bilgilerine ihtiyacÄ±nÄ±z vardÄ±r.
{% endhint %}

```python
aws cognito-idp admin-initiate-auth \
--client-id <client-id> \
--auth-flow ADMIN_USER_PASSWORD_AUTH \
--region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'
--user-pool-id "<pool-id>"

# Check the python code to learn how to generate the hsecret_hash
```

<details>

<summary>GiriÅŸ iÃ§in Kod</summary>

\`\`\`python import boto3 import botocore import hmac import hashlib import base64

client\_id = "" user\_pool\_id = "" client\_secret = "" username = "" password = ""

boto\_client = boto3.client('cognito-idp', region\_name='us-east-1')

def get\_secret\_hash(username, client\_id, client\_secret): key = bytes(client\_secret, 'utf-8') message = bytes(f'{username}{client\_id}', 'utf-8') return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

## If the Client App isn't configured to use a secret

### just delete the line setting the SECRET\_HASH

def login\_user(username\_or\_alias, password, client\_id, client\_secret, user\_pool\_id): try: return boto\_client.admin\_initiate\_auth( UserPoolId=user\_pool\_id, ClientId=client\_id, AuthFlow='ADMIN\_USER\_PASSWORD\_AUTH', AuthParameters={ 'USERNAME': username\_or\_alias, 'PASSWORD': password, 'SECRET\_HASH': get\_secret\_hash(username\_or\_alias, client\_id, client\_secret) } ) except botocore.exceptions.ClientError as e: return e.response

print(login\_user(username, password, client\_id, client\_secret, user\_pool\_id))

````
</details>

### USER\_PASSWORD\_AUTH

Bu yÃ¶ntem, baÅŸka bir basit ve geleneksel kullanÄ±cÄ± ve ÅŸifre doÄŸrulama akÄ±ÅŸÄ±dÄ±r. Geleneksel bir kimlik doÄŸrulama yÃ¶ntemini Cognito'ya taÅŸÄ±manÄ±z ve ardÄ±ndan bunu devre dÄ±ÅŸÄ± bÄ±rakmanÄ±z ve yerine ALLOW\_USER\_SRP\_AUTH yÃ¶ntemini kullanmanÄ±z Ã¶nerilir (Ã§Ã¼nkÃ¼ bu yÃ¶ntem ÅŸifreyi aÄŸ Ã¼zerinden gÃ¶ndermez). Bu yÃ¶ntem varsayÄ±lan olarak **etkin deÄŸildir**.

Kod iÃ§indeki Ã¶nceki kimlik doÄŸrulama yÃ¶ntemiyle ana fark, kullanÄ±cÄ± havuzu kimlik bilgisini bilmemeniz ve Cognito KullanÄ±cÄ± Havuzu iÃ§in ek izinlere ihtiyaÃ§ duymamanÄ±zdÄ±r.

GiriÅŸ yapmak iÃ§in bilmeniz gerekenler:

- istemci kimliÄŸi
- kullanÄ±cÄ± adÄ±
- ÅŸifre
- istemci sÄ±rrÄ± (uygulama bir sÄ±r kullanacak ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸsa)

<div data-gb-custom-block data-tag="hint" data-style='info'>

Bu yÃ¶ntemle giriÅŸ yapabilmek iÃ§in uygulamanÄ±n ALLOW\_USER\_PASSWORD\_AUTH ile giriÅŸ yapmaya izin vermesi gerekmektedir.

</div>

```python
aws cognito-idp initiate-auth  --client-id <client-id> \
--auth-flow USER_PASSWORD_AUTH --region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'

# Check the python code to learn how to generate the secret_hash
````

#### REFRESH\_TOKEN\_AUTH & REFRESH\_TOKEN

Bu yÃ¶ntem her zaman geÃ§erli olacak (devre dÄ±ÅŸÄ± bÄ±rakÄ±lamaz), ancak geÃ§erli bir yenileme belirteci (refresh token) olmasÄ± gerekmektedir.

```bash
aws cognito-idp initiate-auth \
--client-id 3ig6h5gjm56p1ljls1prq2miut \
--auth-flow REFRESH_TOKEN_AUTH \
--region us-east-1 \
--auth-parameters 'REFRESH_TOKEN=<token>'
```

</details>
