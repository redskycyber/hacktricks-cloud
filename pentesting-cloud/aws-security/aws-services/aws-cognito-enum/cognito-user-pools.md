# Cognito ì‚¬ìš©ì í’€

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

ì‚¬ìš©ì í’€ì€ Amazon Cognitoì˜ ì‚¬ìš©ì ë””ë ‰í„°ë¦¬ì…ë‹ˆë‹¤. ì‚¬ìš©ì í’€ì„ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ìëŠ” Amazon Cognitoë¥¼ í†µí•´ **ì›¹ ë˜ëŠ” ëª¨ë°”ì¼ ì•±ì— ë¡œê·¸ì¸**í•˜ê±°ë‚˜ **ì œ3ì** ì‹ ì› ì œê³µì(IdP)ë¥¼ í†µí•´ **í˜ë”ë ˆì´ì…˜**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì§ì ‘ ë¡œê·¸ì¸í•˜ë“  ì œ3ìë¥¼ í†µí•´ ë¡œê·¸ì¸í•˜ë“ , ì‚¬ìš©ì í’€ì˜ ëª¨ë“  êµ¬ì„±ì›ì€ SDKë¥¼ í†µí•´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ë””ë ‰í„°ë¦¬ í”„ë¡œí•„ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

ì‚¬ìš©ì í’€ì€ ë‹¤ìŒì„ ì œê³µí•©ë‹ˆë‹¤:

* ê°€ì… ë° ë¡œê·¸ì¸ ì„œë¹„ìŠ¤.
* ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ê¸° ìœ„í•œ ë‚´ì¥í˜•, ì‚¬ìš©ì ì§€ì • ê°€ëŠ¥í•œ ì›¹ UI.
* Facebook, Google, Amazon ë¡œê·¸ì¸ ë° Apple ë¡œê·¸ì¸ê³¼ SAML ë° OIDC ì‹ ì› ì œê³µìë¥¼ í†µí•œ ì†Œì…œ ë¡œê·¸ì¸, ì‚¬ìš©ì í’€ì—ì„œ ì‚¬ìš©ì ë””ë ‰í„°ë¦¬ ê´€ë¦¬ ë° ì‚¬ìš©ì í”„ë¡œí•„.
* ë‹¤ì¤‘ ìš”ì†Œ ì¸ì¦(MFA), ìœ ì¶œëœ ìê²© ì¦ëª… í™•ì¸, ê³„ì • íƒˆì·¨ ë°©ì§€, ì „í™” ë° ì´ë©”ì¼ í™•ì¸ê³¼ ê°™ì€ ë³´ì•ˆ ê¸°ëŠ¥.
* AWS Lambda íŠ¸ë¦¬ê±°ë¥¼ í†µí•œ ì‚¬ìš©ì ì •ì˜ ì›Œí¬í”Œë¡œ ë° ì‚¬ìš©ì ë§ˆì´ê·¸ë ˆì´ì…˜.

ì¼ë°˜ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **ì†ŒìŠ¤ ì½”ë“œ**ì—ëŠ” ì‚¬ìš©ìê°€ Cognito ì‚¬ìš©ì í’€ì— ë¡œê·¸ì¸í•˜ê¸° ìœ„í•´ í•„ìš”í•œ **ì‚¬ìš©ì í’€ ID**ì™€ **í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ID** (ê·¸ë¦¬ê³  ë•Œë¡œëŠ” **ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹„ë°€**?)ë„ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### ê°€ëŠ¥í•œ ê³µê²©

* **ë“±ë¡**: ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ìëŠ” ìì²´ì ìœ¼ë¡œ ë“±ë¡í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìì‹ ì„ ìœ„í•´ ì‚¬ìš©ìë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ì‚¬ìš©ì ì—´ê±°**: ë“±ë¡ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ì ì´ë¦„ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ë¸Œë£¨íŠ¸ í¬ìŠ¤ ê³µê²©ì— ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ë¡œê·¸ì¸ ë¸Œë£¨íŠ¸ í¬ìŠ¤**: [**ì¸ì¦**](cognito-user-pools.md#authentication) ì„¹ì…˜ì—ëŠ” ì‚¬ìš©ìê°€ **ë¡œê·¸ì¸**í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” **ë©”ì„œë“œ**ê°€ ëª¨ë‘ ë‚˜ì™€ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ë¸Œë£¨íŠ¸ í¬ìŠ¤í•˜ì—¬ **ìœ íš¨í•œ ìê²© ì¦ëª…**ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### íœí…ŒìŠ¤íŒ… ë„êµ¬

* [Pacu](https://github.com/RhinoSecurityLabs/pacu), AWS ê³µê²© í”„ë ˆì„ì›Œí¬ì—ëŠ” ì´ì œ ê³„ì •ì˜ ëª¨ë“  Cognito ìì‚°ì„ ì—´ê±°í•˜ê³  ì•½í•œ êµ¬ì„±, ì•¡ì„¸ìŠ¤ ì œì–´ì— ì‚¬ìš©ë˜ëŠ” ì‚¬ìš©ì ì†ì„± ë“±ì„ ìë™ìœ¼ë¡œ í™•ì¸í•˜ëŠ” "cognito\_\_enum" ë° "cognito\_\_attack" ëª¨ë“ˆì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ìˆ˜ì • ê°€ëŠ¥í•œ ì‚¬ìš©ì ì •ì˜ ì†ì„±, ì‚¬ìš© ê°€ëŠ¥í•œ ì‹ ì› í’€ ìê²© ì¦ëª…, id í† í°ì˜ ê°€ì • ê°€ëŠ¥í•œ ì—­í•  ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ì ìƒì„±(ë‹¤ì¤‘ ìš”ì†Œ ì¸ì¦ ì§€ì› í¬í•¨) ë° ê¶Œí•œ ìƒìŠ¹ë„ ìë™í™”í•©ë‹ˆë‹¤.

ëª¨ë“ˆ ê¸°ëŠ¥ì— ëŒ€í•œ ì„¤ëª…ì€ [ë¸”ë¡œê·¸ ê²Œì‹œë¬¼](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2)ì˜ 2ë¶€ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”. ì„¤ì¹˜ ì§€ì¹¨ì€ ì£¼ìš” [Pacu](https://github.com/RhinoSecurityLabs/pacu) í˜ì´ì§€ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

#### ì‚¬ìš©ë²•

ì£¼ì–´ì§„ ì‹ ì› í’€ê³¼ ì‚¬ìš©ì í’€ í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•´ ì‚¬ìš©ì ìƒì„± ë° ëª¨ë“  ê¶Œí•œ ìƒìŠ¹ ë²¡í„°ë¥¼ ì‹œë„í•˜ëŠ” ìƒ˜í”Œ cognito\_\_attack ì‚¬ìš©ë²•:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
í˜„ì¬ AWS ê³„ì •ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ì í’€, ì‚¬ìš©ì í’€ í´ë¼ì´ì–¸íŠ¸, ì‹ ì› í’€, ì‚¬ìš©ì ë“±ì„ ìˆ˜ì§‘í•˜ê¸° ìœ„í•œ cognito\_\_enum ì‚¬ìš© ì˜ˆì‹œì…ë‹ˆë‹¤.
```bash
Pacu (new:test) > run cognito__enum
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner)ì€ Cognitoì— ëŒ€í•œ ë‹¤ì–‘í•œ ê³µê²©ì„ êµ¬í˜„í•˜ëŠ” íŒŒì´ì¬ CLI ë„êµ¬ì…ë‹ˆë‹¤. ì´ ë„êµ¬ëŠ” ì›ì¹˜ ì•ŠëŠ” ê³„ì • ìƒì„± ë° ê³„ì • ì˜¤ë¼í´ê³¼ ê°™ì€ ê³µê²©ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

#### ì„¤ì¹˜
```bash
$ pip install cognito-scanner
```
#### ì‚¬ìš©ë²•

```plaintext
cognito-user-pools.py [-h] [--region REGION] [--userpool USERPOOL]
                      [--username USERNAME] [--email EMAIL]
                      [--phone PHONE] [--output OUTPUT]

optional arguments:
  -h, --help           show this help message and exit
  --region REGION      AWS region where the user pool is located
  --userpool USERPOOL  User pool ID
  --username USERNAME  Username to search for
  --email EMAIL        Email to search for
  --phone PHONE        Phone number to search for
  --output OUTPUT      Output file to save the results
```

#### ì‚¬ìš©ë²•

```plaintext
cognito-user-pools.py [-h] [--region REGION] [--userpool USERPOOL]
                      [--username USERNAME] [--email EMAIL]
                      [--phone PHONE] [--output OUTPUT]

ì„ íƒì  ì¸ìˆ˜:
  -h, --help           ë„ì›€ë§ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê³  ì¢…ë£Œí•©ë‹ˆë‹¤.
  --region REGION      ì‚¬ìš©ì í’€ì´ ìœ„ì¹˜í•œ AWS ì§€ì—­
  --userpool USERPOOL  ì‚¬ìš©ì í’€ ID
  --username USERNAME  ê²€ìƒ‰í•  ì‚¬ìš©ì ì´ë¦„
  --email EMAIL        ê²€ìƒ‰í•  ì´ë©”ì¼
  --phone PHONE        ê²€ìƒ‰í•  ì „í™”ë²ˆí˜¸
  --output OUTPUT      ê²°ê³¼ë¥¼ ì €ì¥í•  ì¶œë ¥ íŒŒì¼
```
```bash
$ cognito-scanner --help
```
ìì„¸í•œ ì •ë³´ëŠ” https://github.com/padok-team/cognito-scannerë¥¼ í™•ì¸í•˜ì„¸ìš”.

## ë“±ë¡

ì‚¬ìš©ì í’€ì€ **ê¸°ë³¸ì ìœ¼ë¡œ** **ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ë“±ë¡**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
aws cognito-idp sign-up --client-id <client-id> \
--username <username> --password <password> \
--region <region> --no-sign-request
```
#### ëˆ„êµ¬ë‚˜ ë“±ë¡í•  ìˆ˜ ìˆëŠ” ê²½ìš°

ì‚¬ìš©ìì— ëŒ€í•œ **ì¶”ê°€ ì„¸ë¶€ ì •ë³´**ë¥¼ ì œê³µí•´ì•¼ í•œë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
An error occurred (InvalidParameterException) when calling the SignUp operation: Attributes did not conform to the schema: address: The attribute is required
```
ë‹¤ìŒê³¼ ê°™ì´ JSONì„ ì‚¬ìš©í•˜ì—¬ í•„ìš”í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```json
{
  "username": "ì‚¬ìš©ì ì´ë¦„",
  "password": "ë¹„ë°€ë²ˆí˜¸",
  "email": "ì´ë©”ì¼ ì£¼ì†Œ",
  "phone_number": "ì „í™”ë²ˆí˜¸",
  "attributes": {
    "custom:attribute1": "ì†ì„± 1 ê°’",
    "custom:attribute2": "ì†ì„± 2 ê°’"
  }
}
```

ìœ„ì˜ ì˜ˆì‹œì—ì„œ "username"ì€ ì‚¬ìš©ì ì´ë¦„, "password"ëŠ” ë¹„ë°€ë²ˆí˜¸, "email"ì€ ì´ë©”ì¼ ì£¼ì†Œ, "phone_number"ëŠ” ì „í™”ë²ˆí˜¸ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. "attributes"ëŠ” ì‚¬ìš©ì ì§€ì • ì†ì„±ì„ í¬í•¨í•˜ë©°, "custom:attribute1"ê³¼ "custom:attribute2"ëŠ” ê°ê° ì†ì„± 1 ê°’ê³¼ ì†ì„± 2 ê°’ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
```json
--user-attributes '[{"Name": "email", "Value": "carlospolop@gmail.com"}, {"Name":"gender", "Value": "M"}, {"Name": "address", "Value": "street"}, {"Name": "custom:custom_name", "Value":"supername&\"*$"}]'
```
ë‹¤ìŒ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ê¸°ì¡´ ì‚¬ìš©ìë¥¼ **ì—´ê±°í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.** í•´ë‹¹ ì´ë¦„ìœ¼ë¡œ ì´ë¯¸ ì‚¬ìš©ìê°€ ì¡´ì¬í•  ê²½ìš°ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤:
```
An error occurred (UsernameExistsException) when calling the SignUp operation: User already exists
```
{% hint style="info" %}
ì´ì „ ëª…ë ¹ì—ì„œ **ì‚¬ìš©ì ì •ì˜ ì†ì„±ì€ "custom:"ìœ¼ë¡œ ì‹œì‘**í•¨ì„ ì£¼ëª©í•˜ì„¸ìš”.\
ë˜í•œ, ë“±ë¡í•  ë•Œ **ì‚¬ìš©ìì—ê²Œ ìƒˆë¡œìš´ ì‚¬ìš©ì ì •ì˜ ì†ì„±ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**. ê¸°ë³¸ ì†ì„±ì—ë§Œ ê°’ì„ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©° (í•„ìˆ˜ê°€ ì•„ë‹ˆë”ë¼ë„) **ì§€ì •ëœ ì‚¬ìš©ì ì •ì˜ ì†ì„±**ì—ë§Œ ê°’ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ IDê°€ ì¡´ì¬í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ IDê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```
An error occurred (ResourceNotFoundException) when calling the SignUp operation: User pool client 3ig612gjm56p1ljls1prq2miut does not exist.
```
#### ê´€ë¦¬ìë§Œ ì‚¬ìš©ìë¥¼ ë“±ë¡í•  ìˆ˜ ìˆëŠ” ê²½ìš°

ì´ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•˜ë©´ ì‚¬ìš©ìë¥¼ ë“±ë¡í•˜ê±°ë‚˜ ì—´ëŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:
```
An error occurred (NotAuthorizedException) when calling the SignUp operation: SignUp is not permitted for this user pool
```
### ë“±ë¡ í™•ì¸

CognitoëŠ” ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ë“±ë¡í•  ë•Œ **ì´ë©”ì¼ ë˜ëŠ” ì „í™”ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì—¬ ì‚¬ìš©ìë¥¼ ì¸ì¦**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ìë¥¼ ìƒì„±í•  ë•Œ ì¼ë°˜ì ìœ¼ë¡œ **ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸**ì™€ í•¨ê»˜ **ì´ë©”ì¼ê³¼/ë˜ëŠ” ì „í™”ë²ˆí˜¸**ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤. **ì œì–´í•  ìˆ˜ ìˆëŠ”** í•˜ë‚˜ë¥¼ ì„¤ì •í•˜ì—¬ ìƒˆë¡œ ìƒì„±ëœ ì‚¬ìš©ì **ê³„ì •**ì˜ í™•ì¸ ì½”ë“œë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```bash
aws cognito-idp confirm-sign-up --client-id <cliet_id> \
--username aasdasd2 --confirmation-code <conf_code> \
--no-sign-request --region us-east-1
```
{% hint style="warning" %}
ë¹„ë¡ **ê°™ì€ ì´ë©”ì¼**ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, ìƒì„±ëœ ì‚¬ìš©ìë¥¼ í™•ì¸í•´ì•¼ í•  ë•Œ CognitoëŠ” ë™ì¼í•œ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì— ëŒ€í•´ ë¶ˆí‰í•˜ê³  **ê³„ì •ì„ í™•ì¸í•  ìˆ˜ ì—†ê²Œ** í•©ë‹ˆë‹¤.
{% endhint %}

### ê¶Œí•œ ìƒìŠ¹ / ì†ì„± ì—…ë°ì´íŠ¸

ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ìëŠ” ë‹¤ìŒê³¼ ê°™ì´ ìì‹ ì˜ ì†ì„± ê°’ì„ **ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:
```bash
aws cognito-idp update-user-attributes \
--region us-east-1 --no-sign-request \
--user-attributes Name=address,Value=street \
--access-token <access token>
```
#### ì‚¬ìš©ì ì •ì˜ ì†ì„± ê¶Œí•œ ìƒìŠ¹

{% hint style="danger" %}
ê¸°ë³¸ì ìœ¼ë¡œ `isAdmin`ê³¼ ê°™ì€ **ì‚¬ìš©ì ì •ì˜ ì†ì„±**ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì‹ ì˜ ì†ì„± ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ê°’ì„ ë³€ê²½í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹ì„ í•  ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤!
{% endhint %}

#### ì´ë©”ì¼/ì‚¬ìš©ì ì´ë¦„ ìˆ˜ì • ê¶Œí•œ ìƒìŠ¹

ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ **ì´ë©”ì¼ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ìˆ˜ì •**í•  ìˆ˜ ìˆì§€ë§Œ, ê³„ì •ì´ í™•ì¸ëœ ìƒíƒœë¡œ ìœ ì§€ë˜ë”ë¼ë„ í•´ë‹¹ ì†ì„±ì€ **í™•ì¸ë˜ì§€ ì•Šì€ ìƒíƒœë¡œ ì„¤ì •**ë©ë‹ˆë‹¤ (ë‹¤ì‹œ í™•ì¸í•´ì•¼ í•¨).

{% hint style="warning" %}
ì´ë©”ì¼ì´ë‚˜ ì „í™”ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ì§€ë§Œ, **ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.\
ì´ë©”ì¼ì´ ìˆ˜ì •ë˜ì—ˆê³  í™•ì¸ë˜ì§€ ì•Šì•˜ë”ë¼ë„ ID í† í° ë‚´ì˜ **`email`** **í•„ë“œ**ì— í‘œì‹œë˜ë©°, **`email_verified`** í•„ë“œëŠ” **false**ê°€ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì•±ì´ ì´ë¥¼ í™•ì¸í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ, **`name`** í•„ë“œì—ëŠ” **ì´ë¦„ ì†ì„±**ì„ ìˆ˜ì •í•˜ì—¬ ì•„ë¬´ ë‚´ìš©ì´ë‚˜ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•±ì´ **`email`** (ë˜ëŠ” ë‹¤ë¥¸ ì†ì„±) ëŒ€ì‹ ì— **í•´ë‹¹** í•„ë“œë¥¼ í™•ì¸í•˜ëŠ” ê²½ìš° ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ê°€ì¥í•  ìˆ˜ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

ì–´ì¨Œë“ , ì´ë©”ì¼ì„ ìƒˆë¡œìš´ ì´ë©”ì¼ë¡œ ë³€ê²½í•œ ê²½ìš°, í•´ë‹¹ ì´ë©”ì¼ ì£¼ì†Œë¡œ ë°›ì€ ì½”ë“œë¡œ ì´ë©”ì¼ì„ **í™•ì¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
aws cognito-idp verify-user-attribute \
--access-token <access_token> \
--attribute-name email --code <code> \
--region <region> --no-sign-request
```
**`ì´ë©”ì¼`** ëŒ€ì‹  **`ì „í™”ë²ˆí˜¸`**ë¥¼ ì‚¬ìš©í•˜ì—¬ **ìƒˆ ì „í™”ë²ˆí˜¸**ë¥¼ ë³€ê²½/í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="info" %}
ê´€ë¦¬ìëŠ” **ì‚¬ìš©ìê°€ ì„ í˜¸í•˜ëŠ” ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸**í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ì„ í™œì„±í™”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•´ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ **ì•„ë¬´ ì‚¬ìš©ì ì´ë¦„ì´ë‚˜ ì„ í˜¸_ì‚¬ìš©ì_ì´ë¦„**ìœ¼ë¡œ ì´ ê°’ì„ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
{% endhint %}

### ë¹„ë°€ë²ˆí˜¸ ë³µêµ¬/ë³€ê²½

ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³µêµ¬í•˜ëŠ” ê²ƒì€ **ì‚¬ìš©ì ì´ë¦„** (ë˜ëŠ” ì´ë©”ì¼ ë˜ëŠ” ì „í™”ë²ˆí˜¸)ì„ ì•Œê³  ìˆê³  í•´ë‹¹ ì‚¬ìš©ìì—ê²Œ ì½”ë“œê°€ ì „ì†¡ë  ìˆ˜ ìˆëŠ” ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
```bash
aws cognito-idp forgot-password \
--client-id <client_id> \
--username <username/email/phone> --region <region>
```
{% hint style="info" %}
ì„œë²„ì˜ ì‘ë‹µì€ í•­ìƒ ê¸ì •ì ì¼ ê²ƒì´ë©°, ë§ˆì¹˜ ì‚¬ìš©ì ì´ë¦„ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì¼ ê²ƒì…ë‹ˆë‹¤. ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë¥¼ ì—´ê±°í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.
{% endhint %}

ë‹¤ìŒ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
aws cognito-idp confirm-forgot-password \
--client-id <client_id> \
--username <username> \
--confirmation-code <conf_code> \
--password <pwd> --region <region>
```
ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ë ¤ë©´ **ì´ì „ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤**:
```bash
aws cognito-idp change-password \
--previous-password <value> \
--proposed-password <value> \
--access-token <value>
```
## ì¸ì¦

ì‚¬ìš©ì í’€ì€ **ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ì¸ì¦**ì„ ì§€ì›í•©ë‹ˆë‹¤. ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ê°€ ìˆëŠ” ê²½ìš° ë¡œê·¸ì¸í•˜ê¸° ìœ„í•´ë„ **ë‹¤ì–‘í•œ ë°©ë²•**ì´ ì§€ì›ë©ë‹ˆë‹¤. 
ë˜í•œ, ì‚¬ìš©ì í’€ì—ì„œ ì‚¬ìš©ìê°€ ì¸ì¦ë˜ë©´ **3 ì¢…ë¥˜ì˜ í† í°**ì´ ì œê³µë©ë‹ˆë‹¤: **ID í† í°**, **ì•¡ì„¸ìŠ¤ í† í°** ë° **ë¦¬í”„ë ˆì‹œ í† í°**.

* [**ID í† í°**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-id-token.html): ì¸ì¦ëœ ì‚¬ìš©ìì˜ **ì‹ë³„ ì •ë³´**ì— ëŒ€í•œ í´ë ˆì„ì„ í¬í•¨í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `name`, `email`, `phone_number`ì™€ ê°™ì€ ì •ë³´ê°€ ìˆìŠµë‹ˆë‹¤. ID í† í°ì€ ë˜í•œ **ë¦¬ì†ŒìŠ¤ ì„œë²„ ë˜ëŠ” ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì‚¬ìš©ìë¥¼ ì¸ì¦í•˜ëŠ” ë° ì‚¬ìš©**ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™¸ë¶€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•  ê²½ìš° ID í† í° ë‚´ì˜ ì–´ë–¤ í´ë ˆì„ë„ ì‹ ë¢°í•˜ê¸° ì „ì— ID í† í°ì˜ **ì„œëª…ì„ ê²€ì¦**í•´ì•¼ í•©ë‹ˆë‹¤.
* ID í† í°ì€ ì‚¬ìš©ìì˜ ì†ì„± ê°’, ì‹¬ì§€ì–´ ì‚¬ìš©ì ì •ì˜ ì†ì„±ê¹Œì§€ í¬í•¨í•˜ëŠ” í† í°ì…ë‹ˆë‹¤.
* [**ì•¡ì„¸ìŠ¤ í† í°**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html): ì¸ì¦ëœ ì‚¬ìš©ìì— ëŒ€í•œ í´ë ˆì„, ì‚¬ìš©ìì˜ ê·¸ë£¹ ëª©ë¡ ë° ìŠ¤ì½”í”„ ëª©ë¡ì„ í¬í•¨í•©ë‹ˆë‹¤. ì•¡ì„¸ìŠ¤ í† í°ì˜ ëª©ì ì€ ì‚¬ìš©ì í’€ì˜ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ì—ì„œ API ì‘ì—…ì„ **ì¸ê°€**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì•¡ì„¸ìŠ¤ í† í°ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì‚¬ìš©ì ì†ì„±ì„ ì¶”ê°€, ë³€ê²½ ë˜ëŠ” ì‚­ì œí•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* [**ë¦¬í”„ë ˆì‹œ í† í°**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html): ë¦¬í”„ë ˆì‹œ í† í°ì„ ì‚¬ìš©í•˜ë©´ **ë¦¬í”„ë ˆì‹œ í† í°ì´ ë§Œë£Œë  ë•Œê¹Œì§€** ì‚¬ìš©ìë¥¼ ìœ„í•´ ìƒˆë¡œìš´ ID í† í° ë° ì•¡ì„¸ìŠ¤ í† í°ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ, ë¦¬í”„ë ˆì‹œ í† í°ì€ ì‚¬ìš©ì í’€ì— ë¡œê·¸ì¸í•œ í›„ 30ì¼ í›„ì— ë§Œë£Œë©ë‹ˆë‹¤. ì‚¬ìš©ì í’€ì— ëŒ€í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•  ë•Œ ë¦¬í”„ë ˆì‹œ í† í° ë§Œë£Œ ì‹œê°„ì„ **60ë¶„ì—ì„œ 10ë…„ ì‚¬ì´ì˜ ê°’ìœ¼ë¡œ ì„¤ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ADMIN\_NO\_SRP\_AUTH & ADMIN\_USER\_PASSWORD\_AUTH

ì´ê²ƒì€ ì„œë²„ ì¸¡ ì¸ì¦ í”Œë¡œìš°ì…ë‹ˆë‹¤:

* ì„œë²„ ì¸¡ ì•±ì€ **`AdminInitiateAuth` API ì‘ì—…**ì„ í˜¸ì¶œí•©ë‹ˆë‹¤(`InitiateAuth` ëŒ€ì‹ ). ì´ ì‘ì—…ì€ **`cognito-idp:AdminInitiateAuth`** ë° **`cognito-idp:AdminRespondToAuthChallenge`** ê¶Œí•œì„ í¬í•¨í•œ AWS ìê²© ì¦ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ í•„ìš”í•œ ì¸ì¦ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
* ì„œë²„ ì¸¡ ì•±ì´ **ì¸ì¦ ë§¤ê°œë³€ìˆ˜**ë¥¼ ê°€ì§€ê³  ìˆëŠ” í›„, **`AdminRespondToAuthChallenge` API ì‘ì—…**ì„ í˜¸ì¶œí•©ë‹ˆë‹¤. `AdminRespondToAuthChallenge` API ì‘ì—…ì€ AWS ìê²© ì¦ëª…ì„ ì œê³µí•  ë•Œë§Œ ì„±ê³µí•©ë‹ˆë‹¤.

ì´ **ë©”ì†Œë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤**.

ë¡œê·¸ì¸í•˜ê¸° ìœ„í•´ ë‹¤ìŒì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤:

* ì‚¬ìš©ì í’€ ID
* í´ë¼ì´ì–¸íŠ¸ ID
* ì‚¬ìš©ì ì´ë¦„
* ë¹„ë°€ë²ˆí˜¸
* í´ë¼ì´ì–¸íŠ¸ ì‹œí¬ë¦¿ (ì•±ì´ ì‹œí¬ë¦¿ì„ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±ëœ ê²½ìš°ì—ë§Œ í•„ìš”)

{% hint style="info" %}
ì´ ë°©ë²•ìœ¼ë¡œ **ë¡œê·¸ì¸í•  ìˆ˜ ìˆë„ë¡** ì• í”Œë¦¬ì¼€ì´ì…˜ì€ `ALLOW_ADMIN_USER_PASSWORD_AUTH`ë¡œ ë¡œê·¸ì¸ì„ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤. 
ë˜í•œ, ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë ¤ë©´ **`cognito-idp:AdminInitiateAuth`** ë° **`cognito-idp:AdminRespondToAuthChallenge`** ê¶Œí•œì´ ìˆëŠ” ìê²© ì¦ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.
{% endhint %}
```python
aws cognito-idp admin-initiate-auth \
--client-id <client-id> \
--auth-flow ADMIN_USER_PASSWORD_AUTH \
--region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'
--user-pool-id "<pool-id>"

# Check the python code to learn how to generate the hsecret_hash
```
<details>

<summary>ë¡œê·¸ì¸ì„ ìœ„í•œ ì½”ë“œ</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.admin_initiate_auth(
UserPoolId=user_pool_id,
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_PASSWORD\_AUTH

ì´ ë°©ë²•ì€ ë˜ ë‹¤ë¥¸ ê°„ë‹¨í•˜ê³  ì „í†µì ì¸ ì‚¬ìš©ì ë° ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ íë¦„ì…ë‹ˆë‹¤. ì „í†µì ì¸ ì¸ì¦ ë°©ë²•ì„ Cognitoë¡œ ì´ì „í•˜ê³ , ê·¸ëŸ° ë‹¤ìŒ ALLOW\_USER\_SRP\_AUTH ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ë¹„í™œì„±í™”í•˜ê³  ëŒ€ì‹  ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤(ì´ ë°©ë²•ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì „ì†¡í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤).\
ì´ ë°©ë²•ì€ ê¸°ë³¸ì ìœ¼ë¡œ **í™œì„±í™”ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤**.

ì½”ë“œ ë‚´ì—ì„œ ì´ì „ ì¸ì¦ ë°©ë²•ê³¼ì˜ ì£¼ìš” ì°¨ì´ì ì€ ì‚¬ìš©ì í’€ IDë¥¼ ì•Œ í•„ìš”ê°€ ì—†ìœ¼ë©°, Cognito ì‚¬ìš©ì í’€ì— ì¶”ê°€ ê¶Œí•œì´ í•„ìš”í•˜ì§€ ì•Šë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

ë¡œê·¸ì¸í•˜ë ¤ë©´ ë‹¤ìŒì„ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤:

* í´ë¼ì´ì–¸íŠ¸ ID
* ì‚¬ìš©ì ì´ë¦„
* ë¹„ë°€ë²ˆí˜¸
* í´ë¼ì´ì–¸íŠ¸ ì‹œí¬ë¦¿ (ì•±ì´ ì‹œí¬ë¦¿ì„ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±ëœ ê²½ìš°ì—ë§Œ í•„ìš”)

{% hint style="info" %}
ì´ ë°©ë²•ìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆë„ë¡ í•˜ë ¤ë©´ í•´ë‹¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ALLOW\_USER\_PASSWORD\_AUTHë¡œ ë¡œê·¸ì¸ì„ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤.
{% endhint %}
```python
aws cognito-idp initiate-auth  --client-id <client-id> \
--auth-flow USER_PASSWORD_AUTH --region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'

# Check the python code to learn how to generate the secret_hash
```
<details>

<summary>ë¡œê·¸ì¸ì„ ìœ„í•œ Python ì½”ë“œ</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_SRP\_AUTH

ì´ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì´ì „ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ **ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ë³´ë‚´ëŠ” ëŒ€ì‹ ** **ë„ì „ ì¸ì¦ì´ ìˆ˜í–‰**ë©ë‹ˆë‹¤ (ë”°ë¼ì„œ ì•”í˜¸ëŠ” ì•”í˜¸í™”ë˜ì–´ ìˆì–´ë„ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤).\
ì´ **ë°©ë²•ì€ ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”**ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

**ë¡œê·¸ì¸**ì„ ìœ„í•´ ì•Œì•„ì•¼ í•  ì‚¬í•­:

* ì‚¬ìš©ì í’€ ID
* í´ë¼ì´ì–¸íŠ¸ ID
* ì‚¬ìš©ì ì´ë¦„
* ë¹„ë°€ë²ˆí˜¸
* í´ë¼ì´ì–¸íŠ¸ ì‹œí¬ë¦¿ (ì•±ì´ ì‹œí¬ë¦¿ì„ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±ëœ ê²½ìš°ì—ë§Œ í•„ìš”)

<details>

<summary>ë¡œê·¸ì¸ì„ ìœ„í•œ ì½”ë“œ</summary>
```python
from warrant.aws_srp import AWSSRP
import os

USERNAME='xxx'
PASSWORD='yyy'
POOL_ID='us-east-1_zzzzz'
CLIENT_ID = '12xxxxxxxxxxxxxxxxxxxxxxx'
CLIENT_SECRET = 'secreeeeet'
os.environ["AWS_DEFAULT_REGION"] = "<region>"

aws = AWSSRP(username=USERNAME, password=PASSWORD, pool_id=POOL_ID,
client_id=CLIENT_ID, client_secret=CLIENT_SECRET)
tokens = aws.authenticate_user()
id_token = tokens['AuthenticationResult']['IdToken']
refresh_token = tokens['AuthenticationResult']['RefreshToken']
access_token = tokens['AuthenticationResult']['AccessToken']
token_type = tokens['AuthenticationResult']['TokenType']
```
</details>

### REFRESH\_TOKEN\_AUTH & REFRESH\_TOKEN

ì´ **ë©”ì†Œë“œëŠ” í•­ìƒ ìœ íš¨**í•©ë‹ˆë‹¤(ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ìŒ) ê·¸ëŸ¬ë‚˜ ìœ íš¨í•œ ë¦¬í”„ë ˆì‹œ í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤.
```bash
aws cognito-idp initiate-auth \
--client-id 3ig6h5gjm56p1ljls1prq2miut \
--auth-flow REFRESH_TOKEN_AUTH \
--region us-east-1 \
--auth-parameters 'REFRESH_TOKEN=<token>'
```
<details>

<summary>ì½”ë“œë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” ë°©ë²•</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64

client_id = "<client-id>"
token = '<token>'

boto_client = boto3.client('cognito-idp', region_name='<region>')

def refresh(client_id, refresh_token):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='REFRESH_TOKEN_AUTH',
AuthParameters={
'REFRESH_TOKEN': refresh_token
}
)
except botocore.exceptions.ClientError as e:
return e.response


print(refresh(client_id, token))
```
</details>

### CUSTOM\_AUTH

ì´ ê²½ìš° **ì¸ì¦**ì€ **ëŒë‹¤ í•¨ìˆ˜ ì‹¤í–‰**ì„ í†µí•´ ìˆ˜í–‰ë©ë‹ˆë‹¤.

## ì¶”ê°€ ë³´ì•ˆ

### ê³ ê¸‰ ë³´ì•ˆ

ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ ìˆì§€ë§Œ, í™œì„±í™”ë˜ë©´ CognitoëŠ” **ê³„ì • íƒˆì·¨ë¥¼ ê°ì§€**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í™•ë¥ ì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ **ë™ì¼í•œ ë„ì‹œ ë‚´ì˜ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë™ì¼í•œ ì‚¬ìš©ì ì—ì´ì „íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸**í•´ì•¼ í•©ë‹ˆë‹¤(ê·¸ë¦¬ê³  ê°€ëŠ¥í•˜ë‹¤ë©´ ë™ì¼í•œ IPë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤).

### MFA ê¸°ê¸° ê¸°ì–µ

ì‚¬ìš©ìê°€ ë™ì¼í•œ ê¸°ê¸°ì—ì„œ ë¡œê·¸ì¸í•˜ëŠ” ê²½ìš°, MFAê°€ ìš°íšŒë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ MFA ë³´í˜¸ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ë™ì¼í•œ ë¸Œë¼ìš°ì €ì—ì„œ ë™ì¼í•œ ë©”íƒ€ë°ì´í„°(IP?)ë¡œ ë¡œê·¸ì¸ì„ ì‹œë„í•´ì•¼ í•©ë‹ˆë‹¤.

## ì‚¬ìš©ì í’€ ê·¸ë£¹ IAM ì—­í• 

**ì‚¬ìš©ìë¥¼ ì‚¬ìš©ì í’€ ê·¸ë£¹ì— ì¶”ê°€**í•  ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ê·¸ë£¹ì€ í•˜ë‚˜ì˜ **IAM ì—­í• **ê³¼ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤. ë˜í•œ **ì‚¬ìš©ì**ëŠ” **ë‹¤ë¥¸ IAM ì—­í• ì´ ë¶€ì—¬ëœ ì—¬ëŸ¬ ê·¸ë£¹ì— í• ë‹¹**ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë£¹ì´ IAM ì—­í• ì´ ë¶€ì—¬ëœ ê·¸ë£¹ ë‚´ì— ìˆëŠ” ê²½ìš°ì—ë„ í•´ë‹¹ ê·¸ë£¹ì˜ IAM ìê²© ì¦ëª…ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ í•˜ë ¤ë©´ **ì‚¬ìš©ì í’€ì´ Identity Poolì— ì˜í•´ ì‹ ë¢°**ë˜ì–´ì•¼ í•©ë‹ˆë‹¤(ê·¸ë¦¬ê³  í•´ë‹¹ Identity Poolì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤).

ì‚¬ìš©ìê°€ ì‚¬ìš©ì í’€ì—ì„œ ì¸ì¦ë  ë•Œ(`aws cognito-idp initiate-auth...`), **IdTokenì— í‘œì‹œëœ IAM ì—­í• **ì„ ì–»ìœ¼ë ¤ë©´ **Identity Provider ì¸ì¦ ê³µê¸‰ì**ê°€ **í† í°ì—ì„œ ì—­í• ì„ ì„ íƒí•´ì•¼ í•¨**ì„ ë‚˜íƒ€ë‚´ì•¼ í•©ë‹ˆë‹¤.

<figure><img src="../../../../.gitbook/assets/image (7) (1) (2).png" alt=""><figcaption></figcaption></figure>

ì‚¬ìš©ìê°€ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” **ì—­í• ì€ `IdToken` ë‚´ì— ìˆìœ¼ë©°**, ì‚¬ìš©ìëŠ” **`aws cognito-identity get-credentials-for-identity`**ì—ì„œ **`--custom-role-arn`**ì„ ì‚¬ìš©í•˜ì—¬ ì–´ë–¤ ì—­í• ì— ëŒ€í•œ ìê²© ì¦ëª…ì„ ë°›ì„ì§€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê·¸ëŸ¬ë‚˜ **ê¸°ë³¸ ì˜µì…˜**ì´ **êµ¬ì„±ëœ** ì˜µì…˜ì¸ ê²½ìš°(`use default role`), IdTokenì—ì„œ ì—­í• ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ê³  í•˜ë©´ **ì˜¤ë¥˜**ê°€ ë°œìƒí•©ë‹ˆë‹¤(ì´ì „ êµ¬ì„±ì´ í•„ìš”í•œ ì´ìœ ì…ë‹ˆë‹¤):

{% code overflow="wrap" %}
```
An error occurred (InvalidParameterException) when calling the GetCredentialsForIdentity operation: Only SAML providers and providers with RoleMappings support custom role ARN.
```
{% endcode %}

{% hint style="warning" %}
**User Pool ê·¸ë£¹**ì— í• ë‹¹ëœ ì—­í• ì€ **User Poolì„ ì‹ ë¢°í•˜ëŠ” Identity Providerì—ì„œ ì ‘ê·¼ ê°€ëŠ¥**í•´ì•¼ í•©ë‹ˆë‹¤ (IAM ì—­í•  **ì„¸ì…˜ ìê²© ì¦ëª…ì€ í•´ë‹¹ Identity Providerì—ì„œ ì–»ì–´ì˜µë‹ˆë‹¤**).
{% endhint %}
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"Federated": "cognito-identity.amazonaws.com"
},
"Action": "sts:AssumeRoleWithWebIdentity",
"Condition": {
"StringEquals": {
"cognito-identity.amazonaws.com:aud": "us-east-1:2361092e-9db6-a876-1027-10387c9de439"
},
"ForAnyValue:StringLike": {
"cognito-identity.amazonaws.com:amr": "authenticated"
}
}
}
]
}js
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
