# AWS - CloudHSM Enum

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJATELJSTVO**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**PorodiÄnu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## HSM - Modul za hardversku sigurnost

Cloud HSM je FIPS 140 nivo dva validisan **hardverski ureÄ‘aj** za sigurno skladiÅ¡tenje kriptografskih kljuÄeva (napomena da je CloudHSM hardverski ureÄ‘aj, nije virtualizovana usluga). To je SafeNetLuna 7000 ureÄ‘aj sa predinstaliranim 5.3.13. Postoje dve verzije firmware-a i koju Ä‡ete odabrati zavisi od vaÅ¡ih taÄnih potreba. Jedna je za usklaÄ‘enost sa FIPS 140-2 i postoji novija verzija koja se moÅ¾e koristiti.

NeobiÄna karakteristika CloudHSM-a je Å¡to je fiziÄki ureÄ‘aj, i stoga **nije deljen sa drugim korisnicima**, ili kako se obiÄno naziva, viÅ¡ekorisniÄki. To je posveÄ‡eni ureÄ‘aj za jednog korisnika koji je iskljuÄivo dostupan vaÅ¡im radnim optereÄ‡enjima.

UobiÄajeno, ureÄ‘aj je dostupan u roku od 15 minuta pod uslovom da postoji kapacitet, ali u nekim zonama to moÅ¾da neÄ‡e biti sluÄaj.

PoÅ¡to je ovo fiziÄki ureÄ‘aj posveÄ‡en vama, **kljuÄevi se Äuvaju na ureÄ‘aju**. KljuÄevi moraju biti ili **replikovani na drugi ureÄ‘aj**, saÄuvani na offline skladiÅ¡tu, ili izvezeni na rezervni ureÄ‘aj. **Ovaj ureÄ‘aj nije podrÅ¾an** od strane S3 ili bilo koje druge usluge na AWS-u poput KMS-a.

U **CloudHSM-u**, morate **samostalno skalirati uslugu**. Morate obezbediti dovoljno CloudHSM ureÄ‘aja da biste obradili sve vaÅ¡e potrebe za enkripcijom na osnovu algoritama enkripcije koje ste odabrali za implementaciju vaÅ¡eg reÅ¡enja.\
Skaliranje usluge za upravljanje kljuÄevima vrÅ¡i AWS i automatski se skalira po potrebi, tako da kako raste vaÅ¡a upotreba, tako moÅ¾e biti potrebno i viÅ¡e CloudHSM ureÄ‘aja. Imajte to na umu dok skalirate svoje reÅ¡enje i ako vaÅ¡e reÅ¡enje ima automatsko skaliranje, pobrinite se da je vaÅ¡ maksimalni obim uzet u obzir sa dovoljno CloudHSM ureÄ‘aja za pruÅ¾anje usluge reÅ¡enju.

Kao i sa skaliranjem, **performanse su na vama sa CloudHSM-om**. Performanse variraju na osnovu toga koji enkripcijski algoritam se koristi i koliko Äesto treba pristupiti ili povratiti kljuÄeve radi enkripcije podataka. Performanse usluge upravljanja kljuÄevima obraÄ‘uje Amazon i automatski se skalira po potrebi. Performanse CloudHSM-a se postiÅ¾u dodavanjem viÅ¡e ureÄ‘aja i ako vam je potrebno viÅ¡e performansi, ili dodajete ureÄ‘aje ili menjate metodu enkripcije na algoritam koji je brÅ¾i.

Ako je vaÅ¡e reÅ¡enje **viÅ¡eregionalno**, trebalo bi dodati nekoliko **CloudHSM ureÄ‘aja u drugoj regionu i osmisliti povezanost izmeÄ‘u regiona sa privatnom VPN vezom** ili nekim metodom kako bi se osiguralo da je saobraÄ‡aj uvek zaÅ¡tiÄ‡en izmeÄ‘u ureÄ‘aja na svakom nivou veze. Ako imate viÅ¡eregionalno reÅ¡enje, morate razmisliti o tome kako **replikovati kljuÄeve i postaviti dodatne CloudHSM ureÄ‘aje u regionima u kojima poslujete**. Vrlo brzo moÅ¾ete doÄ‡i u situaciju gde imate Å¡est ili osam ureÄ‘aja rasporeÄ‘enih Å¡irom viÅ¡e regiona, omoguÄ‡avajuÄ‡i potpunu redundanciju vaÅ¡ih enkripcijskih kljuÄeva.

**CloudHSM** je usluga klase preduzeÄ‡a za sigurno skladiÅ¡tenje kljuÄeva i moÅ¾e se koristiti kao **koren poverenja za preduzeÄ‡e**. MoÅ¾e skladiÅ¡titi privatne kljuÄeve u PKI i kljuÄeve sertifikacionih vlasti u X509 implementacijama. Pored simetriÄnih kljuÄeva koji se koriste u simetriÄnim algoritmima poput AES-a, **KMS skladiÅ¡ti i fiziÄki Å¡titi samo simetriÄne kljuÄeve (ne moÅ¾e delovati kao sertifikaciona vlast)**, tako da ako trebate skladiÅ¡titi PKI i CA kljuÄeve, CloudHSM ili dva ili tri mogla bi biti vaÅ¡e reÅ¡enje.

**CloudHSM je znatno skuplji od usluge upravljanja kljuÄevima**. CloudHSM je hardverski ureÄ‘aj, tako da imate fiksne troÅ¡kove za obezbeÄ‘ivanje CloudHSM ureÄ‘aja, a zatim i satni troÅ¡ak za pokretanje ureÄ‘aja. TroÅ¡ak se mnoÅ¾i sa koliko god CloudHSM ureÄ‘aja je potrebno da bi se postigli vaÅ¡i specifiÄni zahtevi.\
Dodatno, treba uzeti u obzir kupovinu softvera treÄ‡ih strana poput SafeNet ProtectV softverskih paketa i vreme i napor za integraciju. Usluga upravljanja kljuÄevima se naplaÄ‡uje na osnovu koriÅ¡Ä‡enja i zavisi od broja kljuÄeva koje imate i operacija unosa i izlaza. PoÅ¡to upravljanje kljuÄevima omoguÄ‡ava besprekornu integraciju sa mnogim AWS uslugama, troÅ¡kovi integracije bi trebalo da budu znaÄajno niÅ¾i. TroÅ¡kovi bi trebalo da se smatraju sekundarnim faktorom u reÅ¡enjima enkripcije. Enkripcija se obiÄno koristi radi sigurnosti i usaglaÅ¡enosti.

**Samo vi imate pristup kljuÄevima sa CloudHSM-om** i bez ulaska u previÅ¡e detalja, sa CloudHSM-om upravljate svojim kljuÄevima. **Sa KMS-om, vi i Amazon zajedno upravljate kljuÄevima**. AWS ima mnoge politike zaÅ¡tite od zloupotrebe i **joÅ¡ uvek ne moÅ¾e pristupiti vaÅ¡im kljuÄevima ni u jednom reÅ¡enju**. Glavna razlika je usaglaÅ¡enost u vezi sa vlasniÅ¡tvom i upravljanjem kljuÄevima, a sa CloudHSM-om, to je hardverski ureÄ‘aj koji vi upravljate i odrÅ¾avate sa ekskluzivnim pristupom samo vama.

### Predlozi za CloudHSM

1. Uvek implementirajte CloudHSM u **HA postavci** sa najmanje dva ureÄ‘aja u **odvojenim zonama dostupnosti**, i ako je moguÄ‡e, implementirajte treÄ‡i ili na lokaciji ili u drugoj regionu na AWS-u.
2. Budite oprezni prilikom **inicijalizacije** **CloudHSM-a**. Ova radnja **Ä‡e uniÅ¡titi kljuÄeve**, pa ili imajte drugu kopiju kljuÄeva ili budite apsolutno sigurni da vam ti kljuÄevi nisu potrebni i nikada, nikada neÄ‡e biti potrebni za deÅ¡ifrovanje podataka.
3. CloudHSM podrÅ¾ava samo odreÄ‘ene verzije firmware-a i softvera. Pre nego Å¡to izvrÅ¡ite bilo kakvo aÅ¾uriranje, proverite da li je firmware i/ili softver podrÅ¾an od strane AWS-a. Uvek moÅ¾ete kontaktirati AWS podrÅ¡ku da biste proverili da li je vodiÄ za aÅ¾uriranje nejasan.
4. **MreÅ¾na konfiguracija nikada ne bi trebalo da se menja.** Zapamtite, to je u AWS data centru i AWS nadgleda osnovni hardver za vas. To znaÄi da ako hardver otkazuje, oni Ä‡e ga zameniti za vas, ali samo ako znaju da je otkazao.
5. **ProsleÄ‘ivanje SysLog-a ne bi trebalo da se uklanja ili menja.** Uvek moÅ¾ete **dodati** prosleÄ‘ivaÄ SysLog-a da usmerite logove ka vaÅ¡em sopstvenom alatu za prikupljanje.
6. **SNMP** konfiguracija ima ista osnovna ograniÄenja kao i mreÅ¾a i SysLog folder. Ovo **ne bi trebalo da se menja ili uklanja**. Dodatna SNMP konfiguracija je u redu, samo se pobrinite da ne menjate onu koja veÄ‡ postoji na ureÄ‘aju.
7. JoÅ¡ jedna zanimljiva praksa od AWS-a je **ne menjati NTP konfiguraciju**. Nije jasno Å¡ta bi se desilo ako biste to uradili, pa imajte na umu da ako ne koristite istu NTP konfiguraciju za ostatak vaÅ¡eg reÅ¡enja, mogli biste imati dva izvora vremena. Samo budite svesni toga i znajte da CloudHSM mora ostati sa postojeÄ‡im izvorom NTP-a.

PoÄetna naknada za pokretanje CloudHSM-a iznosi 5.000 dolara za dodelu hardverskog ureÄ‘aja posveÄ‡enog vaÅ¡oj upotrebi, a zatim postoji satna naknada za pokretanje CloudHSM-a koja trenutno iznosi 1,88 dolara po satu rada, ili otprilike 1.373 dolara meseÄno.

NajÄeÅ¡Ä‡i razlog za koriÅ¡Ä‡enje CloudHSM-a su standardi usaglaÅ¡enosti koje morate ispuniti iz regulatornih razloga. **KMS ne nudi podrÅ¡ku za asimetriÄne kljuÄeve. CloudHSM vam omoguÄ‡ava da sigurno skladiÅ¡tite asimetriÄne kljuÄeve**.

**Javni kljuÄ je instaliran na HSM ureÄ‘aju tokom podeÅ¡avanja** tako da moÅ¾ete pristupiti instanci CloudHSM-a putem SSH-a.
### Å ta je Modul za hardversku sigurnost

Modul za hardversku sigurnost (HSM) je posveÄ‡eni kriptografski ureÄ‘aj koji se koristi za generisanje, Äuvanje i upravljanje kriptografskim kljuÄevima i zaÅ¡titu osetljivih podataka. Namijenjen je pruÅ¾anju visokog nivoa sigurnosti fiziÄkim i elektronskim izolovanjem kriptografskih funkcija od ostatka sistema.

NaÄin rada HSM-a moÅ¾e varirati u zavisnosti od specifiÄnog modela i proizvoÄ‘aÄa, ali generalno se deÅ¡avaju sledeÄ‡i koraci:

1. **Generisanje kljuÄeva**: HSM generiÅ¡e sluÄajni kriptografski kljuÄ koristeÄ‡i siguran generator sluÄajnih brojeva.
2. **ÄŒuvanje kljuÄeva**: KljuÄ je **bezbedno Äuvan unutar HSM-a, gde mu moÅ¾e pristupiti samo ovlaÅ¡Ä‡eni korisnici ili procesi**.
3. **Upravljanje kljuÄevima**: HSM pruÅ¾a niz funkcija upravljanja kljuÄevima, ukljuÄujuÄ‡i rotaciju kljuÄeva, rezervne kopije i opoziv.
4. **Kriptografske operacije**: HSM vrÅ¡i razliÄite kriptografske operacije, ukljuÄujuÄ‡i Å¡ifrovanje, deÅ¡ifrovanje, digitalni potpis i razmenu kljuÄeva. Ove operacije se **izvode unutar sigurnog okruÅ¾enja HSM-a**, koje Å¡titi od neovlaÅ¡Ä‡enog pristupa i manipulacije.
5. **Evidentiranje revizije**: HSM evidentira sve kriptografske operacije i pokuÅ¡aje pristupa, Å¡to se moÅ¾e koristiti u svrhe usaglaÅ¡enosti i revizije sigurnosti.

HSM-ovi se mogu koristiti za Å¡irok spektar aplikacija, ukljuÄujuÄ‡i sigurne online transakcije, digitalne sertifikate, sigurne komunikacije i Å¡ifrovanje podataka. ÄŒesto se koriste u industrijama koje zahtevaju visok nivo sigurnosti, poput finansija, zdravstva i vlade.

Ukupno, visok nivo sigurnosti koji pruÅ¾aju HSM-ovi Äini **vrlo teÅ¡kim izvlaÄenje sirovih kljuÄeva iz njih, a pokuÅ¡aj takvog postupka Äesto se smatra krÅ¡enjem sigurnosti**. MeÄ‘utim, mogu postojati **odreÄ‘eni scenariji** u kojima **ovlaÅ¡Ä‡eno osoblje moÅ¾e izvuÄ‡i sirov kljuÄ** u specifiÄne svrhe, kao Å¡to je sluÄaj postupka oporavka kljuÄa.

### Enumeracija
```
TODO
```
<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini da podrÅ¾ite HackTricks:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJATELJSTVO**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
