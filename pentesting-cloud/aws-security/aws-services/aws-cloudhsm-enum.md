# AWS - CloudHSM Enum

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

## HSM - Modu Bezpieczestwa Sprztowego

Cloud HSM to urzdzenie **sprztowe** zatwierdzone na poziomie FIPS 140 drugiego poziomu do bezpiecznego przechowywania kluczy kryptograficznych (nale偶y zauwa偶y, 偶e CloudHSM to urzdzenie sprztowe, nie jest to usuga wirtualizowana). Jest to urzdzenie SafeNetLuna 7000 z wersj 5.3.13 preinstalowan. Istniej dwie wersje oprogramowania ukadowego, a wyb贸r zale偶y od dokadnych potrzeb. Jedna jest zgodna z FIPS 140-2, a istnieje nowsza wersja, kt贸ra mo偶e by u偶ywana.

Nietypow cech CloudHSM jest to, 偶e jest to urzdzenie fizyczne i dlatego **nie jest wsp贸dzielone z innymi klientami**, czyli, jak to si powszechnie nazywa, wieloosobowe. Jest to dedykowane urzdzenie dla jednego najemcy, dostpne wycznie dla twoich obci偶e roboczych.

Zazwyczaj urzdzenie jest dostpne w cigu 15 minut, zakadajc, 偶e jest dostpna pojemno, ale w niekt贸rych strefach mo偶e jej nie by.

Poniewa偶 jest to urzdzenie fizyczne dedykowane tobie, **klucze s przechowywane na urzdzeniu**. Klucze musz by albo **replikowane na inne urzdzenie**, zapisywane na nonikach offline, albo eksportowane do zapasowego urzdzenia. **To urzdzenie nie jest wspierane** przez S3 ani 偶adn inn usug w AWS, tak jak KMS.

W **CloudHSM** musisz **skalowa usug samodzielnie**. Musisz dostarczy wystarczajc liczb urzdze CloudHSM, aby obsu偶y swoje potrzeby szyfrowania na podstawie algorytm贸w szyfrowania, kt贸re wybrae do wdro偶enia w swoim rozwizaniu.\
Skalowanie usugi zarzdzania kluczami jest wykonywane przez AWS i automatycznie dostosowuje si do zapotrzebowania, wic w miar wzrostu u偶ytkowania mo偶e by wymagana wiksza liczba urzdze CloudHSM. Pamitaj o tym, gdy skalujesz swoje rozwizanie, i jeli twoje rozwizanie ma automatyczne skalowanie, upewnij si, 偶e maksymalna skala jest uwzgldniona z wystarczajc liczb urzdze CloudHSM do obsugi rozwizania.

Tak jak ze skalowaniem, **wydajno zale偶y od ciebie z CloudHSM**. Wydajno zale偶y od u偶ytego algorytmu szyfrowania i od tego, jak czsto musisz uzyska dostp lub odzyska klucze do szyfrowania danych. Wydajno usugi zarzdzania kluczami jest obsugiwana przez Amazon i automatycznie dostosowuje si do wymaga popytu. Wydajno CloudHSM jest osigana poprzez dodawanie kolejnych urzdze, a jeli potrzebujesz wikszej wydajnoci, dodajesz urzdzenia lub zmieniasz metod szyfrowania na algorytm, kt贸ry dziaa szybciej.

Jeli twoje rozwizanie jest **wielostrefowe**, powiniene doda kilka **urzdze CloudHSM w drugiej strefie i ustali czno midzyregionow za pomoc prywatnego poczenia VPN** lub jakiej metody, aby zapewni, 偶e ruch zawsze jest chroniony midzy urzdzeniem na ka偶dym poziomie poczenia. Jeli masz rozwizanie wieloregionowe, musisz zastanowi si, jak **replikowa klucze i skonfigurowa dodatkowe urzdzenia CloudHSM w regionach, w kt贸rych dziaasz**. Mo偶esz bardzo szybko znale藕 si w sytuacji, w kt贸rej masz sze lub osiem urzdze rozproszonych w r贸偶nych regionach, umo偶liwiajc pen redundancj twoich kluczy szyfrowania.

**CloudHSM** to usuga klasy enterprise do bezpiecznego przechowywania kluczy i mo偶e by u偶ywana jako **podstawa zaufania dla przedsibiorstwa**. Mo偶e przechowywa klucze prywatne w PKI i klucze certyfikatu w implementacjach X509. Opr贸cz kluczy symetrycznych u偶ywanych w algorytmach symetrycznych, takich jak AES, **KMS przechowuje i fizycznie chroni tylko klucze symetryczne (nie mo偶e dziaa jako urzdzenie certyfikujce)**, wic jeli potrzebujesz przechowywa klucze PKI i CA, CloudHSM lub dwa lub trzy mog by twoim rozwizaniem.

**CloudHSM jest znacznie dro偶szy ni偶 Key Management Service**. CloudHSM to urzdzenie sprztowe, wic masz stae koszty na dostarczenie urzdzenia CloudHSM, a nastpnie koszt godzinowy za jego dziaanie. Koszt jest mno偶ony przez liczb urzdze CloudHSM wymaganych do spenienia twoich konkretnych wymaga.\
Dodatkowo, nale偶y uwzgldni zakup oprogramowania firm trzecich, takiego jak zestawy oprogramowania SafeNet ProtectV oraz czas i wysiek integracji. Usuga zarzdzania kluczami jest oparta na u偶yciu i zale偶y od liczby kluczy, jakie posiadasz, oraz operacji wejcia i wyjcia. Poniewa偶 zarzdzanie kluczami zapewnia bezproblemow integracj z wieloma usugami AWS, koszty integracji powinny by znacznie ni偶sze. Koszty powinny by rozwa偶ane jako drugorzdny czynnik w rozwizaniach szyfrowania. Szyfrowanie jest zazwyczaj stosowane ze wzgld贸w bezpieczestwa i zgodnoci.

**Tylko ty masz dostp do kluczy z CloudHSM** i bez zagbiania si w szczeg贸y, z CloudHSM zarzdzasz swoimi wasnymi kluczami. **Z KMS, ty i Amazon wsp贸lnie zarzdzacie kluczami**. AWS ma wiele zabezpiecze polityki przeciwko nadu偶yciom i **nadal nie ma dostpu do twoich kluczy w 偶adnym z rozwiza**. G贸wn r贸偶nic jest zgodno w odniesieniu do wasnoci i zarzdzania kluczami, a z CloudHSM jest to urzdzenie sprztowe, kt贸re zarzdzasz i utrzymujesz z wycznym dostpem dla ciebie i tylko dla ciebie.

### Sugestie dotyczce CloudHSM

1. Zawsze wdra偶aj CloudHSM w **konfiguracji HA** z co najmniej dwoma urzdzeniami w **oddzielnych strefach dostpnoci**, a jeli to mo偶liwe, wdro偶 trzecie urzdzenie albo lokalnie, albo w innym regionie w AWS.
2. Bd藕 ostro偶ny podczas **inicjalizacji** **CloudHSM**. Ta czynno **zniszczy klucze**, wic miej kopi kluczy lub bd藕 absolutnie pewien, 偶e nie potrzebujesz i nigdy nie bdziesz potrzebowa tych kluczy do odszyfrowania 偶adnych danych.
3. CloudHSM obsuguje tylko **pewne wersje oprogramowania ukadowego** i oprogramowania. Przed wykonaniem aktualizacji upewnij si, 偶e oprogramowanie ukadowe i/lub oprogramowanie jest obsugiwane przez AWS. Zawsze mo偶esz skontaktowa si z pomoc techniczn AWS, aby sprawdzi, czy przewodnik aktualizacji jest niejasny.
4. **Konfiguracja sieciowa nie powinna by zmieniana.** Pamitaj, 偶e znajduje si w centrum danych AWS, a AWS monitoruje podstawowy sprzt dla ciebie. Oznacza to, 偶e jeli sprzt ulegnie awarii, zastpi go, ale tylko jeli bd wiedzieli, 偶e uleg awarii.
5. **Przekierowanie SysLog nie powinno by usuwane ani zmieniane**. Zawsze mo偶esz **doda** przekierowanie SysLog, aby kierowa logi do wasnego narzdzia zbierania.
6. Konfiguracja **SNMP** ma te same podstawowe ograniczenia co sie i przekierownik SysLog. **Nie powinno by zmieniane ani usuwane**. Dodatkowa konfiguracja SNMP jest w porzdku, po prostu upewnij si, 偶e nie zmieniasz tej, kt贸ra ju偶 jest na urzdzeniu.
7. Kolejn interesujc praktyk zalecan przez AWS jest **niezmienianie konfiguracji NTP**. Nie jest jasne, co by si stao, gdyby to zrobi, wic pamitaj, 偶e jeli nie u偶ywasz tej samej konfiguracji NTP dla reszty swojego rozwizania, to mog by dwa 藕r贸da czasu. Bd藕 tego wiadomy i wiedz, 偶e CloudHSM musi pozosta z istniejcym 藕r贸dem NTP.

Pocztkowa opata za uruchomienie CloudHSM wynosi 5000 USD na przydzielenie dedykowanego urzdzenia sprztowego dla twojego u偶ytku, a nastpnie jest opata godzinowa za dziaanie CloudHSM, kt贸ra obecnie wynosi 1,88 USD za godzin dziaania, czyli okoo 1373 USD miesicznie.

Najczstszym powodem u偶ycia CloudHSM s standardy zgodnoci, kt贸re musisz speni z przyczyn regulacyjnych. **KMS nie oferuje wsparcia danych dla kluczy asymetrycznych. CloudHSM pozwala na bezpieczne przechowywanie kluczy asymetrycznych**.

**Klucz publiczny jest zainstalowany na urzdzeniu HSM podczas wdra偶ania**, dziki czemu mo偶esz uzyska dostp do instancji CloudHSM za pomoc SSH.
### Co to jest modu bezpieczestwa sprztowego

Modu bezpieczestwa sprztowego (HSM) to dedykowane urzdzenie kryptograficzne, kt贸re su偶y do generowania, przechowywania i zarzdzania kluczami kryptograficznymi oraz ochrony danych poufnych. Zaprojektowany jest w celu zapewnienia wysokiego poziomu bezpieczestwa poprzez fizyczne i elektroniczne izolowanie funkcji kryptograficznych od reszty systemu.

Spos贸b dziaania HSM mo偶e si r贸偶ni w zale偶noci od konkretnego modelu i producenta, ale og贸lnie zachodz nastpujce kroki:

1. **Generowanie klucza**: HSM generuje losowy klucz kryptograficzny za pomoc bezpiecznego generatora liczb losowych.
2. **Przechowywanie klucza**: Klucz jest **przechowywany bezpiecznie wewntrz HSM, gdzie mo偶e by dostpny tylko dla autoryzowanych u偶ytkownik贸w lub proces贸w**.
3. **Zarzdzanie kluczem**: HSM zapewnia szereg funkcji zarzdzania kluczami, w tym rotacj kluczy, tworzenie kopii zapasowych i wycofywanie kluczy.
4. **Operacje kryptograficzne**: HSM wykonuje szereg operacji kryptograficznych, w tym szyfrowanie, deszyfrowanie, podpisywanie cyfrowe i wymian kluczy. Te operacje s **wykonywane w bezpiecznym rodowisku HSM**, kt贸re chroni przed nieautoryzowanym dostpem i manipulacj.
5. **Rejestracja audytowa**: HSM rejestruje wszystkie operacje kryptograficzne i pr贸by dostpu, kt贸re mog by wykorzystane do cel贸w audytu zgodnoci i bezpieczestwa.

HSM-y mog by wykorzystywane w szerokim zakresie zastosowa, w tym w bezpiecznych transakcjach online, certyfikatach cyfrowych, bezpiecznej komunikacji i szyfrowaniu danych. S czsto stosowane w bran偶ach, kt贸re wymagaj wysokiego poziomu bezpieczestwa, takich jak finanse, opieka zdrowotna i sektor publiczny.

Og贸lnie rzecz biorc, wysoki poziom bezpieczestwa zapewniany przez HSM-y sprawia, 偶e **bardzo trudno jest wydoby z nich surowe klucze, a pr贸ba tego jest czsto uwa偶ana za naruszenie bezpieczestwa**. Istniej jednak **pewne scenariusze**, w kt贸rych **autoryzowany personel m贸gby wydoby surowy klucz** w celach okrelonych, na przykad w przypadku procedury odzyskiwania klucza.

### Wyliczanie
```
TODO
```
<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakowania, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
