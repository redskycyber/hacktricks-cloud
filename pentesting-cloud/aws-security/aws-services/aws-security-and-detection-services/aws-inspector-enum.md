# AWS - Inspector Enum

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

## Inspector

El servicio Amazon Inspector es **basado en agentes**, lo que significa que requiere que se **instalen agentes de software en cualquier instancia EC2** que desee evaluar. Esto hace que sea un servicio f谩cil de configurar y agregar en cualquier momento a los recursos existentes que ya se ejecutan dentro de su infraestructura de AWS. Esto ayuda a que Amazon Inspector se convierta en una integraci贸n perfecta con cualquiera de sus procesos de seguridad existentes y procedimientos como otro nivel de seguridad.

Estas son las pruebas que AWS Inspector te permite realizar:

* **CVEs**
* **CIS Benchmarks**
* **Mejores pr谩cticas de seguridad**
* **Alcance de red**

Puedes ejecutar cualquiera de estas pruebas en las m谩quinas EC2 que decidas.

### Elemento de AWS Inspector

**Rol**: Crea o selecciona un rol para permitir que Amazon Inspector tenga acceso de solo lectura a las instancias EC2 (DescribeInstances)\
**Objetivos de evaluaci贸n**: Grupo de instancias EC2 en las que deseas ejecutar una evaluaci贸n\
**Agentes de AWS**: Agentes de software que deben instalarse en las instancias EC2 para monitorear. Los datos se env铆an a Amazon Inspector utilizando un canal TLS. Se env铆a un latido regular desde el agente al inspector solicitando instrucciones. Puede actualizarse autom谩ticamente\
**Plantillas de evaluaci贸n**: Define configuraciones espec铆ficas sobre c贸mo se ejecuta una evaluaci贸n en sus instancias EC2. Una plantilla de evaluaci贸n no se puede modificar despu茅s de la creaci贸n.

* Paquetes de reglas a utilizar
* Duraci贸n de la ejecuci贸n de la evaluaci贸n 15min/1hora/8horas
* Temas de SNS, seleccionar cu谩ndo notificar: Inicio, finalizaci贸n, cambio de estado, informar un hallazgo
* Atributos a asignar a los hallazgos

**Paquete de reglas**: Contiene varias reglas individuales que se verifican en una instancia EC2 cuando se ejecuta una evaluaci贸n. Cada una tambi茅n tiene una gravedad (alta, media, baja, informativa). Las posibilidades son:

* Vulnerabilidades y Exposiciones Comunes (CVEs)
* Centro de Seguridad de Internet (CIS) Benchmark
* Mejores pr谩cticas de seguridad

Una vez que haya configurado el Rol de Amazon Inspector, se hayan instalado los Agentes de AWS, se haya configurado el objetivo y la plantilla, podr谩 ejecutarlo. Una ejecuci贸n de evaluaci贸n se puede detener, reanudar o eliminar.

Amazon Inspector tiene un conjunto predefinido de reglas, agrupadas en paquetes. Cada Plantilla de Evaluaci贸n define qu茅 paquetes de reglas se incluir谩n en la prueba. Las instancias se eval煤an con respecto a los paquetes de reglas incluidos en la plantilla de evaluaci贸n.

{% hint style="info" %}
Ten en cuenta que hoy en d铆a AWS ya te permite **autocrear** todas las **configuraciones** necesarias e incluso instalar autom谩ticamente los agentes dentro de las instancias EC2.
{% endhint %}

### **Reporte**

**Telemetr铆a**: datos recopilados de una instancia, detallando su configuraci贸n, comportamiento y procesos durante una ejecuci贸n de evaluaci贸n. Una vez recopilados, los datos se env铆an de vuelta a Amazon Inspector en tiempo casi real a trav茅s de TLS, donde se almacenan y cifran en S3 a trav茅s de una clave KMS ef铆mera. Luego, Amazon Inspector accede al Bucket de S3, descifra los datos en memoria y los analiza con respecto a cualquier paquete de reglas utilizado para esa evaluaci贸n para generar los hallazgos.

**Informe de Evaluaci贸n**: Proporciona detalles sobre lo que se evalu贸 y los resultados de la evaluaci贸n.

* El informe de **hallazgos** contiene el resumen de la evaluaci贸n, informaci贸n sobre la EC2 y las reglas y los hallazgos que ocurrieron.
* El **informe completo** es el informe de hallazgos + una lista de reglas que se aprobaron.

## Enumeraci贸n
```
# Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

# Get findings
aws inspector list-findings

# Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

# Rule packages
aws inspector list-rules-packages
```
## Post Explotaci贸n

{% hint style="success" %}
Desde la perspectiva de un atacante, este servicio puede ayudar al atacante a encontrar vulnerabilidades y exposiciones de red que podr铆an ayudarlo a comprometer otras instancias/contenedores.

Sin embargo, un atacante tambi茅n podr铆a estar interesado en interrumpir este servicio para que la v铆ctima no pueda ver vulnerabilidades (todas o espec铆ficas).
{% endhint %}

TODO: Se aceptan solicitudes de extracci贸n

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando solicitudes de extracci贸n a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
