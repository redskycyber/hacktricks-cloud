# AWS - Inspector Enum

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Inspector

El servicio Amazon Inspector es **basado en agentes**, lo que significa que requiere que se instalen agentes de software en cualquier instancia EC2 que desees evaluar. Esto hace que sea un servicio f谩cil de configurar y a帽adir en cualquier momento a los recursos existentes que ya est谩n funcionando dentro de tu infraestructura de AWS. Esto ayuda a que Amazon Inspector se integre sin problemas con cualquiera de tus procesos y procedimientos de seguridad existentes como otro nivel de seguridad.

Estas son las pruebas que AWS Inspector te permite realizar:

* **CVEs**
* **CIS Benchmarks**
* **Mejores pr谩cticas de seguridad**
* **Alcance de la red**

Puedes hacer que cualquiera de estas pruebas se ejecute en las m谩quinas EC2 que decidas.

### Elemento de AWS Inspector

**Rol**: Crea o selecciona un rol para permitir que Amazon Inspector tenga acceso de solo lectura a las instancias EC2 (DescribeInstances)\
**Objetivos de Evaluaci贸n**: Grupo de instancias EC2 contra las que deseas ejecutar una evaluaci贸n\
**Agentes de AWS**: Agentes de software que deben instalarse en las instancias EC2 para monitorear. Los datos se env铆an a Amazon Inspector mediante un canal TLS. Un latido regular se env铆a desde el agente al inspector pidiendo instrucciones. Puede actualizarse autom谩ticamente\
**Plantillas de Evaluaci贸n**: Definen configuraciones espec铆ficas sobre c贸mo se ejecuta una evaluaci贸n en tus instancias EC2. Una plantilla de evaluaci贸n no se puede modificar despu茅s de su creaci贸n.

* Paquetes de reglas a utilizar
* Duraci贸n de la ejecuci贸n de la evaluaci贸n 15min/1hora/8horas
* Temas de SNS, selecciona cu谩ndo notificar: Inicio, finalizaci贸n, cambio de estado, informe de un hallazgo
* Atributos para asignar a los hallazgos

**Paquete de reglas**: Contiene una serie de reglas individuales que se verifican contra una EC2 cuando se ejecuta una evaluaci贸n. Cada una tambi茅n tiene una severidad (alta, media, baja, informativa). Las posibilidades son:

* Vulnerabilidades Comunes y Exposiciones (CVEs)
* Benchmark del Centro para la Seguridad en Internet (CIS)
* Mejores pr谩cticas de seguridad

Una vez que hayas configurado el Rol de Amazon Inspector, los Agentes de AWS est茅n instalados, el objetivo est茅 configurado y la plantilla est茅 configurada, podr谩s ejecutarla. Una ejecuci贸n de evaluaci贸n puede detenerse, reanudarse o eliminarse.

Amazon Inspector tiene un conjunto predefinido de reglas, agrupadas en paquetes. Cada Plantilla de Evaluaci贸n define qu茅 paquetes de reglas se incluir谩n en la prueba. Las instancias se eval煤an contra los paquetes de reglas incluidos en la plantilla de evaluaci贸n.

{% hint style="info" %}
Ten en cuenta que hoy en d铆a AWS ya te permite **crear autom谩ticamente** todas las **configuraciones** necesarias e incluso instalar autom谩ticamente los agentes dentro de las instancias EC2.
{% endhint %}

### **Informes**

**Telemetr铆a**: datos que se recopilan de una instancia, detallando su configuraci贸n, comportamiento y procesos durante una ejecuci贸n de evaluaci贸n. Una vez recopilados, los datos se env铆an de vuelta a Amazon Inspector en tiempo casi real a trav茅s de TLS, donde luego se almacenan y cifran en S3 mediante una clave KMS ef铆mera. Amazon Inspector luego accede al Bucket de S3, descifra los datos en memoria y los analiza contra cualquier paquete de reglas utilizado para esa evaluaci贸n para generar los hallazgos.

**Informe de Evaluaci贸n**: Proporciona detalles sobre lo que se evalu贸 y los resultados de la evaluaci贸n.

* El **informe de hallazgos** contiene el resumen de la evaluaci贸n, informaci贸n sobre la EC2 y las reglas y los hallazgos que ocurrieron.
* El **informe completo** es el informe de hallazgos + una lista de reglas que se pasaron.

## Enumeraci贸n
```
# Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

# Get findings
aws inspector list-findings

# Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

# Rule packages
aws inspector list-rules-packages
```
## Post Explotaci贸n

{% hint style="success" %}
Desde la perspectiva de un atacante, este servicio puede ayudar al atacante a encontrar vulnerabilidades y exposiciones de red que podr铆an ayudarle a comprometer otras instancias/contenedores.

Sin embargo, un atacante tambi茅n podr铆a estar interesado en interrumpir este servicio para que la v铆ctima no pueda ver vulnerabilidades (todas o espec铆ficas).
{% endhint %}

TODO: Se aceptan PRs

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
