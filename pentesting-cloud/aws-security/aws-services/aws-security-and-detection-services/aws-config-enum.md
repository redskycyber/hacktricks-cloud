# AWS - Enumeraci贸n de Config

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos.
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## AWS Config

AWS Config **captura los cambios de recursos**, por lo que cualquier cambio en un recurso compatible con Config puede ser registrado, lo que **registrar谩 lo que cambi贸 junto con otros metadatos 煤tiles, todo contenido en un archivo conocido como un elemento de configuraci贸n**, un CI.\
Este servicio es **espec铆fico de la regi贸n**.

Un elemento de configuraci贸n o **CI**, como se le conoce, es un componente clave de AWS Config. Est谩 compuesto por un archivo JSON que **contiene la informaci贸n de configuraci贸n, la informaci贸n de relaci贸n y otros metadatos como una vista instant谩nea de un recurso compatible**. Toda la informaci贸n que AWS Config puede registrar para un recurso se captura dentro del CI. Se crea un CI **cada vez que** se realiza un cambio en la configuraci贸n de un recurso compatible de cualquier manera. Adem谩s de registrar los detalles del recurso afectado, AWS Config tambi茅n registrar谩 CIs para cualquier recurso directamente relacionado para asegurarse de que el cambio no afect贸 a esos recursos tambi茅n.

* **Metadatos**: Contiene detalles sobre el propio elemento de configuraci贸n. Un ID de versi贸n y un ID de configuraci贸n, que identifica de manera 煤nica el CI. Otra informaci贸n puede incluir un MD5Hash que le permite comparar otros CIs ya registrados contra el mismo recurso.
* **Atributos**: Esto contiene informaci贸n com煤n de **atributos contra el recurso real**. Dentro de esta secci贸n, tambi茅n tenemos un ID de recurso 煤nico y cualquier etiqueta de valor clave asociada al recurso. Tambi茅n se enumera el tipo de recurso. Por ejemplo, si este fuera un CI para una instancia de EC2, los tipos de recursos enumerados podr铆an ser la interfaz de red o la direcci贸n IP el谩stica para esa instancia de EC2.
* **Relaciones**: Esto contiene informaci贸n para cualquier **relaci贸n conectada que el recurso pueda tener**. Por lo tanto, dentro de esta secci贸n, mostrar铆a una descripci贸n clara de cualquier relaci贸n con otros recursos que tenga este recurso. Por ejemplo, si el CI fuera para una instancia de EC2, la secci贸n de relaciones podr铆a mostrar la conexi贸n a una VPC junto con la subred en la que reside la instancia de EC2.
* **Configuraci贸n actual**: Esto mostrar谩 la misma informaci贸n que se generar铆a si realizara una llamada API de descripci贸n o lista realizada por AWS CLI. AWS Config utiliza las mismas llamadas API para obtener la misma informaci贸n.
* **Eventos relacionados**: Esto se refiere a AWS CloudTrail. Esto mostrar谩 el **ID de evento de AWS CloudTrail que est谩 relacionado con el cambio que desencaden贸 la creaci贸n de este CI**. Se crea un nuevo CI por cada cambio realizado en un recurso. Como resultado, se crear谩n diferentes IDs de eventos de CloudTrail.

**Historial de configuraci贸n**: Es posible obtener el historial de configuraci贸n de los recursos gracias a los elementos de configuraci贸n. Se entrega un historial de configuraci贸n cada 6 horas y contiene todos los CIs para un tipo de recurso en particular.

**Flujos de configuraci贸n**: Los elementos de configuraci贸n se env铆an a un tema de SNS para permitir el an谩lisis de los datos.

**Instant谩neas de configuraci贸n**: Los elementos de configuraci贸n se utilizan para crear una instant谩nea en el tiempo de todos los recursos compatibles.

**S3 se utiliza para almacenar** los archivos de historial de configuraci贸n y cualquier instant谩nea de configuraci贸n de sus datos dentro de un solo bucket, que se define dentro del grabador de configuraci贸n. Si tiene varias cuentas de AWS, es posible que desee agregar los archivos de historial de configuraci贸n a la misma S3 bucket para su cuenta principal. Sin embargo, deber谩 otorgar acceso de escritura para este principio de servicio, config.amazonaws.com, y sus cuentas secundarias con acceso de escritura a la S3 bucket en su cuenta principal.

### Funcionamiento

* Cuando se realizan cambios, por ejemplo, en el grupo de seguridad o en la lista de control de acceso del bucket -> se activa como un evento recogido por AWS Config
* Almacena todo en el bucket S3
* Dependiendo de la configuraci贸n, tan pronto como algo cambie, podr铆a activar una funci贸n lambda O programar una funci贸n lambda para buscar peri贸dicamente en la configuraci贸n de AWS Config
* Lambda devuelve a Config
* Si se ha incumplido una regla, Config inicia un SNS

![](<../../../../.gitbook/assets/image (46).png>)

### Reglas de Config

Las reglas de Config son una excelente manera de ayudarlo a **aplicar controles y verificaciones de cumplimiento espec铆ficos en todos sus recursos**, y le permite adoptar una especificaci贸n de implementaci贸n ideal para cada uno de sus tipos de recursos. Cada regla **es esencialmente una funci贸n lambda** que, cuando se llama, eval煤a el recurso y lleva a cabo alguna l贸gica simple para determinar el resultado de cumplimiento con la regla. **Cada vez que se realiza un cambio** en uno de sus recursos compatibles, **AWS Config verificar谩 el cumplimiento con cualquier regla de configuraci贸n que tenga en su lugar**.\
AWS tiene una serie de **reglas predefinidas** que caen bajo el paraguas de seguridad que est谩n listas para usar. Por ejemplo, Rds-storage-encrypted. Esto verifica si la encriptaci贸n de almacenamiento est谩 activada por sus instancias de base de datos RDS. Encrypted-volumes. Esto verifica si alg煤n volumen EBS que tenga un estado adjunto est谩 encriptado.

* **Reglas administradas por AWS**: Conjunto de reglas predefinidas que cubren muchas mejores pr谩cticas, por lo que siempre vale la pena buscar estas reglas primero antes de configurar las suyas propias, ya que existe la posibilidad de que la regla ya exista.
* **Reglas personalizadas**: Puede crear sus propias reglas para verificar configuraciones personalizadas espec铆ficas.

L铆mite de 50 reglas de configuraci贸n por regi贸n antes de que necesite contactar a AWS para obtener un aumento.\
Los resultados no conformes NO se eliminan.

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos.
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>