# AWS - Enumeracja Firewalla

<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakowania, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Manager Firewalla

**AWS Firewall Manager** usprawnia zarzdzanie i konserwacj **AWS WAF, AWS Shield Advanced, grupy zabezpiecze Amazon VPC oraz listy kontroli dostpu do sieci (ACL), AWS Network Firewall, AWS Route 53 Resolver DNS Firewall oraz zapory zewntrzne** w wielu kontach i zasobach. Umo偶liwia konfigurowanie regu zapory, ochrony Shield Advanced, grup zabezpiecze VPC oraz ustawie zapory sieciowej tylko raz, a usuga **automatycznie egzekwuje te reguy i ochrony we wszystkich kontach i zasobach**, w tym nowo dodanych.

Usuga oferuje mo偶liwo **grupowania i zabezpieczania okrelonych zasob贸w razem**, takich jak te, kt贸re maj wsp贸lny tag lub wszystkie dystrybucje CloudFront. Istotn zalet Firewall Managera jest jego zdolno do **automatycznego rozszerzania ochrony na nowo dodane zasoby** w Twoim koncie.

**Grupa regu** (zbi贸r regu WAF) mo偶e by wczona do polityki AWS Firewall Manager, kt贸ra jest nastpnie powizana z okrelonymi zasobami AWS, takimi jak dystrybucje CloudFront lub r贸wnowa偶niki obci偶enia aplikacji.

AWS Firewall Manager dostarcza **zarzdzane listy aplikacji i protoko贸w** w celu uproszczenia konfiguracji i zarzdzania politykami grup zabezpiecze. Te listy pozwalaj zdefiniowa protokoy i aplikacje zezwolone lub zabronione przez Twoje polityki. Istniej dwa rodzaje zarzdzanych list:

* **Zarzdzane listy Firewall Managera**: Te listy obejmuj **FMS-Default-Public-Access-Apps-Allowed**, **FMS-Default-Protocols-Allowed** i **FMS-Default-Protocols-Allowed**. S zarzdzane przez Firewall Managera i zawieraj powszechnie u偶ywane aplikacje i protokoy, kt贸re powinny by zezwolone lub zabronione dla og贸u publicznoci. Nie mo偶na ich edytowa ani usuwa, jednak mo偶na wybra ich wersj.
* **Niestandardowe zarzdzane listy**: Te listy zarzdzasz samodzielnie. Mo偶esz tworzy niestandardowe listy aplikacji i protoko贸w dostosowane do potrzeb Twojej organizacji. W przeciwiestwie do zarzdzanych list Firewall Managera, te listy nie maj wersji, ale masz pen kontrol nad niestandardowymi listami, co pozwala na ich tworzenie, edytowanie i usuwanie wedug potrzeb.

Warto zauwa偶y, 偶e **polityki Firewall Managera pozwalaj tylko na dziaania "Blokuj" lub "Licznik" dla grupy regu, bez opcji "Zezwalaj".

### Wymagania wstpne

Nastpujce kroki wstpne musz zosta wykonane przed przejciem do konfigurowania Firewall Managera w celu skutecznego zabezpieczenia zasob贸w Twojej organizacji. Te kroki zapewniaj podstawow konfiguracj wymagan do egzekwowania polityk zabezpiecze przez Firewall Managera i zapewnienia zgodnoci w caym Twoim rodowisku AWS:

1. **Docz i skonfiguruj AWS Organizations:** Upewnij si, 偶e Twoje konto AWS jest czci organizacji AWS Organizations, w kt贸rej planowane jest wdro偶enie polityk AWS Firewall Manager. Umo偶liwia to scentralizowane zarzdzanie zasobami i politykami w wielu kontach AWS w ramach organizacji.
2. **Utw贸rz domylne konto administratora AWS Firewall Manager:** Utw贸rz domylne konto administratora specjalnie do zarzdzania politykami zabezpiecze Firewall Manager. To konto bdzie odpowiedzialne za konfigurowanie i egzekwowanie polityk zabezpiecze w caej organizacji. Tylko konto zarzdzajce organizacj mo偶e tworzy domylne konta administratora Firewall Managera.
3. **Wcz AWS Config:** Aktywuj AWS Config, aby dostarczy Firewall Managerowi niezbdne dane konfiguracyjne i wgld wymagany do skutecznego egzekwowania polityk zabezpiecze. AWS Config pomaga analizowa, audytowa, monitorowa i audytowa konfiguracje i zmiany zasob贸w, uatwiajc lepsze zarzdzanie bezpieczestwem.
4. **Dla polityk firm zewntrznych, zasubskrybuj w AWS Marketplace i skonfiguruj ustawienia firm zewntrznych:** Jeli planujesz korzysta z polityk zap贸r firm zewntrznych, zasubskrybuj je w AWS Marketplace i skonfiguruj niezbdne ustawienia. Ten krok zapewnia, 偶e Firewall Manager mo偶e integrowa i egzekwowa polityki od zaufanych dostawc贸w firm zewntrznych.
5. **Dla polityk zapory sieciowej i zapory DNS, wcz udostpnianie zasob贸w:** Wcz udostpnianie zasob贸w specjalnie dla polityk zapory sieciowej i zapory DNS. Pozwala to Firewall Managerowi zastosowa ochron zapory do VPC i rozdzielania DNS Twojej organizacji, zwikszajc bezpieczestwo sieci.
6. **Aby u偶ywa AWS Firewall Managera w regionach domylnie wyczonych:** Jeli planujesz korzysta z Firewall Managera w regionach AWS, kt贸re s domylnie wyczone, upewnij si, 偶e podejmujesz niezbdne kroki, aby wczy jego funkcjonalno w tych regionach. Zapewnia to sp贸jne egzekwowanie zabezpiecze we wszystkich regionach, w kt贸rych dziaa Twoja organizacja.

Wicej informacji znajdziesz tutaj:[Rozpoczcie pracy z politykami AWS Firewall Manager AWS WAF](https://docs.aws.amazon.com/waf/latest/developerguide/getting-started-fms.html).

### Rodzaje polityk ochronnych

AWS Firewall Manager zarzdza kilkoma rodzajami polityk w celu egzekwowania kontroli zabezpiecze w r贸偶nych aspektach infrastruktury Twojej organizacji:

1. **Polityka AWS WAF:** Ten rodzaj polityki obsuguje zar贸wno AWS WAF, jak i AWS WAF Classic. Mo偶esz zdefiniowa, kt贸re zasoby s chronione przez polityk. Dla polityk AWS WAF mo偶esz okreli zestawy grup regu do uruchomienia jako pierwsze i ostatnie w ACL sieci web. Dodatkowo waciciele kont mog doda reguy i grupy regu do uruchomienia midzy tymi zestawami.
2. **Polityka Shield Advanced:** Ta polityka stosuje ochrony Shield Advanced w caej organizacji dla okrelonych typ贸w zasob贸w. Pomaga zabezpieczy przed atakami DDoS i innymi zagro偶eniami.
3. **Polityka grupy zabezpiecze Amazon VPC:** Dziki tej polityce mo偶esz zarzdza grupami zabezpiecze u偶ywanymi w caej organizacji, egzekwujc podstawowy zestaw regu w caym rodowisku AWS w celu kontrolowania dostpu do sieci.
4. **Polityka listy kontroli dostpu do sieci Amazon VPC (ACL):** Ten rodzaj polityki daje Ci kontrol nad listami kontroli dostpu do sieci u偶ywanymi w Twojej organizacji, pozwalajc na egzekwowanie podstawowego zestawu list kontroli dostpu do sieci w caym rodowisku AWS.
5. **Polityka zapory sieciowej:** Ta polityka stosuje ochron zapory sieciowej AWS do VPC Twojej organizacji, zwikszajc bezpieczestwo sieci poprzez filtrowanie ruchu na podstawie predefiniowanych regu.
6. **Polityka zapory DNS Route 53 Resolver Amazon:** Ta polityka stosuje ochrony zapory DNS do VPC Twojej organizacji, pomagajc blokowa pr贸by rozwizania zoliwych domen i egzekwowa polityki zabezpiecze dla ruchu DNS.
7. **Polityka zapory firm zewntrznych:** Ten rodzaj polityki stosuje ochrony z zap贸r firm zewntrznych, kt贸re s dostpne na subskrypcj za porednictwem konsoli AWS Marketplace. Pozwala to na integracj dodatkowych rodk贸w bezpieczestwa od zaufanych dostawc贸w w Twoje rodowisko AWS.
1. **Polityka Palo Alto Networks Cloud NGFW:** Ta polityka stosuje ochrony Palo Alto Networks Cloud Next Generation Firewall (NGFW) i stosy regu do VPC Twojej organizacji, zapewniajc zaawansowan ochron przed zagro偶eniami i kontrol bezpieczestwa na poziomie aplikacji.
2. **Polityka Fortigate Cloud Native Firewall (CNF) as a Service:** Ta polityka stosuje ochrony Fortigate Cloud Native Firewall (CNF) as a Service, oferujc wiodc w bran偶y ochron przed zagro偶eniami, zap贸r aplikacji internetowych (WAF) i ochron interfejsu API dostosowan do infrastruktur chmurowych.
### Konta administrator贸w

AWS Firewall Manager oferuje elastyczno w zarzdzaniu zasobami zapory ogniowej w Twojej organizacji poprzez swoje zakresy administracyjne i dwa rodzaje kont administrator贸w.

**Zakres administracyjny definiuje zasoby, kt贸rymi mo偶e zarzdza administrator Firewall Managera**. Po tym, jak konto zarzdzajce organizacj AWS Organizations doczy organizacj do Firewall Managera, mo偶e ono utworzy dodatkowych administrator贸w o r贸偶nych zakresach administracyjnych. Te zakresy mog obejmowa:

- Konta lub jednostki organizacyjne (OUs), do kt贸rych administrator mo偶e stosowa zasady.
- Regiony, w kt贸rych administrator mo偶e wykonywa dziaania.
- Typy zasad Firewall Managera, kt贸rymi administrator mo偶e zarzdza.

Zakres administracyjny mo偶e by albo **peny, albo ograniczony**. Peny zakres przyznaje administratorowi dostp do **wszystkich okrelonych typ贸w zasob贸w, region贸w i typ贸w zasad**. W przeciwiestwie do tego, **ograniczony zakres zapewnia uprawnienia administracyjne tylko do podzbioru zasob贸w, region贸w lub typ贸w zasad**. Zaleca si przyznawanie administratorom tylko tych uprawnie, kt贸rych potrzebuj do skutecznego wykonywania swoich r贸l. Mo偶na zastosowa dowoln kombinacj tych warunk贸w zakresu administracyjnego do administratora, zapewniajc przestrzeganie zasady najmniejszych uprawnie.

Istniej dwa r贸偶ne rodzaje kont administrator贸w, z kt贸rych ka偶de peni okrelone role i odpowiedzialnoci:

- **Domylny administrator:**
- Domylne konto administratora jest tworzone przez konto zarzdzajce organizacj AWS Organizations podczas procesu doczania do Firewall Managera.
- To konto ma zdolno do zarzdzania zaporami innych firm i posiada peny zakres administracyjny.
- Su偶y jako g贸wne konto administratora dla Firewall Managera, odpowiedzialne za konfigurowanie i egzekwowanie zasad bezpieczestwa w caej organizacji.
- Podczas gdy domylny administrator ma peny dostp do wszystkich typ贸w zasob贸w i funkcji administracyjnych, dziaa na tym samym poziomie r贸wieniczym co inni administratorzy, jeli w organizacji jest wykorzystywanych kilku administrator贸w.
- **Administratorzy Firewall Managera:**
- Ci administratorzy mog zarzdza zasobami w zakresie okrelonym przez konto zarzdzajce organizacj AWS Organizations, zdefiniowanym przez konfiguracj zakresu administracyjnego.
- Administratorzy Firewall Managera s tworzeni, aby spenia okrelone role w organizacji, umo偶liwiajc delegowanie odpowiedzialnoci przy jednoczesnym zachowaniu standard贸w bezpieczestwa i zgodnoci.
- Po utworzeniu Firewall Manager sprawdza z AWS Organizations, czy konto jest ju偶 delegowanym administratorem. Jeli nie, Firewall Manager wywouje Organizations, aby wskaza konto jako delegowanego administratora dla Firewall Managera.

Zarzdzanie tymi kontami administrator贸w polega na ich tworzeniu w Firewall Managerze i definiowaniu ich zakres贸w administracyjnych zgodnie z wymaganiami bezpieczestwa organizacji i zasad najmniejszych uprawnie. Przypisujc odpowiednie role administracyjne, organizacje mog zapewni skuteczne zarzdzanie bezpieczestwem, jednoczenie zachowujc szczeg贸ow kontrol nad dostpem do wra偶liwych zasob贸w.

Warto podkreli, 偶e **tylko jedno konto w organizacji mo偶e peni rol domylnego administratora Firewall Managera**, przestrzegajc zasady "**pierwszy wchodzi, ostatni wychodzi**". Aby wskaza nowego domylnego administratora, nale偶y przej przez seri krok贸w:

- Po pierwsze, ka偶de konto administratora Firewall musi wycofa swoje wasne konto.
- Nastpnie istniejcy domylny administrator mo偶e wycofa swoje wasne konto, efektywnie wyczajc organizacj z Firewall Managera. Ten proces skutkuje usuniciem wszystkich zasad Firewall Managera utworzonych przez wycofane konto.
- Na zakoczenie konto zarzdzajce organizacj AWS Organizations musi wskaza domylnego administratora Firewall Managera. 

## Wyliczanie
```
# Users/Administrators

## Get the AWS Organizations account that is associated with AWS Firewall Manager as the AWS Firewall Manager default administrator
aws fms get-admin-account

## List of Firewall Manager administrators within the organization
aws fms list-admin-accounts-for-organization # ReadOnlyAccess policy is not enough for this

## Return a list of the member accounts in the FM administrator's AWS organization
aws fms list-member-accounts # Only a Firewall Manager administrator or the Organization's management account can make this request

## List the accounts that are managing the specified AWS Organizations member account
aws fms list-admins-managing-account # ReadOnlyAccess policy is not enough for this

# Resources

## Get the resources that a Firewall Manager administrator can manage
aws fms get-admin-scope --admin-account <value> # ReadOnlyAccess policy is not enough for this

## Returns the summary of the resource sets used
aws fms list-resource-sets # ReadOnlyAccess policy is not enough for this

## Get information about a specific resource set
aws fms get-resource-set --identifier <value>  # ReadOnlyAccess policy is not enough for this

## Retrieve the list of tags for a given resource
aws fms list-tags-for-resource --resource-arn <value>

## List of the resources in the AWS Organization's accounts that are available to be associated with a FM resource set. Only one account is supported per request.
aws fms list-compliance-status --member-account-ids <value> --resource-type <value> # ReadOnlyAccess policy is not enough for this

## List the resources that are currently associated to a resource set
aws fms list-resource-set-resources --identifier <value> # ReadOnlyAccess policy is not enough for this

# Policies

## Returns the list of policies
aws fms list-policies

## Get information about the specified AWS Firewall Manager policy
aws fms get-policy --policy-id <value>

## List all of the third-party firewall policies that are associated with the third-party firewall administrator's account
aws fms list-third-party-firewall-firewall-policies --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

# AppsList

## Return a list of apps list
aws fms list-apps-lists --max-results [1-100]

## Get information about the specified AWS Firewall Manager applications list
aws fms get-apps-list --list-id <value>

# Protocols

## Get the details of the Firewall Manager protocols list.
aws fms list-protocols-lists

## Get information about the specified AWS Firewall Manager Protocols list
aws fms get-protocols-list --list-id <value>

# Compliance

## Return a summary of which member accounts are protected by the specified policy
aws fms list-compliance-status --policy-id <policy-id>

## Get detailed compliance information about the specified member account (resources that are in and out of compliance with the specified policy)
aws fms get-compliance-detail --policy-id <value> --member-account <value>

# Other useful info

## Get information about the SNS topic that is used to record AWS Firewall Manager SNS logs (if any)
aws fms get-notification-channel

## Get policy-level attack summary information in the event of a potential DDoS attack
aws fms get-protection-status --policy-id <value> # Just for Shield Advanced policy

## Get the onboarding status of a Firewall Manager admin account to third-party firewall vendor tenant.
aws fms get-third-party-firewall-association-status --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

## Get violations' details for a resource based on the specified AWS Firewall Manager policy and AWS account.
aws fms get-violation-details --policy-id <value> --member-account <value> --resource-id <value> --resource-type <value>
```
## Post Eksploatacja / Ominicie Wykrywania

### `organizations:DescribeOrganization` & (`fms:AssociateAdminAccount`, `fms:DisassociateAdminAccount`, `fms:PutAdminAccount`)
Atakujcy posiadajcy uprawnienia **`fms:AssociateAdminAccount`** bdzie m贸g ustawi domylne konto administratora Firewall Manager. Dziki uprawnieniom **`fms:PutAdminAccount`** atakujcy bdzie m贸g utworzy lub zaktualizowa konto administratora Firewall Manager, a dziki uprawnieniom **`fms:DisassociateAdminAccount`** potencjalny atakujcy m贸gby usun powizanie bie偶cego konta administratora Firewall Manager.

- Rozwizanie domylnego administratora **Firewall Manager** podlega zasadzie "pierwszy wchodzi, ostatni wychodzi". Wszyscy administratorzy **Firewall Manager** musz zosta rozwizani przed tym, jak domylny administrator **Firewall Manager** mo偶e rozwiza konto.
- Aby utworzy konto administratora **Firewall Manager** za pomoc **PutAdminAccount**, konto musi nale偶e do organizacji, kt贸ra zostaa wczeniej doczona do **Firewall Manager** za pomoc **AssociateAdminAccount**.
- Utworzenie konta administratora **Firewall Manager** mo偶e by dokonane tylko przez konto zarzdzajce organizacj.
```bash
aws fms associate-admin-account --admin-account <value>
aws fms disassociate-admin-account
aws fms put-admin-account --admin-account <value>
```
**Potencjalne skutki:** Utrata scentralizowanego zarzdzania, unikanie zasad, naruszenia zgodnoci oraz zak贸cenie kontroli bezpieczestwa w rodowisku.

### `fms:PutPolicy`, `fms:DeletePolicy`

Atakujcy posiadajcy uprawnienia **`fms:PutPolicy`**, **`fms:DeletePolicy`** bdzie m贸g tworzy, modyfikowa lub trwale usuwa polityk AWS Firewall Manager.
```bash
aws fms put-policy --policy <value> | --cli-input-json file://<policy.json> [--tag-list <value>]
aws fms delete-policy --policy-id <value> [--delete-all-policy-resources | --no-delete-all-policy-resources]
```
Przykad polityki permisywnej poprzez grup zezwalajc, w celu obejcia detekcji, m贸gby by nastpujcy:
```json
{
"Policy": {
"PolicyName": "permisive_policy",
"SecurityServicePolicyData": {
"Type": "SECURITY_GROUPS_COMMON",
"ManagedServiceData": "{\"type\":\"SECURITY_GROUPS_COMMON\",\"securityGroups\":[{\"id\":\"<permisive_security_group_id>\"}], \"applyToAllEC2InstanceENIs\":\"true\",\"IncludeSharedVPC\":\"true\"}"
},
"ResourceTypeList": ["AWS::EC2::Instance", "AWS::EC2::NetworkInterface", "AWS::EC2::SecurityGroup", "AWS::ElasticLoadBalancingV2::LoadBalancer", "AWS::ElasticLoadBalancing::LoadBalancer"],
"ResourceType": "AWS::EC2::SecurityGroup",
"ExcludeResourceTags": false,
"ResourceTags": [],
"RemediationEnabled": true
},
"TagList": []
}
```
**Potencjalne skutki:** Demonta偶 kontroli bezpieczestwa, unikanie zasad, naruszenia zgodnoci, zak贸cenia operacyjne oraz potencjalne naruszenia danych w rodowisku.

### `fms:BatchAssociateResource`, `fms:BatchDisassociateResource`, `fms:PutResourceSet`, `fms:DeleteResourceSet`

Atakujcy posiadajcy uprawnienia **`fms:BatchAssociateResource`** i **`fms:BatchDisassociateResource`** bdzie m贸g odpowiednio czy lub rozcza zasoby z zestawu zasob贸w Firewall Manager. Ponadto uprawnienia **`fms:PutResourceSet`** i **`fms:DeleteResourceSet`** pozwol atakujcemu tworzy, modyfikowa lub usuwa te zestawy zasob贸w z AWS Firewall Manager.
```bash
# Associate/Disassociate resources from a resource set
aws fms batch-associate-resource --resource-set-identifier <value> --items <value>
aws fms batch-disassociate-resource --resource-set-identifier <value> --items <value>

# Create, modify or delete a resource set
aws fms put-resource-set --resource-set <value> [--tag-list <value>]
aws fms delete-resource-set --identifier <value>
```
**Potencjalne skutki:** Dodanie zbdnego zestawu element贸w do zbioru zasob贸w zwikszy poziom haasu w Usudze, potencjalnie powodujc DoS. Ponadto zmiany w zestawach zasob贸w mog prowadzi do zak贸ce zasob贸w, unikania polityki, narusze zgodnoci oraz zak贸ce w kontrolach bezpieczestwa w rodowisku.

### `fms:PutAppsList`, `fms:DeleteAppsList`

Atakujcy posiadajcy uprawnienia **`fms:PutAppsList`** i **`fms:DeleteAppsList`** bdzie m贸g tworzy, modyfikowa lub usuwa listy aplikacji z AWS Firewall Manager. Mo偶e to by krytyczne, poniewa偶 nieautoryzowanym aplikacjom mo偶e by udzielony dostp do og贸u publicznego, lub dostp do autoryzowanych aplikacji mo偶e zosta zablokowany, powodujc DoS.
```bash
aws fms put-apps-list --apps-list <value> [--tag-list <value>]
aws fms delete-apps-list --list-id <value>
```
**Potencjalne skutki:** To mo偶e skutkowa bdnymi konfiguracjami, unikaniem zasad, naruszeniami zgodnoci i zak贸ceniem kontroli bezpieczestwa w rodowisku.

### `fms:PutProtocolsList`, `fms:DeleteProtocolsList`

Atakujcy posiadajcy uprawnienia **`fms:PutProtocolsList`** i **`fms:DeleteProtocolsList`** bdzie m贸g tworzy, modyfikowa lub usuwa listy protoko贸w z AWS Firewall Manager. Podobnie jak w przypadku list aplikacji, mo偶e to by krytyczne, poniewa偶 nieautoryzowane protokoy mog by u偶ywane przez og贸 u偶ytkownik贸w, lub u偶ycie autoryzowanych protoko贸w mo偶e zosta zablokowane, co prowadzi do ataku typu DoS.
```bash
aws fms put-protocols-list --apps-list <value> [--tag-list <value>]
aws fms delete-protocols-list --list-id <value>
```
**Potencjalne skutki:** Mo偶e to skutkowa bdnymi konfiguracjami, unikaniem zasad, naruszeniami zgodnoci oraz zak贸ceniem kontroli bezpieczestwa w rodowisku.

### `fms:PutNotificationChannel`, `fms:DeleteNotificationChannel`

Atakujcy posiadajcy uprawnienia **`fms:PutNotificationChannel`** oraz **`fms:DeleteNotificationChannel`** m贸gby usun i wyznaczy rol IAM oraz temat Amazon Simple Notification Service (SNS), kt贸ry Firewall Manager u偶ywa do rejestrowania log贸w SNS.

Aby u偶y **`fms:PutNotificationChannel`** poza konsol, nale偶y skonfigurowa polis dostpu do tematu SNS, pozwalajc okrelonej nazwie **SnsRoleName** na publikowanie log贸w SNS. Jeli podana nazwa **SnsRoleName** jest rol inn ni偶 **`AWSServiceRoleForFMS`**, wymagane jest skonfigurowanie relacji zaufania umo偶liwiajcej usudze Firewall Manager na przejcie tej roli.

Aby uzyska informacje na temat konfigurowania polisy dostpu do SNS:

{% content-ref url="../aws-services/aws-sns-enum.md" %}
[aws-sns-enum.md](../aws-services/aws-sns-enum.md)
{% endcontent-ref %}
```bash
aws fms put-notification-channel --sns-topic-arn <value> --sns-role-name <value>
aws fms delete-notification-channel
```
**Potencjalne skutki:** To potencjalnie mogoby prowadzi do pominicia alert贸w bezpieczestwa, op贸藕nionej reakcji na incydent, potencjalnych wyciek贸w danych i zak贸ce operacyjnych w rodowisku.

### `fms:AssociateThirdPartyFirewall`, `fms:DisssociateThirdPartyFirewall`
Atakujcy posiadajcy uprawnienia **`fms:AssociateThirdPartyFirewall`**, **`fms:DisssociateThirdPartyFirewall`** byby w stanie skojarzy lub rozczy zapory sieciowe innych dostawc贸w z zarzdzaniem centralnym za porednictwem AWS Firewall Manager.
{% hint style="warning" %}
Tylko domylny administrator mo偶e tworzy i zarzdza zaporami sieciowymi innych dostawc贸w.
{% endhint %}
```bash
aws fms associate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
aws fms disassociate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
```
**Potencjalny wpyw:** Rozczenie spowodowaoby unikanie zasad, naruszenia zgodnoci oraz zak贸cenia kontroli bezpieczestwa w rodowisku. Z kolei poczenie doprowadzioby do zak贸cenia alokacji koszt贸w i bud偶etu.

### `fms:TagResource`, `fms:UntagResource`

Atakujcy byby w stanie doda, zmodyfikowa lub usun tagi z zasob贸w Firewall Manager, zak贸cajc alokacj koszt贸w, ledzenie zasob贸w oraz polityki kontroli dostpu opartej na tagach.
```bash
aws fms tag-resource --resource-arn <value> --tag-list <value>
aws fms untag-resource --resource-arn <value> --tag-keys <value>
```
**Potencjalny wpyw**: Zak贸cenie alokacji koszt贸w, ledzenia zasob贸w oraz polityk kontroli dostpu opartych na tagach.

## Odnoniki

* [https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html](https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsfirewallmanager.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsfirewallmanager.html)
* [https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html](https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html)

<details>

<summary><strong>Zdobd藕 wiedz na temat hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
