# AWS - Macie Enum

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

# Macie

Amazon Macie wyr贸偶nia si jako usuga zaprojektowana do **automatycznego wykrywania, klasyfikowania i identyfikowania danych** w ramach konta AWS. Wykorzystuje **uczenie maszynowe** do cigego monitorowania i analizowania danych, g贸wnie skupiajc si na wykrywaniu i ostrzeganiu przed nietypowymi lub podejrzanymi dziaaniami poprzez analiz danych zdarze cie偶ki w chmurze i wzorc贸w zachowa u偶ytkownik贸w.

G贸wne cechy Amazon Macie:

1. **Aktywne przegldanie danych**: Wykorzystuje uczenie maszynowe do aktywnego przegldania danych w miar r贸偶nych dziaa w ramach konta AWS.
2. **Wykrywanie anomalii**: Identyfikuje nieregularne dziaania lub wzorce dostpu, generujc alerty w celu ograniczenia potencjalnych ryzyk zwizanych z ujawnieniem danych.
3. **Cige monitorowanie**: Automatycznie monitoruje i wykrywa nowe dane w Amazon S3, wykorzystujc uczenie maszynowe i sztuczn inteligencj do dostosowywania si do wzorc贸w dostpu do danych w czasie.
4. **Klasyfikacja danych za pomoc NLP**: Wykorzystuje przetwarzanie jzyka naturalnego (NLP) do klasyfikacji i interpretacji r贸偶nych typ贸w danych, przypisujc im oceny ryzyka w celu priorytetyzacji wynik贸w.
5. **Monitorowanie bezpieczestwa**: Identyfikuje dane wra偶liwe z punktu widzenia bezpieczestwa, takie jak klucze API, klucze prywatne i dane osobowe, pomagajc zapobiega wyciekom danych.

Amazon Macie to **usuga regionalna** i wymaga roli IAM 'AWSMacieServiceCustomerSetupRole' oraz wczonego AWS CloudTrail dla funkcjonalnoci.

## System alert贸w

Macie kategoryzuje alerty na predefiniowane kategorie, takie jak:

- Anonimowy dostp
- Zgodno danych
- Utrata powiadcze
- Eskalacja uprawnie
- Ransomware
- Podejrzany dostp itp.

Te alerty zawieraj szczeg贸owe opisy i podziay wynik贸w w celu skutecznej reakcji i rozwizania.

## Funkcje pulpitu

Pulpit kategoryzuje dane na r贸偶ne sekcje, w tym:

- Obiekty S3 (wedug zakresu czasu, ACL, PII)
- Wydarzenia/u偶ytkownicy CloudTrail o wysokim ryzyku
- Lokalizacje aktywnoci
- Typy to偶samoci u偶ytkownik贸w CloudTrail i wiele innych.

## Kategoryzacja u偶ytkownik贸w

U偶ytkownicy s klasyfikowani na poziomy ryzyka ich wywoa interfejsu API:

- **Platyna**: Wywoania interfejsu API o wysokim ryzyku, czsto z uprawnieniami administratora.
- **Zoto**: Wywoania interfejsu API zwizane z infrastruktur.
- **Srebro**: Wywoania interfejsu API o rednim ryzyku.
- **Brz**: Wywoania interfejsu API o niskim ryzyku.

## Typy to偶samoci

Typy to偶samoci obejmuj Root, u偶ytkownik IAM, Assumed Role, Federated User, AWS Account i AWS Service, wskazujc 藕r贸do 偶da.

## Klasyfikacja danych

Klasyfikacja danych obejmuje:

- Typ zawartoci: Na podstawie wykrytego typu zawartoci.
- Rozszerzenie pliku: Na podstawie rozszerzenia pliku.
- Temat: Kategoryzowane na podstawie s贸w kluczowych w plikach.
- Wyra偶enie regularne: Kategoryzowane na podstawie okrelonych wzorc贸w wyra偶e regularnych.

Najwy偶sze ryzyko spor贸d tych kategorii okrela ostateczny poziom ryzyka pliku.

## Badania i analiza

Funkcja badawcza Amazon Macie umo偶liwia tworzenie niestandardowych zapyta dotyczcych wszystkich danych Macie w celu przeprowadzenia dogbnej analizy. Filtry obejmuj dane CloudTrail, waciwoci kubeka S3 i obiekty S3. Ponadto, obsuguje zapraszanie innych kont do udostpniania Amazon Macie, uatwiajc wsp贸prac w zakresie zarzdzania danymi i monitorowania bezpieczestwa.


## Wyliczenie
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Eksploatacja

{% hint style="success" %}
Z perspektywy atakujcego, ta usuga nie su偶y do wykrywania atakujcego, ale do wykrywania wra偶liwych informacji w przechowywanych plikach. Dlatego ta usuga mo偶e **pom贸c atakujcemu w znalezieniu wra偶liwych informacji** wewntrz kubek贸w.\
Jednak atakujcy mo偶e r贸wnie偶 by zainteresowany zak贸ceniem jej dziaania w celu uniemo偶liwienia ofierze otrzymywania alert贸w i atwiejszego kradzie偶y tych informacji.
{% endhint %}

TODO: PRy s mile widziane!

# Referencje
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
