# AWS - GuardDuty Enum

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* If you want to see your **company advertised in HackTricks** or if you want access to the **latest version of the PEASS or download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## GuardDuty

According to the [**docs**](https://aws.amazon.com/guardduty/features/): GuardDuty combines **machine learning, anomaly detection, network monitoring, and malicious file discovery**, using both AWS and industry-leading third-party sources to help protect workloads and data on AWS. GuardDuty is capable of analyzing tens of billions of events across multiple AWS data sources, such as AWS CloudTrail event logs, Amazon Virtual Private Cloud (VPC) Flow Logs, Amazon Elastic Kubernetes Service (EKS) audit and system-level logs, and DNS query logs.

Amazon GuardDuty **identifies unusual activity within your accounts**, analyzes the **security relevanc**e of the activity, and gives the **context** in which it was invoked. This allows a responder to determine if they should spend time on further investigation.

Alerts **appear in the GuardDuty console (90 days)** and CloudWatch Events.

{% hint style="warning" %}
When a user **disable GuardDuty**, it will stop monitoring your AWS environment and it won't generate any new findings at all, and the **existing findings will be lost**.\
If you just stop it, the existing findings will remain.
{% endhint %}

### Findings Example

* **Reconnaissance**: Activity suggesting reconnaissance by an attacker, such as **unusual API activity**, suspicious database **login** attempts, intra-VPC **port scanning**, unusual failed login request patterns, or unblocked port probing from a known bad IP.
* **Instance compromise**: Activity indicating an instance compromise, such as **cryptocurrency mining, backdoor command and control (C\&C)** activity, malware using domain generation algorithms (DGA), outbound denial of service activity, unusually **high network** traffic volume, unusual network protocols, outbound instance communication with a known malicious IP, temporary Amazon EC2 credentials used by an external IP address, and data exfiltration using DNS.
* **Account compromise**: Common patterns indicative of account compromise include API calls from an unusual geolocation or anonymizing proxy, attempts to disable AWS CloudTrail logging, changes that weaken the account password policy, unusual instance or infrastructure launches, infrastructure deployments in an unusual region, credential theft, suspicious database login activity, and API calls from known malicious IP addresses.
* **Bucket compromise**: Activity indicating a bucket compromise, such as suspicious data access patterns indicating credential misuse, unusual Amazon S3 API activity from a remote host, unauthorized S3 access from known malicious IP addresses, and API calls to retrieve data in S3 buckets from a user with no prior history of accessing the bucket or invoked from an unusual location. Amazon GuardDuty continuously monitors and analyzes AWS CloudTrail S3 data events (e.g. GetObject, ListObjects, DeleteObject) to detect suspicious activity across all of your Amazon S3 buckets.

<details>

<summary>Finding Information</summary>

Finding summary:

* Finding type
* Severity: 7-8.9 High, 4-6.9 Medium, 01-3.9 Low
* Region
* Account ID
* Resource ID
* Time of detection
* Which threat list was used

The body has this information:

* Resource affected
* Action
* Actor: Ip address, port and domain
* Additional Information

</details>

### All Findings

Access a list of all the GuardDuty findings in: [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)

### Multi Accounts

#### By Invitation

You can **invite other accounts** to a different AWS GuardDuty account so **every account is monitored from the same GuardDuty**. The master account must invite the member accounts and then the representative of the member account must accept the invitation.

#### Via Organization

You can designate any account within the organization to be the **GuardDuty delegated administrator**. Only the organization management account can designate a delegated administrator.

An account that gets designated as a delegated administrator becomes a GuardDuty administrator account, has GuardDuty enabled automatically in the designated AWS Region, and also has the **permission to enable and manage GuardDuty for all of the accounts in the organization within that Region**. The other accounts in the organization can be viewed and added as GuardDuty member accounts associated with this delegated administrator account.

## Enumeration

{% code overflow="wrap" %}
```bash
# Get Org config
aws guardduty list-organization-admin-accounts #Get Delegated Administrator
aws guardduty describe-organization-configuration --detector-id <id>

# Check external invitations
aws guardduty list-invitations
aws guardduty get-invitations-count

# Detector Information
aws guardduty list-detectors # 1 detector per account with GuardDuty
aws guardduty get-detector --detector-id <id> # Get detector info
aws guardduty get-master-account --detector-id <id>

# Get filters
aws guardduty list-filters --detector-id <id> # Check filters
aws guardduty get-filter --detector-id <id> --filter-name <name>

# Findings
aws guardduty list-findings --detector-id <id> # List findings
aws guardduty get-findings --detector-id <id> --finding-ids <id> # Get details about the finding
aws guardduty get-findings-statistics --detector-id <id> --finding-statistic-types <types>

# Get trusted IP addresses
aws guardduty list-ip-sets --detector-id <id>
aws guardduty get-ip-set --detector-id <id>

# Member accounts of the current AWS GuardDuty master account
aws guardduty list-members --detector-id <id>
aws guardduty get-members --detector-id <id> --account-ids <id>
aws guardduty get-member-detectors --detector-id <id> --account-ids <id>

# Continuously export its findings to an Amazon S3 bucket
aws guardduty list-publishing-destinations --detector-id <id>

# Intelligence sets that you have uploaded to GuardDuty
aws guardduty list-threat-intel-sets --detector-id <id>
aws guardduty get-threat-intel-set --detector-id <id> --threat-intel-set-id <id>
```
{% endcode %}

## GuardDutyãƒã‚¤ãƒ‘ã‚¹

### ä¸€èˆ¬çš„ãªã‚¬ã‚¤ãƒ€ãƒ³ã‚¹

ä½¿ç”¨ã™ã‚‹è³‡æ ¼æƒ…å ±ã®å‹•ä½œã«ã¤ã„ã¦ã§ãã‚‹ã ã‘å¤šãã®æƒ…å ±ã‚’æŠŠæ¡ã—ã¾ã—ã‚‡ã†ï¼š

* ä½¿ç”¨ã•ã‚Œã‚‹å›æ•°
* å ´æ‰€
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ/ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆawscliã€webconsoleã€lambdaãªã©ã‹ã‚‰ä½¿ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰
* å®šæœŸçš„ã«ä½¿ç”¨ã•ã‚Œã‚‹æ¨©é™

ã“ã®æƒ…å ±ã‚’å…ƒã«ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«å¯èƒ½ãªé™ã‚ŠåŒã˜ã‚·ãƒŠãƒªã‚ªã‚’å†ç¾ã—ã¦ãã ã•ã„ï¼š

* **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ­ãƒ¼ãƒ«**ã®å ´åˆã€åŒã˜æ™‚é–“å¸¯ã€åŒã˜åœ°ç†çš„ä½ç½®ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°åŒã˜ISPãŠã‚ˆã³IPï¼‰ã‹ã‚‰ä½¿ç”¨ã—ã¦ã¿ã¦ãã ã•ã„
* **ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã‚‹ãƒ­ãƒ¼ãƒ«**ã®å ´åˆã€åŒã˜ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§åŒã˜ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã—ã€åŒã˜æ™‚é–“å¸¯ã«ãã“ã‹ã‚‰ä½¿ç”¨ã—ã¦ãã ã•ã„
* å¸¸ã«ã“ã®ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒä½¿ç”¨ã—ãŸ**åŒã˜æ¨©é™**ã‚’ä½¿ç”¨ã—ã‚ˆã†ã¨ã—ã¦ãã ã•ã„
* ä»–ã®æ¨©é™ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã‚„æ¨©é™ã‚’æ‚ªç”¨ã™ã‚‹å ´åˆï¼ˆãŸã¨ãˆã°ã€100ä¸‡ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒˆãƒ¬ã‚¤ãƒ«ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆï¼‰ã¯ã€AWSã¨ã®**æœ€å°é™ã®ã‚„ã‚Šå–ã‚Š**ã§**ã‚†ã£ãã‚Šã¨**è¡Œã£ã¦ãã ã•ã„ï¼ˆawscliã¯æ›¸ãè¾¼ã¿APIã®å‰ã«è¤‡æ•°ã®èª­ã¿å–ã‚ŠAPIã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰

### GuardDutyã®å¤‰æ›´

#### `guardduty:ListDetectors`ã€`guardduty:UpdateDetector`

ã“ã‚Œã‚‰ã®æ¨©é™ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ©ãƒ¼ãƒˆã®ãƒˆãƒªã‚¬ãƒ¼ã‚’å›é¿ã™ã‚‹ãŸã‚ã«GuardDutyã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
# Disabling the detector
aws guardduty update-detector \
--detector-id <detector-id> \
--no-enable

# Removing s3 as a log source
aws guardduty update-detector \
--detector-id <detector-id> \
--data-sources S3Logs={Enable=false}

# Increase finding update time to 6 hours
aws guardduty update-detector \
--detector-id <detector-id> \
--finding-publishing-frequency SIX_HOURS
```
#### `guardduty:ListDetectors`, `guardduty:ListIPSet`, `iam:PutRolePolicy`, (`guardduty:CreateIPSet`|`guardduty:UpdateIPSet`)

æ”»æ’ƒè€…ã¯ã€GuardDutyã®[ä¿¡é ¼ã•ã‚ŒãŸIPãƒªã‚¹ãƒˆ](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html)ã‚’ä½œæˆã¾ãŸã¯æ›´æ–°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã®ä¸­ã«ã¯ã€**è‡ªåˆ†è‡ªèº«ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚å«ã¾ã‚Œã¾ã™**ã€‚ä¿¡é ¼ã•ã‚ŒãŸIPãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€Cloudtrailã‚„VPCãƒ•ãƒ­ãƒ¼ãƒ­ã‚°ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ã¾ã›ã‚“ã€‚

{% hint style="info" %}
DNSã®æ¤œå‡ºçµæœã¯ã€ä¿¡é ¼ã•ã‚ŒãŸIPãƒªã‚¹ãƒˆã®å¯¾è±¡å¤–ã§ã™ã€‚
{% endhint %}
```bash
aws guardduty update-ip-set \
--detector-id <detector-id> \
--ip-set-id 24adjigdk34290840348exampleiplist \
--location https://malicious-bucket.s3-us-east-1.amazonaws.com/customiplist.csv \
--activate
```
{% hint style="info" %}
å¿…è¦ãªã‚¹ãƒ†ãƒ«ã‚¹ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®s3ãƒã‚±ãƒƒãƒˆã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã‹ã€æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

#### `guardduty:CreateFilter`

æ–°ã—ãä½œæˆã•ã‚ŒãŸGuardDutyã®èª¿æŸ»çµæœã¯ã€[æŠ‘åˆ¶ãƒ«ãƒ¼ãƒ«](https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html)ã‚’ä»‹ã—ã¦è‡ªå‹•çš„ã«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€ç”Ÿæˆã•ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹èª¿æŸ»çµæœã‚’è‡ªå‹•çš„ã«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã™ã‚‹ãŸã‚ã«ã€[ãƒ•ã‚£ãƒ«ã‚¿](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_filter-findings.html)ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ•ã‚£ãƒ«ã‚¿ã¯ã€[CreateFilter API](https://docs.aws.amazon.com/guardduty/latest/APIReference/API\_CreateFilter.html)ã‚’ä½¿ç”¨ã—ã¦ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
aws guardduty create-filter \
--action ARCHIVE \
--detector-id <detector-id> \
--name yourfiltername \
--finding-criteria file://criteria.json
```
#### `guardduty:DeletePublishingDestination`

æ”»æ’ƒè€…ã¯ã€ã‚¢ãƒ©ãƒ¼ãƒˆã®å®›å…ˆã‚’[å‰Šé™¤ã™ã‚‹ã“ã¨](https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html)ã«ã‚ˆã£ã¦ã€ã‚¢ãƒ©ãƒ¼ãƒˆã®ç„¡åŠ¹åŒ–ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
aws guardduty delete-publishing-destination \
--detector-id <detector-id> \
--destination-id def456
```
{% hint style="danger" %}
ã“ã®å…¬é–‹å…ˆã‚’å‰Šé™¤ã—ã¦ã‚‚ã€GuardDutyã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…ã®èª¿æŸ»çµæœã®ç”Ÿæˆã‚„è¡¨ç¤ºã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ã€‚GuardDutyã¯å¼•ãç¶šãAWSç’°å¢ƒã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’åˆ†æã—ã€ä¸å¯©ã¾ãŸã¯äºˆæœŸã—ãªã„å‹•ä½œã‚’ç‰¹å®šã—ã€èª¿æŸ»çµæœã‚’ç”Ÿæˆã—ã¾ã™ã€‚
{% endhint %}

### ç‰¹å®šã®èª¿æŸ»çµæœã®å›é¿

#### ãƒšãƒ³ãƒ†ã‚¹ãƒˆã®èª¿æŸ»çµæœ

OSã®GuardDutyã¯ã€ä¸€èˆ¬çš„ãªãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã‹ã‚‰ã®AWS APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œå‡ºã—ã€[ãƒšãƒ³ãƒ†ã‚¹ãƒˆã®èª¿æŸ»çµæœ](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux)ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚\
APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æ¸¡ã•ã‚Œã‚‹**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå**ã«ã‚ˆã£ã¦æ¤œå‡ºã•ã‚Œã¾ã™ã€‚\
ã—ãŸãŒã£ã¦ã€æ”»æ’ƒã‚’æ¤œå‡ºã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã«ã¯ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¤‰æ›´**ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

Ubuntuã€Macã€ã¾ãŸã¯Windowsãªã©ã®OSã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œãªããªã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’é˜²ããŸã‚ã«ã¯ã€`botocore`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®`session.py`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ¤œç´¢ã—ã¾ã™ã€‚Kali Linuxã§ã¯ã€`/usr/local/lib/python3.7/dist-packages/botocore/session.py`ã«ã‚ã‚Šã¾ã™ã€‚

[456è¡Œç›®](https://github.com/boto/botocore/blob/7de36c07ecec503f588ac27658b1795e83b67b75/botocore/session.py#L456)ä»˜è¿‘ã«`platform.system()`ã¨`platform.release()`ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚’ã€[**Pacu**](https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/user\_agents.txt)ã«ã‚ã‚‹ã‚ˆã†ãª**æ­£å½“ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ–‡å­—åˆ—ã§ç½®ãæ›ãˆ**ã¾ã™ã€‚

#### Torã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®èª¿æŸ»çµæœ

{% hint style="success" %}
ã“ã‚Œã‚’å›é¿ã™ã‚‹æœ€ã‚‚ç°¡å˜ãªæ–¹æ³•ã¯ã€AWSã¸ã®æ¥ç¶šã«**Torã‚’ä½¿ç”¨ã—ãªã„ã“ã¨ã§ã™**ï¼ˆã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ãŒä¾µå®³ã•ã‚ŒãŸã‚·ãƒŠãƒªã‚ªã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã€ã‚¹ãƒ†ãƒ«ã‚¹æ€§ã‚’ä¿ã¡ãŸã„å ´åˆã€ãªãœTorã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿï¼‰
{% endhint %}

**Tor**ã‹ã‚‰æ¥ç¶šã™ã‚‹ã¨ã€**Guarduty**ã¯ã‚¢ãƒ©ãƒ¼ãƒˆ[**UnauthorizedAccess:EC2/TorClient**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient)**ã‚’è¨­å®šã—ã¾ã™**ã€‚

Guardutyã¯ã€[Torãƒãƒ¼ãƒ‰ã®å…¬é–‹ãƒªã‚¹ãƒˆ](https://metrics.torproject.org/exonerator.html)ã«ã‚ˆã£ã¦ã“ã‚Œã‚’æ¤œå‡ºã—ã¾ã™ã€‚

Torã‚’ä»‹ã—ã¦æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€[**Bridges**](https://community.torproject.org/relay/types-of-relays/#Bridge)ã‚’ä½¿ç”¨ã—ã¦ã“ã‚Œã‚’å›é¿ã§ãã¾ã™ã€‚ãŸã ã—ã€æ¥ç¶šã«Torã‚’ä½¿ç”¨ã—ãªã„æ–¹ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

ãƒ–ãƒªãƒƒã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€[Obfs4](https://gitlab.com/yawning/obfs4) (`apt install tor obfs4proxy`)ã‚’ä½¿ç”¨ã—ã€[bridges.torproject.org](https://bridges.torproject.org/options)ã‹ã‚‰ãƒ–ãƒªãƒƒã‚¸ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã—ã¾ã™ã€‚

ã“ã“ã‹ã‚‰ã€æ¬¡ã®ã‚ˆã†ãªå†…å®¹ã®`torrc`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼š
```
UseBridges 1
Bridge obfs4 <IP ADDRESS>:<PORT> <FINGERPRINT> cert=<cert_string> iat-mode=0
ClientTransportPlugin obfs4 exec /bin/obfs4proxy
```
`tor -f torrc`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒãƒ¼ãƒˆ9050ã§é€šå¸¸ã®socks5ãƒ—ãƒ­ã‚­ã‚·ã«æ¥ç¶šã§ãã¾ã™ã€‚

#### è³‡æ ¼æƒ…å ±ã®æµå‡ºæ¤œçŸ¥

ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰EC2ã®è³‡æ ¼æƒ…å ±ã‚’**ç›—ã¿å‡ºã—**ã€ãã‚Œã‚’**AWSã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®å¤–éƒ¨ã§ä½¿ç”¨**ã™ã‚‹ã¨ã€ã‚¢ãƒ©ãƒ¼ãƒˆ[UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.OutsideAWS](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws)ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚

ã•ã‚‰ã«ã€**è‡ªåˆ†è‡ªèº«ã®EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**ã‚’ä½¿ç”¨ã—ã¦**ç›—ã¾ã‚ŒãŸè³‡æ ¼æƒ…å ±**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ©ãƒ¼ãƒˆ[UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.InsideAWS](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws)ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚

ãŸã ã—ã€ç¾åœ¨ã€ã“ã‚Œã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ - [VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ](https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints.html)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚**VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€GuardDutyã®ã‚¢ãƒ©ãƒ¼ãƒˆã¯**ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã›ã‚“**ã€‚ã¤ã¾ã‚Šã€æ”»æ’ƒè€…ã¨ã—ã¦ã¯ã€ã€ŒEC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰IAMã®è³‡æ ¼æƒ…å ±ã‚’ç›—ã¿å‡ºã—ãŸå ´åˆã€VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä»‹ã—ã¦è‡ªåˆ†è‡ªèº«ã®EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ãã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€GuardDutyã®æ¤œå‡ºãŒè¡Œã‚ã‚Œã¾ã›ã‚“ã€‚ã€

ãƒ„ãƒ¼ãƒ«[**SneakyEndpoints**](https://github.com/Frichetten/SneakyEndpoints)ã¯ã€ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãŸã‚ã«ä½œæˆã•ã‚Œã¾ã—ãŸã€‚ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€Terraformã‚’ä½¿ç”¨ã—ã¦æ”»æ’ƒç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã®ãªã„ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã«EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€ä½¿ç”¨ã™ã‚‹ãŸã‚ã®è¤‡æ•°ã®VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹**åˆ¥ã®æ–¹æ³•**ã¯ã€ç›—ã¾ã‚ŒãŸè³‡æ ¼æƒ…å ±ã‚’**ç›—ã¾ã‚ŒãŸãƒã‚·ãƒ³ã¨åŒã˜ãƒã‚·ãƒ³**ã¾ãŸã¯**åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒã‚·ãƒ³**ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://hackingthe.cloud/aws/avoiding-detection/guardduty-pentest/](https://hackingthe.cloud/aws/avoiding-detection/guardduty-pentest/)
* [https://hackingthe.cloud/aws/avoiding-detection/guardduty-tor-client/](https://hackingthe.cloud/aws/avoiding-detection/guardduty-tor-client/)
* [https://hackingthe.cloud/aws/avoiding-detection/modify-guardduty-config/](https://hackingthe.cloud/aws/avoiding-detection/modify-guardduty-config/)
* [https://hackingthe.cloud/aws/avoiding-detection/steal-keys-undetected/](https://hackingthe.cloud/aws/avoiding-detection/steal-keys-undetected/)

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å—ã‘å–ã‚‹ï¼</strong></summary>

* **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„å ´åˆã‚„ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹**ã—ãŸã„å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¾ã—ã‚‡ã† ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **HackTricks**ã¨**HackTricks Cloud**ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¾ã—ã‚‡ã†ã€‚

</details>
