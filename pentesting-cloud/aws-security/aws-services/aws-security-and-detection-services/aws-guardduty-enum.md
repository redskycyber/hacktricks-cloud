# AWS - GuardDuty Enum

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šæ²è¼‰ã—ãŸã„å ´åˆ**ã‚„**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„å ´åˆ**ã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã€‚

</details>

## GuardDuty

[**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**](https://aws.amazon.com/guardduty/features/)ã«ã‚ˆã‚‹ã¨ï¼šGuardDutyã¯**æ©Ÿæ¢°å­¦ç¿’ã€ç•°å¸¸æ¤œçŸ¥ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–ã€ãŠã‚ˆã³æ‚ªæ„ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ç™ºè¦‹**ã‚’çµ„ã¿åˆã‚ã›ã€AWSãŠã‚ˆã³æ¥­ç•Œã‚’ãƒªãƒ¼ãƒ‰ã™ã‚‹ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®æƒ…å ±æºã‚’ä½¿ç”¨ã—ã¦ã€AWSä¸Šã®ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚GuardDutyã¯ã€AWS CloudTrailã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã€Amazon Virtual Private Cloud (VPC) Flow Logsã€Amazon Elastic Kubernetes Service (EKS)ç›£æŸ»ãŠã‚ˆã³ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«ã®ãƒ­ã‚°ã€DNSã‚¯ã‚¨ãƒªãƒ­ã‚°ãªã©ã€è¤‡æ•°ã®AWSãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã«ã‚ãŸã‚‹æ•°åå„„ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’åˆ†æã™ã‚‹èƒ½åŠ›ãŒã‚ã‚Šã¾ã™ã€‚

Amazon GuardDutyã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®**ç•°å¸¸ãªæ´»å‹•ã‚’ç‰¹å®š**ã—ã€æ´»å‹•ã®**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£æ€§**ã‚’åˆ†æã—ã€ãã‚ŒãŒå‘¼ã³å‡ºã•ã‚ŒãŸ**ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å¯¾å¿œè€…ã¯ã•ã‚‰ãªã‚‹èª¿æŸ»ã«æ™‚é–“ã‚’è²»ã‚„ã™ã¹ãã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã§ãã¾ã™ã€‚

ã‚¢ãƒ©ãƒ¼ãƒˆã¯**GuardDutyã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆ90æ—¥é–“ï¼‰**ã¨CloudWatchã‚¤ãƒ™ãƒ³ãƒˆã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

{% hint style="warning" %}
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**GuardDutyã‚’ç„¡åŠ¹ã«ã™ã‚‹**ã¨ã€AWSç’°å¢ƒã®ç›£è¦–ãŒåœæ­¢ã—ã€æ–°ã—ã„ç™ºè¦‹ã¯ä¸€åˆ‡ç”Ÿæˆã•ã‚Œãšã€**æ—¢å­˜ã®ç™ºè¦‹ã¯å¤±ã‚ã‚Œã¾ã™**ã€‚\
å˜ã«åœæ­¢ã—ãŸå ´åˆã¯ã€æ—¢å­˜ã®ç™ºè¦‹ã¯æ®‹ã‚Šã¾ã™ã€‚
{% endhint %}

### ç™ºè¦‹ã®ä¾‹

* **åµå¯Ÿ**: æ”»æ’ƒè€…ã«ã‚ˆã‚‹åµå¯Ÿã‚’ç¤ºå”†ã™ã‚‹æ´»å‹•ã€ä¾‹ãˆã°**ç•°å¸¸ãªAPIæ´»å‹•**ã€æ€ªã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®**ãƒ­ã‚°ã‚¤ãƒ³**è©¦è¡Œã€VPCå†…ã®**ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³**ã€é€šå¸¸ã¨ã¯ç•°ãªã‚‹ãƒ­ã‚°ã‚¤ãƒ³ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã¾ãŸã¯æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã‹ã‚‰ã®ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„ãƒãƒ¼ãƒˆãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°ã€‚
* **ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¾µå®³**: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¾µå®³ã‚’ç¤ºã™æ´»å‹•ã€ä¾‹ãˆã°**æš—å·é€šè²¨ã®ãƒã‚¤ãƒ‹ãƒ³ã‚°ã€ãƒãƒƒã‚¯ãƒ‰ã‚¢ã®ã‚³ãƒãƒ³ãƒ‰ã‚¢ãƒ³ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«(C&C)** æ´»å‹•ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ç”Ÿæˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ (DGA)ã‚’ä½¿ç”¨ã™ã‚‹ãƒãƒ«ã‚¦ã‚§ã‚¢ã€å¤–éƒ¨ã‹ã‚‰ã®ã‚µãƒ¼ãƒ“ã‚¹æ‹’å¦æ´»å‹•ã€é€šå¸¸ã¨ã¯ç•°ãªã‚‹**é«˜ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯é‡ã€ç•°å¸¸ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã¨ã®å¤–éƒ¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹é€šä¿¡ã€å¤–éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚ˆã‚‹ä¸€æ™‚çš„ãªAmazon EC2ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®ä½¿ç”¨ã€DNSã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿æ¼æ´©ã€‚
* **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¾µå®³**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¾µå®³ã‚’ç¤ºã™ä¸€èˆ¬çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¯ã€é€šå¸¸ã¨ã¯ç•°ãªã‚‹åœ°ç†çš„ä½ç½®ã‹ã‚‰ã®APIã‚³ãƒ¼ãƒ«ã‚„åŒ¿ååŒ–ãƒ—ãƒ­ã‚­ã‚·ã€AWS CloudTrailãƒ­ã‚°ã®ç„¡åŠ¹åŒ–ã®è©¦ã¿ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã‚’å¼±ã‚ã‚‹å¤‰æ›´ã€é€šå¸¸ã¨ã¯ç•°ãªã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚„ã‚¤ãƒ³ãƒ•ãƒ©ã®èµ·å‹•ã€é€šå¸¸ã¨ã¯ç•°ãªã‚‹åœ°åŸŸã§ã®ã‚¤ãƒ³ãƒ•ãƒ©ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®ç›—é›£ã€æ€ªã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ­ã‚°ã‚¤ãƒ³æ´»å‹•ã€æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®APIã‚³ãƒ¼ãƒ«ãŒå«ã¾ã‚Œã¾ã™ã€‚
* **ãƒã‚±ãƒƒãƒˆã®ä¾µå®³**: ãƒã‚±ãƒƒãƒˆã®ä¾µå®³ã‚’ç¤ºã™æ´»å‹•ã€ä¾‹ãˆã°ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã®ä¸æ­£ä½¿ç”¨ã‚’ç¤ºå”†ã™ã‚‹æ€ªã—ã„ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã‹ã‚‰ã®ç•°å¸¸ãªAmazon S3 APIæ´»å‹•ã€æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®è¨±å¯ã•ã‚Œã¦ã„ãªã„S3ã‚¢ã‚¯ã‚»ã‚¹ã€ãŠã‚ˆã³é€šå¸¸ã®å ´æ‰€ã‹ã‚‰ã®ãƒã‚±ãƒƒãƒˆã¸ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è©¦ã¿ã‚‹APIã‚³ãƒ¼ãƒ«ã€‚Amazon GuardDutyã¯ã€ã™ã¹ã¦ã®Amazon S3ãƒã‚±ãƒƒãƒˆã«ã‚ãŸã‚‹æ€ªã—ã„æ´»å‹•ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã«ã€AWS CloudTrail S3ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¾‹ï¼šGetObjectã€ListObjectsã€DeleteObjectï¼‰ã‚’ç¶™ç¶šçš„ã«ç›£è¦–ãŠã‚ˆã³åˆ†æã—ã¾ã™ã€‚

<details>

<summary>ç™ºè¦‹æƒ…å ±</summary>

ç™ºè¦‹ã®æ¦‚è¦:

* ç™ºè¦‹ã®ã‚¿ã‚¤ãƒ—
* é‡å¤§åº¦: 7-8.9 é«˜ã€4-6.9 ä¸­ã€01-3.9 ä½
* ãƒªãƒ¼ã‚¸ãƒ§ãƒ³
* ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID
* ãƒªã‚½ãƒ¼ã‚¹ID
* æ¤œå‡ºæ™‚åˆ»
* ä½¿ç”¨ã•ã‚ŒãŸè„…å¨ãƒªã‚¹ãƒˆ

æœ¬æ–‡ã«ã¯ä»¥ä¸‹ã®æƒ…å ±ãŒå«ã¾ã‚Œã¾ã™:

* å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒªã‚½ãƒ¼ã‚¹
* è¡Œå‹•
* ã‚¢ã‚¯ã‚¿ãƒ¼: IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒãƒ¼ãƒˆã€ãƒ‰ãƒ¡ã‚¤ãƒ³
* è¿½åŠ æƒ…å ±

</details>

### ã™ã¹ã¦ã®ç™ºè¦‹

ã™ã¹ã¦ã®GuardDutyç™ºè¦‹ã®ãƒªã‚¹ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯: [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)

### è¤‡æ•°ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

#### æ‹›å¾…ã«ã‚ˆã‚‹

ä»–ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç•°ãªã‚‹AWS GuardDutyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«**æ‹›å¾…**ã™ã‚‹ã“ã¨ãŒã§ãã€**ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒåŒã˜GuardDutyã‹ã‚‰ç›£è¦–ã•ã‚Œã¾ã™**ã€‚ãƒã‚¹ã‚¿ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«æ‹›å¾…ã‚’é€ã‚Šã€ãã®å¾Œãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä»£è¡¨è€…ãŒæ‹›å¾…ã‚’å—ã‘å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### çµ„ç¹”ã‚’é€šã˜ã¦

çµ„ç¹”å†…ã®ä»»æ„ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’**GuardDutyå§”ä»»ç®¡ç†è€…**ã«æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å§”ä»»ç®¡ç†è€…ã‚’æŒ‡å®šã§ãã‚‹ã®ã¯çµ„ç¹”ç®¡ç†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã¿ã§ã™ã€‚

å§”ä»»ç®¡ç†è€…ã¨ã—ã¦æŒ‡å®šã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯GuardDutyç®¡ç†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãªã‚Šã€æŒ‡å®šã•ã‚ŒãŸAWSãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§è‡ªå‹•çš„ã«GuardDutyãŒæœ‰åŠ¹ã«ãªã‚Šã€ãã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å†…ã®çµ„ç¹”ã®ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å¯¾ã—ã¦GuardDutyã‚’æœ‰åŠ¹ã«ã—ã¦ç®¡ç†ã™ã‚‹**æ¨©é™ã‚’æŒã¡ã¾ã™**ã€‚ä»–ã®çµ„ç¹”ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€ã“ã®å§”ä»»ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸGuardDutyãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã—ã¦è¡¨ç¤ºãŠã‚ˆã³è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## åˆ—æŒ™

{% code overflow="wrap" %}
```bash
# Get Org config
aws guardduty list-organization-admin-accounts #Get Delegated Administrator
aws guardduty describe-organization-configuration --detector-id <id>

# Check external invitations
aws guardduty list-invitations
aws guardduty get-invitations-count

# Detector Information
aws guardduty list-detectors # 1 detector per account with GuardDuty
aws guardduty get-detector --detector-id <id> # Get detector info
aws guardduty get-master-account --detector-id <id>

# Get filters
aws guardduty list-filters --detector-id <id> # Check filters
aws guardduty get-filter --detector-id <id> --filter-name <name>

# Findings
aws guardduty list-findings --detector-id <id> # List findings
aws guardduty get-findings --detector-id <id> --finding-ids <id> # Get details about the finding
aws guardduty get-findings-statistics --detector-id <id> --finding-statistic-types <types>

# Get trusted IP addresses
aws guardduty list-ip-sets --detector-id <id>
aws guardduty get-ip-set --detector-id <id>

# Member accounts of the current AWS GuardDuty master account
aws guardduty list-members --detector-id <id>
aws guardduty get-members --detector-id <id> --account-ids <id>
aws guardduty get-member-detectors --detector-id <id> --account-ids <id>

# Continuously export its findings to an Amazon S3 bucket
aws guardduty list-publishing-destinations --detector-id <id>

# Intelligence sets that you have uploaded to GuardDuty
aws guardduty list-threat-intel-sets --detector-id <id>
aws guardduty get-threat-intel-set --detector-id <id> --threat-intel-set-id <id>
```
{% endcode %}

## GuardDuty ãƒã‚¤ãƒ‘ã‚¹

### ä¸€èˆ¬çš„ãªã‚¬ã‚¤ãƒ€ãƒ³ã‚¹

ä½¿ç”¨ã™ã‚‹äºˆå®šã®èªè¨¼æƒ…å ±ã®å‹•ä½œã«ã¤ã„ã¦ã§ãã‚‹ã ã‘å¤šãã®æƒ…å ±ã‚’åé›†ã—ã¦ãã ã•ã„ï¼š

* åˆ©ç”¨ã•ã‚Œã‚‹æ™‚é–“
* å ´æ‰€
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ / ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆawscliã€webconsoleã€lambdaãªã©ã‹ã‚‰ä½¿ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰
* é€šå¸¸ä½¿ç”¨ã•ã‚Œã‚‹æ¨©é™

ã“ã®æƒ…å ±ã‚’ã‚‚ã¨ã«ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã§ãã‚‹ã ã‘åŒã˜ã‚·ãƒŠãƒªã‚ªã‚’å†ç¾ã—ã¦ãã ã•ã„ï¼š

* **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ­ãƒ¼ãƒ«**ã®å ´åˆã€åŒã˜æ™‚é–“å¸¯ã«ã€åŒã˜åœ°ç†çš„ä½ç½®ã‹ã‚‰ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°åŒã˜ISPãŠã‚ˆã³IPã‹ã‚‰ï¼‰ä½¿ç”¨ã—ã¦ã¿ã¦ãã ã•ã„
* **ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã‚‹ãƒ­ãƒ¼ãƒ«**ã®å ´åˆã€åŒã˜ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§åŒã˜ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã—ã€ãã“ã‹ã‚‰åŒã˜æ™‚é–“å¸¯ã«ä½¿ç”¨ã—ã¦ãã ã•ã„
* å¸¸ã«ã€ã“ã®ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒä½¿ç”¨ã—ã¦ã„ãŸ**åŒã˜æ¨©é™**ã‚’ä½¿ç”¨ã—ã‚ˆã†ã¨ã—ã¦ãã ã•ã„
* **ä»–ã®æ¨©é™ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã‚„æ¨©é™ã‚’ä¹±ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆ**ï¼ˆä¾‹ãˆã°ã€1,000,000ã®cloudtrailãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãªã©ï¼‰ã€**ã‚†ã£ãã‚Šã¨**ã€AWSã¨ã®ã‚„ã‚Šå–ã‚Šã‚’**æœ€å°é™ã«æŠ‘ãˆã¦**è¡Œã£ã¦ãã ã•ã„ï¼ˆawscliã¯æ›¸ãè¾¼ã¿å‰ã«ã„ãã¤ã‹ã®èª­ã¿å–ã‚ŠAPIã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰

### GuardDuty ã®ç ´å£Š

#### `guardduty:UpdateDetector`

ã“ã®æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã¨ã€ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å¼•ãèµ·ã“ã•ãªã„ã‚ˆã†ã«GuardDutyã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
aws guardduty update-detector --detector-id <detector-id> --no-enable
aws guardduty update-detector --detector-id <detector-id> --data-sources S3Logs={Enable=false}
```
{% endcode %}

#### `guardduty:CreateFilter`

ã“ã®æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€**è‡ªå‹•ã§**æ¤œå‡ºçµæœã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’**ä½¿ç”¨ã™ã‚‹**èƒ½åŠ›ãŒã‚ã‚Šã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
aws guardduty create-filter  --detector-id <detector-id> --name <filter-name> --finding-criteria file:///tmp/criteria.json --action ARCHIVE
```
#### `iam:PutRolePolicy`, (`guardduty:CreateIPSet`|`guardduty:UpdateIPSet`)

å‰è¿°ã®æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€è‡ªåˆ†ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’[**ä¿¡é ¼ã§ãã‚‹IPãƒªã‚¹ãƒˆ**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html)ã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€GuardDutyã®ãƒªã‚¹ãƒˆã‚’å¤‰æ›´ã—ã€ã‚¢ãƒ©ãƒ¼ãƒˆã®ç”Ÿæˆã‚’å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
aws guardduty update-ip-set --detector-id <detector-id> --activate --ip-set-id <ip-set-id> --location https://some-bucket.s3-eu-west-1.amazonaws.com/attacker.csv
```
#### `guardduty:DeletePublishingDestination`

æ”»æ’ƒè€…ã¯ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é˜²ããŸã‚ã«ã€å®›å…ˆã‚’å‰Šé™¤ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
aws guardduty delete-publishing-destination --detector-id <detector-id> --destination-id <dest-id>
```
{% endcode %}

{% hint style="danger" %}
ã“ã®å…¬é–‹å…ˆã‚’å‰Šé™¤ã—ã¦ã‚‚ã€GuardDutyã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…ã®æ¤œå‡ºçµæœã®ç”Ÿæˆã‚„å¯è¦–æ€§ã«ã¯**å½±éŸ¿ã—ã¾ã›ã‚“**ã€‚GuardDutyã¯AWSç’°å¢ƒã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å¼•ãç¶šãåˆ†æã—ã€ä¸å¯©ã¾ãŸã¯äºˆæœŸã—ãªã„å‹•ä½œã‚’ç‰¹å®šã—ã€æ¤œå‡ºçµæœã‚’ç”Ÿæˆã—ã¾ã™ã€‚
{% endhint %}

### ç‰¹å®šã®æ¤œå‡ºçµæœãƒã‚¤ãƒ‘ã‚¹ä¾‹

GuardDutyã®æ¤œå‡ºçµæœã¯æ•°åç¨®é¡ã‚ã‚Šã¾ã™ãŒã€**ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦ã™ã¹ã¦ã«å½±éŸ¿ã•ã‚Œã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚ã•ã‚‰ã«è‰¯ã„ã“ã¨ã«ã€ãã‚Œãã‚Œã®å®Œå…¨ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒ[https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)ã«ã‚ã‚‹ã®ã§ã€æ•ã¾ã‚‰ãªã„ã‚ˆã†ã«è¡Œå‹•ã™ã‚‹å‰ã«ç¢ºèªã—ã¦ãã ã•ã„ã€‚

ã“ã“ã«ã¯ã€ç‰¹å®šã®GuardDutyæ¤œå‡ºçµæœã®ãƒã‚¤ãƒ‘ã‚¹ä¾‹ã‚’ã„ãã¤ã‹ç´¹ä»‹ã—ã¾ã™ï¼š

#### [PenTest:IAMUser/KaliLinux](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux) <a href="#pentest-iam-kalilinux" id="pentest-iam-kalilinux"></a>

GuardDutyã¯ä¸€èˆ¬çš„ãªãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã‹ã‚‰ã®AWS APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œå‡ºã—ã€[PenTest Finding](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux)ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚\
ã“ã‚Œã¯APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æ¸¡ã•ã‚Œã‚‹**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå**ã«ã‚ˆã£ã¦æ¤œå‡ºã•ã‚Œã¾ã™ã€‚\
ã—ãŸãŒã£ã¦ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¤‰æ›´ã™ã‚‹**ã“ã¨ã§ã€æ”»æ’ƒã®æ¤œå‡ºã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚’é˜²ããŸã‚ã«ã¯ã€`botocore`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®`session.py`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ¢ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¤‰æ›´ã™ã‚‹ã‹ã€AWS CLIã®ãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦Burp Suiteã‚’è¨­å®šã—ã¦MitMã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¤‰æ›´ã™ã‚‹ã‹ã€ã¾ãŸã¯Ubuntuã€Macã€Windowsã®ã‚ˆã†ãªOSã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆã®ãƒˆãƒªã‚¬ãƒ¼ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

#### UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration

ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰EC2ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’æŠ½å‡ºã—ã€AWSç’°å¢ƒ**å¤–éƒ¨ã§ä½¿ç”¨ã™ã‚‹**ã¨ã€[**`UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.OutsideAWS`**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws)ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ã¾ã™ã€‚é€†ã«ã€ã“ã‚Œã‚‰ã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ä½¿ç”¨ã™ã‚‹ã¨ã€[**`UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.InsideAWS`**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws)ã‚¢ãƒ©ãƒ¼ãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€**åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®åˆ¥ã®ä¾µå®³ã•ã‚ŒãŸEC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã¨æ¤œå‡ºã•ã‚Œãš**ã€ã‚¢ãƒ©ãƒ¼ãƒˆã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã€‚

{% hint style="success" %}
ã—ãŸãŒã£ã¦ã€ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ãªã„ãŸã‚ã«ã¯ã€**è¦‹ã¤ã‘ãŸãƒã‚·ãƒ³å†…éƒ¨ã‹ã‚‰æŠ½å‡ºã—ãŸã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„**ã€‚
{% endhint %}

## å‚è€ƒæ–‡çŒ®

* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html](https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html)
* [https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html](https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws)
* [https://docs.aws.amazon.com/whitepapers/latest/aws-privatelink/what-are-vpc-endpoints.html](https://docs.aws.amazon.com/whitepapers/latest/aws-privatelink/what-are-vpc-endpoints.html)

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„ã€‚
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã¦ãã ã•ã„ã€‚ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³**](https://opensea.io/collection/the-peass-family)ã§ã™ã€‚
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã§**ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„**ã€‚
* **ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã™ã‚‹ã“ã¨ã§å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
