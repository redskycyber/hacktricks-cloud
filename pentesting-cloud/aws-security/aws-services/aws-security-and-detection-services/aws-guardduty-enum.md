# AWS - GuardDuty Enum

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong>ã‚’é€šã˜ã¦ã€ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã¾ã—ã‚‡ã†ï¼</summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•ï¼š

- **HackTricksã§ä¼æ¥­ã‚’å®£ä¼**ã—ãŸã„å ´åˆã‚„**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
- [**å…¬å¼PEASSï¼†HackTricksã‚¹ãƒ¯ãƒƒã‚°**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
- **Discordã‚°ãƒ«ãƒ¼ãƒ—**ã«**å‚åŠ **ã™ã‚‹ğŸ’¬ï¼ˆhttps://discord.gg/hRep4RUj7fï¼‰ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ğŸ¦ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã™ã‚‹ï¼š**@hacktricks_live**ï¼ˆhttps://twitter.com/hacktricks_liveï¼‰ã€‚
- **HackTricks**ï¼ˆhttps://github.com/carlospolop/hacktricksï¼‰ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>

## GuardDuty

[**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**](https://aws.amazon.com/guardduty/features/)ã«ã‚ˆã‚‹ã¨ã€GuardDutyã¯ã€**æ©Ÿæ¢°å­¦ç¿’ã€ç•°å¸¸æ¤œçŸ¥ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–ã€ãŠã‚ˆã³æ‚ªæ„ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ç™ºè¦‹**ã‚’çµ„ã¿åˆã‚ã›ã€AWSãŠã‚ˆã³æ¥­ç•Œã‚’ãƒªãƒ¼ãƒ‰ã™ã‚‹ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã€AWSä¸Šã®ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚ GuardDutyã¯ã€AWS CloudTrailã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã€Amazon Virtual Private Cloudï¼ˆVPCï¼‰Flow Logsã€Amazon Elastic Kubernetes Serviceï¼ˆEKSï¼‰ç›£æŸ»ãŠã‚ˆã³ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«ãƒ­ã‚°ã€ãŠã‚ˆã³DNSã‚¯ã‚¨ãƒªãƒ­ã‚°ãªã©ã€è¤‡æ•°ã®AWSãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹å…¨ä½“ã§æ•°åå„„ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’åˆ†æã§ãã¾ã™ã€‚

Amazon GuardDutyã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã§ã®**ç•°å¸¸ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’ç‰¹å®š**ã—ã€ãã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é–¢é€£æ€§**ã‚’åˆ†æã—ã€ãã‚ŒãŒå‘¼ã³å‡ºã•ã‚ŒãŸ**ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å¯¾å¿œè€…ã¯ã•ã‚‰ãªã‚‹èª¿æŸ»ã«æ™‚é–“ã‚’è²»ã‚„ã™å¿…è¦ãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã§ãã¾ã™ã€‚

ã‚¢ãƒ©ãƒ¼ãƒˆã¯ã€GuardDutyã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆ90æ—¥é–“ï¼‰ãŠã‚ˆã³CloudWatch Eventsã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

{% hint style="warning" %}
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**GuardDutyã‚’ç„¡åŠ¹ã«**ã™ã‚‹ã¨ã€AWSç’°å¢ƒã®ç›£è¦–ãŒåœæ­¢ã•ã‚Œã€æ–°ã—ã„èª¿æŸ»çµæœã¯ç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã€‚ã¾ãŸã€**æ—¢å­˜ã®èª¿æŸ»çµæœãŒå¤±ã‚ã‚Œã¾ã™**ã€‚\
å˜ã«åœæ­¢ã™ã‚‹ã ã‘ã®å ´åˆã¯ã€æ—¢å­˜ã®èª¿æŸ»çµæœã¯æ®‹ã‚Šã¾ã™ã€‚
{% endhint %}

### èª¿æŸ»çµæœã®ä¾‹

- **åµå¯Ÿ**: æ”»æ’ƒè€…ã«ã‚ˆã‚‹åµå¯Ÿã‚’ç¤ºå”†ã™ã‚‹ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã€ä¾‹ãˆã°**ç•°å¸¸ãªAPIã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£**ã€ç–‘ã‚ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®**ãƒ­ã‚°ã‚¤ãƒ³**è©¦è¡Œã€VPCå†…éƒ¨ã®**ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³**ã€ç•°å¸¸ãªå¤±æ•—ã—ãŸãƒ­ã‚°ã‚¤ãƒ³ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã€æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã‹ã‚‰ã®æœªå‡¦ç†ã®ãƒãƒ¼ãƒˆãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°ãªã©ã€‚
- **ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¾µå®³**: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¾µå®³ã‚’ç¤ºã™ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã€ä¾‹ãˆã°**æš—å·é€šè²¨ã®æ¡æ˜ã€ãƒãƒƒã‚¯ãƒ‰ã‚¢ã®ã‚³ãƒãƒ³ãƒ‰åˆ¶å¾¡ï¼ˆCï¼†Cï¼‰**ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ç”Ÿæˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆDGAï¼‰ã‚’ä½¿ç”¨ã—ãŸãƒãƒ«ã‚¦ã‚§ã‚¢ã€å¤–éƒ¨ã‹ã‚‰ã®ã‚µãƒ¼ãƒ“ã‚¹æ‹’å¦ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã€ç•°å¸¸ã«**é«˜ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯é‡ã€ç•°å¸¸ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã¨ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹é€šä¿¡ã€ä¸€æ™‚çš„ãªAmazon EC2è³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã—ãŸå¤–éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãŠã‚ˆã³DNSã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å¤–éƒ¨ã¸ã®æŒã¡å‡ºã—ã€‚
- **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¾µå®³**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¾µå®³ã‚’ç¤ºã™ä¸€èˆ¬çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¯ã€ç•°å¸¸ãªåœ°ç†çš„ä½ç½®æƒ…å ±ã‚„åŒ¿åãƒ—ãƒ­ã‚­ã‚·ã‹ã‚‰ã®APIå‘¼ã³å‡ºã—ã€AWS CloudTrailãƒ­ã‚°ã®ç„¡åŠ¹åŒ–ã‚’è©¦ã¿ã‚‹ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã‚’å¼±ä½“åŒ–ã™ã‚‹å¤‰æ›´ã€ç•°å¸¸ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¾ãŸã¯ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®èµ·å‹•ã€ç•°å¸¸ãªåœ°åŸŸã§ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å±•é–‹ã€è³‡æ ¼æƒ…å ±ã®ç›—é›£ã€ç–‘ã‚ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ­ã‚°ã‚¤ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã€æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®APIå‘¼ã³å‡ºã—ãªã©ãŒå«ã¾ã‚Œã¾ã™ã€‚
- **ãƒã‚±ãƒƒãƒˆã®ä¾µå®³**: ãƒã‚±ãƒƒãƒˆã®ä¾µå®³ã‚’ç¤ºã™ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã€ä¾‹ãˆã°è³‡æ ¼æƒ…å ±ã®èª¤ç”¨ã‚’ç¤ºã™ç–‘ã‚ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã‹ã‚‰ã®ç•°å¸¸ãªAmazon S3 APIã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã€æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®ä¸æ­£ãªS3ã‚¢ã‚¯ã‚»ã‚¹ã€ãƒã‚±ãƒƒãƒˆã¸ã®ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚’ç›®çš„ã¨ã—ãŸAPIå‘¼ã³å‡ºã—ï¼ˆãƒã‚±ãƒƒãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹å±¥æ­´ãŒãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ã‚‚ã®ã¾ãŸã¯ç•°å¸¸ãªå ´æ‰€ã‹ã‚‰å‘¼ã³å‡ºã•ã‚ŒãŸã‚‚ã®ï¼‰ãªã©ãŒå«ã¾ã‚Œã¾ã™ã€‚ Amazon GuardDutyã¯ã€ã™ã¹ã¦ã®Amazon S3ãƒã‚±ãƒƒãƒˆã§ç–‘ã‚ã—ã„ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã«AWS CloudTrail S3ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¾‹ï¼šGetObjectã€ListObjectsã€DeleteObjectï¼‰ã‚’ç¶™ç¶šçš„ã«ç›£è¦–ãŠã‚ˆã³åˆ†æã—ã¾ã™ã€‚

<details>

<summary>èª¿æŸ»æƒ…å ±</summary>

èª¿æŸ»æ¦‚è¦ï¼š

- èª¿æŸ»ã‚¿ã‚¤ãƒ—
- é‡è¦åº¦ï¼š7-8.9 é«˜ã€4-6.9 ä¸­ã€01-3.9 ä½
- ãƒªãƒ¼ã‚¸ãƒ§ãƒ³
- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID
- ãƒªã‚½ãƒ¼ã‚¹ID
- æ¤œå‡ºæ™‚åˆ»
- ä½¿ç”¨ã•ã‚ŒãŸè„…å¨ãƒªã‚¹ãƒˆ

æœ¬æ–‡ã«ã¯æ¬¡ã®æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

- å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒªã‚½ãƒ¼ã‚¹
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- ã‚¢ã‚¯ã‚¿ãƒ¼ï¼šIPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒãƒ¼ãƒˆã€ãƒ‰ãƒ¡ã‚¤ãƒ³
- è¿½åŠ æƒ…å ±

</details>

### ã™ã¹ã¦ã®èª¿æŸ»çµæœ

GuardDutyã®ã™ã¹ã¦ã®èª¿æŸ»çµæœã®ãƒªã‚¹ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ï¼š[https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)

### è¤‡æ•°ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

#### æ‹›å¾…ã«ã‚ˆã‚‹

ä»–ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç•°ãªã‚‹AWS GuardDutyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«**æ‹›å¾…**ã—ã¦ã€**ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒåŒã˜GuardDutyã‹ã‚‰ç›£è¦–**ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒã‚¹ã‚¿ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ‹›å¾…ã—ã€ãã®å¾Œã€ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä»£è¡¨è€…ãŒæ‹›å¾…ã‚’å—ã‘å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### çµ„ç¹”ã‚’é€šã˜ã¦

çµ„ç¹”å†…ã®ä»»æ„ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’**GuardDutyå§”ä»»ç®¡ç†è€…**ã«æŒ‡å®šã§ãã¾ã™ã€‚å§”ä»»ç®¡ç†è€…ã‚’æŒ‡å®šã§ãã‚‹ã®ã¯çµ„ç¹”ç®¡ç†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã ã‘ã§ã™ã€‚

å§”ä»»ç®¡ç†è€…ã¨ã—ã¦æŒ‡å®šã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€GuardDutyç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãªã‚Šã€æŒ‡å®šã•ã‚ŒãŸAWSãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§GuardDutyãŒè‡ªå‹•çš„ã«æœ‰åŠ¹ã«ãªã‚Šã€ãã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å†…ã®çµ„ç¹”å†…ã®ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®GuardDutyã‚’æœ‰åŠ¹ã«ã—ãŸã‚Šç®¡ç†ã™ã‚‹æ¨©é™ã‚’æŒã¡ã¾ã™ã€‚çµ„ç¹”å†…ã®ä»–ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€ã“ã®å§”ä»»ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸGuardDutyãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã—ã¦è¡¨ç¤ºãŠã‚ˆã³è¿½åŠ ã§ãã¾ã™ã€‚

## åˆ—æŒ™

{% code overflow="wrap" %}
```bash
# Get Org config
aws guardduty list-organization-admin-accounts #Get Delegated Administrator
aws guardduty describe-organization-configuration --detector-id <id>

# Check external invitations
aws guardduty list-invitations
aws guardduty get-invitations-count

# Detector Information
aws guardduty list-detectors # 1 detector per account with GuardDuty
aws guardduty get-detector --detector-id <id> # Get detector info
aws guardduty get-master-account --detector-id <id>

# Get filters
aws guardduty list-filters --detector-id <id> # Check filters
aws guardduty get-filter --detector-id <id> --filter-name <name>

# Findings
aws guardduty list-findings --detector-id <id> # List findings
aws guardduty get-findings --detector-id <id> --finding-ids <id> # Get details about the finding
aws guardduty get-findings-statistics --detector-id <id> --finding-statistic-types <types>

# Get trusted IP addresses
aws guardduty list-ip-sets --detector-id <id>
aws guardduty get-ip-set --detector-id <id>

# Member accounts of the current AWS GuardDuty master account
aws guardduty list-members --detector-id <id>
aws guardduty get-members --detector-id <id> --account-ids <id>
aws guardduty get-member-detectors --detector-id <id> --account-ids <id>

# Continuously export its findings to an Amazon S3 bucket
aws guardduty list-publishing-destinations --detector-id <id>

# Intelligence sets that you have uploaded to GuardDuty
aws guardduty list-threat-intel-sets --detector-id <id>
aws guardduty get-threat-intel-set --detector-id <id> --threat-intel-set-id <id>
```
{% endcode %}

## GuardDuty ãƒã‚¤ãƒ‘ã‚¹

### ä¸€èˆ¬çš„ãªã‚¬ã‚¤ãƒ€ãƒ³ã‚¹

ä½¿ç”¨ã™ã‚‹è³‡æ ¼æƒ…å ±ã®å‹•ä½œã«ã¤ã„ã¦å¯èƒ½ãªé™ã‚Šå¤šãã®æƒ…å ±ã‚’åé›†ã—ã‚ˆã†ï¼š

* ä½¿ç”¨ã•ã‚Œã‚‹æ™‚é–“å¸¯
* å ´æ‰€
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ / ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆawscliã€webconsoleã€lambdaãªã©ã‹ã‚‰ä½¿ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰
* å®šæœŸçš„ã«ä½¿ç”¨ã•ã‚Œã‚‹æ¨©é™

ã“ã®æƒ…å ±ã‚’å…ƒã«ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«ã§ãã‚‹ã ã‘åŒã˜ã‚·ãƒŠãƒªã‚ªã‚’å†ç¾ã—ã‚ˆã†ï¼š

* **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ­ãƒ¼ãƒ«**ã®å ´åˆã€åŒã˜æ™‚é–“å¸¯ã«ã€åŒã˜åœ°ç†çš„ä½ç½®ã‹ã‚‰ä½¿ç”¨ã—ã‚ˆã†ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°åŒã˜ISPãŠã‚ˆã³IPã‹ã‚‰ï¼‰
* **ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã‚‹ãƒ­ãƒ¼ãƒ«**ã®å ´åˆã€åŒã˜ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§åŒã˜ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã—ã€åŒã˜æ™‚é–“å¸¯ã«ãã“ã‹ã‚‰ä½¿ç”¨ã—ã‚ˆã†
* å¸¸ã«ã“ã®ä¸»ä½“ãŒä½¿ç”¨ã—ãŸ**åŒã˜æ¨©é™**ã‚’ä½¿ç”¨ã—ã‚ˆã†
* ä»–ã®æ¨©é™ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã‚„æ¨©é™ã‚’æ‚ªç”¨ã™ã‚‹å ´åˆï¼ˆãŸã¨ãˆã°ã€1,000,000ã®cloudtrailãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ï¼‰ã¯ã€**ã‚†ã£ãã‚Š**ã‹ã¤**AWSã¨ã®æœ€å°é™ã®ã‚„ã‚Šå–ã‚Š**ã§è¡ŒãŠã†ï¼ˆawscliã¯æ›¸ãè¾¼ã¿APIã®å‰ã«è¤‡æ•°ã®èª­ã¿å–ã‚ŠAPIã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã‚ã‚‹ï¼‰

### GuardDuty ã®å›é¿

#### `guardduty:UpdateDetector`

ã“ã®æ¨©é™ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã•ã›ã‚‹ã®ã‚’é¿ã‘ã‚‹ãŸã‚ã«GuardDutyã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
aws guardduty update-detector --detector-id <detector-id> --no-enable
aws guardduty update-detector --detector-id <detector-id> --data-sources S3Logs={Enable=false}
```
#### `guardduty:CreateFilter`

ã“ã®æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€**èª¿æŸ»çµæœã®è‡ªå‹•ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ç”¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨**ã™ã‚‹èƒ½åŠ›ã‚’æŒã£ã¦ã„ã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
aws guardduty create-filter  --detector-id <detector-id> --name <filter-name> --finding-criteria file:///tmp/criteria.json --action ARCHIVE
```
#### `iam:PutRolePolicy`, (`guardduty:CreateIPSet`|`guardduty:UpdateIPSet`)

å‰è¿°ã®æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€è‡ªåˆ†ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ ã—ã¦GuardDutyã®[**ä¿¡é ¼ã•ã‚ŒãŸIPãƒªã‚¹ãƒˆ**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html)ã‚’å¤‰æ›´ã—ã€ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã®ã‚’å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
aws guardduty update-ip-set --detector-id <detector-id> --activate --ip-set-id <ip-set-id> --location https://some-bucket.s3-eu-west-1.amazonaws.com/attacker.csv
```
{% endcode %}

#### `guardduty:DeletePublishingDestination`

æ”»æ’ƒè€…ã¯ã€ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é˜²ããŸã‚ã«å®›å…ˆã‚’å‰Šé™¤ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
aws guardduty delete-publishing-destination --detector-id <detector-id> --destination-id <dest-id>
```
{% endcode %}

{% hint style="danger" %}
ã“ã®å…¬é–‹å…ˆã‚’å‰Šé™¤ã—ã¦ã‚‚ã€**GuardDutyã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…ã®èª¿æŸ»çµæœã®ç”Ÿæˆã‚„è¡¨ç¤ºã«å½±éŸ¿ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚GuardDutyã¯å¼•ãç¶šãAWSç’°å¢ƒã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’åˆ†æã—ã€ç–‘ã‚ã—ã„è¡Œå‹•ã‚„äºˆæœŸã—ãªã„å‹•ä½œã‚’ç‰¹å®šã—ã€èª¿æŸ»çµæœã‚’ç”Ÿæˆã—ã¾ã™ã€‚
{% endhint %}

### ç‰¹å®šã®èª¿æŸ»çµæœã®å›é¿ä¾‹

GuardDutyã«ã¯æ•°åã®èª¿æŸ»çµæœãŒã‚ã‚Šã¾ã™ãŒã€**Red Teamerã¨ã—ã¦ã¯ã™ã¹ã¦ãŒå½±éŸ¿ã‚’å—ã‘ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚ã•ã‚‰ã«ã€ãã‚Œãã‚Œã®è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã®ã§ã€[https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html) ã‚’å‚ç…§ã—ã¦ã€ä½•ã‚‰ã‹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ç¢ºèªã—ã¦ãã ã•ã„ã€‚

ä»¥ä¸‹ã«ã€ç‰¹å®šã®GuardDutyèª¿æŸ»çµæœã®å›é¿ä¾‹ã‚’ã„ãã¤ã‹ç¤ºã—ã¾ã™:

#### [PenTest:IAMUser/KaliLinux](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux) <a href="#pentest-iam-kalilinux" id="pentest-iam-kalilinux"></a>

GuardDutyã¯ä¸€èˆ¬çš„ãªä¾µå…¥ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã‹ã‚‰ã®AWS APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œå‡ºã—ã€[PenTest Finding](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux) ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚\
APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æ¸¡ã•ã‚Œã‚‹**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå**ã«ã‚ˆã£ã¦æ¤œå‡ºã•ã‚Œã¾ã™ã€‚\
ã—ãŸãŒã£ã¦ã€æ”»æ’ƒã‚’æ¤œå‡ºã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã«ã¯ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¤‰æ›´**ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã“ã‚Œã‚’é˜²ããŸã‚ã«ã¯ã€`botocore`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®`session.py`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ¤œç´¢ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¤‰æ›´ã—ãŸã‚Šã€AWS CLIãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦Burp Suiteã‚’è¨­å®šã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’MitMã§å¤‰æ›´ã—ãŸã‚Šã€Ubuntuã€Macã€Windowsãªã©ã®OSã‚’ä½¿ç”¨ã—ã¦ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

#### UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration

ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰EC2è³‡æ ¼æƒ…å ±ã‚’æŠ½å‡ºã—ã€AWSç’°å¢ƒå¤–ã§ãã‚Œã‚‰ã‚’**åˆ©ç”¨ã™ã‚‹**ã¨ã€[**`UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.OutsideAWS`**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws) ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ã¾ã™ã€‚é€†ã«ã€EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ã“ã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€[**`UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.InsideAWS`**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws) ã‚¢ãƒ©ãƒ¼ãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€**åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®åˆ¥ã®ä¾µå®³ã•ã‚ŒãŸEC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§è³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ã¨æ¤œå‡ºã•ã‚Œãšã€ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ã¾ã›ã‚“**ã€‚

{% hint style="success" %}
ã—ãŸãŒã£ã¦ã€è¦‹ã¤ã‘ãŸãƒã‚·ãƒ³å†…ã‹ã‚‰**æŠ½å‡ºã•ã‚ŒãŸè³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ãªã„ã‚ˆã†ã«**ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

## å‚è€ƒæ–‡çŒ®

* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html](https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html)
* [https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html](https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws)
* [https://docs.aws.amazon.com/whitepapers/latest/aws-privatelink/what-are-vpc-endpoints.html](https://docs.aws.amazon.com/whitepapers/latest/aws-privatelink/what-are-vpc-endpoints.html)

<details>

<summary><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã³ã¾ã—ã‚‡ã†</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã®åºƒå‘Šã‚’æ²è¼‰ã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã—ã¦ãã ã•ã„
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã€å½“ç¤¾ã®ç‹¬å çš„ãª[NFTs](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™ºè¦‹ã—ã¦ãã ã•ã„
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚
* ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
