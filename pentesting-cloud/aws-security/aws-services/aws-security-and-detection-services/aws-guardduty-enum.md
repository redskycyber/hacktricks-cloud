# AWS - GuardDuty Enum

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å¾—ã‚‹ï¼</strong></summary>

* **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„**å ´åˆã‚„ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¦‹ãŸã„**å ´åˆã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ã”ç¢ºèªãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹**ãŸã‚ã«ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã™ã‚‹

</details>

## GuardDuty

Amazon GuardDutyã¯ã€AWSãŒæä¾›ã™ã‚‹æœ€åˆã®ç¨®é¡ã®åœ°åŸŸãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãª**è„…å¨æ¤œå‡ºã‚µãƒ¼ãƒ“ã‚¹**ã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯**VPCãƒ•ãƒ­ãƒ¼ãƒ­ã‚°ã€AWS CloudTrailç®¡ç†ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã€CloudTrail S3ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã€ãŠã‚ˆã³DNSãƒ­ã‚°**ã‚’åˆ†æã™ã‚‹ã“ã¨ã§ã€**AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ã‚’**ç•°å¸¸ãªæŒ™å‹•ã‚„äºˆæœŸã—ãªã„æŒ™å‹•**ã‹ã‚‰ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚GuardDutyã¯ã€æ‚ªæ„ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒªã‚¹ãƒˆãªã©ã®**è„…å¨ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ãƒ•ã‚£ãƒ¼ãƒ‰**ã¨**æ©Ÿæ¢°å­¦ç¿’**ã‚’ä½¿ç”¨ã—ã¦ã€AWSç’°å¢ƒå†…ã§ã®**äºˆæœŸã—ãªã„ãŠã‚ˆã³æ½œåœ¨çš„ã«ä¸æ­£ãªæ´»å‹•**ã‚’ç‰¹å®šã—ã¾ã™ã€‚ã“ã‚Œã«ã¯ç‰¹æ¨©ã®ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€å…¬é–‹ã•ã‚ŒãŸè³‡æ ¼æƒ…å ±ã®ä½¿ç”¨ã€ã¾ãŸã¯æ‚ªæ„ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã®é€šä¿¡ãªã©ã®å•é¡ŒãŒå«ã¾ã‚Œã¾ã™ã€‚

ã‚¢ãƒ©ãƒ¼ãƒˆã¯**GuardDutyã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆ90æ—¥ï¼‰**ã¨CloudWatchã‚¤ãƒ™ãƒ³ãƒˆã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ãŸã¨ãˆã°ã€GuardDutyã¯ã€ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚„ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³ã®ãƒã‚¤ãƒ‹ãƒ³ã‚°ã‚’æä¾›ã™ã‚‹**ä¾µå®³ã•ã‚ŒãŸEC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**ã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®**ã‚¢ã‚¯ã‚»ã‚¹å‹•ä½œã‚’ç›£è¦–**ã—ã€æœªä½¿ç”¨ã®**ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**ã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã®å¤‰æ›´ãªã©ã®**ç•°å¸¸ãªAPIå‘¼ã³å‡ºã—**ãªã©ã€ä¾µå®³ã®å…†å€™ã‚’æ¤œå‡ºã—ã¾ã™ã€‚\
GuardDutyã«ã¯ã€ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã¨ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒªã‚¹ãƒˆã‚’**ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æ¤œå‡ºã®æ¦‚è¦ï¼š

* æ¤œå‡ºã‚¿ã‚¤ãƒ—
* é‡è¦åº¦ï¼š7-8.9é«˜ã€4-6.9ä¸­ã€01-3.9ä½
* ãƒªãƒ¼ã‚¸ãƒ§ãƒ³
* ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID
* ãƒªã‚½ãƒ¼ã‚¹ID
* æ¤œå‡ºæ™‚åˆ»
* ä½¿ç”¨ã•ã‚ŒãŸè„…å¨ãƒªã‚¹ãƒˆ

æœ¬æ–‡ã«ã¯æ¬¡ã®æƒ…å ±ãŒå«ã¾ã‚Œã¾ã™ï¼š

* å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒªã‚½ãƒ¼ã‚¹
* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
* ã‚¢ã‚¯ã‚¿ãƒ¼ï¼šIPã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒãƒ¼ãƒˆã€ãƒ‰ãƒ¡ã‚¤ãƒ³
* è¿½åŠ æƒ…å ±

ä»–ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç•°ãªã‚‹AWS GuardDutyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«**æ‹›å¾…ã™ã‚‹**ã“ã¨ã§ã€**ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒåŒã˜GuardDutyã‹ã‚‰ç›£è¦–**ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒã‚¹ã‚¿ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ‹›å¾…ã—ã€ãã®å¾Œã€ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä»£è¡¨è€…ãŒæ‹›å¾…ã‚’å—ã‘å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\
GuardDutyã«ã¯ã€æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã•ã¾ã–ã¾ãªIAMãƒ­ãƒ¼ãƒ«ã®æ¨©é™ãŒã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã¨ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã®IPã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚\
GuardDutyã¯ã€å½±éŸ¿ã‚’å—ã‘ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã€ŒAWSServiceRoleForAmazonGuardDutyã€ã¨ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ãƒªãƒ³ã‚¯ãƒ‰ãƒ­ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã«ã¯ã€CloudTrailã‹ã‚‰ã®1ãƒŸãƒªã‚ªãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã”ã¨ã®å‡¦ç†ã¨ã€VPC Flowã‹ã‚‰ã®è§£æãƒ­ã‚°ã”ã¨ã®GBã”ã¨ã®å‡¦ç†ã«å¯¾ã—ã¦æ–™é‡‘ãŒç™ºç”Ÿã—ã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒGuardDutyã‚’**ç„¡åŠ¹ã«ã™ã‚‹**ã¨ã€AWSç’°å¢ƒã®ç›£è¦–ãŒåœæ­¢ã—ã€æ–°ã—ã„æ¤œå‡ºã¯ç”Ÿæˆã•ã‚Œãªããªã‚Šã€**æ—¢å­˜ã®æ¤œå‡ºã‚‚å¤±ã‚ã‚Œã¾ã™**ã€‚\
ãŸã ã—ã€åœæ­¢ã™ã‚‹ã ã‘ã®å ´åˆã¯ã€æ—¢å­˜ã®æ¤œå‡ºã¯æ®‹ã‚Šã¾ã™ã€‚

## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### åˆ—æŒ™
```bash
aws guardduty list-organization-admin-accounts
aws guardduty list-invitations
aws guardduty get-invitations-count
aws guardduty list-detectors
aws guardduty describe-organization-configuration --detector-id <id>
aws guardduty get-detector --detector-id <id>
aws guardduty list-filters --detector-id <id>
aws guardduty get-filter --detector-id <id> --filter-name
aws guardduty list-findings --detector-id <id>
aws guardduty get-findings --detector-id <id> --finding-ids <id>
aws guardduty get-findings-statistics --detector-id <id> --finding-statistic-types <types>
aws guardduty list-ip-sets --detector-id <id>
aws guardduty list-members --detector-id <id>
aws guardduty list-publishing-destinations --detector-id <id>
aws guardduty list-threat-intel-sets --detector-id <id>
aws guardduty list-ip-sets
aws guardduty get-ip-set --detector-id <id>
aws guardduty get-master-account --detector-id <id>
aws guardduty get-members --detector-id <id> --account-ids <id>
aws guardduty get-member-detectors --detector-id <id> --account-ids <id>
aws guardduty get-threat-intel-set --detector-id <id> --threat-intel-set-id <id>
```
## æ¤œå‡ºã‚’å›é¿ã™ã‚‹

### `guardduty:ListDetectors`, `guardduty:UpdateDetector`

ã“ã‚Œã‚‰ã®æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã¨ã€ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã“ã¨ã‚’é¿ã‘ã‚‹ãŸã‚ã«GuardDutyã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
# Disabling the detector
aws guardduty update-detector \
--detector-id <detector-id> \
--no-enable

# Removing s3 as a log source
aws guardduty update-detector \
--detector-id <detector-id> \
--data-sources S3Logs={Enable=false}

# Increase finding update time to 6 hours
aws guardduty update-detector \
--detector-id <detector-id> \
--finding-publishing-frequency SIX_HOURS
```
### `guardduty:ListDetectors`, `guardduty:ListIPSet`, `iam:PutRolePolicy`, (`guardduty:CreateIPSet`|`guardduty:UpdateIPSet`)

æ”»æ’ƒè€…ã¯ã€GuardDutyã®[ä¿¡é ¼ã•ã‚ŒãŸIPãƒªã‚¹ãƒˆ](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html)ã‚’ä½œæˆã¾ãŸã¯æ›´æ–°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã®ä¸­ã«ã¯ã€**è‡ªåˆ†è‡ªèº«ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚å«ã¾ã‚Œã¾ã™**ã€‚ä¿¡é ¼ã•ã‚ŒãŸIPãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€Cloudtrailã‚„VPCãƒ•ãƒ­ãƒ¼ãƒ­ã‚°ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºç”Ÿã—ã¾ã›ã‚“ã€‚

{% hint style="info" %}
DNSã®æ¤œå‡ºçµæœã¯ã€ä¿¡é ¼ã•ã‚ŒãŸIPãƒªã‚¹ãƒˆã®å¯¾è±¡å¤–ã§ã™ã€‚
{% endhint %}
```
aws guardduty update-ip-set \
--detector-id <detector-id> \
--ip-set-id 24adjigdk34290840348exampleiplist \
--location https://malicious-bucket.s3-us-east-1.amazonaws.com/customiplist.csv \
--activate
```
{% hint style="info" %}
å¿…è¦ãªã‚¹ãƒ†ãƒ«ã‚¹ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®s3ãƒã‚±ãƒƒãƒˆã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã‹ã€æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

### `guardduty:CreateFilter`

æ–°ã—ãä½œæˆã•ã‚ŒãŸGuardDutyã®èª¿æŸ»çµæœã¯ã€[æŠ‘åˆ¶ãƒ«ãƒ¼ãƒ«](https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html)ã‚’ä»‹ã—ã¦è‡ªå‹•çš„ã«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€ç”Ÿæˆã•ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹èª¿æŸ»çµæœã‚’è‡ªå‹•çš„ã«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã™ã‚‹ãŸã‚ã«ã€[ãƒ•ã‚£ãƒ«ã‚¿](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_filter-findings.html)ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ•ã‚£ãƒ«ã‚¿ã¯ã€[CreateFilter API](https://docs.aws.amazon.com/guardduty/latest/APIReference/API\_CreateFilter.html)ã‚’ä½¿ç”¨ã—ã¦ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
aws guardduty create-filter \
--action ARCHIVE \
--detector-id <detector-id> \
--name yourfiltername \
--finding-criteria file://criteria.json
```
### `guardduty:DeletePublishingDestination`

æ”»æ’ƒè€…ã¯ã€ã‚¢ãƒ©ãƒ¼ãƒˆã®å®›å…ˆã‚’[å‰Šé™¤ã™ã‚‹ã“ã¨](https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html)ã«ã‚ˆã£ã¦ã€ã‚¢ãƒ©ãƒ¼ãƒˆã®é€šçŸ¥ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```
aws guardduty delete-publishing-destination \
--detector-id <detector-id> \
--destination-id def456
```
### ãƒšãƒ³ãƒˆãƒ†ã‚¹ãƒˆã®çµæœ

GuardDutyã¯ä¸€èˆ¬çš„ãªãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã®AWS APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œå‡ºã—ã€[ãƒšãƒ³ãƒˆãƒ†ã‚¹ãƒˆã®çµæœ](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-iam.html#pentest-iam-kalilinux)ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚\
APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æ¸¡ã•ã‚Œã‚‹**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå**ã«ã‚ˆã£ã¦æ¤œå‡ºã•ã‚Œã¾ã™ã€‚\
ã—ãŸãŒã£ã¦ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¤‰æ›´**ã™ã‚‹ã“ã¨ã§ã€GuardDutyãŒæ”»æ’ƒã‚’æ¤œå‡ºã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

Ubuntuã€Macã€Windowsãªã©ã®OSã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œãªããªã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’é˜²ããŸã‚ã«ã¯ã€`botocore`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®`session.py`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ¤œç´¢ã—ã¾ã™ã€‚Kali Linuxã§ã¯ã€`/usr/local/lib/python3.7/dist-packages/botocore/session.py`ã«ã‚ã‚Šã¾ã™ã€‚

[456è¡Œç›®](https://github.com/boto/botocore/blob/7de36c07ecec503f588ac27658b1795e83b67b75/botocore/session.py#L456)ä»˜è¿‘ã«`platform.system()`ã¨`platform.release()`ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚’[**Pacu**](https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/user_agents.txt)ã«ã‚ã‚‹ã‚ˆã†ãª**æ­£å½“ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ–‡å­—åˆ—ã§ç½®ãæ›ãˆã¾ã™**ã€‚

### Torã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®çµæœ

**Tor**ã‹ã‚‰æ¥ç¶šã™ã‚‹ã¨ã€**GuardDuty**ã¯[**UnauthorizedAccess:EC2/TorClient**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-ec2.html#unauthorizedaccess-ec2-torclient)**ã¨ã„ã†ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨­å®šã—ã¾ã™**ã€‚

GuardDutyã¯ã€[Torãƒãƒ¼ãƒ‰ã®å…¬é–‹ãƒªã‚¹ãƒˆ](https://metrics.torproject.org/exonerator.html)ã«ã‚ˆã£ã¦ã“ã‚Œã‚’æ¤œå‡ºã—ã¾ã™ã€‚

Torã‚’ä»‹ã—ã¦æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€[**Bridges**](https://community.torproject.org/relay/types-of-relays/#Bridge)ã‚’ä½¿ç”¨ã—ã¦ã“ã‚Œã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€æ¥ç¶šã«Torã‚’ä½¿ç”¨ã—ãªã„æ–¹ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

ãƒ–ãƒªãƒƒã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€[Obfs4](https://gitlab.com/yawning/obfs4) (`apt install tor obfs4proxy`)ã‚’ä½¿ç”¨ã—ã€[bridges.torproject.org](https://bridges.torproject.org/options)ã‹ã‚‰ãƒ–ãƒªãƒƒã‚¸ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã—ã¾ã™ã€‚

ã“ã“ã‹ã‚‰ã€æ¬¡ã®ã‚ˆã†ãªtorrcãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
```
UseBridges 1
Bridge obfs4 <IP ADDRESS>:<PORT> <FINGERPRINT> cert=<cert_string> iat-mode=0
ClientTransportPlugin obfs4 exec /bin/obfs4proxy
```
æ¥½ã—ã„ `tor -f torrc` ã§ã€é€šå¸¸ã®ãƒãƒ¼ãƒˆ9050ã§ã‚½ãƒƒã‚¯ã‚¹5ãƒ—ãƒ­ã‚­ã‚·ã«æ¥ç¶šã§ãã¾ã™ã€‚

### è³‡æ ¼æƒ…å ±ã®æµå‡ºæ¤œçŸ¥

ã‚‚ã—ã€**EC2ã®è³‡æ ¼æƒ…å ±ã‚’ç›—ã¿å‡ºã—**ã€ãã‚Œã‚’**AWSã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®å¤–éƒ¨ã§ä½¿ç”¨**ã™ã‚‹å ´åˆã€ã‚¢ãƒ©ãƒ¼ãƒˆ [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.OutsideAWS](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws) ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚

ã•ã‚‰ã«ã€**è‡ªåˆ†è‡ªèº«ã®EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**ã‚’ä½¿ç”¨ã—ã¦ã€**ç›—ã¾ã‚ŒãŸè³‡æ ¼æƒ…å ±**ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ã‚¢ãƒ©ãƒ¼ãƒˆ [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.InsideAWS](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws) ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚

ãŸã ã—ã€ç¾åœ¨ã€ã“ã‚Œã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ - [VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ](https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints.html)ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚**VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€GuardDutyã®ã‚¢ãƒ©ãƒ¼ãƒˆã¯**ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã›ã‚“**ã€‚ã¤ã¾ã‚Šã€æ”»æ’ƒè€…ã¨ã—ã¦ã¯ã€`EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰IAMã®è³‡æ ¼æƒ…å ±ã‚’ç›—ã¿å‡ºã—ãŸå ´åˆã€VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä»‹ã—ã¦è‡ªåˆ†è‡ªèº«ã®EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ãã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€GuardDutyã®æ¤œå‡ºã¯è¡Œã‚ã‚Œã¾ã›ã‚“`ã€‚

ãƒ„ãƒ¼ãƒ« [**SneakyEndpoints**](https://github.com/Frichetten/SneakyEndpoints) ã¯ã€ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãŸã‚ã«ä½œæˆã•ã‚Œã¾ã—ãŸã€‚ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€Terraformã‚’ä½¿ç”¨ã—ã¦æ”»æ’ƒç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã®ãªã„ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚µãƒ–ãƒãƒƒãƒˆã«EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€ä½¿ç”¨ã™ã‚‹ãŸã‚ã®è¤‡æ•°ã®VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒã‚¤ãƒ‘ã‚¹ã™ã‚‹**åˆ¥ã®æ–¹æ³•**ã¯ã€ç›—ã¾ã‚ŒãŸè³‡æ ¼æƒ…å ±ã‚’**ç›—ã¾ã‚ŒãŸãƒã‚·ãƒ³ã¨åŒã˜ãƒã‚·ãƒ³**ã¾ãŸã¯**åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒã‚·ãƒ³**ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://hackingthe.cloud/aws/avoiding-detection/guardduty-pentest/](https://hackingthe.cloud/aws/avoiding-detection/guardduty-pentest/)
* [https://hackingthe.cloud/aws/avoiding-detection/guardduty-tor-client/](https://hackingthe.cloud/aws/avoiding-detection/guardduty-tor-client/)
* [https://hackingthe.cloud/aws/avoiding-detection/modify-guardduty-config/](https://hackingthe.cloud/aws/avoiding-detection/modify-guardduty-config/)
* [https://hackingthe.cloud/aws/avoiding-detection/steal-keys-undetected/](https://hackingthe.cloud/aws/avoiding-detection/steal-keys-undetected/)

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å—ã‘å–ã‚‹ï¼</strong></summary>

* **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼**ã—ãŸã„å ´åˆã‚„ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥æ‰‹**ã—ãŸã„å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ã”ç¢ºèªãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¾ã—ã‚‡ã† ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **HackTricks**ã¨**HackTricks Cloud**ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¾ã—ã‚‡ã†ã€‚

</details>
