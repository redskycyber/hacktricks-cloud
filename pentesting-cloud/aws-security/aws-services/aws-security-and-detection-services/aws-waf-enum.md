# AWS - Enumera√ß√£o do WAF

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

## WAF

O AWS WAF √© um **firewall de aplica√ß√£o web** que ajuda a **proteger suas aplica√ß√µes web** ou APIs contra exploits web comuns que podem afetar a disponibilidade, comprometer a seguran√ßa ou consumir recursos excessivos. O AWS WAF oferece controle sobre **como o tr√°fego chega √†s suas aplica√ß√µes** ao permitir que voc√™ crie **regras de seguran√ßa que bloqueiam padr√µes de ataque comuns**, como inje√ß√£o de SQL ou scripting entre sites, e regras que filtram padr√µes de tr√°fego espec√≠ficos que voc√™ define.

### Condi√ß√µes

As condi√ß√µes permitem que voc√™ especifique **quais elementos da solicita√ß√£o HTTP ou HTTPS de entrada voc√™ deseja que o WAF monitore** (XSS, GEO - filtragem por localiza√ß√£o -, endere√ßo IP, restri√ß√µes de tamanho, ataques de inje√ß√£o de SQL, correspond√™ncia de strings e regex). Observe que, se voc√™ estiver restringindo um pa√≠s do CloudFront, essa solicita√ß√£o n√£o chegar√° ao WAF.

Voc√™ pode ter **100 condi√ß√µes de cada tipo**, como Geo Match ou restri√ß√µes de tamanho, no entanto, **Regex** √© a **exce√ß√£o** a essa regra, onde **apenas 10 condi√ß√µes Regex** s√£o permitidas, mas esse limite √© poss√≠vel de aumentar. Voc√™ pode ter **100 regras e 50 Web ACLs por conta da AWS**. Voc√™ est√° limitado a **5 regras baseadas em taxa** por conta. Finalmente, voc√™ pode ter **10.000 solicita√ß√µes por segundo** ao **usar o WAF** dentro do seu balanceador de carga de aplicativo.

### Regras

Usando essas condi√ß√µes, voc√™ pode criar regras: por exemplo, bloquear solicita√ß√£o se 2 condi√ß√µes forem atendidas.\
Ao criar sua regra, voc√™ ser√° solicitado a selecionar um **Tipo de Regra**: **Regra Regular** ou **Regra Baseada em Taxa**.

A √∫nica **diferen√ßa** entre uma regra baseada em taxa e uma regra regular √© que as regras baseadas em taxa **contam** o **n√∫mero** de **solicita√ß√µes** que est√£o sendo recebidas de um determinado endere√ßo IP durante um per√≠odo de tempo de **cinco minutos**.

Ao selecionar a op√ß√£o de regra baseada em taxa, voc√™ √© solicitado a **inserir o n√∫mero m√°ximo de solicita√ß√µes de um √∫nico IP dentro de um per√≠odo de cinco minutos**. Quando o limite de contagem √© **atingido**, **todas as outras solicita√ß√µes desse mesmo endere√ßo IP s√£o bloqueadas**. Se a taxa de solicita√ß√£o voltar abaixo do limite de taxa especificado, o tr√°fego √© permitido a passar e n√£o √© mais bloqueado. Ao definir seu limite de taxa, ele **deve ser definido para um valor acima de 2000**. Qualquer solicita√ß√£o abaixo desse limite √© considerada uma Regra Regular.

### A√ß√µes

Uma a√ß√£o √© aplicada a cada regra, essas a√ß√µes podem ser **Permitir**, **Bloquear** ou **Contar**.

* Quando uma solicita√ß√£o √© **permitida**, ela √© **encaminhada** para a distribui√ß√£o do CloudFront relevante ou para o balanceador de carga de aplicativo.
* Quando uma solicita√ß√£o √© **bloqueada**, a solicita√ß√£o √© **encerrada** ali e nenhum processamento adicional dessa solicita√ß√£o √© realizado.
* Uma a√ß√£o de **Contagem** ir√° **contar o n√∫mero de solicita√ß√µes que atendem √†s condi√ß√µes** dentro dessa regra. Esta √© uma op√ß√£o muito boa para selecionar ao testar as regras para garantir que a regra esteja captando as solicita√ß√µes conforme o esperado antes de defini-la como Permitir ou Bloquear.

Se uma **solicita√ß√£o de entrada n√£o atender a nenhuma regra** dentro do Web ACL, a solicita√ß√£o adota a a√ß√£o associada a uma **a√ß√£o padr√£o** especificada, que pode ser **Permitir** ou **Bloquear**. Um ponto importante a ser observado sobre essas regras √© que elas s√£o **executadas na ordem em que s√£o listadas dentro de um Web ACL**. Portanto, tenha cuidado ao arquitetar essa ordem corretamente para sua base de regras, **tipicamente** elas s√£o **ordenadas** como mostrado:

1. IPs na lista branca como Permitir.
2. IPs na lista negra como Bloquear.
3. Qualquer assinatura ruim tamb√©m como Bloquear.

### CloudWatch

As m√©tricas do WAF CloudWatch s√£o relatadas **em intervalos de um minuto por padr√£o** e s√£o mantidas por um per√≠odo de duas semanas. As m√©tricas monitoradas s√£o Solicita√ß√µes Permitidas, Solicita√ß√µes Bloqueadas, Solicita√ß√µes Contadas e Solicita√ß√µes Passadas.

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>