# AWS - WAF Enum

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimizden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

# AWS WAF

AWS WAF, web uygulama gÃ¼venlik duvarÄ±dÄ±r ve web uygulamalarÄ±nÄ± veya API'leri Ã§eÅŸitli web saldÄ±rÄ±larÄ±na karÅŸÄ± korur. Bu saldÄ±rÄ±lar, uygulamalarÄ±n kullanÄ±labilirliÄŸini, gÃ¼venliÄŸini veya kaynak tÃ¼ketimini etkileyebilir. AWS WAF, kullanÄ±cÄ±larÄ±n SQL enjeksiyonu veya cross-site scripting gibi tipik saldÄ±rÄ± vektÃ¶rlerini engelleyen gÃ¼venlik kurallarÄ± ve Ã¶zel filtreleme kurallarÄ± belirleyerek gelen trafiÄŸi kontrol etmelerini saÄŸlar.

## Ä°zleme Kriterleri (KoÅŸullar)

KoÅŸullar, AWS WAF'Ä±n izlediÄŸi gelen HTTP/HTTPS isteklerinin unsurlarÄ±nÄ± belirtir. Bu unsurlar XSS, coÄŸrafi konum (GEO), IP adresleri, boyut kÄ±sÄ±tlamalarÄ±, SQL enjeksiyonu ve desenler (dize ve regex eÅŸleÅŸmesi) iÃ§erir. Ãœlkeye dayalÄ± olarak CloudFront seviyesinde kÄ±sÄ±tlanan istekler WAF'a ulaÅŸmayacaktÄ±r.

Her AWS hesabÄ± aÅŸaÄŸÄ±dakileri yapÄ±landÄ±rabilir:
- Her tÃ¼r iÃ§in **100 koÅŸul** (yalnÄ±zca Regex iÃ§in **10 koÅŸul** izin verilir, ancak bu sÄ±nÄ±rlama artÄ±rÄ±labilir).
- **100 kural** ve **50 Web ACL**.
- Maksimum **5 hÄ±z tabanlÄ± kural**.
- WAF bir uygulama yÃ¼k dengeleyici ile uygulandÄ±ÄŸÄ±nda **saniyede 10.000 istek** iÅŸleme kapasitesi.

## Kural YapÄ±landÄ±rmasÄ±

Kurallar belirtilen koÅŸullar kullanÄ±larak oluÅŸturulur. Ã–rneÄŸin, bir kural belirli 2 koÅŸulu karÅŸÄ±layan bir isteÄŸi engelleyebilir. Ä°ki tÃ¼r kural vardÄ±r:

1. **Normal Kural**: Belirtilen koÅŸullara dayalÄ± standart kural.
2. **HÄ±z TabanlÄ± Kural**: Belirli bir IP adresinden gelen istekleri beÅŸ dakikalÄ±k bir sÃ¼re iÃ§inde sayar. Burada kullanÄ±cÄ±lar bir eÅŸik belirler ve bir IP adresinden gelen isteklerin sayÄ±sÄ± bu sÄ±nÄ±rlamayÄ± beÅŸ dakika iÃ§inde aÅŸarsa, o IP adresinden gelen sonraki istekler eÅŸikten dÃ¼ÅŸene kadar engellenir. HÄ±z tabanlÄ± kurallar iÃ§in minimum eÅŸik deÄŸeri **2000 istek**tir.

## Eylemler

Her kurala **Ä°zin Ver**, **Engelle** veya **Say** seÃ§enekleri atanÄ±r:

- **Ä°zin Ver**: Ä°stek uygun CloudFront daÄŸÄ±tÄ±mÄ±na veya Uygulama YÃ¼k Dengeleyici'ye iletilir.
- **Engelle**: Ä°stek hemen sonlandÄ±rÄ±lÄ±r.
- **Say**: KuralÄ±n koÅŸullarÄ±nÄ± karÅŸÄ±layan istekleri sayar. Bu, kuralÄ±n doÄŸruluÄŸunu Allow veya Block olarak ayarlamadan Ã¶nce kuralÄ±n test edilmesi iÃ§in kullanÄ±ÅŸlÄ±dÄ±r.

Bir istek, Web ACL iÃ§indeki herhangi bir kurala uymazsa, **varsayÄ±lan eyleme** (Ä°zin Ver veya Engelle) tabi tutulur. Bir Web ACL iÃ§inde tanÄ±mlanan kural yÃ¼rÃ¼tme sÄ±rasÄ± Ã¶nemlidir ve genellikle aÅŸaÄŸÄ±daki sÄ±rayÄ± izler:

1. Beyaz Listelenen IP'leri Ä°zin Ver.
2. Kara Listelenen IP'leri Engelle.
3. ZararlÄ± imzalarla eÅŸleÅŸen istekleri Engelle.

## CloudWatch Entegrasyonu

AWS WAF, izleme iÃ§in CloudWatch ile entegre olur ve AllowedRequests, BlockedRequests, CountedRequests ve PassedRequests gibi metrikler sunar. Bu metrikler varsayÄ±lan olarak her dakika raporlanÄ±r ve iki hafta boyunca saklanÄ±r.

## NumaralandÄ±rma

Kapsam ayrÄ±ca CLOUDFRONT olabilir, ancak CLoudfront ile ilgili olmayan bir WAF iÃ§in kontrol etmek iÃ§in REGIONAL kullanmanÄ±z gerekmektedir.
```
# Get web acls
aws wafv2 list-web-acls --scope REGIONAL
aws wafv2 get-web-acl --scope REGIONAL --name <name> --id <id>
aws wafv2 list-resources-for-web-acl --web-acl-arn <web-acl-arn> #Resources associated with the ACL
aws wafv2 get-web-acl-for-resource --resource-arn <arn> # Get web acl of the resource

# Rule groups
aws wafv2 list-rule-groups --scope REGIONAL
aws wafv2 get-rule-group --scope REGIONAL --name <name> --id <id>

# Get IP sets
aws wafv2 list-ip-sets --scope=REGIONAL
aws wafv2 get-ip-set --scope=REGIONAL --name <name> --id <id>

# Get regex patterns
aws wafv2 list-regex-pattern-sets --scope REGIONAL

# Get logging config (buckets storing the logs)
aws wafv2 list-logging-configurations --scope=REGIONAL
```
## Son AÅŸama SaldÄ±rÄ±sÄ± / Atlama

{% hint style="success" %}
Bir saldÄ±rganÄ±n perspektifinden, bu hizmet saldÄ±rgana WAF korumalarÄ±nÄ± ve aÄŸ maruziyetlerini belirlemede yardÄ±mcÄ± olabilir ve diÄŸer web sitelerini ele geÃ§irmesine yardÄ±mcÄ± olabilir.

Ancak, bir saldÄ±rgan da bu hizmeti engellemekle ilgilenebilir, bÃ¶ylece web siteleri WAF tarafÄ±ndan korunmaz.
{% endhint %}

TODO: PR'lar kabul edilir

# Referanslar
* https://www.citrusconsulting.com/aws-web-application-firewall-waf/#:~:text=Conditions%20allow%20you%20to%20specify,user%20via%20a%20web%20application.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerimizden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
