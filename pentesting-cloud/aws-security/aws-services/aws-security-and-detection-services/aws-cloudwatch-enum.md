# AWS - CloudWatch Enum

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) **i** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **repozytori贸w GitHub**.

</details>

## CloudWatch

**CloudWatch** **zbiera** dane monitorujce i operacyjne w postaci log贸w/metryk/zdarze, zapewniajc **jednolite widoki zasob贸w AWS**, aplikacji i usug.\
Zdarzenia CloudWatch Log maj **ograniczenie rozmiaru 256 KB na ka偶d lini logu**.\
Mo偶e ustawia **alarmy o wysokiej rozdzielczoci**, wizualizowa **logi** i **metryki** obok siebie, podejmowa automatyczne dziaania, rozwizywa problemy i odkrywa wskaz贸wki do optymalizacji aplikacji.

Mo偶na monitorowa na przykad logi z CloudTrail. Monitorowane s nastpujce zdarzenia:

* Zmiany w grupach zabezpiecze i NACL
* Uruchamianie, zatrzymywanie, restartowanie i usuwanie instancji EC2
* Zmiany w politykach zabezpiecze w IAM i S3
* Nieudane pr贸by logowania do konsoli zarzdzania AWS
* Wywoania interfejsu API, kt贸re zakoczyy si nieudan autoryzacj
* Filtry do wyszukiwania w CloudWatch: [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

### CloudWatch Logs <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

Pozwala na **agregacj i monitorowanie log贸w z aplikacji** i system贸w z **usug AWS** (w tym CloudTrail) oraz z **aplikacji/system贸w** (na hocie mo偶na zainstalowa agenta CloudWatch). Logi mog by **przechowywane czas nieokrelony** (w zale偶noci od ustawie grupy log贸w) i mog by eksportowane.

**Elementy**:

| **Grupa log贸w**         | **Zbi贸r strumieni log贸w**, kt贸re maj takie same ustawienia retencji, monitorowania i kontroli dostpu                                                     |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Strumie log贸w**           | **Sekwencja zdarze log贸w**, kt贸re maj **ten sam 藕r贸do**                                                                                                |
| **Filtr subskrypcji** | Definiuje **wzorzec filtru, kt贸ry pasuje do zdarze** w okrelonej grupie log贸w, wysya je do strumienia Kinesis Data Firehose, strumienia Kinesis lub funkcji Lambda |

### CloudWatch Monitoring & Events

CloudWatch **podstawowy** agreguje dane **co 5 minut** (szczeg贸owy robi to **co 1 minut**). Po agregacji **sprawdza progi alarm贸w**, w przypadku potrzeby ich wywoania.\
W takim przypadku CloudWatch mo偶e by przygotowany do wysania zdarzenia i wykonania pewnych automatycznych dziaa (funkcje AWS Lambda, tematy SNS, kolejki SQS, strumienie Kinesis)

### Instalacja agenta

Mo偶esz zainstalowa agenty wewntrz swoich maszyn/kontener贸w, aby automatycznie wysya logi z powrotem do CloudWatch.

* **Utw贸rz** **rol** i **przypisz** j do **instancji** z uprawnieniami umo偶liwiajcymi CloudWatch zbieranie danych z instancji oraz interakcj z mened偶erem systemu AWS SSM (CloudWatchAgentAdminPolicy & AmazonEC2RoleforSSM)
* **Pobierz** i **zainstaluj** **agenta** na instancji EC2 ([https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip](https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip)). Mo偶esz go pobra z wntrza EC2 lub zainstalowa automatycznie za pomoc AWS System Manager, wybierajc pakiet AWS-ConfigureAWSPackage
* **Skonfiguruj** i **uruchom** agenta CloudWatch

Grupa log贸w ma wiele strumieni. Strumie ma wiele zdarze. A wewntrz ka偶dego strumienia zdarzenia s gwarantowane w kolejnoci.

## Dziaania

### Wyliczanie
```bash
# Dashboards
aws cloudwatch list-dashboards
aws cloudwatch get-dashboard --dashboard-name <dashboard_name>

# Alarms
aws cloudwatch describe-alarms
aws cloudwatch describe-alarm-history
aws cloudwatch describe-alarms-for-metric --metric-name <metric_name> --namespace <namespace>
aws cloudwatch describe-alarms-for-metric --metric-name IncomingLogEvents --namespace AWS/Logs

# Anomaly Detections
aws cloudwatch describe-anomaly-detectors
aws cloudwatch describe-insight-rules

# Logs
aws logs tail "<log_group_name>" --follow
aws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# Events enumeration
aws events list-rules
aws events describe-rule --name <name>
aws events list-targets-by-rule --rule <name>
aws events list-archives
aws events describe-archive --archive-name <name>
aws events list-connections
aws events describe-connection --name <name>
aws events list-endpoints
aws events describe-endpoint --name <name>
aws events list-event-sources
aws events describe-event-source --name <name>
aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## Odwoania

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
