# AWS - IAM, ÎšÎ­Î½Ï„ÏÎ¿ Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚ & SSO Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Î•Î¹Î´Î¹ÎºÏŒÏ‚ Red Team Ï„Î¿Ï… HackTricks Î³Î¹Î± Ï„Î¿ AWS)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± ÏƒÏ„Î¿ GitHub.

</details>

## IAM

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î¼Î¹Î± **Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î® Ï„Î¿Ï… IAM** ÏƒÎµ:

{% content-ref url="../aws-basic-information/" %}
[aws-basic-information](../aws-basic-information/)
{% endcontent-ref %}

### Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·

Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹:

* `iam:ListPolicies`, `iam:GetPolicy` ÎºÎ±Î¹ `iam:GetPolicyVersion`
* `iam:ListRoles`
* `iam:ListUsers`
* `iam:ListGroups`
* `iam:ListGroupsForUser`
* `iam:ListAttachedUserPolicies`
* `iam:ListAttachedRolePolicies`
* `iam:ListAttachedGroupPolicies`
* `iam:ListUserPolicies` ÎºÎ±Î¹ `iam:GetUserPolicy`
* `iam:ListGroupPolicies` ÎºÎ±Î¹ `iam:GetGroupPolicy`
* `iam:ListRolePolicies` ÎºÎ±Î¹ `iam:GetRolePolicy`
```bash
# All IAMs
## Retrieves  information about all IAM users, groups, roles, and policies
## in your Amazon Web Services account, including their relationships  to
## one another. Use this operation to obtain a snapshot of the configura-
## tion of IAM permissions (users, groups, roles, and  policies)  in  your
## account.
aws iam get-account-authorization-details

# List users
aws iam list-users
aws iam list-ssh-public-keys #User keys for CodeCommit
aws iam get-ssh-public-key --user-name <username> --ssh-public-key-id <id> --encoding SSH #Get public key with metadata
aws iam list-service-specific-credentials #Get special permissions of the IAM user over specific services
aws iam get-user --user-name <username> #Get metadata of user, included permissions boundaries
aws iam list-access-keys #List created access keys
## inline policies
aws iam list-user-policies --user-name <username> #Get inline policies of the user
aws iam get-user-policy --user-name <username> --policy-name <policyname> #Get inline policy details
## attached policies
aws iam list-attached-user-policies --user-name <username> #Get policies of user, it doesn't get inline policies

# List groups
aws iam list-groups #Get groups
aws iam list-groups-for-user --user-name <username> #Get groups of a user
aws iam get-group --group-name <name> #Get group name info
## inline policies
aws iam list-group-policies --group-name <username> #Get inline policies of the group
aws iam get-group-policy --group-name <username> --policy-name <policyname> #Get an inline policy info
## attached policies
aws iam list-attached-group-policies --group-name <name> #Get policies of group, it doesn't get inline policies

# List roles
aws iam list-roles #Get roles
aws iam get-role --role-name <role-name> #Get role
## inline policies
aws iam list-role-policies --role-name <name> #Get inline policies of a role
aws iam get-role-policy --role-name <name> --policy-name <name> #Get inline policy details
## attached policies
aws iam list-attached-role-policies --role-name <role-name> #Get policies of role, it doesn't get inline policies

# List policies
aws iam list-policies [--only-attached] [--scope Local]
aws iam list-policies-granting-service-access --arn <identity> --service-namespaces <svc> # Get list of policies that give access to the user to the service
## Get policy content
aws iam get-policy --policy-arn <policy_arn>
aws iam list-policy-versions --policy-arn <arn>
aws iam get-policy-version --policy-arn <arn:aws:iam::975426262029:policy/list_apigateways> --version-id <VERSION_X>

# Enumerate providers
aws iam list-saml-providers
aws iam get-saml-provider --saml-provider-arn <ARN>
aws iam list-open-id-connect-providers
aws iam get-open-id-connect-provider --open-id-connect-provider-arn <ARN>

# Password Policy
aws iam get-account-password-policy

# MFA
aws iam list-mfa-devices
aws iam list-virtual-mfa-devices
```
### Î’Î¯Î±Î¹Î· Î”ÏÎ½Î±Î¼Î· Î”Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½

Î•Î¬Î½ ÏƒÎ±Ï‚ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Ï…Î½ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î¬ ÏƒÎ±Ï‚ Î±Î»Î»Î¬ Î´ÎµÎ½ Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î³Î¹Î± Î½Î± ÎµÏÎµÏ…Î½Î®ÏƒÎµÏ„Îµ Ï„Î¿ IAM, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Ï€Î¬Î½Ï„Î± Î½Î± Ï„Î± Î±Î½Î±Î³ÎºÎ¬ÏƒÎµÏ„Îµ Î¼Îµ Î²Î¯Î±.

#### bf-aws-permissions

Î¤Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ [**bf-aws-permissions**](https://github.com/carlospolop/bf-aws-permissions) ÎµÎ¯Î½Î±Î¹ Î±Ï€Î»ÏÏ‚ Î­Î½Î± bash script Ï€Î¿Ï… Î¸Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ **`list*`, `describe*`, `get*`** Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î²ÏÎµÎ¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î± Î²Î¿Î®Î¸ÎµÎ¹Î±Ï‚ Ï„Î¿Ï… `aws` cli ÎºÎ±Î¹ **Î¸Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹ Ï„Î¹Ï‚ ÎµÏ€Î¹Ï„Ï…Ï‡ÎµÎ¯Ï‚ ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹Ï‚**.

{% code overflow="wrap" %}
```bash
# Bruteforce permissions
bash bf-aws-permissions.sh -p default > /tmp/bf-permissions-verbose.txt
```
{% endcode %}

#### bf-aws-perms-simulate

Î¤Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ [**bf-aws-perms-simulate**](https://github.com/carlospolop/bf-aws-perms-simulate) Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î²ÏÎµÎ¹ Ï„Î·Î½ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± Î¬Î´ÎµÎ¹Î± ÏƒÎ±Ï‚ (Î® Î±Ï…Ï„Î®Î½ Î¬Î»Î»Ï‰Î½ Î±ÏÏ‡ÏÎ½) Î±Î½ Î­Ï‡ÎµÏ„Îµ Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± **`iam:SimulatePrincipalPolicy`**
```bash
# Ask for permissions
python3 aws_permissions_checker.py --profile <AWS_PROFILE> [--arn <USER_ARN>]
```
#### Perms2ManagedPolicies

Î•Î¬Î½ Î²ÏÎ®ÎºÎ±Ï„Îµ **ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÏƒÎ±Ï‚**, ÎºÎ±Î¹ Ï€Î¹ÏƒÏ„ÎµÏÎµÏ„Îµ ÏŒÏ„Î¹ Ï„Î¿Ï…Ï‚ Ï‡Î¿ÏÎ·Î³Î¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Î­Î½Î± **Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î¿ ÏÏŒÎ»Î¿ AWS** (ÎºÎ±Î¹ ÏŒÏ‡Î¹ Î±Ï€ÏŒ Î­Î½Î±Î½ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î¿). ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ [**aws-Perms2ManagedRoles**](https://github.com/carlospolop/aws-Perms2ManagedPolicies) Î³Î¹Î± Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ **Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚ AWS Ï€Î¿Ï… Ï‡Î¿ÏÎ·Î³Î¿ÏÎ½ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï€Î¿Ï… Î±Î½Î±ÎºÎ±Î»ÏÏˆÎ±Ï„Îµ ÏŒÏ„Î¹ Î­Ï‡ÎµÏ„Îµ**.

{% code overflow="wrap" %}
```bash
# Run example with my profile
python3 aws-Perms2ManagedPolicies.py --profile myadmin --permissions-file example-permissions.txt
```
{% endcode %}

{% hint style="warning" %}
Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± "Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ" ÎµÎ¬Î½ Î¿Î¹ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï€Î¿Ï… Î­Ï‡ÎµÏ„Îµ Ï€Î±ÏÎ±Ï‡Ï‰ÏÎ·Î¸ÎµÎ¯ Î±Ï€ÏŒ Î­Î½Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î¿ ÏÏŒÎ»Î¿ AWS ÎµÎ¬Î½ Î´ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ **Î­Ï‡ÎµÏ„Îµ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï€Î¬Î½Ï‰ ÏƒÎµ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Ï€Î¿Ï… Î´ÎµÎ½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹**, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±.
{% endhint %}

#### Cloudtrail2IAM

[**CloudTrail2IAM**](https://github.com/carlospolop/Cloudtrail2IAM) ÎµÎ¯Î½Î±Î¹ Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Python Ï€Î¿Ï… Î±Î½Î±Î»ÏÎµÎ¹ Ï„Î± **logs AWS CloudTrail Î³Î¹Î± Î½Î± ÎµÎ¾Î¬Î³ÎµÎ¹ ÎºÎ±Î¹ Î½Î± ÏƒÏ…Î½Î¿ÏˆÎ¯Î¶ÎµÎ¹ Ï„Î¹Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚** Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î³Î¯Î½ÎµÎ¹ Î±Ï€ÏŒ ÏŒÎ»Î¿Ï…Ï‚ Î® Î±Ï€Î»Î¬ Î±Ï€ÏŒ Î­Î½Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ Ï‡ÏÎ®ÏƒÏ„Î· Î® ÏÏŒÎ»Î¿. Î¤Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î¸Î± **Î±Î½Î±Î»ÏÏƒÎµÎ¹ ÎºÎ¬Î¸Îµ log cloudtrail Î±Ï€ÏŒ Ï„Î¿Î½ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿ ÎºÎ¬Î´Î¿**.

{% code overflow="wrap" %}
```bash
git clone https://github.com/carlospolop/Cloudtrail2IAM
cd Cloudtrail2IAM
pip install -r requirements.txt
python3 cloudtrail2IAM.py --prefix PREFIX --bucket_name BUCKET_NAME --profile PROFILE [--filter-name FILTER_NAME] [--threads THREADS]
```
{% endcode %}

{% hint style="warning" %}
Î•Î¬Î½ Î²ÏÎµÎ¯Ï„Îµ Î±ÏÏ‡ÎµÎ¯Î± .tfstate (Terraform state files) Î® Î±ÏÏ‡ÎµÎ¯Î± CloudFormation (Î±Ï…Ï„Î¬ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î±ÏÏ‡ÎµÎ¯Î± yaml Ï€Î¿Ï… Î²ÏÎ¯ÏƒÎºÎ¿Î½Ï„Î±Î¹ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± bucket Î¼Îµ Ï„Î¿ Ï€ÏÏŒÎ¸ÎµÎ¼Î± cf-templates), Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Ï„Î± Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ Î³Î¹Î± Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î· Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· aws ÎºÎ±Î¹ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï€Î¿Î¹ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î­Ï‡Î¿Ï…Î½ Î±Î½Î±Ï„ÎµÎ¸ÎµÎ¯ ÏƒÎµ Ï€Î¿Î¹Î¿Î½.
{% endhint %}

#### enumerate-iam

Î“Î¹Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ [**https://github.com/andresriancho/enumerate-iam**](https://github.com/andresriancho/enumerate-iam) Ï€ÏÎ­Ï€ÎµÎ¹ Ï€ÏÏÏ„Î± Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ ÏŒÎ»Î± Ï„Î± ÏƒÎ·Î¼ÎµÎ¯Î± API AWS, Î±Ï€ÏŒ Î±Ï…Ï„Î¬ Ï„Î¿ script **`generate_bruteforce_tests.py`** Î¸Î± Ï€Î¬ÏÎµÎ¹ ÏŒÎ»Î± Ï„Î± **"list\_", "describe\_", ÎºÎ±Î¹ "get\_" endpoints.** ÎšÎ±Î¹ Ï„Î­Î»Î¿Ï‚, Î¸Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÎ¹ Î½Î± **Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·** ÏƒÎµ Î±Ï…Ï„Î¬ Î¼Îµ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± ÎºÎ±Î¹ **Î¸Î± Ï…Ï€Î¿Î´ÎµÎ¯Î¾ÎµÎ¹ Î±Î½ Î»ÎµÎ¹Ï„Î¿ÏÏÎ³Î·ÏƒÎµ**.

(ÎšÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¼Ï€ÎµÎ¹ÏÎ¯Î± Î¼Î¿Ï… Ï„Î¿ **ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ ÎºÎ¿Î»Î»Î¬ÎµÎ¹ ÏƒÎµ ÎºÎ¬Ï€Î¿Î¹Î¿ ÏƒÎ·Î¼ÎµÎ¯Î¿**, [**ÎµÎ»Î­Î³Î¾Ï„Îµ Î±Ï…Ï„Î®Î½ Ï„Î· Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·**](https://github.com/andresriancho/enumerate-iam/pull/15/commits/77ad5b41216e3b5f1511d0c385da8cd5984c2d3c) Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Ï„Î¿ Î´Î¹Î¿ÏÎ¸ÏÏƒÎµÏ„Îµ).

{% hint style="warning" %}
ÎšÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ¼Ï€ÎµÎ¹ÏÎ¯Î± Î¼Î¿Ï… Î±Ï…Ï„ÏŒ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ ÎµÎ¯Î½Î±Î¹ ÏƒÎ±Î½ Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î±Î»Î»Î¬ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‡ÎµÎ¹ÏÏŒÏ„ÎµÏÎ± ÎºÎ±Î¹ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î»Î¹Î³ÏŒÏ„ÎµÏÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚
{% endhint %}

{% code overflow="wrap" %}
```bash
# Install tool
git clone git@github.com:andresriancho/enumerate-iam.git
cd enumerate-iam/
pip install -r requirements.txt

# Download API endpoints
cd enumerate_iam/
git clone https://github.com/aws/aws-sdk-js.git
python3 generate_bruteforce_tests.py
rm -rf aws-sdk-js
cd ..

# Enumerate permissions
python3 enumerate-iam.py --access-key ACCESS_KEY --secret-key SECRET_KEY [--session-token SESSION_TOKEN] [--region REGION]
```
{% endcode %}

#### weirdAAL

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ [**weirdAAL**](https://github.com/carnal0wnage/weirdAAL/wiki). Î‘Ï…Ï„ÏŒ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î¸Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ **Ï€Î¿Î»Î»Î­Ï‚ ÎºÎ¿Î¹Î½Î­Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ ÏƒÎµ Î´Î¹Î¬Ï†Î¿ÏÎµÏ‚ ÎºÎ¿Î¹Î½Î­Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚** (Î¸Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î±Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·Ï‚ ÎºÎ±Î¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î±Ï‚ Î±ÏÎ¾Î·ÏƒÎ·Ï‚ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½). Î‘Î»Î»Î¬ Î¸Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Î¼ÏŒÎ½Î¿ Ï„Î¹Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½ÎµÏ‚ ÎµÎ»Î­Î³Î¾ÎµÎ¹Ï‚ (Î· Î¼Î¿Î½Î±Î´Î¹ÎºÎ® Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± ÎµÎ»Î­Î³Ï‡Î¿Ï… Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÏ‰Î½ Ï€ÏÎ±Î³Î¼Î¬Ï„Ï‰Î½ ÎµÎ¯Î½Î±Î¹ Î½Î± ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Ï„ÎµÏƒÏ„).
```bash
# Install
git clone https://github.com/carnal0wnage/weirdAAL.git
cd weirdAAL
python3 -m venv weirdAAL
source weirdAAL/bin/activate
pip3 install -r requirements.txt

# Create a .env file with aws credentials such as
[default]
aws_access_key_id = <insert key id>
aws_secret_access_key = <insert secret key>

# Setup DB
python3 create_dbs.py

# Invoke it
python3 weirdAAL.py -m ec2_describe_instances -t ec2test # Just some ec2 tests
python3 weirdAAL.py -m recon_all -t MyTarget # Check all permissions
# You will see output such as:
# [+] elbv2 Actions allowed are [+]
# ['DescribeLoadBalancers', 'DescribeAccountLimits', 'DescribeTargetGroups']
```
#### Î•ÏÎ³Î±Î»ÎµÎ¯Î± Î•Î½Î¯ÏƒÏ‡Ï…ÏƒÎ·Ï‚ Î³Î¹Î± BF Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±

{% tabs %}
{% tab title="CloudSploit" %}
{% code overflow="wrap" %}
```bash
# Export env variables
./index.js --console=text --config ./config.js --json /tmp/out-cloudsploit.json

# Filter results removing unknown
jq 'map(select(.status | contains("UNKNOWN") | not))' /tmp/out-cloudsploit.json | jq 'map(select(.resource | contains("N/A") | not))' > /tmp/out-cloudsploit-filt.json

# Get services by regions
jq 'group_by(.region) | map({(.[0].region): ([map((.resource | split(":"))[2]) | unique])})' ~/Desktop/pentests/cere/greybox/core-dev-dev-cloudsploit-filtered.json
```
{% endcode %}
{% endtab %}

{% tab title="SteamPipe" %}
```bash
# https://github.com/turbot/steampipe-mod-aws-insights
steampipe check all --export=json

# https://github.com/turbot/steampipe-mod-aws-perimeter
# In this case you cannot output to JSON, so heck it in the dashboard
steampipe dashboard
```
{% endtab %}
{% endtabs %}

#### \<Î¤Î¿Î•ÏÎ³Î±Î»ÎµÎ¯Î¿Î£Î±Ï‚>

ÎšÎ±Î½Î­Î½Î± Î±Ï€ÏŒ Ï„Î± Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î± Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î¹ÎºÎ±Î½ÏŒ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ ÎºÎ¿Î½Ï„Î¬ ÏƒÎµ ÏŒÎ»Î± Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±, Î¿Ï€ÏŒÏ„Îµ Î±Î½ Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Î­Î½Î± ÎºÎ±Î»ÏÏ„ÎµÏÎ¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿, ÏƒÏ„ÎµÎ¯Î»Ï„Îµ Î­Î½Î± PR!

### ÎœÎ· Î•Î¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Î ÏÏŒÏƒÎ²Î±ÏƒÎ·

{% content-ref url="../../aws-pentesting/aws-unauthenticated-enum-access/aws-iam-and-sts-unauthenticated-enum.md" %}
[aws-iam-and-sts-unauthenticated-enum.md](../../aws-pentesting/aws-unauthenticated-enum-access/aws-iam-and-sts-unauthenticated-enum.md)
{% endcontent-ref %}

### Î‘Î½ÏŒÎ´Î¿Ï‚ Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½

Î£Ï„Î·Î½ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î· ÏƒÎµÎ»Î¯Î´Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï€ÏÏ‚ Î½Î± **ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± IAM Î³Î¹Î± Î±Î½ÏŒÎ´Î¿ Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½**:

{% content-ref url="../aws-privilege-escalation/aws-iam-privesc.md" %}
[aws-iam-privesc.md](../aws-privilege-escalation/aws-iam-privesc.md)
{% endcontent-ref %}

### ÎœÎµÏ„Î¬ Ï„Î·Î½ Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Ï„Î¿Ï… IAM

{% content-ref url="../../aws-pentesting/aws-post-exploitation/aws-iam-post-exploitation.md" %}
[aws-iam-post-exploitation.md](../../aws-pentesting/aws-post-exploitation/aws-iam-post-exploitation.md)
{% endcontent-ref %}

### Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Ï„Î¿Ï… IAM

{% content-ref url="../aws-persistence/aws-iam-persistence.md" %}
[aws-iam-persistence.md](../aws-persistence/aws-iam-persistence.md)
{% endcontent-ref %}

## ÎšÎ­Î½Ï„ÏÎ¿ Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚ IAM

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î¼Î¹Î± **Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î® Ï„Î¿Ï… ÎšÎ­Î½Ï„ÏÎ¿Ï… Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚ IAM** ÏƒÏ„Î¿:

{% content-ref url="../aws-basic-information/" %}
[aws-basic-information](../aws-basic-information/)
{% endcontent-ref %}

### Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Î­ÏƒÏ‰ SSO Î¼Îµ Ï„Î¿ CLI
```bash
# Connect with sso via CLI aws configure sso
aws configure sso

[profile profile_name]
sso_start_url = https://subdomain.awsapps.com/start/
sso_account_id = <account_numbre>
sso_role_name = AdministratorAccess
sso_region = us-east-1
```
### Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·

Î¤Î± ÎºÏÏÎ¹Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Î¿Ï… ÎšÎ­Î½Ï„ÏÎ¿Ï… Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚ ÎµÎ¯Î½Î±Î¹:

* Î§ÏÎ®ÏƒÏ„ÎµÏ‚ ÎºÎ±Î¹ Î¿Î¼Î¬Î´ÎµÏ‚
* Î£ÏÎ½Î¿Î»Î± Î”Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½: ÎˆÏ‡Î¿Ï…Î½ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ ÎµÏ€Î¹ÏƒÏ…Î½Î±Ï€Ï„ÏŒÎ¼ÎµÎ½ÎµÏ‚
* AWS Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Î¯

Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ‡Î­ÏƒÎµÎ¹Ï‚ ÏÏƒÏ„Îµ Î¿Î¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚/Î¿Î¼Î¬Î´ÎµÏ‚ Î½Î± Î­Ï‡Î¿Ï…Î½ Î£ÏÎ½Î¿Î»Î± Î”Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Ï€Î¬Î½Ï‰ ÏƒÏ„Î¿Î½ AWS Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ.

{% hint style="info" %}
Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ· ÏŒÏ„Î¹ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ 3 Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Ï€Î¿Î»Î¹Ï„Î¹ÎºÏÎ½ ÏƒÎµ Î­Î½Î± Î£ÏÎ½Î¿Î»Î¿ Î”Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½. Î— ÏƒÏÎ½Î´ÎµÏƒÎ· Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Ï‰Î½ Ï€Î¿Î»Î¹Ï„Î¹ÎºÏÎ½ AWS, Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Ï‰Î½ Ï€Î¿Î»Î¹Ï„Î¹ÎºÏÎ½ Ï€ÎµÎ»Î±Ï„ÏÎ½ (Î±Ï…Ï„Î­Ï‚ Î¿Î¹ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸Î¿ÏÎ½ ÏƒÎµ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿ÏÏ‚ Ï€Î¿Ï… ÎµÏ€Î·ÏÎµÎ¬Î¶ÎµÎ¹ Ï„Î¿ Î£ÏÎ½Î¿Î»Î¿ Î”Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½) ÎºÎ±Î¹ ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Ï‰Î½ Ï€Î¿Î»Î¹Ï„Î¹ÎºÏÎ½ (Î¿ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ ÎµÎºÎµÎ¯).
{% endhint %}
```bash
# Check if IAM Identity Center is used
aws sso-admin list-instances

# Get Permissions sets. These are the policies that can be assigned
aws sso-admin list-permission-sets --instance-arn <instance-arn>
aws sso-admin describe-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn>

## Get managed policies of a permission set
aws sso-admin list-managed-policies-in-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn>
## Get inline policies of a permission set
aws sso-admin get-inline-policy-for-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn>
## Get customer managed policies of a permission set
aws sso-admin list-customer-managed-policy-references-in-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn>
## Get boundaries of a permission set
aws sso-admin get-permissions-boundary-for-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn>

## List accounts a permission set is affecting
aws sso-admin list-accounts-for-provisioned-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn>
## List principals given a permission set in an account
aws sso-admin list-account-assignments --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --account-id <account_id>

# Get permissions sets affecting an account
aws sso-admin list-permission-sets-provisioned-to-account --instance-arn <instance-arn> --account-id <account_id>

# List users & groups from the identity store
aws identitystore list-users --identity-store-id <store-id>
aws identitystore list-groups --identity-store-id <store-id>
## Get members of groups
aws identitystore list-group-memberships --identity-store-id <store-id> --group-id <group-id>
## Get memberships or a user or a group
aws identitystore list-group-memberships-for-member --identity-store-id <store-id> --member-id <member-id>
```
### Î¤Î¿Ï€Î¹ÎºÎ® Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ `$HOME/.aws` Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ config Î³Î¹Î± Î½Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ„Îµ Ï€ÏÎ¿Ï†Î¯Î» Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î± Î¼Î­ÏƒÏ‰ SSO, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:
```ini
[default]
region = us-west-2
output = json

[profile my-sso-profile]
sso_start_url = https://my-sso-portal.awsapps.com/start
sso_region = us-west-2
sso_account_id = 123456789012
sso_role_name = MySSORole
region = us-west-2
output = json

[profile dependent-profile]
role_arn = arn:aws:iam::<acc-id>:role/ReadOnlyRole
source_profile = Hacktricks-Admin
```
Î‘Ï…Ï„Î® Î· Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¼Îµ Ï„Î¹Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ½Ï„Î¿Î»Î­Ï‚:
```bash
# Login in ms-sso-profile
aws sso login --profile my-sso-profile
# Use dependent-profile
aws s3 ls --profile dependent-profile
```
ÎŒÏ„Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î­Î½Î± **Ï€ÏÎ¿Ï†Î¯Î» Î±Ï€ÏŒ SSO** Î³Î¹Î± Î½Î± Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚, Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± **Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ ÏƒÎµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿** **`$HOME/.aws/sso/cache`**. ÎˆÏ„ÏƒÎ¹ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± **Î´Î¹Î±Î²Î±ÏƒÏ„Î¿ÏÎ½ ÎºÎ±Î¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î±Ï€ÏŒ ÎµÎºÎµÎ¯**.

Î•Ï€Î¹Ï€Î»Î­Î¿Î½, **Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±** Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Ï„Î¿ÏÎ½ ÏƒÏ„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ **`$HOME/.aws/cli/cache`**. Î‘Ï…Ï„ÏŒÏ‚ Î¿ Ï†Î¬ÎºÎµÎ»Î¿Ï‚ cache Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ ÎºÏ…ÏÎ¯Ï‰Ï‚ ÏŒÏ„Î±Î½ **ÎµÏÎ³Î¬Î¶ÎµÏƒÏ„Îµ Î¼Îµ Ï€ÏÎ¿Ï†Î¯Î» AWS CLI** Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± IAM Ï‡ÏÎ®ÏƒÏ„Î· Î® **Ï…Ï€Î¿Î¸Î­Ï„Î¿Ï…Î½** ÏÏŒÎ»Î¿Ï…Ï‚ Î¼Î­ÏƒÏ‰ IAM (Ï‡Ï‰ÏÎ¯Ï‚ SSO). Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± ÏÏÎ¸Î¼Î¹ÏƒÎ·Ï‚:
```ini
[profile crossaccountrole]
role_arn = arn:aws:iam::234567890123:role/SomeRole
source_profile = default
mfa_serial = arn:aws:iam::123456789012:mfa/saanvi
external_id = 123456
```
### ÎœÎ· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·

{% content-ref url="../aws-unauthenticated-enum-access/aws-identity-center-and-sso-unauthenticated-enum.md" %}
[aws-identity-center-and-sso-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-identity-center-and-sso-unauthenticated-enum.md)
{% endcontent-ref %}

### Î‘Î½ÏŒÎ´Î¿Ï‚ Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½

{% content-ref url="../../aws-pentesting/aws-privilege-escalation/aws-sso-and-identitystore-privesc.md" %}
[aws-sso-and-identitystore-privesc.md](../../aws-pentesting/aws-privilege-escalation/aws-sso-and-identitystore-privesc.md)
{% endcontent-ref %}

### ÎœÎµÏ„Î¬ Ï„Î·Î½ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

{% content-ref url="../aws-post-exploitation/aws-sso-and-identitystore-post-exploitation.md" %}
[aws-sso-and-identitystore-post-exploitation.md](../aws-post-exploitation/aws-sso-and-identitystore-post-exploitation.md)
{% endcontent-ref %}

### Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ·

#### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ½ÏŒÏ‚ Ï‡ÏÎ®ÏƒÏ„Î· ÎºÎ±Î¹ Î±Î½Î¬Î¸ÎµÏƒÎ· Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÏƒÎµ Î±Ï…Ï„ÏŒÎ½

{% code overflow="wrap" %}
```bash
# Create user identitystore:CreateUser
aws identitystore create-user --identity-store-id <store-id> --user-name privesc --display-name privesc --emails Value=sdkabflvwsljyclpma@tmmbt.net,Type=Work,Primary=True --name Formatted=privesc,FamilyName=privesc,GivenName=privesc
## After creating it try to login in the console using the selected username, you will receive an email with the code and then you will be able to select a password
```
{% endcode %}

* Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î¼Î¹Î± Î¿Î¼Î¬Î´Î± ÎºÎ±Î¹ Î±Î½Î±Î¸Î­ÏƒÏ„Îµ Ï„Î·Ï‚ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎºÎ±Î¹ Î¿ÏÎ¯ÏƒÏ„Îµ Î­Î½Î±Î½ ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿ Ï‡ÏÎ®ÏƒÏ„Î·
* Î”ÏÏƒÏ„Îµ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÏƒÎµ Î­Î½Î±Î½ ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿ Ï‡ÏÎ®ÏƒÏ„Î· Î® Î¿Î¼Î¬Î´Î±
* Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, Î¼ÏŒÎ½Î¿ Î¿Î¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Îµ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î±Ï€ÏŒ Ï„Î¿Î½ Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î­Ï‡Î¿Ï…Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÎºÎ±Î¹ Î­Î»ÎµÎ³Ï‡Î¿ ÏƒÏ„Î¿ ÎšÎ­Î½Ï„ÏÎ¿ Î¤Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚ IAM.

Î©ÏƒÏ„ÏŒÏƒÎ¿, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… Î‘Î½Î±Î¸Î­Ï„Î¿Î½Ï„Î± Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® Î½Î± ÎµÏ€Î¹Ï„ÏÎ±Ï€ÎµÎ¯ ÏƒÎµ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î±Ï€ÏŒ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î½Î± Ï„Î¿ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î¿ÏÎ½. Î”ÎµÎ½ Î¸Î± Î­Ï‡Î¿Ï…Î½ Î±ÎºÏÎ¹Î²ÏÏ‚ Ï„Î± Î¯Î´Î¹Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±, Î±Î»Î»Î¬ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½ [**Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„ÎµÏ‚ Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚**](https://docs.aws.amazon.com/singlesignon/latest/userguide/delegated-admin.html).
