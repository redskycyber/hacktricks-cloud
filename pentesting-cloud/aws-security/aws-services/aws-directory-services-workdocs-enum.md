# AWS - Directory Services / WorkDocs Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## Directory Services

AWS Directory Service for Microsoft Active Directory, AWS Bulutunda bir dizin oluÅŸturmayÄ±, iÅŸletmeyi ve Ã¶lÃ§eklendirmeyi kolaylaÅŸtÄ±ran bir yÃ¶netilen hizmettir. GerÃ§ek **Microsoft Active Directory** Ã¼zerine inÅŸa edilmiÅŸtir ve diÄŸer AWS hizmetleriyle sÄ±kÄ± bir ÅŸekilde entegre olur, bu da dizinle ilgili iÅŸ yÃ¼klerinizi ve AWS kaynaklarÄ±nÄ±zÄ± yÃ¶netmeyi kolaylaÅŸtÄ±rÄ±r. AWS YÃ¶netilen Microsoft AD ile mevcut Active Directory kullanÄ±cÄ±larÄ±nÄ±zÄ±, gruplarÄ±nÄ±zÄ± ve politikalarÄ±nÄ±zÄ± AWS kaynaklarÄ±nÄ±za eriÅŸimi yÃ¶netmek iÃ§in kullanabilirsiniz. Bu, kimlik yÃ¶netiminizi basitleÅŸtirebilir ve ek kimlik Ã§Ã¶zÃ¼mlerine olan ihtiyacÄ± azaltabilir. AWS YÃ¶netilen Microsoft AD ayrÄ±ca otomatik yedekleme ve felaket kurtarma yetenekleri saÄŸlar, bu da dizininizin kullanÄ±labilirliÄŸini ve dayanÄ±klÄ±lÄ±ÄŸÄ±nÄ± saÄŸlamaya yardÄ±mcÄ± olur. Genel olarak, AWS Directory Service for Microsoft Active Directory, AWS Bulutunda yÃ¶netilen, yÃ¼ksek kullanÄ±labilirlikli ve Ã¶lÃ§eklenebilir bir Active Directory hizmeti saÄŸlayarak zaman ve kaynak tasarrufu yapmanÄ±za yardÄ±mcÄ± olabilir.

### SeÃ§enekler

Directory Services, 5 tÃ¼r dizin oluÅŸturmanÄ±za izin verir:

* **AWS YÃ¶netilen Microsoft AD**: AWS'de yeni bir **Microsoft AD Ã§alÄ±ÅŸtÄ±racak**. YÃ¶netici ÅŸifresini ayarlayabilir ve bir VPC'deki DC'lere eriÅŸebilirsiniz.
* **Basit AD**: **Linux-Samba** Active Directory uyumlu sunucusu olacak. YÃ¶netici ÅŸifresini ayarlayabilir ve bir VPC'deki DC'lere eriÅŸebilirsiniz.
* **AD BaÄŸlayÄ±cÄ±sÄ±**: Bulutta herhangi bir bilgiyi Ã¶nbelleÄŸe almadan, mevcut Microsoft Active Directory'nize yÃ¶nlendirme dizin istekleri iÃ§in bir proxy. Bir **VPC** Ã¼zerinde dinleyecek ve mevcut AD'ye eriÅŸmek iÃ§in **kimlik bilgilerini** vermeniz gerekecek.
* **Amazon Cognito KullanÄ±cÄ± HavuzlarÄ±**: Bu, Cognito KullanÄ±cÄ± HavuzlarÄ± ile aynÄ±dÄ±r.
* **Cloud Directory**: Bu en basit olanÄ±dÄ±r. Kullanmak istediÄŸiniz **ÅŸemayÄ±** belirttiÄŸiniz ve kullanÄ±ma gÃ¶re **faturalandÄ±rÄ±ldÄ±ÄŸÄ±nÄ±z** bir **sunucusuz** dizin.

AWS Directory hizmetleri, mevcut yerel Microsoft AD'nizle **senkronize etmenize**, AWS'de **kendi AD'nizi Ã§alÄ±ÅŸtÄ±rmanÄ±za** veya **diÄŸer dizin tÃ¼rleriyle senkronize etmenize** olanak tanÄ±r.

### Lab

AWS'de kendi Microsoft AD'nizi oluÅŸturmak iÃ§in gÃ¼zel bir Ã¶ÄŸreticiye buradan ulaÅŸabilirsiniz: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Enumerasyon
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### GiriÅŸ

Dizinin **aÃ§Ä±klamasÄ±nda** **`AccessUrl`** alanÄ±nda bir **alan adÄ±** bulunuyorsa, bir **kullanÄ±cÄ±nÄ±n** muhtemelen **AD kimlik bilgileriyle** bazÄ± **AWS hizmetlerine giriÅŸ yapabileceÄŸi** anlamÄ±na gelir:

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon YÃ¶netim Konsolu)
* `<name>.awsapps.com/start` (IAM Kimlik Merkezi)

### Yetki YÃ¼kseltme

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## KalÄ±cÄ±lÄ±k

### Bir AD kullanÄ±cÄ±sÄ± kullanarak

Bir **AD kullanÄ±cÄ±sÄ±**, bir RolÃ¼ varsaymak iÃ§in **AWS yÃ¶netim konsoluna eriÅŸim** saÄŸlanabilir. **VarsayÄ±lan kullanÄ±cÄ± adÄ± Admin**'dir ve AWS konsolundan **ÅŸifresi deÄŸiÅŸtirilebilir**.

Bu nedenle, **Admin'in ÅŸifresi deÄŸiÅŸtirilebilir**, **yeni bir kullanÄ±cÄ± oluÅŸturulabilir** veya bir kullanÄ±cÄ±nÄ±n ÅŸifresi deÄŸiÅŸtirilebilir ve bu kullanÄ±cÄ±ya eriÅŸimi sÃ¼rdÃ¼rmek iÃ§in bir Rol verilebilir.\
AyrÄ±ca, bir kullanÄ±cÄ±yÄ± AD iÃ§inde bir gruba **eklemek** ve bu AD grubuna bir Rol **eriÅŸim vermek** de mÃ¼mkÃ¼ndÃ¼r (bu kalÄ±cÄ±lÄ±ÄŸÄ± daha gizli hale getirmek iÃ§in).

### AD paylaÅŸÄ±mÄ± (kurbandan saldÄ±rgana)

Bir kurbandan saldÄ±rgana bir AD ortamÄ± paylaÅŸmak mÃ¼mkÃ¼ndÃ¼r. Bu ÅŸekilde saldÄ±rgan, AD ortamÄ±na eriÅŸmeye devam edebilecektir.\
Ancak, bu, yÃ¶netilen AD'nin paylaÅŸÄ±lmasÄ±nÄ± ve aynÄ± zamanda bir VPC eÅŸleme baÄŸlantÄ±sÄ± oluÅŸturulmasÄ±nÄ± gerektirir.

Bir kÄ±lavuz burada bulunabilir: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~AD paylaÅŸÄ±mÄ± (saldÄ±rgan tarafÄ±ndan kurbanÄ±na)~~

FarklÄ± bir AD ortamÄ±ndan kullanÄ±cÄ±lara AWS eriÅŸimi vermek, bir AWS hesabÄ±na mÃ¼mkÃ¼n gÃ¶rÃ¼nmÃ¼yor.

## WorkDocs

Amazon Web Services (AWS) WorkDocs, bulut tabanlÄ± bir **dosya depolama ve paylaÅŸÄ±m hizmetidir**. AWS'nin bulut biliÅŸim hizmetleri paketinin bir parÃ§asÄ±dÄ±r ve kuruluÅŸlarÄ±n dosya ve belgeleri depolamak, paylaÅŸmak ve iÅŸbirliÄŸi yapmak iÃ§in gÃ¼venli ve Ã¶lÃ§eklenebilir bir Ã§Ã¶zÃ¼m sunmak Ã¼zere tasarlanmÄ±ÅŸtÄ±r.

AWS WorkDocs, kullanÄ±cÄ±larÄ±n dosyalarÄ±nÄ± ve belgelerini yÃ¼klemeleri, eriÅŸmeleri ve yÃ¶netmeleri iÃ§in web tabanlÄ± bir arayÃ¼z saÄŸlar. AyrÄ±ca, sÃ¼rÃ¼m kontrolÃ¼, gerÃ§ek zamanlÄ± iÅŸbirliÄŸi ve diÄŸer AWS hizmetleri ve Ã¼Ã§Ã¼ncÃ¼ taraf araÃ§larla entegrasyon gibi Ã¶zellikler sunar.

### NumaralandÄ±rma

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Privesc

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>A'dan Z'ye AWS hackleme becerilerini Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI'na**](https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
