# AWS - Directory Services / WorkDocs æšä¸¾

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## Directory Services

AWS Directory Service for Microsoft Active Directory æ˜¯ä¸€é¡¹æ‰˜ç®¡æœåŠ¡ï¼Œå¯ä»¥è½»æ¾**è®¾ç½®ã€æ“ä½œå’Œæ‰©å±•**åœ¨AWSäº‘ä¸­çš„ç›®å½•ã€‚å®ƒåŸºäºçœŸæ­£çš„**Microsoft Active Directory**æ„å»ºï¼Œå¹¶ä¸å…¶ä»–AWSæœåŠ¡ç´§å¯†é›†æˆï¼Œä¾¿äºç®¡ç†æ‚¨çš„ç›®å½•æ„ŸçŸ¥å·¥ä½œè´Ÿè½½å’ŒAWSèµ„æºã€‚ä½¿ç”¨AWSæ‰˜ç®¡çš„Microsoft ADï¼Œæ‚¨å¯ä»¥**ä½¿ç”¨ç°æœ‰çš„** Active Directoryç”¨æˆ·ã€ç»„å’Œç­–ç•¥æ¥ç®¡ç†å¯¹AWSèµ„æºçš„è®¿é—®ã€‚è¿™æœ‰åŠ©äºç®€åŒ–èº«ä»½ç®¡ç†ï¼Œå¹¶å‡å°‘å¯¹é¢å¤–èº«ä»½è§£å†³æ–¹æ¡ˆçš„éœ€æ±‚ã€‚AWSæ‰˜ç®¡çš„Microsoft ADè¿˜æä¾›è‡ªåŠ¨å¤‡ä»½å’Œç¾éš¾æ¢å¤èƒ½åŠ›ï¼Œå¸®åŠ©ç¡®ä¿æ‚¨çš„ç›®å½•çš„å¯ç”¨æ€§å’ŒæŒä¹…æ€§ã€‚æ€»çš„æ¥è¯´ï¼ŒAWS Directory Service for Microsoft Active Directoryå¯ä»¥å¸®åŠ©æ‚¨èŠ‚çœæ—¶é—´å’Œèµ„æºï¼Œå› ä¸ºå®ƒåœ¨AWSäº‘ä¸­æä¾›äº†ä¸€ä¸ªæ‰˜ç®¡çš„ã€é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•çš„Active DirectoryæœåŠ¡ã€‚

### é€‰é¡¹

Directory Services å…è®¸åˆ›å»º5ç§ç±»å‹çš„ç›®å½•ï¼š

* **AWSæ‰˜ç®¡çš„Microsoft AD**ï¼šå°†åœ¨AWSä¸­è¿è¡Œä¸€ä¸ªæ–°çš„**Microsoft AD**ã€‚æ‚¨å°†èƒ½å¤Ÿè®¾ç½®ç®¡ç†å‘˜å¯†ç å¹¶åœ¨VPCä¸­è®¿é—®DCã€‚
* **Simple AD**ï¼šå°†æ˜¯ä¸€ä¸ª**Linux-Samba**å…¼å®¹Active Directoryçš„æœåŠ¡å™¨ã€‚æ‚¨å°†èƒ½å¤Ÿè®¾ç½®ç®¡ç†å‘˜å¯†ç å¹¶åœ¨VPCä¸­è®¿é—®DCã€‚
* **AD Connector**ï¼šä¸€ä¸ªä»£ç†ï¼Œç”¨äº**å°†ç›®å½•è¯·æ±‚é‡å®šå‘åˆ°ç°æœ‰çš„Microsoft Active Directory**ï¼Œè€Œä¸åœ¨äº‘ä¸­ç¼“å­˜ä»»ä½•ä¿¡æ¯ã€‚å®ƒå°†åœ¨**VPC**ä¸­ç›‘å¬ï¼Œæ‚¨éœ€è¦æä¾›**è®¿é—®ç°æœ‰ADçš„å‡­æ®**ã€‚
* **Amazon Cognito ç”¨æˆ·æ± **ï¼šä¸Cognitoç”¨æˆ·æ± ç›¸åŒã€‚
* **Cloud Directory**ï¼šè¿™æ˜¯æœ€**ç®€å•**çš„ä¸€ä¸ªã€‚ä¸€ä¸ª**æ— æœåŠ¡å™¨**çš„ç›®å½•ï¼Œæ‚¨å¯ä»¥æŒ‡å®šè¦ä½¿ç”¨çš„**æ¨¡å¼**ï¼Œå¹¶æ ¹æ®ä½¿ç”¨æƒ…å†µ**è®¡è´¹**ã€‚

AWS Directory Services å…è®¸ä¸æ‚¨ç°æœ‰çš„**æœ¬åœ°** Microsoft AD **åŒæ­¥**ï¼Œåœ¨AWSä¸­**è¿è¡Œæ‚¨è‡ªå·±çš„**ï¼Œæˆ–ä¸**å…¶ä»–ç›®å½•ç±»å‹**åŒæ­¥ã€‚

### å®éªŒå®¤

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¾ˆå¥½çš„æ•™ç¨‹ï¼Œç”¨äºåœ¨AWSä¸­åˆ›å»ºæ‚¨è‡ªå·±çš„Microsoft ADï¼š[https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### æšä¸¾
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### ç™»å½•

æ³¨æ„ï¼Œå¦‚æœç›®å½•çš„**æè¿°**ä¸­åŒ…å«äº†**åŸŸå**ï¼Œåœ¨**`AccessUrl`**å­—æ®µä¸­ï¼Œè¿™æ„å‘³ç€**ç”¨æˆ·**å¯èƒ½å¯ä»¥ä½¿ç”¨å…¶**ADå‡­æ®**ç™»å½•ä»¥ä¸‹ä¸€äº›**AWSæœåŠ¡**ï¼š

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon Management Console)
* `<name>.awsapps.com/start` (IAM Identity Center)

### æƒé™æå‡

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## æŒä¹…æ€§

### ä½¿ç”¨ADç”¨æˆ·

**ADç”¨æˆ·**å¯ä»¥é€šè¿‡å‡è®¾çš„è§’è‰²è·å¾—**AWSç®¡ç†æ§åˆ¶å°çš„è®¿é—®æƒé™**ã€‚**é»˜è®¤ç”¨æˆ·åæ˜¯Admin**ï¼Œå¯ä»¥ä»AWSæ§åˆ¶å°**æ›´æ”¹å…¶å¯†ç **ã€‚

å› æ­¤ï¼Œå¯ä»¥**æ›´æ”¹Adminçš„å¯†ç **ï¼Œ**åˆ›å»ºæ–°ç”¨æˆ·**æˆ–**æ›´æ”¹ç”¨æˆ·å¯†ç **å¹¶æˆäºˆè¯¥ç”¨æˆ·è§’è‰²ä»¥ä¿æŒè®¿é—®æƒé™ã€‚\
ä¹Ÿå¯ä»¥**å°†ç”¨æˆ·æ·»åŠ åˆ°ADä¸­çš„ç»„**å¹¶**æˆäºˆè¯¥ADç»„å¯¹è§’è‰²çš„è®¿é—®æƒé™**ï¼ˆä»¥ä½¿è¿™ç§æŒä¹…æ€§æ›´éšè”½ï¼‰ã€‚

### å…±äº«ADï¼ˆä»å—å®³è€…åˆ°æ”»å‡»è€…ï¼‰

å¯ä»¥ä»å—å®³è€…é‚£é‡Œå…±äº«ADç¯å¢ƒç»™æ”»å‡»è€…ã€‚è¿™æ ·æ”»å‡»è€…å°†èƒ½å¤Ÿç»§ç»­è®¿é—®ADç¯å¢ƒã€‚\
ç„¶è€Œï¼Œè¿™æ„å‘³ç€å…±äº«æ‰˜ç®¡çš„ADï¼Œå¹¶ä¸”è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªVPCå¯¹ç­‰è¿æ¥ã€‚

æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æŒ‡å—ï¼š[https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~å…±äº«ADï¼ˆä»æ”»å‡»è€…åˆ°å—å®³è€…ï¼‰~~

çœ‹èµ·æ¥ä¸å¯èƒ½æˆäºˆæ¥è‡ªä¸åŒADç¯å¢ƒçš„ç”¨æˆ·å¯¹ä¸€ä¸ªAWSè´¦æˆ·çš„AWSè®¿é—®æƒé™ã€‚

## WorkDocs

Amazon Web Services (AWS) WorkDocsæ˜¯ä¸€ä¸ªåŸºäºäº‘çš„**æ–‡ä»¶å­˜å‚¨å’Œå…±äº«æœåŠ¡**ã€‚å®ƒæ˜¯AWSäº‘è®¡ç®—æœåŠ¡å¥—ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œæ—¨åœ¨ä¸ºç»„ç»‡æä¾›ä¸€ä¸ªå®‰å…¨ä¸”å¯æ‰©å±•çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºå­˜å‚¨ã€å…±äº«å’Œåä½œæ–‡ä»¶å’Œæ–‡æ¡£ã€‚

AWS WorkDocsæä¾›äº†ä¸€ä¸ªåŸºäºç½‘ç»œçš„ç•Œé¢ï¼Œä¾›ç”¨æˆ·ä¸Šä¼ ã€è®¿é—®å’Œç®¡ç†ä»–ä»¬çš„æ–‡ä»¶å’Œæ–‡æ¡£ã€‚å®ƒè¿˜æä¾›äº†ç‰ˆæœ¬æ§åˆ¶ã€å®æ—¶åä½œä»¥åŠä¸å…¶ä»–AWSæœåŠ¡å’Œç¬¬ä¸‰æ–¹å·¥å…·é›†æˆçš„åŠŸèƒ½ã€‚

### æšä¸¾

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### æƒé™æå‡

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF ç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š[**å…³æ³¨**](https://twitter.com/carlospolopm) **æˆ‘**ã€‚
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>
