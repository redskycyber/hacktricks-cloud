# AWS - STS æšä¸¾

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS çº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆçš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)** ä¸Šå…³æ³¨æˆ‘ä»¬**ã€‚
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## STS

**AWS å®‰å…¨ä»¤ç‰ŒæœåŠ¡ (STS)** ä¸»è¦è®¾è®¡ç”¨äºé¢å‘**ä¸´æ—¶ã€å—é™ç‰¹æƒå‡­è¯**ã€‚è¿™äº›å‡­è¯å¯ä¸º**AWS èº«ä»½å’Œè®¿é—®ç®¡ç† (IAM)** ç”¨æˆ·æˆ–ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼ˆè”åˆç”¨æˆ·ï¼‰è¯·æ±‚ã€‚

é‰´äº STS çš„ç›®çš„æ˜¯**ä¸ºèº«ä»½å†’å……é¢å‘å‡­è¯**ï¼Œè¯¥æœåŠ¡å¯¹äº**å‡çº§æƒé™å’Œä¿æŒæŒä¹…æ€§**éå¸¸æœ‰ä»·å€¼ï¼Œå³ä½¿å®ƒå¯èƒ½æ²¡æœ‰å¹¿æ³›çš„é€‰é¡¹ã€‚

### å‡å®šè§’è‰²å†’å……

ç”± AWS STS æä¾›çš„ [AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API\_AssumeRole.html) æ“ä½œè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå…è®¸ä¸»ä½“è·å–å¦ä¸€ä¸ªä¸»ä½“çš„å‡­è¯ï¼Œå®è´¨ä¸Šæ˜¯åœ¨å†’å……ä»–ä»¬ã€‚è°ƒç”¨åï¼Œå®ƒä¼šè¿”å›ä¸æŒ‡å®š ARN å¯¹åº”çš„è®¿é—®å¯†é’¥ IDã€ç§˜å¯†å¯†é’¥å’Œä¼šè¯ä»¤ç‰Œã€‚

å¯¹äºæ¸—é€æµ‹è¯•äººå‘˜æˆ–çº¢é˜Ÿæˆå‘˜ï¼Œè¿™ç§æŠ€æœ¯å¯¹äºç‰¹æƒå‡çº§è‡³å…³é‡è¦ï¼ˆè¯¦è§[**æ­¤å¤„**](../aws-privilege-escalation/aws-sts-privesc.md#sts-assumerole)ï¼‰ã€‚ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æŠ€æœ¯ç›¸å½“æ˜¾çœ¼ï¼Œå¯èƒ½ä¸ä¼šè®©æ”»å‡»è€…æªæ‰‹ä¸åŠã€‚


#### å‡å®šè§’è‰²é€»è¾‘

ä¸ºäº†åœ¨**å…è®¸æ˜ç¡®æŒ‡å®šè§’è‰² ARN çš„æƒ…å†µä¸‹**åœ¨åŒä¸€è´¦æˆ·ä¸­å‡å®šä¸€ä¸ªè§’è‰²ï¼Œå°±åƒè¿™æ ·ï¼š
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:role/priv-role"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**`priv-role`** è§’è‰²**ä¸éœ€è¦è¢«æ˜ç¡®å…è®¸**å»å‡å®šè¯¥è§’è‰²ï¼ˆåªè¦æœ‰è¿™ç§å…è®¸å°±è¶³å¤Ÿäº†ï¼‰ã€‚

ç„¶è€Œï¼Œå¦‚æœä¸€ä¸ªè§’è‰²å…è®¸ä¸€ä¸ªè´¦æˆ·å»å‡å®šå®ƒï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:root"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
è¦å°è¯•æ‰®æ¼”çš„è§’è‰²å°†éœ€è¦å¯¹è¯¥è§’è‰²å…·æœ‰ç‰¹å®šçš„`sts:AssumeRole`æƒé™æ‰èƒ½æ‰®æ¼”è¯¥è§’è‰²ã€‚

å¦‚æœå°è¯•ä»ä¸åŒè´¦æˆ·æ‰®æ¼”ä¸€ä¸ªè§’è‰²ï¼Œé‚£ä¹ˆè¢«å‡å®šçš„è§’è‰²å¿…é¡»å…è®¸æ­¤æ“ä½œï¼ˆæŒ‡å®šè§’è‰²çš„ARNæˆ–å¤–éƒ¨è´¦æˆ·ï¼‰ï¼Œè€Œè¯•å›¾æ‰®æ¼”å¦ä¸€ä¸ªè§’è‰²çš„è§’è‰²**å¿…é¡»**å…·æœ‰æ‰®æ¼”è¯¥è§’è‰²çš„æƒé™ï¼ˆå³ä½¿è¢«å‡å®šçš„è§’è‰²æŒ‡å®šäº†ä¸€ä¸ªARNï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹è¿™å¹¶éå¯é€‰é¡¹ï¼‰ã€‚

### æšä¸¾
```bash
# Get basic info of the creds
aws sts get-caller-identity
aws sts get-access-key-info --access-key-id <AccessKeyID>

# Get CLI a session token with current creds
## Using CLI creds
## You cannot get session creds using session creds
aws sts get-session-token
## MFA
aws sts get-session-token --serial-number <arn_device> --token-code <otp_code>
```
### ææƒ

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨STSæƒé™æ¥æå‡ç‰¹æƒ**ï¼š

{% content-ref url="../aws-privilege-escalation/aws-sts-privesc.md" %}
[aws-sts-privesc.md](../aws-privilege-escalation/aws-sts-privesc.md)
{% endcontent-ref %}

### åæ¸—é€

{% content-ref url="../../aws-pentesting/aws-post-exploitation/aws-sts-post-exploitation.md" %}
[aws-sts-post-exploitation.md](../../aws-pentesting/aws-post-exploitation/aws-sts-post-exploitation.md)
{% endcontent-ref %}

### æŒä¹…åŒ–

{% content-ref url="../aws-persistence/aws-iam-persistence.md" %}
[aws-iam-persistence.md](../aws-persistence/aws-iam-persistence.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
