# AWS - STS æšä¸¾

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ç›´åˆ°æˆä¸ºä¸“å®¶ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

å…¶ä»–æ”¯æŒHackTricksçš„æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## STS

AWSæä¾›äº†**å®‰å…¨ä»¤ç‰ŒæœåŠ¡ï¼ˆAWS STSï¼‰**ï¼Œè¿™æ˜¯ä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œå®ƒå…è®¸æ‚¨ä¸º**AWSèº«ä»½ä¸è®¿é—®ç®¡ç†**ï¼ˆIAMï¼‰ç”¨æˆ·æˆ–æ‚¨è®¤è¯çš„ç”¨æˆ·ï¼ˆè”åˆç”¨æˆ·ï¼‰**è¯·æ±‚**ä¸´æ—¶çš„ã€æƒé™æœ‰é™çš„**å‡­è¯**ã€‚

ç”±äºSTSæœåŠ¡çš„æœ¬è´¨æ˜¯**æä¾›å‡­è¯ä»¥æ¨¡æ‹Ÿèº«ä»½**ï¼Œå³ä½¿è¿™é¡¹æœåŠ¡æ²¡æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œå®ƒå¯¹äº**æå‡æƒé™å’Œè·å¾—æŒä¹…æ€§**éå¸¸æœ‰ç”¨ã€‚

### å‡è®¾è§’è‰²æ¨¡æ‹Ÿ

AWS STSçš„[AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API\_AssumeRole.html)æ“ä½œå…è®¸ä¸€ä¸ªä¸»ä½“è¯·æ±‚å¦ä¸€ä¸ªä¸»ä½“çš„å‡­è¯ä»¥æ¨¡æ‹Ÿä»–ã€‚è°ƒç”¨å®ƒæ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæŒ‡å®šARNçš„è®¿é—®å¯†é’¥IDã€å¯†é’¥å’Œä¼šè¯ä»¤ç‰Œã€‚

ä½œä¸ºæ¸—é€æµ‹è¯•äººå‘˜æˆ–çº¢é˜Ÿæˆå‘˜ï¼Œè¿™ç§æŠ€æœ¯å¯¹äºæå‡æƒé™å¾ˆæœ‰ç”¨ï¼ˆå¦‚[**è¿™é‡Œ**](../aws-privilege-escalation/aws-sts-privesc.md#sts-assumerole)æ‰€è§£é‡Šçš„ï¼‰ï¼Œä½†å®ƒæ˜¯æå‡æƒé™æœ€æ˜æ˜¾çš„æŠ€æœ¯ï¼Œå› æ­¤ä¸ä¼šè®©æ”»å‡»è€…æ„Ÿåˆ°æ„å¤–ã€‚

#### å‡è®¾è§’è‰²é€»è¾‘

å¦‚æœè¦åœ¨åŒä¸€ä¸ªè´¦æˆ·ä¸­å‡è®¾ä¸€ä¸ªè§’è‰²ï¼Œä¸”**è¦å‡è®¾çš„è§’è‰²ç‰¹åˆ«å…è®¸ä¸€ä¸ªè§’è‰²ARN**ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:role/priv-role"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
è§’è‰² **`priv-role`** åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ**æ— éœ€ç‰¹åˆ«å…è®¸**æ‰èƒ½æ‰¿æ‹…è¯¥è§’è‰²ï¼ˆæœ‰äº†é‚£ä¸ªè®¸å¯å°±è¶³å¤Ÿäº†ï¼‰ã€‚

ç„¶è€Œï¼Œå¦‚æœä¸€ä¸ªè§’è‰²å…è®¸ä¸€ä¸ªè´¦æˆ·æ‰¿æ‹…å®ƒï¼Œåƒåœ¨ï¼š
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:root"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
### æšä¸¾

å°è¯•æ‰®æ¼”è¯¥è§’è‰²å°†éœ€è¦å¯¹è¯¥è§’è‰²çš„**ç‰¹å®š `sts:AssumeRole` æƒé™**ä»¥**æ‰®æ¼”å®ƒ**ã€‚

å¦‚æœæ‚¨å°è¯•ä»**ä¸åŒè´¦æˆ·**æ‰®æ¼”ä¸€ä¸ª**è§’è‰²**ï¼Œ**è¢«æ‰®æ¼”çš„è§’è‰²å¿…é¡»å…è®¸å®ƒ**ï¼ˆæŒ‡æ˜è§’è‰²**ARN**æˆ–**å¤–éƒ¨è´¦æˆ·**ï¼‰ï¼Œå¹¶ä¸”**å°è¯•æ‰®æ¼”**å¦ä¸€ä¸ªè§’è‰²çš„**è§’è‰²å¿…é¡»**æ‹¥æœ‰**æ‰®æ¼”å®ƒçš„æƒé™**ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿è¢«æ‰®æ¼”çš„è§’è‰²æŒ‡å®šäº†ARNï¼Œè¿™ä¹Ÿä¸æ˜¯å¯é€‰çš„ï¼‰ã€‚
```bash
# Get basic info of the creds
aws sts get-caller-identity
aws sts get-access-key-info --access-key-id <AccessKeyID>

# Get CLI a session token with current creds
## Using CLI creds
## You cannot get session creds using session creds
aws sts get-session-token
## MFA
aws sts get-session-token --serial-number <arn_device> --token-code <otp_code>
```
### æƒé™æå‡

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨ STS æƒé™æ¥æå‡æƒé™**ï¼š

{% content-ref url="../aws-privilege-escalation/aws-sts-privesc.md" %}
[aws-sts-privesc.md](../aws-privilege-escalation/aws-sts-privesc.md)
{% endcontent-ref %}

### åæœŸåˆ©ç”¨

{% content-ref url="../../aws-pentesting/aws-post-exploitation/aws-sts-post-exploitation.md" %}
[aws-sts-post-exploitation.md](../../aws-pentesting/aws-post-exploitation/aws-sts-post-exploitation.md)
{% endcontent-ref %}

### æŒä¹…æ€§

{% content-ref url="../aws-persistence/aws-iam-persistence.md" %}
[aws-iam-persistence.md](../aws-persistence/aws-iam-persistence.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ **HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„ [**NFTs é›†åˆ**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
