# AWS - STSæšä¸¾

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## STS

AWSæä¾›AWS **Security Token Service (AWS STS)** ä½œä¸ºä¸€ä¸ªWebæœåŠ¡ï¼Œä½¿æ‚¨èƒ½å¤Ÿä¸ºAWS Identity and Access Management (IAM) ç”¨æˆ·æˆ–æ‚¨è®¤è¯çš„ç”¨æˆ·ï¼ˆè”åˆç”¨æˆ·ï¼‰**è¯·æ±‚**ä¸´æ—¶çš„ã€æœ‰é™çš„**å‡­è¯**ã€‚

ç”±äºSTSæœåŠ¡çš„æ€§è´¨æ˜¯**æä¾›å‡­è¯ä»¥æ¨¡æ‹Ÿèº«ä»½**ï¼Œå³ä½¿é€‰é¡¹ä¸å¤šï¼Œè¯¥æœåŠ¡ä¹Ÿéå¸¸æœ‰ç”¨äº**å‡çº§æƒé™å’Œè·å–æŒä¹…æ€§**ã€‚

### æ‰®æ¼”è§’è‰²

AWS STSçš„[AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html)æ“ä½œå…è®¸ä¸€ä¸ªä¸»ä½“è¯·æ±‚å¦ä¸€ä¸ªä¸»ä½“çš„å‡­è¯ä»¥æ¨¡æ‹Ÿä»–ã€‚è°ƒç”¨å®ƒæ—¶ï¼Œå®ƒä¼šè¿”å›æŒ‡å®šARNçš„è®¿é—®å¯†é’¥IDã€ç§˜å¯†å¯†é’¥å’Œä¼šè¯ä»¤ç‰Œã€‚

ä½œä¸ºæ¸—é€æµ‹è¯•äººå‘˜æˆ–çº¢é˜Ÿäººå‘˜ï¼Œè¿™ç§æŠ€æœ¯å¯¹äºç‰¹æƒå‡çº§å¾ˆæœ‰ç”¨ï¼ˆå¦‚[**æ­¤å¤„**](../aws-privilege-escalation/aws-sts-privesc.md#sts-assumerole)æ‰€è¿°ï¼‰ï¼Œä½†è¿™æ˜¯æœ€æ˜æ˜¾çš„ç‰¹æƒå‡çº§æŠ€æœ¯ï¼Œæ‰€ä»¥ä¸ä¼šè®©æ”»å‡»è€…æ„Ÿåˆ°æ„å¤–ã€‚

#### æ‰®æ¼”è§’è‰²é€»è¾‘

ä¸ºäº†åœ¨åŒä¸€ä¸ªè´¦æˆ·ä¸­æ‰®æ¼”ä¸€ä¸ªè§’è‰²ï¼Œå¦‚æœ**è¦æ‰®æ¼”çš„è§’è‰²å…è®¸ç‰¹å®šçš„è§’è‰²ARN**ï¼Œå°±åƒåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼š
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:role/priv-role"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè§’è‰²**`priv-role`**ä¸éœ€è¦è¢«ç‰¹åˆ«å…è®¸æ‰®æ¼”è¯¥è§’è‰²ï¼ˆåªè¦æœ‰è¿™ä¸ªå…è®¸å°±è¶³å¤Ÿäº†ï¼‰ã€‚

ç„¶è€Œï¼Œå¦‚æœä¸€ä¸ªè§’è‰²å…è®¸ä¸€ä¸ªè´¦æˆ·æ‰®æ¼”å®ƒï¼Œå°±åƒè¿™æ ·ï¼š
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:root"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
å°è¯•æ‰®æ¼”çš„è§’è‰²éœ€è¦å¯¹è¯¥è§’è‰²å…·æœ‰ç‰¹å®šçš„`sts:AssumeRole`æƒé™æ¥è¿›è¡Œæ‰®æ¼”ã€‚

å¦‚æœæ‚¨å°è¯•ä»ä¸åŒçš„è´¦æˆ·æ‰®æ¼”ä¸€ä¸ªè§’è‰²ï¼Œé‚£ä¹ˆè¢«æ‰®æ¼”çš„è§’è‰²å¿…é¡»å…è®¸æ­¤æ“ä½œï¼ˆæŒ‡å®šè§’è‰²çš„ARNæˆ–å¤–éƒ¨è´¦æˆ·ï¼‰ï¼Œè€Œå°è¯•æ‰®æ¼”å…¶ä»–è§’è‰²çš„è§’è‰²å¿…é¡»å…·æœ‰æ‰®æ¼”è¯¥è§’è‰²çš„æƒé™ï¼ˆå³ä½¿è¢«æ‰®æ¼”çš„è§’è‰²æŒ‡å®šäº†ARNï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ˜¯å¿…éœ€çš„ï¼‰ã€‚

### æšä¸¾
```bash
# Get basic info of the creds
aws sts get-caller-identity
aws sts get-access-key-info --access-key-id <AccessKeyID>

# Get CLI a session token with current creds
## Using CLI creds
## You cannot get session creds using session creds
aws sts get-session-token
## MFA
aws sts get-session-token --serial-number <arn_device> --token-code <otp_code>
```
### ææƒ

åœ¨ä¸‹é¢çš„é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•æ»¥ç”¨STSæƒé™ä»¥æå‡ç‰¹æƒï¼š

{% content-ref url="../aws-privilege-escalation/aws-sts-privesc.md" %}
[aws-sts-privesc.md](../aws-privilege-escalation/aws-sts-privesc.md)
{% endcontent-ref %}

### æ¼æ´åˆ©ç”¨åæœŸé˜¶æ®µ

{% content-ref url="../../aws-pentesting/aws-post-exploitation/aws-sts-post-exploitation.md" %}
[aws-sts-post-exploitation.md](../../aws-pentesting/aws-post-exploitation/aws-sts-post-exploitation.md)
{% endcontent-ref %}

### æŒä¹…åŒ–

{% content-ref url="../aws-persistence/aws-iam-persistence.md" %}
[aws-iam-persistence.md](../aws-persistence/aws-iam-persistence.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist)

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„åŠ¨æ€ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
