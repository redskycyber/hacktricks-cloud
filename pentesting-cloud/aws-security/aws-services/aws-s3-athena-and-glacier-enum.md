# AWS - S3, Athena & Glacier Enum

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub**.

</details>

## S3

Amazon S3 - —Ü–µ —Å–µ—Ä–≤—ñ—Å, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º **–∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤–µ–ª–∏–∫—ñ –æ–±—Å—è–≥–∏ –¥–∞–Ω–∏—Ö**.

Amazon S3 –Ω–∞–¥–∞—î –∫—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –¥–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è **–∑–∞—Ö–∏—Å—Ç—É** –¥–∞–Ω–∏—Ö —É —Å–ø–æ–∫–æ—ó. –û–ø—Ü—ñ—ó –≤–∫–ª—é—á–∞—é—Ç—å **–¥–æ–∑–≤—ñ–ª** (–ø–æ–ª—ñ—Ç–∏–∫–∞), **—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è** (–∫–ª—ñ—î–Ω—Ç—Å—å–∫–µ —Ç–∞ —Å–µ—Ä–≤–µ—Ä–Ω–µ), **–≤–µ—Ä—Å—ñ—é –≤—ñ–¥–∂–µ—Ç–∞** —Ç–∞ **–≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ MFA**. **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏** –±—É–¥—å-—è–∫—É –∑ —Ü–∏—Ö –æ–ø—Ü—ñ–π –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –∑–∞—Ö–∏—Å—Ç—É –¥–∞–Ω–∏—Ö. **–†–µ–ø–ª—ñ–∫–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö** - —Ü–µ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å–µ—Ä–≤—ñ—Å AWS, –¥–µ **S3 –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–µ–ø–ª—ñ–∫—É—î –∫–æ–∂–µ–Ω –æ–±'—î–∫—Ç —É –≤—Å—ñ—Ö –∑–æ–Ω–∞—Ö –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ**, —ñ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –Ω–µ –ø–æ–≤–∏–Ω–Ω–∞ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Ü–µ —É —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É.

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –¥–æ–∑–≤–æ–ª—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–µ—Å—É—Ä—Å—ñ–≤ –º–æ–∂–Ω–∞ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –¥–æ–∑–≤–æ–ª–∏ –¥–ª—è –ø—ñ–¥–∫–∞—Ç–∞–ª–æ–≥—ñ–≤ –≤–∞—à–æ–≥–æ –≤—ñ–¥–∂–µ—Ç–∞ –æ–∫—Ä–µ–º–æ.

### –í–µ—Ä—Å—ñ—é–≤–∞–Ω–Ω—è –≤—ñ–¥–∂–µ—Ç–∞ —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ MFA

–ö–æ–ª–∏ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ –≤–µ—Ä—Å—ñ—é–≤–∞–Ω–Ω—è –≤—ñ–¥–∂–µ—Ç–∞, –±—É–¥—å-—è–∫–∞ –¥—ñ—è, —è–∫–∞ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –∑–º—ñ–Ω–∏—Ç–∏ —Ñ–∞–π–ª –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ–∞–π–ª—É, –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏–º–µ –Ω–æ–≤—É –≤–µ—Ä—Å—ñ—é —Ñ–∞–π–ª—É, –∑–±–µ—Ä—ñ–≥–∞—é—á–∏ —Ç–∞–∫–æ–∂ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –≤–º—ñ—Å—Ç —Ç–æ–≥–æ –∂ —Å–∞–º–æ–≥–æ. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤—ñ–Ω –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ —Å–≤—ñ–π –≤–º—ñ—Å—Ç.

–ö—Ä—ñ–º —Ç–æ–≥–æ, –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ MFA –∑–∞–ø–æ–±—ñ–≥–∞—Ç–∏–º–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—é –≤–µ—Ä—Å—ñ–π —Ñ–∞–π–ª—É —É –≤—ñ–¥–∂–µ—Ç—ñ S3 —Ç–∞ —Ç–∞–∫–æ–∂ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—é –≤–µ—Ä—Å—ñ—é–≤–∞–Ω–Ω—è –≤—ñ–¥–∂–µ—Ç–∞, —Ç–æ–º—É –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –Ω–µ –∑–º–æ–∂–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Ü—ñ —Ñ–∞–π–ª–∏.

### –ñ—É—Ä–Ω–∞–ª–∏ –¥–æ—Å—Ç—É–ø—É –¥–æ S3

–ú–æ–∂–ª–∏–≤–æ **–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏ –¥–æ—Å—Ç—É–ø—É –¥–æ S3** (—è–∫—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–∏–º–∫–Ω–µ–Ω—ñ) –¥–ª—è –¥–µ—è–∫–æ–≥–æ –≤—ñ–¥–∂–µ—Ç–∞ —Ç–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏ –≤ —ñ–Ω—à–æ–º—É –≤—ñ–¥–∂–µ—Ç—ñ, —â–æ–± –∑–Ω–∞—Ç–∏, —Ö—Ç–æ –æ—Ç—Ä–∏–º—É—î –¥–æ—Å—Ç—É–ø –¥–æ –≤—ñ–¥–∂–µ—Ç–∞ (–æ–±–∏–¥–≤–∞ –≤—ñ–¥–∂–µ—Ç–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –≤ –æ–¥–Ω–æ–º—É —Ä–µ–≥—ñ–æ–Ω—ñ).

### –ü—ñ–¥–ø–∏—Å–∞–Ω—ñ URL-–∞–¥—Ä–µ—Å–∏ S3

–ú–æ–∂–ª–∏–≤–æ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π URL-–∞–¥—Ä–µ—Å—É, —è–∫–∏–π –∑–∞–∑–≤–∏—á–∞–π –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è **–¥–æ—Å—Ç—É–ø—É –¥–æ –≤–∫–∞–∑–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É** —É –≤—ñ–¥–∂–µ—Ç—ñ. **–ü—ñ–¥–ø–∏—Å–∞–Ω–∏–π URL-–∞–¥—Ä–µ—Å–∞ –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫**:
```
https://<bucket-name>.s3.us-east-1.amazonaws.com/asd.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAUUE8GZC4S5L3TY3P%2F20230227%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20230227T142551Z&X-Amz-Expires=3600&X-Amz-SignedHeaders=host&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJHMEUCIBhQpdETJO3HKKDk2hjNIrPWwBE8gZaQccZFV3kCpPCWAiEAid3ueDtFFU%2FOQfUpvxYTGO%2BHoS4SWDMUrQAE0pIaB40qggMIYBAAGgwzMTgxNDIxMzg1NTMiDJLI5t7gr2EGxG1Y5CrfAioW0foHIQ074y4gvk0c%2B%2Fmqc7cNWb1njQslQkeePHkseJ3owzc%2FCwkgE0EuZTd4mw0aJciA2XIbJRCLPWTb%2FCBKPnIMJ5aBzIiA2ltsiUNQTTUxYmEgXZoJ6rFYgcodnmWW0Et4Xw59UlHnCDB2bLImxPprriyCzDDCD6nLyp3J8pFF1S8h3ZTJE7XguA8joMs4%2B2B1%2FeOZfuxXKyXPYSKQOOSbQiHUQc%2BFnOfwxleRL16prWk1t7TamvHR%2Bt3UgMn5QWzB3p8FgWwpJ6GjHLkYMJZ379tkimL1tJ7o%2BIod%2FMYrS7LDCifP9d%2FuYOhKWGhaakPuJKJh9fl%2B0vGl7kmApXigROxEWon6ms75laXebltsWwKcKuYca%2BUWu4jVJx%2BWUfI4ofoaGiCSaKALTqwu4QNBRT%2BMoK6h%2BQa7gN7JFGg322lkxRY53x27WMbUE4unn5EmI54T4dWt1%2Bg8ljDS%2BvKfBjqmAWRwuqyfwXa5YC3xxttOr3YVvR6%2BaXpzWtvNJQNnb6v0uI3%2BTtTexZkJpLQYqFcgZLQSxsXWSnf988qvASCIUhAzp2UnS1uqy7QjtD5T73zksYN2aesll7rvB80qIuujG6NOdHnRJ2M5%2FKXXNo1Yd15MtzPuSjRoSB9RSMon5jFu31OrQnA9eCUoawxbB0nHqwK8a43CKBZHhA8RoUAJW%2B48EuFsp3U%3D&X-Amz-Signature=3436e4139e84dbcf5e2e6086c0ebc92f4e1e9332b6fda24697bc339acbf2cdfa
```
–ü—Ä–µ—Å–∏–≥–Ω–æ–≤–∞–Ω–∏–π URL –º–æ–∂–µ –±—É—Ç–∏ **—Å—Ç–≤–æ—Ä–µ–Ω–∏–π –∑ CLI –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ –æ–±'—î–∫—Ç—É** (—è–∫—â–æ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å, —è–∫–∏–π –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ, –Ω–µ –º–∞—î –¥–æ—Å—Ç—É–ø—É, –±—É–¥–µ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –∫–æ—Ä–æ—Ç—à–∏–π –ø—Ä–µ—Å–∏–≥–Ω–æ–≤–∞–Ω–∏–π URL, –∞–ª–µ –≤—ñ–Ω –±—É–¥–µ –Ω–µ–∫–æ—Ä–∏—Å–Ω–∏–º)
```bash
aws s3 presign --region <bucket-region> 's3://<bucket-name>/<file-name>'
```
{% hint style="info" %}
–Ñ–¥–∏–Ω–∏–º –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º –¥–æ–∑–≤–æ–ª–æ–º –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∞–Ω–æ–≥–æ URL —î –¥–æ–∑–≤—ñ–ª, —è–∫–∏–π –Ω–∞–¥–∞—î—Ç—å—Å—è, —Ç–æ–º—É –¥–ª—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –∫–æ–º–∞–Ω–¥–∏ —î–¥–∏–Ω–∏–º –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–º –¥–æ–∑–≤–æ–ª–æ–º –¥–ª—è –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–∞ —î `s3:GetObject`
{% endhint %}

–¢–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω—ñ URL –∑ **—ñ–Ω—à–∏–º–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏**:
```python
import boto3
url = boto3.client('s3').generate_presigned_url(
ClientMethod='put_object',
Params={'Bucket': 'BUCKET_NAME', 'Key': 'OBJECT_KEY'},
ExpiresIn=3600
)
```
### –ú–µ—Ö–∞–Ω—ñ–∑–º–∏ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è S3

**DEK –æ–∑–Ω–∞—á–∞—î –∫–ª—é—á —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö** —ñ –∑–∞–≤–∂–¥–∏ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö.

<details>

<summary><strong>–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞ –∑ –∫–µ—Ä–æ–≤–∞–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏ S3, SSE-S3</strong></summary>

–¶–µ–π –≤–∞—Ä—ñ–∞–Ω—Ç –≤–∏–º–∞–≥–∞—î –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—ó –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, —ñ –≤—Å—ñ –∫–µ—Ä–æ–≤–∞–Ω—ñ –∫–ª—é—á—ñ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è AWS. –í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ª–∏—à–µ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–≤–æ—ó –¥–∞–Ω—ñ, —ñ S3 –≤–∏—Ä—ñ—à–∏—Ç—å –≤—Å—ñ —ñ–Ω—à—ñ –∞—Å–ø–µ–∫—Ç–∏**. –ö–æ–∂–Ω–æ–º—É –≤—ñ–¥—Ä–∞ –≤ –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ S3 –ø—Ä–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –∫–ª—é—á –≤—ñ–¥—Ä–∞.

* –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –î–∞–Ω—ñ –æ–±'—î–∫—Ç–∞ + —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —Ç–µ–∫—Å—Ç–æ–≤–∏–π DEK --> –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ (–∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ S3)
* –°—Ç–≤–æ—Ä–µ–Ω–∏–π —Ç–µ–∫—Å—Ç–æ–≤–∏–π DEK + –ì–æ–ª–æ–≤–Ω–∏–π –∫–ª—é—á S3 --> –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π DEK (–∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ S3), –∞ —Ç–µ–∫—Å—Ç –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑ –ø–∞–º'—è—Ç—ñ
* –î–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π DEK + –ì–æ–ª–æ–≤–Ω–∏–π –∫–ª—é—á S3 --> –¢–µ–∫—Å—Ç–æ–≤–∏–π DEK
* –¢–µ–∫—Å—Ç–æ–≤–∏–π DEK + –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ --> –î–∞–Ω—ñ –æ–±'—î–∫—Ç–∞

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É **–∫–ª—é—á –∫–µ—Ä—É—î—Ç—å—Å—è AWS** (–æ–±–µ—Ä—Ç–∞–Ω–Ω—è –ª–∏—à–µ –∫–æ–∂–Ω—ñ 3 —Ä–æ–∫–∏). –Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –≤–ª–∞—Å–Ω–∏–π –∫–ª—é—á, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏, –≤–∏–º–∏–∫–∞—Ç–∏ —Ç–∞ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É.

</details>

<details>

<summary><strong>–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞ –∑ –∫–µ—Ä–æ–≤–∞–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏ KMS, SSE-KMS</strong></summary>

–¶–µ–π –º–µ—Ç–æ–¥ –¥–æ–∑–≤–æ–ª—è—î S3 –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–ª—É–∂–±—É –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫–ª—é—á–∞–º–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–ª—é—á—ñ–≤ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö. KMS –Ω–∞–¥–∞—î –≤–∞–º –Ω–∞–±–∞–≥–∞—Ç–æ –±—ñ–ª—å—à—É –≥–Ω—É—á–∫—ñ—Å—Ç—å —É –∫–µ—Ä—É–≤–∞–Ω–Ω—ñ –∫–ª—é—á–∞–º–∏. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–º–∏–∫–∞—Ç–∏, –æ–±–µ—Ä—Ç–∞—Ç–∏ —Ç–∞ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É –¥–æ CMK, –∞ —Ç–∞–∫–æ–∂ –≤–∏–º–∞–≥–∞—Ç–∏ –ø—Ä–æ—Ç–∏ —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é AWS Cloud Trail.

* –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* S3 –∑–∞–ø–∏—Ç—É—î –∫–ª—é—á—ñ –¥–∞–Ω–∏—Ö –≤—ñ–¥ KMS CMK
* KMS –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î CMK –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–∞—Ä–∏ DEK —Ç–µ–∫—Å—Ç–æ–≤–∏–π —ñ DEK –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π —Ç–∞ –Ω–∞–¥—Å–∏–ª–∞—î —ó—Ö –¥–æ S3
* S3 –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç–µ–∫—Å—Ç–æ–≤–∏–π –∫–ª—é—á –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö, –∑–±–µ—Ä—ñ–≥–∞—î –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –∫–ª—é—á —ñ –≤–∏–¥–∞–ª—è—î –∑ –ø–∞–º'—è—Ç—ñ —Ç–µ–∫—Å—Ç–æ–≤–∏–π –∫–ª—é—á
* –î–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* S3 –∑–∞–ø–∏—Ç—É—î KMS —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –∫–ª—é—á –¥–∞–Ω–∏—Ö –æ–±'—î–∫—Ç–∞
* KMS —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î –∫–ª—é—á –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é CMK —Ç–∞ –Ω–∞–¥—Å–∏–ª–∞—î –π–æ–≥–æ –Ω–∞–∑–∞–¥ –¥–æ S3
* S3 —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î –¥–∞–Ω—ñ –æ–±'—î–∫—Ç–∞

</details>

<details>

<summary><strong>–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞ –∑ –Ω–∞–¥–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –∫–ª—é—á–∞–º–∏, SSE-C</strong></summary>

–¶–µ–π –≤–∞—Ä—ñ–∞–Ω—Ç –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–π –≥–æ–ª–æ–≤–Ω–∏–π –∫–ª—é—á, —è–∫–∏–π –≤–∏ –≤–∂–µ –º–æ–∂–ª–∏–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –ø–æ–∑–∞ AWS. –í–∞—à –Ω–∞–¥–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –∫–ª—é—á –±—É–¥–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏–π —Ä–∞–∑–æ–º —ñ–∑ –≤–∞—à–∏–º–∏ –¥–∞–Ω–∏–º–∏ –¥–æ S3, –¥–µ S3 –≤–∏–∫–æ–Ω–∞—î —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–ª—è –≤–∞—Å.

* –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–¥—Å–∏–ª–∞—î –¥–∞–Ω—ñ –æ–±'—î–∫—Ç–∞ + –ö–ª—é—á –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ S3
* –ö–ª—é—á –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö, —ñ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è
* —Ç–∞–∫–æ–∂ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Å–æ–ª–µ–Ω–∏–π HMAC-–∑–Ω–∞—á–µ–Ω–Ω—è –∫–ª—é—á–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –º–∞–π–±—É—Ç–Ω—å–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–ª—é—á–∞
* –∫–ª—é—á –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑ –ø–∞–º'—è—Ç—ñ
* –î–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–¥—Å–∏–ª–∞—î –∫–ª—é—á –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
* –ö–ª—é—á –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–Ω—é HMAC
* –ù–∞–¥–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –∫–ª—é—á –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö

</details>

<details>

<summary><strong>–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∞ –∑ KMS, CSE-KMS</strong></summary>

–ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –¥–æ SSE-KMS, —Ü–µ–π –º–µ—Ç–æ–¥ —Ç–∞–∫–æ–∂ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–ª—É–∂–±—É –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫–ª—é—á–∞–º–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–ª—é—á—ñ–≤ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö. –û–¥–Ω–∞–∫ —Ü—å–æ–≥–æ —Ä–∞–∑—É KMS –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –∫–ª—ñ—î–Ω—Ç–∞, –∞ –Ω–µ S3. –ü–æ—Ç—ñ–º —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∞, —ñ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –¥–æ S3 –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è.

* –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ö–ª—ñ—î–Ω—Ç –∑–∞–ø–∏—Ç—É—î –∫–ª—é—á –¥–∞–Ω–∏—Ö –≤—ñ–¥ KMS
* KMS –ø–æ–≤–µ—Ä—Ç–∞—î —Ç–µ–∫—Å—Ç–æ–≤–∏–π DEK —Ç–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π DEK –∑ CMK
* –û–±–∏–¥–≤–∞ –∫–ª—é—á—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –Ω–∞–∑–∞–¥
* –ö–ª—ñ—î–Ω—Ç –ø–æ—Ç—ñ–º —à–∏—Ñ—Ä—É—î –¥–∞–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ DEK —Ç–∞ –Ω–∞–¥—Å–∏–ª–∞—î –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –¥–æ S3 + –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π DEK (—è–∫–∏–π –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —è–∫ –º–µ—Ç–∞–¥–∞–Ω—ñ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ S3)
* –î–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–º DEK –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –∫–ª—ñ—î–Ω—Ç—É
* –ö–ª—ñ—î–Ω—Ç –∑–∞–ø–∏—Ç—É—î KMS —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –∫–ª—é—á –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é CMK, —ñ KMS –Ω–∞–¥—Å–∏–ª–∞—î —Ç–µ–∫—Å—Ç–æ–≤–∏–π DEK
* –¢–µ–ø–µ—Ä –∫–ª—ñ—î–Ω—Ç –º–æ–∂–µ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ

</details>

<details>

<summary><strong>–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∞ –∑ –Ω–∞–¥–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –∫–ª—é—á–∞–º–∏, CSE-C</strong></summary>

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ü–µ–π –º–µ—Ö–∞–Ω—ñ–∑–º, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–∞–¥–∞–Ω—ñ –≤–∞–º–∏ –∫–ª—é—á—ñ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç AWS-SDK –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø–µ—Ä–µ–¥ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è–º —ó—Ö –¥–æ S3 –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è.

* –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ö–ª—ñ—î–Ω—Ç –≥–µ–Ω–µ—Ä—É—î DEK —Ç–∞ —à–∏—Ñ—Ä—É—î —Ç–µ–∫—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ
* –ü–æ—Ç—ñ–º, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≤–ª–∞—Å–Ω–∏–π –≤–ª–∞—Å–Ω–∏–π CMK, –≤—ñ–Ω —à–∏—Ñ—Ä—É—î DEK
* –Ω–∞–¥—Å–∏–ª–∞—î –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ + –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π DEK –¥–æ S3, –¥–µ –≤–æ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è
* –î–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* S3 –Ω–∞–¥—Å–∏–ª–∞—î –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ DEK
* –û—Å–∫—ñ–ª—å–∫–∏ –∫–ª—ñ—î–Ω—Ç –≤–∂–µ –º–∞—î CMK, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è DEK, –≤—ñ–Ω —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î DEK, –∞ –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç–µ–∫—Å—Ç–æ–≤–∏–π DEK –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö

</details>

### **–ü–µ—Ä–µ–ª—ñ–∫**

–û–¥–Ω–∏–º –∑ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏—Ö –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å–ø–æ—Å–æ–±—ñ–≤ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π AWS —î –ø–æ—á–∞—Ç–æ–∫ –∑ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –ø—É–±–ª—ñ—á–Ω–æ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –≤—ñ–¥—Ä–∞. **–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏** [**–ø—É–±–ª—ñ—á–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –ø–µ—Ä–µ–ª—ñ–∫—É –≤—ñ–¥–µ—Ä –Ω–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ**](../../aws-security/aws-unauthenticated-enum-access/#s3-buckets)**.**
```bash
# Get buckets ACLs
aws s3api get-bucket-acl --bucket <bucket-name>
aws s3api get-object-acl --bucket <bucket-name> --key flag

# Get policy
aws s3api get-bucket-policy --bucket <bucket-name>
aws s3api get-bucket-policy-status --bucket <bucket-name> #if it's public

# list S3 buckets associated with a profile
aws s3 ls
aws s3api list-buckets

# list content of bucket (no creds)
aws s3 ls s3://bucket-name --no-sign-request
aws s3 ls s3://bucket-name --recursive

# list content of bucket (with creds)
aws s3 ls s3://bucket-name
aws s3api list-objects-v2 --bucket <bucket-name>
aws s3api list-objects --bucket <bucket-name>
aws s3api list-object-versions --bucket <bucket-name>

# copy local folder to S3
aws s3 cp MyFolder s3://bucket-name --recursive

# delete
aws s3 rb s3://bucket-name ‚Äì-force

# download a whole S3 bucket
aws s3 sync s3://<bucket>/ .

# move S3 bucket to different location
aws s3 sync s3://oldbucket s3://newbucket --source-region us-west-1

# list the sizes of an S3 bucket and its contents
aws s3api list-objects --bucket BUCKETNAME --output json --query "[sum(Contents[].Size), length(Contents[])]"

# Update Bucket policy
aws s3api put-bucket-policy --policy file:///root/policy.json --bucket <bucket-name>
##JSON policy example
{
"Id": "Policy1568185116930",
"Version": "2012-10-17",
"Statement": [
{
"Sid": "Stmt1568184932403",
"Action": [
"s3:ListBucket"
],
"Effect": "Allow",
"Resource": "arn:aws:s3:::welcome",
"Principal": "*"
},
{
"Sid": "Stmt1568185007451",
"Action": [
"s3:GetObject"
],
"Effect": "Allow",
"Resource": "arn:aws:s3:::welcome/*",
"Principal": "*"
}
]
}

# Update bucket ACL
aws s3api get-bucket-acl --bucket <bucket-name> # Way 1 to get the ACL
aws s3api put-bucket-acl --bucket <bucket-name> --access-control-policy file://acl.json

aws s3api get-object-acl --bucket <bucket-name> --key flag #Way 2 to get the ACL
aws s3api put-object-acl --bucket <bucket-name> --key flag --access-control-policy file://objacl.json

##JSON ACL example
## Make sure to modify the Owner‚Äôs displayName and ID according to the Object ACL you retrieved.
{
"Owner": {
"DisplayName": "<DisplayName>",
"ID": "<ID>"
},
"Grants": [
{
"Grantee": {
"Type": "Group",
"URI": "http://acs.amazonaws.com/groups/global/AuthenticatedUsers"
},
"Permission": "FULL_CONTROL"
}
]
}
## An ACL should give you the permission WRITE_ACP to be able to put a new ACL
```
### –¥–≤–æ—Ö—Å—Ç–µ–∫–æ–≤–∏–π <a href="#dual-stack-endpoints-description" id="dual-stack-endpoints-description"></a>

–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –≤—ñ–¥–∂–µ—Ç–∞ S3 —á–µ—Ä–µ–∑ –¥–≤–æ—Ö—Å—Ç–µ–∫–æ–≤—É —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —ñ–º'—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞ –∞–±–æ —à–ª—è—Ö–æ–≤–µ —ñ–º'—è —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø—É. –¶–µ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ S3 —á–µ—Ä–µ–∑ IPv6.

–¢–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø—É –¥–≤–æ—Ö—Å—Ç–µ–∫–æ–≤–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:

* `bucketname.s3.dualstack.aws-region.amazonaws.com`
* `s3.dualstack.aws-region.amazonaws.com/bucketname`

### –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤

–ù–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —è–∫ **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ S3 –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**:

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-s3-privesc.md" %}
[aws-s3-privesc.md](../../aws-security/aws-privilege-escalation/aws-s3-privesc.md)
{% endcontent-ref %}

### –ù–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-s3-unauthenticated-enum.md" %}
[aws-s3-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-s3-unauthenticated-enum.md)
{% endcontent-ref %}

### –ü–æ—Å—Ç-–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è S3

{% content-ref url="../aws-post-exploitation/aws-s3-post-exploitation.md" %}
[aws-s3-post-exploitation.md](../aws-post-exploitation/aws-s3-post-exploitation.md)
{% endcontent-ref %}

### –ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å

{% content-ref url="../aws-persistence/aws-s3-persistence.md" %}
[aws-s3-persistence.md](../aws-persistence/aws-s3-persistence.md)
{% endcontent-ref %}

## –Ü–Ω—à—ñ —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ S3

### –ü—Ä–æ–±–ª–µ–º–∞ –æ—Ç—Ä—É—î–Ω–Ω—è –∫–µ—à—É HTTP S3 <a href="#heading-s3-http-desync-cache-poisoning-issue" id="heading-s3-http-desync-cache-poisoning-issue"></a>

[**–ó–≥—ñ–¥–Ω–æ –∑ —Ü–∏–º –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è–º**](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies#heading-s3-http-desync-cache-poisoning-issue) –±—É–ª–æ –º–æ–∂–ª–∏–≤–æ –∫–µ—à—É–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –≤—ñ–¥–∂–µ—Ç–∞ —Ç–∞–∫, –Ω—ñ–±–∏ –≤–æ–Ω–∞ –Ω–∞–ª–µ–∂–∏—Ç—å –¥–æ —ñ–Ω—à–æ–≥–æ. –¶–µ –º–æ–≥–ª–æ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–ª—è –∑–º—ñ–Ω–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –Ω–∞ —Ñ–∞–π–ª–∏ JavaScript —Ç–∞ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó –¥–æ–≤—ñ–ª—å–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ S3 –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ –∫–æ–¥—É.

## Amazon Athena

Amazon Athena - —Ü–µ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ —Å–ª—É–∂–±–∞ –∑–∞–ø–∏—Ç—ñ–≤, —è–∫–∞ —Å–ø—Ä–æ—â—É—î **–∞–Ω–∞–ª—ñ–∑ –¥–∞–Ω–∏—Ö** –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ Amazon Simple Storage Service (Amazon **S3**) **–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ **SQL**.

–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **–ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—é —Ä–µ–ª—è—Ü—ñ–π–Ω–æ—ó –ë–î** –∑ —Ñ–æ—Ä–º–∞—Ç–æ–º –≤–º—ñ—Å—Ç—É, —è–∫–∏–π –±—É–¥–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏—Ö –≤—ñ–¥–∂–µ—Ç–∞—Ö S3. –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ Amazon Athena –∑–º–æ–∂–µ –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ –ë–î –∑ –∂—É—Ä–Ω–∞–ª—ñ–≤, —â–æ–± –≤–∏ –º–æ–≥–ª–∏ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏.

Amazon Athena –ø—ñ–¥—Ç—Ä–∏–º—É—î **–º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ S3, —è–∫—ñ –≤–∂–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ**, —ñ, —è–∫—â–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ, **Athena —Ç–∞–∫–æ–∂ –º–æ–∂–µ —à–∏—Ñ—Ä—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–∞–ø–∏—Ç—É, —è–∫—ñ –ø–æ—Ç—ñ–º –º–æ–∂–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤ S3**.

**–¶–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –Ω–µ–∑–∞–ª–µ–∂–Ω–µ –≤—ñ–¥ –∑–∞–ø–∏—Ç—É–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö S3**, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –¥–∞–Ω—ñ S3 –Ω–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–∞–ø–∏—Ç—É –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ. –í–∞–∂–ª–∏–≤–æ—é —î —Ç–µ, —â–æ Amazon Athena –ø—ñ–¥—Ç—Ä–∏–º—É—î –ª–∏—à–µ –¥–∞–Ω—ñ, —è–∫—ñ –±—É–ª–∏ **–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **–Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è S3**, **SSE-S3, SSE-KMS —Ç–∞ CSE-KMS**.

SSE-C —Ç–∞ CSE-E –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è. –ö—Ä—ñ–º —Ü—å–æ–≥–æ, –≤–∞–∂–ª–∏–≤–æ —Ä–æ–∑—É–º—ñ—Ç–∏, —â–æ Amazon Athena –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ –ª–∏—à–µ –¥–æ **–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤, —è–∫—ñ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ —Ç—ñ–π –∂–µ —Ä–µ–≥—ñ–æ–Ω—ñ, —â–æ –π —Å–∞–º –∑–∞–ø–∏—Ç**. –Ø–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ S3, —è–∫—ñ –±—É–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é KMS, —Ç–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É Athena –ø–æ—Ç—Ä—ñ–±–Ω—ñ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—É. 

### –ï–Ω—É–º–µ—Ä–∞—Ü—ñ—è
```bash
# Get catalogs
aws athena list-data-catalogs

# Get databases inside catalog
aws athena list-databases --catalog-name <catalog-name>
aws athena list-table-metadata --catalog-name <catalog-name> --database-name <db-name>

# Get query executions, queries and results
aws athena list-query-executions
aws athena get-query-execution --query-execution-id <id> # Get query and meta of results
aws athena get-query-results --query-execution-id <id> # This will rerun the query and get the results

# Get workgroups & Prepared statements
aws athena list-work-groups
aws athena list-prepared-statements --work-group <wg-name>
aws athena get-prepared-statement --statement-name <name> --work-group <wg-name>

# Run query
aws athena start-query-execution --query-string <query>
```
## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://cloudsecdocs.com/aws/defensive/tooling/cli/#s3](https://cloudsecdocs.com/aws/defensive/tooling/cli/#s3)
* [https://docs.aws.amazon.com/AmazonS3/latest/userguide/dual-stack-endpoints.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/dual-stack-endpoints.html)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
