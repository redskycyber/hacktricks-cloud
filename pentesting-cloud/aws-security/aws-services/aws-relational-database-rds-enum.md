# AWS - Baza danych relacyjnych (RDS) Enum

<details>

<summary><strong>Nauka hakowania AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakowania, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

UsÅ‚uga **Relational Database Service (RDS)** oferowana przez AWS zostaÅ‚a zaprojektowana w celu uÅ‚atwienia wdraÅ¼ania, obsÅ‚ugi i skalowania **bazy danych relacyjnej w chmurze**. Ta usÅ‚uga oferuje korzyÅ›ci zwiÄ…zane z efektywnoÅ›ciÄ… kosztÃ³w i skalowalnoÅ›ciÄ…, automatyzujÄ…c pracochÅ‚onne zadania takie jak dostarczanie sprzÄ™tu, konfiguracjÄ™ bazy danych, Å‚atanie i tworzenie kopii zapasowych.

AWS RDS obsÅ‚uguje rÃ³Å¼ne powszechnie uÅ¼ywane silniki baz danych relacyjnych, w tym MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server i Amazon Aurora, z kompatybilnoÅ›ciÄ… zarÃ³wno z MySQL, jak i PostgreSQL.

GÅ‚Ã³wne funkcje RDS obejmujÄ…:

* Uproszczenie **zarzÄ…dzania instancjami bazy danych**.
* Tworzenie **replik odczytu** w celu poprawy wydajnoÅ›ci odczytu.
* KonfiguracjÄ™ **wielozonowych wdroÅ¼eÅ„ (AZ)** w celu zapewnienia wysokiej dostÄ™pnoÅ›ci i mechanizmÃ³w awaryjnych.
* **IntegracjÄ™** z innymi usÅ‚ugami AWS, takimi jak:
* AWS Identity and Access Management (**IAM**) dla solidnej kontroli dostÄ™pu.
* AWS **CloudWatch** dla kompleksowego monitorowania i metryk.
* AWS Key Management Service (**KMS**) w celu zapewnienia szyfrowania w spoczynku.

## Dane uwierzytelniajÄ…ce

Podczas tworzenia klastra bazy danych, moÅ¼na skonfigurowaÄ‡ nazwÄ™ uÅ¼ytkownika **administratora** (**`admin`** domyÅ›lnie). Aby wygenerowaÄ‡ hasÅ‚o tego uÅ¼ytkownika, moÅ¼na:

* **WskazaÄ‡** hasÅ‚o **samodzielnie**
* PowiedzieÄ‡ RDS, aby je **automatycznie wygenerowaÅ‚**
* PowiedzieÄ‡ RDS, aby zarzÄ…dzaÅ‚ nim w **AWS Secret Manager** zaszyfrowanym kluczem KMS

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

### Uwierzytelnianie

IstniejÄ… 3 rodzaje opcji uwierzytelniania, ale zawsze moÅ¼na uÅ¼yÄ‡ **hasÅ‚a administratora**:

<figure><img src="../../../.gitbook/assets/image (227).png" alt=""><figcaption></figcaption></figure>

### DostÄ™p publiczny i VPC

DomyÅ›lnie **nie udzielono dostÄ™pu publicznego** do baz danych, jednak **moÅ¼na go udzieliÄ‡**. Dlatego domyÅ›lnie tylko maszyny z tego samego VPC bÄ™dÄ… miaÅ‚y do niej dostÄ™p, jeÅ›li wybrana **grupa zabezpieczeÅ„** (przechowywane sÄ… w EC2 SG) na to pozwala.

Zamiast wystawiaÄ‡ instancjÄ™ bazy danych, moÅ¼na utworzyÄ‡ **RDS Proxy**, ktÃ³ry **poprawia** **skalowalnoÅ›Ä‡** i **dostÄ™pnoÅ›Ä‡** klastra bazy danych.

Co wiÄ™cej, **port bazy danych moÅ¼na rÃ³wnieÅ¼ zmodyfikowaÄ‡**.

### Szyfrowanie

**Szyfrowanie jest domyÅ›lnie wÅ‚Ä…czone** za pomocÄ… zarzÄ…dzanego klucza AWS (moÅ¼na wybraÄ‡ CMK).

WÅ‚Ä…czajÄ…c szyfrowanie, wÅ‚Ä…czasz **szyfrowanie w spoczynku dla swojego magazynu, migawek, replik odczytu i kopii zapasowych**. Klucze do zarzÄ…dzania tym szyfrowaniem moÅ¼na wydaÄ‡, korzystajÄ…c z **KMS**.\
Nie moÅ¼na dodaÄ‡ tego poziomu szyfrowania po utworzeniu bazy danych. **NaleÅ¼y to zrobiÄ‡ podczas jej tworzenia**.

Jednak istnieje **sposÃ³b obejÅ›cia, ktÃ³ry pozwala na zaszyfrowanie niezaszyfrowanej bazy danych**. MoÅ¼esz utworzyÄ‡ migawkÄ™ swojej niezaszyfrowanej bazy danych, utworzyÄ‡ zaszyfrowanÄ… kopiÄ™ tej migawki, uÅ¼yÄ‡ tej zaszyfrowanej migawki do utworzenia nowej bazy danych, a nastÄ™pnie, w koÅ„cu, twoja baza danych bÄ™dzie zaszyfrowana.

#### Transparentne szyfrowanie danych (TDE)

OprÃ³cz moÅ¼liwoÅ›ci szyfrowania inherentnych dla RDS na poziomie aplikacji, RDS obsÅ‚uguje rÃ³wnieÅ¼ **dodatkowe mechanizmy szyfrowania na poziomie platformy** w celu zabezpieczenia danych w spoczynku. Obejmuje to **Transparentne Szyfrowanie Danych (TDE)** dla Oracle i SQL Server. Jednak waÅ¼ne jest zauwaÅ¼enie, Å¼e podczas gdy TDE zwiÄ™ksza bezpieczeÅ„stwo poprzez szyfrowanie danych w spoczynku, moÅ¼e to rÃ³wnieÅ¼ **wpÅ‚ynÄ…Ä‡ na wydajnoÅ›Ä‡ bazy danych**. Ten wpÅ‚yw na wydajnoÅ›Ä‡ jest szczegÃ³lnie zauwaÅ¼alny przy uÅ¼yciu funkcji kryptograficznych MySQL lub funkcji kryptograficznych Microsoft Transact-SQL.

Aby skorzystaÄ‡ z TDE, konieczne sÄ… pewne kroki wstÄ™pne:

1. **PowiÄ…zanie grupy opcji**:
* Baza danych musi byÄ‡ powiÄ…zana z grupÄ… opcji. Grupy opcji sÅ‚uÅ¼Ä… jako kontenery dla ustawieÅ„ i funkcji, uÅ‚atwiajÄ…c zarzÄ…dzanie bazÄ… danych, w tym wzmocnienie zabezpieczeÅ„.
* Jednak waÅ¼ne jest zauwaÅ¼enie, Å¼e grupy opcji sÄ… dostÄ™pne tylko dla okreÅ›lonych silnikÃ³w baz danych i wersji.
2. **WÅ‚Ä…czenie TDE w grupie opcji**:
* Po powiÄ…zaniu z grupÄ… opcji, opcja Oracle Transparent Data Encryption musi zostaÄ‡ uwzglÄ™dniona w tej grupie.
* Istotne jest zauwaÅ¼enie, Å¼e po dodaniu opcji TDE do grupy opcji staje siÄ™ ona staÅ‚ym elementem i nie moÅ¼na jej usunÄ…Ä‡.
3. **Tryby szyfrowania TDE**:
* TDE oferuje dwa rÃ³Å¼ne tryby szyfrowania:
* **Szyfrowanie przestrzeni tabel TDE**: Ten tryb szyfruje caÅ‚e tabele, zapewniajÄ…c szerszy zakres ochrony danych.
* **Szyfrowanie kolumn TDE**: Ten tryb koncentruje siÄ™ na szyfrowaniu konkretnych, indywidualnych elementÃ³w w bazie danych, umoÅ¼liwiajÄ…c bardziej szczegÃ³Å‚owÄ… kontrolÄ™ nad tym, ktÃ³re dane sÄ… szyfrowane.

Zrozumienie tych wymagaÅ„ wstÄ™pnych i operacyjnych zÅ‚oÅ¼onoÅ›ci TDE jest kluczowe dla skutecznego wdraÅ¼ania i zarzÄ…dzania szyfrowaniem w RDS, zapewniajÄ…c zarÃ³wno bezpieczeÅ„stwo danych, jak i zgodnoÅ›Ä‡ z niezbÄ™dnymi standardami.

### Wyliczanie

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
### DostÄ™p bez uwierzytelnienia

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Eskalacja uprawnieÅ„

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Po wykorzystaniu

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### TrwaÅ‚oÅ›Ä‡

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### Wstrzykiwanie SQL

IstniejÄ… sposoby dostÄ™pu do danych DynamoDB za pomocÄ… **skÅ‚adni SQL**, dlatego teÅ¼ typowe **wstrzykiwania SQL sÄ… rÃ³wnieÅ¼ moÅ¼liwe**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
