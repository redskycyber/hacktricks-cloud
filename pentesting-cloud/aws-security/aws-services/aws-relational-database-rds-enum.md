# AWS - Relationale Datenbank (RDS) Enum

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks in PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

## Grundlegende Informationen

Der von AWS angebotene **Relationale Datenbankdienst (RDS)** ist darauf ausgelegt, die Bereitstellung, den Betrieb und das Skalieren einer **relationale Datenbank in der Cloud** zu vereinfachen. Dieser Dienst bietet die Vorteile der Kosteneffizienz und Skalierbarkeit und automatisiert arbeitsintensive Aufgaben wie Hardwarebereitstellung, Datenbankkonfiguration, Patching und Backups.

AWS RDS unterst√ºtzt verschiedene weit verbreitete relationale Datenbank-Engines, darunter MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server und Amazon Aurora, mit Kompatibilit√§t sowohl f√ºr MySQL als auch f√ºr PostgreSQL.

Zu den wichtigsten Funktionen von RDS geh√∂ren:

* Die **Verwaltung von Datenbankinstanzen** ist vereinfacht.
* Erstellung von **Lese-Replikaten** zur Verbesserung der Leseleistung.
* Konfiguration von **Multi-Availability Zone (AZ)-Bereitstellungen** zur Gew√§hrleistung hoher Verf√ºgbarkeit und Failover-Mechanismen.
* **Integration** mit anderen AWS-Diensten wie:
* AWS Identity and Access Management (**IAM**) f√ºr eine robuste Zugriffskontrolle.
* AWS **CloudWatch** f√ºr umfassendes Monitoring und Metriken.
* AWS Key Management Service (**KMS**) zur Sicherstellung der Verschl√ºsselung im Ruhezustand.

## Anmeldeinformationen

Beim Erstellen des DB-Clusters kann der Master-**Benutzername** konfiguriert werden (**standardm√§√üig `admin`**). Um das Passwort dieses Benutzers zu generieren, k√∂nnen Sie:

* Geben Sie ein **Passwort** selbst an
* Lassen Sie RDS es **automatisch generieren**
* Lassen Sie RDS es im **AWS Secret Manager** verwalten, verschl√ºsselt mit einem KMS-Schl√ºssel

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

### Authentifizierung

Es gibt 3 Arten von Authentifizierungsoptionen, aber die Verwendung des **Master-Passworts ist immer erlaubt**:

<figure><img src="../../../.gitbook/assets/image (227).png" alt=""><figcaption></figcaption></figure>

### √ñffentlicher Zugriff & VPC

Standardm√§√üig wird **kein √∂ffentlicher Zugriff** auf die Datenbanken gew√§hrt, jedoch **k√∂nnte er gew√§hrt werden**. Daher k√∂nnen standardm√§√üig nur Maschinen aus demselben VPC darauf zugreifen, wenn die ausgew√§hlte **Sicherheitsgruppe** (in EC2 SG gespeichert) dies zul√§sst.

Anstatt eine DB-Instanz freizugeben, ist es m√∂glich, einen **RDS-Proxy** zu erstellen, der die **Skalierbarkeit** und **Verf√ºgbarkeit** des DB-Clusters verbessert.

Dar√ºber hinaus kann der **Datenbankport ebenfalls ge√§ndert** werden.

### Verschl√ºsselung

Die **Verschl√ºsselung ist standardm√§√üig aktiviert** und verwendet einen von AWS verwalteten Schl√ºssel (es k√∂nnte stattdessen ein CMK ausgew√§hlt werden).

Durch Aktivieren Ihrer Verschl√ºsselung aktivieren Sie **Verschl√ºsselung im Ruhezustand f√ºr Ihren Speicher, Snapshots, Lese-Replikate und Backups**. Schl√ºssel zur Verwaltung dieser Verschl√ºsselung k√∂nnen durch Verwendung von **KMS** ausgestellt werden.\
Es ist nicht m√∂glich, diese Verschl√ºsselungsebene hinzuzuf√ºgen, nachdem Ihre Datenbank erstellt wurde. **Es muss w√§hrend ihrer Erstellung erfolgen**.

Es gibt jedoch einen **Workaround, der es Ihnen erm√∂glicht, eine unverschl√ºsselte Datenbank zu verschl√ºsseln, wie folgt**. Sie k√∂nnen einen Snapshot Ihrer unverschl√ºsselten Datenbank erstellen, eine verschl√ºsselte Kopie dieses Snapshots erstellen, diesen verschl√ºsselten Snapshot verwenden, um eine neue Datenbank zu erstellen, und dann w√§re Ihre Datenbank verschl√ºsselt.

#### Transparente Datenverschl√ºsselung (TDE)

Neben den Verschl√ºsselungsfunktionen, die in RDS auf Anwendungsebene vorhanden sind, unterst√ºtzt RDS auch **zus√§tzliche Verschl√ºsselungsmechanismen auf Plattformebene**, um Daten im Ruhezustand zu sch√ºtzen. Dazu geh√∂rt die **Transparente Datenverschl√ºsselung (TDE)** f√ºr Oracle und SQL Server. Es ist jedoch wichtig zu beachten, dass TDE die Sicherheit durch Verschl√ºsselung von Daten im Ruhezustand verbessert, aber auch die **Datenbankleistung beeintr√§chtigen** kann. Diese Leistungsauswirkung ist besonders sp√ºrbar, wenn sie in Verbindung mit kryptografischen Funktionen von MySQL oder Microsoft Transact-SQL verwendet wird.

Um TDE zu nutzen, sind bestimmte vorbereitende Schritte erforderlich:

1. **Zuordnung zur Optionsgruppe**:
* Die Datenbank muss mit einer Optionsgruppe verkn√ºpft sein. Optionsgruppen dienen als Container f√ºr Einstellungen und Funktionen, die die Datenbankverwaltung erleichtern, einschlie√ülich Sicherheitsverbesserungen.
* Es ist jedoch wichtig zu beachten, dass Optionsgruppen nur f√ºr bestimmte Datenbank-Engines und -Versionen verf√ºgbar sind.
2. **Einbeziehung von TDE in Optionsgruppe**:
* Sobald mit einer Optionsgruppe verkn√ºpft, muss die Oracle Transparente Datenverschl√ºsselungsoption in diese Gruppe aufgenommen werden.
* Es ist wichtig zu erkennen, dass die TDE-Option, sobald sie einer Optionsgruppe hinzugef√ºgt wurde, eine dauerhafte Einrichtung wird und nicht entfernt werden kann.
3. **TDE-Verschl√ºsselungsmodi**:
* TDE bietet zwei verschiedene Verschl√ºsselungsmodi:
* **TDE-Tablespace-Verschl√ºsselung**: Dieser Modus verschl√ºsselt ganze Tabellen und bietet einen breiteren Schutzumfang f√ºr Daten.
* **TDE-Spaltenverschl√ºsselung**: Dieser Modus konzentriert sich auf die Verschl√ºsselung bestimmter einzelner Elemente innerhalb der Datenbank und erm√∂glicht eine genauere Kontrolle dar√ºber, welche Daten verschl√ºsselt werden.

Das Verst√§ndnis dieser Voraussetzungen und der betrieblichen Feinheiten von TDE ist entscheidend f√ºr die effektive Implementierung und Verwaltung der Verschl√ºsselung in RDS, um sowohl die Datensicherheit als auch die Einhaltung erforderlicher Standards zu gew√§hrleisten.

### Enumeration

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Nicht authentifizierter Zugriff

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privilege Escalation

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post-Exploitation

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistenz

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL-Injection

Es gibt M√∂glichkeiten, auf DynamoDB-Daten mit **SQL-Syntax** zuzugreifen, daher sind auch typische **SQL-Injections m√∂glich**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks in PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories einreichen.

</details>
