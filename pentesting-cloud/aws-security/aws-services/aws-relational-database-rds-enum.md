# AWS - Relational Database (RDS) Enum

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

AWSæä¾›çš„**å…³ç³»å‹æ•°æ®åº“æœåŠ¡ï¼ˆRDSï¼‰æ—¨åœ¨ç®€åŒ–åœ¨äº‘ä¸­éƒ¨ç½²ã€æ“ä½œå’Œæ‰©å±•å…³ç³»å‹æ•°æ®åº“**ã€‚è¯¥æœåŠ¡æä¾›äº†æˆæœ¬æ•ˆç›Šå’Œå¯ä¼¸ç¼©æ€§çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶è‡ªåŠ¨åŒ–äº†è¯¸å¦‚ç¡¬ä»¶é…ç½®ã€æ•°æ®åº“é…ç½®ã€æ‰“è¡¥ä¸å’Œå¤‡ä»½ç­‰ç¹é‡çš„ä»»åŠ¡ã€‚

AWS RDSæ”¯æŒåŒ…æ‹¬MySQLã€PostgreSQLã€MariaDBã€Oracleæ•°æ®åº“ã€Microsoft SQL Serverå’ŒAmazon Auroraåœ¨å†…çš„å„ç§å¹¿æ³›ä½¿ç”¨çš„å…³ç³»å‹æ•°æ®åº“å¼•æ“ï¼Œå…¼å®¹MySQLå’ŒPostgreSQLã€‚

RDSçš„å…³é”®ç‰¹æ€§åŒ…æ‹¬ï¼š

* **ç®€åŒ–æ•°æ®åº“å®ä¾‹çš„ç®¡ç†**ã€‚
* åˆ›å»º**åªè¯»å‰¯æœ¬**ä»¥å¢å¼ºè¯»å–æ€§èƒ½ã€‚
* é…ç½®**å¤šå¯ç”¨åŒºï¼ˆAZï¼‰éƒ¨ç½²**ä»¥ç¡®ä¿é«˜å¯ç”¨æ€§å’Œæ•…éšœè½¬ç§»æœºåˆ¶ã€‚
* ä¸å…¶ä»–AWSæœåŠ¡çš„**é›†æˆ**ï¼Œä¾‹å¦‚ï¼š
* ç”¨äºå¼ºå¤§è®¿é—®æ§åˆ¶çš„AWSèº«ä»½å’Œè®¿é—®ç®¡ç†ï¼ˆ**IAM**ï¼‰ã€‚
* ç”¨äºå…¨é¢ç›‘æ§å’ŒæŒ‡æ ‡çš„AWS **CloudWatch**ã€‚
* é€šè¿‡AWSå¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆ**KMS**ï¼‰ç¡®ä¿é™æ€åŠ å¯†ã€‚

## å‡­æ®

åœ¨åˆ›å»ºDBé›†ç¾¤æ—¶ï¼Œå¯ä»¥é…ç½®ä¸»**ç”¨æˆ·å**ï¼ˆé»˜è®¤ä¸º\*\*`admin`\*\*ï¼‰ã€‚è¦ç”Ÿæˆæ­¤ç”¨æˆ·çš„å¯†ç ï¼Œæ‚¨å¯ä»¥ï¼š

* **è‡ªå·±æŒ‡å®š**ä¸€ä¸ª**å¯†ç **
* å‘Šè¯‰RDS**è‡ªåŠ¨ç”Ÿæˆ**å®ƒ
* å‘Šè¯‰RDSå°†å…¶ç®¡ç†åœ¨ä½¿ç”¨KMSå¯†é’¥åŠ å¯†çš„**AWS Secret Manager**ä¸­

<figure><img src="../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### è®¤è¯

æœ‰3ç§è®¤è¯é€‰é¡¹ï¼Œä½†å§‹ç»ˆå…è®¸ä½¿ç”¨**ä¸»å¯†ç **ï¼š

<figure><img src="../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### å…¬å…±è®¿é—®å’ŒVPC

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®åº“**ä¸å…è®¸å…¬å…±è®¿é—®**ï¼Œä½†**å¯ä»¥å…è®¸**ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰æ¥è‡ªç›¸åŒVPCçš„è®¡ç®—æœºå¯ä»¥è®¿é—®å®ƒï¼Œå¦‚æœæ‰€é€‰çš„**å®‰å…¨ç»„**ï¼ˆå­˜å‚¨åœ¨EC2 SGä¸­ï¼‰å…è®¸çš„è¯ã€‚

å¯ä»¥åˆ›å»ºä¸€ä¸ª**RDSä»£ç†**ï¼Œè€Œä¸æ˜¯æš´éœ²ä¸€ä¸ªDBå®ä¾‹ï¼Œè¿™å°†**æé«˜**DBé›†ç¾¤çš„**å¯ä¼¸ç¼©æ€§**å’Œ**å¯ç”¨æ€§**ã€‚

æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä¿®æ”¹**æ•°æ®åº“ç«¯å£**ã€‚

### åŠ å¯†

ä½¿ç”¨AWSæ‰˜ç®¡å¯†é’¥ï¼ˆä¹Ÿå¯ä»¥é€‰æ‹©CMKï¼‰é»˜è®¤å¯ç”¨**åŠ å¯†**ã€‚

é€šè¿‡å¯ç”¨åŠ å¯†ï¼Œæ‚¨å¯ä»¥ä¸ºæ‚¨çš„å­˜å‚¨ã€å¿«ç…§ã€åªè¯»å‰¯æœ¬å’Œå¤‡ä»½å¯ç”¨**é™æ€åŠ å¯†**ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨**KMS**å‘æ”¾ç®¡ç†æ­¤åŠ å¯†çš„å¯†é’¥ã€‚\
åœ¨åˆ›å»ºæ•°æ®åº“åï¼Œæ— æ³•æ·»åŠ æ­¤åŠ å¯†çº§åˆ«ã€‚**å¿…é¡»åœ¨åˆ›å»ºæœŸé—´å®Œæˆ**ã€‚

ä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ª**è§£å†³æ–¹æ³•å…è®¸æ‚¨å¯¹æœªåŠ å¯†çš„æ•°æ®åº“è¿›è¡ŒåŠ å¯†**ã€‚æ‚¨å¯ä»¥åˆ›å»ºæœªåŠ å¯†æ•°æ®åº“çš„å¿«ç…§ï¼Œåˆ›å»ºè¯¥å¿«ç…§çš„åŠ å¯†å‰¯æœ¬ï¼Œä½¿ç”¨è¯¥åŠ å¯†å¿«ç…§åˆ›å»ºæ–°æ•°æ®åº“ï¼Œç„¶åæœ€ç»ˆï¼Œæ‚¨çš„æ•°æ®åº“å°†è¢«åŠ å¯†ã€‚

#### é€æ˜æ•°æ®åŠ å¯†ï¼ˆTDEï¼‰

é™¤äº†RDSåœ¨åº”ç”¨ç¨‹åºçº§åˆ«å›ºæœ‰çš„åŠ å¯†åŠŸèƒ½å¤–ï¼ŒRDSè¿˜æ”¯æŒ**é¢å¤–çš„å¹³å°çº§åˆ«åŠ å¯†æœºåˆ¶**ï¼Œä»¥ä¿æŠ¤é™æ€æ•°æ®ã€‚è¿™åŒ…æ‹¬Oracleå’ŒSQL Serverçš„**é€æ˜æ•°æ®åŠ å¯†ï¼ˆTDEï¼‰**ã€‚ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶TDEé€šè¿‡åŠ å¯†é™æ€æ•°æ®å¢å¼ºäº†å®‰å…¨æ€§ï¼Œä½†å®ƒä¹Ÿå¯èƒ½**å½±å“æ•°æ®åº“æ€§èƒ½**ã€‚ç‰¹åˆ«æ˜¯å½“ä¸MySQLåŠ å¯†å‡½æ•°æˆ–Microsoft Transact-SQLåŠ å¯†å‡½æ•°ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œè¿™ç§æ€§èƒ½å½±å“å°¤ä¸ºæ˜æ˜¾ã€‚

è¦ä½¿ç”¨TDEï¼Œéœ€è¦è¿›è¡Œä¸€äº›åˆæ­¥æ­¥éª¤ï¼š

1. **é€‰é¡¹ç»„å…³è”**ï¼š

* æ•°æ®åº“å¿…é¡»ä¸é€‰é¡¹ç»„å…³è”ã€‚é€‰é¡¹ç»„ç”¨ä½œè®¾ç½®å’ŒåŠŸèƒ½çš„å®¹å™¨ï¼Œä¿ƒè¿›æ•°æ®åº“ç®¡ç†ï¼ŒåŒ…æ‹¬å®‰å…¨å¢å¼ºåŠŸèƒ½ã€‚
* ä½†æ˜¯ï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œé€‰é¡¹ç»„ä»…é€‚ç”¨äºç‰¹å®šçš„æ•°æ®åº“å¼•æ“å’Œç‰ˆæœ¬ã€‚

2. **åœ¨é€‰é¡¹ç»„ä¸­åŒ…å«TDE**ï¼š

* ä¸€æ—¦ä¸é€‰é¡¹ç»„å…³è”ï¼ŒOracleé€æ˜æ•°æ®åŠ å¯†é€‰é¡¹éœ€è¦åŒ…å«åœ¨è¯¥ç»„ä¸­ã€‚
* éœ€è¦è®¤è¯†åˆ°ä¸€æ—¦TDEé€‰é¡¹æ·»åŠ åˆ°é€‰é¡¹ç»„ä¸­ï¼Œå®ƒå°†æˆä¸ºä¸€ä¸ªæ°¸ä¹…çš„ç»„æˆéƒ¨åˆ†ï¼Œæ— æ³•ç§»é™¤ã€‚

3. **TDEåŠ å¯†æ¨¡å¼**ï¼š

* TDEæä¾›ä¸¤ç§ä¸åŒçš„åŠ å¯†æ¨¡å¼ï¼š
* **TDEè¡¨ç©ºé—´åŠ å¯†**ï¼šæ­¤æ¨¡å¼åŠ å¯†æ•´ä¸ªè¡¨ï¼Œæä¾›æ›´å¹¿æ³›çš„æ•°æ®ä¿æŠ¤èŒƒå›´ã€‚
* **TDEåˆ—åŠ å¯†**ï¼šæ­¤æ¨¡å¼ä¸“æ³¨äºåŠ å¯†æ•°æ®åº“ä¸­ç‰¹å®šçš„ä¸ªåˆ«å…ƒç´ ï¼Œå…è®¸æ›´ç²¾ç»†çš„æ§åˆ¶å“ªäº›æ•°æ®è¢«åŠ å¯†ã€‚

äº†è§£è¿™äº›å…ˆå†³æ¡ä»¶å’ŒTDEçš„æ“ä½œå¤æ‚æ€§å¯¹äºæœ‰æ•ˆå®æ–½å’Œç®¡ç†RDSå†…çš„åŠ å¯†è‡³å…³é‡è¦ï¼Œç¡®ä¿æ•°æ®å®‰å…¨æ€§å¹¶ç¬¦åˆå¿…è¦çš„æ ‡å‡†ã€‚

### æšä¸¾

{% code overflow="wrap" %}
```
```
{% endcode %}

```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```

### æœªç»èº«ä»½éªŒè¯çš„è®¿é—®

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### ææƒ

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### æ¼æ´åˆ©ç”¨åæ“ä½œ

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### æŒä¹…æ€§

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQLæ³¨å…¥

æœ‰æ–¹æ³•å¯ä»¥ä½¿ç”¨**SQLè¯­æ³•**è®¿é—®DynamoDBæ•°æ®ï¼Œå› æ­¤ï¼Œå…¸å‹çš„**SQLæ³¨å…¥ä¹Ÿæ˜¯å¯èƒ½çš„**ã€‚

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
