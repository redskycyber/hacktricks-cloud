# AWS - ECS Enum

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## ECS

### Podstawowe informacje

Amazon **Elastic Container Services** lub ECS dostarcza platform do **hostowania aplikacji w kontenerach w chmurze**. ECS ma dwa **metody wdra偶ania**, typ instancji **EC2** i opcj **bezserwerow**, **Fargate**. Usuga ta **uatwia uruchamianie kontener贸w w chmurze**.

ECS dziaa przy u偶yciu trzech podstawowych element贸w: **Klastry**, **Usugi** i **Definicje zada**.

* **Klastry** to **grupy kontener贸w**, kt贸re dziaaj w chmurze. Jak wczeniej wspomniano, istniej dwa typy uruchamiania kontener贸w: EC2 i Fargate. AWS definiuje typ uruchamiania **EC2** jako umo偶liwiajcy klientom "uruchamianie \[ich] aplikacji w kontenerach na klastrze instancji Amazon EC2, kt贸re \[s] **zarzdzane** przez \[nich]". **Fargate** jest podobny i jest definiowany jako "pozwalajcy na uruchamianie aplikacji w kontenerach **bez koniecznoci dostarczania i zarzdzania** infrastruktur backendow".
* **Usugi** s tworzone wewntrz klastra i s odpowiedzialne za **uruchamianie zada**. W definicji usugi **okrelasz liczb zada do uruchomienia, skalowanie automatyczne, dostawc pojemnoci (Fargate/EC2/Zewntrzny)**, **informacje o sieci** takie jak VPC, podsieci i grupy zabezpiecze.
* Istniej **2 rodzaje aplikacji**:
* **Usuga**: Grupa zada obsugujcych dugotrwa prac obliczeniow, kt贸ra mo偶e by zatrzymywana i ponownie uruchamiana. Na przykad aplikacja internetowa.
* **Zadanie**: Samodzielne zadanie, kt贸re jest uruchamiane i zatrzymywane. Na przykad zadanie wsadowe.
* Wr贸d aplikacji usugowych istniej **2 rodzaje planist贸w usug**:
* [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): Strategia planowania replik umieszcza i **utrzymuje 偶dan liczb** zada w klastrze. Jeli z jakiego powodu zadanie zostanie zatrzymane, uruchamiane jest nowe zadanie na tym samym lub innym w藕le.
* [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): Wdra偶a dokadnie jedno zadanie na ka偶dej aktywnej instancji kontenera, kt贸ra spenia wymagania. Nie trzeba okrela 偶danej liczby zada, strategii umieszczania zada ani korzysta z polityk automatycznego skalowania usugi.
* **Definicje zada** s odpowiedzialne za **okrelanie, jakie kontenery bd uruchamiane** oraz r贸偶ne parametry, kt贸re zostan skonfigurowane wraz z kontenerami, takie jak **mapowanie port贸w** z hostem, **zmienne rodowiskowe**, **punkt wejcia** Docker...
* Sprawd藕 **zmienne rodowiskowe w celu znalezienia poufnych informacji**!

### Poufne dane w definicjach zada

Definicje zada s odpowiedzialne za **konfigurowanie rzeczywistych kontener贸w, kt贸re bd uruchamiane w ECS**. Poniewa偶 definicje zada okrelaj spos贸b uruchamiania kontener贸w, mo偶na w nich znale藕 wiele informacji.

Pacu mo偶e wylicza ECS (list-clusters, list-container-instances, list-services, list-task-definitions), mo偶e r贸wnie偶 wydobywa definicje zada.

### Wyliczanie
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances --cluster <cluster>
aws ecs describe-container-instances --cluster <cluster> --container-instances <container_instance_arn>

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### Nieuwierzytelniony dostp

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### Przywileje

Na nastpnej stronie mo偶esz sprawdzi, jak **wykorzysta uprawnienia ECS do eskalacji przywilej贸w**:

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### Po eksploatacji

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### Trwao

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
