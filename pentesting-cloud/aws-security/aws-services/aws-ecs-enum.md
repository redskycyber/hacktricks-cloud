# AWS - Enumeraci贸n de ECS

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## ECS

### Informaci贸n b谩sica

Amazon **Elastic Container Services** o ECS proporciona una plataforma para **alojar aplicaciones en contenedores en la nube**. ECS tiene dos m茅todos de **implementaci贸n**, el tipo de instancia **EC2** y una opci贸n **sin servidor**, **Fargate**. El servicio **facilita mucho y sin dolor la ejecuci贸n de contenedores en la nube**.

ECS opera utilizando los siguientes tres bloques de construcci贸n: **Clusters**, **Services** y **Task Definitions**.

* **Clusters** son **grupos de contenedores** que se ejecutan en la nube. Como se mencion贸 anteriormente, hay dos tipos de lanzamiento para contenedores, EC2 y Fargate. AWS define el tipo de lanzamiento **EC2** como permitir a los clientes "ejecutar sus aplicaciones en contenedores en un cl煤ster de instancias de Amazon EC2 que ellos **administran**". **Fargate** es similar y se define como "permitirle ejecutar sus aplicaciones en contenedores **sin necesidad de aprovisionar y administrar** la infraestructura de backend".
* **Services** se crean dentro de un cl煤ster y son responsables de **ejecutar las tareas**. Dentro de una definici贸n de servicio, **se define el n煤mero de tareas a ejecutar, el escalado autom谩tico, el proveedor de capacidad (Fargate/EC2/Externo),** informaci贸n de **red** como VPC, subredes y grupos de seguridad.
  * Hay **2 tipos de aplicaciones**:
    * **Servicio**: Un grupo de tareas que manejan un trabajo de computaci贸n de larga duraci贸n que se puede detener y reiniciar. Por ejemplo, una aplicaci贸n web.
    * **Tarea**: Una tarea independiente que se ejecuta y termina. Por ejemplo, un trabajo por lotes.
  * Entre las aplicaciones de servicio, hay **2 tipos de programadores de servicios**:
    * [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): La estrategia de programaci贸n de r茅plicas coloca y **mantiene el n煤mero deseado** de tareas en su cl煤ster. Si por alguna raz贸n una tarea se detiene, se lanza una nueva en el mismo o en un nodo diferente.
    * [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): Despliega exactamente una tarea en cada instancia de contenedor activa que tenga los requisitos necesarios. No es necesario especificar un n煤mero deseado de tareas, una estrategia de colocaci贸n de tareas o usar pol铆ticas de escalado autom谩tico de servicios.
* **Task Definitions** son responsables de **definir qu茅 contenedores se ejecutar谩n** y los diversos par谩metros que se configurar谩n con los contenedores, como **mapeos de puertos** con el host, **variables de entorno**, **entrypoint** de Docker...
  * 隆Verifique las **variables de entorno para obtener informaci贸n confidencial**!

### Datos sensibles en las definiciones de tareas

Las definiciones de tareas son responsables de **configurar los contenedores reales que se ejecutar谩n en ECS**. Dado que las definiciones de tareas definen c贸mo se ejecutar谩n los contenedores, se puede encontrar una gran cantidad de informaci贸n dentro de ellas.

Pacu puede enumerar ECS (list-clusters, list-container-instances, list-services, list-task-definitions), tambi茅n puede volcar las definiciones de tareas.

### Enumeraci贸n

```bash
# Informaci贸n de cl煤steres
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Instancias de contenedor
## Una instancia de contenedor de Amazon ECS es una instancia de Amazon EC2 que est谩 ejecutando el agente de contenedor de Amazon ECS y se ha registrado en un cl煤ster de Amazon ECS.
aws ecs list-container-instances
aws ecs describe-container-instances

# Informaci贸n de servicios
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Definiciones de tareas
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Busque variables de entorno y secretos utilizados desde la definici贸n de la tarea
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```

### Acceso no autenticado

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

En la siguiente p谩gina puedes comprobar c贸mo **abusar de los permisos de ECS para escalar privilegios**:

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### Post Explotaci贸n

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF** 隆Consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>