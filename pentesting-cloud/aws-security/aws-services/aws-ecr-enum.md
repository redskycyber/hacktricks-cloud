# AWS - ECR Enum

## AWS - ECR Enum

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>

### ECR

#### Basiese Inligting

Amazon **Elastic Container Registry** (Amazon ECR) is 'n **bestuurde houerbeeldregisterdiens**. Dit is ontwerp om 'n omgewing te bied waar kli√´nte kan interaksie h√™ met hul houerbeelde deur bekende koppelvlakke te gebruik. Spesifiek word die gebruik van die Docker CLI of enige voorkeurklient ondersteun, wat aktiwiteite soos stoor, optrek en bestuur van houerbeelde moontlik maak.

ECR bestaan uit 2 tipes voorwerpe: **Registers** en **Repositories**.

**Registers**

Elke AWS-rekening het 2 registre: **Privaat** & **Publiek**.

1. **Privaat Registre**:

* **Privaat standaard**: Die houerbeelde wat gestoor word in 'n Amazon ECR privaat register is **slegs toeganklik vir gemagtigde gebruikers** binne jou AWS-rekening of vir diegene wat toestemming gekry het.
* Die URI van 'n **privaat repository** volg die formaat `<rekening_id>.dkr.ecr.<streek>.amazonaws.com/<repo-naam>`
* **Toegangsbeheer**: Jy kan **toegang beheer** tot jou privaat houerbeelde deur **IAM-beleide** te gebruik, en jy kan fynkorrelige toestemmings op grond van gebruikers of rolle konfigureer.
* **Integrasie met AWS-diens**: Amazon ECR privaat registre kan maklik **ge√Øntegreer word met ander AWS-diens**, soos EKS, ECS...
* **Ander privaat registre-opsies**:
* Die Kolom vir tag-onveranderlikheid lys sy status, as tag-onveranderlikheid geaktiveer is, sal dit voorkom dat beeld **stoor** met **vooraf bestaande tags** die beelde oorskryf.
* Die kolom vir **Versleutelingstipe** lys die versleutelingseienskappe van die repository, dit wys die verstekversleutelingstipes soos AES-256, of het **KMS** geaktiveerde versleutelings.
* Die kolom vir **Deurhaal-kas** lys sy status, as die status van Deurhaal-kas Aktief is, sal dit **repositories in 'n eksterne openbare repository in jou privaat repository** kash√™.
* Spesifieke **IAM-beleide** kan gekonfigureer word om verskillende **toestemmings** te verleen.
* Die **skanderingkonfigurasie** maak dit moontlik om vir kwesbaarhede in die beelde wat binne die repo gestoor word, te skandeer.

2. **Publieke Registre**:

* **Publieke toeganklikheid**: Houerbeelde wat in 'n ECR Publieke register gestoor word, is **toeganklik vir enigiemand op die internet sonder outentifikasie**.
* Die URI van 'n **publieke repository** is soos `public.ecr.aws/<willekeurig>/<naam>`. Alhoewel die `<willekeurig>` deel deur die administrateur na 'n ander string wat makliker onthou kan word, verander kan word.

**Repositories**

Dit is die **beelde** wat in die **privaat register** of in die **publieke** een is.

{% hint style="info" %}
Let daarop dat om 'n beeld na 'n repository te laai, die **ECR-repository dieselfde naam as die beeld moet h√™**.
{% endhint %}

#### Register- & Repositorybeleide

**Registre & repositories** het ook **beleide wat gebruik kan word om toestemmings aan ander beginsels/rekeninge te verleen**. Byvoorbeeld, in die volgende repositorybeleidbeeld kan jy sien hoe enige gebruiker van die hele organisasie toegang tot die beeld sal h√™:

<figure><img src="../../../.gitbook/assets/image (280).png" alt=""><figcaption></figcaption></figure>

#### Enumerasie

{% code overflow="wrap" %}
```bash
# Get repos
aws ecr describe-repositories
aws ecr describe-registry

# Get image metadata
aws ecr list-images --repository-name <repo_name>
aws ecr describe-images --repository-name <repo_name>
aws ecr describe-image-replication-status --repository-name <repo_name> --image-id <image_id>
aws ecr describe-image-scan-findings --repository-name <repo_name> --image-id <image_id>
aws ecr describe-pull-through-cache-rules --repository-name <repo_name> --image-id <image_id>

# Get public repositories
aws ecr-public describe-repositories

# Get policies
aws ecr get-registry-policy
aws ecr get-repository-policy --repository-name <repo_name>
```
{% endcode %}

#### Ongeverifieerde Enum

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md" %}
[aws-ecr-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md)
{% endcontent-ref %}

#### Privesc

Op die volgende bladsy kan jy sien hoe om **ECR-toestemmings te misbruik om voorregte te eskaleer**:

{% content-ref url="../aws-privilege-escalation/aws-ecr-privesc.md" %}
[aws-ecr-privesc.md](../aws-privilege-escalation/aws-ecr-privesc.md)
{% endcontent-ref %}

#### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-ecr-post-exploitation.md" %}
[aws-ecr-post-exploitation.md](../aws-post-exploitation/aws-ecr-post-exploitation.md)
{% endcontent-ref %}

#### Volharding

{% content-ref url="../aws-persistence/aws-ecr-persistence.md" %}
[aws-ecr-persistence.md](../aws-persistence/aws-ecr-persistence.md)
{% endcontent-ref %}

## Verwysings

* [https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html](https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html)

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
