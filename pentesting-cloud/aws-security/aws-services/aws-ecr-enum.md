# AWS - ECR Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## ECR

### Temel Bilgiler

Amazon **Elastic Container Registry** (Amazon ECR), yÃ¶netilen bir konteyner gÃ¶rÃ¼ntÃ¼ kayÄ±t defteri hizmetidir. MÃ¼ÅŸterilerin, tanÄ±nmÄ±ÅŸ arayÃ¼zleri kullanarak konteyner gÃ¶rÃ¼ntÃ¼lerine etkileÅŸimde bulunabilecekleri bir ortam saÄŸlamak Ã¼zere tasarlanmÄ±ÅŸtÄ±r. Ã–zellikle Docker CLI veya tercih edilen herhangi bir istemci kullanÄ±mÄ±na destek verilir, bu da itme, Ã§ekme ve konteyner gÃ¶rÃ¼ntÃ¼lerini yÃ¶netme gibi faaliyetleri mÃ¼mkÃ¼n kÄ±lar.

ECR, **KayÄ±t Defterleri** ve **Depolar** olmak Ã¼zere 2 tÃ¼r nesneden oluÅŸur.

#### KayÄ±t Defterleri

Her AWS hesabÄ±nda 2 kayÄ±t defteri bulunur: **Ã–zel** ve **Genel**.

1. **Ã–zel KayÄ±t Defterleri**:

* **VarsayÄ±lan olarak Ã¶zel**: Amazon ECR Ã¶zel bir kayÄ±t defterinde depolanan konteyner gÃ¶rÃ¼ntÃ¼leri, yalnÄ±zca AWS hesabÄ±nÄ±zdaki yetkilendirilmiÅŸ kullanÄ±cÄ±lara veya izin verilenlere eriÅŸilebilir.
* **Ã–zel bir depo**nin URI'si, `<hesap_id>.dkr.ecr.<bÃ¶lge>.amazonaws.com/<repo-adÄ±>` formatÄ±nÄ± izler.
* **EriÅŸim kontrolÃ¼**: Ã–zel konteyner gÃ¶rÃ¼ntÃ¼lerinize **IAM politikalarÄ±** kullanarak eriÅŸimi kontrol edebilir ve kullanÄ±cÄ±lara veya rollerle ilgili ayrÄ±ntÄ±lÄ± izinler yapÄ±landÄ±rabilirsiniz.
* **AWS hizmetleriyle entegrasyon**: Amazon ECR Ã¶zel kayÄ±t defterleri, EKS, ECS gibi diÄŸer AWS hizmetleriyle kolayca entegre edilebilir.
* **DiÄŸer Ã¶zel kayÄ±t defteri seÃ§enekleri**:
* Etiket deÄŸiÅŸmezlik sÃ¼tunu, durumunu listeler, etiket deÄŸiÅŸmezlik etkinleÅŸtirildiyse, Ã¶nceden var olan etiketlerle gÃ¶rÃ¼ntÃ¼ itmelerinin gÃ¶rÃ¼ntÃ¼leri Ã¼zerine yazÄ±lmasÄ±nÄ± **engeller**.
* **Åifreleme tÃ¼rÃ¼** sÃ¼tunu, depo ÅŸifreleme Ã¶zelliklerini listeler, AES-256 gibi varsayÄ±lan ÅŸifreleme tÃ¼rlerini veya KMS etkinleÅŸtirilmiÅŸ ÅŸifrelemeleri gÃ¶sterir.
* **Ã–nbelleÄŸi geÃ§ir** sÃ¼tunu, durumunu listeler, Ã–nbelleÄŸi geÃ§irme durumu Etkinse, **dÄ±ÅŸ bir genel depodaki depolarÄ± Ã¶zel depoya Ã¶nbelleÄŸe alÄ±r**.
* FarklÄ± **izinler** saÄŸlamak iÃ§in Ã¶zel **IAM politikalarÄ±** yapÄ±landÄ±rÄ±labilir.
* **Tarama yapÄ±landÄ±rmasÄ±**, depoda depolanan gÃ¶rÃ¼ntÃ¼lerdeki zafiyetleri taramak iÃ§in kullanÄ±labilir.

2. **Genel KayÄ±t Defterleri**:

* **Genel eriÅŸilebilirlik**: ECR Genel kayÄ±t defterinde depolanan konteyner gÃ¶rÃ¼ntÃ¼leri, kimlik doÄŸrulamasÄ±z olarak internet Ã¼zerindeki herkese **eriÅŸilebilir**.
* **Genel bir depo**nun URI'si, `public.ecr.aws/<rastgele>/<ad>` ÅŸeklindedir. `<rastgele>` kÄ±smÄ± yÃ¶netici tarafÄ±ndan baÅŸka bir hatÄ±rlanmasÄ± daha kolay dizeye deÄŸiÅŸtirilebilir.

#### **Depolar**

Bunlar, **Ã¶zel kayÄ±t defterindeki** veya **genel** olan **gÃ¶rÃ¼ntÃ¼lerdir**.

{% hint style="info" %}
Bir gÃ¶rÃ¼ntÃ¼yÃ¼ bir depoya yÃ¼klemek iÃ§in, **ECR deposunun gÃ¶rÃ¼ntÃ¼yle aynÄ± ada sahip olmasÄ± gerekir**.
{% endhint %}

### KayÄ±t Defteri ve Depo PolitikalarÄ±

**KayÄ±t defterleri ve depolar** ayrÄ±ca **diÄŸer prensiplere/hesaplara izin vermek iÃ§in kullanÄ±labilecek politikalara sahiptir**. Ã–rneÄŸin, aÅŸaÄŸÄ±daki depo politikasÄ± gÃ¶rÃ¼ntÃ¼sÃ¼nde, tÃ¼m organizasyondan herhangi bir kullanÄ±cÄ±nÄ±n gÃ¶rÃ¼ntÃ¼ye eriÅŸebileceÄŸini gÃ¶rebilirsiniz:

<figure><img src="../../../.gitbook/assets/image (87).png" alt=""><figcaption></figcaption></figure>

### NumaralandÄ±rma

{% code overflow="wrap" %}
```bash
# Get repos
aws ecr describe-repositories
aws ecr describe-registry

# Get image metadata
aws ecr list-images --repository-name <repo_name>
aws ecr describe-images --repository-name <repo_name>
aws ecr describe-image-replication-status --repository-name <repo_name> --image-id <image_id>
aws ecr describe-image-scan-findings --repository-name <repo_name> --image-id <image_id>
aws ecr describe-pull-through-cache-rules --repository-name <repo_name> --image-id <image_id>

# Get public repositories
aws ecr-public describe-repositories

# Get policies
aws ecr get-registry-policy
aws ecr get-repository-policy --repository-name <repo_name>
```
{% endcode %}

### Kimlik DoÄŸrulama Olmadan SÄ±ralama

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md" %}
[aws-ecr-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md)
{% endcontent-ref %}

### Privilege Escalation

AÅŸaÄŸÄ±daki sayfada, **ECR izinlerini kÃ¶tÃ¼ye kullanarak ayrÄ±calÄ±klarÄ± yÃ¼kseltme** yÃ¶ntemlerini kontrol edebilirsiniz:

{% content-ref url="../aws-privilege-escalation/aws-ecr-privesc.md" %}
[aws-ecr-privesc.md](../aws-privilege-escalation/aws-ecr-privesc.md)
{% endcontent-ref %}

### SaldÄ±rÄ± SonrasÄ±

{% content-ref url="../aws-post-exploitation/aws-ecr-post-exploitation.md" %}
[aws-ecr-post-exploitation.md](../aws-post-exploitation/aws-ecr-post-exploitation.md)
{% endcontent-ref %}

### KalÄ±cÄ±lÄ±k

{% content-ref url="../aws-persistence/aws-ecr-persistence.md" %}
[aws-ecr-persistence.md](../aws-persistence/aws-ecr-persistence.md)
{% endcontent-ref %}

# Referanslar
* [https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html](https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **tanÄ±tmak isterseniz veya HackTricks'i PDF olarak indirmek isterseniz** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
