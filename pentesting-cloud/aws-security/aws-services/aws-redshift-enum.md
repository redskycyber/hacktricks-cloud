# AWS - Redshift Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>λ¥Ό ν†µν•΄ AWS ν•΄ν‚Ήμ„ μ²μλ¶€ν„° μ „λ¬Έκ°€κΉμ§€ λ°°μ›λ³΄μ„Έμ”<strong>!</strong></summary>

HackTricksλ¥Ό μ§€μ›ν•λ” λ‹¤λ¥Έ λ°©λ²•:

* **νμ‚¬λ¥Ό HackTricksμ—μ„ κ΄‘κ³ ν•κ±°λ‚ HackTricksλ¥Ό PDFλ΅ λ‹¤μ΄λ΅λ“**ν•λ ¤λ©΄ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)λ¥Ό ν™•μΈν•μ„Έμ”!
* [**κ³µμ‹ PEASS & HackTricks μ¤μ›¨κ·Έ**](https://peass.creator-spring.com)λ¥Ό μ–»μΌμ„Έμ”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)λ¥Ό λ°κ²¬ν•μ„Έμ”. λ…μ μ μΈ [**NFTs**](https://opensea.io/collection/the-peass-family) μ»¬λ ‰μ…μ…λ‹λ‹¤.
* π’¬ [**Discord κ·Έλ£Ή**](https://discord.gg/hRep4RUj7f) λλ” [**ν…”λ κ·Έλ¨ κ·Έλ£Ή**](https://t.me/peass)μ— **μ°Έμ—¬**ν•κ±°λ‚ **Twitter** π¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**λ¥Ό** **ν”λ΅μ°**ν•μ„Έμ”.
* **HackTricks**μ™€ **HackTricks Cloud** github μ €μ¥μ†μ— PRμ„ μ μ¶ν•μ—¬ **ν•΄ν‚Ή νΈλ¦­μ„ κ³µμ **ν•μ„Έμ”.

</details>

## Amazon Redshift

Redshiftλ” **λΉ… λ°μ΄ν„° μ†”λ£¨μ…μ„ μ„ν• λ°μ΄ν„° μ›¨μ–΄ν•μ°μ¤**λ΅ μ‚¬μ©λλ” **ννƒ€λ°”μ΄νΈ μ΄μƒμΌλ΅ ν™•μ¥ κ°€λ¥ν• μ™„μ „ν κ΄€λ¦¬λλ” μ„λΉ„μ¤**μ…λ‹λ‹¤. Redshift ν΄λ¬μ¤ν„°λ¥Ό μ‚¬μ©ν•μ—¬ λΉ λ¥Έ SQL κΈ°λ° μΏΌλ¦¬ λ„κµ¬μ™€ λΉ„μ¦λ‹μ¤ μΈν…”λ¦¬μ „μ¤ μ• ν”λ¦¬μΌ€μ΄μ…μ„ μ‚¬μ©ν•μ—¬ λ°μ΄ν„°μ…‹μ— λ€ν• λ¶„μ„μ„ μ‹¤ν–‰ν•κ³  λΉ„μ¦λ‹μ¤μ λΉ„μ „μ„ λ” μ μ΄ν•΄ν•  μ μμµλ‹λ‹¤.

**Redshiftλ” KMS λλ” CloudHSMμ„ μ‚¬μ©ν•μ—¬ λ„¤ λ‹¨κ³„μ μ•”νΈν™” ν‚¤ κ³„μΈµμ„ μ‚¬μ©ν•μ—¬ λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² μ €μ¥**ν•©λ‹λ‹¤. **ν΄λ¬μ¤ν„°μ— λ€ν• μ•”νΈν™”κ°€ ν™μ„±ν™”λλ©΄ λΉ„ν™μ„±ν™”ν•  μ μ—†μΌλ©° κ·Έ λ°λ€λ„ λ§μ°¬κ°€μ§€μ…λ‹λ‹¤**. μ•”νΈν™”λμ§€ μ•μ€ ν΄λ¬μ¤ν„°λ” μ•”νΈν™”ν•  μ μ—†μµλ‹λ‹¤.

ν΄λ¬μ¤ν„°μ μ•”νΈν™”λ” μƒμ„± μ¤‘μ—λ§ κ°€λ¥ν•λ©°, μ•”νΈν™”λ κ²½μ° λ°μ΄ν„°, λ©”νƒ€λ°μ΄ν„° λ° μ¤λƒ…μƒ·λ„ μ•”νΈν™”λ©λ‹λ‹¤. μ•”νΈν™” ν‚¤μ κ³„μΈµ μμ¤€μ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤. **ν‹°μ–΄ 1μ€ λ§μ¤ν„° ν‚¤, ν‹°μ–΄ 2λ” ν΄λ¬μ¤ν„° μ•”νΈν™” ν‚¤(CEK), ν‹°μ–΄ 3μ€ λ°μ΄ν„°λ² μ΄μ¤ μ•”νΈν™” ν‚¤(DEK)μ΄κ³ , λ§μ§€λ§‰μΌλ΅ ν‹°μ–΄ 4λ” λ°μ΄ν„° μ•”νΈν™” ν‚¤ μμ²΄μ…λ‹λ‹¤**.

### KMS

ν΄λ¬μ¤ν„° μƒμ„± μ¤‘μ— Redshiftμ **κΈ°λ³Έ KMS ν‚¤**λ¥Ό μ„ νƒν•κ±°λ‚ **μμ²΄ CMK**λ¥Ό μ„ νƒν•  μ μμµλ‹λ‹¤. μμ²΄ CMKλ¥Ό μ„ νƒν•λ©΄ ν‚¤μ μ μ–΄μ— λ€ν• κ°μ‚¬ κ΄€μ μ—μ„ λ” λ§μ€ μ μ—°μ„±μ„ μ κ³µν•©λ‹λ‹¤.

Redshiftμ κΈ°λ³Έ KMS ν‚¤λ” Redshiftκ°€ ν‚¤ μµμ…μ„ μ„ νƒν•κ³  μ‚¬μ©ν•λ” μ²« λ²μ§Έ μ‹κ°„μ— μλ™μΌλ΅ μƒμ„±λλ©°, AWSκ°€ μ™„μ „ν κ΄€λ¦¬ν•©λ‹λ‹¤.

μ΄ KMS ν‚¤λ” κ·Έ λ‹¤μμ— CMK λ§μ¤ν„° ν‚¤(ν‹°μ–΄ 1)λ΅ μ•”νΈν™”λ©λ‹λ‹¤. μ΄ μ•”νΈν™”λ KMS λ°μ΄ν„° ν‚¤λ” ν΄λ¬μ¤ν„° μ•”νΈν™” ν‚¤(CEK, ν‹°μ–΄ 2)λ΅ μ‚¬μ©λ©λ‹λ‹¤. μ΄ CEKλ” KMSμ— μν•΄ Redshiftλ΅ μ „μ†΅λμ–΄ ν΄λ¬μ¤ν„°μ™€ λ³„λ„λ΅ μ €μ¥λ©λ‹λ‹¤. κ·Έλ° λ‹¤μ Redshiftλ” μ΄ μ•”νΈν™”λ CEKλ¥Ό μ•μ „ν• μ±„λ„μ„ ν†µν•΄ ν΄λ¬μ¤ν„°λ΅ μ „μ†΅ν•μ—¬ λ©”λ¨λ¦¬μ— μ €μ¥ν•©λ‹λ‹¤.

Redshiftλ” κ·Έλ° λ‹¤μ KMSμ—κ² CEK(ν‹°μ–΄ 2)λ¥Ό λ³µνΈν™”ν•λ„λ΅ μ”μ²­ν•©λ‹λ‹¤. μ΄ λ³µνΈν™”λ CEKλ„ λ©”λ¨λ¦¬μ— μ €μ¥λ©λ‹λ‹¤. κ·Έλ° λ‹¤μ Redshiftλ” λ¬΄μ‘μ„λ΅ μƒμ„±λ λ°μ΄ν„°λ² μ΄μ¤ μ•”νΈν™” ν‚¤(DEK, ν‹°μ–΄ 3)λ¥Ό μƒμ„±ν•κ³  ν΄λ¬μ¤ν„°μ λ©”λ¨λ¦¬μ—λ΅λ“ν•©λ‹λ‹¤. λ©”λ¨λ¦¬μ— μ €μ¥λ λ³µνΈν™”λ CEKλ” λ©”λ¨λ¦¬μ— μ €μ¥λ DEKλ¥Ό μ•”νΈν™”ν•κ³  μ΄λ¥Ό λ©”λ¨λ¦¬μ— μ €μ¥ν•©λ‹λ‹¤.

μ΄ μ•”νΈν™”λ DEKλ” μ•μ „ν• μ±„λ„μ„ ν†µν•΄ μ „μ†΅λμ–΄ ν΄λ¬μ¤ν„°μ™€ λ³„λ„λ΅ Redshiftμ— μ €μ¥λ©λ‹λ‹¤. CEKμ™€ DEKλ” μ΄μ  ν΄λ¬μ¤ν„°μ λ©”λ¨λ¦¬μ— μ•”νΈν™” λ° λ³µνΈν™”λ ν•νƒλ΅ λ¨λ‘ μ €μ¥λ©λ‹λ‹¤. λ³µνΈν™”λ DEKλ” λ°μ΄ν„°λ² μ΄μ¤μ κ° λ°μ΄ν„° λΈ”λ΅μ— λ€ν•΄ Redshiftκ°€ λ¬΄μ‘μ„λ΅ μƒμ„±ν• λ°μ΄ν„° ν‚¤(ν‹°μ–΄ 4)λ¥Ό μ•”νΈν™”ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤.

Amazon S3 λ²„ν‚·μ κµ¬μ„±μ„ λ¨λ‹ν„°λ§ν•κ³  λ²„ν‚· λ΅κΉ…μ΄ ν™μ„±ν™”λμ–΄ μλ”μ§€ ν™•μΈν•κΈ° μ„ν•΄ AWS Trusted Advisorλ¥Ό μ‚¬μ©ν•  μ μμΌλ©°, μ΄λ” λ³΄μ• κ°μ‚¬ λ° μ‚¬μ© ν¨ν„΄ μ¶”μ μ— μ μ©ν•  μ μμµλ‹λ‹¤.

### CloudHSM

<details>

<summary>CloudHSMμ„ μ‚¬μ©ν•μ—¬ Redshift μ‚¬μ©</summary>

μ•”νΈν™”λ¥Ό μν–‰ν•κΈ° μ„ν•΄ CloudHSMμ„ μ‚¬μ©ν•  λ•, λ¨Όμ € HSM ν΄λΌμ΄μ–ΈνΈμ™€ Redshift κ°„μ— μ‹ λΆ°ν•  μ μλ” μ—°κ²°μ„ μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤. μ΄ μ—°κ²°μ€ μ•”νΈν™” ν‚¤λ¥Ό HSM ν΄λΌμ΄μ–ΈνΈμ™€ Redshift ν΄λ¬μ¤ν„° κ°„μ— μ „μ†΅ν•  μ μλ„λ΅ μ•μ „ν• ν†µμ‹ μ„ μ κ³µν•κΈ° μ„ν•΄ ν•„μ”ν•©λ‹λ‹¤.

Redshiftλ” λ¬΄μ‘μ„λ΅ μƒμ„±λ κ°μΈ λ° κ³µκ° ν‚¤ μμ„ μ‚¬μ©ν•μ—¬ κ³µκ° ν΄λΌμ΄μ–ΈνΈ μΈμ¦μ„λ¥Ό μƒμ„±ν•κ³  μ΄λ¥Ό μ•”νΈν™”ν•μ—¬ Redshiftμ— μ €μ¥ν•©λ‹λ‹¤. μ΄ μΈμ¦μ„λ¥Ό λ‹¤μ΄λ΅λ“ν•κ³  HSM ν΄λΌμ΄μ–ΈνΈμ— λ“±λ΅ν•κ³  μ¬λ°”λ¥Έ HSM νν‹°μ…μ— ν• λ‹Ήν•΄μ•Ό ν•©λ‹λ‹¤.

κ·Έλ° λ‹¤μ Redshiftλ¥Ό λ‹¤μκ³Ό κ°™μ€ HSM ν΄λΌμ΄μ–ΈνΈμ μ„Έλ¶€ μ •λ³΄λ΅ κµ¬μ„±ν•΄μ•Ό ν•©λ‹λ‹¤. HSM IP μ£Όμ†, HSM νν‹°μ… μ΄λ¦„, HSM νν‹°μ… λΉ„λ°€λ²νΈ λ° CloudHSMμ΄ λ‚΄λ¶€ λ§μ¤ν„° ν‚¤λ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™”ν• κ³µκ° HSM μ„λ²„ μΈμ¦μ„μ…λ‹λ‹¤. μ΄ μ •λ³΄λ¥Ό μ κ³µν•λ©΄ Redshiftκ°€ κ°λ° νν‹°μ…μ— μ—°κ²°ν•κ³  μ•΅μ„Έμ¤ν•  μ μλ”μ§€ ν™•μΈ λ° κ²€μ¦ν•©λ‹λ‹¤.

λ‚΄λ¶€ λ³΄μ• μ •μ±…μ΄λ‚ κ±°λ²„λ„μ¤ μ»¨νΈλ΅¤μ—μ„ ν‚¤ νμ „μ„ μ μ©ν•΄μ•Ό ν•λ‹¤λ” κ²½μ°, μ•”νΈν™”λ ν΄λ¬μ¤ν„°μ μ•”νΈν™” ν‚¤λ¥Ό νμ „ν•  μ μμµλ‹λ‹¤. κ·Έλ¬λ‚ ν‚¤ νμ „ ν”„λ΅μ„Έμ¤ μ¤‘μ— ν΄λ¬μ¤ν„°λ¥Ό λ§¤μ° μ§§μ€ μ‹κ°„ λ™μ• μ‚¬μ©ν•  μ μ—†κ² λ§λ“¤κΈ° λ•λ¬Έμ— ν•„μ”ν•  λ•λ§ ν‚¤λ¥Ό νμ „ν•κ±°λ‚ μ μ¶λμ—μ„ μ μλ‹¤κ³  μƒκ°λλ” κ²½μ°μ—λ§ νμ „ν•λ” κ²ƒμ΄ μΆ‹μµλ‹λ‹¤.

νμ „ μ¤‘μ— Redshiftλ” ν΄λ¬μ¤ν„°μ CEKμ™€ ν•΄λ‹Ή ν΄λ¬μ¤ν„°μ λ°±μ—…μ„ νμ „ν•©λ‹λ‹¤. ν΄λ¬μ¤ν„°μ DEKλ„ νμ „ν•μ§€λ§ DEKλ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™”λ S3μ— μ €μ¥λ μ¤λƒ…μƒ·μ DEKλ¥Ό νμ „ν•  μλ” μ—†μµλ‹λ‹¤. ν΄λ¬μ¤ν„°λ” 'ν‚¤ νμ „' μƒνƒλ΅ μ „ν™λλ©° ν”„λ΅μ„Έμ¤κ°€ μ™„λ£λλ©΄ μƒνƒκ°€ 'μ‚¬μ© κ°€λ¥'λ΅ λ³€κ²½λ©λ‹λ‹¤.

</details>

### μ—΄κ±°

```bash
# Get clusters
aws redshift describe-clusters
## Get if publicly accessible
aws redshift describe-clusters | jq -r ".Clusters[].PubliclyAccessible"
## Get DB username to login
aws redshift describe-clusters | jq -r ".Clusters[].MasterUsername"
## Get endpoint
aws redshift describe-clusters | jq -r ".Clusters[].Endpoint"
## Public addresses of the nodes
aws redshift describe-clusters | jq -r ".Clusters[].ClusterNodes[].PublicIPAddress"
## Get IAM roles of the clusters
aws redshift describe-clusters | jq -r ".Clusters[].IamRoles"

# Endpoint access & authorization
aws redshift describe-endpoint-access
aws redshift describe-endpoint-authorization

# Get credentials
aws redshift get-cluster-credentials --db-user <username> --cluster-identifier <cluster-id>
## By default, the temporary credentials expire in 900 seconds. You can optionally specify a duration between 900 seconds (15 minutes) and 3600 seconds (60 minutes).
aws redshift get-cluster-credentials-with-iam --cluster-identifier <cluster-id>
## Gives creds to access redshift with the IAM redshift permissions given to the current AWS account
## More in https://docs.aws.amazon.com/redshift/latest/mgmt/redshift-iam-access-control-identity-based.html

# Authentication profiles
aws redshift describe-authentication-profiles

# Snapshots
aws redshift describe-cluster-snapshots

# Scheduled actions
aws redshift describe-scheduled-actions

# Connect
# The redshift instance must be publicly available (not by default), the sg need to allow inbounds connections to the port and you need creds
psql -h redshift-cluster-1.sdflju3jdfkfg.us-east-1.redshift.amazonaws.com -U admin -d dev -p 5439
```

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-redshift-privesc.md" %}
[aws-redshift-privesc.md](../aws-privilege-escalation/aws-redshift-privesc.md)
{% endcontent-ref %}

## Persistence

λ‹¤μ μ‘μ—…μ€ ν΄λ¬μ¤ν„°μ— λ‹¤λ¥Έ AWS κ³„μ •μ— λ€ν• μ•΅μ„Έμ¤ κ¶ν•μ„ λ¶€μ—¬ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤:

* [authorize-endpoint-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-endpoint-access.html)
* [authorize-snapshot-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-snapshot-access.html)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>λ¥Ό ν†µν•΄ AWS ν•΄ν‚Ήμ„ μ²μλ¶€ν„° μ „λ¬Έκ°€κΉμ§€ λ°°μ›λ³΄μ„Έμ”<strong>!</strong></summary>

HackTricksλ¥Ό μ§€μ›ν•λ” λ‹¤λ¥Έ λ°©λ²•:

* νμ‚¬λ¥Ό HackTricksμ—μ„ κ΄‘κ³ ν•κ±°λ‚ HackTricksλ¥Ό PDFλ΅ λ‹¤μ΄λ΅λ“ν•λ ¤λ©΄ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)λ¥Ό ν™•μΈν•μ„Έμ”!
* [**κ³µμ‹ PEASS & HackTricks μƒν’**](https://peass.creator-spring.com)μ„ κµ¬λ§¤ν•μ„Έμ”.
* λ…μ μ μΈ [**NFTs**](https://opensea.io/collection/the-peass-family)μΈ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)λ¥Ό λ°κ²¬ν•μ„Έμ”.
* π’¬ [**Discord κ·Έλ£Ή**](https://discord.gg/hRep4RUj7f) λλ” [**ν…”λ κ·Έλ¨ κ·Έλ£Ή**](https://t.me/peass)μ— **μ°Έμ—¬**ν•κ±°λ‚ **Twitter** π¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)λ¥Ό **ν”λ΅μ°**ν•μ„Έμ”.
* **HackTricks**μ™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github μ €μ¥μ†μ— PRμ„ μ μ¶ν•μ—¬ μ—¬λ¬λ¶„μ ν•΄ν‚Ή κΈ°λ²•μ„ κ³µμ ν•μ„Έμ”.

</details>
