# AWS - Redshift Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team μ „λ¬Έκ°€)</strong>λ¥Ό ν†µν•΄ **μ λ΅λ¶€ν„° μμ›…κΉμ§€ AWS ν•΄ν‚Ή λ°°μ°κΈ°**!</summary>

HackTricksλ¥Ό μ§€μ›ν•λ” λ‹¤λ¥Έ λ°©λ²•:

* **νμ‚¬λ¥Ό HackTricksμ—μ„ κ΄‘κ³ **ν•κ±°λ‚ **PDFλ΅ HackTricks λ‹¤μ΄λ΅λ“**ν•λ ¤λ©΄ [**κµ¬λ… μ”κΈμ **](https://github.com/sponsors/carlospolop)λ¥Ό ν™•μΈν•μ„Έμ”!
* [**κ³µμ‹ PEASS & HackTricks μ¤μ™κ·Έ**](https://peass.creator-spring.com)λ¥Ό κµ¬μ…ν•μ„Έμ”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)λ¥Ό λ°κ²¬ν•μ„Έμ”, λ‹Ήμ‚¬μ λ…μ  [**NFTs**](https://opensea.io/collection/the-peass-family) μ»¬λ ‰μ…
* **π’¬ [λ””μ¤μ½”λ“ κ·Έλ£Ή](https://discord.gg/hRep4RUj7f)** λλ” [ν…”λ κ·Έλ¨ κ·Έλ£Ή](https://t.me/peass)μ— **κ°€μ…**ν•κ±°λ‚ **νΈμ„ν„°** π¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**λ¥Ό ν”λ΅μ°**ν•μ„Έμ”.
* **HackTricks** λ° **HackTricks Cloud** κΉƒν—λΈ μ €μ¥μ†μ— PRμ„ μ μ¶ν•μ—¬ ν•΄ν‚Ή νΈλ¦­μ„ κ³µμ ν•μ„Έμ”.

</details>

## Amazon Redshift

Redshiftμ€ **λΉ… λ°μ΄ν„° μ†”λ£¨μ…μ„ μ„ν• λ°μ΄ν„° μ›¨μ–΄ν•μ°μ¤**λ΅ μ‚¬μ©λλ” **ννƒ€λ°”μ΄νΈ μ΄μƒμΌλ΅ ν™•μ¥ κ°€λ¥ν• μ™„μ „ν κ΄€λ¦¬λλ” μ„λΉ„μ¤**μ…λ‹λ‹¤. Redshift ν΄λ¬μ¤ν„°λ¥Ό μ‚¬μ©ν•λ©΄ λΉ λ¥Έ SQL κΈ°λ° μΏΌλ¦¬ λ„κµ¬ λ° λΉ„μ¦λ‹μ¤ μΈν…”λ¦¬μ „μ¤ μ• ν”λ¦¬μΌ€μ΄μ…μ„ μ‚¬μ©ν•μ—¬ λ°μ΄ν„° μ§‘ν•©μ— λ€ν• λ¶„μ„μ„ μν–‰ν•κ³  λΉ„μ¦λ‹μ¤μ λΉ„μ „μ„ λ” μ νμ•…ν•  μ μμµλ‹λ‹¤.

**Redshiftλ” KMS λλ” CloudHSMμ„ μ‚¬μ©ν•μ—¬ λ„¤ κ°μ κ³„μΈµμΌλ΅ κµ¬μ„±λ μ•”νΈν™” ν‚¤ κ³„μΈµμ„ μ‚¬μ©ν•μ—¬ λ°μ΄ν„° μ•”νΈν™”λ¥Ό μ κ³µν•©λ‹λ‹¤**. **ν΄λ¬μ¤ν„°μ— λ€ν• μ•”νΈν™”κ°€ ν™μ„±ν™”λλ©΄ λΉ„ν™μ„±ν™”ν•  μ μ—†μΌλ©° κ·Έ λ°λ€λ„ λ§μ°¬κ°€μ§€**μ…λ‹λ‹¤. μ•”νΈν™”λμ§€ μ•μ€ ν΄λ¬μ¤ν„°λ” μ•”νΈν™”ν•  μ μ—†μµλ‹λ‹¤.

ν΄λ¬μ¤ν„°μ μ•”νΈν™”λ” μƒμ„± μ¤‘μ—λ§ μν–‰ν•  μ μμΌλ©° ν• λ² μ•”νΈν™”λλ©΄ λ°μ΄ν„°, λ©”νƒ€λ°μ΄ν„° λ° μ¤λƒ…μƒ·λ„ μ•”νΈν™”λ©λ‹λ‹¤. μ•”νΈν™” ν‚¤μ κ³„μΈµ μμ¤€μ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤. **μ²« λ²μ§Έ κ³„μΈµμ€ λ§μ¤ν„° ν‚¤, λ‘ λ²μ§Έ κ³„μΈµμ€ ν΄λ¬μ¤ν„° μ•”νΈν™” ν‚¤(CEK), μ„Έ λ²μ§Έ κ³„μΈµμ€ λ°μ΄ν„°λ² μ΄μ¤ μ•”νΈν™” ν‚¤(DEK), λ§μ§€λ§‰μΌλ΅ λ„¤ λ²μ§Έ κ³„μΈµμ€ λ°μ΄ν„° μ•”νΈν™” ν‚¤ μμ²΄**μ…λ‹λ‹¤.

### KMS

ν΄λ¬μ¤ν„° μƒμ„± μ¤‘μ— Redshiftμ **κΈ°λ³Έ KMS ν‚¤**λ¥Ό μ„ νƒν•κ±°λ‚ **μ‚¬μ©μ κ³ μ μ CMK**λ¥Ό μ„ νƒν•  μ μμΌλ©°, μ΄λ¥Ό ν†µν•΄ ν‚¤μ μ μ–΄μ— λ€ν• μ μ—°μ„±μ΄ λ†’μ•„μ§‘λ‹λ‹¤.

Redshiftμ κΈ°λ³Έ KMS ν‚¤λ” Redshiftμ— μν•΄ μλ™μΌλ΅ μƒμ„±λλ©° μ²μμΌλ΅ ν‚¤ μµμ…μ΄ μ„ νƒλκ³  μ‚¬μ©λ  λ• μ™„μ „ν AWSμ— μν•΄ κ΄€λ¦¬λ©λ‹λ‹¤.

μ΄ KMS ν‚¤λ” λ§μ¤ν„° ν‚¤μΈ μ²« λ²μ§Έ κ³„μΈµμΌλ΅ μ•”νΈν™”λ©λ‹λ‹¤. μ΄ μ•”νΈν™”λ KMS λ°μ΄ν„° ν‚¤λ” ν΄λ¬μ¤ν„° μ•”νΈν™” ν‚¤(CEK)μΈ λ‘ λ²μ§Έ κ³„μΈµμΌλ΅ μ‚¬μ©λ©λ‹λ‹¤. μ΄ CEKλ” KMSμ— μν•΄ Redshiftλ΅ μ „μ†΅λμ–΄ ν΄λ¬μ¤ν„°μ™€ λ³„λ„λ΅ μ €μ¥λ©λ‹λ‹¤. κ·Έλ° λ‹¤μ Redshiftλ” μ΄ μ•”νΈν™”λ CEKλ¥Ό ν΄λ¬μ¤ν„°λ΅ μ•μ „ν• μ±„λ„μ„ ν†µν•΄ μ „μ†΅ν•μ—¬ λ©”λ¨λ¦¬μ— μ €μ¥ν•©λ‹λ‹¤.

κ·Έλ° λ‹¤μ Redshiftλ” KMSμ—κ² CEK(λ‘ λ²μ§Έ κ³„μΈµ)λ¥Ό λ³µνΈν™”ν•λ„λ΅ μ”μ²­ν•©λ‹λ‹¤. μ΄ λ³µνΈν™”λ CEKλ„ λ©”λ¨λ¦¬μ— μ €μ¥λ©λ‹λ‹¤. κ·Έλ° λ‹¤μ Redshiftλ” λ¬΄μ‘μ„ λ°μ΄ν„°λ² μ΄μ¤ μ•”νΈν™” ν‚¤(DEK)μΈ μ„Έ λ²μ§Έ κ³„μΈµμ„ μƒμ„±ν•κ³  ν΄λ¬μ¤ν„°μ λ©”λ¨λ¦¬μ—λ΅λ“ν•©λ‹λ‹¤. λ©”λ¨λ¦¬μ— μ €μ¥λ λ³µνΈν™”λ CEKλ” λ©”λ¨λ¦¬μ— μ €μ¥λ DEKλ¥Ό μ•”νΈν™”ν•λ©° μ΄ λν• λ©”λ¨λ¦¬μ— μ €μ¥λ©λ‹λ‹¤.

μ΄ μ•”νΈν™”λ DEKλ” μ•μ „ν• μ±„λ„μ„ ν†µν•΄ μ „μ†΅λμ–΄ ν΄λ¬μ¤ν„°μ™€ λ³„λ„λ΅ Redshiftμ— μ €μ¥λ©λ‹λ‹¤. CEK λ° DEKλ” μ΄μ  ν΄λ¬μ¤ν„°μ λ©”λ¨λ¦¬μ— μ•”νΈν™” λ° λ³µνΈν™”λ ν•νƒλ΅ λ¨λ‘ μ €μ¥λ©λ‹λ‹¤. λ³µνΈν™”λ DEKλ” λ°μ΄ν„°λ² μ΄μ¤μ κ° λ°μ΄ν„° λΈ”λ΅μ— λ€ν•΄ Redshiftμ— μν•΄ λ¬΄μ‘μ„λ΅ μƒμ„±λ λ°μ΄ν„° ν‚¤(λ„¤ λ²μ§Έ κ³„μΈµ)λ¥Ό μ•”νΈν™”ν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤.

Amazon S3 λ²„ν‚·μ κµ¬μ„±μ„ λ¨λ‹ν„°λ§ν•κ³  λ²„ν‚· λ΅κΉ…μ΄ ν™μ„±ν™”λμ–΄ μλ”μ§€ ν™•μΈν•λ” λ° μ μ©ν• AWS Trusted Advisorλ¥Ό μ‚¬μ©ν•  μ μμµλ‹λ‹¤. μ΄λ” λ³΄μ• κ°μ‚¬λ¥Ό μν–‰ν•κ³  S3μ—μ„ μ‚¬μ© ν¨ν„΄μ„ μ¶”μ ν•λ” λ° μ μ©ν•  μ μμµλ‹λ‹¤.

### CloudHSM

<details>

<summary>CloudHSMμ„ μ‚¬μ©ν• Redshift</summary>

μ•”νΈν™”λ¥Ό μν–‰ν•κΈ° μ„ν•΄ CloudHSMμ„ μ‚¬μ©ν•  λ•, λ¨Όμ € HSM ν΄λΌμ΄μ–ΈνΈμ™€ Redshift κ°„μ— μ‹ λΆ°ν•  μ μλ” μ—°κ²°μ„ μ„¤μ •ν•΄μ•Ό ν•©λ‹λ‹¤. μ΄λ• ν΄λΌμ΄μ–ΈνΈ λ° μ„λ²„ μΈμ¦μ„λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

μ΄ μ—°κ²°μ€ μ•”νΈν™” ν‚¤κ°€ HSM ν΄λΌμ΄μ–ΈνΈμ™€ Redshift ν΄λ¬μ¤ν„° κ°„μ— μ „μ†΅λλ„λ΅ ν—μ©ν•λ” μ•μ „ν• ν†µμ‹ μ„ μ κ³µν•΄μ•Ό ν•©λ‹λ‹¤. λ¬΄μ‘μ„λ΅ μƒμ„±λ κ°μΈ λ° κ³µκ° ν‚¤ μμ„ μ‚¬μ©ν•μ—¬ Redshiftλ” κ³µκ° ν΄λΌμ΄μ–ΈνΈ μΈμ¦μ„λ¥Ό μƒμ„±ν•κ³  μ΄λ¥Ό μ•”νΈν™”ν•μ—¬ μ €μ¥ν•©λ‹λ‹¤. μ΄λ¥Ό HSM ν΄λΌμ΄μ–ΈνΈμ— λ‹¤μ΄λ΅λ“ν•κ³  λ“±λ΅ν•κ³  μ¬λ°”λ¥Έ HSM νν‹°μ…μ— ν• λ‹Ήν•΄μ•Ό ν•©λ‹λ‹¤.

κ·Έλ° λ‹¤μ Redshiftλ¥Ό HSM ν΄λΌμ΄μ–ΈνΈμ λ‹¤μ μ„Έλ¶€ μ •λ³΄λ΅ κµ¬μ„±ν•΄μ•Ό ν•©λ‹λ‹¤: HSM IP μ£Όμ†, HSM νν‹°μ… μ΄λ¦„, HSM νν‹°μ… μ•”νΈ, λ‚΄λ¶€ λ§μ¤ν„° ν‚¤λ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™”λ HSM μ„λ²„ κ³µκ° μΈμ¦μ„μ…λ‹λ‹¤. μ΄ μ •λ³΄λ¥Ό μ κ³µν•λ©΄ Redshiftκ°€ μ—°κ²°μ„ ν™•μΈν•κ³  κ°λ° νν‹°μ…μ— μ•΅μ„Έμ¤ν•  μ μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

λ‚΄λ¶€ λ³΄μ• μ •μ±…μ΄λ‚ κ±°λ²„λ„μ¤ μ»¨νΈλ΅¤μ΄ ν‚¤ νμ „μ„ μ μ©ν•΄μ•Ό ν•λ‹¤λ©΄, Redshiftλ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™”λ ν΄λ¬μ¤ν„°μ μ•”νΈν™” ν‚¤λ¥Ό νμ „μ‹ν‚¬ μ μμ§€λ§, ν‚¤ νμ „ ν”„λ΅μ„Έμ¤ μ¤‘μ— ν΄λ¬μ¤ν„°λ¥Ό λ§¤μ° μ§§μ€ μ‹κ°„ λ™μ• μ‚¬μ©ν•  μ μ—†κ² λ§λ“¤κΈ° λ•λ¬Έμ— ν‚¤ νμ „ μ‹ ν΄λ¬μ¤ν„°λ¥Ό ν•„μ”ν•  λ•λ§ νμ „ν•κ±°λ‚ μ μ¶λ  μ μλ‹¤κ³  μƒκ°λλ” κ²½μ°μ—λ§ νμ „ν•λ” κ²ƒμ΄ μΆ‹μµλ‹λ‹¤.

ν‚¤ νμ „ μ¤‘μ— Redshiftλ” ν΄λ¬μ¤ν„°μ CEK λ° ν•΄λ‹Ή ν΄λ¬μ¤ν„°μ λ°±μ—…μ„ μ„ν•΄ CEKλ¥Ό νμ „ν•©λ‹λ‹¤. ν΄λ¬μ¤ν„°μ DEKλ¥Ό νμ „ν•μ§€λ§ DEKλ¥Ό μ‚¬μ©ν•μ—¬ μ•”νΈν™”λ S3μ— μ €μ¥λ μ¤λƒ…μƒ·μ DEKλ¥Ό νμ „ν•  μλ” μ—†μµλ‹λ‹¤. ν”„λ΅μ„Έμ¤κ°€ μ™„λ£λλ©΄ ν΄λ¬μ¤ν„° μƒνƒκ°€ 'μ‚¬μ© κ°€λ¥'λ΅ λ°ν™λ  λ•κΉμ§€ ν΄λ¬μ¤ν„°λ¥Ό 'ν‚¤ νμ „ μ¤‘' μƒνƒλ΅ μ„¤μ •ν•©λ‹λ‹¤.

</details>

### μ—΄κ±°
```bash
# Get clusters
aws redshift describe-clusters
## Get if publicly accessible
aws redshift describe-clusters | jq -r ".Clusters[].PubliclyAccessible"
## Get DB username to login
aws redshift describe-clusters | jq -r ".Clusters[].MasterUsername"
## Get endpoint
aws redshift describe-clusters | jq -r ".Clusters[].Endpoint"
## Public addresses of the nodes
aws redshift describe-clusters | jq -r ".Clusters[].ClusterNodes[].PublicIPAddress"
## Get IAM roles of the clusters
aws redshift describe-clusters | jq -r ".Clusters[].IamRoles"

# Endpoint access & authorization
aws redshift describe-endpoint-access
aws redshift describe-endpoint-authorization

# Get credentials
aws redshift get-cluster-credentials --db-user <username> --cluster-identifier <cluster-id>
## By default, the temporary credentials expire in 900 seconds. You can optionally specify a duration between 900 seconds (15 minutes) and 3600 seconds (60 minutes).
aws redshift get-cluster-credentials-with-iam --cluster-identifier <cluster-id>
## Gives creds to access redshift with the IAM redshift permissions given to the current AWS account
## More in https://docs.aws.amazon.com/redshift/latest/mgmt/redshift-iam-access-control-identity-based.html

# Authentication profiles
aws redshift describe-authentication-profiles

# Snapshots
aws redshift describe-cluster-snapshots

# Scheduled actions
aws redshift describe-scheduled-actions

# Connect
# The redshift instance must be publicly available (not by default), the sg need to allow inbounds connections to the port and you need creds
psql -h redshift-cluster-1.sdflju3jdfkfg.us-east-1.redshift.amazonaws.com -U admin -d dev -p 5439
```
## κ¶ν• μƒμΉ

{% content-ref url="../aws-privilege-escalation/aws-redshift-privesc.md" %}
[aws-redshift-privesc.md](../aws-privilege-escalation/aws-redshift-privesc.md)
{% endcontent-ref %}

## μ§€μ†μ„±

λ‹¤μ μ‘μ—…μ€ ν΄λ¬μ¤ν„°μ— λ‹¤λ¥Έ AWS κ³„μ •μ— μ•΅μ„Έμ¤ κ¶ν•μ„ λ¶€μ—¬ν•  μ μμµλ‹λ‹¤:

* [authorize-endpoint-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-endpoint-access.html)
* [authorize-snapshot-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-snapshot-access.html)

<details>

<summary><strong>μ λ΅λ¶€ν„° μμ›…μ΄ λ  λ•κΉμ§€ AWS ν•΄ν‚Ήμ„ λ°°μ°μ„Έμ”</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksλ¥Ό μ§€μ›ν•λ” λ‹¤λ¥Έ λ°©λ²•:

* **νμ‚¬κ°€ HackTricksμ— κ΄‘κ³ λκΈΈ μ›ν•κ±°λ‚** **PDF ν•μ‹μ HackTricksλ¥Ό λ‹¤μ΄λ΅λ“**ν•λ ¤λ©΄ [**κµ¬λ… μ”κΈμ **](https://github.com/sponsors/carlospolop)λ¥Ό ν™•μΈν•μ„Έμ”!
* [**κ³µμ‹ PEASS & HackTricks μ¤μ™κ·Έ**](https://peass.creator-spring.com)λ¥Ό κµ¬λ§¤ν•μ„Έμ”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)λ¥Ό λ°κ²¬ν•μ„Έμ”, λ‹Ήμ‚¬μ λ…μ  [**NFTs**](https://opensea.io/collection/the-peass-family) μ»¬λ ‰μ…
* **π’¬ [**λ””μ¤μ½”λ“ κ·Έλ£Ή**](https://discord.gg/hRep4RUj7f)μ— κ°€μ…ν•κ±°λ‚ [**ν…”λ κ·Έλ¨ κ·Έλ£Ή**](https://t.me/peass)μ— κ°€μ…ν•κ±°λ‚** **νΈμ„ν„°** π¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**λ¥Ό ν”λ΅μ°ν•μ„Έμ”.**
* **HackTricks λ° HackTricks Cloud** github μ €μ¥μ†μ— PRμ„ μ μ¶ν•μ—¬ ν•΄ν‚Ή νΈλ¦­μ„ κ³µμ ν•μ„Έμ”.

</details>
