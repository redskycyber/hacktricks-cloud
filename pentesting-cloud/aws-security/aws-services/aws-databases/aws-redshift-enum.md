# AWS - Redshift Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklam vermek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki Ã¶zel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

## Amazon Redshift

Redshift, **bÃ¼yÃ¼k veri Ã§Ã¶zÃ¼mleri iÃ§in bir veri ambarÄ±** olarak kullanÄ±lan, boyutu bir petabaytÄ±n Ã¼zerine Ã¶lÃ§eklenebilen tamamen yÃ¶netilen bir hizmettir. Redshift kÃ¼meleme kullanarak, hÄ±zlÄ±, SQL tabanlÄ± sorgu araÃ§larÄ± ve iÅŸ zekasÄ± uygulamalarÄ± kullanarak veri kÃ¼meleriniz Ã¼zerinde analiz yapabilir ve iÅŸletmenizin vizyonunu daha iyi anlayabilirsiniz.

**Redshift, KMS veya CloudHSM kullanarak dÃ¶rt katmanlÄ± bir ÅŸifreleme anahtar hiyerarÅŸisi kullanarak dinlenme sÄ±rasÄ±nda ÅŸifreleme sunar**. **KÃ¼meniz iÃ§in ÅŸifreleme etkinleÅŸtirildiÄŸinde, devre dÄ±ÅŸÄ± bÄ±rakÄ±lamaz ve tam tersi**. ÅifrelenmemiÅŸ bir kÃ¼meniz olduÄŸunda, ÅŸifrelenemez.

KÃ¼meniz iÃ§in ÅŸifreleme yalnÄ±zca oluÅŸturulma sÄ±rasÄ±nda gerÃ§ekleÅŸebilir ve bir kez ÅŸifrelenmiÅŸse, veri, meta veri ve herhangi bir anlÄ±k gÃ¶rÃ¼ntÃ¼ de ÅŸifrelenir. Åifreleme anahtarlarÄ±nÄ±n katman dÃ¼zeyi aÅŸaÄŸÄ±daki gibidir, **birinci katman anahtar, ikinci katman kÃ¼me ÅŸifreleme anahtarÄ± (CEK), Ã¼Ã§Ã¼ncÃ¼ katman veritabanÄ± ÅŸifreleme anahtarÄ± (DEK) ve son olarak dÃ¶rdÃ¼ncÃ¼ katman veri ÅŸifreleme anahtarlarÄ±dÄ±r**.

### KMS

KÃ¼menizin oluÅŸturulmasÄ± sÄ±rasÄ±nda, Redshift iÃ§in **varsayÄ±lan KMS anahtarÄ±nÄ±** seÃ§ebilir veya **kendi CMK'nÄ±zÄ±** seÃ§ebilirsiniz, bu da anahtarÄ±n kontrolÃ¼ konusunda denetlenebilirlik aÃ§Ä±sÄ±ndan daha fazla esneklik saÄŸlar.

Redshift iÃ§in varsayÄ±lan KMS anahtarÄ±, anahtar seÃ§eneÄŸi ilk kez seÃ§ildiÄŸinde ve kullanÄ±ldÄ±ÄŸÄ±nda Redshift tarafÄ±ndan otomatik olarak oluÅŸturulur ve AWS tarafÄ±ndan tamamen yÃ¶netilir.

Bu KMS anahtarÄ± daha sonra CMK anahtarÄ±nÄ±n birinci katmanÄ±yla ÅŸifrelenir. Bu ÅŸifreli KMS veri anahtarÄ± daha sonra kÃ¼me ÅŸifreleme anahtarÄ± (CEK) olarak kullanÄ±lÄ±r. Bu CEK daha sonra KMS tarafÄ±ndan Redshift'e gÃ¶nderilir ve kÃ¼meden ayrÄ± olarak depolanÄ±r. Redshift daha sonra bu ÅŸifreli CEK'yi gÃ¼venli bir kanal Ã¼zerinden kÃ¼meye gÃ¶nderir ve bellekte depolar.

Redshift daha sonra KMS'ten CEK'yi Ã§Ã¶zmesini isteyerek, ikinci katman CEK'yi Ã§Ã¶zer. Bu Ã§Ã¶zÃ¼len CEK de bellekte depolanÄ±r. Redshift daha sonra rastgele bir veritabanÄ± ÅŸifreleme anahtarÄ± (DEK) oluÅŸturur ve bunu kÃ¼menin belleÄŸine yÃ¼kler. Bellekteki Ã§Ã¶zÃ¼len CEK, DEK'yi ÅŸifreler ve bu da bellekte depolanÄ±r.

Bu ÅŸifreli DEK daha sonra gÃ¼venli bir kanal Ã¼zerinden gÃ¶nderilir ve kÃ¼meden ayrÄ± olarak Redshift'te depolanÄ±r. Hem CEK hem de DEK artÄ±k kÃ¼menin belleÄŸinde hem ÅŸifreli hem de Ã§Ã¶zÃ¼lmÃ¼ÅŸ bir ÅŸekilde depolanÄ±r. Ã‡Ã¶zÃ¼len DEK, veritabanÄ±ndaki her veri bloÄŸu iÃ§in Redshift tarafÄ±ndan rastgele oluÅŸturulan veri anahtarlarÄ±nÄ± (dÃ¶rdÃ¼ncÃ¼ katman) ÅŸifrelemek iÃ§in kullanÄ±lÄ±r.

Amazon S3 kovalarÄ±nÄ±zÄ±n yapÄ±landÄ±rmasÄ±nÄ± izlemek ve kova gÃ¼nlÃ¼ÄŸÃ¼nÃ¼n etkinleÅŸtirildiÄŸinden emin olmak iÃ§in AWS Trusted Advisor'Ä± kullanabilirsiniz, bu da gÃ¼venlik denetimleri yapmak ve S3'teki kullanÄ±m desenlerini izlemek iÃ§in faydalÄ± olabilir.

### CloudHSM

<details>

<summary>CloudHSM ile Redshift KullanÄ±mÄ±</summary>

Åifreleme iÃ§in CloudHSM ile Ã§alÄ±ÅŸÄ±rken, Ã¶ncelikle HSM istemciniz ve Redshift arasÄ±nda gÃ¼venilir bir baÄŸlantÄ± kurmanÄ±z gerekmektedir ve bunun iÃ§in istemci ve sunucu sertifikalarÄ± kullanmanÄ±z gerekmektedir.

Bu baÄŸlantÄ±, ÅŸifreleme anahtarlarÄ±nÄ±n HSM istemciniz ve Redshift kÃ¼meniz arasÄ±nda gÃ¶nderilmesine izin veren gÃ¼venli iletiÅŸimi saÄŸlamak iÃ§in gereklidir. Rastgele oluÅŸturulan bir Ã¶zel ve genel anahtar Ã§ifti kullanarak, Redshift bir genel istemci sertifikasÄ± oluÅŸturur, bu sertifika ÅŸifrelenir ve Redshift tarafÄ±ndan depolanÄ±r. Bu sertifika indirilip HSM istemcinize kaydedilmeli ve doÄŸru HSM bÃ¶lÃ¼mÃ¼ne atanmalÄ±dÄ±r.

Daha sonra Redshift'i HSM istemcinizin aÅŸaÄŸÄ±daki ayrÄ±ntÄ±larÄ±yla yapÄ±landÄ±rmanÄ±z gerekmektedir: HSM IP adresi, HSM bÃ¶lÃ¼m adÄ±, HSM bÃ¶lÃ¼m parolasÄ± ve CloudHSM tarafÄ±ndan bir iÃ§ anahtar kullanÄ±larak ÅŸifrelenen genel HSM sunucu sertifikasÄ±. Bu bilgiler saÄŸlandÄ±ktan sonra, Redshift baÄŸlantÄ± kurup geliÅŸtirme bÃ¶lÃ¼mÃ¼ne eriÅŸebileceÄŸini onaylayacak ve doÄŸrulayacaktÄ±r.

Dahili gÃ¼venlik politikalarÄ±nÄ±z veya yÃ¶netiÅŸim kontrolleriniz, ÅŸifreleme anahtarlarÄ±nÄ± dÃ¶ndÃ¼rmeniz gerektiÄŸini belirtiyorsa, ÅŸifrelenmiÅŸ kÃ¼me iÃ§in ÅŸifreleme anahtarlarÄ±nÄ± dÃ¶ndÃ¼rmenize olanak tanÄ±r, ancak dikkate almanÄ±z gereken bir nokta, anahtar dÃ¶ndÃ¼rme sÃ¼recinde kÃ¼menin Ã§ok kÄ±sa bir sÃ¼re iÃ§in kullanÄ±lamaz hale geleceÄŸidir, bu nedenle anahtarlarÄ± sadece ihtiyaÃ§ duyduÄŸunuzda veya kompromize uÄŸramÄ±ÅŸ olabileceÄŸini dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼nÃ¼zde dÃ¶ndÃ¼rmek en iyisidir.

DÃ¶ndÃ¼rme sÄ±rasÄ±nda, Redshift kÃ¼meniz iÃ§in CEK'yi ve o kÃ¼menin yedeklerini dÃ¶ndÃ¼rÃ¼r. KÃ¼me iÃ§in bir DEK dÃ¶ndÃ¼rÃ¼r, ancak DEK kullanÄ±larak ÅŸifrelenen S3'de depolanan anlÄ±k gÃ¶rÃ¼ntÃ¼ler iÃ§in bir DEK dÃ¶ndÃ¼rmek mÃ¼mkÃ¼n deÄŸildir. KÃ¼menin durumu 'anahtar dÃ¶ndÃ¼rme' olarak ayarlanÄ±r ve iÅŸlem tamamlandÄ±ÄŸÄ±nda durum 'kullanÄ±labilir' olarak geri dÃ¶ner.

</details>

### SÄ±ralama
```bash
# Get clusters
aws redshift describe-clusters
## Get if publicly accessible
aws redshift describe-clusters | jq -r ".Clusters[].PubliclyAccessible"
## Get DB username to login
aws redshift describe-clusters | jq -r ".Clusters[].MasterUsername"
## Get endpoint
aws redshift describe-clusters | jq -r ".Clusters[].Endpoint"
## Public addresses of the nodes
aws redshift describe-clusters | jq -r ".Clusters[].ClusterNodes[].PublicIPAddress"
## Get IAM roles of the clusters
aws redshift describe-clusters | jq -r ".Clusters[].IamRoles"

# Endpoint access & authorization
aws redshift describe-endpoint-access
aws redshift describe-endpoint-authorization

# Get credentials
aws redshift get-cluster-credentials --db-user <username> --cluster-identifier <cluster-id>
## By default, the temporary credentials expire in 900 seconds. You can optionally specify a duration between 900 seconds (15 minutes) and 3600 seconds (60 minutes).
aws redshift get-cluster-credentials-with-iam --cluster-identifier <cluster-id>
## Gives creds to access redshift with the IAM redshift permissions given to the current AWS account
## More in https://docs.aws.amazon.com/redshift/latest/mgmt/redshift-iam-access-control-identity-based.html

# Authentication profiles
aws redshift describe-authentication-profiles

# Snapshots
aws redshift describe-cluster-snapshots

# Scheduled actions
aws redshift describe-scheduled-actions

# Connect
# The redshift instance must be publicly available (not by default), the sg need to allow inbounds connections to the port and you need creds
psql -h redshift-cluster-1.sdflju3jdfkfg.us-east-1.redshift.amazonaws.com -U admin -d dev -p 5439
```
## Privesc

{% content-ref url="../../aws-privilege-escalation/aws-redshift-privesc.md" %}
[aws-redshift-privesc.md](../../aws-privilege-escalation/aws-redshift-privesc.md)
{% endcontent-ref %}

## KalÄ±cÄ±lÄ±k

AÅŸaÄŸÄ±daki eylemler, kÃ¼melere diÄŸer AWS hesaplarÄ±na eriÅŸim izni vermek iÃ§in kullanÄ±lÄ±r:

* [authorize-endpoint-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-endpoint-access.html)
* [authorize-snapshot-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-snapshot-access.html)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
