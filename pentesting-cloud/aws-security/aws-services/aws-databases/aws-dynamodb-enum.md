# AWS - Enumerazione di DynamoDB

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## DynamoDB

### Informazioni di base

Amazon DynamoDB viene presentato da AWS come un **database NoSQL chiave-valore completamente gestito e serverless**, progettato per alimentare applicazioni ad alte prestazioni indipendentemente dalla loro dimensione. Il servizio garantisce funzionalit√† robuste, tra cui misure di sicurezza integrate, backup ininterrotti, replica automatica su pi√π regioni, caching integrato in memoria e utilit√† di esportazione dati comode.

Nel contesto di DynamoDB, invece di creare un database tradizionale, vengono creati **tabelle**. Ogni tabella richiede la specifica di una **chiave di partizione** come componente integrante della **chiave primaria della tabella**. Questa chiave di partizione, essenzialmente un **valore hash**, svolge un ruolo critico sia nel recupero degli elementi che nella distribuzione dei dati su vari host. Questa distribuzione √® fondamentale per mantenere sia la scalabilit√† che la disponibilit√† del database. Inoltre, √® possibile incorporare una **chiave di ordinamento** per ulteriori raffinamenti nell'organizzazione dei dati.

### Crittografia

Per impostazione predefinita, DynamoDB utilizza una chiave KMS che **appartiene ad Amazon DynamoDB**, non la chiave gestita da AWS che almeno appartiene al tuo account.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Backup ed esportazione su S3

√à possibile **programmare** la generazione di **backup delle tabelle** o crearli **su richiesta**. Inoltre, √® anche possibile abilitare **il ripristino a un determinato momento (PITR) per una tabella**. Il ripristino a un determinato momento fornisce **backup continui** dei dati di DynamoDB per **35 giorni** per aiutarti a proteggerti da operazioni di scrittura o cancellazione accidentali.

√à anche possibile esportare **i dati di una tabella su S3**, ma la tabella deve avere **PITR abilitato**.

### GUI

Esiste una GUI per i servizi DynamoDB locali come [DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/), [dynalite](https://github.com/mhart/dynalite), [localstack](https://github.com/localstack/localstack), ecc, che potrebbe essere utile: [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### Enumerazione
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
### Accesso non autenticato

{% content-ref url="../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### Persistenza

{% content-ref url="../../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## Iniezione di DynamoDB

### Iniezione SQL

Esistono modi per accedere ai dati di DynamoDB con **sintassi SQL**, quindi sono possibili anche **iniezioni SQL tipiche**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### Iniezione NoSQL

In DynamoDB √® possibile utilizzare diverse **condizioni** per recuperare dati, come in una comune iniezione NoSQL, se √® possibile **concatenare pi√π condizioni per recuperare** dati, √® possibile ottenere dati nascosti (o scaricare l'intera tabella).\
Puoi trovare qui le condizioni supportate da DynamoDB: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html)

Nota che **diverse condizioni** sono supportate se i dati vengono accessi tramite **`query`** o tramite **`scan`**.

{% hint style="info" %}
Attualmente, le azioni di **Query** devono specificare la condizione **"EQ" (uguale)** nella chiave **primaria** per funzionare, rendendo molto **meno suscettibili alle iniezioni NoSQL** (e rendendo anche l'operazione molto limitata).
{% endhint %}

Se puoi **modificare il confronto** eseguito o aggiungerne di nuovi, potresti recuperare pi√π dati.
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### Iniezione di Json grezzo

**DynamoDB** accetta oggetti **Json** per **ricercare** dati all'interno del DB. Se scopri che puoi scrivere nell'oggetto json inviato per la ricerca, potresti ottenere il dump del DB, con tutti i contenuti.

Ad esempio, iniettando in una richiesta come:

{% code overflow="wrap" %}
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

un attaccante potrebbe iniettare qualcosa del genere:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

correggere la condizione "EQ" cercando l'ID 1000 e quindi cercando tutti i dati con una stringa Id maggiore di 0, che √® tutto.

### Iniezione di propriet√†

Alcune SDK consentono di utilizzare una stringa che indica il filtro da eseguire come: 

{% code overflow="wrap" %}
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

√à necessario sapere che per cercare in DynamoDB per **sostituire** un **valore** di attributo nelle **espressioni di filtro** durante la scansione degli elementi, i token devono **iniziare** con il carattere **`:`**. Tali token verranno **sostituiti** con il **valore effettivo dell'attributo durante l'esecuzione**.

Pertanto, un accesso come quello precedente pu√≤ essere bypassato con qualcosa del genere:
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) su GitHub.

</details>
