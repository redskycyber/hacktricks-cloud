# AWS - Enumeraci贸n de DynamoDB

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop).
* Obt茅n [**productos oficiales de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>

## DynamoDB

### Informaci贸n b谩sica

Amazon DynamoDB es una **base de datos NoSQL de clave-valor completamente administrada y sin servidor** dise帽ada para ejecutar aplicaciones de alto rendimiento a cualquier escala. DynamoDB ofrece seguridad integrada, copias de seguridad continuas, replicaci贸n autom谩tica en varias regiones, almacenamiento en cach茅 en memoria y herramientas de exportaci贸n de datos.

En DynamoDB, no se crea una base de datos, sino que se **crea una tabla**. Cada tabla debe tener configurada una **clave de partici贸n** que forma parte de la **clave primaria de la tabla**. Es un **valor hash** que se utiliza para recuperar elementos de la tabla y asignar datos entre hosts para escalabilidad y disponibilidad. Tambi茅n es posible configurar una **clave de ordenaci贸n**.

### Encriptaci贸n

Por defecto, DynamoDB utiliza una clave KMS que **pertenece a Amazon DynamoDB**, no incluso la clave administrada por AWS que al menos pertenece a tu cuenta.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Copias de seguridad y exportaci贸n a S3

Es posible **programar** la generaci贸n de **copias de seguridad de tablas** o crearlas **bajo demanda**. Adem谩s, tambi茅n es posible habilitar la **recuperaci贸n en un momento dado (PITR) para una tabla**. La recuperaci贸n en un momento dado proporciona copias de seguridad continuas de los datos de DynamoDB durante **35 d铆as** para ayudarte a protegerte contra operaciones de escritura o eliminaci贸n accidentales.

Tambi茅n es posible exportar **los datos de una tabla a S3**, pero la tabla debe tener **PITR habilitado**.

### GUI

Hay una interfaz gr谩fica de usuario para servicios DynamoDB locales como [DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/), [dynalite](https://github.com/mhart/dynalite), [localstack](https://github.com/localstack/localstack), etc., que podr铆a ser 煤til: [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### Enumeraci贸n
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
## Enumeraci贸n de DynamoDB

### Acceso no autenticado

{% content-ref url="../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### Escalada de privilegios

{% content-ref url="../../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### Post Explotaci贸n

{% content-ref url="../../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## Inyecci贸n en DynamoDB

### Inyecci贸n SQL

Existen formas de acceder a los datos de DynamoDB con **sintaxis SQL**, por lo tanto, tambi茅n son posibles las **inyecciones SQL t铆picas**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### Inyecci贸n NoSQL

En DynamoDB se pueden utilizar diferentes **condiciones** para recuperar datos, al igual que en una inyecci贸n NoSQL com煤n, si es posible **encadenar m谩s condiciones para recuperar** datos, se podr铆an obtener datos ocultos (o volcar toda la tabla).\
Aqu铆 puedes encontrar las condiciones admitidas por DynamoDB: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html)

Ten en cuenta que se admiten **diferentes condiciones** si los datos se est谩n accediendo a trav茅s de **`query`** o a trav茅s de **`scan`**.

{% hint style="info" %}
En realidad, las acciones de **Consulta** deben especificar la condici贸n **"EQ" (equals)** en la clave **primaria** para funcionar, lo que hace que sea mucho **menos propenso a las inyecciones NoSQL** (y tambi茅n limita mucho la operaci贸n).
{% endhint %}

Si puedes **cambiar la comparaci贸n** realizada o agregar nuevas, podr铆as recuperar m谩s datos.
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### Inyecci贸n de Json sin procesar

**DynamoDB** acepta objetos **Json** para **buscar** datos dentro de la base de datos. Si descubres que puedes escribir en el objeto json enviado para buscar, podr铆as hacer que la base de datos volcara todo su contenido.

Por ejemplo, inyectando en una solicitud como esta:

{% code overflow="wrap" %}
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

un atacante podr铆a inyectar algo como:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

corregir la condici贸n "EQ" buscando el ID 1000 y luego buscar todos los datos con una cadena de ID mayor a 0, que es todo.

### Inyecci贸n de :propiedad

Algunos SDK permiten usar una cadena que indica el filtrado a realizar como:
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

Debes saber que al buscar en DynamoDB para **sustituir** un valor de atributo en las **expresiones de filtro** mientras se escanean los elementos, los tokens deben **comenzar** con el car谩cter **`:`**. Estos tokens ser谩n **reemplazados** por el valor de atributo real en tiempo de ejecuci贸n.

Por lo tanto, un inicio de sesi贸n como el anterior puede ser evitado con algo como:
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop).
* Obt茅n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com).
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family).
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s铆gueme en** **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>
