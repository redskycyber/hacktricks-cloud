# AWS - å…³ç³»å‹æ•°æ®åº“ (RDS) æšä¸¾

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œé€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## åŸºæœ¬ä¿¡æ¯

AWSæä¾›çš„**å…³ç³»å‹æ•°æ®åº“æœåŠ¡ (RDS)** æ—¨åœ¨ç®€åŒ–**äº‘ä¸­å…³ç³»å‹æ•°æ®åº“**çš„éƒ¨ç½²ã€æ“ä½œå’Œæ‰©å±•ã€‚è¯¥æœåŠ¡æä¾›æˆæœ¬æ•ˆç›Šå’Œå¯æ‰©å±•æ€§çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶è‡ªåŠ¨åŒ–äº†ç¡¬ä»¶é…ç½®ã€æ•°æ®åº“é…ç½®ã€è¡¥ä¸å’Œå¤‡ä»½ç­‰åŠ³åŠ¨å¯†é›†å‹ä»»åŠ¡ã€‚

AWS RDSæ”¯æŒå¤šç§å¹¿æ³›ä½¿ç”¨çš„å…³ç³»å‹æ•°æ®åº“å¼•æ“ï¼ŒåŒ…æ‹¬MySQLã€PostgreSQLã€MariaDBã€Oracleæ•°æ®åº“ã€Microsoft SQL Serverå’ŒAmazon Auroraï¼Œå…¼å®¹MySQLå’ŒPostgreSQLã€‚

RDSçš„å…³é”®ç‰¹æ€§åŒ…æ‹¬ï¼š

- **æ•°æ®åº“å®ä¾‹ç®¡ç†**ç®€åŒ–äº†ã€‚
- åˆ›å»º**è¯»å‰¯æœ¬**ä»¥æé«˜è¯»å–æ€§èƒ½ã€‚
- é…ç½®**å¤šå¯ç”¨åŒº (AZ) éƒ¨ç½²**ä»¥ç¡®ä¿é«˜å¯ç”¨æ€§å’Œæ•…éšœè½¬ç§»æœºåˆ¶ã€‚
- ä¸å…¶ä»–AWSæœåŠ¡çš„**é›†æˆ**ï¼Œä¾‹å¦‚ï¼š
- AWSèº«ä»½å’Œè®¿é—®ç®¡ç† (**IAM**) æä¾›å¼ºå¤§çš„è®¿é—®æ§åˆ¶ã€‚
- AWS **CloudWatch** æä¾›å…¨é¢çš„ç›‘æ§å’ŒæŒ‡æ ‡ã€‚
- AWSå¯†é’¥ç®¡ç†æœåŠ¡ (**KMS**) ç¡®ä¿é™æ€æ•°æ®åŠ å¯†ã€‚


## å‡­è¯

åˆ›å»ºDBé›†ç¾¤æ—¶ï¼Œå¯ä»¥é…ç½®ä¸»**ç”¨æˆ·å**ï¼ˆé»˜è®¤ä¸º**`admin`**ï¼‰ã€‚è¦ç”Ÿæˆæ­¤ç”¨æˆ·çš„å¯†ç ï¼Œæ‚¨å¯ä»¥ï¼š

* **æŒ‡å®š**ä¸€ä¸ª**å¯†ç **
* å‘Šè¯‰RDS **è‡ªåŠ¨ç”Ÿæˆ**å®ƒ
* å‘Šè¯‰RDSåœ¨**AWS Secret Manager**ä¸­ç®¡ç†å®ƒï¼Œå¹¶ä½¿ç”¨KMSå¯†é’¥åŠ å¯†

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### è®¤è¯

æœ‰3ç§è®¤è¯é€‰é¡¹ï¼Œä½†å§‹ç»ˆå…è®¸ä½¿ç”¨**ä¸»å¯†ç **ï¼š

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### å…¬å…±è®¿é—® & VPC

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®åº“**ä¸å…è®¸å…¬å…±è®¿é—®**ï¼Œä½†**å¯ä»¥æˆäºˆ**ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœé€‰å®šçš„**å®‰å…¨ç»„**ï¼ˆå­˜å‚¨åœ¨EC2 SGä¸­ï¼‰å…è®¸ï¼Œåªæœ‰æ¥è‡ªåŒä¸€VPCçš„æœºå™¨æ‰èƒ½è®¿é—®å®ƒã€‚

å¯ä»¥åˆ›å»ºä¸€ä¸ª**RDSä»£ç†**ï¼Œè€Œä¸æ˜¯æš´éœ²DBå®ä¾‹ï¼Œè¿™å¯ä»¥**æé«˜**æ•°æ®åº“é›†ç¾¤çš„**å¯æ‰©å±•æ€§**å’Œ**å¯ç”¨æ€§**ã€‚

æ­¤å¤–ï¼Œ**æ•°æ®åº“ç«¯å£ä¹Ÿå¯ä»¥ä¿®æ”¹**ã€‚

### åŠ å¯†

**é»˜è®¤å¯ç”¨åŠ å¯†**ï¼Œä½¿ç”¨AWSç®¡ç†çš„å¯†é’¥ï¼ˆä¹Ÿå¯ä»¥é€‰æ‹©CMKï¼‰ã€‚

å¯ç”¨åŠ å¯†æ„å‘³ç€æ‚¨ä¸ºå­˜å‚¨ã€å¿«ç…§ã€è¯»å‰¯æœ¬å’Œå¤‡ä»½å¯ç”¨äº†**é™æ€æ•°æ®åŠ å¯†**ã€‚å¯ä»¥ä½¿ç”¨**KMS**å‘è¡Œç®¡ç†æ­¤åŠ å¯†çš„å¯†é’¥ã€‚\
åœ¨æ•°æ®åº“åˆ›å»ºåï¼Œæ— æ³•æ·»åŠ æ­¤çº§åˆ«çš„åŠ å¯†ã€‚**å¿…é¡»åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­å®Œæˆ**ã€‚

ç„¶è€Œï¼Œæœ‰ä¸€ä¸ª**è§£å†³æ–¹æ³•å…è®¸æ‚¨åŠ å¯†æœªåŠ å¯†çš„æ•°æ®åº“ï¼Œå¦‚ä¸‹æ‰€ç¤º**ã€‚æ‚¨å¯ä»¥åˆ›å»ºæœªåŠ å¯†æ•°æ®åº“çš„å¿«ç…§ï¼Œåˆ›å»ºè¯¥å¿«ç…§çš„åŠ å¯†å‰¯æœ¬ï¼Œä½¿ç”¨è¯¥åŠ å¯†å¿«ç…§åˆ›å»ºæ–°æ•°æ®åº“ï¼Œç„¶åï¼Œæœ€ç»ˆï¼Œæ‚¨çš„æ•°æ®åº“å°†è¢«åŠ å¯†ã€‚

#### é€æ˜æ•°æ®åŠ å¯† (TDE)

é™¤äº†RDSåœ¨åº”ç”¨ç¨‹åºçº§åˆ«å›ºæœ‰çš„åŠ å¯†èƒ½åŠ›å¤–ï¼ŒRDSè¿˜æ”¯æŒ**é¢å¤–çš„å¹³å°çº§åŠ å¯†æœºåˆ¶**æ¥ä¿æŠ¤é™æ€æ•°æ®ã€‚è¿™åŒ…æ‹¬Oracleå’ŒSQL Serverçš„**é€æ˜æ•°æ®åŠ å¯† (TDE)**ã€‚ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶TDEé€šè¿‡åŠ å¯†é™æ€æ•°æ®æ¥å¢å¼ºå®‰å…¨æ€§ï¼Œä½†å®ƒä¹Ÿå¯èƒ½**å½±å“æ•°æ®åº“æ€§èƒ½**ã€‚å½“ä¸MySQLåŠ å¯†å‡½æ•°æˆ–Microsoft Transact-SQLåŠ å¯†å‡½æ•°ç»“åˆä½¿ç”¨æ—¶ï¼Œå°¤å…¶ä¼šæ³¨æ„åˆ°è¿™ç§æ€§èƒ½å½±å“ã€‚

è¦ä½¿ç”¨TDEï¼Œéœ€è¦ä¸€äº›åˆæ­¥æ­¥éª¤ï¼š

1. **é€‰é¡¹ç»„å…³è”**ï¼š
- æ•°æ®åº“å¿…é¡»ä¸ä¸€ä¸ªé€‰é¡¹ç»„å…³è”ã€‚é€‰é¡¹ç»„ä½œä¸ºè®¾ç½®å’ŒåŠŸèƒ½çš„å®¹å™¨ï¼Œä¾¿äºæ•°æ®åº“ç®¡ç†ï¼ŒåŒ…æ‹¬å®‰å…¨å¢å¼ºã€‚
- ç„¶è€Œï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œé€‰é¡¹ç»„åªé€‚ç”¨äºç‰¹å®šçš„æ•°æ®åº“å¼•æ“å’Œç‰ˆæœ¬ã€‚

2. **åœ¨é€‰é¡¹ç»„ä¸­åŒ…å«TDE**ï¼š
- ä¸€æ—¦ä¸é€‰é¡¹ç»„å…³è”ï¼Œå°±éœ€è¦åœ¨è¯¥ç»„ä¸­åŒ…å«Oracleé€æ˜æ•°æ®åŠ å¯†é€‰é¡¹ã€‚
- éœ€è¦è®¤è¯†åˆ°çš„æ˜¯ï¼Œä¸€æ—¦å°†TDEé€‰é¡¹æ·»åŠ åˆ°é€‰é¡¹ç»„ä¸­ï¼Œå®ƒå°±æˆä¸ºæ°¸ä¹…æ€§çš„ï¼Œä¸èƒ½è¢«ç§»é™¤ã€‚

3. **TDEåŠ å¯†æ¨¡å¼**ï¼š
- TDEæä¾›ä¸¤ç§ä¸åŒçš„åŠ å¯†æ¨¡å¼ï¼š
- **TDEè¡¨ç©ºé—´åŠ å¯†**ï¼šæ­¤æ¨¡å¼åŠ å¯†æ•´ä¸ªè¡¨ï¼Œæä¾›æ›´å¹¿æ³›çš„æ•°æ®ä¿æŠ¤èŒƒå›´ã€‚
- **TDEåˆ—åŠ å¯†**ï¼šæ­¤æ¨¡å¼ä¸“æ³¨äºåŠ å¯†æ•°æ®åº“ä¸­çš„ç‰¹å®šä¸ªåˆ«å…ƒç´ ï¼Œå…è®¸å¯¹åŠ å¯†æ•°æ®è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚

ç†è§£è¿™äº›å…ˆå†³æ¡ä»¶å’ŒTDEçš„æ“ä½œç»†èŠ‚å¯¹äºæœ‰æ•ˆå®æ–½å’Œç®¡ç†RDSä¸­çš„åŠ å¯†è‡³å…³é‡è¦ï¼Œç¡®ä¿æ•°æ®å®‰å…¨å¹¶ç¬¦åˆå¿…è¦çš„æ ‡å‡†ã€‚

### æšä¸¾

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### æœªç»è®¤è¯çš„è®¿é—®

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### æƒé™æå‡

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### åæœŸåˆ©ç”¨

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### æŒä¹…åŒ–

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL æ³¨å…¥

å­˜åœ¨ä½¿ç”¨ **SQL è¯­æ³•** è®¿é—® DynamoDB æ•°æ®çš„æ–¹æ³•ï¼Œå› æ­¤ï¼Œå…¸å‹çš„ **SQL æ³¨å…¥ä¹Ÿæ˜¯å¯èƒ½çš„**ã€‚

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½ HackTricks çš„ PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)ç³»åˆ—
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
