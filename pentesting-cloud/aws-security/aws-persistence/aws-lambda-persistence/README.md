# AWS - TrwaÅ‚oÅ›Ä‡ funkcji Lambda

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Lambda

Aby uzyskaÄ‡ wiÄ™cej informacji, sprawdÅº:

{% content-ref url="../../../aws-security/aws-services/aws-lambda-enum.md" %}
[aws-lambda-enum.md](../../../aws-security/aws-services/aws-lambda-enum.md)
{% endcontent-ref %}

### TrwaÅ‚oÅ›Ä‡ warstwy Lambda

MoÅ¼liwe jest **wprowadzenie/podstawienie warstwy do wykonania dowolnego kodu**, gdy funkcja Lambda jest wykonywana w sposÃ³b skryty:

{% content-ref url="aws-lambda-layers-persistence.md" %}
[aws-lambda-layers-persistence.md](aws-lambda-layers-persistence.md)
{% endcontent-ref %}

### TrwaÅ‚oÅ›Ä‡ rozszerzenia Lambda

WykorzystujÄ…c warstwy Lambda, moÅ¼liwe jest rÃ³wnieÅ¼ naduÅ¼ycie rozszerzeÅ„ i trwaÅ‚oÅ›Ä‡ w funkcji Lambda, ale takÅ¼e kradzieÅ¼ i modyfikacja Å¼Ä…daÅ„.

{% content-ref url="aws-abusing-lambda-extensions.md" %}
[aws-abusing-lambda-extensions.md](aws-abusing-lambda-extensions.md)
{% endcontent-ref %}

### Za pomocÄ… polityk zasobÃ³w

MoÅ¼liwe jest udzielenie dostÄ™pu do rÃ³Å¼nych dziaÅ‚aÅ„ funkcji Lambda (takich jak wywoÅ‚anie lub aktualizacja kodu) zewnÄ™trznym kontom:

<figure><img src="../../../../.gitbook/assets/image (2) (1) (2) (2).png" alt=""><figcaption></figcaption></figure>

### Wersje, aliasy i wagi

Funkcja Lambda moÅ¼e mieÄ‡ **rÃ³Å¼ne wersje** (z rÃ³Å¼nym kodem dla kaÅ¼dej wersji).\
NastÄ™pnie moÅ¼na utworzyÄ‡ **rÃ³Å¼ne aliasy z rÃ³Å¼nymi wersjami** funkcji Lambda i przypisaÄ‡ im rÃ³Å¼ne wagi.\
W ten sposÃ³b atakujÄ…cy moÅ¼e utworzyÄ‡ **wersjÄ™ 1 z podstawkÄ…** i **wersjÄ™ 2 tylko z legalnym kodem** oraz **wykonywaÄ‡ tylko wersjÄ™ 1 w 1%** Å¼Ä…daÅ„, aby pozostaÄ‡ skrytym.

<figure><img src="../../../../.gitbook/assets/image (2) (2).png" alt=""><figcaption></figcaption></figure>

### Wersja podstawki + Bramka API

1. Skopiuj oryginalny kod funkcji Lambda.
2. **UtwÃ³rz nowÄ… wersjÄ™ z podstawkÄ…** oryginalnego kodu (lub tylko z zÅ‚oÅ›liwym kodem). Opublikuj i **wdroÅ¼ tÄ™ wersjÄ™** do $LATEST.
1. WywoÅ‚aj powiÄ…zanÄ… z funkcjÄ… Lambda bramkÄ™ API, aby wykonaÄ‡ kod.
3. **UtwÃ³rz nowÄ… wersjÄ™ z oryginalnym kodem**, opublikuj i wdroÅ¼ tÄ™ **wersjÄ™** do $LATEST.
1. Spowoduje to ukrycie podstawkowanego kodu w poprzedniej wersji.
4. PrzejdÅº do Bramki API i **utwÃ³rz nowÄ… metodÄ™ POST** (lub wybierz innÄ… metodÄ™), ktÃ³ra wykona podstawkowanÄ… wersjÄ™ funkcji Lambda: `arn:aws:lambda:us-east-1:<acc_id>:function:<func_name>:1`
1. ZauwaÅ¼ koÅ„cowe :1 w arn, **wskazujÄ…ce wersjÄ™ funkcji** (w tym scenariuszu wersja 1 bÄ™dzie podstawkowanÄ… wersjÄ…).
5. Wybierz utworzonÄ… metodÄ™ POST i w Akcjach wybierz **`WdroÅ¼ API`**
6. Teraz, gdy **wywoÅ‚asz funkcjÄ™ za pomocÄ… POST, Twoja podstawa** zostanie wywoÅ‚ana

### Aktuator Cron/Event

MoÅ¼liwoÅ›Ä‡ uruchamiania **funkcji Lambda, gdy coÅ› siÄ™ dzieje lub gdy upÅ‚ynie pewien czas**, sprawia, Å¼e Lambda jest dobrym i powszechnym sposobem uzyskania trwaÅ‚oÅ›ci i unikniÄ™cia wykrycia.\
Oto kilka pomysÅ‚Ã³w, jak uczyniÄ‡ swojÄ… **obecnoÅ›Ä‡ w AWS bardziej skrytÄ…, tworzÄ…c lambdy**.

* Za kaÅ¼dym razem, gdy tworzony jest nowy uÅ¼ytkownik, lambda generuje nowy klucz uÅ¼ytkownika i wysyÅ‚a go do atakujÄ…cego.
* Za kaÅ¼dym razem, gdy tworzona jest nowa rola, lambda nadaje uprawnienia do przyjmowania roli skompromitowanym uÅ¼ytkownikom.
* Za kaÅ¼dym razem, gdy generowane sÄ… nowe dzienniki cloudtrail, usuÅ„/zmieÅ„ je.

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
