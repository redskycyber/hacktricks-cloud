# AWS - ÎœÏŒÎ½Î¹Î¼Î· Î‘Î½Î¸ÎµÎºÏ„Î¹ÎºÏŒÏ„Î·Ï„Î± STS

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï‡Î¬ÎºÎ¹Î½Î³Îº AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Î•Î¹Î´Î¹ÎºÏŒÏ‚ Red Team Ï„Î¿Ï… HackTricks AWS)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î´Î¹Î±Ï†Î·Î¼Î¹ÏƒÎ¼Î­Î½Î· ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ** ÏƒÏ„Î·Î½ ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± Ï„Î·Î»ÎµÎ³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs** ÏƒÏ„Î± [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>

## STS

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î±Î½Î±Ï„ÏÎ­Î¾Ï„Îµ:

{% content-ref url="../aws-services/aws-sts-enum.md" %}
[aws-sts-enum.md](../aws-services/aws-sts-enum.md)
{% endcontent-ref %}

### Î ÏÎ¿ÏƒÏ‰ÏÎ¹Î½ÏŒ Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ ÏÏŒÎ»Î¿Ï…

Î¤Î± Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬ Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÎ¬ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ·Î¸Î¿ÏÎ½, Î¿Ï€ÏŒÏ„Îµ Î· Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· ÎµÎ½ÏŒÏ‚ ÎµÎ½ÎµÏÎ³Î¿Ï Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¿Ï Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÎ¿Ï ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Î¼ÏŒÎ½Î¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚.

<pre class="language-bash"><code class="lang-bash">aws sts get-session-token --duration-seconds 129600

# ÎœÎµ MFA
aws sts get-session-token \
--serial-number &#x3C;mfa-device-name> \
--token-code &#x3C;code-from-token>

# Î¤Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ ÏƒÏ…ÏƒÎºÎµÏ…Î®Ï‚ Ï…Î»Î¹ÎºÎ¿Ï ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î¿ Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ Î±Ï€ÏŒ Ï„Î¿ Ï€Î¯ÏƒÏ‰ Î¼Î­ÏÎ¿Ï‚ Ï„Î·Ï‚ ÏƒÏ…ÏƒÎºÎµÏ…Î®Ï‚, ÏŒÏ€Ï‰Ï‚ GAHT12345678
<strong># Î¤Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ ÏƒÏ…ÏƒÎºÎµÏ…Î®Ï‚ SMS ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ARN ÏƒÏ„Î¿ AWS, ÏŒÏ€Ï‰Ï‚ arn:aws:iam::123456789012:sms-mfa/username
</strong># Î¤Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î·Ï‚ ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ®Ï‚ ÏƒÏ…ÏƒÎºÎµÏ…Î®Ï‚ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ARN ÏƒÏ„Î¿ AWS, ÏŒÏ€Ï‰Ï‚ arn:aws:iam::123456789012:mfa/username
</code></pre>

### Î‘Î»Ï…ÏƒÎ¯Î´Î± Î¡ÏŒÎ»Ï‰Î½ Juggling

[**Î— Î±Î»Ï…ÏƒÎ¯Î´Î± ÏÏŒÎ»Ï‰Î½ ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÎ¼Î­Î½Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… AWS**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_terms-and-concepts.html#Role%20chaining), ÏƒÏ…Ï‡Î½Î¬ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Î¼Ï…ÏƒÏ„Î¹ÎºÎ®Ï‚ Î¼ÏŒÎ½Î¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚. Î ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± **Î½Î± Ï…Ï€Î¿Î¸Î­ÏƒÎµÏ„Îµ Î­Î½Î± ÏÏŒÎ»Î¿ Ï€Î¿Ï… ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï…Ï€Î¿Î¸Î­Ï„ÎµÎ¹ Î­Î½Î±Î½ Î¬Î»Î»Î¿**, Ï€Î¹Î¸Î±Î½ÏÏ‚ ÎµÏ€Î±Î½Î­ÏÏ‡Î¿Î½Ï„Î±Ï‚ ÏƒÏ„Î¿Î½ Î±ÏÏ‡Î¹ÎºÏŒ ÏÏŒÎ»Î¿ Î¼Îµ **ÎºÏ…ÎºÎ»Î¹ÎºÏŒ Ï„ÏÏŒÏ€Î¿**. ÎšÎ¬Î¸Îµ Ï†Î¿ÏÎ¬ Ï€Î¿Ï… Ï…Ï€Î¿Î¸Î­Ï„ÎµÏ„Î±Î¹ Î­Î½Î±Ï‚ ÏÏŒÎ»Î¿Ï‚, Ï„Î¿ Ï€ÎµÎ´Î¯Î¿ Î»Î®Î¾Î·Ï‚ Ï„Ï‰Î½ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏÏƒÎµÏ‰Î½ Î±Î½Î±Î½ÎµÏÎ½ÎµÏ„Î±Î¹. Î£Ï…Î½ÎµÏ€ÏÏ‚, Î±Î½ Î´ÏÎ¿ ÏÏŒÎ»Î¿Î¹ ÏÏ…Î¸Î¼Î¹ÏƒÏ„Î¿ÏÎ½ Î½Î± Ï…Ï€Î¿Î¸Î­Ï„Î¿Ï…Î½ Î±Î¼Î¿Î¹Î²Î±Î¯Î± Î¿ Î­Î½Î±Ï‚ Ï„Î¿Î½ Î¬Î»Î»Î¿, Î±Ï…Ï„Î® Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Î´Î¹Î±ÏÎºÎ® Î±Î½Î±Î½Î­Ï‰ÏƒÎ· Ï„Ï‰Î½ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏÏƒÎµÏ‰Î½.

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ [**ÎµÏÎ³Î±Î»ÎµÎ¯Î¿**](https://github.com/hotnops/AWSRoleJuggler/) Î³Î¹Î± Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÏ„Îµ Ï„Î·Î½ Î±Î»Ï…ÏƒÎ¯Î´Î± ÏÏŒÎ»Ï‰Î½:
```bash
./aws_role_juggler.py -h
usage: aws_role_juggler.py [-h] [-r ROLE_LIST [ROLE_LIST ...]]

optional arguments:
-h, --help            show this help message and exit
-r ROLE_LIST [ROLE_LIST ...], --role-list ROLE_LIST [ROLE_LIST ...]
```
<details>

<summary>ÎšÏÎ´Î¹ÎºÎ±Ï‚ Î³Î¹Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Role Juggling Î±Ï€ÏŒ Ï„Î¿ PowerShell</summary>
```powershell
# PowerShell script to check for role juggling possibilities using AWS CLI

# Check for AWS CLI installation
if (-not (Get-Command "aws" -ErrorAction SilentlyContinue)) {
Write-Error "AWS CLI is not installed. Please install it and configure it with 'aws configure'."
exit
}

# Function to list IAM roles
function List-IAMRoles {
aws iam list-roles --query "Roles[*].{RoleName:RoleName, Arn:Arn}" --output json
}

# Initialize error count
$errorCount = 0

# List all roles
$roles = List-IAMRoles | ConvertFrom-Json

# Attempt to assume each role
foreach ($role in $roles) {
$sessionName = "RoleJugglingTest-" + (Get-Date -Format FileDateTime)
try {
$credentials = aws sts assume-role --role-arn $role.Arn --role-session-name $sessionName --query "Credentials" --output json 2>$null | ConvertFrom-Json
if ($credentials) {
Write-Host "Successfully assumed role: $($role.RoleName)"
Write-Host "Access Key: $($credentials.AccessKeyId)"
Write-Host "Secret Access Key: $($credentials.SecretAccessKey)"
Write-Host "Session Token: $($credentials.SessionToken)"
Write-Host "Expiration: $($credentials.Expiration)"

# Set temporary credentials to assume the next role
$env:AWS_ACCESS_KEY_ID = $credentials.AccessKeyId
$env:AWS_SECRET_ACCESS_KEY = $credentials.SecretAccessKey
$env:AWS_SESSION_TOKEN = $credentials.SessionToken

# Try to assume another role using the temporary credentials
foreach ($nextRole in $roles) {
if ($nextRole.Arn -ne $role.Arn) {
$nextSessionName = "RoleJugglingTest-" + (Get-Date -Format FileDateTime)
try {
$nextCredentials = aws sts assume-role --role-arn $nextRole.Arn --role-session-name $nextSessionName --query "Credentials" --output json 2>$null | ConvertFrom-Json
if ($nextCredentials) {
Write-Host "Also successfully assumed role: $($nextRole.RoleName) from $($role.RoleName)"
Write-Host "Access Key: $($nextCredentials.AccessKeyId)"
Write-Host "Secret Access Key: $($nextCredentials.SecretAccessKey)"
Write-Host "Session Token: $($nextCredentials.SessionToken)"
Write-Host "Expiration: $($nextCredentials.Expiration)"
}
} catch {
$errorCount++
}
}
}

# Reset environment variables
Remove-Item Env:\AWS_ACCESS_KEY_ID
Remove-Item Env:\AWS_SECRET_ACCESS_KEY
Remove-Item Env:\AWS_SESSION_TOKEN
} else {
$errorCount++
}
} catch {
$errorCount++
}
}

# Output the number of errors if any
if ($errorCount -gt 0) {
Write-Host "$errorCount error(s) occurred during role assumption attempts."
} else {
Write-Host "No errors occurred. All roles checked successfully."
}

Write-Host "Role juggling check complete."
```
</details>

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î­Ï‰Ï‚ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î´Î¹Î±Ï†Î·Î¼Î¹ÏƒÎ¼Î­Î½Î· ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± ÏƒÏ„Î¿ GitHub.

</details>
