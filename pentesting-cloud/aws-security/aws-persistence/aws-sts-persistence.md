# AWS - STS æ°¸ç¶šæ€§

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ã§ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã™ã‚‹ã€‚

</details>

## STS

è©³ç´°ã¯ä»¥ä¸‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„:

{% content-ref url="../aws-services/aws-sts-enum.md" %}
[aws-sts-enum.md](../aws-services/aws-sts-enum.md)
{% endcontent-ref %}

### Assume role token

ä¸€æ™‚çš„ãªãƒˆãƒ¼ã‚¯ãƒ³ã¯ãƒªã‚¹ãƒˆã•ã‚Œãªã„ãŸã‚ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªä¸€æ™‚çš„ãªãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã¯ã€æ°¸ç¶šæ€§ã‚’ä¿ã¤æ–¹æ³•ã§ã™ã€‚

<pre class="language-bash"><code class="lang-bash">aws sts get-session-token --duration-seconds 129600

# MFAã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
aws sts get-session-token \
--serial-number &#x3C;mfa-device-name> \
--token-code &#x3C;code-from-token>

# ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ‡ãƒã‚¤ã‚¹åã¯é€šå¸¸ã€ãƒ‡ãƒã‚¤ã‚¹ã®èƒŒé¢ã«ã‚ã‚‹ç•ªå·ã§ã™ã€‚ä¾‹ï¼šGAHT12345678
<strong># SMSãƒ‡ãƒã‚¤ã‚¹åã¯AWSã®ARNã§ã™ã€‚ä¾‹ï¼šarn:aws:iam::123456789012:sms-mfa/username
</strong># ä»®æƒ³ãƒ‡ãƒã‚¤ã‚¹åã¯AWSã®ARNã§ã™ã€‚ä¾‹ï¼šarn:aws:iam::123456789012:mfa/username
</code></pre>

### Role Chain Juggling

[**ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_terms-and-concepts.html#Role%20chaining)ã¯ã€ã‚¹ãƒ†ãƒ«ã‚¹æ°¸ç¶šæ€§ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«å½¹ç«‹ã¤AWSã®èªè­˜ã•ã‚ŒãŸæ©Ÿèƒ½ã§ã™ã€‚\
ã‚ãªãŸã¯**ä¸€ã¤ã®ãƒ­ãƒ¼ãƒ«ã‚’ä»®å®šã—ã¦ã€åˆ¥ã®ãƒ­ãƒ¼ãƒ«ã‚’ä»®å®šã—ã¦ã€æœ€åˆã®ãƒ­ãƒ¼ãƒ«ã‚’ï¼ˆç„¡é™ã«ï¼‰ä»®å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™**ã€‚&#x20;

ãƒ­ãƒ¼ãƒ«ãŒä»®å®šã•ã‚Œã‚‹ã¨ã€**è³‡æ ¼æƒ…å ±ã®æœ‰åŠ¹æœŸé™ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ›´æ–°ã•ã‚Œã¾ã™**ã€‚ã—ãŸãŒã£ã¦ã€**2ã¤ã®ãƒ­ãƒ¼ãƒ«ãŒãŠäº’ã„ã‚’ä»®å®šã§ãã‚‹**å ´åˆã€æ–°ã—ã„è³‡æ ¼æƒ…å ±ã‚’ç¶™ç¶šçš„ã«å–å¾—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã“ã®[**ãƒ„ãƒ¼ãƒ«**](https://github.com/hotnops/AWSRoleJuggler/)ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¸ãƒ£ã‚°ãƒªãƒ³ã‚°ã‚’ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
./aws_role_juggler.py -h
usage: aws_role_juggler.py [-h] [-r ROLE_LIST [ROLE_LIST ...]]

optional arguments:
-h, --help            show this help message and exit
-r ROLE_LIST [ROLE_LIST ...], --role-list ROLE_LIST [ROLE_LIST ...]
```
<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã™ã‚‹ã€‚

</details>
