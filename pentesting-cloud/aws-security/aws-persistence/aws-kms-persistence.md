# AWS - KMS Persistence

<details>

<summary><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”!</summary>

ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë°©ë²•:

- **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜** **HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
- [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
- **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
- **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## KMS

ìì„¸í•œ ì •ë³´ëŠ” í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../../aws-security/aws-services/aws-kms-enum.md" %}
[aws-kms-enum.md](../../aws-security/aws-services/aws-kms-enum.md)
{% endcontent-ref %}

### KMS ì •ì±…ì„ í†µí•œ ì•¡ì„¸ìŠ¤ ë¶€ì—¬

ê³µê²©ìëŠ” **`kms:PutKeyPolicy`** ê¶Œí•œì„ ì‚¬ìš©í•˜ì—¬ ìì‹ ì´ ì œì–´í•˜ëŠ” ì‚¬ìš©ìì—ê²Œ ë˜ëŠ” ì™¸ë¶€ ê³„ì •ì— ëŒ€í•œ í‚¤ ì•¡ì„¸ìŠ¤ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [**KMS Privesc í˜ì´ì§€**](../../aws-security/aws-privilege-escalation/aws-kms-privesc.md)ë¥¼ í™•ì¸í•˜ì„¸ìš”.

### ì˜êµ¬ì ì¸ ë¶€ì—¬

ë¶€ì—¬ëŠ” ì£¼ì²´ì—ê²Œ íŠ¹ì • í‚¤ì— ëŒ€í•œ ì¼ë¶€ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ë¶€ì—¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ë¶€ì—¬ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì‚¬ìš©ìëŠ” ë™ì¼í•œ í‚¤ì— ëŒ€í•´ ì—¬ëŸ¬ ë¶€ì—¬(ì‹¬ì§€ì–´ ë™ì¼í•œ)ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ ì‚¬ìš©ìê°€ ëª¨ë“  ê¶Œí•œì„ ê°€ì§„ 10ê°œì˜ ë¶€ì—¬ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³µê²©ìëŠ” ì´ë¥¼ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì–´ëŠ ì‹œì ì—ì„œ 1ê°œì˜ ë¶€ì—¬ê°€ ì œê±°ë˜ë©´ ë‹¤ë¥¸ 10ê°œê°€ ìƒì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

(ì‚¬ìš©ìê°€ ì—¬ì „íˆ ì¼ë¶€ ë¶€ì—¬ë¥¼ ê°€ì§€ê³  ìˆëŠ” ë™ì•ˆ ë¶€ì—¬ê°€ ì œê±°ë˜ì—ˆìŒì„ ê°ì§€í•  ìˆ˜ ìˆë„ë¡ 10ì„ ì‚¬ìš©í•˜ê³  2ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤)
```bash
# To generate grants, generate 10 like this one
aws kms create-grant \
--key-id <key-id> \
--grantee-principal <user_arn> \
--operations "CreateGrant" "Decrypt"

# To monitor grants
aws kms list-grants --key-id <key-id>
```
{% hint style="info" %}
ê·¸ëœíŠ¸ëŠ” ë‹¤ìŒì—ì„œë§Œ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://docs.aws.amazon.com/kms/latest/developerguide/grants.html#terms-grant-operations](https://docs.aws.amazon.com/kms/latest/developerguide/grants.html#terms-grant-operations)
{% endhint %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œë¶€í„° AWS í•´í‚¹ì„ ì „ë¬¸ê°€ë¡œ ë°°ìš°ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
