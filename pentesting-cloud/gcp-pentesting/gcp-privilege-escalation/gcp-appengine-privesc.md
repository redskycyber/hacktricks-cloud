# GCP - AppEngine Privesc

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## App Engine

Para m치s informaci칩n sobre App Engine consulta:

{% content-ref url="../gcp-services/gcp-app-engine-enum.md" %}
[gcp-app-engine-enum.md](../gcp-services/gcp-app-engine-enum.md)
{% endcontent-ref %}

### `appengine.applications.get`, `appengine.instances.get`, `appengine.instances.list`, `appengine.operations.get`, `appengine.operations.list`, `appengine.services.get`, `appengine.services.list`, `appengine.versions.create`, `appengine.versions.get`, `appengine.versions.list`, `cloudbuild.builds.get`,`iam.serviceAccounts.actAs`, `resourcemanager.projects.get`, `storage.objects.create`, `storage.objects.list`

Esos son los permisos necesarios para **desplegar una App usando `gcloud` cli**. Quiz치s los permisos de **`get`** y **`list`** podr칤an **evitarse**.

Puedes encontrar ejemplos de c칩digo en Python en [https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/appengine](https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/appengine)

Por defecto, el nombre del servicio de App ser치 **`default`**, y solo puede haber 1 instancia con el mismo nombre.\
Para cambiarlo y crear una segunda App, en **`app.yaml`**, cambia el valor de la clave ra칤z por algo como **`service: my-second-app`**
```bash
cd python-docs-samples/appengine/flexible/hello_world
gcloud app deploy #Upload and start application inside the folder
```
Dale al menos 10-15 minutos, si no funciona llama a **desplegar otra serie de veces** y espera unos minutos.

{% hint style="info" %}
Es **posible indicar la Cuenta de Servicio a usar** pero por defecto, se utiliza la Cuenta de Servicio predeterminada de App Engine.
{% endhint %}

La URL de la aplicaci칩n es algo como `https://<nombre-proj>.oa.r.appspot.com/` o `https://<nombre_servicio>-dot-<nombre-proj>.oa.r.appspot.com`

### `appengine.instances.enableDebug`, `appengine.instances.get`, `appengine.instances.list`, `appengine.operations.get`, `appengine.services.get`, `appengine.services.list`, `appengine.versions.get`, `appengine.versions.list`, `compute.projects.get`

Con estos permisos, es posible **iniciar sesi칩n v칤a ssh en instancias de App Engine** de tipo **flexible** (no est치ndar). Algunos de los permisos de **`list`** y **`get`** **podr칤an no ser realmente necesarios**.
```bash
gcloud app instances ssh --service <app-name> --version <version-id> <ID>
```
### `appengine.applications.update`, `appengine.operations.get`

Creo que esto solo cambia la cuenta de servicio (SA) de fondo que Google usar치 para configurar las aplicaciones, as칤 que no creo que puedas abusar de esto para robar la cuenta de servicio. 

{% code overflow="wrap" %}
```bash
gcloud app update --service-account=<sa_email>
```
```markdown
{% endcode %}

### `appengine.versions.getFileContents`, `appengine.versions.update`

No estoy seguro de c칩mo utilizar estos permisos o si son 칰tiles (ten en cuenta que cuando cambias el c칩digo se crea una nueva versi칩n, as칤 que no s칠 si puedes simplemente actualizar el c칩digo o el rol de IAM de una, pero supongo que deber칤as poder hacerlo, 쯦al vez cambiando el c칩digo dentro del bucket?).

### Acceso de escritura sobre los buckets

Incluso con acceso de escritura sobre los buckets donde se encuentra el c칩digo fuente **NO fue posible ejecutar c칩digo arbitrario modificando el c칩digo fuente y el `manifest.json`**.\
쯈uiz치s si est치s monitoreando el bucket y detectas el momento en que se crea una nueva versi칩n y se sube el c칩digo fuente y el manifiesto, podr칤a ser posible cambiarlos para que la nueva versi칩n use los comprometidos??

Tambi칠n parece que las capas del contenedor se almacenan en el bucket, 쯦al vez cambiando esas?

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```
