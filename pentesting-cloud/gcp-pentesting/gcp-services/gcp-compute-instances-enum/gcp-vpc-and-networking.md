# GCP - VPC i MreÅ¾e

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## **GCP Compute MreÅ¾e ukratko**

**VPC-ovi** sadrÅ¾e **Firewall** pravila koja omoguÄ‡avaju dolazni saobraÄ‡aj u VPC. VPC-ovi takoÄ‘e sadrÅ¾e **podmreÅ¾e** u kojima Ä‡e biti **povezane virtuelne maÅ¡ine**.\
U poreÄ‘enju sa AWS-om, **Firewall** bi bio **najbliÅ¾a** stvar **AWS Security Groups i NACLs**, ali u ovom sluÄaju oni su **definisani u VPC-u** a ne u svakoj instanci.

## **VPC, PodmreÅ¾e i Firewall u GCP-u**

RaÄunarske instance su povezane **podmreÅ¾ama** koje su deo **VPC-ova** ([Virtual Private Clouds](https://cloud.google.com/vpc/docs/vpc)). U GCP-u ne postoje sigurnosne grupe, veÄ‡ postoje [**VPC firewall-i**](https://cloud.google.com/vpc/docs/firewalls) sa pravilima definisanim na ovom nivou mreÅ¾e, ali primenjenim na svaku VM instancu.

### PodmreÅ¾e

Jedan **VPC** moÅ¾e imati **viÅ¡e podmreÅ¾a**. Svaka **podmreÅ¾a je u jednoj regiji**.

### Firewall-i

Podrazumevano, svaka mreÅ¾a ima dva [**podrazumevana firewall pravila**](https://cloud.google.com/vpc/docs/firewalls#default\_firewall\_rules): **dozvoli odlazni** i **zabrani dolazni** saobraÄ‡aj.

Kada se kreira GCP projekat, takoÄ‘e se kreira VPC pod nazivom **`default`**, sa sledeÄ‡im firewall pravilima:

* **default-allow-internal:** dozvoljava sav saobraÄ‡aj sa drugih instanci na `default` mreÅ¾i
* **default-allow-ssh:** dozvoljava 22 sa bilo kog mesta
* **default-allow-rdp:** dozvoljava 3389 sa bilo kog mesta
* **default-allow-icmp:** dozvoljava ping sa bilo kog mesta

{% hint style="warning" %}
Kao Å¡to moÅ¾ete videti, **firewall pravila** su obiÄno **viÅ¡e dozvoljavajuÄ‡a** za **interne IP adrese**. Podrazumevani VPC dozvoljava sav saobraÄ‡aj izmeÄ‘u raÄunarskih instanci.
{% endhint %}

ViÅ¡e **firewall pravila** moÅ¾e biti kreirano za podrazumevani VPC ili za nove VPC-ove. [**Firewall pravila**](https://cloud.google.com/vpc/docs/firewalls) mogu biti primenjena na instance putem sledeÄ‡ih **metoda**:

* [**MreÅ¾ni tagovi**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**Servisni nalozi**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **Sve instance unutar VPC-a**

NaÅ¾alost, ne postoji jednostavna `gcloud` komanda koja Ä‡e prikazati sve raÄunarske instance sa otvorenim portovima na internetu. Morate povezati taÄke izmeÄ‘u firewall pravila, mreÅ¾nih tagova, servisnih naloga i instanci.

Ovaj proces je automatizovan koriÅ¡Ä‡enjem [ovog python skripta](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp\_firewall\_enum) koji Ä‡e izvesti sledeÄ‡e:

* CSV fajl koji prikazuje instancu, javnu IP adresu, dozvoljeni TCP, dozvoljeni UDP
* nmap skeniranje koje cilja sve instance na portovima za dolazni saobraÄ‡aj sa javnog interneta (0.0.0.0/0)
* masscan koji cilja ceo TCP opseg tih instanci koje dozvoljavaju SVE TCP portove sa javnog interneta (0.0.0.0/0)

### Hijerarhijske Firewall Politike <a href="#hierarchical-firewall-policies" id="hierarchical-firewall-policies"></a>

_Hijerarhijske firewall politike_ vam omoguÄ‡avaju da kreirate i **primenite doslednu firewall politiku u celoj vaÅ¡oj organizaciji**. MoÅ¾ete dodeliti **hijerarhijske firewall politike organizaciji** u celini ili pojedinaÄnim **folderima**. Ove politike sadrÅ¾e pravila koja mogu eksplicitno zabraniti ili dozvoliti konekcije.

Kreirate i primenjujete firewall politike kao odvojene korake. MoÅ¾ete kreirati i primeniti firewall politike na **Ävorovima organizacije ili foldera** u [**hijerarhiji resursa**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy). Pravilo firewall politike moÅ¾e **blokirati konekcije, dozvoliti konekcije ili odloÅ¾iti evaluaciju pravila firewall-a** na niÅ¾im nivoima foldera ili VPC firewall pravila definisanih u VPC mreÅ¾ama.

Podrazumevano, sva pravila hijerarhijske firewall politike se primenjuju na sve VM-ove u svim projektima u okviru organizacije ili foldera gde je politika povezana. MeÄ‘utim, moÅ¾ete **ograniÄiti kojim VM-ovima se dodeljuje dato pravilo** tako Å¡to Ä‡ete specificirati [ciljne mreÅ¾e ili ciljne servisne naloge](https://cloud.google.com/vpc/docs/firewall-policies#targets).

Ovde moÅ¾ete proÄitati kako [**kreirati hijerarhijsku firewall politiku**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud).

### Evaluacija pravila Firewall-a

<figure><img src="../../../../.gitbook/assets/image (4) (5).png" alt=""><figcaption></figcaption></figure>

## Regionalne Firewall Politike

Ovo su **Firewall pravila dodeljena regionu**.

## Povezivanje VPC MreÅ¾a

OmoguÄ‡ava povezivanje dve Virtual Private Cloud (VPC) mreÅ¾e tako da **resursi u svakoj mreÅ¾i mogu komunicirati** meÄ‘usobno.\
Povezane VPC mreÅ¾e mogu biti u istom projektu, razliÄitim projektima iste organizacije ili **razliÄitim projektima razliÄitih organizacija**.

Potrebne dozvole su:

* `compute.networks.addPeering`
* `compute.networks.updatePeering`
* `
