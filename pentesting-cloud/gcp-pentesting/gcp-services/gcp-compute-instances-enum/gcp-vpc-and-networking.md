# GCP - VPC ve AÄŸ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live) takip edin.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## **GCP Compute AÄŸlama Ã–zeti**

**VPC'ler**, VPC'ye gelen trafiÄŸe izin vermek iÃ§in **GÃ¼venlik DuvarÄ±** kurallarÄ± iÃ§erir. VPC'ler ayrÄ±ca **sanal makinelerin baÄŸlÄ± olacaÄŸÄ± alt aÄŸlarÄ±** iÃ§erir.\
AWS ile karÅŸÄ±laÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda, **GÃ¼venlik DuvarÄ±**, **AWS GÃ¼venlik GruplarÄ± ve NACL'lerine** en yakÄ±n ÅŸey olurdu, ancak bu durumda bunlar **VPC'de** ve her bir Ã¶rnekte deÄŸil **tanÄ±mlanÄ±r**.

## **GCP'de VPC, Alt AÄŸlar ve GÃ¼venlik DuvarlarÄ±**

Bilgi Ä°ÅŸlem Ã–rnekleri, **VPC'ye baÄŸlÄ± alt aÄŸlar** ile baÄŸlantÄ±lÄ±dÄ±r. GCP'de gÃ¼venlik gruplarÄ± yoktur, bunun yerine her bir VM Ã–rneÄŸine uygulanan [**VPC gÃ¼venlik duvarlarÄ±**](https://cloud.google.com/vpc/docs/firewalls) bulunur.

### Alt AÄŸlar

Bir **VPC**, **birkaÃ§ alt aÄŸa** sahip olabilir. Her **alt aÄŸ bir bÃ¶lgede** bulunur.

### GÃ¼venlik DuvarlarÄ±

Her aÄŸÄ±n varsayÄ±lan olarak iki [**varsayÄ±lan gÃ¼venlik duvarÄ± kuralÄ±**](https://cloud.google.com/vpc/docs/firewalls#default_firewall_rules) vardÄ±r: **giden trafiÄŸi izin ver** ve **gelen trafiÄŸi reddet**.

Bir GCP projesi oluÅŸturulduÄŸunda, aÅŸaÄŸÄ±daki gÃ¼venlik duvarÄ± kurallarÄ±na sahip **`varsayÄ±lan`** adÄ±nda bir VPC de oluÅŸturulur:

* **default-allow-internal:** `varsayÄ±lan` aÄŸÄ±ndaki diÄŸer Ã¶rneklerden gelen tÃ¼m trafiÄŸi izin ver
* **default-allow-ssh:** her yerden 22'ye izin ver
* **default-allow-rdp:** her yerden 3389'a izin ver
* **default-allow-icmp:** her yerden ping'e izin ver

{% hint style="warning" %}
GÃ¶rdÃ¼ÄŸÃ¼nÃ¼z gibi, **gÃ¼venlik duvarÄ± kurallarÄ±** genellikle **dahili IP adresleri** iÃ§in **daha izin vericidir**. VarsayÄ±lan VPC, Bilgi Ä°ÅŸlem Ã–rnekleri arasÄ±ndaki tÃ¼m trafiÄŸe izin verir.
{% endhint %}

VarsayÄ±lan VPC veya yeni VPC'ler iÃ§in daha fazla **GÃ¼venlik DuvarÄ± kuralÄ±** oluÅŸturulabilir. [**GÃ¼venlik DuvarÄ± kurallarÄ±**](https://cloud.google.com/vpc/docs/firewalls), aÅŸaÄŸÄ±daki **yÃ¶ntemlerle** Ã¶rnekler Ã¼zerine uygulanabilir:

* [**AÄŸ etiketleri**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**Hizmet hesaplarÄ±**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **Bir VPC iÃ§indeki tÃ¼m Ã¶rnekler**

Ne yazÄ±k ki, internet Ã¼zerinde aÃ§Ä±k portlara sahip tÃ¼m Bilgi Ä°ÅŸlem Ã–rneklerini gÃ¶steren basit bir `gcloud` komutu yoktur. GÃ¼venlik duvarÄ± kurallarÄ±, aÄŸ etiketleri, hizmet hesaplarÄ± ve Ã¶rnekler arasÄ±ndaki baÄŸlantÄ±larÄ± kurmanÄ±z gerekmektedir.

Bu sÃ¼reÃ§, aÅŸaÄŸÄ±daki [python betiÄŸi](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp_firewall_enum) kullanÄ±larak otomatikleÅŸtirilmiÅŸtir:

* Ã–rneÄŸi, genel IP'si, izin verilen TCP'si ve izin verilen UDP'si gÃ¶steren CSV dosyasÄ±
* Genel internetten (0.0.0.0/0) gelen giriÅŸ izinli tÃ¼m Ã¶rnekler iÃ§in nmap taramasÄ±
* Genel internetten (0.0.0.0/0) TÃœM TCP portlarÄ±na izin veren Ã¶rneklerin tam TCP aralÄ±ÄŸÄ±na yÃ¶nelik masscan taramasÄ±

### HiyerarÅŸik GÃ¼venlik DuvarÄ± PolitikalarÄ± <a href="#hierarchical-firewall-policies" id="hierarchical-firewall-policies"></a>

_HiyerarÅŸik gÃ¼venlik duvarÄ± politikalarÄ±_, **kuruluÅŸunuzda tutarlÄ± bir gÃ¼venlik duvarÄ± politikasÄ± oluÅŸturmanÄ±za ve uygulamanÄ±za** olanak tanÄ±r. HiyerarÅŸik gÃ¼venlik duvarÄ± politikalarÄ±nÄ± **kuruluÅŸun** tamamÄ±na veya **bireysel klasÃ¶rlere** atayabilirsiniz. Bu politikalar, baÄŸlantÄ±larÄ± aÃ§Ä±kÃ§a reddeden veya izin veren kurallar iÃ§erir.

GÃ¼venlik duvarÄ± politikalarÄ±nÄ± oluÅŸturma ve uygulama ayrÄ± adÄ±mlardÄ±r. GÃ¼venlik duvarÄ± politikalarÄ±nÄ± [**kaynak hiyerarÅŸisi**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)ndeki **kuruluÅŸ veya klasÃ¶r dÃ¼ÄŸÃ¼mlerine** oluÅŸturabilir ve uygulayabilirsiniz. Bir gÃ¼venlik duvarÄ± politikasÄ± kuralÄ±, baÄŸlantÄ±larÄ± **engelleyebilir, izin verebilir veya VPC aÄŸlarÄ±nda tanÄ±mlanan VPC gÃ¼venlik duvarÄ± kurallarÄ±na** baÄŸlÄ± olarak gÃ¼venlik duvarÄ± kuralÄ± deÄŸerlendirmesini **alt dÃ¼zey klasÃ¶rlere veya VPC gÃ¼venlik duvarÄ± kurallarÄ±na erteleyebilir**.

VarsayÄ±lan olarak, hiyerarÅŸik gÃ¼venlik duvarÄ± politika kurallarÄ±, politikanÄ±n iliÅŸkilendirildiÄŸi kuruluÅŸ veya klasÃ¶r altÄ±ndaki tÃ¼m projelerdeki tÃ¼m VM'ler iÃ§in geÃ§erlidir. Bununla birlikte, belirli [hedef aÄŸlar veya hedef hizmet hesaplarÄ±](https://cloud.google.com/vpc/docs/firewall-policies#targets) belirterek bir kuralÄ±n hangi VM'lerin alacaÄŸÄ±nÄ± **sÄ±nÄ±rlayabilirsiniz**.

[**Bir HiyerarÅŸik GÃ¼venlik DuvarÄ± PolitikasÄ± nasÄ±l oluÅŸturulacaÄŸÄ±nÄ±**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud) buradan okuyabilirsiniz.

### GÃ¼venlik DuvarÄ± KurallarÄ± DeÄŸerlendirmesi

<figure><img src="../../../../.gitbook/assets/image (4) (5).png" alt=""><figcaption></figcaption></figure>

## BÃ¶lgesel GÃ¼venlik DuvarÄ± PolitikalarÄ±

Bunlar, **bir bÃ¶lgeye atanan GÃ¼venlik DuvarÄ± kurallarÄ±dÄ±r**.

## VPC AÄŸÄ± EÅŸleme
