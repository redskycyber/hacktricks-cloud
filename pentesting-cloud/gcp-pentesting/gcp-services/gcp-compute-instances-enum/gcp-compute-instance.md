# GCP - RaÄunarski instanci

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Google Cloud raÄunarske instance su **prilagodljive virtuelne maÅ¡ine na Google-ovoj cloud infrastrukturi**, koje pruÅ¾aju skalabilnu i na zahtev raÄunarsku snagu za Å¡irok spektar aplikacija. PruÅ¾aju moguÄ‡nosti kao Å¡to su globalno rasporeÄ‘ivanje, trajno skladiÅ¡tenje, fleksibilan izbor operativnih sistema i snaÅ¾ne integracije mreÅ¾e i bezbednosti, ÄineÄ‡i ih svestranim izborom za hosting veb sajtova, obradu podataka i efikasno pokretanje aplikacija u oblaku.

### Poverljiva VM

Poverljive VM koriste **bezbednosne funkcije zasnovane na hardveru** koje pruÅ¾aju najnovije generacije AMD EPYC procesora, a koje ukljuÄuju enkripciju memorije i sigurnu enkripciju virtualizacije. Ove funkcije omoguÄ‡avaju VM-u da zaÅ¡titi podatke koji se obraÄ‘uju i skladiÅ¡te unutar njega Äak i od operativnog sistema domaÄ‡ina i hipervizora.

Da biste pokrenuli poverljivu VM, moÅ¾da Ä‡e biti potrebno **promeniti** stvari kao Å¡to su **tip** **maÅ¡ine**, **mreÅ¾ni interfejs**, **slika pokretne diskete**.

### Disk i enkripcija diska

MoguÄ‡e je **izabrati disk** koji Ä‡e se koristiti ili **kreirati novi**. Ako izaberete novi disk, moÅ¾ete:

* Izabrati **veliÄinu** diska
* Izabrati **operativni sistem**
* OznaÄiti da li Å¾elite da **obriÅ¡ete disk kada se instanca obriÅ¡e**
* **Enkripcija**: Podrazumevano Ä‡e se koristiti **Google upravljani kljuÄ**, ali moÅ¾ete takoÄ‘e **izabrati kljuÄ iz KMS** ili navesti **sirovi kljuÄ koji Ä‡e se koristiti**.

### Implementacija kontejnera

MoguÄ‡e je implementirati **kontejner** unutar virtuelne maÅ¡ine.\
MoguÄ‡e je konfigurisati **sliku** koja Ä‡e se koristiti, postaviti **komandu** koja Ä‡e se izvrÅ¡iti unutar nje, **argumente**, montirati **volume** i **env promenljive** (osetljive informacije?) i konfigurisati nekoliko opcija za ovaj kontejner kao Å¡to je izvrÅ¡avanje kao **privilegovan**, stdin i pseudo TTY.

### Servisni nalog

Podrazumevano Ä‡e se koristiti **servisni nalog za podrazumevanu raÄunarsku maÅ¡inu**. E-poÅ¡ta ovog servisnog naloga izgleda ovako: `<proj-br>-compute@developer.gserviceaccount.com`\
Ovaj servisni nalog ima **UredniÄku ulogu nad celim projektom (visoke privilegije).**

A **podrazumevani pristupni opsezi** su sledeÄ‡i:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Pristup za Äitanje kofa :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

MeÄ‘utim, moguÄ‡e je **dodeliti mu `cloud-platform` sa jednim klikom** ili specificirati **prilagoÄ‘ene opsege**.

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### Firewall

MoguÄ‡e je dozvoliti HTTP i HTTPS saobraÄ‡aj.

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### MreÅ¾no povezivanje

* **ProsleÄ‘ivanje IP adrese**: MoguÄ‡e je **omoguÄ‡iti prosleÄ‘ivanje IP adrese** prilikom kreiranja instance.
* **Hostname**: MoguÄ‡e je dodeliti instanci trajno ime hosta.
* **Interfejs**: MoguÄ‡e je dodati mreÅ¾ni interfejs.

### Dodatna bezbednost

Ove opcije Ä‡e **poveÄ‡ati bezbednost** VM-a i preporuÄuju se:

* **Sigurno podizanje sistema**: Sigurno podizanje sistema pomaÅ¾e u zaÅ¡titi vaÅ¡ih VM instanci od malvera na nivou podizanja sistema i jezgra i rootkitova.
* **OmoguÄ‡i vTPM**: Virtuelni Trusted Platform Module (vTPM) validira pre-boot i boot integritet vaÅ¡eg gostujuÄ‡eg VM-a i nudi generisanje i zaÅ¡titu kljuÄeva.
* **Nadzor integriteta**: Nadzor integriteta omoguÄ‡ava vam praÄ‡enje i proveru integriteta pokretanja u toku vaÅ¡ih VM instanci sa zaÅ¡titom pomoÄ‡u Stackdriver izveÅ¡taja. Zahteva omoguÄ‡en vTPM.

### Pristup VM-u

UobiÄajeni naÄin omoguÄ‡avanja pristupa VM-u je **dozvoljavanje odreÄ‘enih SSH javnih kljuÄeva** za pristup VM-u.\
MeÄ‘utim, moguÄ‡e je takoÄ‘e **omoguÄ‡iti pristup VM-u putem `os-config` servisa koristeÄ‡i IAM**. Osim toga, moguÄ‡e je omoguÄ‡iti 2FA za pristup VM-u putem ovog servisa.\
Kada je ovaj **servis** **omoguÄ‡en**, pristup putem **SSH kljuÄeva je onemoguÄ‡en**.

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### Metapodaci

MoguÄ‡e je definisati **automatizaciju** (userdata u AWS-u) koja su **shell komande** koje Ä‡e se izvrÅ¡iti svaki put kada se maÅ¡ina ukljuÄi ili restartuje.

TakoÄ‘e je moguÄ‡e **dodati dodatne metapodatke kljuÄ-vrednost** koji Ä‡e biti dostupni sa metapodatkovog endpointa. Ove informacije se obiÄno koriste za promenljive okruÅ¾enja i skripte za pokretanje/zaustavljanje. Ovo se moÅ¾e dobiti koriÅ¡Ä‡enjem **`describe` metode** iz komande u sekciji enumeracije, ali se takoÄ‘e moÅ¾e dobiti iznutra instance pristupanjem metapodatkovom endpointu.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Osim toga, **autentiÄni token za pridruÅ¾eni servisni nalog** i **opÅ¡te informacije** o instanci, mreÅ¾i i projektu takoÄ‘e Ä‡e biti dostupne putem **metadata endpointa**. Za viÅ¡e informacija pogledajte:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Enkripcija

Podrazumevano se koristi Google-ov upravljani kljuÄ za enkripciju, ali moÅ¾e se konfigurisati i korisniÄki upravljani kljuÄ za enkripciju (CMEK). TakoÄ‘e moÅ¾ete konfigurisati Å¡ta treba da se uradi kada se koristi CMEF povuÄe: NiÅ¡ta ili iskljuÄivanje virtuelne maÅ¡ine.

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini da podrÅ¾ite HackTricks:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju oglaÅ¡enu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
