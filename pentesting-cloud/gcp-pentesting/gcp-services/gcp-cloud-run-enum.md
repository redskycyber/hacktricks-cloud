# GCP - Wyliczanie usugi Cloud Run

<details>

<summary><strong>Dowiedz si, jak hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run to zarzdzana platforma obliczeniowa typu serverless, kt贸ra umo偶liwia **uruchamianie kontener贸w** bezporednio na skalowalnej infrastrukturze Google.

Mo偶esz uruchamia sw贸j kontener lub jeli u偶ywasz Go, Node.js, Pythona, Javy, .NET Core lub Ruby'ego, mo偶esz skorzysta z opcji [wdro偶enia opartego na 藕r贸dle](https://cloud.google.com/run/docs/deploying-source-code), kt贸ra **buduje kontener za Ciebie.**

Google stworzy Cloud Run, aby **dobrze wsp贸pracowa z innymi usugami w Google Cloud**, dziki czemu mo偶esz budowa penowartociowe aplikacje.

### Usugi i zadania <a href="#services-and-jobs" id="services-and-jobs"></a>

Na Cloud Run Tw贸j kod mo偶e dziaa cigle jako _**usuga**_ lub jako _**zadanie**_. Zar贸wno usugi, jak i zadania dziaaj w tym samym rodowisku i mog korzysta z tych samych integracji z innymi usugami w Google Cloud.

* **Usugi Cloud Run.** Su偶 do uruchamiania kodu, kt贸ry odpowiada na 偶dania sieciowe lub zdarzenia.
* **Zadania Cloud Run.** Su偶 do uruchamiania kodu, kt贸ry wykonuje prac (zadanie) i koczy dziaanie, gdy praca zostanie wykonana.

## Usuga Cloud Run

Google [Cloud Run](https://cloud.google.com/run) to kolejna oferowana usuga typu serverless, w kt贸rej mo偶na wyszukiwa zmienne rodowiskowe. Cloud Run tworzy may serwer sieciowy, domylnie dziaajcy na porcie 8080 wewntrz kontenera, kt贸ry czeka na 偶danie HTTP GET. Po otrzymaniu 偶dania uruchamiane jest zadanie, a dziennik zadania jest wywietlany za pomoc odpowiedzi HTTP.

### Istotne szczeg贸y

* Domylnie **dostp** do serwera sieciowego jest **publiczny**, ale mo偶na go r贸wnie偶 **ograniczy do ruchu wewntrznego** (VPC...)\
Ponadto, **uwierzytelnienie** do kontaktu z serwerem sieciowym mo偶e by **zezwala na wszystkich** lub **wymaga uwierzytelnienia za pomoc IAM**.
* Domylnie **szyfrowanie** korzysta z **zarzdzanego przez Google klucza**, ale mo偶na r贸wnie偶 wybra **CMEK** (Customer Managed Encryption Key) z **KMS**.
* Domylnie u偶ywane jest **konto usugi** Compute Engine, kt贸re ma dostp **Edytora** do projektu i ma zakres `cloud-platform`.
* Mo偶na zdefiniowa **zmienne rodowiskowe w postaci tekstu jawnego** dla wykonania, a nawet **montowa tajemnice chmury** lub **dodawa tajemnice chmury do zmiennych rodowiskowych.**
* Mo偶liwe jest r贸wnie偶 **dodawanie pocze z Cloud SQL** i **montowanie systemu plik贸w.**
* **Adresy URL** wdro偶onych usug maj posta **`https://<nazwa-usugi>-<losowy>.a.run.app`**
* Usuga Run mo偶e mie **wicej ni偶 1 wersj lub rewizj** i **rozdziela ruch** midzy kilkoma rewizjami.

### Wyliczanie
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Zadania w chmurze Cloud Run

Zadania w chmurze Cloud Run s lepszym rozwizaniem dla **kontener贸w, kt贸re dziaaj do zakoczenia i nie obsuguj 偶da**. Zadania nie maj mo偶liwoci obsugi 偶da ani nasuchiwania na porcie. Oznacza to, 偶e w przeciwiestwie do usug Cloud Run, zadania nie powinny zawiera serwera sieciowego. Zamiast tego, kontenery z zadaniami powinny zakoczy dziaanie po wykonaniu swojego zadania.

### Wyliczanie
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Eskalacja uprawnie

Na nastpnej stronie mo偶esz sprawdzi, jak **wykorzysta uprawnienia Cloud Run do eskalacji uprawnie**:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Nieuwierzytelniony dostp

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Po eksploatacji

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Trwao

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Odwoania

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
