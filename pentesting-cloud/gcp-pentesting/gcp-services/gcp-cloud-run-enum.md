# GCP - Cloud Runæšä¸¾

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆæœ¬çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Google [Cloud Run](https://cloud.google.com/run)æ˜¯å¦ä¸€ä¸ªæ— æœåŠ¡å™¨çš„æœåŠ¡ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨å…¶ä¸­æœç´¢ç¯å¢ƒå˜é‡ã€‚Cloud Runåˆ›å»ºä¸€ä¸ªå°å‹çš„WebæœåŠ¡å™¨ï¼Œè¿è¡Œåœ¨8080ç«¯å£ä¸Šï¼Œç­‰å¾…HTTP GETè¯·æ±‚ã€‚å½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä¼šæ‰§è¡Œä¸€ä¸ªä½œä¸šï¼Œå¹¶é€šè¿‡HTTPå“åº”è¾“å‡ºä½œä¸šæ—¥å¿—ã€‚

**é»˜è®¤æƒ…å†µä¸‹**ï¼Œå¯¹WebæœåŠ¡å™¨çš„**è®¿é—®æ˜¯å…¬å¼€çš„**ï¼Œä½†ä¹Ÿå¯ä»¥**é™åˆ¶ä¸ºå†…éƒ¨æµé‡**ï¼ˆVPC...ï¼‰\
æ­¤å¤–ï¼Œä¸WebæœåŠ¡å™¨è”ç³»çš„**èº«ä»½éªŒè¯**å¯ä»¥æ˜¯**å…è®¸æ‰€æœ‰**æˆ–**è¦æ±‚é€šè¿‡IAMè¿›è¡Œèº«ä»½éªŒè¯**ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œ**åŠ å¯†**ä½¿ç”¨çš„æ˜¯**Googleæ‰˜ç®¡å¯†é’¥**ï¼Œä½†ä¹Ÿå¯ä»¥é€‰æ‹©æ¥è‡ª**KMS**çš„**CMEK**ï¼ˆå®¢æˆ·ç®¡ç†çš„åŠ å¯†å¯†é’¥ï¼‰ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„**æœåŠ¡å¸æˆ·**æ˜¯**Compute Engineé»˜è®¤å¸æˆ·**ï¼Œå¹¶ä¸”å…·æœ‰**`cloud-platform`**èŒƒå›´ã€‚

å¯ä»¥ä¸ºæ‰§è¡Œå®šä¹‰**æ˜æ–‡ç¯å¢ƒå˜é‡**ï¼Œç”šè‡³å¯ä»¥**æŒ‚è½½äº‘å¯†é’¥**æˆ–**å°†äº‘å¯†é’¥æ·»åŠ åˆ°ç¯å¢ƒå˜é‡**ã€‚

è¿˜å¯ä»¥**æ·»åŠ ä¸Cloud SQLçš„è¿æ¥**ã€‚

éƒ¨ç½²çš„æœåŠ¡çš„**URL**ç±»ä¼¼äº`https://<svc-name>-<random>.a.run.app`

### æšä¸¾
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
### ææƒ

åœ¨ä¸‹é¢çš„é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•æ»¥ç”¨äº‘è¿è¡Œæƒé™ä»¥æå‡ç‰¹æƒï¼š

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

### æšä¸¾å¼€æ”¾çš„ Cloud Run

ä½¿ç”¨ä»¥ä¸‹ä»£ç [ä»è¿™é‡Œè·å–](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_misc/-/blob/master/find\_open\_cloudrun.sh)ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°å…è®¸æœªç»èº«ä»½éªŒè¯è°ƒç”¨çš„ Cloud Run æœåŠ¡ã€‚
```bash
#!/bin/bash

############################
# Run this tool to find Cloud Run services that permit unauthenticated
# invocations anywhere in your GCP organization.
# Enjoy!
############################

for proj in $(gcloud projects list --format="get(projectId)"); do
echo "[*] scraping project $proj"

enabled=$(gcloud services list --project "$proj" | grep "Cloud Run API")

if [ -z "$enabled" ]; then
continue
fi


for run in $(gcloud run services list --platform managed --quiet --project $proj --format="get(name)"); do
ACL="$(gcloud run services get-iam-policy $run --platform managed --project $proj)"

all_users="$(echo $ACL | grep allUsers)"
all_auth="$(echo $ACL | grep allAuthenticatedUsers)"

if [ -z "$all_users" ]
then
:
else
echo "[!] Open to all users: $proj: $run"
fi

if [ -z "$all_auth" ]
then
:
else
echo "[!] Open to all authenticated users: $proj: $run"
fi
done
done
```
## Cloud Run ä½œä¸š

Cloud Run ä½œä¸šæ›´é€‚åˆäº**è¿è¡Œå®Œæ¯•ä¸”ä¸æä¾›è¯·æ±‚æœåŠ¡çš„å®¹å™¨**ã€‚ä½œä¸šæ— æ³•æä¾›è¯·æ±‚æœåŠ¡æˆ–ç›‘å¬ç«¯å£ã€‚è¿™æ„å‘³ç€ä¸ Cloud Run æœåŠ¡ä¸åŒï¼Œä½œä¸šä¸åº”è¯¥åŒ…å« Web æœåŠ¡å™¨ã€‚ç›¸åï¼Œä½œä¸šå®¹å™¨åº”åœ¨å®Œæˆä»»åŠ¡åé€€å‡ºã€‚

### æšä¸¾
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„å…¬å¸åœ¨ HackTricks ä¸­è¢«å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ HackTricks çš„ PDFï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å¾—[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨ **Twitter** ä¸Š **å…³æ³¨** æˆ‘ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
