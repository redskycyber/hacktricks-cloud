# Az - æœªç»èº«ä»½éªŒè¯çš„æšä¸¾å’Œåˆå§‹å…¥å£

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## Azureç§Ÿæˆ·

### ç§Ÿæˆ·æšä¸¾

æœ‰ä¸€äº›**å…¬å…±Azure API**ï¼Œåªè¦çŸ¥é“æ”»å‡»è€…å¯ä»¥æŸ¥è¯¢çš„**ç§Ÿæˆ·åŸŸ**ï¼Œå°±å¯ä»¥æŸ¥è¯¢æ›´å¤šå…³äºå®ƒçš„ä¿¡æ¯ã€‚\
æ‚¨å¯ä»¥ç›´æ¥æŸ¥è¯¢APIï¼Œæˆ–ä½¿ç”¨PowerShellåº“[**AADInternals**](https://github.com/Gerenios)**:**

| API                                                                  | ä¿¡æ¯                                                                                                                                                                                                                                           | AADInternalså‡½æ•°                             |
| -------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | **ç™»å½•ä¿¡æ¯**ï¼ŒåŒ…æ‹¬ç§Ÿæˆ·ID                                                                                                                                                                                                                        | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | ç§Ÿæˆ·çš„**æ‰€æœ‰åŸŸ**                                                                                                                                                                                                                               | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | <p><strong>ç§Ÿæˆ·çš„ç™»å½•ä¿¡æ¯</strong>ï¼ŒåŒ…æ‹¬ç§Ÿæˆ·åç§°å’ŒåŸŸå<strong>èº«ä»½éªŒè¯ç±»å‹ã€‚</strong><br>å¦‚æœ<code>NameSpaceType</code>æ˜¯<strong><code>Managed</code></strong>ï¼Œåˆ™è¡¨ç¤ºä½¿ç”¨<strong>AzureAD</strong>ã€‚</p> | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | ç™»å½•ä¿¡æ¯ï¼ŒåŒ…æ‹¬**æ¡Œé¢SSOä¿¡æ¯**                                                                                                                                                                                                                 | `Get-AADIntLoginInformation -UserName <UserName>` |

æ‚¨å¯ä»¥ä½¿ç”¨[**AADInternals**](https://github.com/Gerenios) **åº“çš„ä¸€ä¸ªå‘½ä»¤æŸ¥è¯¢Azureç§Ÿæˆ·çš„æ‰€æœ‰ä¿¡æ¯**ï¼š
```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```
Azureç§Ÿæˆ·ä¿¡æ¯çš„è¾“å‡ºç¤ºä¾‹ï¼š
```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          1937e3ab-38de-a735-a830-3075ea7e5b39
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```
å¯ä»¥è§‚å¯Ÿåˆ°ç§Ÿæˆ·çš„åç§°ã€IDå’Œâ€œå“ç‰Œâ€åç§°ã€‚æ­¤å¤–ï¼Œè¿˜æ˜¾ç¤ºäº†æ¡Œé¢å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰çš„çŠ¶æ€ï¼Œä¹Ÿç§°ä¸º[**Seamless SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso)ã€‚å¯ç”¨æ­¤åŠŸèƒ½æœ‰åŠ©äºç¡®å®šç›®æ ‡ç»„ç»‡ä¸­ç‰¹å®šç”¨æˆ·çš„å­˜åœ¨ï¼ˆæšä¸¾ï¼‰ã€‚

æ­¤å¤–ï¼Œè¾“å‡ºæ˜¾ç¤ºäº†ä¸ç›®æ ‡ç§Ÿæˆ·å…³è”çš„æ‰€æœ‰ç»è¿‡éªŒè¯çš„åŸŸçš„åç§°ï¼Œä»¥åŠå®ƒä»¬å„è‡ªçš„èº«ä»½ç±»å‹ã€‚å¯¹äºè”åˆåŸŸï¼Œè¿˜æŠ«éœ²äº†æ­£åœ¨ä½¿ç”¨çš„èº«ä»½æä¾›è€…çš„å®Œå…¨é™å®šåŸŸåï¼ˆFQDNï¼‰ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªADFSæœåŠ¡å™¨ã€‚"MX"åˆ—æŒ‡å®šç”µå­é‚®ä»¶æ˜¯å¦è·¯ç”±åˆ°Exchange Onlineï¼Œè€Œ"SPF"åˆ—è¡¨ç¤ºExchange Onlineä½œä¸ºç”µå­é‚®ä»¶å‘ä»¶äººçš„åˆ—è¡¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“å‰çš„ä¾¦å¯ŸåŠŸèƒ½ä¸è§£æSPFè®°å½•ä¸­çš„â€œincludeâ€è¯­å¥ï¼Œè¿™å¯èƒ½å¯¼è‡´è¯¯æŠ¥ã€‚

### ç”¨æˆ·æšä¸¾

å¯ä»¥**æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨**åœ¨ç§Ÿæˆ·å†…ã€‚è¿™ä¹ŸåŒ…æ‹¬**è®¿å®¢ç”¨æˆ·**ï¼Œå…¶ç”¨æˆ·åæ ¼å¼ä¸ºï¼š
```
<email>#EXT#@<tenant name>.onmicrosoft.com
```
é‚®ç®±æ˜¯ç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ï¼Œåœ¨â€œ@â€å¤„ç”¨ä¸‹åˆ’çº¿â€œ\_â€æ›¿æ¢ã€‚

ä½¿ç”¨[**AADInternals**](https://github.com/Gerenios/AADInternals)ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼š
```powershell
# Check does the user exist
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```
## æœªç»èº«ä»½éªŒè¯çš„æšä¸¾å’Œåˆå§‹å…¥å£

åœ¨è¿›è¡Œäº‘æ¸—é€æµ‹è¯•æ—¶ï¼Œæœªç»èº«ä»½éªŒè¯çš„æšä¸¾å’Œåˆå§‹å…¥å£æ˜¯ä¸€ä¸ªé‡è¦çš„æ­¥éª¤ã€‚è¿™äº›æŠ€æœ¯å¯ä»¥å¸®åŠ©é‰´å®šç›®æ ‡ç³»ç»Ÿä¸­çš„å¼±ç‚¹å’Œæ½œåœ¨çš„å…¥å£ç‚¹ï¼Œä¸ºåç»­çš„æ”»å‡»å’Œæ¸—é€æµ‹è¯•åšå‡†å¤‡ã€‚

### æœªç»èº«ä»½éªŒè¯çš„æšä¸¾

åœ¨è¿›è¡Œæœªç»èº«ä»½éªŒè¯çš„æšä¸¾æ—¶ï¼Œæ¸—é€æµ‹è¯•äººå‘˜é€šå¸¸ä¼šå°è¯•è®¿é—®ç›®æ ‡ç³»ç»Ÿçš„å…¬å¼€èµ„æºå’Œä¿¡æ¯ï¼Œä»¥å‘ç°å¯èƒ½å­˜åœ¨çš„å®‰å…¨æ¼æ´ã€‚è¿™å¯èƒ½æ¶‰åŠåˆ°æŸ¥æ‰¾å…¬å¼€å¯è®¿é—®çš„å­˜å‚¨æ¡¶ã€æ•°æ®åº“ã€æ—¥å¿—æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ç­‰æ•æ„Ÿä¿¡æ¯ã€‚

### åˆå§‹å…¥å£

é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„æšä¸¾ï¼Œæ¸—é€æµ‹è¯•äººå‘˜å¯èƒ½ä¼šå‘ç°ä¸€äº›åˆå§‹å…¥å£ç‚¹ï¼Œå¦‚å¼±å¯†ç ã€æœªç»èº«ä»½éªŒè¯çš„APIç«¯ç‚¹ã€æœªç»èº«ä»½éªŒè¯çš„ç®¡ç†ç•Œé¢ç­‰ã€‚åˆ©ç”¨è¿™äº›åˆå§‹å…¥å£ç‚¹ï¼Œæ”»å‡»è€…å¯ä»¥è¿›ä¸€æ­¥æ·±å…¥ç³»ç»Ÿï¼Œè·å–æ›´å¤šæƒé™å¹¶æ‰§è¡Œæ›´é«˜çº§çš„æ”»å‡»ã€‚

åœ¨è¿›è¡Œäº‘æ¸—é€æµ‹è¯•æ—¶ï¼Œé‡è¦çš„æ˜¯è¦å…¨é¢è€Œç³»ç»Ÿåœ°è¿›è¡Œæœªç»èº«ä»½éªŒè¯çš„æšä¸¾ï¼Œä»¥å‘ç°æ½œåœ¨çš„å®‰å…¨é£é™©å¹¶åŠæ—¶åŠ ä»¥ä¿®å¤ã€‚
```
UserName         Exists
--------         ------
user@company.com True
```
æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¯è¡ŒåŒ…å«ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€çš„æ–‡æœ¬æ–‡ä»¶ï¼š
```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# Invoke user enumeration
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
æœ‰**ä¸‰ç§ä¸åŒçš„æšä¸¾æ–¹æ³•**å¯ä¾›é€‰æ‹©ï¼š

| æ–¹æ³•      | æè¿°                                                                                                                                                                                             |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| æ­£å¸¸     | è¿™æ˜¯æŒ‡ä¸Šé¢æåˆ°çš„GetCredentialType APIã€‚é»˜è®¤æ–¹æ³•ã€‚                                                                                                                           |
| ç™»å½•     | <p>æ­¤æ–¹æ³•å°è¯•ä»¥ç”¨æˆ·èº«ä»½ç™»å½•ã€‚<br><strong>æ³¨æ„ï¼š</strong>æŸ¥è¯¢å°†è®°å½•åœ¨ç™»å½•æ—¥å¿—ä¸­ã€‚</p>                                                                                       |
| è‡ªåŠ¨ç™»å½• | <p>æ­¤æ–¹æ³•å°è¯•é€šè¿‡è‡ªåŠ¨ç™»å½•ç«¯ç‚¹ä»¥ç”¨æˆ·èº«ä»½ç™»å½•ã€‚<br><strong>æŸ¥è¯¢ä¸ä¼šè¢«è®°å½•</strong>åœ¨ç™»å½•æ—¥å¿—ä¸­ï¼å› æ­¤ï¼Œä¹Ÿé€‚ç”¨äºå¯†ç å–·æ´’å’Œæš´åŠ›æ”»å‡»ã€‚</p> |

å‘ç°æœ‰æ•ˆç”¨æˆ·ååï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è·å–**æœ‰å…³ç”¨æˆ·çš„ä¿¡æ¯**ï¼š
```powershell
Get-AADIntLoginInformation -UserName root@corp.onmicrosoft.com
```
è¯¥è„šæœ¬ [**o365creeper**](https://github.com/LMGsec/o365creeper) ä¹Ÿå…è®¸æ‚¨å‘ç°**ç”µå­é‚®ä»¶æ˜¯å¦æœ‰æ•ˆ**ã€‚
```powershell
# Put in emails.txt emails such as:
# - root@corp.onmicrosoft.com
python.exe .\o365creeper\o365creeper.py -f .\emails.txt -o validemails.txt
```
**é€šè¿‡ Microsoft Teams è¿›è¡Œç”¨æˆ·æšä¸¾**

å¦ä¸€ä¸ªä¿¡æ¯æ¥æºæ˜¯ Microsoft Teamsã€‚

Microsoft Teams çš„ API å…è®¸æœç´¢ç”¨æˆ·ã€‚ç‰¹åˆ«æ˜¯ "user search" ç«¯ç‚¹ **externalsearchv3** å’Œ **searchUsers** å¯ä»¥ç”¨äºè¯·æ±‚æœ‰å…³å·²æ³¨å†Œ Teams ç”¨æˆ·å¸æˆ·çš„ä¸€èˆ¬ä¿¡æ¯ã€‚

æ ¹æ® API å“åº”ï¼Œå¯ä»¥åŒºåˆ†ä¸å­˜åœ¨çš„ç”¨æˆ·å’Œå…·æœ‰æœ‰æ•ˆ Teams è®¢é˜…çš„ç°æœ‰ç”¨æˆ·ã€‚

è„šæœ¬ [**TeamsEnum**](https://github.com/sse-secure-systems/TeamsEnum) å¯ç”¨äºéªŒè¯ä¸€ç»„ç»™å®šçš„ç”¨æˆ·åæ˜¯å¦ä¸ Teams API åŒ¹é…ã€‚
```bash
python3 TeamsEnum.py -a password -u <username> -f inputlist.txt -o teamsenum-output.json
```
## æœªç»èº«ä»½éªŒè¯çš„æšä¸¾å’Œåˆå§‹å…¥å£

åœ¨Azureä¸­ï¼Œæœ‰ä¸€äº›å…¬å¼€å¯ç”¨çš„ç»ˆç»“ç‚¹ï¼Œå¯ä»¥åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹è¿›è¡Œæšä¸¾ã€‚è¿™äº›ç»ˆç»“ç‚¹å¯èƒ½åŒ…å«æœ‰å…³Azureèµ„æºçš„æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚å­˜å‚¨å¸æˆ·ã€æ•°æ®åº“ç­‰ã€‚é»‘å®¢å¯ä»¥åˆ©ç”¨è¿™äº›ä¿¡æ¯æ¥å‘èµ·æ›´æ·±å…¥çš„æ”»å‡»ã€‚

### æšä¸¾æœåŠ¡

1. **Azure Blob å­˜å‚¨æœåŠ¡**ï¼šå¯ä»¥é€šè¿‡å…¬å…±Blobå­˜å‚¨å¸æˆ·çš„URLè¿›è¡Œè®¿é—®ï¼Œå¦‚æœæœªæ­£ç¡®é…ç½®è®¿é—®æƒé™ï¼Œé»‘å®¢å¯ä»¥æšä¸¾å­˜å‚¨æ¡¶ä¸­çš„æ–‡ä»¶ã€‚
   
2. **Azure Cosmos DB**ï¼šå¯ä»¥é€šè¿‡å…¬å…±Cosmos DBå¸æˆ·çš„URLè¿›è¡Œè®¿é—®ï¼Œå¦‚æœæœªæ­£ç¡®é…ç½®è®¿é—®æƒé™ï¼Œé»‘å®¢å¯ä»¥æšä¸¾æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚

### åˆå§‹å…¥å£

1. **æœªç»èº«ä»½éªŒè¯çš„è®¿é—®**ï¼šé»‘å®¢å¯ä»¥å°è¯•ä½¿ç”¨å…¬å¼€å¯ç”¨çš„ç»ˆç»“ç‚¹ï¼Œå¦‚Azure Blobå­˜å‚¨æˆ–Cosmos DBï¼Œæ¥è·å–æœªç»èº«ä»½éªŒè¯çš„è®¿é—®ã€‚è¿™ä¸ºé»‘å®¢æä¾›äº†è¿›ä¸€æ­¥æ¢ç´¢Azureç¯å¢ƒçš„æœºä¼šã€‚

2. **ä¿¡æ¯æ”¶é›†**ï¼šé»‘å®¢å¯ä»¥æ”¶é›†æœ‰å…³Azureèµ„æºçš„ä¿¡æ¯ï¼Œå¦‚å­˜å‚¨æ¡¶ã€æ•°æ®åº“ç­‰ï¼Œä¸ºåç»­æ”»å‡»åšå‡†å¤‡ã€‚

3. **æ½œåœ¨é£é™©**ï¼šæœªç»èº«ä»½éªŒè¯çš„æšä¸¾å’Œåˆå§‹å…¥å£å¯èƒ½å¯¼è‡´æ•æ„Ÿæ•°æ®æ³„éœ²å’Œè¿›ä¸€æ­¥çš„æƒé™æå‡æ”»å‡»ã€‚å› æ­¤ï¼Œç»„ç»‡åº”è¯¥ç¡®ä¿æ­£ç¡®é…ç½®å…¶Azureèµ„æºçš„è®¿é—®æƒé™ï¼Œä»¥é˜²æ­¢æ­¤ç±»æ”»å‡»ã€‚
```
[-] user1@domain - Target user not found. Either the user does not exist, is not Teams-enrolled or is configured to not appear in search results (personal accounts only)
[+] user2@domain - User2 | Company (Away, Mobile)
[+] user3@domain - User3 | Company (Available, Desktop)
```
æ­¤å¤–ï¼Œè¿˜å¯ä»¥æšä¸¾ç°æœ‰ç”¨æˆ·çš„å¯ç”¨æ€§ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

- å¯ç”¨
- ç¦»å¼€
- è¯·å‹¿æ‰“æ‰°
- å¿™ç¢Œ
- ç¦»çº¿

å¦‚æœé…ç½®äº†**å¤–å‡ºåŠå…¬ç•™è¨€**ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ TeamsEnum æ£€ç´¢ç•™è¨€ã€‚å¦‚æœæŒ‡å®šäº†è¾“å‡ºæ–‡ä»¶ï¼Œåˆ™å¤–å‡ºåŠå…¬ç•™è¨€ä¼šè‡ªåŠ¨å­˜å‚¨åœ¨ JSON æ–‡ä»¶ä¸­ï¼š
```
jq . teamsenum-output.json
```
## æœªç»èº«ä»½éªŒè¯çš„æšä¸¾å’Œåˆå§‹å…¥å£

åœ¨è¿›è¡Œäº‘å®‰å…¨æ¸—é€æµ‹è¯•æ—¶ï¼Œæœªç»èº«ä»½éªŒè¯çš„æšä¸¾å’Œåˆå§‹å…¥å£æ˜¯ä¸€ä¸ªé‡è¦çš„æ­¥éª¤ã€‚é€šè¿‡æ­¤è¿‡ç¨‹ï¼Œé»‘å®¢å¯ä»¥å‘ç°ç›®æ ‡ç³»ç»Ÿä¸­çš„æ•æ„Ÿä¿¡æ¯å’Œæ½œåœ¨çš„æ¼æ´ï¼Œä¸ºè¿›ä¸€æ­¥å…¥ä¾µæä¾›å¯èƒ½æ€§ã€‚

### æšä¸¾æœåŠ¡

1. **Azure Blob å­˜å‚¨æœåŠ¡**ï¼šä½¿ç”¨å·¥å…·å¦‚ `azcopy` æˆ– `Azure Storage Explorer` æšä¸¾ Blob å­˜å‚¨ä¸­çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚
2. **Azure æ–‡ä»¶å­˜å‚¨æœåŠ¡**ï¼šä½¿ç”¨ SMB å®¢æˆ·ç«¯æšä¸¾æ–‡ä»¶å…±äº«ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚
3. **Azure è¡¨å­˜å‚¨æœåŠ¡**ï¼šä½¿ç”¨å·¥å…·å¦‚ `Azure Storage Explorer` æˆ– `Azure CLI` æšä¸¾è¡¨å­˜å‚¨ä¸­çš„æ•°æ®ã€‚
4. **Azure Cosmos DB**ï¼šä½¿ç”¨å·¥å…·å¦‚ `Cosmos DB Explorer` æˆ– `NoSQLBooster` æšä¸¾ Cosmos DB ä¸­çš„æ•°æ®ã€‚
5. **Azure Key Vault**ï¼šä½¿ç”¨ `Azure CLI` æˆ– `Azure PowerShell` æšä¸¾å¯†é’¥å’Œæœºå¯†ã€‚
6. **Azure Functions**ï¼šä½¿ç”¨å·¥å…·å¦‚ `Azure Portal` æˆ– `Azure CLI` æšä¸¾ Azure Functions ä¸­çš„å‡½æ•°å’Œä»£ç ã€‚

### åˆå§‹å…¥å£

1. **æœªç»èº«ä»½éªŒè¯çš„å­˜å‚¨æ¡¶è®¿é—®**ï¼šå°è¯•è®¿é—®æœªç»èº«ä»½éªŒè¯çš„ Azure å­˜å‚¨æ¡¶ä»¥è·å–æ•æ„Ÿæ•°æ®ã€‚
2. **æœªç»èº«ä»½éªŒè¯çš„æ•°æ®åº“è®¿é—®**ï¼šå°è¯•é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„è¿æ¥å­—ç¬¦ä¸²è®¿é—® Azure æ•°æ®åº“ã€‚
3. **æœªç»èº«ä»½éªŒè¯çš„ API è®¿é—®**ï¼šå°è¯•é€šè¿‡æœªç»èº«ä»½éªŒè¯çš„ API ç»ˆç«¯ç‚¹è®¿é—® Azure æœåŠ¡ã€‚
4. **æœªç»èº«ä»½éªŒè¯çš„å‡½æ•°è°ƒç”¨**ï¼šå°è¯•è°ƒç”¨æœªç»èº«ä»½éªŒè¯çš„ Azure Functions ä»¥æ‰§è¡Œæ¶æ„æ“ä½œã€‚

é€šè¿‡æ‰§è¡Œè¿™äº›æ­¥éª¤ï¼Œé»‘å®¢å¯ä»¥è¯†åˆ«ç›®æ ‡ç³»ç»Ÿä¸­çš„å¼±ç‚¹ï¼Œå¹¶åˆ©ç”¨å®ƒä»¬è·å–å¯¹ç³»ç»Ÿçš„æœªç»æˆæƒè®¿é—®ã€‚
```json
{
"email": "user2@domain",
"exists": true,
"info": [
{
"tenantId": "[REDACTED]",
"isShortProfile": false,
"accountEnabled": true,
"featureSettings": {
"coExistenceMode": "TeamsOnly"
},
"userPrincipalName": "user2@domain",
"givenName": "user2@domain",
"surname": "",
"email": "user2@domain",
"tenantName": "Company",
"displayName": "User2",
"type": "Federated",
"mri": "8:orgid:[REDACTED]",
"objectId": "[REDACTED]"
}
],
"presence": [
{
"mri": "8:orgid:[REDACTED]",
"presence": {
"sourceNetwork": "Federated",
"calendarData": {
"outOfOfficeNote": {
"message": "Dear sender. I am out of the office until March 23rd with limited access to my email. I will respond after my return.Kind regards, User2",
"publishTime": "2023-03-15T21:44:42.0649385Z",
"expiry": "2023-04-05T14:00:00Z"
},
"isOutOfOffice": true
},
"capabilities": [
"Audio",
"Video"
],
"availability": "Away",
"activity": "Away",
"deviceType": "Mobile"
},
"etagMatch": false,
"etag": "[REDACTED]",
"status": 20000
}
]
}
```
## Azure æœåŠ¡

ç°åœ¨æˆ‘ä»¬çŸ¥é“ Azure ç§Ÿæˆ·æ­£åœ¨ä½¿ç”¨çš„**åŸŸ**ï¼Œæ˜¯æ—¶å€™å°è¯•æ‰¾åˆ°**æš´éœ²çš„ Azure æœåŠ¡**äº†ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨[**MicroBust**](https://github.com/NetSPI/MicroBurst)ä¸­çš„ä¸€ç§æ–¹æ³•æ¥å®ç°è¿™ä¸ªç›®æ ‡ã€‚æ­¤åŠŸèƒ½å°†åœ¨å‡ ä¸ª**Azure æœåŠ¡åŸŸ**ä¸­æœç´¢åŸºæœ¬åŸŸåï¼ˆä»¥åŠä¸€äº›æ’åˆ—ç»„åˆï¼‰ã€‚
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1 -Verbose
Invoke-EnumerateAzureSubDomains -Base corp -Verbose
```
## å¼€æ”¾å­˜å‚¨

æ‚¨å¯ä»¥ä½¿ç”¨è¯¸å¦‚[**InvokeEnumerateAzureBlobs.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Invoke-EnumerateAzureBlobs.ps1)ä¹‹ç±»çš„å·¥å…·ï¼Œè¯¥å·¥å…·å°†ä½¿ç”¨æ–‡ä»¶**`Microburst/Misc/permitations.txt`**ç”Ÿæˆæ’åˆ—ç»„åˆï¼ˆéå¸¸ç®€å•ï¼‰ï¼Œä»¥å°è¯•**æŸ¥æ‰¾å¼€æ”¾çš„å­˜å‚¨è´¦æˆ·**ã€‚
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base corp
[...]
https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
[...]

# Access https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
# Check: <Name>ssh_info.json</Name>
# Access then https://corpcommon.blob.core.windows.net/secrets/ssh_info.json
```
### SAS URLs

ä¸€ä¸ª**å…±äº«è®¿é—®ç­¾å**ï¼ˆSASï¼‰URLæ˜¯ä¸€ä¸ªURLï¼Œ**æä¾›å¯¹**å­˜å‚¨è´¦æˆ·çš„æŸä¸ªéƒ¨åˆ†çš„è®¿é—®æƒé™ï¼ˆå¯ä»¥æ˜¯å®Œæ•´å®¹å™¨ã€æ–‡ä»¶...ï¼‰ï¼Œå…·æœ‰ä¸€äº›ç‰¹å®šæƒé™ï¼ˆè¯»å–ã€å†™å…¥...ï¼‰æ¥è®¿é—®èµ„æºã€‚å¦‚æœå‘ç°æ³„æ¼äº†ä¸€ä¸ªï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿè®¿é—®æ•æ„Ÿä¿¡æ¯ï¼Œå®ƒä»¬çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆè¿™æ˜¯ç”¨äºè®¿é—®å®¹å™¨çš„ï¼Œå¦‚æœåªæ˜¯æˆäºˆå¯¹æ–‡ä»¶çš„è®¿é—®æƒé™ï¼ŒURLçš„è·¯å¾„ä¹Ÿå°†åŒ…å«è¯¥æ–‡ä»¶ï¼‰ï¼š

`https://<storage_account_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

ä½¿ç”¨[**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/)æ¥è®¿é—®æ•°æ®

## å±å®³å‡­è¯

### é’“é±¼

* [**å¸¸è§é’“é±¼**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology)ï¼ˆå‡­è¯æˆ–OAuthåº”ç”¨ -[éæ³•åŒæ„æˆäºˆæ”»å‡»](az-illicit-consent-grant.md)-ï¼‰
* [**è®¾å¤‡ä»£ç è®¤è¯** é’“é±¼](az-device-code-authentication-phishing.md)

### å¯†ç å–·æ´’ / æš´åŠ›ç ´è§£

{% content-ref url="az-password-spraying.md" %}
[az-password-spraying.md](az-password-spraying.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://aadinternals.com/post/just-looking/](https://aadinternals.com/post/just-looking/)
* [https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/](https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
