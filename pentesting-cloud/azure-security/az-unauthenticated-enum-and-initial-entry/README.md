# Az - ì¸ì¦ë˜ì§€ ì•Šì€ Enum ë° ì´ˆê¸° ì§„ì…

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ PDFë¡œ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [telegram ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## Azure í…Œë„ŒíŠ¸

### í…Œë„ŒíŠ¸ ì—´ê±°

**í…Œë„ŒíŠ¸ì˜ ë„ë©”ì¸**ì„ ì•Œê³  ìˆëŠ” ê³µê²©ìëŠ” **ì¼ë¶€ ê³µê°œ Azure API**ë¥¼ ì¿¼ë¦¬í•˜ì—¬ ë” ë§ì€ ì •ë³´ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
APIë¥¼ ì§ì ‘ ì¿¼ë¦¬í•˜ê±°ë‚˜ PowerShell ë¼ì´ë¸ŒëŸ¬ë¦¬ [**AADInternals**](https://github.com/Gerenios/AADInternals)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

| API                                                                  | ì •ë³´                                                                                                                                                                                                                                                | AADInternals í•¨ìˆ˜                             |
| -------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | **í…Œë„ŒíŠ¸ IDë¥¼ í¬í•¨í•œ** **ë¡œê·¸ì¸ ì •ë³´**                                                                                                                                                                                                            | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | í…Œë„ŒíŠ¸ì˜ **ëª¨ë“  ë„ë©”ì¸**                                                                                                                                                                                                                         | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | <p><strong>í…Œë„ŒíŠ¸ì˜ ë¡œê·¸ì¸ ì •ë³´</strong>ë¥¼ í¬í•¨í•œ, í…Œë„ŒíŠ¸ ì´ë¦„ ë° ë„ë©”ì¸ <strong>ì¸ì¦ ìœ í˜•</strong>.<br><code>NameSpaceType</code>ì´ <strong><code>Managed</code></strong>ì¸ ê²½ìš°, <strong>AzureAD</strong>ê°€ ì‚¬ìš©ë¨.</p> | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | **ë°ìŠ¤í¬í†± SSO ì •ë³´**ë¥¼ í¬í•¨í•œ ë¡œê·¸ì¸ ì •ë³´                                                                                                                                                                                              | `Get-AADIntLoginInformation -UserName <UserName>` |

**AADInternals** ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ **í•œ ëª…ë ¹ì–´ë¡œ Azure í…Œë„ŒíŠ¸ì˜ ëª¨ë“  ì •ë³´ë¥¼ ì¿¼ë¦¬**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```
Azure í…Œë„ŒíŠ¸ ì •ë³´ì˜ ì¶œë ¥ ì˜ˆì‹œ:
```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          1937e3ab-38de-a735-a830-3075ea7e5b39
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```
í…Œë„ŒíŠ¸ì˜ ì´ë¦„, ID ë° "ë¸Œëœë“œ" ì´ë¦„ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ê´€ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ë°ìŠ¤í¬í†± ë‹¨ì¼ ë¡œê·¸ì¸(SSO)ì˜ ìƒíƒœ, ì¼ëª… [**Seamless SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso)ë„ í‘œì‹œë©ë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì´ í™œì„±í™”ë˜ë©´ í•´ë‹¹ ê¸°ëŠ¥ì„ í†µí•´ íŠ¹ì • ì‚¬ìš©ìì˜ ì¡´ì¬(ì—´ê±°)ë¥¼ ëŒ€ìƒ ì¡°ì§ ë‚´ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ ê²°ê³¼ì—ëŠ” ëŒ€ìƒ í…Œë„ŒíŠ¸ì™€ ê´€ë ¨ëœ ëª¨ë“  í™•ì¸ëœ ë„ë©”ì¸ì˜ ì´ë¦„ê³¼ í•´ë‹¹ ì‹ë³„ ìœ í˜•ì´ í‘œì‹œë©ë‹ˆë‹¤. ì—°í•© ë„ë©”ì¸ì˜ ê²½ìš° ì‚¬ìš© ì¤‘ì¸ ì‹ë³„ ê³µê¸‰ìì˜ ì™„ì „í•œ ì •ê·œ ë„ë©”ì¸ ì´ë¦„(FQDN)(ì¼ë°˜ì ìœ¼ë¡œ ADFS ì„œë²„)ë„ ê³µê°œë©ë‹ˆë‹¤. "MX" ì—´ì€ ì´ë©”ì¼ì´ Exchange Onlineìœ¼ë¡œ ë¼ìš°íŒ…ë˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ ì§€ì •í•˜ë©°, "SPF" ì—´ì€ Exchange Onlineì„ ì´ë©”ì¼ ë°œì‹ ìë¡œ ë‚˜ì—´í•©ë‹ˆë‹¤. í˜„ì¬ì˜ ì •ì°° ê¸°ëŠ¥ì€ SPF ë ˆì½”ë“œ ë‚´ì˜ "include" ë¬¸ì„ êµ¬ë¬¸ ë¶„ì„í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì˜ëª»ëœ ë¶€ì •ì  ê²°ê³¼ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒì„ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

### ì‚¬ìš©ì ì—´ê±°

í…Œë„ŒíŠ¸ ë‚´ì—ì„œ **ì‚¬ìš©ì ì´ë¦„ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” **ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ì**ë¥¼ í¬í•¨í•˜ë©°, ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ìì˜ ì‚¬ìš©ì ì´ë¦„ í˜•ì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```
<email>#EXT#@<tenant name>.onmicrosoft.com
```
ì‚¬ìš©ìì˜ ì´ë©”ì¼ ì£¼ì†ŒëŠ” " @"ê°€ ë°‘ì¤„ "_"ë¡œ ëŒ€ì²´ëœ ì‚¬ìš©ìì˜ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤.

[**AADInternals**](https://github.com/Gerenios/AADInternals)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```powershell
# Check does the user exist
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```
## ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±° ë° ì´ˆê¸° ì§„ì…

ì´ ì„¹ì…˜ì—ì„œëŠ” Azureì—ì„œ ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±° ë° ì´ˆê¸° ì§„ì…ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•©ë‹ˆë‹¤.

### Azure ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±°

1. **Azure Portal ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±°**: Azure Portalì— ëŒ€í•œ ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±°ë¥¼ ìˆ˜í–‰í•˜ì—¬ ì •ë³´ ìˆ˜ì§‘ ë° ê³µê²© í‘œë©´ì„ í™•ì¥í•©ë‹ˆë‹¤.
2. **Azure ì„œë¹„ìŠ¤ ì—´ê±°**: Azureì—ì„œ í˜¸ìŠ¤íŒ…ë˜ëŠ” ì„œë¹„ìŠ¤ ë° ë¦¬ì†ŒìŠ¤ë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•´ ì„œë¹„ìŠ¤ ì—´ê±°ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
3. **Azure AD ì‚¬ìš©ì ë° ê·¸ë£¹ ì—´ê±°**: Azure Active Directory(AD)ì—ì„œ ì‚¬ìš©ì ë° ê·¸ë£¹ì„ ì—´ê±°í•˜ì—¬ ê¶Œí•œ ìƒíƒœë¥¼ ì‹ë³„í•©ë‹ˆë‹¤.

### Azure ì´ˆê¸° ì§„ì…

1. **Azure Portal ì•”í˜¸ ì¬ì„¤ì •**: Azure Portalì— ëŒ€í•œ ì•”í˜¸ë¥¼ ì¬ì„¤ì •í•˜ì—¬ ê³„ì • ì•¡ì„¸ìŠ¤ë¥¼ íšë“¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2. **Azure ì„œë¹„ìŠ¤ ì•”í˜¸ ì¬ì„¤ì •**: Azureì—ì„œ í˜¸ìŠ¤íŒ…ë˜ëŠ” ì„œë¹„ìŠ¤ì˜ ì•”í˜¸ë¥¼ ì¬ì„¤ì •í•˜ì—¬ ì„œë¹„ìŠ¤ ì•¡ì„¸ìŠ¤ë¥¼ íšë“¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. **Azure AD ì‚¬ìš©ì ì•”í˜¸ ì¬ì„¤ì •**: Azure AD ì‚¬ìš©ìì˜ ì•”í˜¸ë¥¼ ì¬ì„¤ì •í•˜ì—¬ ì‚¬ìš©ì ê³„ì •ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
UserName         Exists
--------         ------
user@company.com True
```
ë‹¹ì‹ ì€ ê° í–‰ì— í•˜ë‚˜ì˜ ì´ë©”ì¼ ì£¼ì†Œê°€ í¬í•¨ëœ í…ìŠ¤íŠ¸ íŒŒì¼ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:
```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# Invoke user enumeration
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
**ì„¸ ê°€ì§€ ë‹¤ë¥¸ ì—´ê±° ë°©ë²•**ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

| ë°©ë²•      | ì„¤ëª…                                                                                                                                                                                                   |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Normal    | ìœ„ì—ì„œ ì–¸ê¸‰í•œ GetCredentialType APIë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤. ê¸°ë³¸ ë°©ë²•ì…ë‹ˆë‹¤.                                                                                                                                      |
| Login     | <p>ì´ ë°©ë²•ì€ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸ì„ ì‹œë„í•©ë‹ˆë‹¤.<br><strong>ì°¸ê³ :</strong> ì¿¼ë¦¬ëŠ” ë¡œê·¸ì¸ ë¡œê·¸ì— ê¸°ë¡ë©ë‹ˆë‹¤.</p>                                                                                               |
| Autologon | <p>ì´ ë°©ë²•ì€ ì‚¬ìš©ìë¡œ ìë™ ë¡œê·¸ì˜¨ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ë¡œê·¸ì¸ì„ ì‹œë„í•©ë‹ˆë‹¤.<br><strong>ì¿¼ë¦¬ëŠ”</strong> ë¡œê·¸ì¸ ë¡œê·¸ì— ê¸°ë¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤! ë”°ë¼ì„œ, íŒ¨ìŠ¤ì›Œë“œ ìŠ¤í”„ë ˆì´ ë° ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²©ì—ë„ ì˜ ì‘ë™í•©ë‹ˆë‹¤.</p> |

ìœ íš¨í•œ ì‚¬ìš©ì ì´ë¦„ì„ ë°œê²¬í•œ í›„ **ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´**ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```powershell
Get-AADIntLoginInformation -UserName root@corp.onmicrosoft.com
```
ìŠ¤í¬ë¦½íŠ¸ [**o365creeper**](https://github.com/LMGsec/o365creeper)ë¥¼ ì‚¬ìš©í•˜ë©´ **ì´ë©”ì¼ì´ ìœ íš¨í•œì§€** í™•ì¸í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
```powershell
# Put in emails.txt emails such as:
# - root@corp.onmicrosoft.com
python.exe .\o365creeper\o365creeper.py -f .\emails.txt -o validemails.txt
```
**Microsoft Teamsë¥¼ í†µí•œ ì‚¬ìš©ì ì—´ê±°**

ë‹¤ë¥¸ ìœ ìš©í•œ ì •ë³´ì›ì€ Microsoft Teamsì…ë‹ˆë‹¤.

Microsoft Teamsì˜ APIë¥¼ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ìë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ "ì‚¬ìš©ì ê²€ìƒ‰" ì—”ë“œí¬ì¸íŠ¸ **externalsearchv3** ë° **searchUsers**ë¥¼ ì‚¬ìš©í•˜ì—¬ Teamsì— ë“±ë¡ëœ ì‚¬ìš©ì ê³„ì •ì— ëŒ€í•œ ì¼ë°˜ ì •ë³´ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

API ì‘ë‹µì— ë”°ë¼ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì™€ ìœ íš¨í•œ Teams êµ¬ë…ì„ ê°€ì§„ ê¸°ì¡´ ì‚¬ìš©ìë¥¼ êµ¬ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[**TeamsEnum**](https://github.com/sse-secure-systems/TeamsEnum) ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì£¼ì–´ì§„ ì‚¬ìš©ì ì´ë¦„ ì§‘í•©ì„ Teams APIì— ëŒ€í•´ ìœ íš¨ì„±ì„ ê²€ì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
python3 TeamsEnum.py -a password -u <username> -f inputlist.txt -o teamsenum-output.json
```
## ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±° ë° ì´ˆê¸° ì§„ì…

ì´ ì„¹ì…˜ì—ì„œëŠ” Azure í™˜ê²½ì—ì„œ ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±° ë° ì´ˆê¸° ì§„ì…ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê³µê²©ì€ Azure í™˜ê²½ì—ì„œ ë³´ì•ˆ ì·¨ì•½ì ì„ ì‹ë³„í•˜ê³  ì•…ìš©í•˜ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì„œë¹„ìŠ¤ ë° ë¦¬ì†ŒìŠ¤ ì—´ê±°

Azureì—ì„œëŠ” ì¸ì¦ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œë„ ì„œë¹„ìŠ¤ ë° ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í™˜ê²½ì„ ë” ì˜ ì´í•´í•˜ê³  ì¶”ê°€ì ì¸ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì´ˆê¸° ì§„ì…

ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±°ë¥¼ í†µí•´ ìˆ˜ì§‘í•œ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ˆê¸° ì§„ì…ì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Azure í™˜ê²½ì—ì„œ ì•½ì ì„ ì°¾ì•„ ê³µê²©ìê°€ ì‹œìŠ¤í…œì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ê³µê²©ì€ ì‹ ì¤‘í•˜ê²Œ ê³„íšë˜ê³  ìˆ˜í–‰ë˜ì–´ì•¼ í•˜ë©° í•­ìƒ ë²•ì ì¸ ê¶Œí•œì„ ì¤€ìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤.
```
[-] user1@domain - Target user not found. Either the user does not exist, is not Teams-enrolled or is configured to not appear in search results (personal accounts only)
[+] user2@domain - User2 | Company (Away, Mobile)
[+] user3@domain - User3 | Company (Available, Desktop)
```
ë˜í•œ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ì¡´ ì‚¬ìš©ìì˜ ê°€ìš©ì„± ì •ë³´ë¥¼ ì—´ëŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- Available
- Away
- DoNotDisturb
- Busy
- Offline

**ì—…ë¬´ ì™¸ ë©”ì‹œì§€**ê°€ êµ¬ì„±ë˜ì–´ ìˆëŠ” ê²½ìš°, TeamsEnumì„ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ê²€ìƒ‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì¶œë ¥ íŒŒì¼ì´ ì§€ì •ëœ ê²½ìš°, ì—…ë¬´ ì™¸ ë©”ì‹œì§€ëŠ” ìë™ìœ¼ë¡œ JSON íŒŒì¼ì— ì €ì¥ë©ë‹ˆë‹¤:
```
jq . teamsenum-output.json
```
## ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±° ë° ì´ˆê¸° ì§„ì…

ì´ ì„¹ì…˜ì—ì„œëŠ” Azureì—ì„œ ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±° ë° ì´ˆê¸° ì§„ì…ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•©ë‹ˆë‹¤.

### ì„œë¹„ìŠ¤ ì—´ê±°

Azureì—ì„œëŠ” ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ê°€ í˜¸ìŠ¤íŒ…ë˜ë©°, ì´ëŸ¬í•œ ì„œë¹„ìŠ¤ë¥¼ ì‹ë³„í•˜ê³  ì—´ê±°í•˜ëŠ” ê²ƒì€ ê³µê²© í‘œë©´ì„ í™•ì¥í•˜ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë„êµ¬ ë° ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ Azureì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ì—´ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¯¸ì¸ì¦ Blob ìŠ¤í† ë¦¬ì§€ ì—‘ì„¸ìŠ¤

Azure Blob ìŠ¤í† ë¦¬ì§€ëŠ” ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©° ì¢…ì¢… ì¤‘ìš”í•œ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ë¯¸ì¸ì¦ Blob ìŠ¤í† ë¦¬ì§€ ì—‘ì„¸ìŠ¤ë¥¼ ì°¾ìœ¼ë©´ ë°ì´í„° ìœ ì¶œì˜ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.

### ë¯¸ì¸ì¦ SQL ë°ì´í„°ë² ì´ìŠ¤ ì•¡ì„¸ìŠ¤

Azure SQL ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì¤‘ìš”í•œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ë¯¸ì¸ì¦ SQL ë°ì´í„°ë² ì´ìŠ¤ ì•¡ì„¸ìŠ¤ë¥¼ ì°¾ìœ¼ë©´ ë°ì´í„° ìœ ì¶œ ë° ë°ì´í„°ë² ì´ìŠ¤ ì¡°ì‘ì˜ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.

### ë¯¸ì¸ì¦ ì•± ì„œë¹„ìŠ¤ ì—‘ì„¸ìŠ¤

Azure ì•± ì„œë¹„ìŠ¤ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í˜¸ìŠ¤íŒ…í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ë¯¸ì¸ì¦ ì•± ì„œë¹„ìŠ¤ ì—‘ì„¸ìŠ¤ë¥¼ ì°¾ìœ¼ë©´ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì·¨ì•½ì ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë¯¸ì¸ì¦ ê°€ìƒ ë¨¸ì‹  ì•¡ì„¸ìŠ¤

Azure ê°€ìƒ ë¨¸ì‹ ì€ ì¤‘ìš”í•œ ì›Œí¬ë¡œë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ë¯¸ì¸ì¦ ê°€ìƒ ë¨¸ì‹  ì•¡ì„¸ìŠ¤ë¥¼ ì°¾ìœ¼ë©´ ì‹œìŠ¤í…œì„ ì†ìƒì‹œí‚¤ê±°ë‚˜ ì¤‘ìš”í•œ ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```json
{
"email": "user2@domain",
"exists": true,
"info": [
{
"tenantId": "[REDACTED]",
"isShortProfile": false,
"accountEnabled": true,
"featureSettings": {
"coExistenceMode": "TeamsOnly"
},
"userPrincipalName": "user2@domain",
"givenName": "user2@domain",
"surname": "",
"email": "user2@domain",
"tenantName": "Company",
"displayName": "User2",
"type": "Federated",
"mri": "8:orgid:[REDACTED]",
"objectId": "[REDACTED]"
}
],
"presence": [
{
"mri": "8:orgid:[REDACTED]",
"presence": {
"sourceNetwork": "Federated",
"calendarData": {
"outOfOfficeNote": {
"message": "Dear sender. I am out of the office until March 23rd with limited access to my email. I will respond after my return.Kind regards, User2",
"publishTime": "2023-03-15T21:44:42.0649385Z",
"expiry": "2023-04-05T14:00:00Z"
},
"isOutOfOffice": true
},
"capabilities": [
"Audio",
"Video"
],
"availability": "Away",
"activity": "Away",
"deviceType": "Mobile"
},
"etagMatch": false,
"etag": "[REDACTED]",
"status": 20000
}
]
}
```
## Azure Services

ì´ì œ Azure í…Œë„ŒíŠ¸ê°€ ì‚¬ìš©í•˜ëŠ” **ë„ë©”ì¸ì„ ì•Œì•˜ìœ¼ë¯€ë¡œ** ë…¸ì¶œëœ **Azure ì„œë¹„ìŠ¤ë¥¼ ì°¾ì•„ë³´ëŠ” ì‹œê°„**ì…ë‹ˆë‹¤.

ì´ëŸ¬í•œ ëª©í‘œë¥¼ ìœ„í•´ [**MicroBust**](https://github.com/NetSPI/MicroBurst)ì˜ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” **ì—¬ëŸ¬ Azure ì„œë¹„ìŠ¤ ë„ë©”ì¸**ì—ì„œ ê¸°ë³¸ ë„ë©”ì¸ ì´ë¦„ (ë° ëª‡ ê°€ì§€ ìˆœì—´)ì„ ê²€ìƒ‰í•  ê²ƒì…ë‹ˆë‹¤:
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1 -Verbose
Invoke-EnumerateAzureSubDomains -Base corp -Verbose
```
## ì˜¤í”ˆ ìŠ¤í† ë¦¬ì§€

[**InvokeEnumerateAzureBlobs.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Invoke-EnumerateAzureBlobs.ps1)ì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¤í”ˆ ìŠ¤í† ë¦¬ì§€ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë„êµ¬ëŠ” **`Microburst/Misc/permitations.txt`** íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•œ ìˆœì—´ì„ ìƒì„±í•˜ì—¬ **ì˜¤í”ˆ ìŠ¤í† ë¦¬ì§€ ê³„ì •ì„ ì°¾ìœ¼ë ¤ê³ ** ì‹œë„í•©ë‹ˆë‹¤.
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base corp
[...]
https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
[...]

# Access https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
# Check: <Name>ssh_info.json</Name>
# Access then https://corpcommon.blob.core.windows.net/secrets/ssh_info.json
```
### SAS URLs

_**ê³µìœ  ì•¡ì„¸ìŠ¤ ì„œëª…**_ (SAS) URLì€ **íŠ¹ì • ìŠ¤í† ë¦¬ì§€ ê³„ì •ì˜ ì¼ë¶€** (ì „ì²´ ì»¨í…Œì´ë„ˆ, íŒŒì¼ ë“±)ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” URLì´ë©° íŠ¹ì • ê¶Œí•œ (ì½ê¸°, ì“°ê¸° ë“±)ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ìœ ì¶œëœ ê²ƒì„ ë°œê²¬í•˜ë©´ ë¯¼ê°í•œ ì •ë³´ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ë³´ì…ë‹ˆë‹¤ (ì´ê²ƒì€ ì»¨í…Œì´ë„ˆì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•œ ê²ƒì´ë©° íŒŒì¼ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ë¶€ì—¬í•˜ëŠ” ê²½ìš° URLì˜ ê²½ë¡œì—ë„ í•´ë‹¹ íŒŒì¼ì´ í¬í•¨ë  ê²ƒì…ë‹ˆë‹¤):

`https://<storage_account_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

[**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•©ë‹ˆë‹¤

## ìê²© ì¦ëª… ì¹¨í•´

### í”¼ì‹±

* [**ì¼ë°˜ í”¼ì‹±**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (ìê²© ì¦ëª… ë˜ëŠ” OAuth ì•± -[ë¶ˆë²• ë™ì˜ ë¶€ì—¬ ê³µê²©](az-illicit-consent-grant.md)-)
* [**ì¥ì¹˜ ì½”ë“œ ì¸ì¦** í”¼ì‹±](az-device-code-authentication-phishing.md)

### íŒ¨ìŠ¤ì›Œë“œ ìŠ¤í”„ë ˆì´ / ë¸Œë£¨íŠ¸í¬ìŠ¤

{% content-ref url="az-password-spraying.md" %}
[az-password-spraying.md](az-password-spraying.md)
{% endcontent-ref %}

## ì°¸ê³  ìë£Œ

* [https://aadinternals.com/post/just-looking/](https://aadinternals.com/post/just-looking/)
* [https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/](https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ë¥¼ í†µí•´ ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜**íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **HackTricks ë° HackTricks Cloud** ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
