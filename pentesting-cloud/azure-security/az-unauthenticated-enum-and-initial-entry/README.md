# Az - èªè¨¼ã•ã‚Œã¦ã„ãªã„åˆ—æŒ™ã¨åˆæœŸã‚¨ãƒ³ãƒˆãƒªãƒ¼

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å¾—ã‚‹ï¼</strong></summary>

* **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„**å ´åˆã‚„ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹ã—ãŸã„**å ´åˆã€ã¾ãŸã¯HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ã”è¦§ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>

## Azureãƒ†ãƒŠãƒ³ãƒˆ

### ãƒ†ãƒŠãƒ³ãƒˆã®åˆ—æŒ™

**ãƒ†ãƒŠãƒ³ãƒˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³**ã‚’çŸ¥ã£ã¦ã„ã‚‹ã ã‘ã§ã€æ”»æ’ƒè€…ã¯ã‚ˆã‚Šè©³ç´°ãªæƒ…å ±ã‚’åé›†ã™ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®**å…¬é–‹Azure API**ã‚’ã‚¯ã‚¨ãƒªã§ãã¾ã™ã€‚\
APIã‚’ç›´æ¥ã‚¯ã‚¨ãƒªã™ã‚‹ã‹ã€PowerShellãƒ©ã‚¤ãƒ–ãƒ©ãƒª[**AADInternals**](https://github.com/Gerenios/AADInternals)ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

| API                                                                  | æƒ…å ±                                                                                          | AADInternalsã®é–¢æ•°                                |
| -------------------------------------------------------------------- | -------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | ãƒ†ãƒŠãƒ³ãƒˆIDã‚’å«ã‚€**ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±**                                                             | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | ãƒ†ãƒŠãƒ³ãƒˆã®**ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³**                                                               | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | ãƒ†ãƒŠãƒ³ãƒˆã®**ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±**ã€ãƒ†ãƒŠãƒ³ãƒˆåã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã®**èªè¨¼ã‚¿ã‚¤ãƒ—**ã‚’å«ã‚€                        | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | **ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—SSOæƒ…å ±**ã‚’å«ã‚€ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±                                                   | `Get-AADIntLoginInformation -UserName <UserName>` |

**AADInternals**ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®**1ã¤ã®ã‚³ãƒãƒ³ãƒ‰ã ã‘ã§**ã€Azureãƒ†ãƒŠãƒ³ãƒˆã®ã™ã¹ã¦ã®æƒ…å ±ã‚’ã‚¯ã‚¨ãƒªã§ãã¾ã™ã€‚
```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```
Azureãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã®å‡ºåŠ›ä¾‹ï¼š
```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          05aea22e-32f3-4c35-831b-52735704feb3
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```
ä»¥ä¸‹ã®å‡ºåŠ›ã‹ã‚‰ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆçµ„ç¹”ã®ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ãŒã‚ã‹ã‚Šã¾ã™ã€‚ãƒ†ãƒŠãƒ³ãƒˆåã€IDã€ãŠã‚ˆã³ã€Œãƒ–ãƒ©ãƒ³ãƒ‰ã€åãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸã€**ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—SSOï¼ˆåˆ¥å** [**Seamless SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso)**ï¼‰ãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã‚‚ç¢ºèªã§ãã¾ã™**ã€‚æœ‰åŠ¹ãªå ´åˆã€æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆçµ„ç¹”ã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ—æŒ™ï¼‰ã‚’ç¢ºèªã§ãã¾ã™ã€‚

ã¾ãŸã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ†ãƒŠãƒ³ãƒˆã®ã™ã¹ã¦ã®ï¼ˆç¢ºèªæ¸ˆã¿ã®ï¼‰ãƒ‰ãƒ¡ã‚¤ãƒ³åã¨ãã®è­˜åˆ¥ã‚¿ã‚¤ãƒ—ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å ´åˆã€ä½¿ç”¨ã•ã‚Œã‚‹ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆé€šå¸¸ã¯ADFSã‚µãƒ¼ãƒãƒ¼ï¼‰ã®FQDNã‚‚è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚MXåˆ—ã¯ã€ãƒ¡ãƒ¼ãƒ«ãŒExchange Onlineã«é€ä¿¡ã•ã‚Œã‚‹ã‹ã©ã†ã‹ã‚’ç¤ºã—ã¾ã™ã€‚SPFåˆ—ã¯ã€Exchange OnlineãŒãƒ¡ãƒ¼ãƒ«é€ä¿¡è€…ã¨ã—ã¦ãƒªã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¤ºã—ã¾ã™ã€‚**æ³¨æ„ï¼**ç¾åœ¨ã€å†å¸°é–¢æ•°ã¯SPFãƒ¬ã‚³ãƒ¼ãƒ‰ã®includeã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’è¿½è·¡ã—ã¦ã„ãªã„ãŸã‚ã€èª¤æ¤œå‡ºãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

### ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ—æŒ™

ãƒ†ãƒŠãƒ³ãƒˆå†…ã«ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’**ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™**ã€‚ã“ã‚Œã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒæ¬¡ã®å½¢å¼ã§ã‚ã‚‹ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚å«ã¾ã‚Œã¾ã™ï¼š
```
<email>#EXT#@<tenant name>.onmicrosoft.com
```
ãƒ¡ãƒ¼ãƒ«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã€"@"ãŒã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢"_"ã«ç½®ãæ›ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

[**AADInternals**](https://github.com/Gerenios/AADInternals)ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç°¡å˜ã«ç¢ºèªã§ãã¾ã™ã€‚
```powershell
# Check does the user exist
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```
# Azure Unauthenticated Enumeration and Initial Entry

This document outlines various techniques for enumerating and gaining initial access to Azure resources without authentication.

## Table of Contents

- [Introduction](#introduction)
- [Enumeration Techniques](#enumeration-techniques)
  - [Azure Resource Manager (ARM) API](#azure-resource-manager-arm-api)
  - [Azure Active Directory (AAD) Graph API](#azure-active-directory-aad-graph-api)
  - [Azure Storage Account Enumeration](#azure-storage-account-enumeration)
  - [Azure Key Vault Enumeration](#azure-key-vault-enumeration)
- [Initial Entry Techniques](#initial-entry-techniques)
  - [Weak or Default Credentials](#weak-or-default-credentials)
  - [Azure Functions](#azure-functions)
  - [Azure Logic Apps](#azure-logic-apps)
  - [Azure Container Instances](#azure-container-instances)
  - [Azure App Service](#azure-app-service)
  - [Azure Virtual Machines](#azure-virtual-machines)
  - [Azure Kubernetes Service (AKS)](#azure-kubernetes-service-aks)
  - [Azure Batch](#azure-batch)
  - [Azure Service Fabric](#azure-service-fabric)
  - [Azure SQL Database](#azure-sql-database)
  - [Azure Cosmos DB](#azure-cosmos-db)
  - [Azure SignalR Service](#azure-signalr-service)
  - [Azure Event Grid](#azure-event-grid)
  - [Azure Event Hubs](#azure-event-hubs)
  - [Azure Relay](#azure-relay)
  - [Azure API Management](#azure-api-management)
  - [Azure IoT Hub](#azure-iot-hub)
  - [Azure Media Services](#azure-media-services)
  - [Azure Search](#azure-search)
  - [Azure Cognitive Services](#azure-cognitive-services)
  - [Azure Databricks](#azure-databricks)
  - [Azure Data Lake Storage](#azure-data-lake-storage)
  - [Azure HDInsight](#azure-hdinsight)
  - [Azure Machine Learning](#azure-machine-learning)
  - [Azure DevOps](#azure-devops)
  - [Azure Functions Proxies](#azure-functions-proxies)
  - [Azure Front Door](#azure-front-door)
  - [Azure Traffic Manager](#azure-traffic-manager)
  - [Azure CDN](#azure-cdn)
  - [Azure DNS](#azure-dns)
  - [Azure Active Directory B2C](#azure-active-directory-b2c)
  - [Azure Active Directory Domain Services](#azure-active-directory-domain-services)
  - [Azure Active Directory Privileged Identity Management](#azure-active-directory-privileged-identity-management)
  - [Azure Active Directory Identity Protection](#azure-active-directory-identity-protection)
  - [Azure Active Directory External Identities](#azure-active-directory-external-identities)
  - [Azure Active Directory Managed Identities](#azure-active-directory-managed-identities)
  - [Azure Active Directory Conditional Access](#azure-active-directory-conditional-access)
  - [Azure Active Directory Identity Governance](#azure-active-directory-identity-governance)
  - [Azure Active Directory Access Reviews](#azure-active-directory-access-reviews)
  - [Azure Active Directory Privileged Access Management](#azure-active-directory-privileged-access-management)
  - [Azure Active Directory Identity Experience Framework](#azure-active-directory-identity-experience-framework)
  - [Azure Active Directory Connect](#azure-active-directory-connect)
  - [Azure Active Directory Seamless Single Sign-On](#azure-active-directory-seamless-single-sign-on)
  - [Azure Active Directory Password Protection](#azure-active-directory-password-protection)
  - [Azure Active Directory Multi-Factor Authentication](#azure-active-directory-multi-factor-authentication)
  - [Azure Active Directory Application Proxy](#azure-active-directory-application-proxy)
  - [Azure Active Directory Domain Join](#azure-active-directory-domain-join)
  - [Azure Active Directory Domain Services Join](#azure-active-directory-domain-services-join)
  - [Azure Active Directory Domain Services Password Reset](#azure-active-directory-domain-services-password-reset)
  - [Azure Active Directory Domain Services Replication](#azure-active-directory-domain-services-replication)
  - [Azure Active Directory Domain Services Health Monitoring](#azure-active-directory-domain-services-health-monitoring)
  - [Azure Active Directory Domain Services Backup and Restore](#azure-active-directory-domain-services-backup-and-restore)
  - [Azure Active Directory Domain Services Secure LDAP](#azure-active-directory-domain-services-secure-ldap)
  - [Azure Active Directory Domain Services Group Policy](#azure-active-directory-domain-services-group-policy)
  - [Azure Active Directory Domain Services Kerberos](#azure-active-directory-domain-services-kerberos)
  - [Azure Active Directory Domain Services LDAP](#azure-active-directory-domain-services-ldap)
  - [Azure Active Directory Domain Services DNS](#azure-active-directory-domain-services-dns)
  - [Azure Active Directory Domain Services NTLM](#azure-active-directory-domain-services-ntlm)
  - [Azure Active Directory Domain Services Password Hash Synchronization](#azure-active-directory-domain-services-password-hash-synchronization)
  - [Azure Active Directory Domain Services Password Writeback](#azure-active-directory-domain-services-password-writeback)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Seamless Single Sign-On](#azure-active-directory-domain-services-password-hash-synchronization-and-seamless-single-sign-on)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection and Multi-Factor Authentication](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection-and-multi-factor-authentication)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection and Multi-Factor Authentication and Conditional Access](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection-and-multi-factor-authentication-and-conditional-access)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-man
```
UserName         Exists
--------         ------
user@company.com True
```
ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚å„è¡Œã«ã¯1ã¤ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# Invoke user enumeration
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
æ¬¡ã®3ã¤ã®åˆ—æŒ™æ–¹æ³•ã‹ã‚‰é¸æŠã§ãã¾ã™ï¼š

| æ–¹æ³•       | èª¬æ˜                                                                                                                                                                                                 |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| é€šå¸¸       | ä¸Šè¨˜ã§è¨€åŠã•ã‚ŒãŸGetCredentialType APIã‚’æŒ‡ã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ–¹æ³•ã§ã™ã€‚                                                                                                                           |
| ãƒ­ã‚°ã‚¤ãƒ³    | <p>ã“ã®æ–¹æ³•ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã‚’è©¦ã¿ã¾ã™ã€‚<br><strong>æ³¨æ„ï¼š</strong>ã‚¯ã‚¨ãƒªã¯ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚</p>                                                                                       |
| è‡ªå‹•ãƒ­ã‚°ã‚ªãƒ³ | <p>ã“ã®æ–¹æ³•ã§ã¯ã€è‡ªå‹•ãƒ­ã‚°ã‚ªãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä»‹ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã‚’è©¦ã¿ã¾ã™ã€‚<br><strong>ã‚¯ã‚¨ãƒªã¯ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¾ã›ã‚“</strong>ã€‚ãã®ãŸã‚ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ—ãƒ¬ãƒ¼ãŠã‚ˆã³ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒã«ã‚‚é©ã—ã¦ã„ã¾ã™ã€‚</p> |

æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ç™ºè¦‹ã—ãŸå¾Œã€æ¬¡ã®ã‚ˆã†ã«**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢ã™ã‚‹æƒ…å ±**ã‚’å–å¾—ã§ãã¾ã™ï¼š
```powershell
Get-AADIntLoginInformation -UserName root@corp.onmicrosoft.com
```
ã‚¹ã‚¯ãƒªãƒ—ãƒˆ[o365creeper](https://github.com/LMGsec/o365creeper)ã¯ã€**ãƒ¡ãƒ¼ãƒ«ãŒæœ‰åŠ¹ã‹ã©ã†ã‹**ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
```powershell
# Put in emails.txt emails such as:
# - root@corp.onmicrosoft.com
python.exe .\o365creeper\o365creeper.py -f .\emails.txt -o validemails.txt
```
## Azure ã‚µãƒ¼ãƒ“ã‚¹

Azure ãƒ†ãƒŠãƒ³ãƒˆãŒä½¿ç”¨ã—ã¦ã„ã‚‹**ãƒ‰ãƒ¡ã‚¤ãƒ³**ã‚’çŸ¥ã£ãŸã®ã§ã€**å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ Azure ã‚µãƒ¼ãƒ“ã‚¹**ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã«è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã“ã®ç›®æ¨™ã‚’é”æˆã™ã‚‹ãŸã‚ã«ã€[**MicroBurst**](https://github.com/NetSPI/MicroBurst)ã‹ã‚‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®é–¢æ•°ã¯ã€ã„ãã¤ã‹ã®**Azure ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³**ã§ãƒ™ãƒ¼ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³åï¼ˆãŠã‚ˆã³ã„ãã¤ã‹ã®å¤‰å½¢ï¼‰ã‚’æ¤œç´¢ã—ã¾ã™ã€‚
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1 -Verbose
Invoke-EnumerateAzureSubDomains -Base corp -Verbose
```
## ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

[**InvokeEnumerateAzureBlobs.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Invoke-EnumerateAzureBlobs.ps1)ã®ã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ç™ºè¦‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«**`Microburst/Misc/permitations.txt`**ã‚’ä½¿ç”¨ã—ã¦ã€å˜ç´”ãªãƒ‘ãƒ¼ãƒŸãƒ¥ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã—ã€**ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚ˆã†ã¨ã—ã¾ã™**ã€‚
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base corp
[...]
https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
[...]

# Access https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
# Check: <Name>ssh_info.json</Name>
# Access then https://corpcommon.blob.core.windows.net/secrets/ssh_info.json
```
### SAS URLs

_**å…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ç½²å**_ï¼ˆSASï¼‰URLã¯ã€ç‰¹å®šã®ãƒ‘ãƒ¼ãƒ„ï¼ˆãƒ•ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã€ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ï¼‰ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã™ã‚‹URLã§ã‚ã‚Šã€ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹ç‰¹å®šã®æ¨©é™ï¼ˆèª­ã¿å–ã‚Šã€æ›¸ãè¾¼ã¿ãªã©ï¼‰ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã‚‚ã—ã‚‚æ¼æ´©ã—ã¦ã„ã‚‹URLã‚’è¦‹ã¤ã‘ãŸå ´åˆã€æ©Ÿå¯†æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã¯ãã®ä¾‹ã§ã™ï¼ˆã“ã‚Œã¯ã‚³ãƒ³ãƒ†ãƒŠã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã®ãŸã‚ã®ã‚‚ã®ã§ã‚ã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹å ´åˆã€URLã®ãƒ‘ã‚¹ã«ã‚‚ãã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¾ã™ï¼‰ï¼š

`https://<storage_account_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«[**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/)ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

## èªè¨¼æƒ…å ±ã®ä¾µå®³

### ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°

* [**ä¸€èˆ¬çš„ãªãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology)ï¼ˆè³‡æ ¼æƒ…å ±ã¾ãŸã¯OAuthã‚¢ãƒ—ãƒª -[ä¸æ­£ãªåŒæ„ä»˜ä¸æ”»æ’ƒ](az-illicit-consent-grant.md)-ï¼‰
* [**ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ¼ãƒ‰èªè¨¼**ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°](az-device-code-authentication-phishing.md)

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ—ãƒ¬ãƒ¼/ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹

{% content-ref url="az-password-spraying.md" %}
[az-password-spraying.md](az-password-spraying.md)
{% endcontent-ref %}

## å‚è€ƒæ–‡çŒ®

* [https://o365blog.com/post/just-looking/](https://o365blog.com/post/just-looking/)

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å—ã‘å–ã‚ã†ï¼</strong></summary>

* ã‚‚ã—ã‚‚ã‚ãªãŸã®**ä¼šç¤¾ã‚’ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚¹ã§å®£ä¼ã—ãŸã„**å ´åˆã‚„ã€**æœ€æ–°ç‰ˆã®PEASSã‚’å…¥æ‰‹ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™ºè¦‹ã—ã¾ã—ã‚‡ã†ã€‚
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€PRã‚’** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ã¨** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
