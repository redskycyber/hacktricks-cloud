# Az - åŠ¨æ€ç»„æƒé™æå‡

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## åŸºæœ¬ä¿¡æ¯

**åŠ¨æ€ç»„**æ˜¯é…ç½®äº†ä¸€ç»„**è§„åˆ™**çš„ç»„ï¼Œæ‰€æœ‰ç¬¦åˆè§„åˆ™çš„**ç”¨æˆ·æˆ–è®¾å¤‡**éƒ½ä¼šè¢«æ·»åŠ åˆ°è¯¥ç»„ã€‚æ¯å½“ç”¨æˆ·æˆ–è®¾å¤‡çš„**å±æ€§**å‘ç”Ÿ**å˜åŒ–**æ—¶ï¼Œéƒ½ä¼šé‡æ–°æ£€æŸ¥åŠ¨æ€è§„åˆ™ã€‚å½“åˆ›å»º**æ–°è§„åˆ™**æ—¶ï¼Œä¼šæ£€æŸ¥æ‰€æœ‰è®¾å¤‡å’Œç”¨æˆ·ã€‚

åŠ¨æ€ç»„å¯ä»¥åˆ†é…**Azure RBACè§’è‰²**ï¼Œä½†**ä¸å¯èƒ½**å°†**AzureADè§’è‰²**æ·»åŠ åˆ°åŠ¨æ€ç»„ã€‚

æ­¤åŠŸèƒ½éœ€è¦Azure AD premium P1è®¸å¯è¯ã€‚

## æƒé™æå‡

è¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥åœ¨Azure ADä¸­é‚€è¯·è®¿å®¢ï¼Œå› æ­¤ï¼Œå¦‚æœåŠ¨æ€ç»„**è§„åˆ™**æ ¹æ®å¯ä»¥åœ¨æ–°**è®¿å®¢**ä¸­**è®¾ç½®**çš„**å±æ€§**ç»™äºˆç”¨æˆ·**æƒé™**ï¼Œåˆ™å¯ä»¥**åˆ›å»º**å…·æœ‰è¿™äº›å±æ€§çš„è®¿å®¢å¹¶**æå‡æƒé™**ã€‚è®¿å®¢ä¹Ÿå¯ä»¥ç®¡ç†ä»–è‡ªå·±çš„ä¸ªäººèµ„æ–™å¹¶æ›´æ”¹è¿™äº›å±æ€§ã€‚

è·å–å…è®¸åŠ¨æ€æˆå‘˜èµ„æ ¼çš„ç»„ï¼š`Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### ç¤ºä¾‹

* **è§„åˆ™ç¤ºä¾‹**ï¼š`(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **è§„åˆ™æè¿°**ï¼šä»»ä½•æ¬¡è¦ç”µå­é‚®ä»¶åŒ…å«å­—ç¬¦ä¸²'tester'çš„è®¿å®¢ç”¨æˆ·éƒ½å°†è¢«æ·»åŠ åˆ°è¯¥ç»„

1. è½¬åˆ° **Azure Active Directory** -> **ç”¨æˆ·** å¹¶**ç‚¹å‡»** `æƒ³è¦åˆ‡æ¢å›æ—§ç‰ˆç”¨æˆ·åˆ—è¡¨ä½“éªŒå—ï¼Ÿç‚¹å‡»è¿™é‡Œç¦»å¼€é¢„è§ˆç‰ˆ`
2. ç‚¹å‡» **`æ–°è®¿å®¢ç”¨æˆ·`** å¹¶**é‚€è¯·**ä¸€ä¸ªç”µå­é‚®ä»¶
3. é‚€è¯·å‘é€åï¼Œ**ç”¨æˆ·çš„ä¸ªäººèµ„æ–™**å°†è¢«**æ·»åŠ **åˆ°Azure ADã€‚æ‰“å¼€ç”¨æˆ·çš„ä¸ªäººèµ„æ–™å¹¶**ç‚¹å‡»ï¼ˆç®¡ç†ï¼‰åœ¨é‚€è¯·æ¥å—ä¸‹é¢**ã€‚
* ![](<../../.gitbook/assets/image (87) (1).png>)
4. å°† **`é‡æ–°å‘é€é‚€è¯·ï¼Ÿ`** æ›´æ”¹ä¸º **æ˜¯**ï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªé‚€è¯·URLï¼š
* ![](<../../.gitbook/assets/image (11) (1) (2) (1).png>)
5. å¤åˆ¶**URL**å¹¶**æ‰“å¼€**å®ƒï¼Œ**ç™»å½•**ä¸ºè¢«é‚€è¯·çš„ç”¨æˆ·å¹¶**æ¥å—**é‚€è¯·
6.  **ç™»å½•** cliä½œä¸ºç”¨æˆ·å¹¶è®¾ç½®æ¬¡è¦ç”µå­é‚®ä»¶

{% code overflow="wrap" %}
```powershell
# ç™»å½•
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# æ›´æ”¹OtherMailsè®¾ç½®
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
{% endcode %}



## å‚è€ƒèµ„æ–™

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨å¸Œæœ›åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
