# Az - ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã‚‹æ¨©é™æ˜‡æ ¼

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ã§ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã™ã‚‹ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã™ã‚‹ã€‚
* **HackTricks**ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã™ã‚‹ã€‚

</details>

## åŸºæœ¬æƒ…å ±

**ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—**ã¯ã€ä¸€é€£ã®**ãƒ«ãƒ¼ãƒ«**ãŒè¨­å®šã•ã‚Œã¦ãŠã‚Šã€ãƒ«ãƒ¼ãƒ«ã«ä¸€è‡´ã™ã‚‹**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ãƒ‡ãƒã‚¤ã‚¹**ãŒã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„ãƒ‡ãƒã‚¤ã‚¹ã®**å±æ€§**ãŒ**å¤‰æ›´ã•ã‚Œã‚‹**ãŸã³ã«ã€ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ã¯**å†ãƒã‚§ãƒƒã‚¯**ã•ã‚Œã¾ã™ã€‚ãã—ã¦ã€**æ–°ã—ã„ãƒ«ãƒ¼ãƒ«**ãŒ**ä½œæˆã•ã‚Œã‚‹**ã¨ã€ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**ãƒã‚§ãƒƒã‚¯**ã•ã‚Œã¾ã™ã€‚

ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã«ã¯**Azure RBACãƒ­ãƒ¼ãƒ«ã‚’å‰²ã‚Šå½“ã¦ã‚‹**ã“ã¨ãŒã§ãã¾ã™ãŒã€ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã«**AzureADãƒ­ãƒ¼ãƒ«**ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã¯**ã§ãã¾ã›ã‚“**ã€‚

ã“ã®æ©Ÿèƒ½ã«ã¯Azure ADãƒ—ãƒ¬ãƒŸã‚¢ãƒ P1ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒå¿…è¦ã§ã™ã€‚

## æ¨©é™æ˜‡æ ¼

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAzure ADã«ã‚²ã‚¹ãƒˆã‚’æ‹›å¾…ã§ãã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã—ãŸãŒã£ã¦ã€ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®**ãƒ«ãƒ¼ãƒ«**ãŒæ–°ã—ã„**ã‚²ã‚¹ãƒˆ**ã«è¨­å®šã§ãã‚‹**å±æ€§**ã«åŸºã¥ã„ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«**æ¨©é™**ã‚’ä¸ãˆã‚‹å ´åˆã€ã“ã‚Œã‚‰ã®å±æ€§ã‚’æŒã¤**ã‚²ã‚¹ãƒˆã‚’ä½œæˆ**ã—ã¦**æ¨©é™ã‚’æ˜‡æ ¼**ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã¾ãŸã€ã‚²ã‚¹ãƒˆã¯è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã—ã€ã“ã‚Œã‚‰ã®å±æ€§ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ã‚’è¨±å¯ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å–å¾—ã™ã‚‹: `Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### ä¾‹

* **ãƒ«ãƒ¼ãƒ«ã®ä¾‹**: `(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **ãƒ«ãƒ¼ãƒ«ã®èª¬æ˜**: ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ¡ãƒ¼ãƒ«ã«'stranger'ã¨ã„ã†æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã•ã‚Œã¾ã™

1. **Azure Active Directory** -> **Users** ã«ç§»å‹•ã—ã€`Want to switch back to the legacy users list experience? Click here to leave the preview`ã‚’**ã‚¯ãƒªãƒƒã‚¯**ã—ã¾ã™ã€‚
2. **`New guest user`** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ãƒ¡ãƒ¼ãƒ«ã‚’**æ‹›å¾…**ã—ã¾ã™ã€‚
3. æ‹›å¾…ãŒé€ä¿¡ã•ã‚Œã‚‹ã¨ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«**ãŒAzure ADã«**è¿½åŠ **ã•ã‚Œã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€**æ‹›å¾…ã‚’å—ã‘å…¥ã‚ŒãŸä¸‹ã§(ç®¡ç†)ã‚’ã‚¯ãƒªãƒƒã‚¯**ã—ã¾ã™ã€‚
* ![](<../../.gitbook/assets/image (87) (1).png>)
4. **`Resend invite?`** ã‚’**Yes**ã«å¤‰æ›´ã™ã‚‹ã¨ã€æ‹›å¾…URLãŒå–å¾—ã§ãã¾ã™ï¼š
* ![](<../../.gitbook/assets/image (11) (1) (2) (1).png>)
5. **URL**ã‚’ã‚³ãƒ”ãƒ¼ã—ã€é–‹ã„ã¦ã€æ‹›å¾…ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦**ãƒ­ã‚°ã‚¤ãƒ³**ã—ã€æ‹›å¾…ã‚’**å—ã‘å…¥ã‚Œ**ã¾ã™ã€‚
6.  CLIã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦**ãƒ­ã‚°ã‚¤ãƒ³**ã—ã€ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ¡ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¾ã™ã€‚

{% code overflow="wrap" %}
```powershell
# ãƒ­ã‚°ã‚¤ãƒ³
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# OtherMailsã®è¨­å®šã‚’å¤‰æ›´
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
{% endcode %}



## å‚è€ƒæ–‡çŒ®

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ã§ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã™ã‚‹ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼**ã™ã‚‹ã€‚
* **HackTricks**ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã™ã‚‹ã€‚

</details>
