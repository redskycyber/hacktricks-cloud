# Az - Podstawowe informacje

<details>

<summary><strong>Zacznij od zera i staÅ„ siÄ™ ekspertem w hakowaniu AWS dziÄ™ki</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>

## Hierarchia Organizacyjna

<figure><img src="../../.gitbook/assets/image (271).png" alt=""><figcaption></figcaption></figure>

### Grupy ZarzÄ…dzania

JeÅ›li twoja organizacja ma **wiele subskrypcji Azure**, moÅ¼esz potrzebowaÄ‡ sposobu efektywnego **zarzÄ…dzania dostÄ™pem**, politykami i zgodnoÅ›ciÄ… dla tych **subskrypcji**. **Grupy zarzÄ…dzania** zapewniajÄ… **zakres zarzÄ…dzania powyÅ¼ej subskrypcji**.

NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e w jednym katalogu moÅ¼na obsÅ‚uÅ¼yÄ‡ **10 000 grup zarzÄ…dzania**, a drzewo grupy zarzÄ…dzania moÅ¼e obsÅ‚ugiwaÄ‡ **do szeÅ›ciu poziomÃ³w gÅ‚Ä™bokoÅ›ci**.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption></figcaption></figure>

[Z dokumentacji](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory): KaÅ¼dy katalog otrzymuje pojedynczÄ… **nadrzÄ™dnÄ… grupÄ™ zarzÄ…dzania o nazwie root**. Grupa zarzÄ…dzania root jest wbudowana w hierarchiÄ™, aby **wszystkie grupy zarzÄ…dzania i subskrypcje zagnieÅ¼dÅ¼aÅ‚y siÄ™ w niej**. Ta grupa zarzÄ…dzania root umoÅ¼liwia stosowanie **globalnych polityk i przypisywanie rÃ³l Azure** na poziomie katalogu. [Globalny administrator Azure AD **musi podnieÅ›Ä‡ swoje uprawnienia**](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin) do **roli administratora dostÄ™pu uÅ¼ytkownika tej grupy root** poczÄ…tkowo. Po podniesieniu uprawnieÅ„ administrator moÅ¼e **przypisaÄ‡ dowolnÄ… rolÄ™ Azure innym uÅ¼ytkownikom lub grupom katalogowym do zarzÄ…dzania hierarchiÄ…**. Jako administrator moÅ¼esz przypisaÄ‡ **swoje wÅ‚asne konto jako wÅ‚aÅ›ciciela grupy zarzÄ…dzania root**.

Grupa zarzÄ…dzania root **nie moÅ¼e byÄ‡ przeniesiona ani usuniÄ™ta**, w przeciwieÅ„stwie do innych grup zarzÄ…dzania.

Grupy zarzÄ…dzania zapewniajÄ… zarzÄ…dzanie na poziomie przedsiÄ™biorstwa w skali, niezaleÅ¼nie od rodzaju subskrypcji, jakie moÅ¼esz mieÄ‡. JednakÅ¼e **wszystkie subskrypcje w ramach jednej grupy zarzÄ…dzania** muszÄ… ufaÄ‡ **temu samemu Azure Active Directory (Azure AD)**.

<figure><img src="../../.gitbook/assets/image (157).png" alt=""><figcaption></figcaption></figure>

### Subskrypcje Azure

W Azure subskrypcja sÅ‚uÅ¼y jako **kontener logiczny** do **dostarczania** zasobÃ³w biznesowych lub technicznych. Ten kontener przechowuje **szczegÃ³Å‚y zasobÃ³w**, takich jak maszyny wirtualne (VM), bazy danych, miÄ™dzy innymi. Po utworzeniu zasobu Azure, takiego jak VM, okreÅ›lana jest **powiÄ…zana z nim subskrypcja**. Ta struktura uÅ‚atwia delegowanie dostÄ™pu, wykorzystujÄ…c mechanizmy kontroli dostÄ™pu oparte na rolach.

### Grupy zasobÃ³w

[Z dokumentacji:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Grupa zasobÃ³w to **kontener**, ktÃ³ry przechowuje **powiÄ…zane zasoby** dla rozwiÄ…zania w Azure. Grupa zasobÃ³w moÅ¼e zawieraÄ‡ wszystkie zasoby dla rozwiÄ…zania lub tylko te **zasoby, ktÃ³re chcesz zarzÄ…dzaÄ‡ jako grupÄ™**. Zazwyczaj dodaje siÄ™ **zasoby**, ktÃ³re majÄ… **ten sam cykl Å¼ycia** do tej samej grupy zasobÃ³w, aby moÅ¼na byÅ‚o je Å‚atwo wdraÅ¼aÄ‡, aktualizowaÄ‡ i usuwaÄ‡ jako grupÄ™.

Wszystkie **zasoby** muszÄ… byÄ‡ **wewnÄ…trz grupy zasobÃ³w** i mogÄ… naleÅ¼eÄ‡ tylko do jednej grupy, a jeÅ›li grupa zasobÃ³w zostanie usuniÄ™ta, wszystkie zasoby w niej rÃ³wnieÅ¼ zostanÄ… usuniÄ™te.

### Jednostki administracyjne

[Z dokumentacji:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Jednostki administracyjne pozwalajÄ… **podzieliÄ‡** twojÄ… organizacjÄ™ na **dowolne jednostki**, ktÃ³re chcesz, a nastÄ™pnie **przypisaÄ‡ okreÅ›lonym administratorom**, ktÃ³rzy mogÄ… **zarzÄ…dzaÄ‡ tylko czÅ‚onkami** tej jednostki. Na przykÅ‚ad moÅ¼na uÅ¼yÄ‡ jednostek administracyjnych do delegowania uprawnieÅ„ do administratorÃ³w kaÅ¼dej szkoÅ‚y na duÅ¼ej uczelni, aby mogli oni kontrolowaÄ‡ dostÄ™p, zarzÄ…dzaÄ‡ uÅ¼ytkownikami i ustawiaÄ‡ polityki tylko w Wydziale InÅ¼ynierii.

Tylko **uÅ¼ytkownicy**, **grupy** i **urzÄ…dzenia** mogÄ… byÄ‡ **czÅ‚onkami** jednostki **administracyjnej**.

Dlatego jednostka **administracyjna** bÄ™dzie **zawieraÄ‡** pewne **czÅ‚onkÃ³w**, a inni **podmioty** zostanÄ… **przypisane uprawnienia** do tej jednostki **administracyjnej**, ktÃ³re mogÄ… wykorzystaÄ‡ do **zarzÄ…dzania czÅ‚onkami** jednostki administracyjnej.

## Azure vs Azure AD vs UsÅ‚ugi domenowe Azure AD

Warto zauwaÅ¼yÄ‡, Å¼e **Azure AD** to usÅ‚uga **wewnÄ…trz** **Azure**. **Azure** to platforma **chmurowa** firmy Microsoft, podczas gdy **Azure AD** to usÅ‚uga **toÅ¼samoÅ›ciowa** **dla przedsiÄ™biorstw** w Azure.\
Ponadto **Azure AD nie jest jak Windows Active Directory**, to usÅ‚uga toÅ¼samoÅ›ciowa, ktÃ³ra dziaÅ‚a w zupeÅ‚nie inny sposÃ³b. JeÅ›li chcesz uruchomiÄ‡ **Kontroler domeny w Azure** dla swojego Å›rodowiska Windows Active Directory, musisz uÅ¼yÄ‡ **UsÅ‚ug domenowych Azure AD**.

## Podmioty

Azure obsÅ‚uguje rÃ³Å¼ne rodzaje podmiotÃ³w:

* **UÅ¼ytkownik**: ZwykÅ‚a **osoba** z danymi uwierzytelniajÄ…cymi do dostÄ™pu.
* **Grupa**: **Grupa podmiotÃ³w** zarzÄ…dzana razem. **Uprawnienia** przyznane grupom sÄ… **dziedziczone** przez jej **czÅ‚onkÃ³w**.
*   **Podmiot usÅ‚ugi/Aplikacje przedsiÄ™biorstwa**: To **toÅ¼samoÅ›Ä‡** utworzona do **uÅ¼ywania** z **aplikacjami**, usÅ‚ugami hostowanymi i narzÄ™dziami automatyzacji do dostÄ™pu do zasobÃ³w Azure. Ten dostÄ™p jest **ograniczony przez przypisane role** do podmiotu usÅ‚ugi, dajÄ…c kontrolÄ™ nad **ktÃ³re zasoby mogÄ… byÄ‡ dostÄ™pne** i na jakim poziomie. Z przyczyn bezpieczeÅ„stwa zawsze zaleca siÄ™ **uÅ¼ywanie podmiotÃ³w usÅ‚ugi z narzÄ™dziami automatyzacji** zamiast pozwalania im na logowanie siÄ™ za pomocÄ… toÅ¼samoÅ›ci uÅ¼ytkownika.

TworzÄ…c **podmiot usÅ‚ugi** moÅ¼esz wybraÄ‡ miÄ™dzy **uwierzytelnianiem hasÅ‚em** lub **uwierzytelnianiem certyfikatem**.

* JeÅ›li wybierzesz uwierzytelnianie **hasÅ‚em** (domyÅ›lnie), **zapisz wygenerowane hasÅ‚o**, poniewaÅ¼ nie bÄ™dziesz mÃ³gÅ‚ uzyskaÄ‡ do niego ponownie.
* JeÅ›li wybierzesz uwierzytelnianie certyfikatem, upewnij siÄ™, Å¼e **aplikacja bÄ™dzie miaÅ‚a dostÄ™p do klucza prywatnego**.
* **ToÅ¼samoÅ›Ä‡ zarzÄ…dzana (Dane uwierzytelniajÄ…ce metadanych)**: ToÅ¼samoÅ›ci zarzÄ…dzane w Azure Active Directory oferujÄ… rozwiÄ…zanie do **automatycznego zarzÄ…dzania toÅ¼samoÅ›ciÄ…** aplikacji. Te toÅ¼samoÅ›ci sÄ… uÅ¼ywane przez aplikacje w celu **Å‚Ä…czenia** z **zasobami** zgodnymi z uwierzytelnianiem Azure Active Directory (**Azure AD**). KorzystajÄ…c z toÅ¼samoÅ›ci zarzÄ…dzanych, aplikacje mogÄ… **zabezpieczaÄ‡ tokeny Azure AD**, eliminujÄ…c koniecznoÅ›Ä‡ bezpoÅ›redniego zarzÄ…dzania danymi uwierzytelniajÄ…cymi. IstniejÄ… dwa rodzaje toÅ¼samoÅ›ci zarzÄ…dzanych:
* **Przypisane przez system**. NiektÃ³re usÅ‚ugi Azure pozwalajÄ… **wÅ‚Ä…czyÄ‡ toÅ¼samoÅ›Ä‡ zarzÄ…dzanÄ… bezpoÅ›rednio na instancji usÅ‚ugi**. Po wÅ‚Ä…czeniu przypisanej przez system toÅ¼samoÅ›ci zarzÄ…dzanej, toÅ¼samoÅ›Ä‡ jest tworzona w Azure AD. ToÅ¼samoÅ›Ä‡ jest zwiÄ…zana z **cyklem Å¼ycia tej instancji usÅ‚ugi**. Gdy **zasÃ³b** zostanie **usuniÄ™ty**, Azure automatycznie **usuwa** dla ciebie **toÅ¼samoÅ›Ä‡**. Zgodnie z projektem, tylko ten zasÃ³b Azure moÅ¼e uÅ¼ywaÄ‡ tej toÅ¼samoÅ›ci do Å¼Ä…dania tokenÃ³w od Azure AD.
* **Przypisane przez uÅ¼ytkownika**. MoÅ¼esz rÃ³wnieÅ¼ utworzyÄ‡ toÅ¼samoÅ›Ä‡ zarzÄ…dzanÄ… jako samodzielny zasÃ³b Azure. MoÅ¼esz [utworzyÄ‡ toÅ¼samoÅ›Ä‡ zarzÄ…dzanÄ… przez uÅ¼ytkownika](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal) i przypisaÄ‡ jÄ… do jednej lub **wiÄ™cej instancji** usÅ‚ugi Azure (wiele zasobÃ³w). Dla toÅ¼samoÅ›ci zarzÄ…dzanych przez uÅ¼ytkownika, **toÅ¼samoÅ›Ä‡ jest zarzÄ…dzana osobno od zasobÃ³w, ktÃ³re jej uÅ¼ywajÄ…**.
## Role & Uprawnienia

**Role** sÄ… **przypisywane** do **podmiotÃ³w** na **zakresie**: `podmiot -[MA ROLÄ˜]->(zakres)`

**Role** przypisane do **grup** sÄ… **dziedziczone** przez wszystkich **czÅ‚onkÃ³w** grupy.

W zaleÅ¼noÅ›ci od zakresu, do ktÃ³rego zostaÅ‚a przypisana rola, **rola** moÅ¼e byÄ‡ **dziedziczona** przez **inne zasoby** wewnÄ…trz kontenera zakresu. Na przykÅ‚ad, jeÅ›li uÅ¼ytkownik A ma **rolÄ™ w subskrypcji**, bÄ™dzie miaÅ‚ tÄ™ **rolÄ™ we wszystkich grupach zasobÃ³w** wewnÄ…trz subskrypcji oraz we **wszystkich zasobach** wewnÄ…trz grupy zasobÃ³w.

### **Role Klasyczne**

| **WÅ‚aÅ›ciciel**               | <ul><li>PeÅ‚ny dostÄ™p do wszystkich zasobÃ³w</li><li>MoÅ¼e zarzÄ…dzaÄ‡ dostÄ™pem innych uÅ¼ytkownikÃ³w</li></ul> | Wszystkie typy zasobÃ³w |
| ---------------------------- | ---------------------------------------------------------------------------------------- | ---------------------- |
| **WspÃ³Å‚twÃ³rca**              | <ul><li>PeÅ‚ny dostÄ™p do wszystkich zasobÃ³w</li><li>Nie moÅ¼e zarzÄ…dzaÄ‡ dostÄ™pem</li></ul>  | Wszystkie typy zasobÃ³w |
| **Czytelnik**                | â€¢ PrzeglÄ…daj wszystkie zasoby                                                         | Wszystkie typy zasobÃ³w |
| **Administrator dostÄ™pu uÅ¼ytkownika** | <ul><li>PrzeglÄ…daj wszystkie zasoby</li><li>MoÅ¼e zarzÄ…dzaÄ‡ dostÄ™pem innych uÅ¼ytkownikÃ³w</li></ul> | Wszystkie typy zasobÃ³w |

### Role Wbudowane

[Z dokumentacji: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Kontrola dostÄ™pu oparta na rolach Azure (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) posiada kilka **wbudowanych rÃ³l Azure**, ktÃ³re moÅ¼na **przypisaÄ‡** do **uÅ¼ytkownikÃ³w, grup, podmiotÃ³w usÅ‚ugi i toÅ¼samoÅ›ci zarzÄ…dzanych**. Przypisania rÃ³l sÄ… sposobem kontrolowania **dostÄ™pu do zasobÃ³w Azure**. JeÅ›li wbudowane role nie speÅ‚niajÄ… konkretnych potrzeb organizacji, moÅ¼na utworzyÄ‡ [**wÅ‚asne role Azure**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**.**

**Role Wbudowane** dotyczÄ… tylko **zasobÃ³w**, do ktÃ³rych sÄ… **przeznaczone**, na przykÅ‚ad sprawdÅº te 2 przykÅ‚ady **rÃ³l wbudowanych dla zasobÃ³w obliczeniowych**:

| [Czytelnik kopii zapasowej dysku](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader) | Zapewnia uprawnienia do kopii zapasowej dysku w celu wykonywania kopii zapasowych. | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [UÅ¼ytkownik maszyny wirtualnej do logowania](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | WyÅ›wietl maszyny wirtualne w portalu i zaloguj siÄ™ jako zwykÅ‚y uÅ¼ytkownik. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Te role mogÄ… byÄ‡ **rÃ³wnieÅ¼ przypisane do kontenerÃ³w logicznych** (takich jak grupy zarzÄ…dzania, subskrypcje i grupy zasobÃ³w), a dotkniÄ™te nimi podmioty bÄ™dÄ… miaÅ‚y je **nad zasobami wewnÄ…trz tych kontenerÃ³w**.

* ZnajdÅº tutaj listÄ™ [**wszystkich wbudowanych rÃ³l Azure**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* ZnajdÅº tutaj listÄ™ [**wszystkich wbudowanych rÃ³l Azure AD**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Role Niestandardowe

Azure pozwala rÃ³wnieÅ¼ tworzyÄ‡ [**role niestandardowe**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) z uprawnieniami, ktÃ³rych potrzebuje uÅ¼ytkownik.

### Odmowa UprawnieÅ„

* Aby **podmiot miaÅ‚ dostÄ™p do zasobu**, musi mieÄ‡ przypisanÄ… mu rolÄ™, **ktÃ³ra mu to uprawnienie przyznaje**.
* WyraÅºne **przypisanie roli odmowy ma pierwszeÅ„stwo** nad rolÄ… przyznajÄ…cÄ… uprawnienie.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Administrator Globalny

UÅ¼ytkownicy z rolÄ… Administratora Globalnego majÄ… moÅ¼liwoÅ›Ä‡ '**awansowania' do roli Administratora DostÄ™pu UÅ¼ytkownika Azure do gÅ‚Ã³wnej grupy zarzÄ…dzania**. Oznacza to, Å¼e Administrator Globalny bÄ™dzie mÃ³gÅ‚ zarzÄ…dzaÄ‡ dostÄ™pem **do wszystkich subskrypcji i grup zarzÄ…dzania Azure.**\
Ten awans moÅ¼na dokonaÄ‡ na koÅ„cu strony: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Zasady Azure

Zasady Azure to zestaw **reguÅ‚ i przepisÃ³w w usÅ‚udze chmury Microsoft Azure**, ktÃ³re pomagajÄ… zarzÄ…dzaÄ‡ i egzekwowaÄ‡ standardy organizacyjne oraz oceniaÄ‡ zgodnoÅ›Ä‡ na duÅ¼Ä… skalÄ™. Te zasady narzucajÄ… rÃ³Å¼ne reguÅ‚y na Twoje **zasoby Azure**, zapewniajÄ…c, Å¼e te zasoby pozostajÄ… zgodne ze standardami korporacyjnymi i umowami o poziomie usÅ‚ug.

Zasady Azure sÄ… kluczowe dla zarzÄ…dzania chmurÄ… i bezpieczeÅ„stwa, pomagajÄ…c zapewniÄ‡, Å¼e zasoby sÄ… uÅ¼ywane wÅ‚aÅ›ciwie i efektywnie, oraz Å¼e sÄ… zgodne z zewnÄ™trznymi przepisami i wewnÄ™trznymi zasadami.\
PrzykÅ‚ady:

1. **Zapewnienie ZgodnoÅ›ci z Konkretnymi Regionami Azure**: Ta zasada zapewnia, Å¼e wszystkie zasoby sÄ… wdroÅ¼one w okreÅ›lonych regionach Azure. Na przykÅ‚ad firma moÅ¼e chcieÄ‡ zapewniÄ‡, Å¼e wszystkie jej dane sÄ… przechowywane w Europie zgodnie z RODO.
2. **Wymuszanie StandardÃ³w Nazewnictwa**: Zasady mogÄ… narzucaÄ‡ konwencje nazewnicze dla zasobÃ³w Azure. Pomaga to w organizowaniu i Å‚atwym identyfikowaniu zasobÃ³w na podstawie ich nazw, co jest pomocne w duÅ¼ych Å›rodowiskach.
3. **Ograniczenie OkreÅ›lonych TypÃ³w ZasobÃ³w**: Ta zasada moÅ¼e ograniczaÄ‡ tworzenie okreÅ›lonych typÃ³w zasobÃ³w. Na przykÅ‚ad zasada moÅ¼e byÄ‡ ustawiona, aby zapobiec tworzeniu drogich typÃ³w zasobÃ³w, takich jak okreÅ›lone rozmiary maszyn wirtualnych, w celu kontroli kosztÃ³w.
4. **Wymuszanie Polityk Tagowania**: Tagi to pary klucz-wartoÅ›Ä‡ powiÄ…zane z zasobami Azure uÅ¼ywane do zarzÄ…dzania zasobami. Zasady mogÄ… wymuszaÄ‡ obecnoÅ›Ä‡ okreÅ›lonych tagÃ³w lub okreÅ›lonych wartoÅ›ci dla wszystkich zasobÃ³w. Jest to przydatne do Å›ledzenia kosztÃ³w, wÅ‚aÅ›cicieli lub kategoryzacji zasobÃ³w.
5. **Ograniczenie DostÄ™pu Publicznego do ZasobÃ³w**: Zasady mogÄ… wymuszaÄ‡, aby niektÃ³re zasoby, takie jak konta magazynowe lub bazy danych, nie miaÅ‚y publicznych punktÃ³w koÅ„cowych, zapewniajÄ…c, Å¼e sÄ… one dostÄ™pne tylko w sieci organizacji.
6. **Automatyczne Zastosowanie UstawieÅ„ BezpieczeÅ„stwa**: Zasady mogÄ… byÄ‡ uÅ¼ywane do automatycznego stosowania ustawieÅ„ bezpieczeÅ„stwa do zasobÃ³w, takich jak stosowanie okreÅ›lonej grupy zabezpieczeÅ„ sieciowych do wszystkich maszyn wirtualnych lub zapewnienie, Å¼e wszystkie konta magazynowe uÅ¼ywajÄ… szyfrowania.

ZauwaÅ¼, Å¼e Zasady Azure mogÄ… byÄ‡ doÅ‚Ä…czone do dowolnego poziomu hierarchii Azure, ale sÄ… **czÄ™sto uÅ¼ywane w gÅ‚Ã³wnej grupie zarzÄ…dzania** lub innych grupach zarzÄ…dzania.

### Zakres UprawnieÅ„

W Azure **uprawnienia mogÄ… byÄ‡ przypisane do dowolnej czÄ™Å›ci hierarchii**. Obejmuje to grupy zarzÄ…dzania, subskrypcje, grupy zasobÃ³w i poszczegÃ³lne zasoby. Uprawnienia sÄ… **dziedziczone** przez zawarte **zasoby** podmiotu, do ktÃ³rego zostaÅ‚y przypisane.

Ta struktura hierarchiczna pozwala na efektywne i skalowalne zarzÄ…dzanie uprawnieniami dostÄ™pu.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (kontrola dostÄ™pu oparta na rolach) to to, co juÅ¼ widzieliÅ›my w poprzednich sekcjach: **Przypisanie roli do podmiotu w celu przyznania mu dostÄ™pu** do zasobu.\
Jednak w niektÃ³rych przypadkach moÅ¼esz chcieÄ‡ zapewniÄ‡ **bardziej precyzyjne zarzÄ…dzanie dostÄ™pem** lub **uproszczenie** zarzÄ…dzania **setkami** przypisaÅ„ **rÃ³l**.

Azure **ABAC** (kontrola dostÄ™pu oparta na atrybutach) rozbudowuje Azure RBAC poprzez dodanie **warunkÃ³w przypisania roli opartych na atrybutach** w kontekÅ›cie konkretnych dziaÅ‚aÅ„. _Warunek przypisania roli_ to **dodatkowa kontrola, ktÃ³rÄ… opcjonalnie moÅ¼esz dodaÄ‡ do przypisania roli** w celu zapewnienia bardziej precyzyjnej kontroli dostÄ™pu. Warunek filtruje przyznane uprawnienia jako czÄ™Å›Ä‡ definicji roli i przypisania roli. Na przykÅ‚ad moÅ¼esz **dodaÄ‡ warunek, ktÃ³ry wymaga, aby obiekt miaÅ‚ okreÅ›lony tag, aby odczytaÄ‡ obiekt**.\
**Nie moÅ¼esz** wyraÅºnie **odmÃ³wiÄ‡ dostÄ™pu** do okreÅ›lonych zasobÃ³w **korzystajÄ…c z warunkÃ³w**.
### DomyÅ›lne uprawnienia uÅ¼ytkownika

Podstawowy uÅ¼ytkownik bÄ™dzie miaÅ‚ **domyÅ›lne uprawnienia** do wyliczenia niektÃ³rych czÄ™Å›ci AzureAD:

* Odczyt wszystkich uÅ¼ytkownikÃ³w, grup, aplikacji, urzÄ…dzeÅ„, rÃ³l, subskrypcji i ich publicznych wÅ‚aÅ›ciwoÅ›ci
* Zapraszanie goÅ›ci (_moÅ¼e byÄ‡ wyÅ‚Ä…czone_)
* Tworzenie grup zabezpieczeÅ„
* Odczyt nieukrytych czÅ‚onkostw w grupach
* Dodawanie goÅ›ci do posiadanych grup
* Tworzenie nowej aplikacji (_moÅ¼e byÄ‡ wyÅ‚Ä…czone_)
* Dodawanie do 50 urzÄ…dzeÅ„ do Azure (_moÅ¼e byÄ‡ wyÅ‚Ä…czone_)

MoÅ¼esz zobaczyÄ‡ peÅ‚nÄ… [listÄ™ **domyÅ›lnych uprawnieÅ„ uÅ¼ytkownikÃ³w** w dokumentacji](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions). Ponadto, zauwaÅ¼, Å¼e na tej liÅ›cie moÅ¼na rÃ³wnieÅ¼ zobaczyÄ‡ **listÄ™ domyÅ›lnych uprawnieÅ„ goÅ›ci**.

{% hint style="info" %}
PamiÄ™taj, Å¼eby wyliczyÄ‡ zasoby Azure, uÅ¼ytkownik potrzebuje wyraÅºnego udzielenia uprawnienia.
{% endhint %}

### ZarzÄ…dzanie toÅ¼samoÅ›ciami uprzywilejowanymi (PIM)

ZarzÄ…dzanie toÅ¼samoÅ›ciami uprzywilejowanymi (PIM) w Azure to narzÄ™dzie, ktÃ³re **zarzÄ…dza, kontroluje i monitoruje uprzywilejowany dostÄ™p** w Azure Active Directory i Azure. ZwiÄ™ksza bezpieczeÅ„stwo, zapewniajÄ…c **dostÄ™p uprzywilejowany dokÅ‚adnie w odpowiednim czasie i na ograniczony czas**, **stosujÄ…c przepÅ‚ywy zatwierdzania i wymagajÄ…c dodatkowej autoryzacji**. Ten podejÅ›cie minimalizuje ryzyko nieautoryzowanego dostÄ™pu, zapewniajÄ…c, Å¼e podwyÅ¼szone uprawnienia sÄ… udzielane tylko wtedy, gdy sÄ… niezbÄ™dne i na okreÅ›lony czas.

## Tokeny uwierzytelniajÄ…ce

IstniejÄ… **trzy rodzaje tokenÃ³w** uÅ¼ywanych w OIDC:

* [**Tokeny dostÄ™pu**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** Klient prezentuje ten token serwerowi zasobÃ³w, aby **uzyskaÄ‡ dostÄ™p do zasobÃ³w**. MoÅ¼e byÄ‡ uÅ¼ywany tylko dla okreÅ›lonej kombinacji uÅ¼ytkownika, klienta i zasobu i **nie moÅ¼e zostaÄ‡ wycofany** do momentu wygaÅ›niÄ™cia - domyÅ›lnie po 1 godzinie. WykrywalnoÅ›Ä‡ jest niska przy uÅ¼yciu tego.
* **Tokeny ID**: Klient otrzymuje ten **token od serwera autoryzacji**. Zawiera podstawowe informacje o uÅ¼ytkowniku. Jest **powiÄ…zany z okreÅ›lonÄ… kombinacjÄ… uÅ¼ytkownika i klienta**.
* **Tokeny odÅ›wieÅ¼ania**: UdostÄ™pniane klientowi wraz z tokenem dostÄ™pu. SÅ‚uÅ¼Ä… do **uzyskiwania nowych tokenÃ³w dostÄ™pu i ID**. SÄ… powiÄ…zane z okreÅ›lonÄ… kombinacjÄ… uÅ¼ytkownika i klienta i mogÄ… zostaÄ‡ wycofane. DomyÅ›lny termin waÅ¼noÅ›ci to **90 dni** dla nieaktywnych tokenÃ³w odÅ›wieÅ¼ania i **brak wygaÅ›niÄ™cia dla aktywnych tokenÃ³w**.

{% hint style="warning" %}
Informacje o **dostÄ™pie warunkowym** sÄ… **przechowywane** wewnÄ…trz **JWT**. Dlatego jeÅ›li Å¼Ä…dasz **tokena z dozwolonego adresu IP**, to **IP** to bÄ™dzie **przechowywane** w tokenie, a nastÄ™pnie moÅ¼esz uÅ¼yÄ‡ tego tokenu z **nieautoryzowanego IP do uzyskania dostÄ™pu do zasobÃ³w**.
{% endhint %}

SprawdÅº nastÄ™pujÄ…cÄ… stronÄ™, aby dowiedzieÄ‡ siÄ™ rÃ³Å¼nych sposobÃ³w **Å¼Ä…dania tokenÃ³w dostÄ™pu** i logowania siÄ™ nimi:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

NajczÄ™Å›ciej uÅ¼ywane punkty koÅ„cowe API to:

* **MenedÅ¼er zasobÃ³w Azure** (ARM): management.azure.com
* **Microsoft Graph**: graph.microsoft.com (Azure AD Graph, ktÃ³ry jest przestarzaÅ‚y, to graph.windows.net)

## OdnoÅ›niki

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)
