# Az - ë™ì  ê·¸ë£¹ Privesc

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì œë¡œë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

**ë™ì  ê·¸ë£¹**ì€ êµ¬ì„±ëœ **ê·œì¹™** ì„¸íŠ¸ë¥¼ ê°€ì§„ ê·¸ë£¹ìœ¼ë¡œ, ê·œì¹™ê³¼ ì¼ì¹˜í•˜ëŠ” **ì‚¬ìš©ì ë˜ëŠ” ì¥ì¹˜**ê°€ ê·¸ë£¹ì— ì¶”ê°€ë©ë‹ˆë‹¤. ì‚¬ìš©ì ë˜ëŠ” ì¥ì¹˜ **ì†ì„±**ì´ **ë³€ê²½**ë  ë•Œë§ˆë‹¤ ë™ì  ê·œì¹™ì´ **ì¬í™•ì¸**ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  **ìƒˆë¡œìš´ ê·œì¹™**ì´ **ìƒì„±**ë  ë•Œ ëª¨ë“  ì¥ì¹˜ì™€ ì‚¬ìš©ìê°€ **í™•ì¸**ë©ë‹ˆë‹¤.

ë™ì  ê·¸ë£¹ì—ëŠ” **Azure RBAC ì—­í• ì´ í• ë‹¹**ë  ìˆ˜ ìˆì§€ë§Œ, ë™ì  ê·¸ë£¹ì— **AzureAD ì—­í• ì„ ì¶”ê°€**í•  ìˆ˜ëŠ” **ì—†ìŠµë‹ˆë‹¤**.

ì´ ê¸°ëŠ¥ì—ëŠ” Azure AD í”„ë¦¬ë¯¸ì—„ P1 ë¼ì´ì„ ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.

## Privesc

ê¸°ë³¸ì ìœ¼ë¡œ Azure ADì—ì„œëŠ” ëª¨ë“  ì‚¬ìš©ìê°€ ê²ŒìŠ¤íŠ¸ë¥¼ ì´ˆëŒ€í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë™ì  ê·¸ë£¹ **ê·œì¹™**ì´ **ì†ì„±**ì„ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ **ê¶Œí•œì„ ë¶€ì—¬**í•˜ëŠ” ê²½ìš°, ì´ëŸ¬í•œ ì†ì„±ì„ ê°€ì§„ ìƒˆë¡œìš´ **ê²ŒìŠ¤íŠ¸**ë¥¼ ë§Œë“¤ê³  **ê¶Œí•œì„ ìƒìŠ¹**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ê²ŒìŠ¤íŠ¸ëŠ” ìì‹ ì˜ í”„ë¡œí•„ì„ ê´€ë¦¬í•˜ê³  ì´ëŸ¬í•œ ì†ì„±ì„ ë³€ê²½í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ë™ì  ë©¤ë²„ì‹­ì„ í—ˆìš©í•˜ëŠ” ê·¸ë£¹ ê°€ì ¸ì˜¤ê¸°: `Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### ì˜ˆì‹œ

* **ê·œì¹™ ì˜ˆì‹œ**: `(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **ê·œì¹™ ì„¤ëª…**: ë¬¸ìì—´ 'tester'ë¥¼ í¬í•¨í•˜ëŠ” ë³´ì¡° ì´ë©”ì¼ì„ ê°€ì§„ ëª¨ë“  ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ìê°€ ê·¸ë£¹ì— ì¶”ê°€ë©ë‹ˆë‹¤.

1. **Azure Active Directory**ë¡œ ì´ë™ -> **ì‚¬ìš©ì** ë° **`Want to switch back to the legacy users list experience? Click here to leave the preview`**ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
2. **`New guest user`**ë¥¼ í´ë¦­í•˜ê³  ì´ë©”ì¼ì„ **ì´ˆëŒ€**í•©ë‹ˆë‹¤.
3. ì´ˆëŒ€ì¥ì„ ë³´ë‚´ë©´ ì‚¬ìš©ì í”„ë¡œí•„ì´ Azure ADì— **ì¶”ê°€**ë©ë‹ˆë‹¤. ì‚¬ìš©ì í”„ë¡œí•„ì„ ì—´ê³  **Invitation accepted** ì•„ë˜ì˜ **(manage)ë¥¼ í´ë¦­**í•©ë‹ˆë‹¤.
* ![](<../../../.gitbook/assets/image (281).png>)
4. **`Resend invite?`**ë¥¼ **Yes**ë¡œ ë³€ê²½í•˜ë©´ ì´ˆëŒ€ URLì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
* ![](<../../../.gitbook/assets/image (205).png>)
5. **URL**ì„ ë³µì‚¬í•˜ê³  **ì—´ì–´ì„œ** ì´ˆëŒ€ëœ ì‚¬ìš©ìë¡œ **ë¡œê·¸ì¸**í•˜ê³  ì´ˆëŒ€ë¥¼ **ìˆ˜ë½**í•©ë‹ˆë‹¤.
6. ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸í•˜ì—¬ ë³´ì¡° ì´ë©”ì¼ì„ ì„¤ì •í•©ë‹ˆë‹¤.

{% code overflow="wrap" %}
```powershell
# ë¡œê·¸ì¸
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# OtherMails ì„¤ì • ë³€ê²½
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
{% endcode %}

## ì°¸ê³  ìë£Œ

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)
