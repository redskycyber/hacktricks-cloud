# Az - AzureAD (AAD)

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

Azure Active Directory (Azure AD) su偶y jako usuga oparta na chmurze Microsoftu do zarzdzania to偶samoci i dostpem. Jest niezbdny do umo偶liwienia pracownikom logowania i uzyskiwania dostpu do zasob贸w zar贸wno wewntrz, jak i poza organizacj, obejmujcych Microsoft 365, portal Azure i wiele innych aplikacji SaaS. Projektowanie Azure AD koncentruje si na dostarczaniu podstawowych usug to偶samoci, w tym **uwierzytelniania, autoryzacji i zarzdzania u偶ytkownikami**.

G贸wne funkcje Azure AD obejmuj **uwierzytelnianie wieloskadnikowe** i **dostp warunkowy**, wraz z bezproblemow integracj z innymi usugami zabezpiecze Microsoftu. Te funkcje znaczco podnosz bezpieczestwo to偶samoci u偶ytkownik贸w i umo偶liwiaj organizacjom skuteczne wdra偶anie i egzekwowanie polityk dostpu. Jako podstawowy komponent ekosystemu usug chmurowych Microsoftu, Azure AD jest kluczowy dla zarzdzania to偶samociami u偶ytkownik贸w w chmurze.

## Jednostki

### Wyliczanie

Do wyliczania mo偶na u偶y narzdzia [**az cli**](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli)**,** moduu **PowerShell** [**AzureAD**](https://www.powershellgallery.com/packages/AzureAD/) (lub [**AzureAD Preview**](https://www.powershellgallery.com/packages/AzureADPreview)) oraz moduu [**Az PowerShell**](https://learn.microsoft.com/en-us/powershell/azure/install-az-ps).

{% hint style="success" %}
W systemie Linux bdziesz musia zainstalowa PowerShell Core:

```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
{% endhint %}

#### **R贸偶nice midzy moduami**

* **AzureAD** to modu PowerShell od Microsoftu do **zarzdzania Azure AD. Nie wywietla wszystkich waciwoci obiekt贸w Azure AD i nie mo偶na go u偶ywa do uzyskiwania informacji o zasobach Azure**.
* **Az PowerShell** to modu do **zarzdzania zasobami Azure** z wiersza polece PowerShell.

### **Poczenie**

{% tabs %}
{% tab title="az cli" %}
```bash
az login #This will open the browser
az login -u <username> -p <password> #Specify user and password
az login --identity #Use the current machine managed identity (metadata)
az login --identity -u /subscriptions/<subscriptionId>/resourcegroups/myRG/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myID #Login with user managed identity
# Login as service principal
az login --service-principal -u http://azure-cli-2016-08-05-14-31-15 -p VerySecret --tenant contoso.onmicrosoft.com #With password
az login --service-principal -u http://azure-cli-2016-08-05-14-31-15 -p ~/mycertfile.pem --tenant contoso.onmicrosoft.com #With cert

# Request access token (ARM)
az account get-access-token
# Request access token for different resource. Supported tokens: aad-graph, arm, batch, data-lake, media, ms-graph, oss-rdbms
az account get-access-token --resource-type aad-graph

# If you want to configure some defaults
az configure

# Get user logged-in already
az ad signed-in-user show

# Help
az find "vm" # Find vm commands
az vm -h # Get subdomains
az ad user list --query-examples # Get examples
```
{% endtab %}

{% tab title="Azure AD" %}
{% code overflow="wrap" %}
```powershell
Connect-AzureAD #Open browser
# Using credentials
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@corp.onmicrosoft.com", $passwd)
Connect-AzureAD -Credential $creds

# Using tokens
## AzureAD cannot request tokens, but can use AADGraph and MSGraph tokens to connect
Connect-AzureAD -AccountId test@corp.onmicrosoft.com -AadAccessToken $token
```
{% endcode %}
{% endtab %}

{% tab title="undefined" %}
```powershell
Connect-AzAccount #Open browser
# Using credentials
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("test@corp.onmicrosoft.com", $passwd)
Connect-AzAccount -Credential $creds

# Get Access Token
(Get-AzAccessToken).Token
# Request access token to other endpoints: AadGraph, AnalysisServices, Arm, Attestation, Batch, DataLake, KeyVault, MSGraph, OperationalInsights, ResourceManager, Storage, Synapse
Get-AzAccessToken -ResourceTypeName MSGraph
(Get-AzAccessToken -Resource "https://graph.microsoft.com").Token

# Conenct with access token
Connect-AzAccount -AccountId test@corp.onmicrosoft.com -AccessToken $token
Connect-AzAccount -AccessToken $token -GraphAccessToken $graphaccesstoken -AccountId <ACCOUNT-ID>
## The -AccessToken is from management.azure.com

# Connect with Service principal/enterprise app secret
$password = ConvertTo-SecureString 'KWEFNOIRFIPMWL.--DWPNVFI._EDWWEF_ADF~SODNFBWRBIF' -AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('2923847f-fca2-a420-df10-a01928bec653', $password)
Connect-AzAccount -ServicePrincipal -Credential $creds -Tenant 29sd87e56-a192-a934-bca3-0398471ab4e7d

#All the Azure AD cmdlets have the format *-AzAD*
Get-Command *azad*
#Cmdlets for other Azure resources have the format *Az*
Get-Command *az*
```
{% endtab %}

{% tab title="Surowy PS" %}
{% code overflow="wrap" %}
```powershell
#Using management
$Token = 'eyJ0eXAi..'
# List subscriptions
$URI = 'https://management.azure.com/subscriptions?api-version=2020-01-01'
$RequestParams = @{
Method  = 'GET'
Uri     = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value

# Using graph
Invoke-WebRequest -Uri "https://graph.windows.net/myorganization/users?api-version=1.6" -Headers @{Authorization="Bearer {0}" -f $Token}
```
{% endcode %}
{% endtab %}

{% tab title="Surowy system operacyjny" %}
{% code overflow="wrap" %}
```bash
# Request tokens to access endpoints
# ARM
curl "$IDENTITY_ENDPOINT?resource=https://management.azure.com&api-version=2017-09-01" -H secret:$IDENTITY_HEADER

# Vault
curl "$IDENTITY_ENDPOINT?resource=https://vault.azure.net&api-version=2017-09-01" -H secret:$IDENTITY_HEADER
```
{% endcode %}
{% endtab %}
{% endtabs %}

Kiedy **logujesz si** za pomoc **CLI** do Azure za pomoc dowolnego programu, u偶ywasz **Aplikacji Azure** z **tenantem**, kt贸ry nale偶y do **Microsoftu**. Te aplikacje, takie jak te, kt贸re mo偶esz tworzy w swoim koncie, **posiadaj identyfikator klienta**. **Nie bdziesz w stanie zobaczy wszystkich z nich** na listach **dozwolonych aplikacji**, kt贸re mo偶esz zobaczy w konsoli, **ale domylnie s one dozwolone**.

Na przykad skrypt **powershell** u偶ywa aplikacji z identyfikatorem klienta **`1950a258-227b-4e31-a9cf-717495945fc2`** do **uwierzytelniania**. Nawet jeli aplikacja nie pojawia si w konsoli, administrator systemu mo偶e **zablokowa t aplikacj**, aby u偶ytkownicy nie mogli uzyska do niej dostpu za pomoc narzdzi, kt贸re cz si za pomoc tej aplikacji.

Jednak istniej **inne identyfikatory klient贸w** aplikacji, kt贸re **pozwalaj na poczenie z Azure**:

```powershell
# The important part is the ClientId, which identifies the application to login inside Azure

$token = Invoke-Authorize -Credential $credential `
-ClientId '1dfb5f98-f363-4b0f-b63a-8d20ada1e62d' `
-Scope 'Files.Read.All openid profile Sites.Read.All User.Read email' `
-Redirect_Uri "https://graphtryit-staging.azurewebsites.net/" `
-Verbose -Debug `
-InformationAction Continue

$token = Invoke-Authorize -Credential $credential `
-ClientId '65611c08-af8c-46fc-ad20-1888eb1b70d9' `
-Scope 'openid profile Sites.Read.All User.Read email' `
-Redirect_Uri "chrome-extension://imjekgehfljppdblckcmjggcoboemlah" `
-Verbose -Debug `
-InformationAction Continue

$token = Invoke-Authorize -Credential $credential `
-ClientId 'd3ce4cf8-6810-442d-b42e-375e14710095' `
-Scope 'openid' `
-Redirect_Uri "https://graphexplorer.azurewebsites.net/" `
-Verbose -Debug `
-InformationAction Continue
```

### U偶ytkownicy

```bash
# Enumerate users
az ad user list --output table
az ad user list --query "[].userPrincipalName"
# Get info of 1 user
az ad user show --id "test@corp.onmicrosoft.com"
# Search "admin" users
az ad user list --query "[].displayName" | findstr /i "admin"
az ad user list --query "[?contains(displayName,'admin')].displayName"
# Search attributes containing the word "password"
az ad user list | findstr /i "password" | findstr /v "null,"
# All users from AzureAD
az ad user list --query "[].{osi:onPremisesSecurityIdentifier,upn:userPrincipalName}[?osi==null]"
az ad user list --query "[?onPremisesSecurityIdentifier==null].displayName"
# All users synced from on-prem
az ad user list --query "[].{osi:onPremisesSecurityIdentifier,upn:userPrincipalName}[?osi!=null]"
az ad user list --query "[?onPremisesSecurityIdentifier!=null].displayName"
# Get groups where the user is a member
az ad user get-member-groups --id <email>
# Get roles assigned to the user
az role assignment list --include-groups --include-classic-administrators true --assignee <email>
```

Azure AD

```powershell
# Enumerate Users
Get-AzureADUser -All $true
Get-AzureADUser -All $true | select UserPrincipalName
# Get info of 1 user
Get-AzureADUser -ObjectId test@corp.onmicrosoft.com | fl
# Search "admin" users
Get-AzureADUser -SearchString "admin" #Search admin at the begining of DisplayName or userPrincipalName
Get-AzureADUser -All $true |?{$_.Displayname -match "admin"} #Search "admin" word in DisplayName
# Get all attributes of a user
Get-AzureADUser -ObjectId test@defcorphq.onmicrosoft.com|%{$_.PSObject.Properties.Name}
# Search attributes containing the word "password"
Get-AzureADUser -All $true |%{$Properties = $_;$Properties.PSObject.Properties.Name | % {if ($Properties.$_ -match 'password') {"$($Properties.UserPrincipalName) - $_ - $($Properties.$_)"}}}
# All users from AzureAD# All users from AzureAD
Get-AzureADUser -All $true | ?{$_.OnPremisesSecurityIdentifier -eq $null}
# All users synced from on-prem
Get-AzureADUser -All $true | ?{$_.OnPremisesSecurityIdentifier -ne $null}
# Objects created by a/any user
Get-AzureADUser [-ObjectId <email>] | Get-AzureADUserCreatedObject
# Devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Objects owned by a specific user
Get-AzureADUserOwnedObject -ObjectId test@corp.onmicrosoft.com
# Get groups & roles where the user is a member
Get-AzureADUserMembership -ObjectId 'test@corp.onmicrosoft.com'
# Get devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Get devices registered by a user
Get-AzureADUserRegisteredDevice -ObjectId test@defcorphq.onmicrosoft.com
# Apps where a user has a role (role not shown)
Get-AzureADUser -ObjectId roygcain@defcorphq.onmicrosoft.com | Get-AzureADUserAppRoleAssignment | fl *
# Get Administrative Units of a user
$userObj = Get-AzureADUser -Filter "UserPrincipalName eq 'bill@example.com'"
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -Id $_.Id | where { $_.Id -eq $userObj.ObjectId } }
```

Azure AD jest usug zarzdzania to偶samociami i dostpu w chmurze, kt贸ra zapewnia uwierzytelnianie i autoryzacj dla u偶ytkownik贸w, aplikacji i zasob贸w w rodowisku Azure. W celu przeprowadzenia test贸w penetracyjnych na Azure AD, mo偶na u偶y moduu Az PowerShell, kt贸ry zapewnia zestaw polece do zarzdzania usugami Azure.

Aby rozpocz testy penetracyjne na Azure AD przy u偶yciu Az PowerShell, nale偶y najpierw zainstalowa modu Az PowerShell na swoim komputerze. Mo偶na to zrobi za pomoc polecenia `Install-Module -Name Az -AllowClobber -Scope CurrentUser`, kt贸re zainstaluje najnowsz wersj moduu Az PowerShell.

Po zainstalowaniu moduu Az PowerShell, mo偶na zalogowa si do swojego konta Azure AD za pomoc polecenia `Connect-AzAccount`. Nastpnie mo偶na u偶y r贸偶nych polece Az PowerShell do przeprowadzenia test贸w penetracyjnych na Azure AD, takich jak:

* `Get-AzADUser` - pobiera informacje o u偶ytkownikach Azure AD.
* `Get-AzADServicePrincipal` - pobiera informacje o usugach Azure AD.
* `Get-AzADGroup` - pobiera informacje o grupach Azure AD.
* `Get-AzADGroupMember` - pobiera informacje o czonkach grup Azure AD.
* `Get-AzADApplication` - pobiera informacje o aplikacjach Azure AD.

Pamitaj, 偶e przed przeprowadzeniem test贸w penetracyjnych na Azure AD nale偶y uzyska odpowiednie uprawnienia i zgody. Testy penetracyjne powinny by przeprowadzane tylko na zasobach, kt贸re s w peni kontrolowane przez Ciebie lub na kt贸rych masz uprawnienia do testowania.

```powershell
# Enumerate users
Get-AzADUser
# Get details of a user
Get-AzADUser -UserPrincipalName test@defcorphq.onmicrosoft.com
# Search user by string
Get-AzADUser -SearchString "admin" #Search at the beginnig of DisplayName
Get-AzADUser | ?{$_.Displayname -match "admin"}
# Get roles assigned to a user
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com
```

#### Zmiana hasa u偶ytkownika

{% code overflow="wrap" %}
```powershell
$password = "ThisIsTheNewPassword.!123" | ConvertTo- SecureString -AsPlainText Force

(Get-AzureADUser -All $true | ?{$_.UserPrincipalName -eq "victim@corp.onmicrosoft.com"}).ObjectId | Set- AzureADUserPassword -Password $password Verbose
```
{% endcode %}

### MFA i polityki warunkowego dostpu

Zaleca si dodanie MFA dla ka偶dego u偶ytkownika, jednak niekt贸re firmy mog nie ustawia go lub mog go ustawi z warunkowym dostpem: u偶ytkownik bdzie **wymaga MFA, jeli** zaloguje si z okrelonego miejsca, przegldarki lub **pewnego warunku**. Te polityki, jeli nie s poprawnie skonfigurowane, mog by podatne na **omijanie**. Sprawd藕:

{% content-ref url="az-conditional-access-policies-mfa-bypass.md" %}
[az-conditional-access-policies-mfa-bypass.md](az-conditional-access-policies-mfa-bypass.md)
{% endcontent-ref %}

### Grupy

```powershell
# Enumerate groups
az ad group list
az ad group list --query "[].[displayName]" -o table
# Get info of 1 group
az ad group show --group <group>
# Get "admin" groups
az ad group list --query "[].displayName" | findstr /i "admin"
az ad group list --query "[?contains(displayName,'admin')].displayName"
# All groups from AzureAD
az ad group list --query "[].{osi:onPremisesSecurityIdentifier,displayName:displayName,description:description}[?osi==null]"
az ad group list --query "[?onPremisesSecurityIdentifier==null].displayName"
# All groups synced from on-prem
az ad group list --query "[].{osi:onPremisesSecurityIdentifier,displayName:displayName,description:description}[?osi!=null]"
az ad group list --query "[?onPremisesSecurityIdentifier!=null].displayName"
# Get members of group
az ad group member list --group <group> --query "[].userPrincipalName" -o table
# Check if member of group
az ad group member check --group "VM Admins" --member-id <id>
# Get which groups a group is member of
az ad group get-member-groups -g "VM Admins"
# Get Apps where a group has a role (role not shown)
Get-AzureADGroup -ObjectId <id> | Get-AzureADGroupAppRoleAssignment | fl *
```

Azure AD

```powershell
# Enumerate Groups
Get-AzureADGroup -All $true
# Get info of 1 group
Get-AzADGroup -DisplayName <resource_group_name> | fl
# Get "admin" groups
Get-AzureADGroup -SearchString "admin" | fl #Groups starting by "admin"
Get-AzureADGroup -All $true |?{$_.Displayname -match "admin"} #Groups with the word "admin"
# Get groups allowing dynamic membership
Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}
# All groups that are from Azure AD
Get-AzureADGroup -All $true | ?{$_.OnPremisesSecurityIdentifier -eq $null}
# All groups that are synced from on-prem (note that security groups are not synced)
Get-AzureADGroup -All $true | ?{$_.OnPremisesSecurityIdentifier -ne $null}
# Get members of a group
Get-AzureADGroupMember -ObjectId <group_id>
# Get roles of group
Get-AzureADMSGroup -SearchString "Contoso_Helpdesk_Administrators" #Get group id
Get-AzureADMSRoleAssignment -Filter "principalId eq '69584002-b4d1-4055-9c94-320542efd653'"
# Get Administrative Units of a group
$groupObj = Get-AzureADGroup -Filter "displayname eq 'TestGroup'"
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -Id $_.Id | where {$_.Id -eq $groupObj.ObjectId} }
```

Azure AD jest usug zarzdzania to偶samociami i dostpu w chmurze, kt贸ra zapewnia uwierzytelnianie i autoryzacj dla u偶ytkownik贸w, aplikacji i zasob贸w w rodowisku Azure. W celu przeprowadzenia test贸w penetracyjnych na Azure AD, mo偶na u偶y moduu Az PowerShell, kt贸ry zapewnia zestaw polece do zarzdzania usugami Azure.

Aby rozpocz testy penetracyjne na Azure AD przy u偶yciu Az PowerShell, nale偶y najpierw zainstalowa modu Az PowerShell na swoim komputerze. Mo偶na to zrobi za pomoc polecenia `Install-Module -Name Az -AllowClobber -Scope CurrentUser`, kt贸re zainstaluje najnowsz wersj moduu Az PowerShell.

Po zainstalowaniu moduu Az PowerShell, mo偶na zalogowa si do swojego konta Azure AD za pomoc polecenia `Connect-AzAccount`. Nastpnie mo偶na u偶y r贸偶nych polece, takich jak `Get-AzADUser`, `Get-AzADGroup`, `Get-AzADServicePrincipal`, aby uzyska informacje o u偶ytkownikach, grupach i usugach w Azure AD.

Wa偶ne jest, aby podczas test贸w penetracyjnych na Azure AD zachowa ostro偶no i przestrzega zasad etyki hackingu. Nale偶y uzyska odpowiednie uprawnienia i zgody przed przeprowadzeniem test贸w penetracyjnych, aby unikn naruszenia prawa i zasad dziaania platformy Azure.

```powershell
# Get all groups
Get-AzADGroup
# Get details of a group
Get-AzADGroup -ObjectId <id>
# Search group by string
Get-AzADGroup -SearchString "admin" | fl * #Search at the beginnig of DisplayName
Get-AzADGroup |?{$_.Displayname -match "admin"}
# Get members of group
Get-AzADGroupMember -GroupDisplayName <resource_group_name>
# Get roles of group
Get-AzRoleAssignment -ResourceGroupName <resource_group_name>
```

#### Dodawanie u偶ytkownika do grupy

Waciciele grupy mog dodawa nowych u偶ytkownik贸w do grupy

{% code overflow="wrap" %}
```powershell
Add-AzureADGroupMember -ObjectId <group_id> -RefObjectId <user_id> -Verbose
```
{% endcode %}

{% hint style="warning" %}
Grupy mog by dynamiczne, co oznacza, 偶e **jeli u偶ytkownik spenia okrelone warunki, zostanie dodany do grupy**. Oczywicie, jeli warunki s oparte na **atrybutach**, kt贸re **u偶ytkownik** mo偶e **kontrolowa**, mo偶e on wykorzysta t funkcj, aby **dosta si do innych grup**.\
Sprawd藕, jak wykorzysta dynamiczne grupy na nastpnej stronie:
{% endhint %}

{% content-ref url="dynamic-groups.md" %}
[dynamic-groups.md](dynamic-groups.md)
{% endcontent-ref %}

### Service Principals / Enterprise Applications

{% hint style="info" %}
Nale偶y zauwa偶y, 偶e **Service Principal** w terminologii PowerShell jest nazywany **Enterprise Applications** w portalu Azure (web).
{% endhint %}

{% tabs %}
{% tab title="undefined" %}
```bash
# Get Service Principals
az ad sp list --all
az ad sp list --all --query "[].[displayName]" -o table
# Get details of one SP
az ad sp show --id 00000000-0000-0000-0000-000000000000
# Search SP by string
az ad sp list --all --query "[?contains(displayName,'app')].displayName"
# Get owner of service principal
az ad sp owner list --id <id> --query "[].[displayName]" -o table
# Get service principals owned by the current user
az ad sp list --show-mine
# List apps that have password credentials
az ad sp list --all --query "[?passwordCredentials != null].displayName"
# List apps that have key credentials (use of certificate authentication)
az ad sp list -all --query "[?keyCredentials != null].displayName"
```
{% endtab %}

{% tab title="Azure AD" %}
Azure AD

```powershell
# Get Service Principals
Get-AzureADServicePrincipal -All $true
# Get details about a SP
Get-AzureADServicePrincipal -ObjectId <id> | fl *
# Get SP by string name or Id
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -match "app"} | fl
Get-AzureADServicePrincipal -All $true | ?{$_.AppId -match "103947652-1234-5834-103846517389"}
# Get owner of SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalOwner |fl *
# Get objects owned by a SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalOwnedObject
# Get objects created by a SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalCreatedObject
# Get groups where the SP is a member
Get-AzureADServicePrincipal | Get-AzureADServicePrincipalMembership
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalMembership |fl *
```

Azure AD jest usug zarzdzania to偶samociami i dostpu w chmurze, kt贸ra zapewnia uwierzytelnianie i autoryzacj dla u偶ytkownik贸w, aplikacji i zasob贸w w rodowisku Azure. W celu przeprowadzenia test贸w penetracyjnych na Azure AD, mo偶na u偶y moduu Az PowerShell, kt贸ry zapewnia zestaw polece do zarzdzania usugami Azure.

#### Instalacja moduu Az PowerShell

Aby zainstalowa modu Az PowerShell, wykonaj nastpujce kroki:

1. Otw贸rz program PowerShell jako administrator.
2. Wykonaj polecenie `Install-Module -Name Az -AllowClobber -Scope AllUsers`.

#### Uwierzytelnianie w Azure AD

Aby uwierzytelni si w Azure AD przy u偶yciu moduu Az PowerShell, wykonaj nastpujce kroki:

1. Otw贸rz program PowerShell.
2. Wykonaj polecenie `Connect-AzAccount`.
3. Zostaniesz poproszony o podanie swoich danych uwierzytelniajcych, takich jak nazwa u偶ytkownika i haso.

#### Wykonywanie polece w Azure AD

Po uwierzytelnieniu w Azure AD przy u偶yciu moduu Az PowerShell, mo偶esz wykonywa r贸偶ne polecenia zwizane z zarzdzaniem Azure AD. Oto kilka przykad贸w polece:

* `Get-AzADUser` - pobiera informacje o u偶ytkownikach Azure AD.
* `New-AzADUser` - tworzy nowego u偶ytkownika Azure AD.
* `Set-AzADUser` - aktualizuje informacje o u偶ytkowniku Azure AD.
* `Remove-AzADUser` - usuwa u偶ytkownika Azure AD.

#### Podsumowanie

Modu Az PowerShell zapewnia zestaw polece do zarzdzania Azure AD. Mo偶esz go u偶y do przeprowadzenia test贸w penetracyjnych na Azure AD, wykonujc r贸偶ne operacje zwizane z zarzdzaniem u偶ytkownikami, aplikacjami i zasobami w Azure AD.

```powershell
# Get SPs
Get-AzADServicePrincipal
# Get info of 1 SP
Get-AzADServicePrincipal -ObjectId <id>
# Search SP by string
Get-AzADServicePrincipal | ?{$_.DisplayName -match "app"}
# Get roles of a SP
Get-AzRoleAssignment -ServicePrincipalName <String>
```

## Azure AD

### Introduction

Azure Active Directory (Azure AD) is a cloud-based identity and access management service provided by Microsoft. It allows organizations to manage user identities and control access to resources in the Azure cloud environment.

### Azure AD Security

When performing a security assessment of Azure AD, there are several areas to focus on:

#### User Enumeration

User enumeration involves identifying valid user accounts in Azure AD. This can be done by enumerating through the user list or by using techniques such as password spraying or brute-forcing.

#### Password Attacks

Password attacks involve attempting to crack or guess user passwords in Azure AD. This can be done using techniques such as dictionary attacks, brute-forcing, or password spraying.

#### Privilege Escalation

Privilege escalation involves gaining higher levels of access in Azure AD. This can be achieved by exploiting misconfigurations, vulnerabilities, or weak access controls.

#### Token Manipulation

Token manipulation involves manipulating authentication tokens in Azure AD to gain unauthorized access to resources. This can be done by stealing or forging tokens, or by abusing token-based authentication mechanisms.

#### Federation Attacks

Federation attacks involve exploiting vulnerabilities in the federation setup between Azure AD and other identity providers. This can lead to unauthorized access to Azure AD resources.

#### Data Exfiltration

Data exfiltration involves stealing or leaking sensitive data from Azure AD. This can be done by exploiting vulnerabilities in the Azure AD infrastructure or by abusing user privileges.

### Conclusion

Azure AD is a critical component of the Azure cloud environment, and securing it is essential for maintaining the overall security of an organization's Azure resources. By understanding the various security risks and implementing appropriate security measures, organizations can effectively protect their Azure AD environment from unauthorized access and data breaches.

```powershell
$Token = 'eyJ0eX..'
$URI = 'https://graph.microsoft.com/v1.0/applications'
$RequestParams = @{
Method  = 'GET'
Uri     = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value
```
{% endtab %}
{% endtabs %}

{% hint style="warning" %}
Waciciel Service Principal mo偶e zmieni jego haso.
{% endhint %}

<details>

<summary>Wywietl list i spr贸buj doda tajny klucz klienta do ka偶dej aplikacji przedsibiorstwa</summary>

\`\`\`powershell # Just call Add-AzADAppSecret Function Add-AzADAppSecret { <# .SYNOPSIS Add client secret to the applications.

.PARAMETER GraphToken Pass the Graph API Token

.EXAMPLE PS C:> Add-AzADAppSecret -GraphToken 'eyJ0eX..'

.LINK https://docs.microsoft.com/en-us/graph/api/application-list?view=graph-rest-1.0\&tabs=http https://docs.microsoft.com/en-us/graph/api/application-addpassword?view=graph-rest-1.0\&tabs=http #>

\[CmdletBinding()] param( \[Parameter(Mandatory=$True)] \[String] $GraphToken = $null )

$AppList = $null $AppPassword = $null

## List All the Applications

$Params = @{ "URI" = "https://graph.microsoft.com/v1.0/applications" "Method" = "GET" "Headers" = @{ "Content-Type" = "application/json" "Authorization" = "Bearer $GraphToken" } }

try { $AppList = Invoke-RestMethod @Params -UseBasicParsing } catch { }

## Add Password in the Application

if($AppList -ne $null) { \[System.Collections.ArrayList]$Details = @()

foreach($App in $AppList.value) { $ID = $App.ID $psobj = New-Object PSObject

$Params = @{ "URI" = "https://graph.microsoft.com/v1.0/applications/$ID/addPassword" "Method" = "POST" "Headers" = @{ "Content-Type" = "application/json" "Authorization" = "Bearer $GraphToken" } }

$Body = @{ "passwordCredential"= @{ "displayName" = "Password" } }

try { $AppPassword = Invoke-RestMethod @Params -UseBasicParsing -Body ($Body | ConvertTo-Json) Add-Member -InputObject $psobj -NotePropertyName "Object ID" -NotePropertyValue $ID Add-Member -InputObject $psobj -NotePropertyName "App ID" -NotePropertyValue $App.appId Add-Member -InputObject $psobj -NotePropertyName "App Name" -NotePropertyValue $App.displayName Add-Member -InputObject $psobj -NotePropertyName "Key ID" -NotePropertyValue $AppPassword.keyId Add-Member -InputObject $psobj -NotePropertyName "Secret" -NotePropertyValue $AppPassword.secretText $Details.Add($psobj) | Out-Null } catch { Write-Output "Failed to add new client secret to '$($App.displayName)' Application." } } if($Details -ne $null) { Write-Output "" Write-Output "Client secret added to : " Write-Output $Details | fl \* } } else { Write-Output "Failed to Enumerate the Applications." } }

````
</details>

### Role

<div data-gb-custom-block data-tag="tabs">

<div data-gb-custom-block data-tag="tab" data-title='az cli'>

#### Opis

Rola w Azure AD to zestaw uprawnie, kt贸re okrelaj, jakie czynnoci mo偶e wykonywa u偶ytkownik w organizacji. Mo偶na przypisa role do u偶ytkownik贸w, grup i aplikacji usugi Azure AD. 

#### Polecenia

##### Wywietlanie listy r贸l

```plaintext
az ad sp list
````

**Wywietlanie szczeg贸owych informacji o roli**

```plaintext
az ad sp show --id <role_id>
```

**Tworzenie roli**

```plaintext
az ad sp create-for-rbac --name <role_name> --role <role_type> --scopes <scope>
```

**Usuwanie roli**

```plaintext
az ad sp delete --id <role_id>
```

**Przypisywanie roli do u偶ytkownika**

```plaintext
az role assignment create --assignee <user_id> --role <role_name> --scope <scope>
```

**Usuwanie przypisania roli**

```plaintext
az role assignment delete --assignee <user_id> --role <role_name> --scope <scope>
```

**Wywietlanie przypisanych r贸l**

```plaintext
az role assignment list --assignee <user_id>
```

**Wywietlanie r贸l przypisanych do zasobu**

```plaintext
az role assignment list --scope <scope>
```

**Wywietlanie r贸l przypisanych do grupy**

```plaintext
az role assignment list --assignee-object-id <group_id>
```

**Wywietlanie r贸l przypisanych do aplikacji**

```plaintext
az role assignment list --assignee-object-id <app_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zarzdzanej**

```plaintext
az role assignment list --assignee-object-id <managed_service_id>
```

**Wywietlanie r贸l przypisanych do usugi zar**

```bash
# Get roles
az role definition list
# Get assigned roles
az role assignment list --all --query "[].roleDefinitionName"
az role assignment list --all | jq '.[] | .roleDefinitionName,.scope'
# Get info of 1 role
az role definition list --name "AzureML Registry User"
# Get only custom roles
az role definition list --custom-role-only
# Get only roles assigned to the resource group indicated
az role definition list --resource-group <resource_group>
# Get only roles assigned to the indicated scope
az role definition list --scope <scope>
# Get all the principals a role is assigned to
az role assignment list --all --query "[].{principalName:principalName,principalType:principalType,resourceGroup:resourceGroup,roleDefinitionName:roleDefinitionName}[?roleDefinitionName=='<ROLE_NAME>']"
```

Azure AD

```powershell
# Get all available role templates
Get-AzureADDirectoryroleTemplate
# Get enabled roles (Assigned roles)
Get-AzureADDirectoryRole
Get-AzureADDirectoryRole -ObjectId <roleID> #Get info about the role
# Get custom roles - use AzureAdPreview
Get-AzureADMSRoleDefinition | ?{$_.IsBuiltin -eq $False} | select DisplayName
# Users assigned a role (Global Administrator)
Get-AzureADDirectoryRole -Filter "DisplayName eq 'Global Administrator'" | Get-AzureADDirectoryRoleMember
Get-AzureADDirectoryRole -ObjectId <id> | fl
# Roles of the Administrative Unit (who has permissions over the administrative unit and its members)
Get-AzureADMSScopedRoleMembership -Id <id> | fl *
```

### Opis

Azure AD (Azure Active Directory) to usuga zarzdzania to偶samociami i dostpem w chmurze, kt贸ra jest czsto wykorzystywana w rodowiskach chmurowych. W ramach test贸w penetracyjnych w chmurze, warto zrozumie, jak dziaa Azure AD i jakie s mo偶liwoci ataku na t usug.

### Wykorzystanie

#### Zaloguj si do Azure AD

```powershell
Connect-AzAccount
```

#### Wywietl informacje o u偶ytkownikach

```powershell
Get-AzADUser
```

#### Wywietl informacje o grupach

```powershell
Get-AzADGroup
```

#### Wywietl informacje o aplikacjach

```powershell
Get-AzADApplication
```

#### Wywietl informacje o rolach

```powershell
Get-AzADRoleDefinition
```

#### Wywietl informacje o uprawnieniach

```powershell
Get-AzADServicePrincipalPermission
```

#### Wywietl informacje o kluczach aplikacji

```powershell
Get-AzADApplicationKeyCredential
```

#### Wywietl informacje o tokenach dostpu

```powershell
Get-AzADUserAccessToken
```

#### Wywietl informacje o tokenach odwie偶ajcych

```powershell
Get-AzADUserRefreshToken
```

#### Wywietl informacje o tokenach aplikacji

```powershell
Get-AzADApplicationTokenCredential
```

#### Wywietl informacje o tokenach usugi

```powershell
Get-AzADServicePrincipalAccessToken
```

#### Wywietl informacje o tokenach odwie偶ajcych usugi

```powershell
Get-AzADServicePrincipalRefreshToken
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

```powershell
Get-AzADServicePrincipalTokenCredential
```

#### Wywietl informacje o tokenach aplikacji usugi

````powershell
Get-Az
```powershell
# Get role assignments on the subscription
Get-AzRoleDefinition
# Get Role definition
Get-AzRoleDefinition -Name "Virtual Machine Command Executor"
# Get roles of a user or resource
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com
Get-AzRoleAssignment -Scope /subscriptions/<subscription-id>/resourceGroups/<res_group_name>/providers/Microsoft.Compute/virtualMachines/<vm_name>
````

## Azure AD

### Introduction

Azure Active Directory (Azure AD) is a cloud-based identity and access management service provided by Microsoft. It allows organizations to manage user identities and control access to resources in the Azure cloud environment.

### Azure AD Security

When performing a security assessment of Azure AD, there are several areas to focus on:

#### User Enumeration

User enumeration involves identifying valid user accounts in Azure AD. This can be done through various methods, such as querying the Azure AD Graph API or using the Azure AD PowerShell module.

#### Password Attacks

Password attacks involve attempting to crack or guess user passwords in Azure AD. This can be done using techniques like brute-forcing, dictionary attacks, or password spraying.

#### Privilege Escalation

Privilege escalation involves gaining higher levels of access in Azure AD. This can be achieved by exploiting misconfigurations, vulnerabilities, or weak access controls.

#### Token Manipulation

Token manipulation involves tampering with authentication tokens in Azure AD. This can allow an attacker to impersonate a user or gain unauthorized access to resources.

#### Federation Attacks

Federation attacks involve exploiting vulnerabilities in the federation setup between Azure AD and other identity providers. This can lead to unauthorized access or privilege escalation.

#### Data Exfiltration

Data exfiltration involves stealing sensitive data from Azure AD. This can be done through techniques like exporting user information, accessing confidential files, or exploiting misconfigured permissions.

### Conclusion

Understanding the security risks and vulnerabilities in Azure AD is crucial for organizations using this cloud-based identity and access management service. By identifying and addressing these issues, organizations can enhance the security of their Azure AD environment and protect their sensitive data.

```powershell
# Get permissions over a resource using ARM directly
$Token = (Get-AzAccessToken).Token
$URI = 'https://management.azure.com/subscriptions/b413826f-108d-4049-8c11-d52d5d388768/resourceGroups/Research/providers/Microsoft.Compute/virtualMachines/infradminsrv/providers/Microsoft.Authorization/permissions?api-version=2015-07-01'
$RequestParams = @{
Method = 'GET'
Uri = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value
```

#### Urzdzenia

```bash
# If you know how to do this send a PR!
```

Azure AD

```powershell
# Enumerate Devices
Get-AzureADDevice -All $true | fl *
# List all the active devices (and not the stale devices)
Get-AzureADDevice -All $true | ?{$_.ApproximateLastLogonTimeStamp -ne $null}
# Get owners of all devices
Get-AzureADDevice -All $true | Get-AzureADDeviceRegisteredOwner
Get-AzureADDevice -All $true | %{if($user=Get-AzureADDeviceRegisteredOwner -ObjectId $_.ObjectID){$_;$user.UserPrincipalName;"`n"}}
# Registred users of all the devices
Get-AzureADDevice -All $true | Get-AzureADDeviceRegisteredUser
Get-AzureADDevice -All $true | %{if($user=Get-AzureADDeviceRegisteredUser -ObjectId $_.ObjectID){$_;$user.UserPrincipalName;"`n"}}
# Get dives managed using Intune
Get-AzureADDevice -All $true | ?{$_.IsCompliant -eq "True"}
# Get devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Get Administrative Units of a device
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -ObjectId $_.ObjectId | where {$_.ObjectId -eq $deviceObjId} }
```

Jeli urzdzenie (VM) jest doczone do **AzureAD**, u偶ytkownicy z AzureAD bd mogli si **zalogowa**.\
Ponadto, jeli zalogowany u偶ytkownik jest **Wacicielem** urzdzenia, bdzie on **lokalnym administratorem**.

#### Aplikacje

**Aplikacje** to **Rejestracje aplikacji** w portalu (nie dotyczy aplikacji przedsibiorstwa).\
Ale ka偶da Rejestracja aplikacji utworzy **Aplikacj przedsibiorstwa** (**Podmiot usugi**) o tej samej nazwie.\
Ponadto, jeli aplikacja jest **aplikacj wielotenantow**, zostanie utworzona **inna** Aplikacja przedsibiorstwa (**Podmiot usugi**) w **tym najemcy** o tej samej nazwie.

Podczas generowania aplikacji przypisywane s 2 rodzaje uprawnie:

* **Uprawnienia** przypisane do **Podmiotu usugi**
* **Uprawnienia**, kt贸re **aplikacja** mo偶e mie i u偶ywa **w imieniu u偶ytkownika**.

```bash
# List Apps
az ad app list
az ad app list --query "[].[displayName]" -o table
# Get info of 1 App
az ad app show --id 00000000-0000-0000-0000-000000000000
# Search App by string
az ad app list --query "[?contains(displayName,'app')].displayName"
# Get the owner of an application
az ad app owner list --id <id> --query "[].[displayName]" -o table
# List all the apps with an application password
az ad app list --query "[?passwordCredentials != null].displayName"
# List apps that have key credentials (use of certificate authentication)
az ad app list --query "[?keyCredentials != null].displayName"
```

Azure AD

```powershell
# List all registered applications
Get-AzureADApplication -All $true
# Get details of an application
Get-AzureADApplication -ObjectId <id>  | fl *
# List all the apps with an application password
Get-AzureADApplication -All $true | %{if(Get-AzureADApplicationPasswordCredential -ObjectID $_.ObjectID){$_}}
# Get owner of an application
Get-AzureADApplication -ObjectId <id> | Get-AzureADApplicationOwner |fl *
```

Azure AD jest usug zarzdzania to偶samociami i dostpu w chmurze, kt贸ra zapewnia uwierzytelnianie i autoryzacj dla u偶ytkownik贸w, aplikacji i zasob贸w w rodowisku Azure. W celu przeprowadzenia test贸w penetracyjnych na Azure AD, mo偶na u偶y moduu Az PowerShell, kt贸ry zapewnia zestaw polece do zarzdzania usugami Azure.

Aby rozpocz testy penetracyjne na Azure AD przy u偶yciu Az PowerShell, nale偶y najpierw zainstalowa modu Az PowerShell na swoim komputerze. Mo偶na to zrobi za pomoc polecenia `Install-Module -Name Az -AllowClobber -Scope CurrentUser`, kt贸re zainstaluje najnowsz wersj moduu Az PowerShell.

Po zainstalowaniu moduu Az PowerShell, mo偶na zalogowa si do swojego konta Azure AD za pomoc polecenia `Connect-AzAccount`. Nastpnie mo偶na u偶y r贸偶nych polece Az PowerShell do przeprowadzenia test贸w penetracyjnych na Azure AD, takich jak:

* `Get-AzADUser` - pobiera informacje o u偶ytkownikach Azure AD.
* `Get-AzADServicePrincipal` - pobiera informacje o usugach Azure AD.
* `Get-AzADGroup` - pobiera informacje o grupach Azure AD.
* `Get-AzADGroupMember` - pobiera informacje o czonkach grup Azure AD.
* `Get-AzADApplication` - pobiera informacje o aplikacjach Azure AD.

Pamitaj, 偶e przed przeprowadzeniem test贸w penetracyjnych na Azure AD nale偶y uzyska odpowiednie uprawnienia i zgody. Testy penetracyjne powinny by przeprowadzane tylko na zasobach, kt贸re s w peni kontrolowane przez Ciebie lub na kt贸rych masz uprawnienia do testowania.

```powershell
# Get Apps
Get-AzADApplication
# Get details of one App
Get-AzADApplication -ObjectId <id>
# Get App searching by string
Get-AzADApplication | ?{$_.DisplayName -match "app"}
# Get Apps with password
Get-AzADAppCredential
```

Aplikacja z uprawnieniem **`AppRoleAssignment.ReadWrite`** mo偶e **eskalowa do roli Global Admin** poprzez przyznanie sobie tej roli.\
Wicej informacji [**tutaj**](https://posts.specterops.io/azure-privilege-escalation-via-azure-api-permissions-abuse-74aee1006f48).

Sekretny cig znak贸w, kt贸ry aplikacja u偶ywa do udowodnienia swojej to偶samoci podczas 偶dania tokena, to haso aplikacji.\
Jeli znajdziesz to **haso**, mo偶esz uzyska dostp jako **service principal** **wewntrz** **tenant**a.\
Nale偶y zauwa偶y, 偶e to haso jest widoczne tylko podczas generowania (mo偶esz je zmieni, ale nie mo偶esz go ponownie pobra).\
**Waciciel** aplikacji mo偶e **doda do niej haso** (aby m贸g si podszywa).\
Logowanie jako te service principal nie jest oznaczone jako ryzykowne i nie wymaga MFA.

#### R贸偶nica midzy aplikacjami a (Enterprise Applications lub Service Principals)

R贸偶nica midzy aplikacj a Service Principalem w Azure:

* **Aplikacje/App Registrations**: S to aplikacje, kt贸re istniej w Twoim Azure AD
* `(Get-AzureADApplication -filter "DisplayName eq 'testapp'")`
* **Service Principal/Enterprise Applications**: Obiekty zabezpiecze w Twoim Azure AD, kt贸re mog mie **uprawnienia** w Azure Directory i s powizane z Twoj aplikacj lub aplikacj firm trzecich
* `Get-AzureADServicePrincipal -filter "DisplayName eq 'testapp'")`
* Administrator mo偶e musie zatwierdzi udzielone uprawnienia, jeli s one bardzo wra偶liwe.

Aplikacja mo偶e dziaa w **osobnym tenant**cie, a gdy zaczniesz jej u偶ywa i udzielisz jej dostpu, w Twoim tenantcie zostanie utworzony **Enterprise Application/Service Principal**, aby umo偶liwi jej dostp do potrzebnych informacji:

#### Jednostki administracyjne

Su偶 do lepszego zarzdzania u偶ytkownikami.

Jednostki administracyjne **ograniczaj uprawnienia w roli do dowolnej czci Twojej organizacji**, kt贸r zdefiniujesz. Na przykad, mo偶esz u偶y jednostek administracyjnych do delegowania roli [Helpdesk Administrator](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference#helpdesk-administrator) do specjalist贸w ds. wsparcia regionalnego, aby mogli zarzdza u偶ytkownikami tylko w obszarze, kt贸ry obsuguj.

Dlatego mo偶esz przypisa role do jednostki administratora, a czonkowie tej jednostki bd mie te role.

```
```

```powershell
# Get Administrative Units
Get-AzureADMSAdministrativeUnit
Get-AzureADMSAdministrativeUnit -Id <id>
# Get ID of admin unit by string
$adminUnitObj = Get-AzureADMSAdministrativeUnit -Filter "displayname eq 'Test administrative unit 2'"
# List the users, groups, and devices affected by the administrative unit
Get-AzureADMSAdministrativeUnitMember -Id <id>
# Get the roles users have over the members of the AU
Get-AzureADMSScopedRoleMembership -Id <id> | fl #Get role ID and role members
```

### Azure AD Identity Protection (AIP) <a href="#title-text" id="title-text"></a>

Azure AD Identity Protection (AIP) to usuga bezpieczestwa, kt贸ra wykorzystuje **automatyczne wykrywanie i usuwanie, aby chroni to偶samoci u偶ytkownik贸w w Azure Active Directory przed kompromitacj**. AIP cigle monitoruje i ocenia ryzyko logowania u偶ytkownik贸w oraz konfiguracje to偶samoci, **automatycznie stosujc odpowiednie rodki bezpieczestwa**, takie jak wymaganie uwierzytelniania wieloskadnikowego lub blokowanie potencjalnie niebezpiecznych dziaa. Pomaga to organizacjom zapobiega naruszeniom bezpieczestwa opartym na to偶samoci.

Przebieg:

1. Azure AD Identity Protection **monitoruje dziaania u偶ytkownik贸w** i zbiera dane dotyczce logowania u偶ytkownik贸w, zdarze uwierzytelniania i innych istotnych dziaa.
2. Usuga wykorzystuje **algorytmy uczenia maszynowego** do analizy tych danych i wykrywania potencjalnych zagro偶e dla bezpieczestwa.
3. Azure AD Identity Protection **przypisuje poziom ryzyka zagro偶enia** (np. logowanie) i generuje alert, jeli konieczne jest wykonanie jakiej automatycznej akcji.

### Azure AD Password Protection (APP)

Azure AD Password Protection (APP) to funkcja bezpieczestwa, kt贸ra **pomaga zapobiega stosowaniu sabych hase w Azure Active Directory poprzez narzucanie silnych zasad dotyczcych hase**. APP blokuje **powszechnie stosowane sabe hasa** i ich warianty, zmniejszajc ryzyko narusze zwizanych z hasami. Mo偶e by stosowany zar贸wno na poziomie chmury, jak i w lokalnym katalogu Active Directory, poprawiajc og贸lne bezpieczestwo hase w caej organizacji.

#### References

* [https://learn.microsoft.com/en-us/azure/active-directory/roles/administrative-units](https://learn.microsoft.com/en-us/azure/active-directory/roles/administrative-units)

</details>
