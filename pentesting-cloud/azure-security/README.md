# Azure Pentesting

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* íšŒì‚¬ë¥¼ **HackTricksì—ì„œ ê´‘ê³ **í•˜ê±°ë‚˜ **PDFë¡œ HackTricks ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ìì‹ ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>

## ì•„ì§ AZURE ë°©ë²•ë¡ ì„ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤.

## ê¸°ë³¸ ì •ë³´

{% content-ref url="az-basic-information.md" %}
[az-basic-information.md](az-basic-information.md)
{% endcontent-ref %}

## Azure Pentester/Red Team ë°©ë²•ë¡ 

AZURE í™˜ê²½ì„ ê°ì‚¬í•˜ê¸° ìœ„í•´ì„œëŠ” ì‚¬ìš©ë˜ëŠ” **ì„œë¹„ìŠ¤**, **ë…¸ì¶œë˜ëŠ” ê²ƒ**, ëˆ„ê°€ **ë¬´ì—‡ì— ì•¡ì„¸ìŠ¤**í•˜ëŠ”ì§€, ê·¸ë¦¬ê³  ë‚´ë¶€ Azure ì„œë¹„ìŠ¤ì™€ **ì™¸ë¶€ ì„œë¹„ìŠ¤**ê°€ ì–´ë–»ê²Œ ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.

Red Team ê´€ì ì—ì„œ Azure í™˜ê²½ì„ ì¹¨íˆ¬í•˜ê¸° ìœ„í•œ **ì²« ë²ˆì§¸ ë‹¨ê³„ëŠ” Azure ADì˜ ì¼ë¶€ ìê²© ì¦ëª…ì„ íšë“**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë‹¤ìŒì€ ê·¸ ë°©ë²•ì— ëŒ€í•œ ëª‡ ê°€ì§€ ì•„ì´ë””ì–´ì…ë‹ˆë‹¤:

* github(ë˜ëŠ” ìœ ì‚¬í•œ ê³³)ì—ì„œì˜ **ì •ë³´ ìœ ì¶œ** - OSINT
* **ì‚¬íšŒ ê³µí•™**
* **ë¹„ë°€ë²ˆí˜¸** ì¬ì‚¬ìš© (ë¹„ë°€ë²ˆí˜¸ ìœ ì¶œ)
* Azure-í˜¸ìŠ¤íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì·¨ì•½ì 
* [**ì„œë²„ ì¸¡ ìš”ì²­ ìœ„ì¡°(SSRF)**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) - ë©”íƒ€ë°ì´í„° ì—”ë“œí¬ì¸íŠ¸ì— ì•¡ì„¸ìŠ¤ ê°€ëŠ¥
* **ë¡œì»¬ íŒŒì¼ ì½ê¸°**
* `/home/USERNAME/.azure`
* `C:\Users\USERNAME\.azure`
* 2.30 ì´ì „ì˜ **`az cli`**ì—ì„œ **`accessTokens.json`** íŒŒì¼ - ì•¡ì„¸ìŠ¤ í† í°ì„ **í‰ë¬¸ìœ¼ë¡œ ì €ì¥**
* **`azureProfile.json`** íŒŒì¼ì—ëŠ” ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì— ëŒ€í•œ **ì •ë³´**ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
* **`az logout`** ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ í† í°ì„ ì œê±°í•©ë‹ˆë‹¤.
* ì´ì „ ë²„ì „ì˜ **`Az PowerShell`**ì€ **`TokenCache.dat`**ì— ì•¡ì„¸ìŠ¤ í† í°ì„ **í‰ë¬¸**ìœ¼ë¡œ ì €ì¥í–ˆìŠµë‹ˆë‹¤. ë˜í•œ **`AzureRmContext.json`**ì— **ServicePrincipalSecret**ì„ **í‰ë¬¸**ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤. **`Save-AzContext`** cmdletì„ ì‚¬ìš©í•˜ì—¬ **í† í°**ì„ **ì €ì¥**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
`Disconnect-AzAccount`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì œê±°í•˜ì„¸ìš”.
* íƒ€ì‚¬ **ì¹¨í•´**
* **ë‚´ë¶€** ì§ì›
* [**ì¼ë°˜ì ì¸ í”¼ì‹±**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (ìê²© ì¦ëª… ë˜ëŠ” Oauth ì•±)
* [ì¥ì¹˜ ì½”ë“œ ì¸ì¦ í”¼ì‹±](az-unauthenticated-enum-and-initial-entry/az-device-code-authentication-phishing.md)
* [Azure **ë¹„ë°€ë²ˆí˜¸ ìŠ¤í”„ë ˆì´**](az-unauthenticated-enum-and-initial-entry/az-password-spraying.md)

Azure í…Œë„ŒíŠ¸ ë‚´ì—ì„œ ì‚¬ìš©ìë¥¼ ì¹¨íˆ¬í•˜ì§€ ì•Šì•˜ë”ë¼ë„ ì¼ë¶€ ì •ë³´ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="az-unauthenticated-enum-and-initial-entry/" %}
[az-unauthenticated-enum-and-initial-entry](az-unauthenticated-enum-and-initial-entry/)
{% endcontent-ref %}

{% hint style="info" %}
ìê²© ì¦ëª…ì„ íšë“í•œ í›„ì—ëŠ” í•´ë‹¹ ìê²© ì¦ëª…ì´ **ëˆ„êµ¬ì—ê²Œ ì†í•˜ëŠ”ì§€**ì™€ **ë¬´ì—‡ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ”ì§€** ì•Œì•„ì•¼ í•˜ë¯€ë¡œ ê¸°ë³¸ì ì¸ ì—´ê±° ì‘ì—…ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤:
{% endhint %}

## ê¸°ë³¸ ì—´ê±°

{% hint style="info" %}
ì—´ê±°ì˜ **ê°€ì¥ ì‹œë„ëŸ¬ìš´** ë¶€ë¶„ì€ **ë¡œê·¸ì¸**ì´ë©°, ì—´ê±° ìì²´ëŠ” ê·¸ë ‡ê²Œ ì‹œë„ëŸ½ì§€ ì•ŠìŠµë‹ˆë‹¤.
{% endhint %}

### SSRF

Azure ë‚´ë¶€ì˜ ë¨¸ì‹ ì—ì„œ SSRFë¥¼ ì°¾ì€ ê²½ìš° ë‹¤ìŒ í˜ì´ì§€ì—ì„œ íŠ¸ë¦­ì„ í™•ì¸í•˜ì„¸ìš”:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### ë¡œê·¸ì¸ ì¡°ê±´ ìš°íšŒ

<figure><img src="../../.gitbook/assets/image (1) (2) (2).png" alt=""><figcaption></figcaption></figure>

ìœ íš¨í•œ ìê²© ì¦ëª…ì´ ìˆì§€ë§Œ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ëŠ” ê²½ìš° ì¼ë°˜ì ìœ¼ë¡œ ì ìš©ë˜ëŠ” ì¼ë¶€ ë³´í˜¸ ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* **IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸** - ìœ íš¨í•œ IPë¥¼ ì¹¨íˆ¬í•´ì•¼ í•©ë‹ˆë‹¤.
* **ì§€ë¦¬ì  ì œí•œ** - ì‚¬ìš©ìê°€ ì‚¬ëŠ” ê³³ì´ë‚˜ íšŒì‚¬ì˜ ì‚¬ë¬´ì‹¤ì´ ìˆëŠ” ê³³ì„ ì°¾ì•„ ë™ì¼í•œ ë„ì‹œ(ë˜ëŠ” ì ì–´ë„ ë™ì¼í•œ êµ­ê°€)ì˜ IPë¥¼ ì–»ìœ¼ì„¸ìš”.
* **ë¸Œë¼ìš°ì €** - íŠ¹ì • OS(Windows, Linux, Mac, Android, iOS)ì—ì„œë§Œ ë¸Œë¼ìš°ì €ê°€ í—ˆìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”¼í•´ì/íšŒì‚¬ê°€ ì‚¬ìš©í•˜ëŠ” OSë¥¼ í™•ì¸í•˜ì„¸ìš”.
* ì¼ë°˜ì ìœ¼ë¡œ **Service Principal ìê²© ì¦ëª…**ì„ ì¹¨íˆ¬í•˜ë ¤ê³  ì‹œë„í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ ìê²© ì¦ëª…ì€ ì¼ë°˜ì ìœ¼ë¡œ ì œí•œì´ ëœ ê°€í•´ì§€ë©° ë¡œê·¸ì¸ì´ ëœ ê²€í† ë©ë‹ˆë‹¤.

ìš°íšŒí•œ í›„ì—ëŠ” ì´ˆê¸° ì„¤ì •ìœ¼ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆìœ¼ë©° ì—¬ì „íˆ ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìœ ì§€ë©ë‹ˆë‹¤.

### ì„œë¸Œë„ë©”ì¸ íƒˆì·¨

* [https://godiego.co/posts/STO-Azure/](https://godiego.co/posts/STO-Azure/)

### Whoami

{% hint style="danger" %}
[Az - AzureAD](az-azuread/) ì„¹ì…˜ì—ì„œ **az cli, AzureAD ë° Az PowerShellì„ ì„¤ì¹˜í•˜ëŠ” ë°©ë²•**ì„ ë°°ì›Œë³´ì„¸ìš”.
{% endhint %}

ì•Œì•„ì•¼ í•  ê°€ì¥ ì²˜ìŒì˜ ê²ƒì€ **ìì‹ ì´ ëˆ„êµ¬ì¸ì§€**(ì–´ë–¤ í™˜ê²½ì— ìˆëŠ”ì§€) ì•Œì•„ì•¼ í•©ë‹ˆë‹¤:

{% tabs %}
{% tab title="az cli" %}
```bash
az account list
az account tenant list # Current tenant info
az account subscription list # Current subscription info
az ad signed-in-user show # Current signed-in user
az ad signed-in-user list-owned-objects # Get owned objects by current user
az account management-group list #Not allowed by default
```
{% endtab %}

{% tab title="AzureAD" %}AzureAD{% endtab %}
```powershell
#Get the current session state
Get-AzureADCurrentSessionInfo
#Get details of the current tenant
Get-AzureADTenantDetail
```
{% endtab %}

{% tab title="Az PowerShell" %}Az PowerShell{% endtab %}
```powershell
# Get the information about the current context (Account, Tenant, Subscription etc.)
Get-AzContext
# List all available contexts
Get-AzContext -ListAvailable
# Enumerate subscriptions accessible by the current user
Get-AzSubscription
#Get Resource group
Get-AzResourceGroup
# Enumerate all resources visible to the current user
Get-AzResource
# Enumerate all Azure RBAC role assignments
Get-AzRoleAssignment # For all users
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com # For current user
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Azureë¥¼ ì—´ê±°í•˜ê¸° ìœ„í•œ ê°€ì¥ ì¤‘ìš”í•œ ëª…ë ¹ ì¤‘ í•˜ë‚˜ëŠ” Az PowerShellì˜ **`Get-AzResource`**ì…ë‹ˆë‹¤. ì´ ëª…ë ¹ì„ ì‚¬ìš©í•˜ë©´ í˜„ì¬ ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì›¹ ì½˜ì†”ì—ì„œë„ ë™ì¼í•œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. [https://portal.azure.com/#view/HubsExtension/BrowseAll](https://portal.azure.com/#view/HubsExtension/BrowseAll)ë¡œ ì´ë™í•˜ê±°ë‚˜ "ëª¨ë“  ë¦¬ì†ŒìŠ¤"ë¥¼ ê²€ìƒ‰í•˜ë©´ ë©ë‹ˆë‹¤.
{% endhint %}

### AzureAD ì—´ê±°

ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ì‚¬ìš©ìëŠ” ì‚¬ìš©ì, ê·¸ë£¹, ì—­í• , ì„œë¹„ìŠ¤ ì£¼ì²´ ë“±ì„ ì—´ê±°í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê¶Œí•œì„ ê°–ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ([ê¸°ë³¸ AzureAD ê¶Œí•œ](az-basic-information.md#default-user-permissions)ì„ í™•ì¸í•˜ì„¸ìš”).\
ì—¬ê¸°ì—ì„œ ê°€ì´ë“œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

{% hint style="info" %}
ì´ì œ ìê²© ì¦ëª…ì— ëŒ€í•œ ì¼ë¶€ ì •ë³´ë¥¼ ì•Œì•˜ìœ¼ë¯€ë¡œ (ë ˆë“œ íŒ€ì¸ ê²½ìš° ê°ì§€ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤). í™˜ê²½ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ íŒŒì•…í•´ì•¼ í•©ë‹ˆë‹¤.\
ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ì¼ë¶€ ì¼ë°˜ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ì—´ê±°í•˜ëŠ” ë°©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

## ì„œë¹„ìŠ¤ ì£¼ì²´ ë° ì•¡ì„¸ìŠ¤ ì •ì±…

Azure ì„œë¹„ìŠ¤ëŠ” ì‹œìŠ¤í…œ ID(ì„œë¹„ìŠ¤ ìì²´ì˜ ID) ë˜ëŠ” ì‚¬ìš©ì ì§€ì • ê´€ë¦¬ IDë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ IDëŠ” ì˜ˆë¥¼ ë“¤ì–´ KeyVaultì—ì„œ ë¹„ë°€ì„ ì½ê¸° ìœ„í•œ ì•¡ì„¸ìŠ¤ ì •ì±…ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì•¡ì„¸ìŠ¤ ì •ì±…ì€ ì œí•œë˜ì–´ì•¼ í•˜ì§€ë§Œ í•„ìš”í•œ ê²ƒë³´ë‹¤ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ App ServiceëŠ” ë¹„ë°€ê³¼ ì¸ì¦ì„œë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•´ KeyVaultë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ ì´ëŸ¬í•œ IDë¥¼ íƒìƒ‰í•˜ëŠ” ê²ƒì´ ìœ ìš©í•©ë‹ˆë‹¤.

## App Service SCM

App Service 'ì»¨í…Œì´ë„ˆ'ì— ë¡œê·¸ì¸í•˜ê¸° ìœ„í•œ Kudu ì½˜ì†”ì…ë‹ˆë‹¤.

## ì›¹ ì‰˜

portal.azure.comì„ ì‚¬ìš©í•˜ì—¬ ì‰˜ì„ ì„ íƒí•˜ê±°ë‚˜ shell.azure.comì„ ì‚¬ìš©í•˜ì—¬ bash ë˜ëŠ” powershellì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì‰˜ì˜ 'ë””ìŠ¤í¬'ëŠ” ìŠ¤í† ë¦¬ì§€ ê³„ì •ì˜ ì´ë¯¸ì§€ íŒŒì¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.

## Azure DevOps

Azure DevOpsëŠ” Azureì™€ ë³„ê°œì…ë‹ˆë‹¤. ì €ì¥ì†Œ, íŒŒì´í”„ë¼ì¸(yaml ë˜ëŠ” ë¦´ë¦¬ìŠ¤), ë³´ë“œ, ìœ„í‚¤ ë“±ì´ ìˆìŠµë‹ˆë‹¤. ë³€ìˆ˜ ê·¸ë£¹ì€ ë³€ìˆ˜ ê°’ê³¼ ë¹„ë°€ì„ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

## ìë™í™”ëœ Recon ë„êµ¬

### [**ROADRecon**](https://github.com/dirkjanm/ROADtools)
```powershell
cd ROADTools
pipenv shell
roadrecon auth -u test@corp.onmicrosoft.com -p "Welcome2022!"
roadrecon gather
roadrecon gui
```
### [Monkey365](https://github.com/silverhack/monkey365)

{% code overflow="wrap" %}
```powershell
Import-Module monkey365
Get-Help Invoke-Monkey365
Get-Help Invoke-Monkey365 -Detailed
Invoke-Monkey365 -IncludeAzureActiveDirectory -ExportTo HTML -Verbose -Debug -InformationAction Continue
Invoke-Monkey365 - Instance Azure -Analysis All -ExportTo HTML
```
{% endcode %}

### [**Stormspotter**](https://github.com/Azure/Stormspotter)
```powershell
# Start Backend
cd stormspotter\backend\
pipenv shell
python ssbackend.pyz

# Start Front-end
cd stormspotter\frontend\dist\spa\
quasar.cmd serve -p 9091 --history

# Run Stormcollector
cd stormspotter\stormcollector\
pipenv shell
az login -u test@corp.onmicrosoft.com -p Welcome2022!
python stormspotter\stormcollector\sscollector.pyz cli
# This will generate a .zip file to upload in the frontend (127.0.0.1:9091)
```
### [**AzureHound**](https://github.com/BloodHoundAD/AzureHound)

AzureHoundì€ Azure AD í™˜ê²½ì—ì„œ ì‚¬ìš©ë˜ëŠ” BloodHound í”„ë¡œì íŠ¸ì˜ í™•ì¥ì…ë‹ˆë‹¤. Azure ADì˜ ê¶Œí•œ ë° ê´€ê³„ë¥¼ ë¶„ì„í•˜ì—¬ ê³µê²©ìê°€ íŠ¹ì • ê¶Œí•œ ìƒìŠ¹ ê²½ë¡œë¥¼ ì‹ë³„í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.

AzureHoundëŠ” Azure ADì˜ ë‹¤ì–‘í•œ êµ¬ì„± ìš”ì†Œë¥¼ ê²€ìƒ‰í•˜ê³ , ì‚¬ìš©ì, ê·¸ë£¹, ì„œë¹„ìŠ¤ ì£¼ì²´, ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ì˜ ê´€ê³„ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” Azure AD í™˜ê²½ì—ì„œì˜ ê¶Œí•œ ìƒìŠ¹ ê°€ëŠ¥ì„±ì„ íŒŒì•…í•˜ê³ , ì·¨ì•½ì ì„ ì•…ìš©í•  ìˆ˜ ìˆëŠ” ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

AzureHoundëŠ” BloodHoundì˜ ë°ì´í„° ìˆ˜ì§‘ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ Azure ADì˜ ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ Azure ADì˜ APIë¥¼ ì‚¬ìš©í•˜ë©°, ì´ë¥¼ ìœ„í•œ ì¸ì¦ ì •ë³´ë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤. AzureHoundëŠ” Azure ADì˜ ì •ë³´ë¥¼ ìˆ˜ì§‘í•œ í›„, BloodHoundì˜ ê·¸ë˜í”„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ì—¬ ì‹œê°í™” ë° ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

AzureHoundëŠ” Azure AD í™˜ê²½ì—ì„œì˜ ê¶Œí•œ ìƒìŠ¹ ê³µê²©ì„ íƒì§€í•˜ê³  ë°©ì§€í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ë³´ì•ˆ ì „ë¬¸ê°€ì™€ íŒŒíŠ¸ë„ˆëŠ” Azure AD í™˜ê²½ì˜ ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•´ AzureHoundë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

AzureHoundëŠ” BloodHound í”„ë¡œì íŠ¸ì˜ ì¼ë¶€ë¡œ ì œê³µë˜ë©°, GitHubì—ì„œ ë¬´ë£Œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Azure AD í™˜ê²½ì—ì„œì˜ ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•´ AzureHoundë¥¼ ì‚¬ìš©í•´ ë³´ì„¸ìš”.
```powershell
# You need to use the Az PowerShell and Azure AD modules:
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@corp.onmicrosoft.com", $passwd)
Connect-AzAccount -Credential $creds

Import-Module AzureAD\AzureAD.psd1
Connect-AzureAD -Credential $creds

# Launch AzureHound
. AzureHound\AzureHound.ps1
Invoke-AzureHound -Verbose

# Simple queries
## All Azure Users
MATCH (n:AZUser) return n.name
## All Azure Applications
MATCH (n:AZApp) return n.objectid
## All Azure Devices
MATCH (n:AZDevice) return n.name
## All Azure Groups
MATCH (n:AZGroup) return n.name
## All Azure Key Vaults
MATCH (n:AZKeyVault) return n.name
## All Azure Resource Groups
MATCH (n:AZResourceGroup) return n.name
## All Azure Service Principals
MATCH (n:AZServicePrincipal) return n.objectid
## All Azure Virtual Machines
MATCH (n:AZVM) return n.name
## All Principals with the â€˜Contributorâ€™ role
MATCH p = (n)-[r:AZContributor]->(g) RETURN p

# Advanced queries
## Get Global Admins
MATCH p =(n)-[r:AZGlobalAdmin*1..]->(m) RETURN p
## Owners of Azure Groups
MATCH p = (n)-[r:AZOwns]->(g:AZGroup) RETURN p
## All Azure Users and their Groups
MATCH p=(m:AZUser)-[r:MemberOf]->(n) WHERE NOT m.objectid CONTAINS 'S-1-5' RETURN p
## Privileged Service Principals
MATCH p = (g:AZServicePrincipal)-[r]->(n) RETURN p
## Owners of Azure Applications
MATCH p = (n)-[r:AZOwns]->(g:AZApp) RETURN p
## Paths to VMs
MATCH p = (n)-[r]->(g: AZVM) RETURN p
## Paths to KeyVault
MATCH p = (n)-[r]->(g:AZKeyVault) RETURN p
## Paths to Azure Resource Group
MATCH p = (n)-[r]->(g:AZResourceGroup) RETURN p
## On-Prem users with edges to Azure
MATCH  p=(m:User)-[r:AZResetPassword|AZOwns|AZUserAccessAdministrator|AZContributor|AZAddMembers|AZGlobalAdmin|AZVMContributor|AZOwnsAZAvereContributor]->(n) WHERE m.objectid CONTAINS 'S-1-5-21' RETURN p
## All Azure AD Groups that are synchronized with On-Premise AD
MATCH (n:Group) WHERE n.objectid CONTAINS 'S-1-5' AND n.azsyncid IS NOT NULL RETURN n
```
### [Azucar](https://github.com/nccgroup/azucar)

Azucarì€ Azure í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œì˜ ë³´ì•ˆ í‰ê°€ë¥¼ ìœ„í•œ ë„êµ¬ì…ë‹ˆë‹¤. ì´ ë„êµ¬ëŠ” Azure ë¦¬ì†ŒìŠ¤ì˜ êµ¬ì„± ë° ë³´ì•ˆ ì„¤ì •ì„ ë¶„ì„í•˜ê³  ì·¨ì•½ì ì„ ì‹ë³„í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤. Azucarì€ Azure Resource Manager(ARM) í…œí”Œë¦¿, Azure CLI ëª…ë ¹ì–´ ë° Azure Portalì„ ì‚¬ìš©í•˜ì—¬ Azure ë¦¬ì†ŒìŠ¤ë¥¼ ì¡°ì‘í•˜ê³  ë¶„ì„í•©ë‹ˆë‹¤.

Azucarì€ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

- Azure ë¦¬ì†ŒìŠ¤ì˜ êµ¬ì„± ë° ë³´ì•ˆ ì„¤ì •ì„ ë¶„ì„í•˜ì—¬ ì·¨ì•½ì ì„ ì‹ë³„í•©ë‹ˆë‹¤.
- Azure ë¦¬ì†ŒìŠ¤ì˜ ì•¡ì„¸ìŠ¤ ì œì–´ ë° ê¶Œí•œ ë¶€ì—¬ ì„¤ì •ì„ í‰ê°€í•©ë‹ˆë‹¤.
- Azure ë¦¬ì†ŒìŠ¤ì˜ ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ êµ¬ì„±ì„ ë¶„ì„í•©ë‹ˆë‹¤.
- Azure ë¦¬ì†ŒìŠ¤ì˜ ì•”í˜¸í™” ë° ë³´ì•ˆ ê¸°ëŠ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.
- Azure ë¦¬ì†ŒìŠ¤ì˜ ë¡œê¹… ë° ê°ì‚¬ ì„¤ì •ì„ ë¶„ì„í•©ë‹ˆë‹¤.

Azucarì€ Azure í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œì˜ ë³´ì•ˆ í‰ê°€ë¥¼ ìœ„í•œ ê°•ë ¥í•œ ë„êµ¬ë¡œ, Azure ë¦¬ì†ŒìŠ¤ì˜ ë³´ì•ˆ ì·¨ì•½ì ì„ ì‹ë³„í•˜ê³  ë³´ì•ˆ ìˆ˜ì¤€ì„ í–¥ìƒì‹œí‚¤ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.
```bash
# You should use an account with at least read-permission on the assets you want to access
git clone https://github.com/nccgroup/azucar.git
PS> Get-ChildItem -Recurse c:\Azucar_V10 | Unblock-File

PS> .\Azucar.ps1 -AuthMode UseCachedCredentials -Verbose -WriteLog -Debug -ExportTo PRINT
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -CertFilePassword MySuperP@ssw0rd! -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000

# resolve the TenantID for an specific username
PS> .\Azucar.ps1 -ResolveTenantUserName user@company.com
```
### [**MicroBurst**](https://github.com/NetSPI/MicroBurst)

MicroBurstëŠ” Azure í™˜ê²½ì—ì„œì˜ ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•œ ë„êµ¬ì…ë‹ˆë‹¤. ì´ ë„êµ¬ëŠ” Azure ADì˜ ì•…ìš©ì„ í†µí•´ ê¶Œí•œ ìƒìŠ¹ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. MicroBurstëŠ” Azure ADì˜ íŠ¹ì • ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìë¡œ ì¸ì¦í•˜ì—¬ Azure ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ íšë“í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” Azure í™˜ê²½ì—ì„œ ë” í° ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

MicroBurstëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

- Azure ADì˜ ì‚¬ìš©ì ë° ê·¸ë£¹ ì •ë³´ ìˆ˜ì§‘
- Azure ADì˜ ì‚¬ìš©ìì˜ ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•œ ê³µê²© ê²½ë¡œ ì‹ë³„
- Azure ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•œ ê³µê²© ê²½ë¡œ ì‹ë³„

MicroBurstëŠ” Azure í™˜ê²½ì—ì„œì˜ ê¶Œí•œ ìƒìŠ¹ ê³µê²©ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤. ì´ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ Azure í™˜ê²½ì˜ ë³´ì•ˆ ì·¨ì•½ì ì„ ì‹ë³„í•˜ê³  ë³´í˜¸ ìˆ˜ì¤€ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
Import-Module .\MicroBurst.psm1
Import-Module .\Get-AzureDomainInfo.ps1
Get-AzureDomainInfo -folder MicroBurst -Verbose
```
### [**PowerZure**](https://github.com/hausec/PowerZure)

PowerZureì€ Azure í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ í¸ë¦¬í•œ íœí…ŒìŠ¤íŒ… ë° ë³´ì•ˆ í‰ê°€ë¥¼ ìœ„í•œ PowerShell ìŠ¤í¬ë¦½íŠ¸ ëª¨ìŒì…ë‹ˆë‹¤. ì´ ë„êµ¬ëŠ” Azure ë¦¬ì†ŒìŠ¤ë¥¼ ê²€ìƒ‰í•˜ê³ , ê¶Œí•œ ìƒìŠ¹ ë° ê¶Œí•œ ë¶€ì—¬, ë°ì´í„° ìœ ì¶œ ë° ì•…ìš© ê°€ëŠ¥ì„±ì„ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

PowerZureì€ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

- Azure ë¦¬ì†ŒìŠ¤ ê²€ìƒ‰ ë° ì •ë³´ ìˆ˜ì§‘
- Azure ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ê¶Œí•œ ìƒìŠ¹ ë° ê¶Œí•œ ë¶€ì—¬
- Azure ë¦¬ì†ŒìŠ¤ì—ì„œ ë°ì´í„° ìœ ì¶œ ë° ì•…ìš© ê°€ëŠ¥ì„± í™•ì¸
- Azure ë¦¬ì†ŒìŠ¤ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ì•…ì„± ì½”ë“œ ì‹¤í–‰

PowerZureì€ Azure í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ íœí…ŒìŠ¤íŒ… ë° ë³´ì•ˆ í‰ê°€ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë° ìœ ìš©í•œ ë„êµ¬ì…ë‹ˆë‹¤. Azure í™˜ê²½ì—ì„œ ë³´ì•ˆ ì·¨ì•½ì ì„ ì‹ë³„í•˜ê³  í•´ê²°í•˜ê¸° ìœ„í•´ PowerZureì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```powershell
Connect-AzAccount
ipmo C:\Path\To\Powerzure.psd1
Get-AzureTarget

# Reader
$ Get-Runbook, Get-AllUsers, Get-Apps, Get-Resources, Get-WebApps, Get-WebAppDetails

# Contributor
$ Execute-Command -OS Windows -VM Win10Test -ResourceGroup Test-RG -Command "whoami"
$ Execute-MSBuild -VM Win10Test  -ResourceGroup Test-RG -File "build.xml"
$ Get-AllSecrets # AllAppSecrets, AllKeyVaultContents
$ Get-AvailableVMDisks, Get-VMDisk # Download a virtual machine's disk

# Owner
$ Set-Role -Role Contributor -User test@contoso.com -Resource Win10VMTest

# Administrator
$ Create-Backdoor, Execute-Backdoor
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
