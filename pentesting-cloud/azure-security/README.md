# Azure ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ

<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã™ã‚‹ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã™ã‚‹ã€‚

</details>

## ç§ã¯ã¾ã AZUREãƒ¡ã‚½ãƒ‰ãƒ­ã‚¸ãƒ¼ã‚’æ§‹ç¯‰ä¸­ã§ã™

## åŸºæœ¬æƒ…å ±

{% content-ref url="az-basic-information.md" %}
[az-basic-information.md](az-basic-information.md)
{% endcontent-ref %}

## Azure ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼/ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ãƒ¡ã‚½ãƒ‰ãƒ­ã‚¸ãƒ¼

AZUREç’°å¢ƒã‚’ç›£æŸ»ã™ã‚‹ãŸã‚ã«ã¯ã€ã©ã®**ã‚µãƒ¼ãƒ“ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹**ã€ä½•ãŒ**å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‹**ã€èª°ãŒä½•ã«**ã‚¢ã‚¯ã‚»ã‚¹**ã—ã¦ã„ã‚‹ã‹ã€ãã—ã¦å†…éƒ¨ã®Azureã‚µãƒ¼ãƒ“ã‚¹ã¨**å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹**ãŒã©ã®ã‚ˆã†ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ã‚’çŸ¥ã‚‹ã“ã¨ãŒéå¸¸ã«é‡è¦ã§ã™ã€‚

ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã®è¦³ç‚¹ã‹ã‚‰è¦‹ã‚‹ã¨ã€**Azureç’°å¢ƒã‚’ä¾µå®³ã™ã‚‹æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—**ã¯ã€Azure ADã®ã„ãã¤ã‹ã®**è³‡æ ¼æƒ…å ±**ã‚’å–å¾—ã™ã‚‹ã“ã¨ã§ã™ã€‚ä»¥ä¸‹ã«ãã®æ–¹æ³•ã«ã¤ã„ã¦ã„ãã¤ã‹ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ç¤ºã—ã¾ã™ï¼š

* githubï¼ˆã¾ãŸã¯é¡ä¼¼ã®ã‚‚ã®ï¼‰ã§ã®**ãƒªãƒ¼ã‚¯** - OSINT
* **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«**ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
* **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ã®å†åˆ©ç”¨ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªãƒ¼ã‚¯ï¼‰
* Azureãƒ›ã‚¹ãƒˆå‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§
* ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŒã¤[**ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒª**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf)
* **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒ¼ãƒ‰**
* `/home/USERNAME/.azure`
* `C:\Users\USERNAME\.azure`
* 2.30ç‰ˆä»¥å‰ã®`az cli`ã®**`accessTokens.json`**ãƒ•ã‚¡ã‚¤ãƒ« - 2022å¹´1æœˆ - **ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å¹³æ–‡ã§ä¿å­˜**
* **`azureProfile.json`**ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢ã™ã‚‹**æƒ…å ±**ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
* **`az logout`**ã¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰Šé™¤ã—ã¾ã™ã€‚
* å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®**`Az PowerShell`**ã¯**ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³**ã‚’**`TokenCache.dat`**ã®å¹³æ–‡ã§ä¿å­˜ã—ã¦ã„ã¾ã—ãŸã€‚ã¾ãŸã€**`AzureRmContext.json`**ã®å¹³æ–‡ã§**ServicePrincipalSecret**ã‚’ä¿å­˜ã—ã¦ã„ã¾ã™ã€‚**`Save-AzContext`**ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦**ãƒˆãƒ¼ã‚¯ãƒ³**ã‚’**ä¿å­˜**ã§ãã¾ã™ã€‚
`Disconnect-AzAccount`ã‚’ä½¿ç”¨ã—ã¦ãã‚Œã‚‰ã‚’å‰Šé™¤ã—ã¾ã™ã€‚
* **ç¬¬ä¸‰è€…**ã®ä¾µå®³
* **å†…éƒ¨**å¾“æ¥­å“¡
* [**ä¸€èˆ¬çš„ãªãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology)ï¼ˆè³‡æ ¼æƒ…å ±ã¾ãŸã¯Oauthã‚¢ãƒ—ãƒªï¼‰
* [ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ¼ãƒ‰èªè¨¼ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°](az-unauthenticated-enum-and-initial-entry/az-device-code-authentication-phishing.md)
* [Azure **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ—ãƒ¬ãƒ¼**](az-unauthenticated-enum-and-initial-entry/az-password-spraying.md)

æ”»æ’ƒã—ã¦ã„ã‚‹Azureãƒ†ãƒŠãƒ³ãƒˆå†…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’**ä¾µå®³ã—ã¦ã„ãªãã¦ã‚‚**ã€ãã‚Œã«é–¢ã™ã‚‹ã„ãã¤ã‹ã®æƒ…å ±ã‚’**åé›†ã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="az-unauthenticated-enum-and-initial-entry/" %}
[az-unauthenticated-enum-and-initial-entry](az-unauthenticated-enum-and-initial-entry/)
{% endcontent-ref %}

{% hint style="info" %}
è³‡æ ¼æƒ…å ±ã‚’å–å¾—ã—ãŸå¾Œã€ãã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ãŒ**èª°ã«å±ã—ã¦ã„ã‚‹ã‹**ã€ãã—ã¦**ä½•ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹**ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€åŸºæœ¬çš„ãªåˆ—æŒ™ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
{% endhint %}

## åŸºæœ¬çš„ãªåˆ—æŒ™

{% hint style="info" %}
åˆ—æŒ™ã®æœ€ã‚‚**é¨’ã€…ã—ã„**éƒ¨åˆ†ã¯åˆ—æŒ™è‡ªä½“ã§ã¯ãªãã€**ãƒ­ã‚°ã‚¤ãƒ³**ã§ã‚ã‚‹ã“ã¨ã‚’è¦šãˆã¦ãŠã„ã¦ãã ã•ã„ã€‚
{% endhint %}

### SSRF

Azureå†…ã®ãƒã‚·ãƒ³ã§SSRFã‚’è¦‹ã¤ã‘ãŸå ´åˆã¯ã€ã“ã®ãƒšãƒ¼ã‚¸ã®ãƒˆãƒªãƒƒã‚¯ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼š

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### ãƒ­ã‚°ã‚¤ãƒ³æ¡ä»¶ã®ãƒã‚¤ãƒ‘ã‚¹

<figure><img src="../../.gitbook/assets/image (1) (2) (2).png" alt=""><figcaption></figcaption></figure>

æœ‰åŠ¹ãªè³‡æ ¼æƒ…å ±ãŒã‚ã‚‹ãŒãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„å ´åˆã€ã“ã‚Œã‚‰ã¯å­˜åœ¨ã—ã¦ã„ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ä¸€èˆ¬çš„ãªä¿è­·æªç½®ã§ã™ï¼š

* **IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ** -- æœ‰åŠ¹ãªIPã‚’ä¾µå®³ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
* **åœ°ç†çš„åˆ¶é™** -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½ã‚“ã§ã„ã‚‹å ´æ‰€ã‚„ä¼šç¤¾ã®ã‚ªãƒ•ã‚£ã‚¹ãŒã©ã“ã«ã‚ã‚‹ã‹ã‚’è¦‹ã¤ã‘ã€åŒã˜å¸‚ï¼ˆã¾ãŸã¯å°‘ãªãã¨ã‚‚å›½ï¼‰ã‹ã‚‰IPã‚’å–å¾—ã—ã¾ã™
* **ãƒ–ãƒ©ã‚¦ã‚¶** -- ç‰¹å®šã®OSï¼ˆWindowsã€Linuxã€Macã€Androidã€iOSï¼‰ã‹ã‚‰ã®ãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚è¢«å®³è€…/ä¼šç¤¾ãŒä½¿ç”¨ã—ã¦ã„ã‚‹OSã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚
* ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã®è³‡æ ¼æƒ…å ±ã‚’ä¾µå®³ã—ã‚ˆã†ã¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚é€šå¸¸ã€ã“ã‚Œã‚‰ã¯åˆ¶é™ãŒå°‘ãªãã€ãƒ­ã‚°ã‚¤ãƒ³ãŒã‚ã¾ã‚Šç¢ºèªã•ã‚Œã¦ã„ã¾ã›ã‚“

ãã‚Œã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ãŸå¾Œã€åˆæœŸè¨­å®šã«æˆ»ã‚‹ã“ã¨ãŒã§ãã€ãã‚Œã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¶­æŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä¹—ã£å–ã‚Š

* [https://godiego.co/posts/STO-Azure/](https://godiego.co/posts/STO-Azure/)

### Whoami

{% hint style="danger" %}
az cliã€AzureADã€Az PowerShellã®**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•**ã‚’[**Az - AzureAD**](az-azuread/)ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å­¦ã³ã¾ã™ã€‚
{% endhint %}

çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹æœ€åˆã®ã“ã¨ã®ä¸€ã¤ã¯ã€**ã‚ãªãŸãŒèª°ã§ã‚ã‚‹ã‹**ï¼ˆã©ã®ç’°å¢ƒã«ã„ã‚‹ã‹ï¼‰ã§ã™ï¼š

{% tabs %}
{% tab title="az cli" %}
```bash
az account list
az account tenant list # Current tenant info
az account subscription list # Current subscription info
az ad signed-in-user show # Current signed-in user
az ad signed-in-user list-owned-objects # Get owned objects by current user
az account management-group list #Not allowed by default
```
{% endtab %}

{% tab title="AzureAD" %}
```powershell
#Get the current session state
Get-AzureADCurrentSessionInfo
#Get details of the current tenant
Get-AzureADTenantDetail
```
{% endtab %}

{% tab title="Az PowerShell" %}
```powershell
# Get the information about the current context (Account, Tenant, Subscription etc.)
Get-AzContext
# List all available contexts
Get-AzContext -ListAvailable
# Enumerate subscriptions accessible by the current user
Get-AzSubscription
#Get Resource group
Get-AzResourceGroup
# Enumerate all resources visible to the current user
Get-AzResource
# Enumerate all Azure RBAC role assignments
Get-AzRoleAssignment # For all users
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com # For current user
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Azureã‚’åˆ—æŒ™ã™ã‚‹ä¸Šã§æœ€ã‚‚é‡è¦ãªã‚³ãƒãƒ³ãƒ‰ã®ä¸€ã¤ã¯ã€Az PowerShellã®**`Get-AzResource`**ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã©ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚’**çŸ¥ã‚‹ã“ã¨ãŒã§ãã¾ã™**ã€‚

åŒã˜æƒ…å ±ã¯ã€[https://portal.azure.com/#view/HubsExtension/BrowseAll](https://portal.azure.com/#view/HubsExtension/BrowseAll)ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‹ã€"All resources"ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ã§**ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚½ãƒ¼ãƒ«**ã§ã‚‚å–å¾—ã§ãã¾ã™ã€‚
{% endhint %}

### AzureAD åˆ—æŒ™

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚°ãƒ«ãƒ¼ãƒ—ã€ãƒ­ãƒ¼ãƒ«ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãªã©ã‚’åˆ—æŒ™ã™ã‚‹ãŸã‚ã®**ååˆ†ãªæ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã¯ãšã§ã™**ï¼ˆ[ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®AzureADæ¨©é™](az-basic-information.md#default-user-permissions)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰ã€‚\
ã“ã¡ã‚‰ã«ã‚¬ã‚¤ãƒ‰ãŒã‚ã‚Šã¾ã™ï¼š

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

{% hint style="info" %}
ã“ã‚Œã§ã€ã‚ãªãŸã®è³‡æ ¼æƒ…å ±ã«ã¤ã„ã¦**ã„ãã¤ã‹ã®æƒ…å ±ã‚’æŒã£ã¦ã„ã‚‹**ï¼ˆãã—ã¦ã€ã‚‚ã—ã‚ãªãŸãŒãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã§ã‚ã‚Œã°ã€ãŠãã‚‰ã**æ¤œå‡ºã•ã‚Œã¦ã„ãªã„**ã¯ãšã§ã™ï¼‰ã€‚æ¬¡ã«ã€ç’°å¢ƒã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãŒä½•ã‹ã‚’æŠŠæ¡ã™ã‚‹æ™‚ãŒæ¥ã¾ã—ãŸã€‚\
ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã„ãã¤ã‹ã®ä¸€èˆ¬çš„ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ—æŒ™ã™ã‚‹æ–¹æ³•ã‚’ç¢ºèªã§ãã¾ã™ã€‚
{% endhint %}

## ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¨ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼

Azureã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹è‡ªä½“ã®ã‚·ã‚¹ãƒ†ãƒ ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æŒã¤ã‹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰²ã‚Šå½“ã¦ã®ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯ã€ä¾‹ãˆã°KeyVaultã«ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’æŒã¡ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã¯åˆ¶é™ã•ã‚Œã‚‹ã¹ãã§ã™ï¼ˆæœ€å°æ¨©é™ã®åŸå‰‡ã«åŸºã¥ã„ã¦ï¼‰ã€ã—ã‹ã—å¿…è¦ä»¥ä¸Šã®æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚é€šå¸¸ã€App Serviceã¯KeyVaultã‹ã‚‰ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚„è¨¼æ˜æ›¸ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€ã“ã‚Œã‚‰ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æ¢ç´¢ã™ã‚‹ã“ã¨ã¯æœ‰ç”¨ã§ã™ã€‚

## App Service SCM

App Serviceã®'ã‚³ãƒ³ãƒ†ãƒŠ'ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãŸã‚ã®Kuduã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã€‚

## Webshell

portal.azure.comã‚’ä½¿ç”¨ã—ã¦ã‚·ã‚§ãƒ«ã‚’é¸æŠã™ã‚‹ã‹ã€shell.azure.comã‚’ä½¿ç”¨ã—ã¦bashã¾ãŸã¯powershellã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã®ã‚·ã‚§ãƒ«ã®'ãƒ‡ã‚£ã‚¹ã‚¯'ã¯ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™ã€‚

## Azure DevOps

Azure DevOpsã¯Azureã¨ã¯åˆ¥ã®ã‚‚ã®ã§ã™ã€‚ãƒªãƒã‚¸ãƒˆãƒªã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆyamlã¾ãŸã¯ãƒªãƒªãƒ¼ã‚¹ï¼‰ã€ãƒœãƒ¼ãƒ‰ã€wikiãªã©ãŒã‚ã‚Šã¾ã™ã€‚Variable Groupsã¯å¤‰æ•°å€¤ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

## è‡ªå‹•åŒ–ã•ã‚ŒãŸReconãƒ„ãƒ¼ãƒ«

### [**ROADRecon**](https://github.com/dirkjanm/ROADtools)
```powershell
cd ROADTools
pipenv shell
roadrecon auth -u test@corp.onmicrosoft.com -p "Welcome2022!"
roadrecon gather
roadrecon gui
```
### [Monkey365](https://github.com/silverhack/monkey365)

{% code overflow="wrap" %}
```powershell
Import-Module monkey365
Get-Help Invoke-Monkey365
Get-Help Invoke-Monkey365 -Detailed
Invoke-Monkey365 -IncludeAzureActiveDirectory -ExportTo HTML -Verbose -Debug -InformationAction Continue
Invoke-Monkey365 - Instance Azure -Analysis All -ExportTo HTML
```
### [**Stormspotter**](https://github.com/Azure/Stormspotter)
```powershell
# Start Backend
cd stormspotter\backend\
pipenv shell
python ssbackend.pyz

# Start Front-end
cd stormspotter\frontend\dist\spa\
quasar.cmd serve -p 9091 --history

# Run Stormcollector
cd stormspotter\stormcollector\
pipenv shell
az login -u test@corp.onmicrosoft.com -p Welcome2022!
python stormspotter\stormcollector\sscollector.pyz cli
# This will generate a .zip file to upload in the frontend (127.0.0.1:9091)
```
### [**AzureHound**](https://github.com/BloodHoundAD/AzureHound)
```powershell
# You need to use the Az PowerShell and Azure AD modules:
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@corp.onmicrosoft.com", $passwd)
Connect-AzAccount -Credential $creds

Import-Module AzureAD\AzureAD.psd1
Connect-AzureAD -Credential $creds

# Launch AzureHound
. AzureHound\AzureHound.ps1
Invoke-AzureHound -Verbose

# Simple queries
## All Azure Users
MATCH (n:AZUser) return n.name
## All Azure Applications
MATCH (n:AZApp) return n.objectid
## All Azure Devices
MATCH (n:AZDevice) return n.name
## All Azure Groups
MATCH (n:AZGroup) return n.name
## All Azure Key Vaults
MATCH (n:AZKeyVault) return n.name
## All Azure Resource Groups
MATCH (n:AZResourceGroup) return n.name
## All Azure Service Principals
MATCH (n:AZServicePrincipal) return n.objectid
## All Azure Virtual Machines
MATCH (n:AZVM) return n.name
## All Principals with the â€˜Contributorâ€™ role
MATCH p = (n)-[r:AZContributor]->(g) RETURN p

# Advanced queries
## Get Global Admins
MATCH p =(n)-[r:AZGlobalAdmin*1..]->(m) RETURN p
## Owners of Azure Groups
MATCH p = (n)-[r:AZOwns]->(g:AZGroup) RETURN p
## All Azure Users and their Groups
MATCH p=(m:AZUser)-[r:MemberOf]->(n) WHERE NOT m.objectid CONTAINS 'S-1-5' RETURN p
## Privileged Service Principals
MATCH p = (g:AZServicePrincipal)-[r]->(n) RETURN p
## Owners of Azure Applications
MATCH p = (n)-[r:AZOwns]->(g:AZApp) RETURN p
## Paths to VMs
MATCH p = (n)-[r]->(g: AZVM) RETURN p
## Paths to KeyVault
MATCH p = (n)-[r]->(g:AZKeyVault) RETURN p
## Paths to Azure Resource Group
MATCH p = (n)-[r]->(g:AZResourceGroup) RETURN p
## On-Prem users with edges to Azure
MATCH  p=(m:User)-[r:AZResetPassword|AZOwns|AZUserAccessAdministrator|AZContributor|AZAddMembers|AZGlobalAdmin|AZVMContributor|AZOwnsAZAvereContributor]->(n) WHERE m.objectid CONTAINS 'S-1-5-21' RETURN p
## All Azure AD Groups that are synchronized with On-Premise AD
MATCH (n:Group) WHERE n.objectid CONTAINS 'S-1-5' AND n.azsyncid IS NOT NULL RETURN n
```
### [Azucar](https://github.com/nccgroup/azucar)
```bash
# You should use an account with at least read-permission on the assets you want to access
git clone https://github.com/nccgroup/azucar.git
PS> Get-ChildItem -Recurse c:\Azucar_V10 | Unblock-File

PS> .\Azucar.ps1 -AuthMode UseCachedCredentials -Verbose -WriteLog -Debug -ExportTo PRINT
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -CertFilePassword MySuperP@ssw0rd! -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000

# resolve the TenantID for an specific username
PS> .\Azucar.ps1 -ResolveTenantUserName user@company.com
```
### [**MicroBurst**](https://github.com/NetSPI/MicroBurst)
```
Import-Module .\MicroBurst.psm1
Import-Module .\Get-AzureDomainInfo.ps1
Get-AzureDomainInfo -folder MicroBurst -Verbose
```
### [**PowerZure**](https://github.com/hausec/PowerZure)
```powershell
Connect-AzAccount
ipmo C:\Path\To\Powerzure.psd1
Get-AzureTarget

# Reader
$ Get-Runbook, Get-AllUsers, Get-Apps, Get-Resources, Get-WebApps, Get-WebAppDetails

# Contributor
$ Execute-Command -OS Windows -VM Win10Test -ResourceGroup Test-RG -Command "whoami"
$ Execute-MSBuild -VM Win10Test  -ResourceGroup Test-RG -File "build.xml"
$ Get-AllSecrets # AllAppSecrets, AllKeyVaultContents
$ Get-AvailableVMDisks, Get-VMDisk # Download a virtual machine's disk

# Owner
$ Set-Role -Role Contributor -User test@contoso.com -Resource Win10VMTest

# Administrator
$ Create-Backdoor, Execute-Backdoor
```
<details>

<summary><strong>AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„å ´åˆ**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„å ´åˆ**ã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã™ã‚‹ã€ç§ãŸã¡ã®ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ ã™ã‚‹**ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>
