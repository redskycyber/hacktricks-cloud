# Azure Pentesting

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

- **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ PDFë¡œ HackTricks ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
- [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
- **Discord ê·¸ë£¹**ì— **ê°€ì…**í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
- **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ì•„ì§ AZURE ë°©ë²•ë¡ ì„ êµ¬ì¶• ì¤‘ì…ë‹ˆë‹¤

## ê¸°ë³¸ ì •ë³´

{% content-ref url="az-basic-information.md" %}
[az-basic-information.md](az-basic-information.md)
{% endcontent-ref %}

## Azure Pentester/Red Team ë°©ë²•ë¡ 

AZURE í™˜ê²½ì„ ê°ì‚¬í•˜ê¸° ìœ„í•´ì„œëŠ” ì‚¬ìš© ì¤‘ì¸ **ì„œë¹„ìŠ¤**, ë…¸ì¶œëœ ê²ƒ, ëˆ„ê°€ ë¬´ì—‡ì— **ì•¡ì„¸ìŠ¤** ê¶Œí•œì„ ê°€ì§€ê³  ìˆëŠ”ì§€, ê·¸ë¦¬ê³  ë‚´ë¶€ Azure ì„œë¹„ìŠ¤ì™€ **ì™¸ë¶€ ì„œë¹„ìŠ¤**ê°€ ì–´ë–»ê²Œ ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.

ë ˆë“œíŒ€ ê´€ì ì—ì„œ **Azure í™˜ê²½ì„ ì¹¨í•´í•˜ëŠ” ì²« ë²ˆì§¸ ë‹¨ê³„**ëŠ” Azure ADì˜ **ì¼ë¶€ ìê²© ì¦ëª…ì„ íšë“¤í•˜ëŠ” ê²ƒ**ì…ë‹ˆë‹¤. ë‹¤ìŒì€ ê·¸ ë°©ë²•ì— ëŒ€í•œ ì•„ì´ë””ì–´ì…ë‹ˆë‹¤:

- github(ë˜ëŠ” ìœ ì‚¬í•œ ê³³)ì˜ **ëˆ„ì„¤** - OSINT
- **ì‚¬íšŒ ê³µí•™**
- **ë¹„ë°€ë²ˆí˜¸** ì¬ì‚¬ìš© (ë¹„ë°€ë²ˆí˜¸ ëˆ„ì„¤)
- Azure-í˜¸ìŠ¤íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì·¨ì•½ì 
- [**ì„œë²„ ì¸¡ ìš”ì²­ ìœ„ì¡°(SSRF)**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) - ë©”íƒ€ë°ì´í„° ì—”ë“œí¬ì¸íŠ¸ì— ì•¡ì„¸ìŠ¤
- **ë¡œì»¬ íŒŒì¼ ì½ê¸°**
- `/home/USERNAME/.azure`
- `C:\Users\USERNAME\.azure`
- 2.30 ì´ì „ì˜ `az cli`ì˜ **`accessTokens.json`** íŒŒì¼ - 2022ë…„ 1ì›” - **ì•¡ì„¸ìŠ¤ í† í°ì„ í‰ë¬¸ìœ¼ë¡œ ì €ì¥**
- **`azureProfile.json`** íŒŒì¼ì€ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì— ëŒ€í•œ **ì •ë³´**ë¥¼ í¬í•¨
- **`az logout`**ì€ í† í°ì„ ì œê±°í•©ë‹ˆë‹¤.
- ì´ì „ ë²„ì „ì˜ **`Az PowerShell`**ì€ **`TokenCache.dat`**ì— **ì•¡ì„¸ìŠ¤ í† í°**ì„ **í‰ë¬¸**ìœ¼ë¡œ ì €ì¥í–ˆìŠµë‹ˆë‹¤. ë˜í•œ **`AzureRmContext.json`**ì— **ServicePrincipalSecret**ë¥¼ **í‰ë¬¸**ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤. **`Save-AzContext`** cmdletì„ ì‚¬ìš©í•˜ì—¬ **í† í°ì„ ì €ì¥**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
`Disconnect-AzAccount`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì œê±°í•©ë‹ˆë‹¤.
- 3rd party **ì¹¨ì…**
- **ë‚´ë¶€** ì§ì›
- [**ì¼ë°˜ì ì¸ í”¼ì‹±**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (ìê²© ì¦ëª… ë˜ëŠ” Oauth ì•±)
- [ì¥ì¹˜ ì½”ë“œ ì¸ì¦ í”¼ì‹±](az-unauthenticated-enum-and-initial-entry/az-device-code-authentication-phishing.md)
- [Azure **ë¹„ë°€ë²ˆí˜¸ ìŠ¤í”„ë ˆì´**](az-unauthenticated-enum-and-initial-entry/az-password-spraying.md)

Azure í…Œë„ŒíŠ¸ ë‚´ì—ì„œ **ì–´ë–¤ ì‚¬ìš©ìë„ ì¹¨í•´í•˜ì§€ ì•Šì•˜ë”ë¼ë„**, ëª‡ ê°€ì§€ ì •ë³´ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="az-unauthenticated-enum-and-initial-entry/" %}
[az-unauthenticated-enum-and-initial-entry](az-unauthenticated-enum-and-initial-entry/)
{% endcontent-ref %}

{% hint style="info" %}
ìê²© ì¦ëª…ì„ íšë“í•œ í›„, í•´ë‹¹ ìê²© ì¦ëª…ì´ **ëˆ„êµ¬ì—ê²Œ ì†í•˜ëŠ”ì§€**ì™€ **ë¬´ì—‡ì— ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìˆëŠ”ì§€** ì•Œì•„ì•¼ í•˜ë¯€ë¡œ ëª‡ ê°€ì§€ ê¸°ë³¸ ì—´ê±°ë¥¼ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤:
{% endhint %}

## ê¸°ë³¸ ì—´ê±°

{% hint style="info" %}
ì—´ê±° ìì²´ë³´ë‹¤ëŠ” **ë¡œê·¸ì¸**ì´ ê°€ì¥ **ì‹œë„ëŸ¬ìš´** ë¶€ë¶„ì„ì„ ê¸°ì–µí•˜ì„¸ìš”.
{% endhint %}

### SSRF

Azure ë‚´ë¶€ì˜ ê¸°ê³„ì—ì„œ SSRFë¥¼ ë°œê²¬í–ˆë‹¤ë©´ ë‹¤ìŒ í˜ì´ì§€ì—ì„œ íŠ¸ë¦­ì„ í™•ì¸í•˜ì„¸ìš”:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### ë¡œê·¸ì¸ ì¡°ê±´ ìš°íšŒ

<figure><img src="../../.gitbook/assets/image (268).png" alt=""><figcaption></figcaption></figure>

ì¼ë¶€ ìœ íš¨í•œ ìê²© ì¦ëª…ì´ ìˆì§€ë§Œ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ëŠ” ê²½ìš°, ë‹¤ìŒê³¼ ê°™ì€ ì¼ë°˜ì ì¸ ë³´í˜¸ ì¡°ì¹˜ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸** -- ìœ íš¨í•œ IPë¥¼ ì¹¨í•´í•´ì•¼ í•¨
- **ì§€ë¦¬ ì œí•œ** -- ì‚¬ìš©ìê°€ ì‚¬ëŠ” ê³³ì´ë‚˜ íšŒì‚¬ì˜ ì‚¬ë¬´ì‹¤ì´ ì–´ë””ì¸ì§€ ì°¾ì•„ í•´ë‹¹ ë„ì‹œ(ë˜ëŠ” ì ì–´ë„ êµ­ê°€)ì˜ IPë¥¼ ì–»ìœ¼ì„¸ìš”
- **ë¸Œë¼ìš°ì €** -- íŠ¹ì • OS(Windows, Linux, Mac, Android, iOS)ì—ì„œë§Œ ë¸Œë¼ìš°ì €ê°€ í—ˆìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”¼í•´ì/íšŒì‚¬ê°€ ì‚¬ìš©í•˜ëŠ” OSë¥¼ í™•ì¸í•˜ì„¸ìš”.
- **Service Principal ìê²© ì¦ëª…ì„ ì¹¨í•´**í•´ë³´ì„¸ìš”. ì¼ë°˜ì ìœ¼ë¡œ ëœ ì œí•œë˜ë©° ë¡œê·¸ì¸ì´ ëœ ê²€í† ë©ë‹ˆë‹¤

ìš°íšŒí•œ í›„ì— ì´ˆê¸° ì„¤ì •ìœ¼ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆê³  ì—¬ì „íˆ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì„œë¸Œë„ë©”ì¸ íƒˆì·¨

* [https://godiego.co/posts/STO-Azure/](https://godiego.co/posts/STO-Azure/)

### Whoami

{% hint style="danger" %}
[**Az - AzureAD**](az-azuread/) ì„¹ì…˜ì—ì„œ az cli, AzureAD ë° Az PowerShellì„ **ì„¤ì¹˜í•˜ëŠ” ë°©ë²•**ì„ ë°°ìš°ì„¸ìš”.
{% endhint %}

ì•Œì•„ì•¼ í•  **ì²« ë²ˆì§¸ ì‚¬í•­** ì¤‘ í•˜ë‚˜ëŠ” **ëˆ„êµ¬ì¸ì§€**(ì–´ë–¤ í™˜ê²½ì— ìˆëŠ”ì§€)ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤:

{% tabs %}
{% tab title="az cli" %}
```bash
az account list
az account tenant list # Current tenant info
az account subscription list # Current subscription info
az ad signed-in-user show # Current signed-in user
az ad signed-in-user list-owned-objects # Get owned objects by current user
az account management-group list #Not allowed by default
```
{% endtab %}

{% tab title="AzureAD" %}AzureAD Security Best Practices
==============================

AzureAD is a critical component of many organizations' cloud infrastructure. Ensuring its security is paramount to protect sensitive data and resources. Here are some best practices to enhance AzureAD security:

1. **Enable Multi-Factor Authentication (MFA):** Require users to provide additional verification beyond their password to access AzureAD.

2. **Regularly Review User Permissions:** Periodically review and update user permissions to ensure least privilege access.

3. **Monitor Sign-In Logs:** Keep track of sign-in logs and set up alerts for any suspicious activities.

4. **Enable Conditional Access Policies:** Implement policies based on conditions like user location, device health, etc., to control access to AzureAD.

5. **Use Secure Password Policies:** Enforce strong password policies, including password complexity and expiration.

6. **Enable Identity Protection:** Utilize AzureAD Identity Protection to detect and respond to potential identity risks.

7. **Regularly Update and Patch:** Keep AzureAD and associated systems up to date with the latest security patches.

8. **Educate Users:** Train users on security best practices, such as recognizing phishing attempts and protecting their credentials.

By following these best practices, organizations can significantly improve the security of their AzureAD environment and reduce the risk of unauthorized access and data breaches. {% endtab %}
```powershell
#Get the current session state
Get-AzureADCurrentSessionInfo
#Get details of the current tenant
Get-AzureADTenantDetail
```
{% endtab %}

{% tab title="Az PowerShell" %} 

Azure PowerShellì€ Azure ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•˜ê³  ì œì–´í•˜ê¸° ìœ„í•œ ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤. Azure PowerShellì„ ì‚¬ìš©í•˜ë©´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ Azure ë¦¬ì†ŒìŠ¤ë¥¼ ìë™í™”í•˜ê³  êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Azure PowerShellì„ ì‚¬ìš©í•˜ë©´ Azureì˜ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ í™œìš©í•  ìˆ˜ ìˆìœ¼ë©°, íŠ¹íˆ ëŒ€ê·œëª¨ ë˜ëŠ” ë°˜ë³µì ì¸ ì‘ì—…ì„ ìˆ˜í–‰í•  ë•Œ ë§¤ìš° ìœ ìš©í•©ë‹ˆë‹¤.

Azure PowerShellì„ ì‚¬ìš©í•˜ë©´ ê°€ìƒ ë¨¸ì‹ , ë„¤íŠ¸ì›Œí¬, ì›¹ ì•±, ë°ì´í„°ë² ì´ìŠ¤ ë“±ê³¼ ê°™ì€ ë‹¤ì–‘í•œ Azure ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Azure PowerShellì€ Azure Resource Manager(ARM)ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, Azureì˜ ëª¨ë“  ê¸°ëŠ¥ì„ PowerShell ìŠ¤í¬ë¦½íŠ¸ë¡œ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Azure PowerShellì„ ì‚¬ìš©í•˜ë©´ Azure í™˜ê²½ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ë³´ì•ˆì„ ê°•í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. PowerShellì„ í†µí•´ Azure ë¦¬ì†ŒìŠ¤ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ê³  ëª¨ë‹ˆí„°ë§í•˜ë©°, ë³´ì•ˆ ì„¤ì •ì„ ìë™í™”í•˜ì—¬ Azure í™˜ê²½ì„ ì•ˆì „í•˜ê²Œ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Azure PowerShellì€ ë‹¤ì–‘í•œ ìš´ì˜ ì²´ì œì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, Azure CLIì™€ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ Azure í™˜ê²½ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% endtab %}
```powershell
# Get the information about the current context (Account, Tenant, Subscription etc.)
Get-AzContext
# List all available contexts
Get-AzContext -ListAvailable
# Enumerate subscriptions accessible by the current user
Get-AzSubscription
#Get Resource group
Get-AzResourceGroup
# Enumerate all resources visible to the current user
Get-AzResource
# Enumerate all Azure RBAC role assignments
Get-AzRoleAssignment # For all users
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com # For current user
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Azureë¥¼ ì—´ê±°í•˜ëŠ” ë° ê°€ì¥ ì¤‘ìš”í•œ ëª…ë ¹ ì¤‘ í•˜ë‚˜ëŠ” Az PowerShellì˜ **`Get-AzResource`**ì´ë©°, í˜„ì¬ ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆëŠ” **ë¦¬ì†ŒìŠ¤ë¥¼ ì•Œë ¤ì¤ë‹ˆë‹¤**.

ë™ì¼í•œ ì •ë³´ë¥¼ **ì›¹ ì½˜ì†”**ì—ì„œ ì–»ì„ ìˆ˜ ìˆìœ¼ë©° [https://portal.azure.com/#view/HubsExtension/BrowseAll](https://portal.azure.com/#view/HubsExtension/BrowseAll)ë¡œ ì´ë™í•˜ê±°ë‚˜ "ëª¨ë“  ë¦¬ì†ŒìŠ¤"ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### AzureAD ì—´ê±°

ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ìëŠ” ì‚¬ìš©ì, ê·¸ë£¹, ì—­í• , ì„œë¹„ìŠ¤ ì£¼ì²´ ë“±ì„ ì—´ê±°í•  **ì¶©ë¶„í•œ ê¶Œí•œ**ì„ ê°–ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤ (ê¸°ë³¸ AzureAD ê¶Œí•œì„ í™•ì¸í•˜ë ¤ë©´ [ê¸°ë³¸ AzureAD ê¶Œí•œ](az-basic-information.md#default-user-permissions)ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤).\
ê°€ì´ë“œë¥¼ ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

{% hint style="info" %}
ì´ì œ **ìê²© ì¦ëª…ì— ëŒ€í•œ ì¼ë¶€ ì •ë³´ë¥¼** ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ (ê·¸ë¦¬ê³  ë ˆë“œíŒ€ì¸ ê²½ìš° **ê°ì§€ë˜ì§€ ì•Šì•˜ìœ¼ë©´** ì¢‹ê² ìŠµë‹ˆë‹¤). í™˜ê²½ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.\
ë‹¤ìŒ ì„¹ì…˜ì—ì„œëŠ” **ì¼ë°˜ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ì—´ê±°í•˜ëŠ” ëª‡ ê°€ì§€ ë°©ë²•**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

## ì„œë¹„ìŠ¤ ì£¼ì²´ ë° ì•¡ì„¸ìŠ¤ ì •ì±…

Azure ì„œë¹„ìŠ¤ëŠ” ì‹œìŠ¤í…œ ID(ì„œë¹„ìŠ¤ ìì²´)ë¥¼ ê°€ì§ˆ ìˆ˜ë„ ìˆê³  ì‚¬ìš©ì ì§€ì • ê´€ë¦¬ IDë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì´ IDëŠ” ì˜ˆë¥¼ ë“¤ì–´ KeyVaultì— ì•¡ì„¸ìŠ¤ ì •ì±…ì„ ê°€ì§ˆ ìˆ˜ ìˆì–´ ë¹„ë°€ì„ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì•¡ì„¸ìŠ¤ ì •ì±…ì€ ì œí•œë˜ì–´ì•¼ í•˜ì§€ë§Œ í•„ìš”í•œ ê²ƒë³´ë‹¤ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§ˆ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ App ServiceëŠ” ë¹„ë°€ê³¼ ì¸ì¦ì„œë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•´ KeyVaultë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ ì´ëŸ¬í•œ IDë¥¼ íƒìƒ‰í•˜ëŠ” ê²ƒì´ ìœ ìš©í•©ë‹ˆë‹¤.

## App Service SCM

App Service 'ì»¨í…Œì´ë„ˆ'ì— ë¡œê·¸ì¸í•˜ê¸° ìœ„í•œ Kudu ì½˜ì†”.

## ì›¹ ì‰˜

portal.azure.comì„ ì‚¬ìš©í•˜ì—¬ ì‰˜ì„ ì„ íƒí•˜ê±°ë‚˜ bash ë˜ëŠ” powershellì„ ìœ„í•´ shell.azure.comì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ì‰˜ì˜ 'ë””ìŠ¤í¬'ëŠ” ì €ì¥ì†Œ ê³„ì •ì— ì´ë¯¸ì§€ íŒŒì¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.

## Azure DevOps

Azure DevOpsëŠ” Azureì™€ ë³„ë„ì…ë‹ˆë‹¤. ì €ì¥ì†Œ, íŒŒì´í”„ë¼ì¸ (yaml ë˜ëŠ” ë¦´ë¦¬ìŠ¤), ë³´ë“œ, ìœ„í‚¤ ë“±ì´ ìˆìŠµë‹ˆë‹¤. ë³€ìˆ˜ ê·¸ë£¹ì€ ë³€ìˆ˜ ê°’ê³¼ ë¹„ë°€ì„ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

## ìë™í™”ëœ Recon ë„êµ¬

### [**ROADRecon**](https://github.com/dirkjanm/ROADtools)
```powershell
cd ROADTools
pipenv shell
roadrecon auth -u test@corp.onmicrosoft.com -p "Welcome2022!"
roadrecon gather
roadrecon gui
```
### [Monkey365](https://github.com/silverhack/monkey365)

{% code overflow="wrap" %}
```powershell
Import-Module monkey365
Get-Help Invoke-Monkey365
Get-Help Invoke-Monkey365 -Detailed
Invoke-Monkey365 -IncludeAzureActiveDirectory -ExportTo HTML -Verbose -Debug -InformationAction Continue
Invoke-Monkey365 - Instance Azure -Analysis All -ExportTo HTML
```
{% endcode %}

### [**Stormspotter**](https://github.com/Azure/Stormspotter)
```powershell
# Start Backend
cd stormspotter\backend\
pipenv shell
python ssbackend.pyz

# Start Front-end
cd stormspotter\frontend\dist\spa\
quasar.cmd serve -p 9091 --history

# Run Stormcollector
cd stormspotter\stormcollector\
pipenv shell
az login -u test@corp.onmicrosoft.com -p Welcome2022!
python stormspotter\stormcollector\sscollector.pyz cli
# This will generate a .zip file to upload in the frontend (127.0.0.1:9091)
```
### [**AzureHound**](https://github.com/BloodHoundAD/AzureHound)
```powershell
# You need to use the Az PowerShell and Azure AD modules:
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@corp.onmicrosoft.com", $passwd)
Connect-AzAccount -Credential $creds

Import-Module AzureAD\AzureAD.psd1
Connect-AzureAD -Credential $creds

# Launch AzureHound
. AzureHound\AzureHound.ps1
Invoke-AzureHound -Verbose

# Simple queries
## All Azure Users
MATCH (n:AZUser) return n.name
## All Azure Applications
MATCH (n:AZApp) return n.objectid
## All Azure Devices
MATCH (n:AZDevice) return n.name
## All Azure Groups
MATCH (n:AZGroup) return n.name
## All Azure Key Vaults
MATCH (n:AZKeyVault) return n.name
## All Azure Resource Groups
MATCH (n:AZResourceGroup) return n.name
## All Azure Service Principals
MATCH (n:AZServicePrincipal) return n.objectid
## All Azure Virtual Machines
MATCH (n:AZVM) return n.name
## All Principals with the â€˜Contributorâ€™ role
MATCH p = (n)-[r:AZContributor]->(g) RETURN p

# Advanced queries
## Get Global Admins
MATCH p =(n)-[r:AZGlobalAdmin*1..]->(m) RETURN p
## Owners of Azure Groups
MATCH p = (n)-[r:AZOwns]->(g:AZGroup) RETURN p
## All Azure Users and their Groups
MATCH p=(m:AZUser)-[r:MemberOf]->(n) WHERE NOT m.objectid CONTAINS 'S-1-5' RETURN p
## Privileged Service Principals
MATCH p = (g:AZServicePrincipal)-[r]->(n) RETURN p
## Owners of Azure Applications
MATCH p = (n)-[r:AZOwns]->(g:AZApp) RETURN p
## Paths to VMs
MATCH p = (n)-[r]->(g: AZVM) RETURN p
## Paths to KeyVault
MATCH p = (n)-[r]->(g:AZKeyVault) RETURN p
## Paths to Azure Resource Group
MATCH p = (n)-[r]->(g:AZResourceGroup) RETURN p
## On-Prem users with edges to Azure
MATCH  p=(m:User)-[r:AZResetPassword|AZOwns|AZUserAccessAdministrator|AZContributor|AZAddMembers|AZGlobalAdmin|AZVMContributor|AZOwnsAZAvereContributor]->(n) WHERE m.objectid CONTAINS 'S-1-5-21' RETURN p
## All Azure AD Groups that are synchronized with On-Premise AD
MATCH (n:Group) WHERE n.objectid CONTAINS 'S-1-5' AND n.azsyncid IS NOT NULL RETURN n
```
### [Azucar](https://github.com/nccgroup/azucar)
```bash
# You should use an account with at least read-permission on the assets you want to access
git clone https://github.com/nccgroup/azucar.git
PS> Get-ChildItem -Recurse c:\Azucar_V10 | Unblock-File

PS> .\Azucar.ps1 -AuthMode UseCachedCredentials -Verbose -WriteLog -Debug -ExportTo PRINT
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -CertFilePassword MySuperP@ssw0rd! -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000

# resolve the TenantID for an specific username
PS> .\Azucar.ps1 -ResolveTenantUserName user@company.com
```
### [**MicroBurst**](https://github.com/NetSPI/MicroBurst)
```
Import-Module .\MicroBurst.psm1
Import-Module .\Get-AzureDomainInfo.ps1
Get-AzureDomainInfo -folder MicroBurst -Verbose
```
### [**PowerZure**](https://github.com/hausec/PowerZure)
```powershell
Connect-AzAccount
ipmo C:\Path\To\Powerzure.psd1
Get-AzureTarget

# Reader
$ Get-Runbook, Get-AllUsers, Get-Apps, Get-Resources, Get-WebApps, Get-WebAppDetails

# Contributor
$ Execute-Command -OS Windows -VM Win10Test -ResourceGroup Test-RG -Command "whoami"
$ Execute-MSBuild -VM Win10Test  -ResourceGroup Test-RG -File "build.xml"
$ Get-AllSecrets # AllAppSecrets, AllKeyVaultContents
$ Get-AvailableVMDisks, Get-VMDisk # Download a virtual machine's disk

# Owner
$ Set-Role -Role Contributor -User test@contoso.com -Resource Win10VMTest

# Administrator
$ Create-Backdoor, Execute-Backdoor
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ì™€ í•¨ê»˜ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**!</summary>

ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
