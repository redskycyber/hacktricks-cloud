# Az - Lateral Movement (Cloud - On-Prem)

## Az - ì¸¡ë©´ ì´ë™ (í´ë¼ìš°ë“œ - ì˜¨í”„ë ˆë¯¸ìŠ¤)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

### í´ë¼ìš°ë“œì— ì—°ê²°ëœ ì˜¨í”„ë ˆë¯¸ìŠ¤ ë¨¸ì‹ 

ë¨¸ì‹ ì´ í´ë¼ìš°ë“œì— ì—°ê²°ë˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤:

#### Azure AD ê°€ì…

<figure><img src="../../../.gitbook/assets/image (3) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

#### ì›Œí¬í”Œë ˆì´ìŠ¤ ê°€ì…

<figure><img src="../../../.gitbook/assets/image (1) (6).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### í•˜ì´ë¸Œë¦¬ë“œ ê°€ì…

<figure><img src="../../../.gitbook/assets/image (3) (2) (2).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### AADJ ë˜ëŠ” í•˜ì´ë¸Œë¦¬ë“œì—ì„œ ì›Œí¬í”Œë ˆì´ìŠ¤ ê°€ì…

<figure><img src="../../../.gitbook/assets/image (4) (3).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### í† í° ë° ì œí•œ ì‚¬í•­ <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

Azure ADì—ëŠ” íŠ¹ì • ì œí•œ ì‚¬í•­ì´ ìˆëŠ” ë‹¤ì–‘í•œ ìœ í˜•ì˜ í† í°ì´ ìˆìŠµë‹ˆë‹¤:

* **ì•¡ì„¸ìŠ¤ í† í°**: Microsoft Graphì™€ ê°™ì€ API ë° ë¦¬ì†ŒìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. íŠ¹ì • í´ë¼ì´ì–¸íŠ¸ì™€ ë¦¬ì†ŒìŠ¤ì— ì—°ê²°ë©ë‹ˆë‹¤.
* **ê°±ì‹  í† í°**: ìƒˆë¡œìš´ ì•¡ì„¸ìŠ¤ í† í°ì„ ì–»ê¸° ìœ„í•´ ì‘ìš© í”„ë¡œê·¸ë¨ì— ë°œê¸‰ë©ë‹ˆë‹¤. ë°œê¸‰ëœ ì‘ìš© í”„ë¡œê·¸ë¨ ë˜ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ ê·¸ë£¹ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ê¸°ë³¸ ê°±ì‹  í† í° (PRT)**: Azure AD ê°€ì…, ë“±ë¡ ë˜ëŠ” í•˜ì´ë¸Œë¦¬ë“œ ê°€ì… ì¥ì¹˜ì—ì„œ Single Sign-Onì— ì‚¬ìš©ë©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ë¡œê·¸ì¸ í”Œë¡œìš° ë° ì¥ì¹˜ì—ì„œ ëª¨ë°”ì¼ ë° ë°ìŠ¤í¬í†± ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë¡œê·¸ì¸í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê°€ì¥ í¥ë¯¸ë¡œìš´ ìœ í˜•ì˜ í† í°ì€ ê¸°ë³¸ ê°±ì‹  í† í° (PRT)ì…ë‹ˆë‹¤.

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### í”¼ë²— ê¸°ë²•

**Compromised machine to the cloud**ì—ì„œ:

* [**Pass the Cookie**](az-pass-the-cookie.md): ë¸Œë¼ìš°ì €ì—ì„œ Azure ì¿ í‚¤ë¥¼ ë„ìš©í•˜ì—¬ ë¡œê·¸ì¸ì— ì‚¬ìš©
* [**Phishing Primary Refresh Token**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** PRTë¥¼ ë‚šì•„ì±„ì„œ ì•…ìš©
* [**Pass the PRT**](pass-the-prt.md): ì¥ì¹˜ PRTë¥¼ ë„ìš©í•˜ì—¬ Azureì— ì ‘ê·¼í•˜ì—¬ ìœ„ì¥
* [**Pass the Certificate**](az-pass-the-certificate.md)**:** PRTë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸ì¦ì„œë¥¼ ìƒì„±í•˜ì—¬ í•œ ê¸°ê¸°ì—ì„œ ë‹¤ë¥¸ ê¸°ê¸°ë¡œ ë¡œê·¸ì¸

**AD**ë¥¼ ì¹¨í•´í•˜ì—¬ **Cloud**ë¥¼ ì¹¨í•´í•˜ê±°ë‚˜ **Cloud**ë¥¼ ì¹¨í•´í•˜ì—¬ **AD**ë¥¼ ì¹¨í•´í•˜ëŠ” ë°©ë²•:

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **On-Premì—ì„œ Cloudë¡œ í”¼ë²—í•˜ëŠ” ë˜ ë‹¤ë¥¸ ë°©ë²•ì€** [**Intuneì„ ì•…ìš©**](../az-services/intune.md)í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

ì´ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ë©´ Azure ADì—ì„œ ê¸°ê³„ë¥¼ ë“±ë¡í•˜ì—¬ PRTë¥¼ ì–»ê±°ë‚˜ PRT(í•©ë²•ì  ë˜ëŠ” ë„ë‚œ)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ê°€ì§€ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë“± ì—¬ëŸ¬ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë“¤ì€ ì§ì ‘ì ì¸ ê³µê²©ì€ ì•„ë‹ˆì§€ë§Œ PRTë¥¼ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤. ìì„¸í•œ ì •ë³´ëŠ” [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
