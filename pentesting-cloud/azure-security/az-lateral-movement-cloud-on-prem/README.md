# Az - Lateral Movement (Cloud - On-Prem)

## Az - æ¨ªå‘ç§»åŠ¨ï¼ˆäº‘ - æœ¬åœ°ï¼‰

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASSï¼†HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

### æœ¬åœ°æœºå™¨è¿æ¥åˆ°äº‘ç«¯

æœºå™¨è¿æ¥åˆ°äº‘ç«¯çš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼š

#### Azure ADåŠ å…¥

<figure><img src="../../../.gitbook/assets/image (3) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

#### å·¥ä½œåœºæ‰€åŠ å…¥

<figure><img src="../../../.gitbook/assets/image (1) (6).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### æ··åˆåŠ å…¥

<figure><img src="../../../.gitbook/assets/image (3) (2) (2).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### å·¥ä½œåœºæ‰€åŠ å…¥åœ¨AADJæˆ–æ··åˆç¯å¢ƒä¸­

<figure><img src="../../../.gitbook/assets/image (4) (3).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### ä»¤ç‰Œå’Œé™åˆ¶ <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

åœ¨Azure ADä¸­ï¼Œæœ‰ä¸åŒç±»å‹çš„ä»¤ç‰Œå…·æœ‰ç‰¹å®šçš„é™åˆ¶ï¼š

* **è®¿é—®ä»¤ç‰Œ**ï¼šç”¨äºè®¿é—®APIå’Œèµ„æºï¼Œå¦‚Microsoft Graphã€‚å®ƒä»¬ä¸ç‰¹å®šçš„å®¢æˆ·ç«¯å’Œèµ„æºç»‘å®šã€‚
* **åˆ·æ–°ä»¤ç‰Œ**ï¼šå‘æ”¾ç»™åº”ç”¨ç¨‹åºä»¥è·å–æ–°çš„è®¿é—®ä»¤ç‰Œã€‚å®ƒä»¬åªèƒ½è¢«å‘æ”¾ç»™çš„åº”ç”¨ç¨‹åºæˆ–ä¸€ç»„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚
* **ä¸»åˆ·æ–°ä»¤ç‰Œï¼ˆPRTï¼‰**ï¼šç”¨äºAzure ADåŠ å…¥ã€æ³¨å†Œæˆ–æ··åˆåŠ å…¥è®¾å¤‡çš„å•ç‚¹ç™»å½•ã€‚å®ƒä»¬å¯ç”¨äºæµè§ˆå™¨ç™»å½•æµç¨‹ï¼Œå¹¶ç”¨äºåœ¨è®¾å¤‡ä¸Šç™»å½•åˆ°ç§»åŠ¨å’Œæ¡Œé¢åº”ç”¨ç¨‹åºã€‚

æœ€æœ‰è¶£çš„ä»¤ç‰Œç±»å‹æ˜¯ä¸»åˆ·æ–°ä»¤ç‰Œï¼ˆPRTï¼‰ã€‚

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### æ¢çº½æŠ€æœ¯

ä»**å—æŸçš„æœºå™¨åˆ°äº‘ç«¯**ï¼š

* [**ä¼ é€’Cookie**](az-pass-the-cookie.md)ï¼šä»æµè§ˆå™¨çªƒå–Azure cookieå¹¶ä½¿ç”¨å®ƒä»¬è¿›è¡Œç™»å½•
* [**é’“é±¼ä¸»åˆ·æ–°ä»¤ç‰Œ**](az-phishing-primary-refresh-token-microsoft-entra.md)\*\*ï¼š\*\*é’“å–PRTä»¥æ»¥ç”¨å®ƒ
* [**ä¼ é€’PRT**](pass-the-prt.md)ï¼šçªƒå–è®¾å¤‡PRTä»¥å†’å……è®¿é—®Azureã€‚
* [**ä¼ é€’è¯ä¹¦**](az-pass-the-certificate.md)\*\*ï¼š\*\*åŸºäºPRTç”Ÿæˆè¯ä¹¦ï¼Œä»ä¸€å°æœºå™¨ç™»å½•åˆ°å¦ä¸€å°æœºå™¨

ä»**å—æŸçš„AD**åˆ°**å—æŸçš„äº‘**ï¼Œä»¥åŠä»**å—æŸçš„äº‘**åˆ°**å—æŸçš„AD**ï¼š

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **ä»äº‘åˆ°æœ¬åœ°çš„å¦ä¸€ç§æ¢çº½æ–¹å¼æ˜¯**[**æ»¥ç”¨Intune**](../az-services/intune.md)

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

è¯¥å·¥å…·å…è®¸æ‰§è¡Œå¤šç§æ“ä½œï¼Œå¦‚åœ¨Azure ADä¸­æ³¨å†Œæœºå™¨ä»¥è·å–PRTï¼Œå¹¶ä½¿ç”¨PRTï¼ˆåˆæ³•æˆ–çªƒå–çš„ï¼‰ä»¥å¤šç§ä¸åŒæ–¹å¼è®¿é—®èµ„æºã€‚è¿™äº›ä¸æ˜¯ç›´æ¥æ”»å‡»ï¼Œä½†å®ƒç®€åŒ–äº†ä½¿ç”¨PRTä»¥ä¸åŒæ–¹å¼è®¿é—®èµ„æºã€‚åœ¨[https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)æ‰¾åˆ°æ›´å¤šä¿¡æ¯ã€‚

## å‚è€ƒèµ„æ–™

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASSï¼†HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
