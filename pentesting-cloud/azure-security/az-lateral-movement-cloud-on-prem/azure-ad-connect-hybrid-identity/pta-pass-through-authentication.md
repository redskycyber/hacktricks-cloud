# Az - PTA - рдкрд╛рд╕-рдереНрд░реВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

Azure Active Directory (Azure AD) рдкрд╛рд╕-рдереНрд░реВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдСрди-рдкреНрд░рд┐рдорд╛рдЗрд╕реЗрд╕ рдФрд░ рдХреНрд▓рд╛рдЙрдб-рдЖрдзрд╛рд░рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдореЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реА рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**ред рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдмреЗрд╣рддрд░ рдЕрдиреБрднрд╡ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ - рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рдХрдо рдпрд╛рдж рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдФрд░ рдЖрдИрдЯреА рд╣реЗрд▓реНрдкрдбреЗрд╕реНрдХ рд▓рд╛рдЧрдд рдХреЛ рдХрдо рдХрд░рддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рд╛рдЗрди рдЗрди рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рднреВрд▓рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрдо рд╣реЛрддреА рд╣реИред рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ Azure AD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рд╛рдЗрди рдЗрди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ **рдЖрдкрдХреЗ рдСрди-рдкреНрд░рд┐рдорд╛рдЗрд╕реЗрд╕ Active Directory рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реАрдзреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдбреНрд╕ рдХрд╛ рдорд╛рдиреНрдпрддрд╛ рдХрд░рддреА рд╣реИ**ред

<figure><img src="../../../../.gitbook/assets/image (8) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

PTA рдореЗрдВ **рдкрд╣рдЪрд╛рди** **рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝** рдХреА рдЬрд╛рддреА рд╣реИрдВ рд▓реЗрдХрд┐рди PHS рдХреА рддрд░рд╣ **рдкрд╛рд╕рд╡рд░реНрдбреНрд╕** **рдирд╣реАрдВ**ред

рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдСрди-рдкреНрд░рд┐рдо AD рдореЗрдВ рдорд╛рдиреНрдп рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдХреНрд▓рд╛рдЙрдб рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд░ рдПрдХ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдПрдЬреЗрдВрдЯ** рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдПрдХ **рдСрди-рдкреНрд░рд┐рдо рд╕рд░реНрд╡рд░** рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реЛрддрд╛ рд╣реИ (рдЗрд╕реЗ рдСрди-рдкреНрд░рд┐рдо DC рдкрд░ рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ)ред

### рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣

<figure><img src="../../../../.gitbook/assets/image (4) (2) (1).png" alt=""><figcaption></figcaption></figure>

1. **рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **Azure AD** рдХреА рдУрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рд╡рд╣ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рдФрд░ **рдкрд╛рд╕рд╡рд░реНрдб** рднреЗрдЬрддрд╛ рд╣реИ
2. **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдХреЛ **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ Azure AD рдореЗрдВ рдПрдХ **рдХрддрд╛рд░** рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
3. **рдСрди-рдкреНрд░рд┐рдо рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдПрдЬреЗрдВрдЯ** рдХрддрд╛рд░ рд╕реЗ **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдПрдХрддреНрд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ **рдбрд┐рдХреНрд░рд┐рдкреНрдЯ** рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдПрдЬреЗрдВрдЯ рдХреЛ **"рдкрд╛рд╕-рдереНрд░реВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдПрдЬреЗрдВрдЯ"** рдпрд╛ **PTA рдПрдЬреЗрдВрдЯ** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред
4. **рдПрдЬреЗрдВрдЯ** рдХреНрд░реЗрдбреНрд╕ рдХреЛ **рдСрди-рдкреНрд░рд┐рдо AD** рдХреЗ рдЦрд┐рд▓рд╛рдл **рдорд╛рдиреНрдпрддрд╛** рджреЗрддрд╛ рд╣реИ рдФрд░ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** **рд╡рд╛рдкрд╕** Azure AD рдХреЛ рднреЗрдЬрддрд╛ рд╣реИ рдЬреЛ, рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдХрд╛рд░рд╛рддреНрдордХ рд╣реИ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓реЙрдЧрд┐рди рдХреЛ **рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИ**ред

{% hint style="warning" %}
рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ **PTA** рдХреЛ **рд╕рдордЭреМрддрд╛** рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдХрддрд╛рд░ рдореЗрдВ рд╕рднреА **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдХреЛ **рд╕реНрдкрд╖реНрдЯ-рдкрд╛рда** рдореЗрдВ **рджреЗрдЦ** рд╕рдХрддрд╛ рд╣реИред\
рд╡рд╣ AzureAD рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рднреА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ **рдорд╛рдиреНрдпрддрд╛** рднреА рджреЗ рд╕рдХрддрд╛ рд╣реИ (Skeleton key рдХреЗ рд╕рдорд╛рди рд╣рдорд▓рд╛)ред
{% endhint %}

### рдСрди-рдкреНрд░рд┐рдо -> рдХреНрд▓рд╛рдЙрдб

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **Azure AD Connect рд╕рд░реНрд╡рд░** рдХреЗ рд▓рд┐рдП **рдПрдбрдорд┐рди** рдПрдХреНрд╕реЗрд╕ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **PTA** **рдПрдЬреЗрдВрдЯ** рдЪрд▓ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк **AADInternals** рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ **рдмреИрдХрдбреЛрд░ рдбрд╛рд▓** рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **рд╕рднреА рдкрд╛рд╕рд╡рд░реНрдбреНрд╕ рдХреЛ рдорд╛рдиреНрдпрддрд╛** рджреЗрдЧрд╛ (рдЗрд╕рд▓рд┐рдП рд╕рднреА рдкрд╛рд╕рд╡рд░реНрдбреНрд╕ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдп рд╣реЛрдВрдЧреЗ):
```powershell
Install-AADIntPTASpy
```
{% hint style="info" %}
рдпрджрд┐ **рд╕реНрдерд╛рдкрдирд╛ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддреА рд╣реИ**, рддреЛ рдпрд╣ рд╕рдВрднрд╡рддрдГ [Microsoft Visual C++ 2015 Redistributables](https://download.microsoft.com/download/6/A/A/6AA4EDFF-645B-48C5-81CC-ED5963AEAD48/vc\_redist.x64.exe) рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдХрд╛рд░рдг рд╣реИред
{% endhint %}

PTA рдПрдЬреЗрдВрдЯ рдХреЛ рднреЗрдЬреЗ рдЧрдП **рд╕реНрдкрд╖реНрдЯ-рдкрд╛рда рдкрд╛рд╕рд╡рд░реНрдб рджреЗрдЦрдирд╛** рднреА рд╕рдВрднрд╡ рд╣реИ, рдЗрд╕рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд cmdlet рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдЬрд╣рд╛рдВ рдкрд╣рд▓реЗ рдмреИрдХрдбреЛрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:
```powershell
Get-AADIntPTASpyLog -DecodePasswords
```
рдпрд╣ рдмреИрдХрдбреЛрд░:

* рдПрдХ рдЫрд┐рдкрд╛ рд╣реБрдЖ рдлреЛрд▓реНрдбрд░ `C:\PTASpy` рдмрдирд╛рдПрдЧрд╛
* `C:\PTASpy` рдореЗрдВ рдПрдХ `PTASpy.dll` рдХреЙрдкреА рдХрд░реЗрдЧрд╛
* `AzureADConnectAuthenticationAgentService` рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ `PTASpy.dll` рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдЧрд╛

{% hint style="info" %}
рдЬрдм AzureADConnectAuthenticationAgent рд╕реЗрд╡рд╛ рдкреБрдирдГ рдЖрд░рдВрдн рд╣реЛрддреА рд╣реИ, PTASpy "рдЕрдирд▓реЛрдб" рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдкреБрдирдГ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдкрдбрд╝рддрд╛ рд╣реИред
{% endhint %}

### рдХреНрд▓рд╛рдЙрдб -> рдСрди-рдкреНрд░реЗрдо

{% hint style="danger" %}
рдХреНрд▓рд╛рдЙрдб рдкрд░ **GA рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдПрдХ **рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рдорд╢реАрди** рдкрд░ рдЗрд╕реЗ рд╕реЗрдЯ рдХрд░рдХреЗ рдПрдХ рдирдпрд╛ PTA рдПрдЬреЗрдВрдЯ **рд░рдЬрд┐рд╕реНрдЯрд░** рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдПрдХ рдмрд╛рд░ рдПрдЬреЗрдВрдЯ **рд╕реЗрдЯрдЕрдк** рд╣реЛ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдХрд┐рд╕реА рднреА рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХрд░рдиреЗ рдХреЗ **рдкрд┐рдЫрд▓реЗ** рдЪрд░рдгреЛрдВ рдХреЛ **рджреЛрд╣рд░рд╛** рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рд╛рде рд╣реА, **рдкрд╛рд╕рд╡рд░реНрдбреНрд╕ рдХреЛ рд╕реНрдкрд╖реНрдЯ-рдкрд╛рда рдореЗрдВ рдкреНрд░рд╛рдкреНрдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

### рд╕реАрдорд▓реЗрд╕ SSO

PTA рдХреЗ рд╕рд╛рде рд╕реАрдорд▓реЗрд╕ SSO рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдЬреЛ рдЕрдиреНрдп рджреБрд░реБрдкрдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИред рдЗрд╕реЗ рдпрд╣рд╛рдБ рдЬрд╛рдВрдЪреЗрдВ:

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://learn.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-pta](https://learn.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-pta)
* [https://aadinternals.com/post/on-prem\_admin/#pass-through-authentication](https://aadinternals.com/post/on-prem\_admin/#pass-through-authentication)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ**ред
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
