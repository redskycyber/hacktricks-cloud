# Az AD Connect - Identidad H铆brida

<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informaci贸n B谩sica

**AD local** puede ser **integrado** con Azure AD usando **Azure AD Connect** con los siguientes **m茅todos,** los cuales podr铆an ser abusados para comprometer la **nube desde AD local o viceversa (**o ambos). Cada m茅todo soporta Single Sign-on (SSO):

* **Sincronizaci贸n de Hash de Contrase帽a (PHS)**: Es posible extraer las contrase帽as de usuarios privilegiados en texto claro del AD, incluso las credenciales de un usuario auto generado con altos privilegios sobre AzureAD.

{% content-ref url="phs-password-hash-sync.md" %}
[phs-password-hash-sync.md](phs-password-hash-sync.md)
{% endcontent-ref %}

* **Autenticaci贸n de Paso a Trav茅s (PTA)**: Es posible **comprometer el agente** que se ejecuta en el AD local para **validar todas las contrase帽as** de los usuarios que intentan conectarse a Azure (local -> Nube) y tambi茅n es posible **registrar un nuevo agente** para validar la autenticaci贸n en un nuevo lugar (Nube -> local).

{% content-ref url="pta-pass-through-authentication.md" %}
[pta-pass-through-authentication.md](pta-pass-through-authentication.md)
{% endcontent-ref %}

* **Federaci贸n**: Roba la **clave privada usada para firmar el SAML** y podr谩s suplantar identidades locales y en la nube.

{% content-ref url="federation.md" %}
[federation.md](federation.md)
{% endcontent-ref %}

* **SSO Sin Problemas:** Roba la contrase帽a del usuario auto creado **AZUREADSSOACC** que se utiliza para firmar tickets de plata de kerberos para acceder a AzureAD, e impersonar a cualquier usuario en la nube.

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

* **Confianza Kerberos en la Nube**: De **Administrador Global a Administrador de Dominio local** suplantando usuario modificando el nombre de usuario y SID de usuarios en AzureAD y luego solicitando TGTs a AzureAD.

{% content-ref url="az-cloud-kerberos-trust.md" %}
[az-cloud-kerberos-trust.md](az-cloud-kerberos-trust.md)
{% endcontent-ref %}

* **Aplicaciones Predeterminadas**: Si comprometes una cuenta de **Administrador de Aplicaciones** o la **cuenta de Sincronizaci贸n local**, puedes leer y **modificar la configuraci贸n del directorio, membres铆as de grupo, cuentas de usuario, sitios de SharePoint y archivos de OneDrive**.

{% content-ref url="az-default-applications.md" %}
[az-default-applications.md](az-default-applications.md)
{% endcontent-ref %}

Para cada m茅todo, al menos se realiza la **sincronizaci贸n de usuarios** y se crea una cuenta con el nombre **`MSOL_<installationidentifier>`** en el **AD local**.

Adem谩s, tanto **PHS** como **PTA** **soportan** **SSO Sin Problemas** para iniciar sesi贸n autom谩ticamente en computadoras de Azure AD **unidas al dominio local**.

Es posible verificar si **Azure AD Connect** est谩 instalado con este comando del m贸dulo AzureADConnectHealthSync que se **instala por defecto** en la instalaci贸n de **Azure AD Connect**:
```powershell
Get-ADSyncConnector
```
<details>

<summary><strong>Aprende hacking en AWS de cero a h茅roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue**me en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
