# Az - Azure App Service & Function Apps

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDFï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## App Service åŸºæœ¬ä¿¡æ¯

_Azure App Service_ æ˜¯ä¸€ä¸ªåŸºäº HTTP çš„æœåŠ¡ï¼Œç”¨äºæ‰˜ç®¡ Web åº”ç”¨ç¨‹åºã€REST API å’Œç§»åŠ¨åç«¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ‚¨å–œæ¬¢çš„è¯­è¨€è¿›è¡Œå¼€å‘ï¼Œå¦‚ .NETã€.NET Coreã€Javaã€Rubyã€Node.jsã€PHP æˆ– Pythonã€‚åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ Windows å’Œ Linux ç¯å¢ƒä¸­è½»æ¾è¿è¡Œå’Œæ‰©å±•ã€‚

æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½è¿è¡Œåœ¨ä¸€ä¸ªæ²™ç®±ä¸­ï¼Œä½†éš”ç¦»å–å†³äº App Service è®¡åˆ’

* å…è´¹å’Œå…±äº«å±‚çš„åº”ç”¨ç¨‹åºè¿è¡Œåœ¨å…±äº«çš„è™šæ‹Ÿæœºä¸Š
* æ ‡å‡†å’Œé«˜çº§å±‚çš„åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ä¸“ç”¨çš„è™šæ‹Ÿæœºä¸Š

{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œ**æ²¡æœ‰**è¿™äº›éš”ç¦»æªæ–½ä¼š**é˜»æ­¢**å…¶ä»–å¸¸è§çš„**Web æ¼æ´**ï¼ˆå¦‚æ–‡ä»¶ä¸Šä¼ æˆ–æ³¨å…¥ï¼‰ã€‚å¦‚æœä½¿ç”¨äº†**ç®¡ç†èº«ä»½**ï¼Œå¯èƒ½ä¼š**å±åŠå…¶æƒé™**ã€‚
{% endhint %}

### æšä¸¾

{% tabs %}
{% tab title="az" %}
{% code overflow="wrap" %}
```bash
# List webapps
az webapp list

## Less information
az webapp list --query "[].{hostName: defaultHostName, state: state, name: name, resourcegroup: resourceGroup}"

# Get access restrictions
az webapp config access-restriction show --resource-group <res-group> -n <name>

# Remove access restrictions
az webapp config access-restriction remove --resource-group <res-group> -n <name> --rule-name <rule-name>

# Get snapshots
az webapp config snapshot list --resource-group <res-group> -n <name>

# Restore snapshot
az webapp config snapshot restore -g <res-group> -n <name> --time 2018-12-11T23:34:16.8388367

# Restart webapp
az webapp restart --name <name> --resource-group <res-group>
```
{% endcode %}
{% endtab %}

{% tab title="Az Powershell" %}
```powershell
# Get App Services and Function Apps
Get-AzWebApp
# Get only App Services
Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}
```
#### è·å–å‡­æ®å’Œè®¿é—®Webåº”ç”¨ç¨‹åºä»£ç 

To obtain credentials and gain access to the web application code, you can follow these steps:

1. **Reverse Engineering**: Analyze the web application binaries or reverse engineer the application to understand its inner workings and identify potential vulnerabilities.

2. **Credential Leakage**: Look for any instances where credentials might be leaked, such as hardcoded credentials in the source code, configuration files, or environment variables.

3. **Weak Authentication**: Test the authentication mechanism of the web application for weak passwords, default credentials, or any other vulnerabilities that could allow unauthorized access.

4. **Brute-Force Attacks**: Attempt to guess or crack passwords by systematically trying different combinations until the correct one is found.

5. **Password Reset**: Exploit any weaknesses in the password reset functionality to gain unauthorized access to the account.

6. **Session Hijacking**: Look for vulnerabilities that could allow an attacker to hijack an active session and gain unauthorized access to the web application.

7. **Code Injection**: Exploit any code injection vulnerabilities to execute arbitrary code and gain control over the web application.

8. **File Inclusion**: Exploit any file inclusion vulnerabilities to read sensitive files or execute arbitrary code on the server.

9. **Database Injection**: Exploit any database injection vulnerabilities to manipulate the database and gain unauthorized access to data.

10. **Server Misconfigurations**: Look for any misconfigurations in the server or application settings that could lead to unauthorized access or information disclosure.

By following these steps, you can obtain credentials and gain access to the web application code, allowing you to further analyze and exploit any vulnerabilities you discover.
```bash
# Get connection strings that could contain credentials (with DBs for example)
az webapp config connection-string list --name <name> --resource-group <res-group>
## Check how to use the DBs connection strings in the SQL page

# Get credentials to access the code and DB credentials if configured.
az webapp deployment list-publishing-profiles --resource-group <res-group> -n <name>


# Get git URL to access the code
az webapp deployment source config-local-git --resource-group <res-group> -n <name>

# Access/Modify the code via git
git clone 'https://<username>:<password>@name.scm.azurewebsites.net/repo-name.git'
## In my case the username was: $nameofthewebapp and the password some random chars
## If you change the code and do a push, the app is automatically redeployed
```
#### é€šè¿‡sshè®¿é—®webappçš„Dockerå®¹å™¨ï¼š

```bash
ssh -p 2222 root@<app_name>.scm.azurewebsites.net
```

Replace `<app_name>` with the name of your web app.

å°†`<app_name>`æ›¿æ¢ä¸ºæ‚¨çš„web appçš„åç§°ã€‚
```bash
# Get ssh session
az webapp create-remote-connection --subscription <SUBSCRIPTION-ID> --resource-group <RG-NAME> -n <APP-SERVICE-NAME>

## If successfull you will get a message such as:
#Verifying if app is running....
#App is running. Trying to establish tunnel connection...
#Opening tunnel on port: 39895
#SSH is available { username: root, password: Docker! }

## So from that machine ssh into that port (you might need generate a new ssh session to the jump host)
ssh root@127.0.0.1 -p 39895

```
## Function AppsåŸºæœ¬ä¿¡æ¯

Azure Functionsæ˜¯ä¸€ç§æ— æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥è®©æ‚¨ç¼–å†™æ›´å°‘çš„ä»£ç ã€ç»´æŠ¤æ›´å°‘çš„åŸºç¡€è®¾æ–½å¹¶èŠ‚çœæˆæœ¬ã€‚ä¸å…¶æ‹…å¿ƒéƒ¨ç½²å’Œç»´æŠ¤æœåŠ¡å™¨ï¼Œäº‘åŸºç¡€è®¾æ–½æä¾›äº†æ‰€æœ‰æœ€æ–°çš„èµ„æºï¼Œä»¥ä¿æŒåº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚

Azure Functionsä¸Azure API Managementé›†æˆåœ¨é—¨æˆ·ä¸­ï¼Œå¯ä»¥å°†æ‚¨çš„HTTPè§¦å‘å™¨å‡½æ•°**ç«¯ç‚¹å…¬å¼€ä¸ºREST API**ã€‚è¿™äº›APIä½¿ç”¨OpenAPIå®šä¹‰è¿›è¡Œæè¿°ã€‚

**Function Appsæ”¯æŒæ‰˜ç®¡æ ‡è¯†ã€‚**

### æšä¸¾
```powershell
# Get only Function Apps
Get-AzFunctionApp
```
## å‚è€ƒèµ„æ–™

* [https://learn.microsoft.com/en-in/azure/app-service/overview](https://learn.microsoft.com/en-in/azure/app-service/overview)
* [https://app.gitbook.com/s/5uvPQhxNCPYYTqpRwsuS/\~/changes/en8rTJy7DsFQXWyNeiqE/pentesting-cloud/azure-security/az-services/az-function-apps#references](https://app.gitbook.com/s/5uvPQhxNCPYYTqpRwsuS/\~/changes/en8rTJy7DsFQXWyNeiqE/pentesting-cloud/azure-security/az-services/az-function-apps#references)
* [https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition](https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition)

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDF ç‰ˆæœ¬ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
