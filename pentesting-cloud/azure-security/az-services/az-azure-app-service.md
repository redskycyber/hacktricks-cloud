# Az - Azure App Service & Function Apps

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

- å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
- è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
- æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFTs](https://opensea.io/collection/the-peass-family)æ”¶è—å“
- **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**ã€‚**
- é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## App ServiceåŸºæœ¬ä¿¡æ¯

[æ¥è‡ªæ–‡æ¡£ï¼š](https://learn.microsoft.com/en-us/azure/app-service/overview) _Azure App Service_æ˜¯ä¸€ä¸ªåŸºäºHTTPçš„æœåŠ¡ï¼Œç”¨äºæ‰˜ç®¡Webåº”ç”¨ç¨‹åºã€REST APIå’Œç§»åŠ¨åç«¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è‡ªå·±å–œæ¬¢çš„è¯­è¨€è¿›è¡Œå¼€å‘ï¼Œå¦‚.NETã€.NET Coreã€Javaã€Rubyã€Node.jsã€PHPæˆ–Pythonã€‚åº”ç”¨ç¨‹åºå¯ä»¥åœ¨åŸºäºWindowså’ŒLinuxçš„ç¯å¢ƒä¸­è½»æ¾è¿è¡Œå’Œæ‰©å±•ã€‚

æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½åœ¨ä¸€ä¸ªæ²™ç®±ä¸­è¿è¡Œï¼Œä½†éš”ç¦»å–å†³äºApp Serviceè®¡åˆ’

- Freeå’ŒSharedå±‚ä¸­çš„åº”ç”¨ç¨‹åºåœ¨å…±äº«çš„è™šæ‹Ÿæœºä¸Šè¿è¡Œ
- Standardå’ŒPremiumå±‚ä¸­çš„åº”ç”¨ç¨‹åºåœ¨ä¸“ç”¨è™šæ‹Ÿæœºä¸Šè¿è¡Œ

{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œ**æ²¡æœ‰**è¿™äº›éš”ç¦»å¯ä»¥**é˜²æ­¢**å…¶ä»–å¸¸è§çš„**Webæ¼æ´**ï¼ˆå¦‚æ–‡ä»¶ä¸Šä¼ æˆ–æ³¨å…¥ï¼‰ã€‚å¦‚æœä½¿ç”¨**ç®¡ç†èº«ä»½**ï¼Œå¯èƒ½ä¼š**å±åŠå…¶æƒé™**ã€‚
{% endhint %}

### æšä¸¾

{% tabs %}
{% tab title="az" %}
{% code overflow="wrap" %}
```bash
# List webapps
az webapp list

## Less information
az webapp list --query "[].{hostName: defaultHostName, state: state, name: name, resourcegroup: resourceGroup}"

# Get access restrictions
az webapp config access-restriction show --resource-group <res-group> -n <name>

# Remove access restrictions
az webapp config access-restriction remove --resource-group <res-group> -n <name> --rule-name <rule-name>

# Get snapshots
az webapp config snapshot list --resource-group <res-group> -n <name>

# Restore snapshot
az webapp config snapshot restore -g <res-group> -n <name> --time 2018-12-11T23:34:16.8388367

# Restart webapp
az webapp restart --name <name> --resource-group <res-group>
```
{% endcode %}
{% endtab %}

{% tab title="Az Powershell" %}
```powershell
# Get App Services and Function Apps
Get-AzWebApp
# Get only App Services
Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}
```
{% endtab %}

{% tab title="è·å–æ‰€æœ‰" %}
{% code overflow="wrap" %}
```bash
#!/bin/bash

# Get all App Service and Function Apps

# Define Azure subscription ID
azure_subscription="your_subscription_id"

# Log in to Azure
az login

# Select Azure subscription
az account set --subscription $azure_subscription

# Get all App Services in the specified subscription
list_app_services=$(az appservice list --query "[].{appServiceName: name, group: resourceGroup}" -o tsv)

# Iterate over each App Service
echo "$list_app_services" | while IFS=$'\t' read -r appServiceName group; do
# Get the type of the App Service
service_type=$(az appservice show --name $appServiceName --resource-group $group --query "kind" -o tsv)

# Check if it is a Function App and print its name
if [ "$service_type" == "functionapp" ]; then
echo "Function App Name: $appServiceName"
fi
done
```
#### è·å–å‡­æ®å¹¶è®¿é—® Web åº”ç”¨ç¨‹åºä»£ç 
```bash
# Get connection strings that could contain credentials (with DBs for example)
az webapp config connection-string list --name <name> --resource-group <res-group>
## Check how to use the DBs connection strings in the SQL page

# Get credentials to access the code and DB credentials if configured.
az webapp deployment list-publishing-profiles --resource-group <res-group> -n <name>


# Get git URL to access the code
az webapp deployment source config-local-git --resource-group <res-group> -n <name>

# Access/Modify the code via git
git clone 'https://<username>:<password>@name.scm.azurewebsites.net/repo-name.git'
## In my case the username was: $nameofthewebapp and the password some random chars
## If you change the code and do a push, the app is automatically redeployed
```
#### é€šè¿‡sshè®¿é—®åŒ…å«webåº”ç”¨ç¨‹åºçš„Dockerå®¹å™¨:
```bash
# Get ssh session
az webapp create-remote-connection --subscription <SUBSCRIPTION-ID> --resource-group <RG-NAME> -n <APP-SERVICE-NAME>

## If successfull you will get a message such as:
#Verifying if app is running....
#App is running. Trying to establish tunnel connection...
#Opening tunnel on port: 39895
#SSH is available { username: root, password: Docker! }

## So from that machine ssh into that port (you might need generate a new ssh session to the jump host)
ssh root@127.0.0.1 -p 39895
```
## Function AppsåŸºæœ¬ä¿¡æ¯

Azure Functionsæ˜¯ä¸€ç§**æ— æœåŠ¡å™¨**è§£å†³æ–¹æ¡ˆï¼Œå…è®¸æ‚¨ç¼–å†™æ›´å°‘çš„ä»£ç ï¼Œç»´æŠ¤æ›´å°‘çš„åŸºç¡€è®¾æ–½ï¼Œå¹¶èŠ‚çœæˆæœ¬ã€‚ä¸æ‹…å¿ƒéƒ¨ç½²å’Œç»´æŠ¤æœåŠ¡å™¨ä¸åŒï¼Œäº‘åŸºç¡€è®¾æ–½æä¾›äº†æ‰€æœ‰æœ€æ–°èµ„æºï¼Œä»¥ä¿æŒåº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚

åœ¨Azureé—¨æˆ·ä¸­ï¼ŒAzure Functionsä¸Azure API Managementä¹‹é—´çš„é›†æˆå¾—åˆ°äº†ç®€åŒ–ï¼Œå…è®¸å°†**HTTPè§¦å‘å™¨å‡½æ•°ç«¯ç‚¹å…¬å¼€ä¸ºREST API**ã€‚ä»¥è¿™ç§æ–¹å¼å…¬å¼€çš„APIä½¿ç”¨OpenAPIå®šä¹‰è¿›è¡Œæè¿°ï¼Œä¸ºRESTful APIæä¾›äº†æ ‡å‡†çš„ã€ä¸è¯­è¨€æ— å…³çš„æ¥å£ã€‚

**Function Appsæ”¯æŒæ‰˜ç®¡æ ‡è¯†ã€‚**

æ­¤å¤–ï¼ŒFunction Appå¯èƒ½å…·æœ‰éœ€è¦ç‰¹å®šçº§åˆ«èº«ä»½éªŒè¯çš„ç‰¹å®šç«¯ç‚¹ï¼Œä¾‹å¦‚"admin"æˆ–"anonymous"ã€‚\
æ”»å‡»è€…å¯ä»¥å°è¯•è®¿é—®**å…è®¸åŒ¿åè®¿é—®çš„ç«¯ç‚¹**ï¼Œä»¥ç»•è¿‡é™åˆ¶å¹¶è®¿é—®æ•æ„Ÿæ•°æ®æˆ–åŠŸèƒ½ã€‚

### æšä¸¾
```powershell
# Get only Function Apps
Get-AzFunctionApp
```
## å‚è€ƒèµ„æ–™

* [https://learn.microsoft.com/en-in/azure/app-service/overview](https://learn.microsoft.com/en-in/azure/app-service/overview)
* [https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition](https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
