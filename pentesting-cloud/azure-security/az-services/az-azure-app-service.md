# Az - Azure App Service & Function Apps

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>

## App Service åŸºæœ¬æƒ…å ±

_Azure App Service_ ã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€REST APIã€ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ãŸã‚ã®HTTPãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚.NETã€.NET Coreã€Javaã€Rubyã€Node.jsã€PHPã€Pythonãªã©ã€ãŠå¥½ããªè¨€èªã§é–‹ç™ºã§ãã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯WindowsãŠã‚ˆã³Linuxãƒ™ãƒ¼ã‚¹ã®ç’°å¢ƒã§ç°¡å˜ã«å®Ÿè¡ŒãŠã‚ˆã³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã§ãã¾ã™ã€‚

å„ã‚¢ãƒ—ãƒªã¯ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å†…ã§å®Ÿè¡Œã•ã‚Œã¾ã™ãŒã€åˆ†é›¢ã¯App Serviceãƒ—ãƒ©ãƒ³ã«ä¾å­˜ã—ã¾ã™ã€‚

* FreeãŠã‚ˆã³Sharedãƒ†ã‚£ã‚¢ã®ã‚¢ãƒ—ãƒªã¯å…±æœ‰VMä¸Šã§å®Ÿè¡Œã•ã‚Œã¾ã™
* StandardãŠã‚ˆã³Premiumãƒ†ã‚£ã‚¢ã®ã‚¢ãƒ—ãƒªã¯å°‚ç”¨VMä¸Šã§å®Ÿè¡Œã•ã‚Œã¾ã™

{% hint style="warning" %}
**ã„ãšã‚Œã®**åˆ†é›¢ã‚‚ã€ä¸€èˆ¬çš„ãª**Webã®è„†å¼±æ€§**ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚„ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãªã©ï¼‰ã‚’**é˜²ãã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚ã¾ãŸã€**ç®¡ç†ID**ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã®æ¨©é™ã‚’**ä¾µå®³ã™ã‚‹**å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

### åˆ—æŒ™

{% tabs %}
{% tab title="az" %}
{% code overflow="wrap" %}
```bash
# List webapps
az webapp list

## Less information
az webapp list --query "[].{hostName: defaultHostName, state: state, name: name, resourcegroup: resourceGroup}"

# Get access restrictions
az webapp config access-restriction show --resource-group <res-group> -n <name>

# Remove access restrictions
az webapp config access-restriction remove --resource-group <res-group> -n <name> --rule-name <rule-name>

# Get snapshots
az webapp config snapshot list --resource-group <res-group> -n <name>

# Restore snapshot
az webapp config snapshot restore -g <res-group> -n <name> --time 2018-12-11T23:34:16.8388367

# Restart webapp
az webapp restart --name <name> --resource-group <res-group>
```
{% endcode %}
{% endtab %}

{% tab title="Az Powershell" %}
```powershell
# Get App Services and Function Apps
Get-AzWebApp
# Get only App Services
Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}
```
#### è³‡æ ¼æƒ…å ±ã‚’å–å¾—ã—ã€webappã‚³ãƒ¼ãƒ‰ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¾—ã‚‹
```bash
# Get connection strings that could contain credentials (with DBs for example)
az webapp config connection-string list --name <name> --resource-group <res-group>
## Check how to use the DBs connection strings in the SQL page

# Get credentials to access the code and DB credentials if configured.
az webapp deployment list-publishing-profiles --resource-group <res-group> -n <name>


# Get git URL to access the code
az webapp deployment source config-local-git --resource-group <res-group> -n <name>

# Access/Modify the code via git
git clone 'https://<username>:<password>@name.scm.azurewebsites.net/repo-name.git'
## In my case the username was: $nameofthewebapp and the password some random chars
## If you change the code and do a push, the app is automatically redeployed
```
#### Webã‚¢ãƒ—ãƒªã‚’å«ã‚€Dockerã‚³ãƒ³ãƒ†ãƒŠã¸ã®sshçµŒç”±ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ï¼š
```bash
# Get ssh session
az webapp create-remote-connection --subscription <SUBSCRIPTION-ID> --resource-group <RG-NAME> -n <APP-SERVICE-NAME>

## If successfull you will get a message such as:
#Verifying if app is running....
#App is running. Trying to establish tunnel connection...
#Opening tunnel on port: 39895
#SSH is available { username: root, password: Docker! }

## So from that machine ssh into that port (you might need generate a new ssh session to the jump host)
ssh root@127.0.0.1 -p 39895

```
## Function Apps åŸºæœ¬æƒ…å ±

Azure Functions ã¯ã€ã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°ã‚’æ¸›ã‚‰ã—ã€ã‚¤ãƒ³ãƒ•ãƒ©ã®ç¶­æŒã‚’å°‘ãªãã—ã€ã‚³ã‚¹ãƒˆã‚’ç¯€ç´„ã§ãã‚‹**ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹**ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚„ç¶­æŒã«æ‚©ã‚€ä»£ã‚ã‚Šã«ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¨¼åƒã•ã›ç¶šã‘ã‚‹ãŸã‚ã«å¿…è¦ãªæœ€æ–°ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

Azure Functions ã¯ã€ãƒãƒ¼ã‚¿ãƒ«å†…ã® Azure API Management ã¨çµ±åˆã—ã¦ã€HTTP ãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ã®**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ REST API ã¨ã—ã¦å…¬é–‹**ã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã® API ã¯ OpenAPI å®šç¾©ã‚’ä½¿ç”¨ã—ã¦è¨˜è¿°ã•ã‚Œã¾ã™ã€‚

**Function Apps ã¯ Managed Identities ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚**

### åˆ—æŒ™
```powershell
# Get only Function Apps
Get-AzFunctionApp
```
## å‚è€ƒæ–‡çŒ®

* [https://learn.microsoft.com/en-in/azure/app-service/overview](https://learn.microsoft.com/en-in/azure/app-service/overview)
* [https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition](https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§å­¦ã¶</strong></summary>

HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricksã«ã‚ãªãŸã®ä¼šç¤¾ã‚’åºƒå‘Šã—ãŸã„**ã€ã¾ãŸã¯**HackTricksã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASS & HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª[**NFTs**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ ã™ã‚‹**ã‹ã€[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã€ã¾ãŸã¯**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’**ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**ã€‚
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ã‚ãªãŸã®ãƒãƒƒã‚­ãƒ³ã‚°ã®ã‚³ãƒ„ã‚’**å…±æœ‰ã™ã‚‹**ã€‚

</details>
