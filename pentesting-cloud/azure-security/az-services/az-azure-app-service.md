# Az - Azure App Service & Function Apps

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* If you want to see your **company advertised in HackTricks** or if you want access to the **latest version of the PEASS or download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## App Serviceã®åŸºæœ¬æƒ…å ±

_Azure App Service_ã¯ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€REST APIã€ãŠã‚ˆã³ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ãƒ›ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®HTTPãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ãŠå¥½ããªè¨€èªã§é–‹ç™ºã§ãã¾ã™ã€‚.NETã€.NET Coreã€Javaã€Rubyã€Node.jsã€PHPã€ã¾ãŸã¯Pythonã§ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€WindowsãŠã‚ˆã³Linuxãƒ™ãƒ¼ã‚¹ã®ç’°å¢ƒã§ç°¡å˜ã«å®Ÿè¡ŒãŠã‚ˆã³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã§ãã¾ã™ã€‚

å„ã‚¢ãƒ—ãƒªã¯ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å†…ã§å®Ÿè¡Œã•ã‚Œã¾ã™ãŒã€ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ©ãƒ³ã«ã‚ˆã£ã¦åˆ†é›¢åº¦ãŒç•°ãªã‚Šã¾ã™ã€‚

* FreeãŠã‚ˆã³Sharedãƒ†ã‚£ã‚¢ã®ã‚¢ãƒ—ãƒªã¯å…±æœ‰VMä¸Šã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
* StandardãŠã‚ˆã³Premiumãƒ†ã‚£ã‚¢ã®ã‚¢ãƒ—ãƒªã¯å°‚ç”¨VMä¸Šã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

{% hint style="warning" %}
ã“ã‚Œã‚‰ã®åˆ†é›¢ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚„ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãªã©ã®ä¸€èˆ¬çš„ãªWebè„†å¼±æ€§ã‚’**é˜²ãã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚ã¾ãŸã€**ç®¡ç†ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£**ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã®æ¨©é™ã‚’**ä¾µå®³ã™ã‚‹å¯èƒ½æ€§**ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

### åˆ—æŒ™

{% tabs %}
{% tab title="az" %}
{% code overflow="wrap" %}
```bash
# List webapps
az webapp list

## Less information
az webapp list --query "[].{hostName: defaultHostName, state: state, name: name, resourcegroup: resourceGroup}"

# Get access restrictions
az webapp config access-restriction show --resource-group <res-group> -n <name>

# Remove access restrictions
az webapp config access-restriction remove --resource-group <res-group> -n <name> --rule-name <rule-name>

# Get snapshots
az webapp config snapshot list --resource-group <res-group> -n <name>

# Restore snapshot
az webapp config snapshot restore -g <res-group> -n <name> --time 2018-12-11T23:34:16.8388367

# Restart webapp
az webapp restart --name <name> --resource-group <res-group>
```
{% endcode %}
{% endtab %}

{% tab title="Az Powershell" %}
```powershell
# Get App Services and Function Apps
Get-AzWebApp
# Get only App Services
Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}
```
#### è³‡æ ¼æƒ…å ±ã®å–å¾—ã¨Webã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

To obtain credentials and gain access to the webapp code, you can try the following techniques:

- **Application Insights**: Check if the webapp is using Application Insights for logging. If it is, you can access the logs and potentially find sensitive information such as connection strings or passwords.

- **Kudu Console**: Azure App Service provides a Kudu Console, which is a debugging and administration tool. You can access it by appending "/scm" to the webapp URL. From there, you can navigate to the Debug Console and explore the file system to find the webapp code.

- **FTP**: If FTP is enabled for the webapp, you can use an FTP client to connect to the webapp and browse the file system. Look for configuration files or other sensitive information that may be stored in plain text.

- **Azure Storage**: Check if the webapp is using Azure Storage for storing files or data. If it is, you can try to access the storage account and look for any sensitive information that may have been stored there.

- **Environment Variables**: Sometimes, sensitive information such as database connection strings or API keys are stored as environment variables. You can try to access the webapp's environment variables to see if any sensitive information is exposed.

Remember to always follow ethical hacking practices and obtain proper authorization before attempting any of these techniques.
```bash
# Get connection strings that could contain credentials (with DBs for example)
az webapp config connection-string list --name <name> --resource-group <res-group>
## Check how to use the DBs connection strings in the SQL page

# Get credentials to access the code and DB credentials if configured.
az webapp deployment list-publishing-profiles --resource-group <res-group> -n <name>


# Get git URL to access the code
az webapp deployment source config-local-git --resource-group <res-group> -n <name>

# Access/Modify the code via git
git clone 'https://<username>:<password>@name.scm.azurewebsites.net/repo-name.git'
## In my case the username was: $nameofthewebapp and the password some random chars
## If you change the code and do a push, the app is automatically redeployed
```
#### SSHã‚’ä»‹ã—ã¦Webã‚¢ãƒ—ãƒªã®Dockerã‚³ãƒ³ãƒ†ãƒŠã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•:

```bash
ssh -p <port> <username>@<app-name>.scm.azurewebsites.net
```

Replace `<port>` with the SSH port number, `<username>` with the username, and `<app-name>` with the name of your web app.

`<port>`ã«ã¯SSHãƒãƒ¼ãƒˆç•ªå·ã€`<username>`ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€`<app-name>`ã«ã¯Webã‚¢ãƒ—ãƒªã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
```bash
# Get ssh session
az webapp create-remote-connection --subscription <SUBSCRIPTION-ID> --resource-group <RG-NAME> -n <APP-SERVICE-NAME>

## If successfull you will get a message such as:
#Verifying if app is running....
#App is running. Trying to establish tunnel connection...
#Opening tunnel on port: 39895
#SSH is available { username: root, password: Docker! }

## So from that machine ssh into that port (you might need generate a new ssh session to the jump host)
ssh root@127.0.0.1 -p 39895

```
## Function Appsã®åŸºæœ¬æƒ…å ±

Azure Functionsã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’å°‘ãªãã—ã€ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’å°‘ãªãä¿å®ˆã—ã€ã‚³ã‚¹ãƒˆã‚’ç¯€ç´„ã™ã‚‹ã“ã¨ãŒã§ãã‚‹**ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹**ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ä¿å®ˆã«ã¤ã„ã¦å¿ƒé…ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œã«å¿…è¦ãªæœ€æ–°ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

Azure Functionsã¯ã€Azure API Managementã¨çµ±åˆã•ã‚Œã¦ãŠã‚Šã€ãƒãƒ¼ã‚¿ãƒ«ã§HTTPãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ã®**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’REST APIã¨ã—ã¦å…¬é–‹**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®APIã¯ã€OpenAPIå®šç¾©ã‚’ä½¿ç”¨ã—ã¦è¨˜è¿°ã•ã‚Œã¾ã™ã€‚

**Function Appsã¯ã€ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚**

### åˆ—æŒ™
```powershell
# Get only Function Apps
Get-AzFunctionApp
```
## å‚è€ƒæ–‡çŒ®

* [https://learn.microsoft.com/en-in/azure/app-service/overview](https://learn.microsoft.com/en-in/azure/app-service/overview)
* [https://app.gitbook.com/s/5uvPQhxNCPYYTqpRwsuS/\~/changes/en8rTJy7DsFQXWyNeiqE/pentesting-cloud/azure-security/az-services/az-function-apps#references](https://app.gitbook.com/s/5uvPQhxNCPYYTqpRwsuS/\~/changes/en8rTJy7DsFQXWyNeiqE/pentesting-cloud/azure-security/az-services/az-function-apps#references)
* [https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition](https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition)

<details>

<summary><strong>ãƒãƒƒã‚¯ãƒˆãƒªãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å¾—ã‚‹ï¼</strong></summary>

* **HackTricks**ã§**ä¼šç¤¾ã®åºƒå‘Šã‚’è¦‹ãŸã„**å ´åˆã‚„ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ãŸã„å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
