# Az - æœåŠ¡

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDFï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## é—¨æˆ·

æ‚¨å¯ä»¥åœ¨ [**https://msportals.io/**](https://msportals.io/) ä¸Šæ‰¾åˆ°**Microsoft é—¨æˆ·çš„åˆ—è¡¨**

### åŸå§‹è¯·æ±‚

#### é€šè¿‡ Powershell è®¿é—® Azure API

ä» **IDENTITY\_HEADER** å’Œ **IDENTITY\_ENDPOINT** è·å– **access\_token**ï¼š`system('curl "$IDENTITY_ENDPOINT?resource=https://management.azure.com/&api-version=2017-09-01" -H secret:$IDENTITY_HEADER');`.

ç„¶åæŸ¥è¯¢ Azure REST API æ¥è·å– **subscription ID** å’Œæ›´å¤šä¿¡æ¯ã€‚
```powershell
$Token = 'eyJ0eX..'
$URI = 'https://management.azure.com/subscriptions?api-version=2020-01-01'
# $URI = 'https://graph.microsoft.com/v1.0/applications'
$RequestParams = @{
Method = 'GET'
Uri = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value

# List resources and check for runCommand privileges
$URI = 'https://management.azure.com/subscriptions/b413826f-108d-4049-8c11-d52d5d388768/resources?api-version=2020-10-01'
$URI = 'https://management.azure.com/subscriptions/b413826f-108d-4049-8c11-d52d5d388768/resourceGroups/<RG-NAME>/providers/Microsoft.Compute/virtualMachines/<RESOURCE/providers/Microsoft.Authorization/permissions?apiversion=2015-07-01'
```
#### é€šè¿‡Pythonç‰ˆæœ¬è®¿é—®Azure API

To interact with Azure services using Python, you can make use of the Azure SDK for Python. This SDK provides a set of libraries and tools that allow you to easily access and manage various Azure services.

### Prerequisites

Before you can start using the Azure SDK for Python, you need to have the following:

- Python installed on your system
- An Azure subscription
- Azure SDK for Python installed

### Installing the Azure SDK for Python

To install the Azure SDK for Python, you can use the pip package manager. Open a terminal or command prompt and run the following command:

```shell
pip install azure
```

### Authenticating with Azure

To authenticate with Azure, you need to obtain a set of credentials. There are different ways to authenticate, such as using a service principal or a managed identity. Once you have the credentials, you can use them to create an instance of the Azure client.

Here is an example of authenticating with Azure using a service principal:

```python
from azure.identity import ClientSecretCredential
from azure.mgmt.resource import ResourceManagementClient

# Set the credentials
tenant_id = '<your-tenant-id>'
client_id = '<your-client-id>'
client_secret = '<your-client-secret>'

# Create the credentials object
credentials = ClientSecretCredential(tenant_id, client_id, client_secret)

# Create the Azure client
client = ResourceManagementClient(credentials, '<your-subscription-id>')
```

### Accessing Azure Services

Once you have authenticated with Azure, you can use the Azure client to access and manage various Azure services. The Azure SDK for Python provides a set of modules for different services, such as compute, storage, networking, and more.

Here is an example of accessing the Azure Virtual Machines service:

```python
from azure.mgmt.compute import ComputeManagementClient

# Create the compute client
compute_client = ComputeManagementClient(credentials, '<your-subscription-id>')

# List all virtual machines
virtual_machines = compute_client.virtual_machines.list_all()

# Print the virtual machine names
for vm in virtual_machines:
    print(vm.name)
```

### Conclusion

In this guide, we have seen how to access Azure services using Python. The Azure SDK for Python provides a convenient way to interact with Azure and manage various services. By following the steps outlined in this guide, you can start building applications and automating tasks using Python and Azure.
```python
IDENTITY_ENDPOINT = os.environ['IDENTITY_ENDPOINT']
IDENTITY_HEADER = os.environ['IDENTITY_HEADER']

print("[+] Management API")
cmd = 'curl "%s?resource=https://management.azure.com/&api-version=2017-09-01" -H secret:%s' % (IDENTITY_ENDPOINT, IDENTITY_HEADER)
val = os.popen(cmd).read()
print("Access Token: "+json.loads(val)["access_token"])
print("ClientID/AccountID: "+json.loads(val)["client_id"])

print("\r\n[+] Graph API")
cmd = 'curl "%s?resource=https://graph.microsoft.com/&api-version=2017-09-01" -H secret:%s' % (IDENTITY_ENDPOINT, IDENTITY_HEADER)
val = os.popen(cmd).read()
print(json.loads(val)["access_token"])
print("ClientID/AccountID: "+json.loads(val)["client_id"])
```
æˆ–è€…åœ¨ä¸€ä¸ªPythonå‡½æ•°å†…éƒ¨ï¼š
```python
import logging, os
import azure.functions as func

def main(req: func.HttpRequest) -> func.HttpResponse:
logging.info('Python HTTP trigger function processed a request.')
IDENTITY_ENDPOINT = os.environ['IDENTITY_ENDPOINT']
IDENTITY_HEADER = os.environ['IDENTITY_HEADER']
cmd = 'curl "%s?resource=https://management.azure.com&apiversion=2017-09-01" -H secret:%s' % (IDENTITY_ENDPOINT, IDENTITY_HEADER)
val = os.popen(cmd).read()
return func.HttpResponse(val, status_code=200)
```
## æœåŠ¡åˆ—è¡¨

* [**Azure AD**](az-azuread.md)
* [**åº”ç”¨ç¨‹åºä»£ç†**](az-application-proxy.md)
* [**Armæ¨¡æ¿/éƒ¨ç½²**](az-arm-templates.md)
* [**è‡ªåŠ¨åŒ–å¸æˆ·**](az-automation-account/)
* [**åº”ç”¨æœåŠ¡å’Œå‡½æ•°åº”ç”¨**](az-azure-app-service.md)
* [**Blobå­˜å‚¨**](az-blob-storage.md)
* [**Intune**](../intune.md)
* [**Keyvault**](../keyvault.md)
* [**è™šæ‹Ÿæœº**](../vms.md)

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFç‰ˆçš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„åŠ¨æ€ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
