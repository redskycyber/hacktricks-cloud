# Az - Blob Storage

<details>

<summary><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)ë¡œë¶€í„° AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ìš°ì„¸ìš”!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

- **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
- [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
- ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
- **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ê¸°ë³¸ ì •ë³´

[ë¬¸ì„œì—ì„œ:](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview) Azure Blob storageëŠ” Microsoftì˜ **í´ë¼ìš°ë“œìš© ê°ì²´ ì €ì¥ ì†”ë£¨ì…˜**ì…ë‹ˆë‹¤. Blob storageëŠ” ëŒ€ëŸ‰ì˜ ë¹„êµ¬ì¡°í™” ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë° ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë¹„êµ¬ì¡°í™” ë°ì´í„°ëŠ” íŠ¹ì • ë°ì´í„° ëª¨ë¸ì´ë‚˜ ì •ì˜ì— ë”°ë¥´ì§€ ì•ŠëŠ” ë°ì´í„°ë¡œ, í…ìŠ¤íŠ¸ ë˜ëŠ” ì´ì§„ ë°ì´í„°ì™€ ê°™ì€ ë°ì´í„°ì…ë‹ˆë‹¤.

Blob storageëŠ” ì„¸ ê°€ì§€ ìœ í˜•ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤:

- **ìŠ¤í† ë¦¬ì§€ ê³„ì •** (ê³ ìœ í•œ ì´ë¦„)
- ìŠ¤í† ë¦¬ì§€ ê³„ì •ì˜ **ì»¨í…Œì´ë„ˆ** (í´ë”)
- ì»¨í…Œì´ë„ˆ ë‚´ì˜ **Blob**

<figure><img src="../../../.gitbook/assets/image (114).png" alt=""><figcaption></figcaption></figure>

### ë‹¤ì–‘í•œ ìœ í˜•ì˜ ì €ì¥ì†Œ

| **Blob storage**                 | <p><code>https://&#x3C;storage-account>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;container-name>?restype=container&#x26;comp=list</code></p> |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Azure Data Lake Storage Gen2** | `https://<storage-account>.dfs.core.windows.net`                                                                                                                                                 |
| **Azure Files**                  | `https://<storage-account>.file.core.windows.net`                                                                                                                                                |
| **Queue storage**                | `https://<storage-account>.queue.core.windows.net`                                                                                                                                               |
| **Table storage**                | `https://<storage-account>.table.core.windows.net`                                                                                                                                               |

### ì €ì¥ì†Œ ì•¡ì„¸ìŠ¤ <a href="#about-blob-storage" id="about-blob-storage"></a>

- **RBAC ì—­í• **ì„ í†µí•´ Azure AD ì£¼ì²´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **ì•¡ì„¸ìŠ¤ í‚¤**: ìŠ¤í† ë¦¬ì§€ ê³„ì •ì˜ ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ëŠ” **ìŠ¤í† ë¦¬ì§€ ê³„ì •ì— ëŒ€í•œ ì™„ì „í•œ ì•¡ì„¸ìŠ¤**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
- **ê³µìœ  ì•¡ì„¸ìŠ¤ ì„œëª…** (SAS): **ì‹œê°„ ì œí•œ** ë° íŠ¹ì • ê¶Œí•œì„ ì œê³µí•©ë‹ˆë‹¤.
- **ì•¡ì„¸ìŠ¤ í‚¤**ë¡œ SAS URLì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (íƒì§€í•˜ê¸° ë” ë³µì¡í•¨).
- SASëŠ” ì•¡ì„¸ìŠ¤ í‚¤ì—ì„œ ìƒì„±ë˜ë¯€ë¡œ ê°±ì‹ ë˜ë©´ SASê°€ ì‘ë™ì„ ì¤‘ì§€í•©ë‹ˆë‹¤.

### ê³µê°œ ë…¸ì¶œ

"Blob ê³µê°œ ì•¡ì„¸ìŠ¤ í—ˆìš©"ì´ **í™œì„±í™”**ë˜ì–´ ìˆìœ¼ë©´ (ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë¨), ë‹¤ìŒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤:

- **Blob ì½ê¸°ì— ëŒ€í•œ ê³µê°œ ì•¡ì„¸ìŠ¤** ë¶€ì—¬ (ì´ë¦„ì„ ì•Œì•„ì•¼ í•¨).
- ì»¨í…Œì´ë„ˆ Blobì„ **ëª©ë¡**í•˜ê³  **ì½ê¸°**.

### ì €ì¥ì†Œì— ì—°ê²°

ì°¾ì€ **ì €ì¥ì†Œ**ì— ì—°ê²°í•  ìˆ˜ ìˆë‹¤ë©´ [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) ë„êµ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## SAS URL

[ë¬¸ì„œì—ì„œ:](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview) ê³µìœ  ì•¡ì„¸ìŠ¤ ì„œëª…(SAS)ì€ ìŠ¤í† ë¦¬ì§€ ê³„ì •ì˜ ë¦¬ì†ŒìŠ¤ì— ì•ˆì „í•œ ìœ„ì„ ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. SASë¥¼ ì‚¬ìš©í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ê°€ ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ë°©ë²•ì„ ì„¸ë°€í•˜ê²Œ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:

- í´ë¼ì´ì–¸íŠ¸ê°€ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ë¦¬ì†ŒìŠ¤
- í•´ë‹¹ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ê¶Œí•œ
- SASì˜ ìœ íš¨ ê¸°ê°„

SAS URLì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: **`https://<container_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`**

ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) ë˜ëŠ” pythonì„ ì‚¬ìš©í•˜ì„¸ìš”:

{% code overflow="wrap" %}
```python
#pip3 install azure-storage-blob
from azure.storage.blob import BlobServiceClient

# List containers
conn_str="<SAS URL>"
svc = BlobServiceClient.from_connection_string(conn_str=conn_str)
for c in svc.list_containers():
print(c['name']

# List blobs inside conteiner
container = svc.get_container_client(container="<container_name>")
for b in container.list_blobs():
print(b['name']

# Download file
blob = svc.get_blob_client(container="<container_name>",blob="<blob_name>")
with open("download.out","wb") as f:
f.write(blob.download_blob().readall())
```
### ì‚¬ìš©ì ìœ„ì„ SAS <a href="#user-delegation-sas" id="user-delegation-sas"></a>

**ì»¨í…Œì´ë„ˆ, ë””ë ‰í† ë¦¬ ë˜ëŠ” ë¸”ë¡­ì— ëŒ€í•œ ê³µìœ  ì•¡ì„¸ìŠ¤ ì„œëª…(SAS) í† í°ì„ ì•ˆì „í•˜ê²Œ** ì‚¬ìš©í•˜ë ¤ë©´ Azure Active Directory (Azure AD) ìê²© ì¦ëª… ë˜ëŠ” ê³„ì • í‚¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì‚¬ìš©ì ìœ„ì„ SASë¥¼ ìƒì„±í•˜ë ¤ë©´ ë¨¼ì € **ì‚¬ìš©ì ìœ„ì„ í‚¤**ë¥¼ ìš”ì²­í•œ ë‹¤ìŒ í•´ë‹¹ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ SASì— ì„œëª…í•´ì•¼ í•©ë‹ˆë‹¤.

**Azure Blob Storage** ë° **Azure Data Lake Storage Gen2**ì—ì„œ **ì‚¬ìš©ì ìœ„ì„ ê³µìœ  ì•¡ì„¸ìŠ¤ ì„œëª…(SAS)**ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **ì €ì¥ëœ ì•¡ì„¸ìŠ¤ ì •ì±…**ì€ ì‚¬ìš©ì ìœ„ì„ SASì™€ í˜¸í™˜ë˜ì§€ ì•ŠìŒì„ ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

ì‚¬ìš©ì ìœ„ì„ SASëŠ” **ì €ì¥ì†Œ ê³„ì • í‚¤ ëŒ€ì‹  Azure AD ìê²© ì¦ëª…ìœ¼ë¡œ ë³´í˜¸**ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸/ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì €ì¥ì†Œ í‚¤ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ê²€ìƒ‰í•˜ì—¬ SASë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì„œë¹„ìŠ¤ SAS

ì„œë¹„ìŠ¤ SASëŠ” **ì €ì¥ì†Œ ê³„ì • í‚¤ë¡œ ë³´í˜¸**ë©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ SASëŠ” Azure Storage ì„œë¹„ìŠ¤ ì¤‘ í•˜ë‚˜ì¸ Blob storage, Queue storage, Table storage ë˜ëŠ” Azure Files ì¤‘ **í•˜ë‚˜ì— ëŒ€í•œ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ìœ„ì„**í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ ìˆ˜ì¤€ SASì˜ URIëŠ” SASê°€ ì•¡ì„¸ìŠ¤ë¥¼ ìœ„ì„í•  ë¦¬ì†ŒìŠ¤ì˜ URIë¡œ ì‹œì‘í•˜ì—¬ SAS í† í°ì´ ë’¤ë”°ë¦…ë‹ˆë‹¤.

**ì»¨í…Œì´ë„ˆ** ë˜ëŠ” **ë¸”ë¡­**ì— ëŒ€í•œ SASë¥¼ ì•ˆì „í•˜ê²Œ í•˜ë ¤ë©´ Azure Active Directory (Azure AD) ìê²© ì¦ëª…ì„ ì‚¬ìš©í•˜ì—¬ **ì‚¬ìš©ì ìœ„ì„ SAS**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

### ê³„ì • SAS

ê³„ì • SASëŠ” **ì €ì¥ì†Œ ê³„ì • í‚¤(2ê°œ ì¤‘ í•˜ë‚˜)**ë¡œ ë³´í˜¸ë©ë‹ˆë‹¤. ê³„ì • SASëŠ” í•˜ë‚˜ ì´ìƒì˜ ì €ì¥ì†Œ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ìœ„ì„í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ ë˜ëŠ” ì‚¬ìš©ì ìœ„ì„ SASë¥¼ í†µí•´ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  ì‘ì—…ì€ ê³„ì • SASë¥¼ í†µí•´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[ë¬¸ì„œì—ì„œ:](https://learn.microsoft.com/en-us/rest/api/storageservices/create-account-sas) ê³„ì • SASë¥¼ ìƒì„±í•¨ìœ¼ë¡œì¨ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* ì„œë¹„ìŠ¤ë³„ SASë¡œ í˜„ì¬ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” `Get/Set Service Properties` ë° `Get Service Stats`ì™€ ê°™ì€ ì„œë¹„ìŠ¤ ìˆ˜ì¤€ ì‘ì—…ì„ ìœ„ì„í•©ë‹ˆë‹¤.
* ê³„ì • SASë¥¼ ì‚¬ìš©í•˜ì—¬ ì €ì¥ì†Œ ê³„ì •ì˜ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ì— ë™ì‹œì— ì•¡ì„¸ìŠ¤ë¥¼ ìœ„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ê³„ì • SASë¥¼ ì‚¬ìš©í•˜ì—¬ Azure Blob Storage ë° Azure Filesì˜ ë¦¬ì†ŒìŠ¤ì— ì•¡ì„¸ìŠ¤ë¥¼ ìœ„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì»¨í…Œì´ë„ˆ, í, í…Œì´ë¸” ë° íŒŒì¼ ê³µìœ ì— ëŒ€í•œ ì“°ê¸° ë° ì‚­ì œ ì‘ì—…ì„ ìœ„ì„í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì‘ì—…ì€ ê°œì²´ë³„ SASë¡œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
* ìš”ì²­ì„ ìˆ˜ë½í•  IP ì£¼ì†Œ ë˜ëŠ” IP ì£¼ì†Œ ë²”ìœ„ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
* ìš”ì²­ì„ ìˆ˜ë½í•  HTTP í”„ë¡œí† ì½œì„ ì§€ì •í•©ë‹ˆë‹¤(HTTPS ë˜ëŠ” HTTP/HTTPS ì¤‘ í•˜ë‚˜).
```bash
# Get storage accounts
az storage account list #Get the account name from here

# Get keys to authenticate
az storage account keys list --account-name <name>

# Get shares
az storage share list --account-name <name> --account-key <key>

# Get dirs/files inside the share
az storage file list --account-name <name> --share-name <share-name> --account-key <key>
## If type is "dir", you can continue enumerationg files inside of it
az storage file list --account-name <name> --share-name <prev_dir/share-name> --account-key <key>

# Download a complete share (with directories and files inside of them)
az storage file download-batch -d . --source <share-name> --account-name <name> --account-key <key>
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
# Get storage accounts
Get-AzStorageAccount | fl
# Get rules to access the storage account
Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet
# Get IPs
(Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet).IPRules
# Get containers of a storage account
Get-AzStorageContainer -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context
# Get blobs inside container
Get-AzStorageBlob -Container epbackup-planetary -Context (Get-AzStorageAccount -name <name> -ResourceGroupName <name>).context
# Get a blob from a container
Get-AzStorageBlobContent -Container <NAME> -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context -Blob <blob_name> -Destination .\Desktop\filename.txt
```
{% endcode %}
{% endtab %}
{% endtabs %}

## ì°¸ê³  ìë£Œ

* [https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)
* [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œë¶€í„° ì˜ì›…ì´ ë  ë•Œê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ PDFë¡œ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì— ê°€ì…í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜** Twitterì—ì„œ **@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ PRì„ ì œì¶œí•˜ì—¬** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œë¡œ ì´ë™í•˜ì„¸ìš”.

</details>
