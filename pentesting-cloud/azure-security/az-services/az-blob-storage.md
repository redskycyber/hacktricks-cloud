# Az - Blob Depolama

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin**.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## Temel Bilgiler

[DokÃ¼mantasyondan:](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview) Azure Blob depolama, Microsoft'un bulut iÃ§in nesne **depolama Ã§Ã¶zÃ¼mÃ¼dÃ¼r**. Blob depolama, yapÄ±landÄ±rÄ±lmÄ±ÅŸ bir veri modeline veya tanÄ±mÄ±na uymayan metin veya ikili veri gibi belirli bir veri modeline uymayan bÃ¼yÃ¼k miktarda yapÄ±landÄ±rÄ±lmamÄ±ÅŸ veri depolamak iÃ§in optimize edilmiÅŸtir.

Blob depolama Ã¼Ã§ tÃ¼r kaynak sunar:

* **Depolama hesabÄ±** (benzersiz ad)
* Depolama hesabÄ±ndaki bir **konteyner** (klasÃ¶r)
* Bir konteynerdeki bir **blob**

<figure><img src="../../../.gitbook/assets/image (6) (2).png" alt=""><figcaption></figcaption></figure>

### FarklÄ± depolama tÃ¼rleri

| **Blob depolama**                 | <p><code>https://&#x3C;storage-account>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;container-name>?restype=container&#x26;comp=list</code></p> |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Azure Data Lake Storage Gen2** | `https://<storage-account>.dfs.core.windows.net`                                                                                                                                                 |
| **Azure Files**                  | `https://<storage-account>.file.core.windows.net`                                                                                                                                                |
| **Queue storage**                | `https://<storage-account>.queue.core.windows.net`                                                                                                                                               |
| **Table storage**                | `https://<storage-account>.table.core.windows.net`                                                                                                                                               |

### Depolamaya EriÅŸim <a href="#about-blob-storage" id="about-blob-storage"></a>

* Azure AD prensipleri aracÄ±lÄ±ÄŸÄ±yla **RBAC rolleri** kullanÄ±n.
* **EriÅŸim AnahtarlarÄ±**: Depolama hesabÄ±nÄ±n eriÅŸim anahtarlarÄ±nÄ± kullanÄ±n. Bu, depolama hesabÄ±na **tam eriÅŸim saÄŸlar**.
* **PaylaÅŸÄ±lan EriÅŸim Ä°mzasÄ±** (SAS): **Zaman** **sÄ±nÄ±rlÄ±** ve belirli izinlere sahip.
* Bir **eriÅŸim anahtarÄ±** ile SAS URL'si oluÅŸturabilirsiniz (tespit etmesi daha karmaÅŸÄ±ktÄ±r).
* SAS, eriÅŸim anahtarÄ±ndan oluÅŸturulduÄŸu iÃ§in yenilendiÄŸinde SAS Ã§alÄ±ÅŸmayÄ± durdurur.

### Kamuya AÃ§Ä±klÄ±k

"EriÅŸime Ä°zin Ver Blob halka aÃ§Ä±k eriÅŸime izin verildiÄŸinde" (varsayÄ±lan olarak devre dÄ±ÅŸÄ±), aÅŸaÄŸÄ±dakiler mÃ¼mkÃ¼ndÃ¼r:

* **BloblarÄ± okumak iÃ§in halka aÃ§Ä±k eriÅŸim** saÄŸlayÄ±n (isimlerini bilmelisiniz).
* Konteyner bloblarÄ±nÄ± **listele** ve **okuyun**.

### Depolamaya BaÄŸlanma

Herhangi bir **depolama** bulursanÄ±z, bunu yapmak iÃ§in [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) aracÄ±nÄ± kullanabilirsiniz.

## SAS URL'leri

[DokÃ¼mantasyondan:](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview) PaylaÅŸÄ±lan eriÅŸim imzasÄ± (SAS), depolama hesabÄ±nÄ±zdaki kaynaklara gÃ¼venli yetkilendirilmiÅŸ eriÅŸim saÄŸlar. Bir SAS ile istemcinin verilerinize nasÄ±l eriÅŸebileceÄŸi konusunda ayrÄ±ntÄ±lÄ± kontrol sahibi olursunuz. Ã–rneÄŸin:

* Ä°stemcinin eriÅŸebileceÄŸi kaynaklar.
* Bu kaynaklara sahip olduklarÄ± izinler.
* SAS'nin geÃ§erli olduÄŸu sÃ¼re.

Bir SAS URL'si ÅŸuna benzer: **`https://<container_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`**

Verilere eriÅŸmek iÃ§in [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) veya python kullanÄ±n:

{% code overflow="wrap" %}
```python
#pip3 install azure-storage-blob
from azure.storage.blob import BlobServiceClient

# List containers
conn_str="<SAS URL>"
svc = BlobServiceClient.from_connection_string(conn_str=conn_str)
for c in svc.list_containers():
print(c['name']

# List blobs inside conteiner
container = svc.get_container_client(container="<container_name>")
for b in container.list_blobs():
print(b['name']

# Download file
blob = svc.get_blob_client(container="<container_name>",blob="<blob_name>")
with open("download.out","wb") as f:
f.write(blob.download_blob().readall())
```
{% endcode %}

### KullanÄ±cÄ± vekilliÄŸi SAS <a href="#user-delegation-sas" id="user-delegation-sas"></a>

Bir **paylaÅŸÄ±lan eriÅŸim imzasÄ± (SAS)** belirli bir Azure Active Directory (Azure AD) **kimlik bilgisi veya bir hesap anahtarÄ±** kullanarak bir konteyner, dizin veya blob'a eriÅŸim iÃ§in gÃ¼venli bir SAS belirteci oluÅŸturabilirsiniz. Bir kullanÄ±cÄ± vekilliÄŸi SAS oluÅŸturmak iÃ§in Ã¶nce bir **kullanÄ±cÄ± vekilliÄŸi anahtarÄ±** talep etmeniz gerekmektedir ve ardÄ±ndan bu anahtarÄ± SAS'Ä± imzalamak iÃ§in kullanÄ±rsÄ±nÄ±z.

Azure Blob Storage ve Azure Data Lake Storage Gen2'de **KullanÄ±cÄ± VekilliÄŸi PaylaÅŸÄ±lan EriÅŸim Ä°mzasÄ± (SAS)** desteklenmektedir. Ancak, **Saklanan EriÅŸim Ä°lkesi** bir KullanÄ±cÄ± VekilliÄŸi SAS ile uyumlu deÄŸildir.

KullanÄ±cÄ± vekilliÄŸi SAS'Ä±, **saklama hesabÄ± anahtarlarÄ± yerine Azure AD kimlik bilgileri ile gÃ¼vence altÄ±na alÄ±nÄ±r**. Bu, istemcilerin/uygulamalarÄ±n SAS oluÅŸturmak iÃ§in saklama anahtarlarÄ±nÄ± depolamasÄ±nÄ±/almasÄ±nÄ± engeller.

### Hizmet SAS

Bir hizmet SAS'Ä±, **saklama hesabÄ± anahtarÄ±** ile gÃ¼vence altÄ±na alÄ±nÄ±r. Bir hizmet SAS'Ä±, yalnÄ±zca bir Azure Depolama hizmetindeki bir kaynaÄŸa eriÅŸimi devreder: Blob depolama, Kuyruk depolama, Tablo depolama veya Azure DosyalarÄ±. Hizmet dÃ¼zeyinde bir SAS iÃ§in URI, SAS'Ä±n eriÅŸimi devredeceÄŸi kaynaÄŸÄ±n URI'si ile baÅŸlar ve ardÄ±ndan SAS belirteci gelir.

Bir **konteyner** veya **blob** iÃ§in SAS'Ä± gÃ¼vence altÄ±na almak iÃ§in Azure Active Directory (Azure AD) kimlik bilgilerini kullanÄ±n.

### Hesap SAS

Bir hesap SAS'Ä±, **saklama hesabÄ± anahtarlarÄ±ndan biriyle** gÃ¼vence altÄ±na alÄ±nÄ±r (2 adet vardÄ±r). Bir hesap SAS'Ä±, bir veya daha fazla depolama hizmetindeki kaynaklara eriÅŸimi devreder. Bir hizmet veya kullanÄ±cÄ± vekilliÄŸi SAS ile kullanÄ±labilen tÃ¼m iÅŸlemler, bir hesap SAS ile de kullanÄ±labilir.

[dokÃ¼mantasyondan:](https://learn.microsoft.com/en-us/rest/api/storageservices/create-account-sas) Bir hesap SAS oluÅŸturarak ÅŸunlarÄ± yapabilirsiniz:

* Åu anda hizmete Ã¶zgÃ¼ bir SAS ile kullanÄ±lamayan hizmet dÃ¼zeyi iÅŸlemlerini (Ã¶rneÄŸin, `Get/Set Service Properties` ve `Get Service Stats` iÅŸlemleri) devredebilirsiniz.
* Bir depolama hesabÄ±ndaki birden fazla hizmete aynÄ± anda eriÅŸimi devredebilirsiniz. Ã–rneÄŸin, bir hesap SAS kullanarak hem Azure Blob Storage hem de Azure DosyalarÄ±'ndaki kaynaklara eriÅŸimi devredebilirsiniz.
* Nesne Ã¶zgÃ¼ bir SAS ile kullanÄ±lamayan konteyner, kuyruk, tablo ve dosya paylaÅŸÄ±mlarÄ± iÃ§in yazma ve silme iÅŸlemlerini devredebilirsiniz.
* Ä°stekleri kabul etmek iÃ§in bir IP adresi veya IP adresi aralÄ±ÄŸÄ± belirtebilirsiniz.
* Ä°stekleri kabul etmek iÃ§in HTTP protokolÃ¼nÃ¼ belirtebilirsiniz (HTTPS veya HTTP/HTTPS).

## NumaralandÄ±rma

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# Get storage accounts
az storage account list #Get the account name from here

# Get keys to authenticate
az storage account keys list --account-name <name>

# Get shares
az storage share list --account-name <name> --account-key <key>

# Get dirs/files inside the share
az storage file list --account-name <name> --share-name <share-name> --account-key <key>
## If type is "dir", you can continue enumerationg files inside of it
az storage file list --account-name <name> --share-name <prev_dir/share-name> --account-key <key>

# Download a complete share (with directories and files inside of them)
az storage file download-batch -d . --source <share-name> --account-name <name> --account-key <key>
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
# Get storage accounts
Get-AzStorageAccount | fl
# Get rules to access the storage account
Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet
# Get IPs
(Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet).IPRules
# Get containers of a storage account
Get-AzStorageContainer -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context
# Get blobs inside container
Get-AzStorageBlob -Container epbackup-planetary -Context (Get-AzStorageAccount -name <name> -ResourceGroupName <name>).context
# Get a blob from a container
Get-AzStorageBlobContent -Container <NAME> -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context -Blob <blob_name> -Destination .\Desktop\filename.txt
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Referanslar

* [https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)
* [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶ndererek paylaÅŸÄ±n.**

</details>
