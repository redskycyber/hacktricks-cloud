# Az - Skladi코tenje Blobova

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodi캜nu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne Informacije

[Od dokumenata:](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview) Azure Blob skladi코tenje je Microsoftovo re코enje za **skladi코tenje objekata u oblaku**. Blob skladi코tenje je optimizovano za skladi코tenje ogromnih koli캜ina nestrukturiranih podataka. Nestrukturirani podaci su podaci koji se ne pridr쬬vaju odre캠enog modela ili definicije, kao 코to su tekstualni ili binarni podaci.

Blob skladi코tenje nudi tri vrste resursa:

* **Skladi코ni nalog** (jedinstveno ime)
* **Kontejner** u skladi코tnom nalogu (folder)
* **Blob** u kontejneru

<figure><img src="../../../.gitbook/assets/image (114).png" alt=""><figcaption></figcaption></figure>

### Razli캜ite vrste skladi코tenja

| **Blob skladi코tenje**            | <p><code>https://&#x3C;skladi코tni-nalog>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;ime-kontejnera>?restype=container&#x26;comp=list</code></p> |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Azure Data Lake Storage Gen2** | `https://<skladi코tni-nalog>.dfs.core.windows.net`                                                                                                                                                 |
| **Azure Files**                  | `https://<skladi코tni-nalog>.file.core.windows.net`                                                                                                                                                |
| **Skladi코tenje redova**          | `https://<skladi코tni-nalog>.queue.core.windows.net`                                                                                                                                               |
| **Skladi코tenje tabela**          | `https://<skladi코tni-nalog>.table.core.windows.net`                                                                                                                                               |

### Pristup Skladi코tu <a href="#about-blob-storage" id="about-blob-storage"></a>

* Koristite Azure AD principe putem **RBAC uloga** koje su podr쬬ne.
* **Pristupni klju캜evi**: Koristite pristupne klju캜eve skladi코tnog naloga. Ovo omogu캖ava **puni pristup skladi코tu**.
* **Deljeni pristupni potpis** (SAS): **Vremenski ograni캜en** i specifi캜ne dozvole.
* Mo쬰te generisati SAS URL sa **pristupnim klju캜em** (te쬰 otkriti).
* Po코to je SAS generisan iz pristupnog klju캜a, ako se obnovi, SAS prestaje da radi.

### Javna Izlo쬰nost

Ako je "Dozvoli javni pristup blobovima" **omogu캖eno** (podrazumevano onemogu캖eno), mogu캖e je:

* Dati **javni pristup za 캜itanje blobova** (morate znati ime).
* **Izlistati blobove kontejnera** i **캜itati** ih.

### Povezivanje sa Skladi코tem

Ako prona캠ete bilo koje **skladi코te** sa kojim mo쬰te da se pove쬰te, mo쬰te koristiti alatku [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) za to.

## SAS URL-ovi

[Od dokumenata:](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview) Deljeni pristupni potpis (SAS) pru쬬 siguran delegirani pristup resursima u va코em skladi코tnom nalogu. Sa SAS-om, imate granularnu kontrolu nad tim kako klijent mo쬰 pristupiti va코im podacima. Na primer:

* Koje resurse klijent mo쬰 pristupiti.
* Koje dozvole imaju za te resurse.
* Koliko dugo je SAS validan.

SAS URL izgleda ovako: **`https://<ime_kontejnera>.blob.core.windows.net/novi_kontejner?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`**

Koristite [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) za pristup podacima ili python:

{% code overflow="wrap" %}
```python
#pip3 install azure-storage-blob
from azure.storage.blob import BlobServiceClient

# List containers
conn_str="<SAS URL>"
svc = BlobServiceClient.from_connection_string(conn_str=conn_str)
for c in svc.list_containers():
print(c['name']

# List blobs inside conteiner
container = svc.get_container_client(container="<container_name>")
for b in container.list_blobs():
print(b['name']

# Download file
blob = svc.get_blob_client(container="<container_name>",blob="<blob_name>")
with open("download.out","wb") as f:
f.write(blob.download_blob().readall())
```
### Delegacija korisni캜kog SAS <a href="#user-delegation-sas" id="user-delegation-sas"></a>

**Mo쬰te osigurati zajedni캜ki pristupni potpis (SAS)** token za pristup kontejneru, direktorijumu ili bloku koriste캖i ili Azure Active Directory (Azure AD) **kredencijale ili klju캜 naloga**. Da biste kreirali korisni캜ki SAS delegacije, prvo morate zatra쬴ti **klju캜 delegacije korisnika**, koji zatim koristite za potpisivanje SAS-a.

Podr코ka je obezbe캠ena za **Korisni캜ki delegirani potpis zajedni캜kog pristupa (SAS)** kako u **Azure Blob Storage-u** tako i u **Azure Data Lake Storage Gen2**. Me캠utim, va쬹o je napomenuti da **Uskladi코teni pristupni propisi** nisu kompatibilni sa Korisni캜kim delegiranim SAS-om.

Imajte na umu da je korisni캜ki SAS delegacije **osiguran Azure AD kredencijalima umesto klju캜eva naloga za skladi코tenje**. Ovo spre캜ava klijente/aplikacije da skladi코te/dobavljaju klju캜eve skladi코tenja radi kreiranja SAS-a.

### SAS servisa

SAS servisa je osiguran sa **klju캜em naloga za skladi코tenje**. SAS servisa **delegira pristup resursu samo jednoj** od Azure Storage servisa: Blob storage, Queue storage, Table storage ili Azure Files. URI za SAS na nivou servisa sastoji se od URI-ja resursa za koji 캖e SAS delegirati pristup, pra캖enog SAS tokenom.

Da biste koristili Azure Active Directory (Azure AD) kredencijale za osiguravanje SAS-a za **kontejner** ili **blok**, koristite **korisni캜ki SAS delegacije**.

### SAS naloga

SAS naloga je osiguran sa jednim od **klju캜eva naloga za skladi코tenje** (njih ima 2). SAS naloga delegira pristup resursima u jednom ili vi코e skladi코nih servisa. Sve operacije dostupne putem SAS-a na nivou servisa ili korisni캜kog SAS-a tako캠e su dostupne putem SAS-a naloga.

[iz dokumentacije:](https://learn.microsoft.com/en-us/rest/api/storageservices/create-account-sas) Kreiranjem SAS naloga mo쬰te:

* Delegirati pristup operacijama na nivou servisa koje trenutno nisu dostupne sa SAS-om specifi캜nim za servis, kao 코to su operacije `Get/Set Service Properties` i `Get Service Stats`.
* Delegirati pristup vi코e od jednog servisa u skladi코nom nalogu istovremeno. Na primer, mo쬰te delegirati pristup resursima kako u Azure Blob Storage-u tako i u Azure Files koriste캖i SAS naloga.
* Delegirati pristup operacijama pisanja i brisanja za kontejnere, redove, tabele i deljene datoteke, koje nisu dostupne sa SAS-om specifi캜nim za objekat.
* Navesti IP adresu ili opseg IP adresa iz kojih 캖e se prihvatati zahtevi.
* Navesti HTTP protokol iz kojeg 캖e se prihvatati zahtevi (ili HTTPS ili HTTP/HTTPS).

## Enumeracija

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# Get storage accounts
az storage account list #Get the account name from here

# Get keys to authenticate
az storage account keys list --account-name <name>

# Get shares
az storage share list --account-name <name> --account-key <key>

# Get dirs/files inside the share
az storage file list --account-name <name> --share-name <share-name> --account-key <key>
## If type is "dir", you can continue enumerationg files inside of it
az storage file list --account-name <name> --share-name <prev_dir/share-name> --account-key <key>

# Download a complete share (with directories and files inside of them)
az storage file download-batch -d . --source <share-name> --account-name <name> --account-key <key>
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
# Get storage accounts
Get-AzStorageAccount | fl
# Get rules to access the storage account
Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet
# Get IPs
(Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet).IPRules
# Get containers of a storage account
Get-AzStorageContainer -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context
# Get blobs inside container
Get-AzStorageBlob -Container epbackup-planetary -Context (Get-AzStorageAccount -name <name> -ResourceGroupName <name>).context
# Get a blob from a container
Get-AzStorageBlobContent -Container <NAME> -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context -Blob <blob_name> -Destination .\Desktop\filename.txt
```
## Reference

* [https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)
* [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
