# Az - Azure MreÅ¾a

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

MreÅ¾e unutar Azure-a funkcioniÅ¡u kao integralni deo njegove cloud computing platforme, omoguÄ‡avajuÄ‡i **povezivanje i komunikaciju izmeÄ‘u razliÄitih Azure servisa i resursa**. MreÅ¾na arhitektura u Azure-u je dizajnirana da bude visoko skalabilna, sigurna i prilagodljiva.

U osnovi, Azure pruÅ¾a **virtuelnu mreÅ¾u (VNet)** koja korisnicima omoguÄ‡ava kreiranje **izolovanih mreÅ¾a** unutar Azure cloud-a. Unutar ovih VNets-a, resursi poput virtuelnih maÅ¡ina, aplikacija i baza podataka mogu biti sigurno smeÅ¡teni i upravljani. MreÅ¾no povezivanje u Azure-u podrÅ¾ava kako komunikaciju unutar cloud-a (izmeÄ‘u Azure servisa), tako i povezivanje sa spoljnim mreÅ¾ama i internetom.

**Bezbednost** je kljuÄni aspekt Azure mreÅ¾nog povezivanja, sa raznim alatima i servisima dostupnim za zaÅ¡titu podataka, upravljanje pristupom i obezbeÄ‘ivanje usaglaÅ¡enosti. Ove bezbednosne mere ukljuÄuju **firewall-e**, **grupe za mreÅ¾nu bezbednost** i moguÄ‡nosti **enkripcije**, omoguÄ‡avajuÄ‡i visok nivo kontrole nad saobraÄ‡ajem i pristupom.

Ukupno, Azure-ove moguÄ‡nosti mreÅ¾nog povezivanja su dizajnirane da pruÅ¾e fleksibilnost, omoguÄ‡avajuÄ‡i korisnicima da kreiraju mreÅ¾no okruÅ¾enje koje odgovara njihovim specifiÄnim potrebama aplikacija i radnih optereÄ‡enja, uz istovremeno snaÅ¾an naglasak na sigurnost i pouzdanost.

## Virtuelna mreÅ¾a (VNET) i podmreÅ¾e

VNet u Azure-u je suÅ¡tinski predstavljanje vaÅ¡e sopstvene mreÅ¾e u oblaku. To je **logiÄka izolacija Azure cloud-a posveÄ‡ena vaÅ¡oj pretplati**. VNet vam omoguÄ‡ava da obezbedite i upravljate virtuelnim privatnim mreÅ¾ama (VPN-ovima) u Azure-u i moÅ¾e se koristiti za smeÅ¡tanje i **upravljanje razliÄitim vrstama Azure resursa**, kao Å¡to su virtuelne maÅ¡ine (VM-ovi), baze podataka i aplikativne usluge.

VNets vam pruÅ¾aju **potpunu kontrolu nad postavkama vaÅ¡e mreÅ¾e**, ukljuÄujuÄ‡i **opsege IP adresa**, kreiranje podmreÅ¾a, tabele ruta i mreÅ¾ne gateway-e.

**PodmreÅ¾a** je **opseg IP adresa u vaÅ¡em VNet-u**. MoÅ¾ete podeliti VNet u viÅ¡e podmreÅ¾a radi organizacije i bezbednosti. Svaka podmreÅ¾a u VNet-u moÅ¾e se koristiti za izolaciju i grupisanje resursa prema vaÅ¡oj mreÅ¾noj i aplikativnoj arhitekturi.

Osim toga, podmreÅ¾e vam omoguÄ‡avaju da **segmentirate svoj VNet u jednu ili viÅ¡e pod-mreÅ¾a**, pruÅ¾ajuÄ‡i opseg IP adresa koje resursi mogu koristiti.

### **Primer**

* Pretpostavimo da imate VNet nazvan `MyVNet` sa opsegom IP adresa `10.0.0.0/16`. MoÅ¾ete kreirati podmreÅ¾u unutar ovog VNet-a, recimo `Subnet-1`, sa opsegom IP adresa `10.0.0.0/24` za smeÅ¡tanje vaÅ¡ih web servera. Druga podmreÅ¾a, `Subnet-2` sa opsegom `10.0.1.0/24`, moÅ¾e se koristiti za vaÅ¡e baze podataka. Ova segmentacija omoguÄ‡ava efikasno upravljanje i kontrolu bezbednosti unutar mreÅ¾e.

### Enumeracija

Da biste izlistali sve VNets i podmreÅ¾e u Azure nalogu, moÅ¾ete koristiti Azure Command-Line Interface (CLI). Evo koraka:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Grupa za bezbednost mreÅ¾e (NSG)

U Azure-u, **Grupa za bezbednost mreÅ¾e (NSG)** ima osnovnu funkciju filtriranja mreÅ¾nog saobraÄ‡aja kako prema Azure resursima unutar Azure virtuelne mreÅ¾e (VNet), tako i od njih. Ona sadrÅ¾i skup **pravila za bezbednost** koja detaljno odreÄ‘uju tok mreÅ¾nog saobraÄ‡aja.

KljuÄni aspekti NSG-a ukljuÄuju:

- **Kontrola saobraÄ‡aja**: Svaka NSG sadrÅ¾i pravila koja su od vitalnog znaÄaja za dozvoljavanje ili blokiranje dolaznog i odlaznog mreÅ¾nog saobraÄ‡aja povezanog sa razliÄitim Azure resursima.
- **Komponente pravila**: Pravila unutar NSG-a su veoma specifiÄna i filtriraju saobraÄ‡aj na osnovu kriterijuma kao Å¡to su izvorna/odrediÅ¡na IP adresa, port i protokol. Ova specifiÄnost omoguÄ‡ava detaljno upravljanje mreÅ¾nim saobraÄ‡ajem.
- **PoboljÅ¡anje bezbednosti**: OsiguravajuÄ‡i da samo ovlaÅ¡Ä‡eni saobraÄ‡aj moÅ¾e da ulazi ili izlazi iz vaÅ¡ih Azure resursa, NSG-ovi igraju kljuÄnu ulogu u jaÄanju bezbednosti vaÅ¡e mreÅ¾ne infrastrukture.


### **Primer**

* Zamislite da imate NSG nazvan `MyNSG` primenjen na podmreÅ¾u ili odreÄ‘enu virtuelnu maÅ¡inu unutar vaÅ¡e VNet. MoÅ¾ete kreirati pravila kao Å¡to su:
* Dolazno pravilo koje dozvoljava HTTP saobraÄ‡aj (port 80) sa bilo koje izvorne adrese ka vaÅ¡im veb serverima.
* Odlazno pravilo koje dozvoljava samo SQL saobraÄ‡aj (port 1433) ka odreÄ‘enom opsegu odrediÅ¡nih IP adresa.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall je upravljana, cloud-based **usluga za mreÅ¾nu sigurnost koja Å¡titi vaÅ¡e Azure Virtual Network resurse**. To je potpuno stanje firewall kao usluga sa ugraÄ‘enim moguÄ‡nostima visoke dostupnosti i skalabilnosti.

Azure Firewall pruÅ¾a **naprednije** moguÄ‡nosti od **NSG-ova**, ukljuÄujuÄ‡i filtriranje na nivou aplikacije, filtriranje na nivou mreÅ¾e, filtriranje na osnovu obaveÅ¡tajnih podataka o pretnjama i integraciju sa Azure Monitorom za beleÅ¾enje i analitiku.\
MoÅ¾e filtrirati odlazni, dolazni, saobraÄ‡aj izmeÄ‘u mreÅ¾a, VPN i ExpressRoute saobraÄ‡aj. **Pravila firewalla mogu se kreirati na osnovu FQDN (Fully Qualified Domain Name), IP adresa i portova**.

### Razlike izmeÄ‘u Azure Firewalla i NSG-ova&#x20;

1. **Opseg:**
* **NSG:** Radi na nivou podmreÅ¾e ili mreÅ¾nog interfejsa. Namijenjen je pruÅ¾anju osnovnog filtriranja dolaznog i odlaznog saobraÄ‡aja sa mreÅ¾nih interfejsa (NIC), virtuelnih maÅ¡ina (VM) ili podmreÅ¾a.
* **Azure Firewall:** Deluje na nivou VNet-a, pruÅ¾ajuÄ‡i Å¡iri opseg zaÅ¡tite. Dizajniran je za obezbeÄ‘ivanje vaÅ¡ih virtualnih mreÅ¾nih resursa i upravljanje saobraÄ‡ajem koji ulazi i izlazi iz VNet-a.
2. **MoguÄ‡nosti:**
* **NSG:** PruÅ¾a osnovne moguÄ‡nosti filtriranja na osnovu IP adrese, porta i protokola. Ne podrÅ¾ava napredne funkcionalnosti poput inspekcije na nivou aplikacije ili obaveÅ¡tajnih podataka o pretnjama.
* **Azure Firewall:** Nudi napredne funkcionalnosti poput filtriranja saobraÄ‡aja na nivou aplikacije (Layer 7), filtriranja na osnovu obaveÅ¡tajnih podataka o pretnjama, filtriranja mreÅ¾nog saobraÄ‡aja i joÅ¡ mnogo toga. TakoÄ‘e podrÅ¾ava viÅ¡e javnih IP adresa.
3. **Upotreba:**
* **NSG:** Idealno za osnovno filtriranje saobraÄ‡aja na nivou mreÅ¾e.
* **Azure Firewall:** Pogodan za sloÅ¾enije scenarije filtriranja gde je potrebna kontrola na nivou aplikacije, beleÅ¾enje i obaveÅ¡tajni podaci o pretnjama.
4. **Upravljanje i praÄ‡enje:**
* **NSG:** Nudi osnovno beleÅ¾enje i integraciju sa Azure Monitorom.
* **Azure Firewall:** PruÅ¾a napredne moguÄ‡nosti beleÅ¾enja i analitike putem Azure Monitora, Å¡to je kljuÄno za razumevanje prirode i obrasca saobraÄ‡aja.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## MreÅ¾ni virtuelni ureÄ‘aj (NVA)

MreÅ¾ni virtuelni ureÄ‘aj (**NVA**) u Azure-u je virtuelni ureÄ‘aj koji **obavlja mreÅ¾ne funkcije unutar virtuelne mreÅ¾e**. NVA se obiÄno koristi za mreÅ¾ne funkcije koje **nisu dostupne nativno** u Azure-u ili kada je potrebna veÄ‡a prilagodljivost. Oni su suÅ¡tinski **VM-ovi koji pokreÄ‡u mreÅ¾ne aplikacije ili usluge**, kao Å¡to su firewall-i, WAN optimizatori ili load balancer-i.

NVA se koriste za kompleksno rutiranje, **bezbednost** i **upravljanje mreÅ¾nim saobraÄ‡ajem**. Mogu se implementirati sa Azure **Marketplace-a**, gde mnogi treÄ‡epartijski dobavljaÄi nude svoje ureÄ‘aje spremne za integraciju u Azure okruÅ¾enja.

### **Primer**

* Organizacija moÅ¾e implementirati NVA u Azure-u kako bi kreirala **prilagoÄ‘eno reÅ¡enje za firewall**. Ovaj NVA moÅ¾e pokretati **firewall softver treÄ‡e strane**, pruÅ¾ajuÄ‡i napredne funkcije poput detekcije upada, inspekcije paketa ili VPN konektivnosti. NVA se moÅ¾e konfigurisati da inspektuje i filtrira saobraÄ‡aj koji prolazi kroz njega, obezbeÄ‘ujuÄ‡i unapreÄ‘ene bezbednosne mere u skladu sa politikama organizacije.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Tabele ruta i korisniÄki definisane rute (UDR)

**Azure Tabele ruta** su funkcionalnost unutar Microsoft Azure-a koja omoguÄ‡ava **kontrolu rutiranja mreÅ¾nog saobraÄ‡aja unutar Azure virtuelnih mreÅ¾a (VNets)**. U osnovi, one definiÅ¡u kako se **paketi** prosleÄ‘uju izmeÄ‘u podmreÅ¾a unutar VNets-a, izmeÄ‘u VNets-a ili ka spoljnim mreÅ¾ama. Svaka tabela ruta sadrÅ¾i skup pravila, poznatih kao rute, koje odreÄ‘uju kako Ä‡e se paketi rutirati na osnovu njihovih odrediÅ¡nih IP adresa.

**KorisniÄki definisane rute (UDR)** u Azure-u su **prilagoÄ‘ene rute koje kreirate unutar Azure Tabela ruta** kako biste kontrolisali **tok mreÅ¾nog saobraÄ‡aja** unutar i izmeÄ‘u Azure virtuelnih mreÅ¾a (VNets), kao i ka spoljnim konekcijama. UDR-ovi vam omoguÄ‡avaju fleksibilnost da usmeravate mreÅ¾ni saobraÄ‡aj prema vaÅ¡im specifiÄnim zahtevima, prelazeÄ‡i preko Azure-ovih podrazumevanih rutirajuÄ‡ih odluka.

Ove rute su posebno korisne u scenarijima gde je potrebno **usmeravanje saobraÄ‡aja preko virtuelnog ureÄ‘aja**, sprovoÄ‘enje odreÄ‘ene putanje u svrhu bezbednosti ili usaglaÅ¡enosti sa politikama, ili integracija sa lokalnim mreÅ¾ama.

### **Primer**

* Pretpostavimo da ste implementirali virtuelni ureÄ‘aj za mreÅ¾u (NVA) radi inspekcije saobraÄ‡aja izmeÄ‘u podmreÅ¾a unutar jednog VNet-a. MoÅ¾ete kreirati UDR koji usmerava sav saobraÄ‡aj iz jedne podmreÅ¾e ka drugoj podmreÅ¾i preko NVA. Ovaj UDR obezbeÄ‘uje da NVA inspekcioniÅ¡e saobraÄ‡aj u svrhu bezbednosti pre nego Å¡to stigne do svog odrediÅ¡ta.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure privatna veza

Azure privatna veza je usluga u Azure-u koja omoguÄ‡ava **privatan pristup Azure uslugama** tako Å¡to se **saobraÄ‡aj izmeÄ‘u vaÅ¡e Azure virtuelne mreÅ¾e (VNet) i usluge odvija iskljuÄivo unutar Microsoft-ove Azure mreÅ¾e**. Efektivno dovodi uslugu u vaÅ¡u VNet. Ova postavka poboljÅ¡ava bezbednost tako Å¡to ne izlaÅ¾e podatke javnom internetu.

Privatna veza se moÅ¾e koristiti sa raznim Azure uslugama, kao Å¡to su Azure Storage, Azure SQL baza podataka i prilagoÄ‘ene usluge deljene putem privatne veze. PruÅ¾a siguran naÄin za koriÅ¡Ä‡enje usluga iz vaÅ¡e sopstvene VNet ili Äak iz razliÄitih Azure pretplata.

{% hint style="danger" %}
NSG-ovi se ne primenjuju na privatne krajnje taÄke, Å¡to jasno znaÄi da povezivanje NSG-a sa podmreÅ¾om koja sadrÅ¾i privatnu vezu neÄ‡e imati nikakav efekat.
{% endhint %}

### **Primer**

* Zamislite scenario u kojem imate **Azure SQL bazu podataka koju Å¾elite bezbedno pristupiti iz vaÅ¡e VNet**. ObiÄno bi to podrazumevalo prolazak kroz javni internet. Sa privatnom vezom, moÅ¾ete kreirati **privatnu krajnju taÄku u vaÅ¡oj VNet** koja se direktno povezuje sa Azure SQL bazom podataka uslugom. Ova krajnja taÄka Äini da baza podataka izgleda kao da je deo vaÅ¡e sopstvene VNet, dostupna putem privatne IP adrese, Äime se obezbeÄ‘uje siguran i privatni pristup.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure servisne taÄke

Azure servisne taÄke proÅ¡iruju privatni adresni prostor vaÅ¡e virtuelne mreÅ¾e i identitet vaÅ¡e virtuelne mreÅ¾e na Azure servise preko direktnog povezivanja. OmoguÄ‡avanjem servisnih taÄaka, **resursi u vaÅ¡oj virtuelnoj mreÅ¾i mogu sigurno da se poveÅ¾u sa Azure servisima**, kao Å¡to su Azure Storage i Azure SQL baza podataka, koristeÄ‡i Azure-ovu mreÅ¾u. Ovo osigurava da **saobraÄ‡aj izmeÄ‘u virtuelne mreÅ¾e i Azure servisa ostaje unutar Azure mreÅ¾e**, pruÅ¾ajuÄ‡i sigurniju i pouzdaniju putanju.

### **Primer**

* Na primer, **Azure Storage** nalog je podrazumevano dostupan preko javnog interneta. OmoguÄ‡avanjem **servisne taÄke za Azure Storage unutar vaÅ¡e virtuelne mreÅ¾e**, moÅ¾ete osigurati da samo saobraÄ‡aj iz vaÅ¡e virtuelne mreÅ¾e moÅ¾e pristupiti nalogu za skladiÅ¡tenje. Firewall naloga za skladiÅ¡tenje se moÅ¾e konfigurisati da prihvata saobraÄ‡aj samo iz vaÅ¡e virtuelne mreÅ¾e.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Razlike izmeÄ‘u usluga krajnjih taÄaka i privatnih veza

Microsoft preporuÄuje koriÅ¡Ä‡enje privatnih veza u [**dokumentaciji**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\


<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Usluge krajnjih taÄaka:**

* SaobraÄ‡aj iz vaÅ¡e virtuelne mreÅ¾e ka Azure usluzi putuje preko Microsoft Azure mreÅ¾e, zaobilazeÄ‡i javni internet.
* Krajnja taÄka je direktna veza sa Azure uslugom i ne pruÅ¾a privatnu IP adresu za uslugu unutar virtuelne mreÅ¾e.
* Usluga je i dalje dostupna putem javne krajnje taÄke izvan vaÅ¡e virtuelne mreÅ¾e, osim ako konfiguriÅ¡ete zaÅ¡titni zid usluge da blokira takav saobraÄ‡aj.
* Odnos izmeÄ‘u podmreÅ¾e i Azure usluge je jedan prema jedan.
* Jeftinije od privatnih veza.

**Privatne veze:**

* Privatna veza mapira Azure usluge u vaÅ¡u virtuelnu mreÅ¾u putem privatne krajnje taÄke, koja je mreÅ¾ni interfejs sa privatnom IP adresom unutar vaÅ¡e virtuelne mreÅ¾e.
* Azure usluga se pristupa koristeÄ‡i ovu privatnu IP adresu, Äime se Äini da je deo vaÅ¡e mreÅ¾e.
* Usluge povezane putem privatne veze mogu se pristupiti samo iz vaÅ¡e virtuelne mreÅ¾e ili povezanih mreÅ¾a; nema pristupa javnom internetu usluzi.
* OmoguÄ‡ava sigurnu vezu sa Azure uslugama ili vaÅ¡im sopstvenim uslugama smeÅ¡tenim u Azure-u, kao i vezu sa uslugama koje dele drugi.
* PruÅ¾a precizniju kontrolu pristupa putem privatne krajnje taÄke u vaÅ¡oj virtuelnoj mreÅ¾i, za razliku od Å¡ire kontrole pristupa na nivou podmreÅ¾e sa uslugama krajnjih taÄaka.

Ukratko, iako usluge krajnjih taÄaka i privatne veze obezbeÄ‘uju sigurnu konekciju sa Azure uslugama, **privatne veze pruÅ¾aju viÅ¡i nivo izolacije i sigurnosti tako Å¡to osiguravaju da se usluge pristupaju privatno, bez izlaganja javnom internetu**. Usluge krajnjih taÄaka, s druge strane, su lakÅ¡e za podeÅ¡avanje u opÅ¡tim sluÄajevima gde je potrebno jednostavno i sigurno pristupanje Azure uslugama bez potrebe za privatnom IP adresom u virtuelnoj mreÅ¾i.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** je skalabilna i sigurna ulazna taÄka za **brzu isporuku** vaÅ¡ih globalnih veb aplikacija. Ona **kombinuje** razliÄite usluge kao Å¡to su globalno **balansiranje optereÄ‡enja, ubrzavanje sajta, SSL dekodiranje i Web Application Firewall (WAF)** moguÄ‡nosti u jednu uslugu. Azure Front Door obezbeÄ‘uje inteligentno rutiranje na osnovu **najbliÅ¾e lokacije ivice korisniku**, obezbeÄ‘ujuÄ‡i optimalne performanse i pouzdanost. Dodatno, nudi rutiranje na osnovu URL-a, hosting viÅ¡e sajtova, afinitet sesije i sigurnost na nivou aplikacije.

**Azure Front Door WAF** je dizajniran da **Å¡titi veb aplikacije od napada zasnovanih na vebu** bez modifikacije koda na pozadini. UkljuÄuje prilagoÄ‘ena pravila i upravljane skupove pravila za zaÅ¡titu od pretnji kao Å¡to su SQL ubacivanje, skriptiranje preko sajta i druge uobiÄajene napade.

### **Primer**

* Zamislite da imate globalno distribuiranu aplikaciju sa korisnicima Å¡irom sveta. MoÅ¾ete koristiti Azure Front Door da **rutirate zahteve korisnika do najbliÅ¾eg regionalnog data centra** koji hostuje vaÅ¡u aplikaciju, Äime se smanjuje latencija, poboljÅ¡ava korisniÄko iskustvo i **Å¡titi je od napada na veb sa WAF moguÄ‡nostima**. Ako odreÄ‘ena regija doÅ¾ivi prekid rada, Azure Front Door moÅ¾e automatski preusmeriti saobraÄ‡aj na sledeÄ‡u najbolju lokaciju, obezbeÄ‘ujuÄ‡i visoku dostupnost.

### Nabrojavanje

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway i Azure Application Gateway WAF

Azure Application Gateway je **optereÄ‡ivaÄ web saobraÄ‡aja** koji vam omoguÄ‡ava upravljanje saobraÄ‡ajem ka vaÅ¡im **web** aplikacijama. Nudi moguÄ‡nosti **optereÄ‡ivanja na nivou sloja 7, prekida SSL-a i zaÅ¡tite aplikacija od napada (WAF)** u okviru kontrolera isporuke aplikacija (ADC) kao usluge. KljuÄne funkcionalnosti ukljuÄuju rutiranje na osnovu URL-a, vezivanje sesije na osnovu kolaÄiÄ‡a i preusmeravanje sloja sigurnih soketa (SSL), Å¡to je kljuÄno za aplikacije koje zahtevaju sloÅ¾ene moguÄ‡nosti optereÄ‡ivanja kao Å¡to su globalno rutiranje i rutiranje na osnovu putanje.

### Primer

* Zamislite scenario u kojem imate e-trgovinski sajt koji ukljuÄuje viÅ¡e poddomena za razliÄite funkcije, kao Å¡to su korisniÄki nalozi i obrada plaÄ‡anja. Azure Application Gateway moÅ¾e **usmeravati saobraÄ‡aj ka odgovarajuÄ‡im web serverima na osnovu putanje URL-a**. Na primer, saobraÄ‡aj ka `primer.com/nalozi` moÅ¾e biti usmeren ka servisu za korisniÄke naloge, a saobraÄ‡aj ka `primer.com/plati` moÅ¾e biti usmeren ka servisu za obradu plaÄ‡anja.\
I **zaÅ¡tititi vaÅ¡ sajt od napada koristeÄ‡i moguÄ‡nosti WAF-a**.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** je funkcionalnost mreÅ¾e u Azure-u koja omoguÄ‡ava **direktno i bez problema povezivanje razliÄitih virtuelnih mreÅ¾a (VNets)**. Kroz VNet peering, resursi u jednoj VNet mogu komunicirati sa resursima u drugoj VNet koristeÄ‡i privatne IP adrese, **kao da su u istoj mreÅ¾i**.\
**VNet Peering se takoÄ‘e moÅ¾e koristiti sa on-prem mreÅ¾ama** postavljanjem site-to-site VPN-a ili Azure ExpressRoute-a.

**Azure Hub i Spoke** je topologija mreÅ¾e koja se koristi u Azure-u za upravljanje i organizaciju saobraÄ‡aja u mreÅ¾i. **"Hub" je centralna taÄka koja kontroliÅ¡e i usmerava saobraÄ‡aj izmeÄ‘u razliÄitih "spoke" mreÅ¾a**. Hub obiÄno sadrÅ¾i deljene usluge kao Å¡to su virtualni mreÅ¾ni ureÄ‘aji (NVAs), Azure VPN Gateway, Azure Firewall ili Azure Bastion. **"Spoke" su VNets koji hostuju radne optereÄ‡enja i povezuju se sa hub-om koristeÄ‡i VNet peering**, Å¡to im omoguÄ‡ava da iskoriste deljene usluge unutar hub-a. Ovaj model promoviÅ¡e Äist raspored mreÅ¾e, smanjujuÄ‡i sloÅ¾enost centralizacijom zajedniÄkih usluga koje mogu koristiti viÅ¡e radnih optereÄ‡enja u razliÄitim VNets.

{% hint style="danger" %}
**VNET uparivanje nije tranzitivno u Azure-u**, Å¡to znaÄi da ako je spoke 1 povezan sa spoke 2 i spoke 2 je povezan sa spoke 3, tada spoke 1 ne moÅ¾e direktno komunicirati sa spoke 3.
{% endhint %}

### Primeri

* Zamislite kompaniju sa odvojenim odeljenjima kao Å¡to su Prodaja, HR i Razvoj, **svako sa svojom VNet-om (spoke)**. Ove VNets **zahtevaju pristup deljenim resursima** kao Å¡to su centralna baza podataka, firewall i internet gateway, koji se nalaze u **drugoj VNet-u (hub-u)**. KoriÅ¡Ä‡enjem Hub i Spoke modela, svako odeljenje moÅ¾e **bezbedno se povezati sa deljenim resursima preko hub VNet-a, bez izlaganja tih resursa javnom internetu** ili kreiranja sloÅ¾ene mreÅ¾ne strukture sa brojnim konekcijama.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Site-to-Site VPN u Azure-u vam omoguÄ‡ava da **poveÅ¾ete svoju lokalnu mreÅ¾u sa Azure virtuelnom mreÅ¾om (VNet)**, omoguÄ‡avajuÄ‡i resursima poput virtuelnih maÅ¡ina unutar Azure-a da se prikaÅ¾u kao da su na vaÅ¡oj lokalnoj mreÅ¾i. Ova veza se uspostavlja putem **VPN gateway-a koji enkriptuje saobraÄ‡aj** izmeÄ‘u ove dve mreÅ¾e.

### **Primer**

* Poslovna kompanija sa svojim glavnim sediÅ¡tem u Njujorku ima lokalni data centar koji treba bezbedno da se poveÅ¾e sa svojom VNet-om u Azure-u, gde se nalaze njihovi virtualizovani radni optereÄ‡enja. Postavljanjem **Site-to-Site VPN-a, kompanija moÅ¾e obezbediti enkriptovanu konekciju izmeÄ‘u lokalnih servera i Azure VM-ova**, omoguÄ‡avajuÄ‡i pristup resursima na bezbedan naÄin iz oba okruÅ¾enja kao da su u istoj lokalnoj mreÅ¾i.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute je usluga koja pruÅ¾a **privatnu, posveÄ‡enu i visokobrzinsku vezu izmeÄ‘u vaÅ¡e infrastrukture na lokaciji i Azure data centara**. Ova veza se ostvaruje putem pruÅ¾aoca konektivnosti, zaobilazeÄ‡i javni internet i pruÅ¾ajuÄ‡i veÄ‡u pouzdanost, brÅ¾e brzine, manje latencije i veÄ‡u sigurnost u odnosu na tipiÄne internet veze.

### **Primer**

* Multinacionalna korporacija zahteva **doslednu i pouzdanu vezu sa svojim Azure uslugama zbog velike koliÄine podataka** i potrebe za visokim protokom. Kompanija se odluÄuje za Azure ExpressRoute kako bi direktno povezala svoj data centar na lokaciji sa Azure-om, olakÅ¡avajuÄ‡i prenos velikih koliÄina podataka, kao Å¡to su dnevne rezervne kopije i analiza podataka u realnom vremenu, uz poboljÅ¡anu privatnost i brzinu.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
