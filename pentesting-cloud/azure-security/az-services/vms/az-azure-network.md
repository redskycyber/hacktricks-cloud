# Az - Azure MreÅ¾a

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne Informacije

MreÅ¾e unutar Azure funkcioniÅ¡u kao integralni deo njegove cloud raÄunarske platforme, omoguÄ‡avajuÄ‡i **povezivanje i komunikaciju izmeÄ‘u razliÄitih Azure servisa i resursa**. Arhitektura mreÅ¾e u Azure-u je dizajnirana da bude visoko skalabilna, sigurna i prilagodljiva.

U suÅ¡tini, Azure pruÅ¾a **virtuelnu mreÅ¾u (VNet)** koja korisnicima omoguÄ‡ava kreiranje **izolovanih** **mreÅ¾a** unutar Azure oblaka. U okviru ovih VNet-ova, resursi poput virtuelnih maÅ¡ina, aplikacija i baza podataka mogu biti sigurno smeÅ¡teni i upravljani. MreÅ¾no povezivanje u Azure-u podrÅ¾ava kako komunikaciju unutar oblaka (izmeÄ‘u Azure servisa), tako i povezivanje sa spoljnim mreÅ¾ama i internetom.

**Bezbednost** je kljuÄni aspekt Azure mreÅ¾iranja, sa razliÄitim alatima i servisima dostupnim za zaÅ¡titu podataka, upravljanje pristupom i osiguravanje usaglaÅ¡enosti. Ove bezbednosne mere ukljuÄuju **firewallove**, **grupe za bezbednost mreÅ¾e** i moguÄ‡nosti **Å¡ifrovanja**, omoguÄ‡avajuÄ‡i visok nivo kontrole nad saobraÄ‡ajem i pristupom.

Sveukupno, moguÄ‡nosti mreÅ¾iranja u Azure-u su dizajnirane da pruÅ¾e fleksibilnost, omoguÄ‡avajuÄ‡i korisnicima da kreiraju mreÅ¾no okruÅ¾enje koje odgovara specifiÄnim potrebama aplikacije i optereÄ‡enja, uz snaÅ¾an naglasak na sigurnost i pouzdanost.

## Virtuelna MreÅ¾a (VNET) & PodmreÅ¾e

VNet u Azure-u je suÅ¡tinski predstava vaÅ¡e sopstvene mreÅ¾e u oblaku. To je **logiÄka izolacija Azure oblaka posveÄ‡ena vaÅ¡oj pretplati**. VNet vam omoguÄ‡ava da obezbedite i upravljate virtuelnim privatnim mreÅ¾ama (VPN-ovima) u Azure-u i moÅ¾e se koristiti za smeÅ¡tanje i **upravljanje razliÄitim vrstama Azure resursa**, poput virtuelnih maÅ¡ina (VM-ova), baza podataka i aplikacionih servisa.

VNet-ovi vam pruÅ¾aju **potpunu kontrolu nad postavkama vaÅ¡e mreÅ¾e**, ukljuÄujuÄ‡i **opsege IP adresa**, kreiranje podmreÅ¾a, tabele ruta i mreÅ¾ne gateway-e.

**PodmreÅ¾a** je **opseg IP adresa u vaÅ¡em VNet-u**. MoÅ¾ete podeliti VNet u viÅ¡e podmreÅ¾a radi organizacije i bezbednosti. Svaka podmreÅ¾a u VNet-u moÅ¾e se koristiti za izolaciju i grupisanje resursa prema vaÅ¡oj mreÅ¾noj i aplikacionoj arhitekturi.

Osim toga, podmreÅ¾e vam omoguÄ‡avaju da **segmentirate svoj VNet u jednu ili viÅ¡e pod-mreÅ¾a**, pruÅ¾ajuÄ‡i opseg IP adresa koje resursi mogu koristiti.

### **Primer**

* Recimo da imate VNet nazvan `MyVNet` sa opsegom IP adresa `10.0.0.0/16`. MoÅ¾ete kreirati podmreÅ¾u unutar ovog VNet-a, recimo `PodmreÅ¾a-1`, sa opsegom IP adresa `10.0.0.0/24` za smeÅ¡tanje vaÅ¡ih web servera. Druga podmreÅ¾a, `PodmreÅ¾a-2` sa opsegom `10.0.1.0/24`, moÅ¾e se koristiti za vaÅ¡e serverske baze podataka. Ova segmentacija omoguÄ‡ava efikasno upravljanje i kontrolu bezbednosti unutar mreÅ¾e.

### Enumeracija

Da biste naveli sve VNet-ove i podmreÅ¾e u Azure nalogu, moÅ¾ete koristiti Azure Command-Line Interface (CLI). Evo koraka:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
## Grupi bezbednosti mreÅ¾e (NSG)

U Azuru, **Grupa bezbednosti mreÅ¾e (NSG)** sluÅ¾i osnovnoj funkciji filtriranja mreÅ¾nog saobraÄ‡aja kako ka tako i od resursa u okviru Virtuelne mreÅ¾e (VNet) u Azuru. Ona sadrÅ¾i skup **pravila bezbednosti** koja detaljno odreÄ‘uju tok mreÅ¾nog saobraÄ‡aja.

KljuÄni aspekti NSG ukljuÄuju:

- **Kontrola saobraÄ‡aja**: Svaka NSG sadrÅ¾i pravila koja su od suÅ¡tinskog znaÄaja za dozvoljavanje ili blokiranje dolaznog i odlaznog mreÅ¾nog saobraÄ‡aja povezanog sa razliÄitim Azure resursima.
- **Komponente pravila**: Pravila unutar NSG su veoma specifiÄna, filtrirajuÄ‡i saobraÄ‡aj na osnovu kriterijuma kao Å¡to su izvorna/odrediÅ¡na IP adresa, port i protokol. Ova specifiÄnost omoguÄ‡ava granularno upravljanje mreÅ¾nim saobraÄ‡ajem.
- **PoboljÅ¡anje bezbednosti**: OsiguravajuÄ‡i da samo ovlaÅ¡Ä‡eni saobraÄ‡aj moÅ¾e da ulazi ili izlazi iz vaÅ¡ih Azure resursa, NSG igra kljuÄnu ulogu u jaÄanju bezbednosnog poloÅ¾aja vaÅ¡e mreÅ¾ne infrastrukture.

### **Primer**

- Zamislite da imate NSG nazvanu `MojaNSG` primenjenu na podmreÅ¾u ili odreÄ‘enu virtuelnu maÅ¡inu unutar vaÅ¡e VNet. MoÅ¾ete kreirati pravila kao Å¡to su:
- Dolazno pravilo koje dozvoljava HTTP saobraÄ‡aj (port 80) sa bilo koje izvorne lokacije ka vaÅ¡im veb serverima.
- Odlazno pravilo koje dozvoljava samo SQL saobraÄ‡aj (port 1433) ka odreÄ‘enom opsegu odrediÅ¡nih IP adresa.

### Nabrojavanje

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall je upravljana, cloud-based **usluga za mreÅ¾nu sigurnost koja Å¡titi vaÅ¡e Azure Virtual Network resurse**. To je potpuno stanje firewall kao usluga sa ugraÄ‘enim moguÄ‡nostima visoke dostupnosti i skalabilnosti.

Azure Firewall pruÅ¾a **naprednije** funkcije od **NSG-ova**, ukljuÄujuÄ‡i **filtriranje na nivou aplikacije**, filtriranje na nivou mreÅ¾e, filtriranje zasnovano na obaveÅ¡tajima o pretnjama i integraciju sa Azure Monitor-om za beleÅ¾enje i analitiku.\
MoÅ¾e filtrirati odlazni, dolazni, komunikaciju izmeÄ‘u Å¡piceva, VPN i ExpressRoute saobraÄ‡aj. **Pravila firewall-a mogu biti kreirana na osnovu FQDN (Potpuno kvalifikovano ime domena), IP adresa i portova**.

### Razlike izmeÄ‘u Azure Firewall-a i NSG-ova

1. **Opseg:**
* **NSG:** Radi na nivou podmreÅ¾e ili mreÅ¾nog interfejsa. Namijenjen je pruÅ¾anju osnovnog filtriranja dolaznog i odlaznog saobraÄ‡aja sa mreÅ¾nih interfejsa (NIC), VM-ova ili podmreÅ¾a.
* **Azure Firewall:** Deluje na nivou VNet-a, pruÅ¾ajuÄ‡i Å¡iri opseg zaÅ¡tite. Dizajniran je da obezbedi vaÅ¡e virtualne mreÅ¾ne resurse i upravlja saobraÄ‡ajem koji ulazi i izlazi iz VNet-a.
2. **MoguÄ‡nosti:**
* **NSG:** PruÅ¾a osnovne moguÄ‡nosti filtriranja zasnovane na IP adresi, portu i protokolu. Ne podrÅ¾ava napredne funkcije poput inspekcije na nivou aplikacije ili obaveÅ¡tajima o pretnjama.
* **Azure Firewall:** Nudi napredne funkcije poput filtriranja saobraÄ‡aja na nivou aplikacije (Sloj 7), filtriranja zasnovanog na obaveÅ¡tajima o pretnjama, filtriranja mreÅ¾nog saobraÄ‡aja i joÅ¡ mnogo toga. TakoÄ‘e podrÅ¾ava viÅ¡e javnih IP adresa.
3. **Upotrebe:**
* **NSG:** Idealno za osnovno filtriranje saobraÄ‡aja na nivou mreÅ¾e.
* **Azure Firewall:** Pogodan za sloÅ¾enije scenarije filtriranja gde su potrebna kontrola na nivou aplikacije, beleÅ¾enje i obaveÅ¡taji o pretnjama.
4. **Upravljanje i PraÄ‡enje:**
* **NSG:** Nudi osnovno beleÅ¾enje i integraciju sa Azure Monitor-om.
* **Azure Firewall:** PruÅ¾a napredne moguÄ‡nosti beleÅ¾enja i analitike putem Azure Monitor-a, Å¡to je kljuÄno za razumevanje prirode i obrasca saobraÄ‡aja.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## MreÅ¾ni virtuelni ureÄ‘aj (NVA)

MreÅ¾ni virtuelni ureÄ‘aj (**NVA**) u Azuru je virtuelni ureÄ‘aj koji **vrÅ¡i mreÅ¾ne funkcije unutar virtuelne mreÅ¾e**. NVA se obiÄno koriste za mreÅ¾ne funkcije koje **nisu dostupne nativno** u Azuru ili kada je potrebna veÄ‡a prilagodljivost. Oni su suÅ¡tinski **VM-ovi koji pokreÄ‡u mreÅ¾ne aplikacije ili usluge**, poput firewall-a, WAN optimizatora ili load balansera.

NVA se koriste za sloÅ¾eno rutiranje, **bezbednost** i **upravljanje mreÅ¾nim saobraÄ‡ajem**. Mogu se implementirati sa Azure **Marketplace**-a, gde mnogi treÄ‡i proizvoÄ‘aÄi nude svoje ureÄ‘aje spremne za integraciju u Azure okruÅ¾enja.

### **Primer**

* Organizacija moÅ¾e implementirati NVA u Azuru kako bi kreirala **prilagoÄ‘eno reÅ¡enje firewall-a**. Ovaj NVA bi mogao pokretati **softver firewall-a treÄ‡eg proizvoÄ‘aÄa**, pruÅ¾ajuÄ‡i napredne funkcije poput detekcije upada, inspekcije paketa ili VPN konektivnosti. NVA se moÅ¾e konfigurisati da inspicira i filtrira saobraÄ‡aj koji prolazi kroz njega, obezbeÄ‘ujuÄ‡i unapreÄ‘ene bezbednosne mere u skladu sa politikama organizacije.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
## Azure Tabele ruta i korisniÄki definisane rute (UDR)

**Azure Tabele ruta** su funkcija unutar Microsoft Azure platforme koja omoguÄ‡ava **kontrolu rutiranja mreÅ¾nog saobraÄ‡aja unutar Azure virtuelnih mreÅ¾a (VNets)**. U osnovi, one definiÅ¡u kako se **paketi** **prosleÄ‘uju** izmeÄ‘u podmreÅ¾a unutar VNets-a, izmeÄ‘u VNets-a ili ka spoljnim mreÅ¾ama. Svaka tabela ruta sadrÅ¾i skup pravila, poznatih kao rute, koje specificiraju kako bi paketi trebalo da budu rutirani na osnovu njihovih odrediÅ¡nih IP adresa.

**KorisniÄki definisane rute (UDR)** u Azure-u su **prilagoÄ‘ene rute koje kreirate unutar Azure Tabela ruta** kako biste kontrolisali **tok mreÅ¾nog saobraÄ‡aja** unutar i izmeÄ‘u Azure virtuelnih mreÅ¾a (VNets), kao i ka spoljnim konekcijama. UDR-ovi vam pruÅ¾aju fleksibilnost da usmeravate mreÅ¾ni saobraÄ‡aj prema vaÅ¡im specifiÄnim zahtevima, premoÅ¡Ä‡ujuÄ‡i Azure-ove podrazumevane odluke o rutiranju.

Ove rute su posebno korisne u scenarijima gde je potrebno **rutirati saobraÄ‡aj kroz virtuelni ureÄ‘aj**, primeniti specifiÄan put za bezbednost ili usklaÄ‘enost sa pravilima, ili integrisati se sa lokalnim mreÅ¾ama.

### **Primer**

* Recimo da ste implementirali MreÅ¾ni Virtuelni Aparat (NVA) za inspekciju saobraÄ‡aja izmeÄ‘u podmreÅ¾a unutar VNet-a. MoÅ¾ete kreirati UDR koji usmerava sav saobraÄ‡aj iz jedne podmreÅ¾e ka drugoj podmreÅ¾i da prolazi kroz NVA. Ovaj UDR osigurava da NVA inspektuje saobraÄ‡aj iz bezbednosnih razloga pre nego Å¡to stigne do odrediÅ¡ta.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Privatna veza

Azure Privatna veza je usluga u okviru Azure platforme koja omoguÄ‡ava **privatan pristup Azure uslugama** tako Å¡to se **saobraÄ‡aj izmeÄ‘u vaÅ¡e Azure virtuelne mreÅ¾e (VNet) i usluge odvija iskljuÄivo unutar Microsoftove Azure osnovne mreÅ¾e**. Na taj naÄin se usluga efikasno integriÅ¡e u vaÅ¡u VNet. Ova postavka poboljÅ¡ava bezbednost tako Å¡to ne izlaÅ¾e podatke javnom internetu.

Privatna veza moÅ¾e biti koriÅ¡Ä‡ena sa razliÄitim Azure uslugama, poput Azure Storage, Azure SQL Database, i prilagoÄ‘enih usluga deljenih putem Privatne veze. PruÅ¾a siguran naÄin za koriÅ¡Ä‡enje usluga unutar vaÅ¡e VNet ili Äak iz razliÄitih Azure pretplata.

{% hint style="danger" %}
NSG-ovi se ne primenjuju na privatne krajnje taÄke, Å¡to jasno znaÄi da povezivanje NSG-a sa podmreÅ¾om koja sadrÅ¾i Privatnu vezu neÄ‡e imati efekta.
{% endhint %}

### **Primer**

* Razmotrite scenarijo gde imate **Azure SQL bazu podataka koju Å¾elite bezbedno pristupiti iz vaÅ¡e VNet**. ObiÄno, ovo bi ukljuÄivalo prolazak kroz javni internet. Sa Privatnom vezom, moÅ¾ete kreirati **privatnu krajnju taÄku u vaÅ¡oj VNet** koja se direktno povezuje sa Azure SQL bazom podataka. Ova krajnja taÄka Äini da baza podataka izgleda kao da je deo vaÅ¡e VNet, dostupna putem privatne IP adrese, Äime se obezbeÄ‘uje siguran i privatni pristup.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
## Azure servisne taÄke

Azure servisne taÄke proÅ¡iruju privatni adresni prostor virtuelne mreÅ¾e i identitet vaÅ¡e VNet na Azure servise preko direktnog povezivanja. OmoguÄ‡avanjem servisnih taÄaka, resursi u vaÅ¡oj VNet mogu sigurno da se poveÅ¾u sa Azure servisima, poput Azure Storage i Azure SQL baze podataka, koristeÄ‡i Azure-ovu osnovnu mreÅ¾u. Ovo osigurava da saobraÄ‡aj iz VNet-a ka Azure servisu ostane unutar Azure mreÅ¾e, pruÅ¾ajuÄ‡i sigurniju i pouzdaniju putanju.

### **Primer**

* Na primer, Azure Storage nalog je podrazumevano dostupan preko javnog interneta. OmoguÄ‡avanjem servisne taÄke za Azure Storage unutar vaÅ¡e VNet, moÅ¾ete osigurati da samo saobraÄ‡aj iz vaÅ¡e VNet moÅ¾e pristupiti nalogu za skladiÅ¡tenje. Zatim se firewall naloga za skladiÅ¡tenje moÅ¾e konfigurisati da prihvati saobraÄ‡aj samo iz vaÅ¡e VNet. 

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
### Razlike izmeÄ‘u Servisnih TaÄaka i Privatnih Linkova

Microsoft preporuÄuje koriÅ¡Ä‡enje Privatnih Linkova u [**dokumentaciji**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Servisne TaÄke:**

* SaobraÄ‡aj iz vaÅ¡e VNet ka Azure servisu putuje preko Microsoft Azure mreÅ¾e, zaobilazeÄ‡i javni internet.
* TaÄka je direktna veza sa Azure servisom i ne pruÅ¾a privatnu IP adresu za servis unutar VNet-a.
* Sam servis je i dalje dostupan putem svog javnog endpointa izvan vaÅ¡eg VNet-a osim ako konfiguriÅ¡ete firewall servisa da blokira takav saobraÄ‡aj.
* Postoji jedan-na-jedan odnos izmeÄ‘u podmreÅ¾e i Azure servisa.
* Jeftinije su od Privatnih Linkova.

**Privatni Linkovi:**

* Privatni Link mapira Azure servise u vaÅ¡ VNet putem privatne taÄke, koja je mreÅ¾ni interfejs sa privatnom IP adresom unutar vaÅ¡eg VNet-a.
* Azure servis se pristupa koriÅ¡Ä‡enjem ove privatne IP adrese, ÄineÄ‡i da izgleda kao da je deo vaÅ¡e mreÅ¾e.
* Servisi povezani putem Privatnih Linkova mogu se pristupiti samo iz vaÅ¡eg VNet-a ili povezanih mreÅ¾a; nema pristupa javnom internetu servisu.
* OmoguÄ‡ava sigurnu vezu sa Azure servisima ili vaÅ¡im sopstvenim servisima smeÅ¡tenim u Azure-u, kao i vezu sa servisima koje dele drugi.
* PruÅ¾a detaljniju kontrolu pristupa putem privatne taÄke u vaÅ¡em VNet-u, za razliku od Å¡ire kontrole pristupa na nivou podmreÅ¾e sa servisnim taÄkama.

U suÅ¡tini, dok i Servisne TaÄke i Privatni Linkovi pruÅ¾aju sigurnu povezanost sa Azure servisima, **Privatni Linkovi nude viÅ¡i nivo izolacije i sigurnosti osiguravajuÄ‡i da se servisi pristupaju privatno bez izlaganja javnom internetu**. Servisne TaÄke, s druge strane, lakÅ¡e se postavljaju za opÅ¡te sluÄajeve gde je potrebno jednostavno, sigurno pristupanje Azure servisima bez potrebe za privatnom IP adresom u VNet-u.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** je skalabilna i sigurna ulazna taÄka za **brzu isporuku** vaÅ¡ih globalnih web aplikacija. **Kombinuje** razliÄite usluge poput globalnog **balansiranja optereÄ‡enja, ubrzanja sajta, SSL dekripcije, i moguÄ‡nosti Web Application Firewall (WAF)** u jednu uslugu. Azure Front Door pruÅ¾a inteligentno rutiranje zasnovano na **najbliÅ¾oj lokaciji ivice korisniku**, osiguravajuÄ‡i optimalne performanse i pouzdanost. Dodatno, nudi rutiranje zasnovano na URL-u, hosting viÅ¡e sajtova, afinitet sesije, i sigurnost na nivou aplikacije.

**Azure Front Door WAF** je dizajniran da **Å¡titi web aplikacije od napada putem web-a** bez modifikacije koda na serverskoj strani. UkljuÄuje prilagoÄ‘ena pravila i upravljane skupove pravila za zaÅ¡titu od pretnji poput SQL injection-a, cross-site scripting-a i drugih Äestih napada.

### **Primer**

* Zamislite da imate globalno distribuiranu aplikaciju sa korisnicima Å¡irom sveta. MoÅ¾ete koristiti Azure Front Door da **rutirate zahteve korisnika do najbliÅ¾eg regionalnog data centra** koji hostuje vaÅ¡u aplikaciju, smanjujuÄ‡i latenciju, poboljÅ¡avajuÄ‡i korisniÄko iskustvo i **braneÄ‡i je od web napada uz WAF moguÄ‡nosti**. Ako odreÄ‘ena regija doÅ¾ivi prekid rada, Azure Front Door automatski moÅ¾e preusmeriti saobraÄ‡aj ka sledeÄ‡oj najboljoj lokaciji, osiguravajuÄ‡i visoku dostupnost.

### Nabrojavanje

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure aplikaciona kapija i Azure aplikaciona kapija WAF

Azure aplikaciona kapija je **balanser optereÄ‡enja veb saobraÄ‡aja** koji vam omoguÄ‡ava da upravljate saobraÄ‡ajem ka vaÅ¡im **veb** aplikacijama. Nudi **balansiranje optereÄ‡enja na nivou sloja 7, SSL prekidanje i sposobnosti veb aplikacionog zida (WAF)** u kontroloru isporuke aplikacija (ADC) kao uslugu. KljuÄne funkcije ukljuÄuju rutiranje na osnovu URL-a, afinitet sesije na osnovu kolaÄiÄ‡a i prebacivanje sloja sigurnosnog sloja (SSL), Å¡to je kljuÄno za aplikacije koje zahtevaju kompleksne moguÄ‡nosti balansiranja optereÄ‡enja poput globalnog rutiranja i rutiranja na osnovu putanje.

### Primer

* Razmotrite scenarij u kojem imate veb sajt za elektronsku trgovinu koji ukljuÄuje viÅ¡e poddomena za razliÄite funkcije, poput korisniÄkih naloga i obrade plaÄ‡anja. Azure aplikaciona kapija moÅ¾e **rutirati saobraÄ‡aj ka odgovarajuÄ‡im veb serverima na osnovu URL putanje**. Na primer, saobraÄ‡aj ka `primer.com/nalozi` moÅ¾e biti usmeren ka servisu za korisniÄke naloge, a saobraÄ‡aj ka `primer.com/plati` moÅ¾e biti usmeren ka servisu za obradu plaÄ‡anja.\
I **zaÅ¡tititi vaÅ¡ veb sajt od napada koristeÄ‡i sposobnosti WAF-a.**

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** je funkcija umreÅ¾avanja u Azure-u koja **omoguÄ‡ava direktno i besprekidno povezivanje razliÄitih virtuelnih mreÅ¾a (VNets)**. Kroz VNet peering, resursi u jednoj VNet mogu komunicirati sa resursima u drugoj VNet koriÅ¡Ä‡enjem privatnih IP adresa, **kao da su u istoj mreÅ¾i**.\
**VNet Peering se takoÄ‘e moÅ¾e koristiti sa on-prem mreÅ¾ama** postavljanjem site-to-site VPN-a ili Azure ExpressRoute-a.

**Azure Hub i Spoke** je topologija mreÅ¾e koja se koristi u Azure-u za upravljanje i organizovanje saobraÄ‡aja u mreÅ¾i. **"Hub" je centralna taÄka koja kontroliÅ¡e i usmerava saobraÄ‡aj izmeÄ‘u razliÄitih "spoke-ova"**. Hub obiÄno sadrÅ¾i deljene usluge poput virtuelnih mreÅ¾nih ureÄ‘aja (NVAs), Azure VPN Gateway-a, Azure Firewall-a ili Azure Bastion-a. **"Spoke-ovi" su VNets koji hostuju radne optereÄ‡enja i povezuju se sa hub-om koriÅ¡Ä‡enjem VNet peering-a**, omoguÄ‡avajuÄ‡i im da iskoriste deljene usluge unutar hub-a. Ovaj model promoviÅ¡e Äist raspored mreÅ¾e, smanjujuÄ‡i kompleksnost centralizovanjem zajedniÄkih usluga koje mogu koristiti viÅ¡estruka radna optereÄ‡enja Å¡irom razliÄitih VNets.

{% hint style="danger" %}
**VNET uparivanje nije tranzitivno u Azure-u**, Å¡to znaÄi da ako je spoke 1 povezan sa spoke 2 i spoke 2 je povezan sa spoke 3, tada spoke 1 ne moÅ¾e direktno komunicirati sa spoke 3.
{% endhint %}

### Primeri

* Zamislite kompaniju sa odvojenim odeljenjima poput Prodaje, HR-a i Razvoja, **svako sa svojim VNet-om (spoke-ovima)**. Ovi VNets **zahtevaju pristup deljenim resursima** poput centralne baze podataka, firewall-a i internet gateway-a, koji se nalaze u **drugom VNet-u (hub-u)**. KoriÅ¡Ä‡enjem Hub i Spoke modela, svako odeljenje moÅ¾e **sigurno povezati se sa deljenim resursima kroz hub VNet bez izlaganja tih resursa javnom internetu** ili kreiranja kompleksne mreÅ¾ne strukture sa brojnim povezivanjima.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Site-to-Site VPN u Azure-u vam omoguÄ‡ava da **poveÅ¾ete svoju lokalnu mreÅ¾u sa vaÅ¡om Azure virtuelnom mreÅ¾om (VNet)**, omoguÄ‡avajuÄ‡i resursima poput VM-ova unutar Azure-a da izgledaju kao da su na vaÅ¡oj lokalnoj mreÅ¾i. Ova veza se uspostavlja putem **VPN gateway-a koji enkriptuje saobraÄ‡aj** izmeÄ‘u ove dve mreÅ¾e.

### **Primer**

* Poslovni subjekat sa glavnim sediÅ¡tem u Njujorku ima lokalni data centar koji treba bezbedno da se poveÅ¾e sa svojom VNet-om u Azure-u, gde se nalaze njegovi virtualizovani radni tereti. Postavljanjem **Site-to-Site VPN-a, kompanija moÅ¾e obezbediti enkriptovanu konekciju izmeÄ‘u on-premises servera i Azure VM-ova**, omoguÄ‡avajuÄ‡i resursima da se bezbedno pristupaju u oba okruÅ¾enja kao da su u istoj lokalnoj mreÅ¾i.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute je usluga koja pruÅ¾a **privatnu, posveÄ‡enu, visokobrzinsku vezu izmeÄ‘u vaÅ¡e infrastrukture na lokaciji i Azure data centara**. Ova veza se uspostavlja preko pruÅ¾aoca konektivnosti, zaobilazeÄ‡i javni internet i pruÅ¾ajuÄ‡i veÄ‡u pouzdanost, brÅ¾e brzine, niÅ¾e latencije i veÄ‡u sigurnost od tipiÄnih internet veza.

### **Primer**

* Multinacionalna korporacija zahteva **konstantnu i pouzdanu vezu sa svojim Azure uslugama zbog velike koliÄine podataka** i potrebe za visokim protokom. Kompanija se odluÄuje za Azure ExpressRoute kako bi direktno povezala svoj data centar na lokaciji sa Azure-om, olakÅ¡avajuÄ‡i prenos podataka velikih razmera, kao Å¡to su dnevne rezervne kopije i analitika podataka u realnom vremenu, sa unapreÄ‘enom privatnoÅ¡Ä‡u i brzinom.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJATELJSTVO**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
