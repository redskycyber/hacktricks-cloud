# Az - Azure Network

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF** sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

Sieci w ramach Azure funkcjonuj jako integralna cz jej platformy obliczeniowej w chmurze, umo偶liwiajc **poczenie i komunikacj midzy r贸偶nymi usugami i zasobami Azure**. Architektura sieci w Azure zostaa zaprojektowana tak, aby bya wysoce skalowalna, bezpieczna i dostosowalna.

W swoim rdzeniu Azure zapewnia **wirtualn sie (VNet)**, kt贸ra umo偶liwia u偶ytkownikom tworzenie **izolowanych** **sieci** w chmurze Azure. W ramach tych VNet贸w zasoby takie jak wirtualne maszyny, aplikacje i bazy danych mog by bezpiecznie hostowane i zarzdzane. Sieciowanie w Azure obsuguje zar贸wno komunikacj wewntrz chmury (midzy usugami Azure), jak i poczenie z sieciami zewntrznymi i internetem.

**Bezpieczestwo** jest istotnym aspektem sieciowania w Azure, z r贸偶nymi narzdziami i usugami dostpnymi do ochrony danych, zarzdzania dostpem i zapewnienia zgodnoci. Te rodki bezpieczestwa obejmuj **firewalle**, **grupy zabezpiecze sieciowych** i mo偶liwoci **szyfrowania**, pozwalajc na wysoki poziom kontroli nad ruchem i dostpem.

Og贸lnie rzecz biorc, mo偶liwoci sieciowe w Azure s zaprojektowane tak, aby oferowa elastyczno, umo偶liwiajc u偶ytkownikom tworzenie rodowiska sieciowego odpowiadajcego ich konkretnym potrzebom aplikacyjnym i obci偶eniowym, zachowujc przy tym silny nacisk na bezpieczestwo i niezawodno.

## Wirtualna sie (VNET) i podsieci

VNet w Azure jest w zasadzie reprezentacj twojej wasnej sieci w chmurze. Jest to **logiczna izolacja chmury Azure dedykowana twojej subskrypcji**. VNet umo偶liwia tworzenie i zarzdzanie wirtualnymi sieciami prywatnymi (VPN) w Azure i mo偶e by u偶ywany do hostowania i **zarzdzania wieloma rodzajami zasob贸w Azure**, takimi jak Wirtualne Maszyny (VM), bazy danych i usugi aplikacyjne.

VNety zapewniaj ci **pen kontrol nad ustawieniami sieci**, w tym zakresami **adres贸w IP**, tworzeniem podsieci, tabelami trasowania i bramami sieciowymi.

**Podsie** to **zakres adres贸w IP w twoim VNet**. Mo偶esz podzieli VNet na wiele podsieci dla cel贸w organizacyjnych i bezpieczestwa. Ka偶da podsie w VNet mo偶e by u偶ywana do izolowania i grupowania zasob贸w zgodnie z twoj architektur sieciow i aplikacyjn.

Ponadto podsieci pozwalaj na **segmentacj twojego VNetu na jedn lub wicej podsieci**, zapewniajc zakres adres贸w IP, kt贸rymi zasoby mog korzysta.

### **Przykad**

* Za贸偶my, 偶e masz VNet o nazwie `MyVNet` z zakresem adres贸w IP `10.0.0.0/16`. Mo偶esz utworzy podsie w ramach tego VNetu, powiedzmy `Subnet-1`, z zakresem adres贸w IP `10.0.0.0/24` do hostowania serwer贸w WWW. Inna podsie, `Subnet-2` o zakresie `10.0.1.0/24`, mogaby by u偶ywana do serwer贸w baz danych. Ta segmentacja pozwala na efektywne zarzdzanie i kontrole bezpieczestwa w sieci.

### Wyliczenie

Aby wywietli wszystkie VNety i podsieci w koncie Azure, mo偶na u偶y interfejsu wiersza polece Azure (CLI). Oto kroki:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Grupy zabezpiecze sieciowych (NSG)

W Azure **Network Security Group (NSG)** peni g贸wn funkcj filtrowania ruchu sieciowego zar贸wno do, jak i z zasob贸w Azure w ramach wirtualnej sieci Azure (VNet). Zawiera zestaw **regu bezpieczestwa**, kt贸re skrupulatnie okrelaj przepyw ruchu sieciowego.

Kluczowe aspekty NSG obejmuj:

* **Kontrola ruchu**: Ka偶da NSG zawiera reguy, kt贸re s instrumentalne w zezwalaniu lub blokowaniu ruchu sieciowego przychodzcego i wychodzcego z r贸偶nych zasob贸w Azure.
* **Skadniki regu**: Reguy w ramach NSG s bardzo konkretne, filtrowanie ruchu na podstawie kryteri贸w takich jak adres IP 藕r贸dowy/docelowy, port i protok贸. Ta specyfikacja pozwala na szczeg贸owe zarzdzanie ruchem sieciowym.
* **Wzmocnienie bezpieczestwa**: Zapewniajc, 偶e tylko autoryzowany ruch mo偶e wchodzi i wychodzi z zasob贸w Azure, NSG odgrywaj kluczow rol w umacnianiu postawy bezpieczestwa infrastruktury sieciowej.

### **Przykad**

* Wyobra藕 sobie, 偶e masz NSG o nazwie `MyNSG` zastosowan do podsieci lub okrelonej maszyny wirtualnej w Twojej VNet. Mo偶esz tworzy reguy takie jak:
* Regua przychodzca zezwalajca na ruch HTTP (port 80) z dowolnego 藕r贸da do serwer贸w internetowych.
* Regua wychodzca zezwalajca tylko na ruch SQL (port 1433) do okrelonego zakresu adres贸w IP docelowych.

### Wyliczenie

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
## Azure Firewall

Azure Firewall to zarzdzana usuga bezpieczestwa sieciowego w chmurze, kt贸ra chroni zasoby wirtualnej sieci Azure. Jest to w peni stanowy firewall jako usuga z wbudowanymi funkcjami wysokiej dostpnoci i skalowalnoci.

Azure Firewall oferuje bardziej zaawansowane funkcje ni偶 NSG, w tym filtrowanie na poziomie aplikacji, filtrowanie na poziomie sieci, filtrowanie oparte na inteligencji zagro偶e oraz integracj z Azure Monitor do logowania i analizy. Mo偶e filtrowa ruch wychodzcy, przychodzcy, midzy strefami, ruch VPN i ExpressRoute. Reguy firewalla mog by tworzone na podstawie FQDN (Fully Qualified Domain Name), adres贸w IP i port贸w.

### R贸偶nice midzy Azure Firewall a NSG

1. **Zakres:**
   - **NSG:** Dziaa na poziomie podsieci lub interfejsu sieciowego. Ma na celu zapewnienie podstawowego filtrowania ruchu przychodzcego i wychodzcego z interfejs贸w sieciowych (NIC), maszyn wirtualnych lub podsieci.
   - **Azure Firewall:** Dziaa na poziomie VNet, zapewniajc szerszy zakres ochrony. Zosta zaprojektowany do zabezpieczania zasob贸w wirtualnej sieci i zarzdzania ruchem wchodzcym i wychodzcym z VNet.
2. **Zdolnoci:**
   - **NSG:** Zapewnia podstawowe mo偶liwoci filtrowania oparte na adresie IP, porcie i protokole. Nie obsuguje zaawansowanych funkcji, takich jak inspekcja na poziomie aplikacji czy inteligencja zagro偶e.
   - **Azure Firewall:** Oferuje zaawansowane funkcje, takie jak filtrowanie ruchu na poziomie aplikacji (warstwa 7), filtrowanie oparte na inteligencji zagro偶e, filtrowanie ruchu sieciowego i wiele innych. Obsuguje r贸wnie偶 wiele publicznych adres贸w IP.
3. **Przypadki u偶ycia:**
   - **NSG:** Idealny do podstawowego filtrowania ruchu na poziomie sieci.
   - **Azure Firewall:** Nadaje si do bardziej zo偶onych scenariuszy filtrowania, gdzie wymagana jest kontrola na poziomie aplikacji, logowanie i inteligencja zagro偶e.
4. **Zarzdzanie i Monitorowanie:**
   - **NSG:** Oferuje podstawowe logowanie i integracj z Azure Monitor.
   - **Azure Firewall:** Zapewnia zaawansowane mo偶liwoci logowania i analizy za pomoc Azure Monitor, co jest istotne dla zrozumienia charakteru i wzorca ruchu.

### Wyliczanie

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
## Wirtualne urzdzenie sieciowe (NVA)

Wirtualne urzdzenie sieciowe (**NVA**) w usudze Azure to wirtualne urzdzenie, kt贸re **wykonuje funkcje sieciowe w ramach wirtualnej sieci**. NVA s zazwyczaj u偶ywane do funkcji sieciowych, kt贸re **nie s dostpne natywnie** w usudze Azure lub gdy wymagana jest wiksza dostosowanie. S to w zasadzie **maszyny wirtualne uruchamiajce aplikacje lub usugi sieciowe**, takie jak zapory sieciowe, optymalizatory WAN lub r贸wnowa偶niki obci偶enia.

NVA s wykorzystywane do zada zwizanych z **zaawansowanym routowaniem**, **bezpieczestwem** i **zarzdzaniem ruchem sieciowym**. Mog by wdro偶one z **Marketplace** Azure, gdzie wielu dostawc贸w oferuje swoje urzdzenia gotowe do integracji w rodowiskach Azure.

### **Przykad**

* Organizacja mo偶e wdro偶y NVA w usudze Azure, aby stworzy **niestandardowe rozwizanie zapory sieciowej**. To NVA mo偶e uruchamia **oprogramowanie zapory innej firmy**, zapewniajc zaawansowane funkcje, takie jak wykrywanie intruz贸w, inspekcja pakiet贸w czy czno VPN. NVA mo偶e by skonfigurowane do inspekcji i filtrowania ruchu przechodzcego przez niego, zapewniajc wzmocnione rodki bezpieczestwa zgodnie z politykami organizacji.

### **Wyliczanie**
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Tabele trasowania w Azure i Trasy zdefiniowane przez u偶ytkownika (UDR)

**Tabele trasowania w Azure** to funkcja w ramach platformy Microsoft Azure, kt贸ra umo偶liwia **kontrol trasowania ruchu sieciowego w ramach Wirtualnych Sieci Azure (VNets)**. W zasadzie definiuj, jak **pakiety** s **przekazywane** midzy podsieciami w ramach VNets, midzy VNets lub do zewntrznych sieci. Ka偶da tabela trasowania zawiera zestaw regu, znanych jako trasy, kt贸re okrelaj, jak pakiety powinny by kierowane na podstawie ich docelowych adres贸w IP.

**Trasy zdefiniowane przez u偶ytkownika (UDR)** w Azure to **niestandardowe trasy, kt贸re tworzysz w ramach tabel trasowania w Azure** w celu kontroli **przepywu ruchu sieciowego** wewntrz i midzy Wirtualnymi Sieciami Azure (VNets) oraz do pocze zewntrznych. UDR umo偶liwiaj elastyczne kierowanie ruchem sieciowym zgodnie z konkretnymi wymaganiami, nadpisujc domylne decyzje trasowania w Azure.

Te trasy s szczeg贸lnie przydatne w przypadkach, gdy potrzebujesz **kierowa ruch przez wirtualne urzdzenie**, narzuci okrelon cie偶k ze wzgld贸w bezpieczestwa lub zgodnoci z polityk, lub zintegrowa si z sieciami lokalnymi.

### **Przykad**

* Za贸偶my, 偶e wdro偶ye Wirtualne Urzdzenie Sieciowe (NVA) do inspekcji ruchu midzy podsieciami w ramach jednego VNet. Mo偶esz utworzy UDR, kt贸ry kieruje cay ruch z jednej podsieci do innej podsieci przez NVA. Ten UDR zapewnia, 偶e NVA inspekcjonuje ruch w celach bezpieczestwa przed dotarciem do celu.

### **Wyliczanie**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link to usuga w Azure, kt贸ra **umo偶liwia prywatny dostp do usug Azure**, zapewniajc, 偶e **ruch midzy twoj wirtualn sieci Azure (VNet) a usug odbywa si wycznie w ramach sieci bazowej Azure firmy Microsoft**. Skutecznie przynosi usug do twojej VNet. To ustawienie zwiksza bezpieczestwo, nie ujawniajc danych publicznemu internetowi.

Private Link mo偶na u偶ywa z r贸偶nymi usugami Azure, takimi jak Azure Storage, Azure SQL Database i niestandardowymi usugami udostpnionymi za porednictwem Private Link. Zapewnia bezpieczny spos贸b na korzystanie z usug z wasnej VNet lub nawet z r贸偶nych subskrypcji Azure.

{% hint style="danger" %}
NSG nie maj zastosowania do prywatnych punkt贸w kocowych, co jasno oznacza, 偶e przypisanie NSG do podsieci zawierajcej Private Link nie bdzie miao 偶adnego efektu.
{% endhint %}

### **Przykad**

* Rozwa偶 scenariusz, w kt贸rym masz **Azure SQL Database, do kt贸rego chcesz uzyska bezpieczny dostp z twojej VNet**. Normalnie mo偶e to wymaga przekraczania publicznego internetu. Dziki Private Link mo偶esz utworzy **prywatny punkt kocowy w twojej VNet**, kt贸ry czy si bezporednio z usug Azure SQL Database. Ten punkt kocowy sprawia, 偶e baza danych wydaje si by czci twojej wasnej VNet, dostpn za pomoc prywatnego adresu IP, zapewniajc tym samym bezpieczny i prywatny dostp.

### **Wyliczanie**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Usugi kocowe w usudze Azure

Usugi kocowe w usudze Azure rozszerzaj prywatn przestrze adresow wirtualnej sieci oraz to偶samo Twojej sieci wirtualnej do usug Azure poprzez bezporednie poczenie. Wczajc usugi kocowe, **zasoby w Twojej sieci wirtualnej mog bezpiecznie czy si z usugami Azure**, takimi jak Azure Storage i Azure SQL Database, korzystajc z sieci trzonowej Azure. Zapewnia to, 偶e **ruch z sieci wirtualnej do usugi Azure pozostaje w obrbie sieci Azure**, co zapewnia bardziej bezpieczn i niezawodn cie偶k.

### **Przykad**

* Na przykad konto **Azure Storage** domylnie jest dostpne przez publiczny internet. Wczajc **usug kocow dla Azure Storage w obrbie Twojej sieci wirtualnej**, mo偶esz zapewni, 偶e tylko ruch z Twojej sieci wirtualnej bdzie m贸g uzyska dostp do konta magazynu. Zapora konta magazynu mo偶e nastpnie zosta skonfigurowana tak, aby akceptowa ruch tylko z Twojej sieci wirtualnej.

### **Wyliczanie**
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### R贸偶nice midzy punktami kocowymi usugi a prywatnymi czami

Microsoft zaleca korzystanie z Prywatnych Link贸w w [**dokumentacji**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Punkty kocowe usugi:**

* Ruch z Twojego VNet do usugi Azure przemieszcza si po sieci rdzenia Microsoft Azure, omijajc publiczny internet.
* Punkt kocowy to bezporednie poczenie z usug Azure i nie zapewnia prywatnego adresu IP dla usugi w obrbie VNet.
* Usuga jest nadal dostpna poprzez sw贸j publiczny punkt kocowy spoza Twojego VNet, chyba 偶e skonfigurujesz zapor usugi w celu zablokowania takiego ruchu.
* Istnieje relacja jeden do jednego midzy podsieci a usug Azure.
* Mniej kosztowne ni偶 Prywatne Linki.

**Prywatne Linki:**

* Prywatny Link mapuje usugi Azure do Twojego VNet za porednictwem prywatnego punktu kocowego, kt贸ry jest interfejsem sieciowym z prywatnym adresem IP w Twoim VNet.
* Usuga Azure jest dostpna za pomoc tego prywatnego adresu IP, co sprawia, 偶e wydaje si by czci Twojej sieci.
* Usugi poczone za pomoc Prywatnego Linku mog by dostpne tylko z Twojego VNet lub poczonych sieci; nie ma dostpu z publicznego internetu do usugi.
* Umo偶liwia bezpieczne poczenie z usugami Azure lub Twoimi wasnymi usugami hostowanymi w Azure, a tak偶e poczenie z usugami udostpnianymi przez innych.
* Zapewnia bardziej szczeg贸ow kontrol dostpu za pomoc prywatnego punktu kocowego w Twoim VNet, w przeciwiestwie do szerszej kontroli dostpu na poziomie podsieci za pomoc punkt贸w kocowych usugi.

Podsumowujc, chocia偶 zar贸wno Punkty kocowe usugi, jak i Prywatne Linki zapewniaj bezpieczne poczenie z usugami Azure, **Prywatne Linki oferuj wy偶szy poziom izolacji i bezpieczestwa, zapewniajc, 偶e usugi s dostpne prywatnie bez ich wystawiania na publiczny internet**. Punkty kocowe usugi z kolei s atwiejsze do skonfigurowania w og贸lnych przypadkach, gdy wymagane jest proste, bezpieczne dostp do usug Azure bez koniecznoci posiadania prywatnego IP w VNet.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** to skalowalne i bezpieczne wejcie dla **szybkiego dostarczania** globalnych aplikacji internetowych. **czy** r贸偶ne usugi, takie jak globalne **rozdzia obci偶enia, przyspieszenie witryny, odbieranie SSL oraz zdolnoci zapory aplikacji internetowej (WAF)** w jedn usug. Azure Front Door zapewnia inteligentne kierowanie na podstawie **najbli偶szej lokalizacji krawdziowej dla u偶ytkownika**, zapewniajc optymaln wydajno i niezawodno. Dodatkowo oferuje kierowanie oparte na adresach URL, hosting wielu witryn, powizanie sesji oraz bezpieczestwo warstwy aplikacji.

**Azure Front Door WAF** zosta zaprojektowany, aby **chroni aplikacje internetowe przed atakami internetowymi** bez koniecznoci modyfikacji kodu backendowego. Obejmuje niestandardowe reguy i zarzdzane zestawy regu w celu ochrony przed zagro偶eniami, takimi jak wstrzyknicie SQL, ataki typu cross-site scripting i inne powszechne ataki.

### **Przykad**

* Wyobra藕 sobie, 偶e masz globalnie rozproszon aplikacj z u偶ytkownikami z caego wiata. Mo偶esz u偶y Azure Front Door do **kierowania 偶da u偶ytkownik贸w do najbli偶szego regionalnego centrum danych**, w kt贸rym hostowana jest Twoja aplikacja, zmniejszajc w ten spos贸b op贸藕nienia, poprawiajc dowiadczenie u偶ytkownika i **chronic j przed atakami internetowymi za pomoc zdolnoci WAF**. Jeli okrelony region dowiadcza przestoju, Azure Front Door mo偶e automatycznie przekierowa ruch do najlepszego dostpnego miejsca, zapewniajc wysok dostpno.

### Wyliczenie

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway i Azure Application Gateway WAF

Azure Application Gateway to **bilans obci偶enia ruchem sieciowym** umo偶liwiajcy zarzdzanie ruchem do Twoich **aplikacji internetowych**. Oferuje **bilansowanie obci偶enia warstwy 7, zakoczenie SSL oraz zdolnoci zapory aplikacji internetowej (WAF)** w kontrolerze dostarczania aplikacji (ADC) jako usuga. Kluczowe funkcje obejmuj trasowanie oparte na adresie URL, powizanie sesji oparte na plikach cookie oraz odbieranie warstwy bezpiecznych gniazd (SSL), kt贸re s kluczowe dla aplikacji wymagajcych zo偶onych zdolnoci bilansowania obci偶enia, takich jak globalne trasowanie i trasowanie oparte na cie偶ce.

### Przykad

* Rozwa偶 scenariusz, w kt贸rym masz stron internetow e-commerce, kt贸ra obejmuje wiele subdomen dla r贸偶nych funkcji, takich jak konta u偶ytkownik贸w i przetwarzanie patnoci. Azure Application Gateway mo偶e **kierowa ruch do odpowiednich serwer贸w internetowych na podstawie cie偶ki URL**. Na przykad ruch do `example.com/accounts` mo偶e by kierowany do usugi kont u偶ytkownik贸w, a ruch do `example.com/pay` mo偶e by kierowany do usugi przetwarzania patnoci.\
I **chroni Twoj stron internetow przed atakami, korzystajc z mo偶liwoci WAF.**

### **Wyliczanie**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** to funkcja sieciowa w Azure, kt贸ra **pozwala na bezporednie i pynne poczenie r贸偶nych wirtualnych sieci (VNets)**. Dziki VNet peering, zasoby w jednej VNet mog komunikowa si z zasobami w innej VNet, korzystajc z prywatnych adres贸w IP, **tak jakby byy w tej samej sieci**.\
**VNet Peering mo偶na r贸wnie偶 u偶ywa z sieciami lokalnymi** poprzez skonfigurowanie VPN typu site-to-site lub Azure ExpressRoute.

**Azure Hub and Spoke** to topologia sieciowa u偶ywana w Azure do zarzdzania i organizowania ruchu sieciowego. **"Hub" to centralny punkt kontrolujcy i kierujcy ruchem midzy r贸偶nymi "spokes"**. Hub zazwyczaj zawiera wsp贸dzielone usugi, takie jak wirtualne urzdzenia sieciowe (NVAs), brama VPN Azure, zapora Azure lub Bastion Azure. **"Spokes" to VNets, kt贸re hostuj obci偶enia robocze i cz si z hubem za pomoc VNet peering**, pozwalajc im korzysta z wsp贸dzielonych usug wewntrz huba. Ten model promuje czyteln struktur sieci, redukujc zo偶ono poprzez scentralizowanie wsp贸lnych usug, z kt贸rych mog korzysta r贸偶ne obci偶enia robocze w r贸偶nych VNets.

{% hint style="danger" %}
**VNET pairing nie jest przechodni w Azure**, co oznacza, 偶e jeli spoke 1 jest poczony z spoke 2, a spoke 2 jest poczony z spoke 3, to spoke 1 nie mo偶e bezporednio rozmawia z spoke 3.
{% endhint %}

### Przykady

* Wyobra藕 sobie firm z oddzielnymi dziaami, takimi jak Sprzeda偶, HR i Rozw贸j, **ka偶dy z wasn VNet (spokes)**. Te VNety **potrzebuj dostpu do wsp贸dzielonych zasob贸w**, takich jak centralna baza danych, zapora sieciowa i brama internetowa, kt贸re znajduj si w **innym VNet (hub)**. Korzystajc z modelu Hub and Spoke, ka偶dy dzia mo偶e **bezpiecznie czy si z wsp贸dzielonymi zasobami poprzez hub VNet, bez ujawniania tych zasob贸w publicznemu internetowi** ani tworzenia zo偶onej struktury sieci z liczbnymi poczeniami.

### Wyliczenie

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## VPN typu Site-to-Site

VPN typu Site-to-Site w Azure pozwala na **poczenie sieci lokalnej z sieci wirtualn Azure (VNet)**, umo偶liwiajc zasobom takim jak maszyny wirtualne w Azure wydawa si, 偶e znajduj si w sieci lokalnej. Poczenie to jest nawizywane za pomoc **bramy VPN, kt贸ra szyfruje ruch** midzy dwiema sieciami.

### **Przykad**

* Firma z g贸wn siedzib w Nowym Jorku posiada centrum danych on-premises, kt贸re musi bezpiecznie poczy si z VNet w Azure, gdzie znajduj si jej wirtualne obci偶enia. Konfigurujc **VPN typu Site-to-Site, firma mo偶e zapewni zaszyfrowane poczenie midzy serwerami on-premises a maszynami wirtualnymi w Azure**, umo偶liwiajc bezpieczny dostp do zasob贸w w obu rodowiskach, jak gdyby byy w tej samej sieci lokalnej.

### **Wyliczanie**
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute to usuga, kt贸ra zapewnia **prywatne, dedykowane, wysokoprzepustowe poczenie midzy infrastruktur lokaln a centrami danych Azure**. Poczenie to jest realizowane za porednictwem dostawcy cznoci, omijajc publiczny internet i oferujc wiksz niezawodno, szybsze prdkoci, ni偶sze op贸藕nienia i wy偶sze bezpieczestwo ni偶 typowe poczenia internetowe.

### **Przykad**

* Midzynarodowa korporacja wymaga **staego i niezawodnego poczenia do swoich usug Azure ze wzgldu na du偶y wolumen danych** i potrzeb wysokiej przepustowoci. Firma decyduje si na usug Azure ExpressRoute, aby bezporednio poczy sw贸j lokalny centrum danych z Azure, uatwiajc transfer du偶ej iloci danych, takich jak codzienne kopie zapasowe i analiza danych w czasie rzeczywistym, z zwikszon prywatnoci i szybkoci.

### **Wyliczanie**
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLANY SUBSKRYPCYJNE**](https://github.com/sponsors/carlospolop)!
* Kup [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
