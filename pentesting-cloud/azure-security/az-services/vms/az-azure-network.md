# Az - Azure Network

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

Sieci w Azure dziaaj jako integralna cz jej platformy obliczeniowej w chmurze, umo偶liwiajc **poczenie i komunikacj midzy r贸偶nymi usugami i zasobami Azure**. Architektura sieciowa w Azure zostaa zaprojektowana tak, aby bya wysoce skalowalna, bezpieczna i dostosowywalna.

W centrum Azure znajduje si **wirtualna sie (VNet)**, kt贸ra umo偶liwia u偶ytkownikom tworzenie **izolowanych** **sieci** w chmurze Azure. W ramach tych VNet-贸w mo偶na bezpiecznie hostowa i zarzdza zasobami takimi jak wirtualne maszyny, aplikacje i bazy danych. Sie w Azure obsuguje zar贸wno komunikacj wewntrz chmury (midzy usugami Azure), jak i poczenie z zewntrznymi sieciami i internetem.

**Bezpieczestwo** jest istotnym aspektem sieci Azure, z r贸偶nymi narzdziami i usugami dostpnymi do ochrony danych, zarzdzania dostpem i zapewnienia zgodnoci. rodki bezpieczestwa te obejmuj **firewalle**, **grupy zabezpiecze sieciowych** i mo偶liwoci **szyfrowania**, umo偶liwiajc wysoki poziom kontroli nad ruchem i dostpem.

Og贸lnie rzecz biorc, mo偶liwoci sieciowe Azure s projektowane tak, aby oferowa elastyczno, umo偶liwiajc u偶ytkownikom tworzenie rodowiska sieciowego, kt贸re odpowiada ich konkretnym potrzebom aplikacji i obci偶enia, jednoczenie zachowujc silne naciski na bezpieczestwo i niezawodno.

## Wirtualna sie (VNET) i podsieci

VNet w Azure jest w zasadzie reprezentacj Twojej wasnej sieci w chmurze. Jest to **logiczna izolacja chmury Azure dedykowana Twojej subskrypcji**. VNet umo偶liwia tworzenie i zarzdzanie wirtualnymi sieciami prywatnymi (VPN) w Azure i mo偶e by u偶ywany do hostowania i **zarzdzania wieloma rodzajami zasob贸w Azure**, takimi jak wirtualne maszyny (VM), bazy danych i usugi aplikacyjne.

VNety umo偶liwiaj **pen kontrol nad ustawieniami sieci**, w tym zakresami **adres贸w IP**, tworzeniem podsieci, tabelami trasowania i bramkami sieciowymi.

**Podsie** to **zakres adres贸w IP w Twoim VNet**. Mo偶esz podzieli VNet na wiele podsieci w celu organizacji i zabezpieczenia. Ka偶da podsie w VNet mo偶e by u偶ywana do izolowania i grupowania zasob贸w zgodnie z architektur Twojej sieci i aplikacji.

Ponadto, podsieci pozwalaj na **segmentacj Twojego VNet na jedn lub wicej podsieci**, zapewniajc zakres adres贸w IP, kt贸re zasoby mog u偶ywa.

### **Przykad**

* Za贸偶my, 偶e masz VNet o nazwie `MyVNet` z zakresem adres贸w IP `10.0.0.0/16`. Mo偶esz utworzy podsie w ramach tego VNetu, powiedzmy `Subnet-1`, z zakresem adres贸w IP `10.0.0.0/24` do hostowania serwer贸w WWW. Inna podsie, `Subnet-2` o zakresie `10.0.1.0/24`, mo偶e by u偶ywana do serwer贸w baz danych. Ta segmentacja umo偶liwia efektywne zarzdzanie i kontrol bezpieczestwa w ramach sieci.

### Wyliczanie

Aby wywietli wszystkie VNety i podsieci w koncie Azure, mo偶na u偶y interfejsu wiersza polece Azure (CLI). Oto kroki:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
## Grupy zabezpiecze sieciowych (NSG)

W Azure **Network Security Group (NSG)** peni g贸wn funkcj filtrowania ruchu sieciowego zar贸wno do, jak i z zasob贸w Azure w ramach wirtualnej sieci Azure (VNet). Zawiera zestaw **regu zabezpiecze**, kt贸re skrupulatnie okrelaj przepyw ruchu sieciowego.

Kluczowe aspekty NSG obejmuj:

- **Kontrola ruchu**: Ka偶da NSG zawiera reguy, kt贸re s instrumentalne w zezwalaniu lub blokowaniu ruchu sieciowego przychodzcego i wychodzcego z r贸偶nych zasob贸w Azure.
- **Skadniki regu**: Reguy w ramach NSG s bardzo szczeg贸owe, filtrowanie ruchu oparte jest na kryteriach takich jak adres IP 藕r贸da/destynacji, port i protok贸. Ta szczeg贸owo umo偶liwia precyzyjne zarzdzanie ruchem sieciowym.
- **Wzmacnianie zabezpiecze**: Poprzez zapewnienie, 偶e tylko autoryzowany ruch mo偶e wchodzi lub wychodzi z zasob贸w Azure, NSG odgrywaj kluczow rol w wzmacnianiu bezpieczestwa infrastruktury sieciowej.

### **Przykad**

* Wyobra藕 sobie, 偶e masz NSG o nazwie `MyNSG` zastosowan do podsieci lub konkretnego wirtualnego komputera w Twojej VNet. Mo偶esz tworzy reguy takie jak:
* Regua przychodzca, kt贸ra zezwala na ruch HTTP (port 80) z dowolnego 藕r贸da do Twoich serwer贸w WWW.
* Regua wychodzca, kt贸ra zezwala tylko na ruch SQL (port 1433) do okrelonego zakresu adres贸w IP docelowych.

### Wyliczanie

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
## Azure Firewall

Azure Firewall to zarzdzana, oparta na chmurze **usuga bezpieczestwa sieciowego, kt贸ra chroni zasoby wirtualnej sieci Azure**. Jest to penowartociowy, zarzdzany jako usuga firewall z wbudowanymi funkcjami wysokiej dostpnoci i skalowalnoci.

Azure Firewall oferuje **bardziej zaawansowane** funkcje ni偶 **NSG**, w tym filtrowanie na poziomie aplikacji, filtrowanie na poziomie sieci, filtrowanie oparte na inteligencji zagro偶e oraz integracj z Azure Monitor w celu logowania i analizy.\
Mo偶e filtrowa ruch wychodzcy, przychodzcy, midzy strefami, ruch VPN i ExpressRoute. **Reguy firewalla mog by tworzone na podstawie FQDN (Fully Qualified Domain Name), adres贸w IP i port贸w**.

### R贸偶nice midzy Azure Firewall a NSGs&#x20;

1. **Zakres:**
* **NSG:** Dziaa na poziomie podsieci lub interfejsu sieciowego. Ma na celu zapewnienie podstawowego filtrowania ruchu przychodzcego i wychodzcego z interfejs贸w sieciowych (NIC), maszyn wirtualnych lub podsieci.
* **Azure Firewall:** Dziaa na poziomie VNet, zapewniajc szerszy zakres ochrony. Zosta zaprojektowany do zabezpieczania zasob贸w wirtualnej sieci i zarzdzania ruchem wchodzcym i wychodzcym z VNet.
2. **Mo偶liwoci:**
* **NSG:** Oferuje podstawowe mo偶liwoci filtrowania oparte na adresie IP, porcie i protokole. Nie obsuguje zaawansowanych funkcji, takich jak kontrola na poziomie aplikacji lub inteligencja zagro偶e.
* **Azure Firewall:** Oferuje zaawansowane funkcje, takie jak filtrowanie ruchu na poziomie aplikacji (warstwa 7), filtrowanie oparte na inteligencji zagro偶e, filtrowanie ruchu sieciowego i wiele innych. Obsuguje r贸wnie偶 wiele publicznych adres贸w IP.
3. **Przypadki u偶ycia:**
* **NSG:** Idealny do podstawowego filtrowania ruchu na poziomie sieci.
* **Azure Firewall:** Nadaje si do bardziej zaawansowanych scenariuszy filtrowania, w kt贸rych wymagana jest kontrola na poziomie aplikacji, logowanie i inteligencja zagro偶e.
4. **Zarzdzanie i monitorowanie:**
* **NSG:** Oferuje podstawowe logowanie i integracj z Azure Monitor.
* **Azure Firewall:** Zapewnia zaawansowane mo偶liwoci logowania i analizy za pomoc Azure Monitor, co jest niezbdne do zrozumienia charakteru i wzorca ruchu.

### Wyliczanie

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
## Wirtualne urzdzenie sieciowe (NVA)

Wirtualne urzdzenie sieciowe (**NVA**) w Azure to wirtualne urzdzenie, kt贸re **wykonuje funkcje sieciowe w ramach wirtualnej sieci**. NVA s zwykle u偶ywane do funkcji sieciowych, kt贸re **nie s dostpne natywnie** w Azure lub gdy wymagana jest wiksza dostosowalno. S to w zasadzie **maszyny wirtualne, kt贸re uruchamiaj aplikacje lub usugi sieciowe**, takie jak zapory ogniowe, optymalizatory WAN lub r贸wnowa偶niki obci偶enia.

NVA s u偶ywane do zada zwizanych z **zaawansowanym routowaniem**, **bezpieczestwem** i **zarzdzaniem ruchem sieciowym**. Mog by wdra偶ane z **Azure Marketplace**, gdzie wielu dostawc贸w zewntrznych oferuje swoje urzdzenia gotowe do integracji z rodowiskami Azure.

### **Przykad**

* Organizacja mo偶e wdro偶y NVA w Azure, aby stworzy **niestandardowe rozwizanie zapory ogniowej**. To NVA mo偶e uruchamia **oprogramowanie zapory ogniowej innych dostawc贸w**, zapewniajc zaawansowane funkcje, takie jak wykrywanie wama, inspekcja pakiet贸w lub czno VPN. NVA mo偶na skonfigurowa do inspekcji i filtrowania ruchu przechodzcego przez niego, zapewniajc wzmocnione rodki bezpieczestwa zgodnie z politykami organizacji.

### **Wyliczanie**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
## Tabele trasowania Azure i Trasy zdefiniowane przez u偶ytkownika (UDR)

**Tabele trasowania Azure** to funkcja w ramach Microsoft Azure, kt贸ra umo偶liwia **kontrol trasowania ruchu sieciowego w ramach Wirtualnych Sieci Azure (VNets)**. W zasadzie, definiuj one, jak **pakiety** s **przekazywane** midzy podsieciami w ramach VNets, midzy VNets lub do sieci zewntrznych. Ka偶da tabela trasowania zawiera zestaw regu, zwanych trasami, kt贸re okrelaj, jak pakiety powinny by kierowane na podstawie ich docelowych adres贸w IP.

**Trasy zdefiniowane przez u偶ytkownika (UDR)** w Azure to **niestandardowe trasy, kt贸re tworzysz w ramach tabel trasowania Azure**, aby kontrolowa **przepyw ruchu sieciowego** wewntrz i midzy Wirtualnymi Sieciami Azure (VNets) oraz do pocze zewntrznych. UDR umo偶liwiaj elastyczne kierowanie ruchem sieciowym zgodnie z okrelonymi wymaganiami, zastpujc domylne decyzje dotyczce trasowania w Azure.

Te trasy s szczeg贸lnie przydatne w scenariuszach, w kt贸rych musisz **kierowa ruchem przez wirtualne urzdzenie**, narzuci okrelon cie偶k dla cel贸w bezpieczestwa lub zgodnoci z polityk, lub zintegrowa si z sieciami lokalnymi.

### **Przykad**

* Za贸偶my, 偶e wdro偶ye Wirtualne Urzdzenie Sieciowe (NVA), kt贸re ma sprawdza ruch midzy podsieciami w ramach VNet. Mo偶esz utworzy UDR, kt贸ry kieruje cay ruch z jednej podsieci do drugiej przez NVA. Ten UDR zapewnia, 偶e NVA sprawdza ruch w celach bezpieczestwa przed dotarciem do celu.

### **Wyliczanie**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link to usuga w Azure, kt贸ra **umo偶liwia prywatny dostp do usug Azure**, zapewniajc, 偶e **ruch midzy wirtualn sieci Azure (VNet) a usug odbywa si cakowicie w sieci rdzennej Azure firmy Microsoft**. Efektywnie przenosi usug do Twojej VNet. Ta konfiguracja zwiksza bezpieczestwo, nie wystawiajc danych na publiczne internet.

Private Link mo偶na u偶ywa z r贸偶nymi usugami Azure, takimi jak Azure Storage, Azure SQL Database i niestandardowymi usugami udostpnianymi za porednictwem Private Link. Zapewnia on bezpieczny spos贸b korzystania z usug z wasnej VNet lub nawet z r贸偶nych subskrypcji Azure.

{% hint style="danger" %}
NSG nie ma zastosowania do prywatnych punkt贸w kocowych, co jasno oznacza, 偶e przypisanie NSG do podsieci zawierajcej Private Link nie bdzie miao 偶adnego efektu.
{% endhint %}

### **Przykad**

* Rozwa偶my scenariusz, w kt贸rym masz **Azure SQL Database, do kt贸rego chcesz mie bezpieczny dostp z Twojej VNet**. Normalnie, mogoby to wymaga przejcia przez publiczny internet. Dziki Private Link mo偶esz utworzy **prywatny punkt kocowy w Twojej VNet**, kt贸ry czy si bezporednio z usug Azure SQL Database. Ten punkt kocowy sprawia, 偶e baza danych wydaje si by czci Twojej wasnej VNet, dostpn za pomoc prywatnego adresu IP, zapewniajc tym samym bezpieczny i prywatny dostp.

### **Wyliczenie**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
## Usugi punkt贸w kocowych Azure

Usugi punkt贸w kocowych Azure rozszerzaj prywatn przestrze adresow wirtualnej sieci oraz to偶samo Twojej VNet do usug Azure poprzez bezporednie poczenie. Wczajc punkty kocowe usug, **zasoby w Twojej VNet mog bezpiecznie czy si z usugami Azure**, takimi jak Azure Storage i Azure SQL Database, korzystajc z sieci rdzenia Azure. Zapewnia to, 偶e **ruch z VNet do usugi Azure pozostaje w obrbie sieci Azure**, co zapewnia bardziej bezpieczn i niezawodn cie偶k.

### **Przykad**

* Na przykad, konto **Azure Storage** domylnie jest dostpne przez publiczny internet. Wczajc **punkt kocowy usugi dla Azure Storage w Twojej VNet**, mo偶esz zapewni, 偶e tylko ruch z Twojej VNet ma dostp do konta magazynu. Zapora konta magazynu mo偶e by nastpnie skonfigurowana tak, aby akceptowa tylko ruch z Twojej VNet.

### **Wyliczanie**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### R贸偶nice midzy punktami kocowymi usugi a prywatnymi linkami

Microsoft zaleca korzystanie z prywatnych link贸w w [**dokumentacji**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\


<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Punkty kocowe usugi:**

* Ruch z Twojej sieci wirtualnej do usugi Azure odbywa si przez sie centraln Microsoft Azure, omijajc publiczny internet.
* Punkt kocowy to bezporednie poczenie z usug Azure i nie zapewnia prywatnego adresu IP dla usugi w ramach sieci wirtualnej.
* Usuga jest nadal dostpna za porednictwem swojego publicznego punktu kocowego spoza Twojej sieci wirtualnej, chyba 偶e skonfigurujesz zapor usugi w celu blokowania takiego ruchu.
* Jest to relacja jeden do jednego midzy podsieci a usug Azure.
* Mniej kosztowne ni偶 prywatne linki.

**Prywatne linki:**

* Prywatny link mapuje usugi Azure do Twojej sieci wirtualnej za porednictwem prywatnego punktu kocowego, kt贸ry jest interfejsem sieciowym z prywatnym adresem IP w Twojej sieci wirtualnej.
* Usuga Azure jest dostpna za pomoc tego prywatnego adresu IP, co sprawia, 偶e wydaje si by czci Twojej sieci.
* Usugi poczone za pomoc prywatnego linku mo偶na uzyska tylko z Twojej sieci wirtualnej lub poczonych sieci; nie ma dostpu do usugi z publicznego internetu.
* Umo偶liwia bezpieczne poczenie z usugami Azure lub Twoimi wasnymi usugami hostowanymi w Azure, a tak偶e poczenie z usugami udostpnianymi przez innych.
* Zapewnia bardziej szczeg贸ow kontrol dostpu za porednictwem prywatnego punktu kocowego w Twojej sieci wirtualnej, w przeciwiestwie do szerszej kontroli dostpu na poziomie podsieci za pomoc punkt贸w kocowych usugi.

Podsumowujc, chocia偶 zar贸wno punkty kocowe usugi, jak i prywatne linki zapewniaj bezpieczne poczenie z usugami Azure, **prywatne linki oferuj wy偶szy poziom izolacji i bezpieczestwa, zapewniajc, 偶e usugi s dostpne prywatnie bez ich eksponowania w publicznym internecie**. Punkty kocowe usugi natomiast s atwiejsze do skonfigurowania w przypadkach og贸lnych, gdzie wymagane jest proste, bezpieczne dostp do usug Azure bez potrzeby prywatnego adresu IP w sieci wirtualnej.

## Azure Front Door (AFD) i AFD WAF

**Azure Front Door** to skalowalne i bezpieczne wejcie do **szybkiego dostarczania** globalnych aplikacji internetowych. **czy** r贸偶ne usugi, takie jak globalne **rozo偶enie obci偶enia, przyspieszenie witryny, rozadowanie SSL i zapora aplikacji internetowych (WAF)**, w jedn usug. Azure Front Door zapewnia inteligentne kierowanie na podstawie **najbli偶szego punktu kocowego do u偶ytkownika**, zapewniajc optymaln wydajno i niezawodno. Dodatkowo oferuje kierowanie oparte na adresie URL, hosting wielu witryn, powizanie sesji i zabezpieczenia na poziomie aplikacji.

**Azure Front Door WAF** zosta zaprojektowany w celu **ochrony aplikacji internetowych przed atakami opartymi na sieci web**, bez koniecznoci modyfikacji kodu backendowego. Zawiera niestandardowe reguy i zarzdzane zestawy regu, kt贸re chroni przed zagro偶eniami takimi jak wstrzyknicie SQL, ataki typu cross-site scripting i inne powszechne ataki.

### **Przykad**

* Wyobra藕 sobie, 偶e masz globalnie rozproszon aplikacj z u偶ytkownikami z caego wiata. Mo偶esz u偶y Azure Front Door, aby **kierowa 偶dania u偶ytkownik贸w do najbli偶szego regionalnego centrum danych**, w kt贸rym hostowana jest Twoja aplikacja, zmniejszajc tym samym op贸藕nienia, poprawiajc dowiadczenie u偶ytkownika i **chronic j przed atakami sieciowymi za pomoc funkcji WAF**. Jeli w okrelonym regionie wystpi awaria, Azure Front Door mo偶e automatycznie przekierowa ruch do nastpnego najlepszego miejsca, zapewniajc wysok dostpno.

### Wyliczanie

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
## Azure Application Gateway i Azure Application Gateway WAF

Azure Application Gateway to **balanser obci偶enia ruchu sieciowego** dla aplikacji **internetowych**, kt贸ry umo偶liwia zarzdzanie ruchem do Twoich aplikacji internetowych. Oferuje **balansowanie obci偶enia warstwy 7, zakoczenie SSL i mo偶liwoci zapory aplikacji internetowej (WAF)** w kontrolerze dostarczania aplikacji (ADC) jako usuga. Kluczowe funkcje obejmuj routowanie oparte na adresie URL, powizanie sesji oparte na plikach cookie i odbieranie warstwy bezpiecznych gniazd (SSL), kt贸re s niezbdne dla aplikacji wymagajcych zaawansowanych mo偶liwoci balansowania obci偶enia, takich jak globalne routowanie i routowanie oparte na cie偶ce.

### Przykad

* Rozwa偶my scenariusz, w kt贸rym masz stron internetow e-commerce, kt贸ra zawiera wiele subdomen dla r贸偶nych funkcji, takich jak konta u偶ytkownik贸w i przetwarzanie patnoci. Azure Application Gateway mo偶e **kierowa ruch do odpowiednich serwer贸w internetowych na podstawie cie偶ki URL**. Na przykad, ruch do `example.com/accounts` mo偶e by kierowany do usugi kont u偶ytkownik贸w, a ruch do `example.com/pay` mo偶e by kierowany do usugi przetwarzania patnoci.\
I **chroni Twoj stron internetow przed atakami, korzystajc z mo偶liwoci WAF.**

### **Wyliczanie**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** to funkcja sieciowa w Azure, kt贸ra **pozwala na bezporednie i pynne poczenie r贸偶nych wirtualnych sieci (VNets)**. Dziki VNet peering, zasoby w jednej VNet mog komunikowa si z zasobami w innej VNet za pomoc prywatnych adres贸w IP, **tak jakby byy w tej samej sieci**.\
**VNet Peering mo偶na r贸wnie偶 u偶ywa z sieciami lokalnymi** poprzez skonfigurowanie VPN typu site-to-site lub Azure ExpressRoute.

**Azure Hub and Spoke** to topologia sieciowa u偶ywana w Azure do zarzdzania i organizowania ruchu sieciowego. **"Hub" to centralny punkt kontrolujcy i kierujcy ruchem midzy r贸偶nymi "spokes"**. Hub zazwyczaj zawiera wsp贸dzielone usugi, takie jak wirtualne urzdzenia sieciowe (NVAs), brama VPN Azure, zapora Azure lub Azure Bastion. **"Spokes" to VNets, kt贸re hostuj obci偶enia i cz si z hubem za pomoc VNet peering**, co pozwala im korzysta z wsp贸dzielonych usug w ramach huba. Ten model promuje czyteln struktur sieci, redukujc zo偶ono poprzez scentralizowanie wsp贸lnych usug, z kt贸rych mog korzysta r贸偶ne obci偶enia w r贸偶nych VNets.

{% hint style="danger" %}
**VNET pairing nie jest przechodnie w Azure**, co oznacza, 偶e jeli spoke 1 jest poczony z spoke 2, a spoke 2 jest poczony z spoke 3, to spoke 1 nie mo偶e bezporednio rozmawia z spoke 3.
{% endhint %}

### Przykady

* Wyobra藕 sobie firm z oddzielnymi dziaami, takimi jak Sprzeda偶, HR i Rozw贸j, **ka偶dy z wasn VNet (spokes)**. Te VNets **wymagaj dostpu do wsp贸dzielonych zasob贸w**, takich jak centralna baza danych, zapora sieciowa i brama internetowa, kt贸re znajduj si w **innym VNet (hub)**. Korzystajc z modelu Hub and Spoke, ka偶dy dzia mo偶e **bezpiecznie czy si z wsp贸dzielonymi zasobami za porednictwem huba VNet, bez ujawniania tych zasob贸w publicznemu internetowi** lub tworzenia zo偶onej struktury sieciowej z liczba pocze.

### Wyliczanie

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
## Site-to-Site VPN

Site-to-Site VPN w Azure umo偶liwia **poczenie sieci lokalnej z sieci wirtualn Azure (VNet)**, co pozwala na to, 偶e zasoby takie jak maszyny wirtualne w Azure wydaj si by na lokalnej sieci. Poczenie to jest nawizywane za pomoc **bramy VPN, kt贸ra szyfruje ruch** midzy dwiema sieciami.

### **Przykad**

* Firma z g贸wn siedzib w Nowym Jorku posiada centrum danych na miejscu, kt贸re musi bezpiecznie poczy si z VNet w Azure, gdzie znajduj si jej wirtualizowane obci偶enia. Ustawiajc **Site-to-Site VPN, firma mo偶e zapewni szyfrowane poczenie midzy serwerami na miejscu a maszynami wirtualnymi Azure**, umo偶liwiajc bezpieczny dostp do zasob贸w w obu rodowiskach, tak jakby byy w tej samej lokalnej sieci.

### **Wyliczanie**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
## Azure ExpressRoute

Azure ExpressRoute to usuga, kt贸ra zapewnia **prywatne, dedykowane, szybkie poczenie midzy Twoj infrastruktur lokaln a centrami danych Azure**. To poczenie jest realizowane za porednictwem dostawcy cznoci, omijajc publiczny internet i oferujc wiksz niezawodno, szybsze prdkoci, ni偶sze op贸藕nienia i wy偶sze bezpieczestwo w por贸wnaniu do typowych pocze internetowych.

### **Przykad**

* Midzynarodowa korporacja wymaga **staego i niezawodnego poczenia z usugami Azure ze wzgldu na du偶 ilo danych** i potrzeb wysokiej przepustowoci. Firma decyduje si na Azure ExpressRoute, aby bezporednio poczy swoje centrum danych lokalne z Azure, uatwiajc przesyanie danych w du偶ych ilociach, takie jak codzienne kopie zapasowe i analiza danych w czasie rzeczywistym, zwikszajc prywatno i prdko.

### **Wyliczanie**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>Naucz si hakowa AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeli chcesz zobaczy swoj **firm reklamowan w HackTricks** lub **pobra HackTricks w formacie PDF**, sprawd藕 [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobd藕 [**oficjalne gad偶ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzin PEASS**](https://opensea.io/collection/the-peass-family), nasz kolekcj ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si swoimi sztuczkami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
