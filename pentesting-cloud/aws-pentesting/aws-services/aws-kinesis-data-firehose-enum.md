# AWS - Enumeraci贸n de Kinesis Data Firehose

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop).
* Obt茅n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>

## Kinesis Data Firehose

Amazon Kinesis Data Firehose es un servicio **totalmente administrado para la entrega de datos en tiempo real** [**de transmisi贸n**](http://www.amazonaws.cn/streaming-data/) **a destinos** como Amazon Simple Storage Service (Amazon S3), Amazon Redshift, Amazon OpenSearch Service, Splunk y cualquier punto final HTTP personalizado.\
Con Kinesis Data Firehose, no es necesario escribir aplicaciones ni administrar recursos. **Configuras tus productores de datos** para enviar datos a Kinesis Data Firehose, y este **entrega autom谩ticamente los datos al destino** que especificaste. Tambi茅n puedes configurar Kinesis Data Firehose **para transformar tus datos antes de entregarlos**.

### Enumeraci贸n
```bash
# Get delivery streams
aws firehose list-delivery-streams

#Get stream info
aws firehose describe-delivery-stream --delivery-stream-name <name>
## Get roles
aws firehose describe-delivery-stream --delivery-stream-name <name> | grep -i RoleARN
```
## Post-explotaci贸n / Evadir la defensa

En caso de que firehose se utilice para enviar registros o informaci贸n de defensa, utilizando estas funcionalidades, un atacante podr铆a evitar que funcione correctamente.

### firehose:DeleteDeliveryStream
```
aws firehose delete-delivery-stream --delivery-stream-name <value> --allow-force-delete
```
### firehose:UpdateDestination

La acci贸n `firehose:UpdateDestination` permite a un usuario actualizar la configuraci贸n de un destino en un flujo de datos de Amazon Kinesis Data Firehose. Esto incluye la actualizaci贸n de la configuraci贸n de entrega, como el destino de entrega, el formato de datos y las transformaciones de datos.

#### Sintaxis

El siguiente es un ejemplo de la sintaxis de la pol铆tica de IAM para permitir la acci贸n `firehose:UpdateDestination`:

```markdown
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "firehose:UpdateDestination",
            "Resource": "arn:aws:firehose:region:account-id:deliverystream/stream-name"
        }
    ]
}
```

#### Descripci贸n

La acci贸n `firehose:UpdateDestination` se utiliza para actualizar la configuraci贸n de un destino en un flujo de datos de Amazon Kinesis Data Firehose. Esto puede incluir la actualizaci贸n del destino de entrega, el formato de datos y las transformaciones de datos.

Para utilizar esta acci贸n, el usuario debe tener permisos de IAM para ejecutarla. Adem谩s, el usuario debe especificar el ARN del flujo de datos y el nombre del destino que se va a actualizar.

#### Ejemplo

El siguiente ejemplo muestra c贸mo utilizar la acci贸n `firehose:UpdateDestination` para actualizar la configuraci贸n de un destino en un flujo de datos de Amazon Kinesis Data Firehose:

```markdown
aws firehose update-destination --delivery-stream-name stream-name --current-delivery-stream-version-id version-id --destination-id destination-id --s3-destination-configuration RoleARN=role-arn,BucketARN=bucket-arn,Prefix=prefix
```

En este ejemplo, se utiliza el comando `aws firehose update-destination` para actualizar la configuraci贸n de un destino en un flujo de datos de Amazon Kinesis Data Firehose. Se especifica el nombre del flujo de datos, la versi贸n actual del flujo de datos, el ID del destino y la configuraci贸n del destino de entrega.
```
aws firehose update-destination --delivery-stream-name <value> --current-delivery-stream-version-id <value> --destination-id <value>
```
### firehose:PutRecord | firehose:PutRecordBatch

El m茅todo `firehose:PutRecord` permite a un usuario agregar un solo registro a un flujo de datos de Amazon Kinesis Data Firehose. El registro puede tener un tama帽o m谩ximo de 1 MB.

El m茅todo `firehose:PutRecordBatch` permite a un usuario agregar m煤ltiples registros a un flujo de datos de Amazon Kinesis Data Firehose en una sola llamada. Cada lote de registros puede tener un tama帽o m谩ximo de 4 MB o hasta 500 registros, lo que ocurra primero.

Estos m茅todos son importantes de tener en cuenta durante una evaluaci贸n de seguridad de Amazon Kinesis Data Firehose, ya que pueden ser utilizados para enviar datos maliciosos o sensibles a un flujo de datos. Un atacante podr铆a intentar enviar registros falsificados o manipulados para afectar la integridad de los datos o para realizar un ataque de denegaci贸n de servicio.

Durante una prueba de penetraci贸n en Amazon Kinesis Data Firehose, es recomendable verificar si se han implementado controles adecuados para prevenir el env铆o de registros maliciosos o manipulados. Tambi茅n es importante revisar las pol铆ticas de acceso y los permisos asignados a los usuarios para asegurarse de que solo se les permita realizar operaciones leg铆timas en los flujos de datos.
```
aws firehose put-record --delivery-stream-name my-stream --record '{"Data":"SGVsbG8gd29ybGQ="}'

aws firehose put-record-batch --delivery-stream-name my-stream --records file://records.json
```
## Referencias

* [https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html](https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html)

<details>

<summary><strong>隆Apoya a HackTricks y obt茅n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **煤ltima versi贸n de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIN**](https://github.com/sponsors/carlospolop).
* Obt茅n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci贸n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s铆gueme** en **Twitter**  [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>
