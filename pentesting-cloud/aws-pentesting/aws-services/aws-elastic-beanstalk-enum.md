# AWS - Elastic Beanstalk Enum

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## Elastic Beanstalk

Amazon Elastic Beanstalk fornece uma plataforma simplificada para **implantar, gerenciar e dimensionar aplicativos e servi√ßos web**. Ele suporta uma variedade de linguagens de programa√ß√£o e estruturas, como Java, .NET, PHP, Node.js, Python, Ruby e Go, bem como cont√™ineres Docker. O servi√ßo √© compat√≠vel com servidores amplamente utilizados, incluindo Apache, Nginx, Passenger e IIS.

O Elastic Beanstalk fornece uma maneira simples e flex√≠vel de **implantar seus aplicativos na nuvem da AWS**, sem a necessidade de se preocupar com a infraestrutura subjacente. Ele **manipula automaticamente** os detalhes de **provisionamento de capacidade**, **balanceamento de carga**, **dimensionamento** e **monitoramento de sa√∫de do aplicativo**, permitindo que voc√™ se concentre em escrever e implantar seu c√≥digo.

A infraestrutura criada pelo Elastic Beanstalk √© gerenciada por Grupos de **Autoscaling** no **EC2** (com um balanceador de carga). O que significa que, no final do dia, se voc√™ **comprometer o host**, voc√™ deve saber sobre o EC2:

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

Al√©m disso, se o Docker for usado, √© poss√≠vel usar **ECS**.

{% content-ref url="../../aws-security/aws-services/aws-eks-enum.md" %}
[aws-eks-enum.md](../../aws-security/aws-services/aws-eks-enum.md)
{% endcontent-ref %}

### Aplicativo e Ambientes

No AWS Elastic Beanstalk, os conceitos de "aplicativo" e "ambiente" servem a prop√≥sitos diferentes e t√™m pap√©is distintos no processo de implanta√ß√£o.

#### Aplicativo

* Um aplicativo no Elastic Beanstalk √© um **cont√™iner l√≥gico para o c√≥digo-fonte do seu aplicativo, ambientes e configura√ß√µes**. Ele agrupa diferentes vers√µes do c√≥digo do seu aplicativo e permite gerenci√°-los como uma √∫nica entidade.
* Quando voc√™ cria um aplicativo, fornece um nome e uma descri√ß√£o, mas **nenhum recurso √© provisionado** nesta etapa. √â simplesmente uma maneira de organizar e gerenciar seu c√≥digo e recursos relacionados.
* Voc√™ pode ter **m√∫ltiplas vers√µes de aplicativos** dentro de um aplicativo. Cada vers√£o corresponde a um lan√ßamento espec√≠fico do seu c√≥digo, que pode ser implantado em um ou mais ambientes.

#### Ambiente

* Um ambiente √© uma **inst√¢ncia provisionada do seu aplicativo** em execu√ß√£o na infraestrutura da AWS. √â **onde o c√≥digo do seu aplicativo √© implantado e executado**. O Elastic Beanstalk provisiona os recursos necess√°rios (por exemplo, inst√¢ncias EC2, balanceadores de carga, grupos de dimensionamento autom√°tico, bancos de dados) com base na configura√ß√£o do ambiente.
* **Cada ambiente executa uma √∫nica vers√£o do seu aplicativo**, e voc√™ pode ter v√°rios ambientes para diferentes fins, como desenvolvimento, teste, staging e produ√ß√£o.
* Ao criar um ambiente, voc√™ escolhe uma plataforma (por exemplo, Java, .NET, Node.js, etc.) e um tipo de ambiente (por exemplo, servidor web ou worker). Voc√™ tamb√©m pode personalizar a configura√ß√£o do ambiente para controlar v√°rios aspectos da infraestrutura e configura√ß√µes do aplicativo.

### 2 tipos de Ambientes

1. **Ambiente de Servidor Web**: √â projetado para **hospedar e servir aplicativos web e APIs**. Esses aplicativos normalmente lidam com solicita√ß√µes HTTP/HTTPS recebidas. O ambiente do servidor web provisiona recursos como **inst√¢ncias EC2, balanceadores de carga e grupos de dimensionamento autom√°tico** para lidar com o tr√°fego recebido, gerenciar a capacidade e garantir a alta disponibilidade do aplicativo.
2. **Ambiente de Worker**: √â projetado para processar **tarefas em segundo plano**, que s√£o opera√ß√µes frequentemente demoradas ou intensivas em recursos que n√£o requerem respostas imediatas aos clientes. O ambiente de worker provisiona recursos como **inst√¢ncias EC2 e grupos de dimensionamento autom√°tico**, mas **n√£o possui um balanceador de carga** pois n√£o lida diretamente com solicita√ß√µes HTTP/HTTPS. Em vez disso, ele consome tarefas de uma **fila de Servi√ßo de Filas Simples da Amazon (SQS)**, que atua como um buffer entre o ambiente de worker e as tarefas que processa.

### Seguran√ßa

Ao criar um Aplicativo no Beanstalk, existem 3 op√ß√µes de seguran√ßa muito importantes a serem escolhidas:

* **Par de chaves EC2**: Esta ser√° a **chave SSH** que poder√° acessar as inst√¢ncias EC2 que executam o aplicativo
* **Perfil de inst√¢ncia IAM**: Este √© o **perfil de inst√¢ncia** que as inst√¢ncias ter√£o (**privil√©gios IAM**)
* O papel gerado automaticamente √© chamado **`aws-elasticbeanstalk-ec2-role`** e tem acesso interessante sobre todos ECS, todos SQS, DynamoDB elasticbeanstalk e elasticbeanstalk S3 usando as pol√≠ticas gerenciadas pela AWS: [AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier), [AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker), [AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier).
* **Papel de servi√ßo**: Este √© o **papel que o servi√ßo AWS** usar√° para executar todas as a√ß√µes necess√°rias. At√© onde sei, um usu√°rio regular da AWS n√£o pode acessar esse papel.
* Este papel gerado pela AWS √© chamado **`aws-elasticbeanstalk-service-role`** e usa as pol√≠ticas gerenciadas pela AWS [AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth) e [AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)

Por padr√£o, a **vers√£o de metadados 1 est√° desativada**:

<figure><img src="../../../.gitbook/assets/image (18) (1) (2).png" alt=""><figcaption></figcaption></figure>

### Exposi√ß√£o

Os dados do Beanstalk s√£o armazenados em um **bucket S3** com o seguinte nome: **`elasticbeanstalk-<regi√£o>-<id-conta>`**(se foi criado no console da AWS). Dentro deste bucket, voc√™ encontrar√° o **c√≥digo-fonte do aplicativo** enviado.

A **URL** da p√°gina da web criada √© **`http://<nome-do-aplicativo-web>-env.<aleat√≥rio>.<regi√£o>.elasticbeanstalk.com/`**

{% hint style="warning" %}
Se voc√™ obter **acesso de leitura** sobre o bucket, poder√° **ler o c√≥digo-fonte** e at√© encontrar **credenciais sens√≠veis** nele

se voc√™ obter **acesso de grava√ß√£o** sobre o bucket, voc√™ poderia **modificar o c√≥digo-fonte** para **comprometer** o **papel IAM** que o aplicativo est√° usando na pr√≥xima vez que for executado.
{% endhint %}

### Enumera√ß√£o

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
### Acesso n√£o autenticado

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### Persist√™ncia

{% content-ref url="../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### P√≥s-Explora√ß√£o

{% content-ref url="../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Aprenda hacking na AWS de zero a her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
