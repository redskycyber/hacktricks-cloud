# AWS - ç›®å½•æœåŠ¡ / WorkDocs æšä¸¾

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ PDF ç‰ˆçš„ HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## ç›®å½•æœåŠ¡

AWS Directory Service for Microsoft Active Directory æ˜¯ä¸€é¡¹æ‰˜ç®¡æœåŠ¡ï¼Œå¯åœ¨ AWS äº‘ä¸­è½»æ¾**è®¾ç½®ã€è¿è¡Œå’Œæ‰©å±•ç›®å½•**ã€‚å®ƒåŸºäºå®é™…çš„**Microsoft Active Directory**ï¼Œä¸å…¶ä»– AWS æœåŠ¡ç´§å¯†é›†æˆï¼Œä½¿æ‚¨èƒ½å¤Ÿè½»æ¾ç®¡ç†ä¸ç›®å½•ç›¸å…³çš„å·¥ä½œè´Ÿè½½å’Œ AWS èµ„æºã€‚ä½¿ç”¨ AWS æ‰˜ç®¡çš„ Microsoft ADï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç°æœ‰çš„ Active Directory ç”¨æˆ·ã€ç»„å’Œç­–ç•¥æ¥ç®¡ç†å¯¹ AWS èµ„æºçš„è®¿é—®ã€‚è¿™æœ‰åŠ©äºç®€åŒ–èº«ä»½ç®¡ç†ï¼Œå¹¶å‡å°‘å¯¹å…¶ä»–èº«ä»½è§£å†³æ–¹æ¡ˆçš„éœ€æ±‚ã€‚AWS æ‰˜ç®¡çš„ Microsoft AD è¿˜æä¾›è‡ªåŠ¨å¤‡ä»½å’Œç¾éš¾æ¢å¤åŠŸèƒ½ï¼Œæœ‰åŠ©äºç¡®ä¿ç›®å½•çš„å¯ç”¨æ€§å’Œè€ä¹…æ€§ã€‚æ€»ä½“è€Œè¨€ï¼ŒAWS Directory Service for Microsoft Active Directory å¯ä»¥é€šè¿‡åœ¨ AWS äº‘ä¸­æä¾›æ‰˜ç®¡ã€é«˜å¯ç”¨å’Œå¯æ‰©å±•çš„ Active Directory æœåŠ¡æ¥å¸®åŠ©æ‚¨èŠ‚çœæ—¶é—´å’Œèµ„æºã€‚

### é€‰é¡¹

ç›®å½•æœåŠ¡å…è®¸åˆ›å»º 5 ç§ç±»å‹çš„ç›®å½•ï¼š

* **AWS æ‰˜ç®¡çš„ Microsoft AD**ï¼šåœ¨ AWS ä¸­è¿è¡Œä¸€ä¸ªæ–°çš„**Microsoft AD**ã€‚æ‚¨å°†èƒ½å¤Ÿè®¾ç½®ç®¡ç†å‘˜å¯†ç å¹¶è®¿é—® VPC ä¸­çš„ DCã€‚
* **Simple AD**ï¼šè¿™å°†æ˜¯ä¸€ä¸ª**Linux-Samba**å…¼å®¹çš„ Active Directory æœåŠ¡å™¨ã€‚æ‚¨å°†èƒ½å¤Ÿè®¾ç½®ç®¡ç†å‘˜å¯†ç å¹¶è®¿é—® VPC ä¸­çš„ DCã€‚
* **AD è¿æ¥å™¨**ï¼šç”¨äºå°†ç›®å½•è¯·æ±‚é‡å®šå‘åˆ°ç°æœ‰çš„ Microsoft Active Directoryï¼Œè€Œä¸åœ¨äº‘ä¸­ç¼“å­˜ä»»ä½•ä¿¡æ¯çš„ä»£ç†ã€‚å®ƒå°†åœ¨ä¸€ä¸ª**VPC**ä¸­ç›‘å¬ï¼Œå¹¶ä¸”æ‚¨éœ€è¦æä¾›**è®¿é—®ç°æœ‰ AD çš„å‡­æ®**ã€‚
* **Amazon Cognito ç”¨æˆ·æ± **ï¼šä¸ Cognito ç”¨æˆ·æ± ç›¸åŒã€‚
* **Cloud Directory**ï¼šè¿™æ˜¯**æœ€ç®€å•**çš„ä¸€ç§ã€‚ä¸€ä¸ª**æ— æœåŠ¡å™¨**ç›®å½•ï¼Œæ‚¨æŒ‡å®šè¦ä½¿ç”¨çš„**æ¨¡å¼**å¹¶æŒ‰ä½¿ç”¨é‡è®¡è´¹ã€‚

AWS ç›®å½•æœåŠ¡å…è®¸ä¸ç°æœ‰çš„**æœ¬åœ°** Microsoft AD è¿›è¡Œ**åŒæ­¥**ï¼Œåœ¨ AWS ä¸­è¿è¡Œæ‚¨è‡ªå·±çš„ ADï¼Œæˆ–ä¸**å…¶ä»–ç›®å½•ç±»å‹**è¿›è¡ŒåŒæ­¥ã€‚

### å®éªŒ

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¾ˆå¥½çš„æ•™ç¨‹ï¼Œä»¥åœ¨ AWS ä¸­åˆ›å»ºè‡ªå·±çš„ Microsoft ADï¼š[https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### æšä¸¾
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### ç™»å½•

è¯·æ³¨æ„ï¼Œå¦‚æœç›®å½•çš„**æè¿°**å­—æ®µä¸­åŒ…å«**AccessUrl**å­—æ®µä¸­çš„**åŸŸå**ï¼Œé‚£ä¹ˆç”¨æˆ·å¯èƒ½å¯ä»¥ä½¿ç”¨å…¶**ADå‡­æ®**ç™»å½•åˆ°æŸäº›**AWSæœåŠ¡**ä¸­ï¼š

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon Management Console)
* `<name>.awsapps.com/start` (IAM Identity Center)

### æƒé™æå‡

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## æŒä¹…æ€§

### ä½¿ç”¨ADç”¨æˆ·

å¯ä»¥é€šè¿‡è§’è‰²æ¥æˆäºˆ**ADç”¨æˆ·**å¯¹AWSç®¡ç†æ§åˆ¶å°çš„è®¿é—®æƒé™ã€‚**é»˜è®¤ç”¨æˆ·åä¸ºAdmin**ï¼Œå¯ä»¥ä»AWSæ§åˆ¶å°**æ›´æ”¹å…¶å¯†ç **ã€‚

å› æ­¤ï¼Œå¯ä»¥**æ›´æ”¹Adminçš„å¯†ç **ï¼Œ**åˆ›å»ºæ–°ç”¨æˆ·**æˆ–**æ›´æ”¹ç”¨æˆ·çš„å¯†ç **å¹¶æˆäºˆè¯¥ç”¨æˆ·è§’è‰²ä»¥ä¿æŒè®¿é—®æƒé™ã€‚\
è¿˜å¯ä»¥**å°†ç”¨æˆ·æ·»åŠ åˆ°ADä¸­çš„ç»„**å¹¶**å°†è¯¥ADç»„æˆäºˆè§’è‰²**ï¼ˆä»¥ä½¿æ­¤æŒä¹…æ€§æ›´éšè”½ï¼‰ã€‚

### å…±äº«ADï¼ˆä»å—å®³è€…åˆ°æ”»å‡»è€…ï¼‰

å¯ä»¥å°†ADç¯å¢ƒä»å—å®³è€…å…±äº«ç»™æ”»å‡»è€…ã€‚è¿™æ ·ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿç»§ç»­è®¿é—®ADç¯å¢ƒã€‚\
ä½†æ˜¯ï¼Œè¿™æ„å‘³ç€éœ€è¦å…±äº«æ‰˜ç®¡çš„ADå¹¶åˆ›å»ºVPCå¯¹ç­‰è¿æ¥ã€‚

æ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°æŒ‡å—ï¼š[https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~å…±äº«ADï¼ˆä»æ”»å‡»è€…åˆ°å—å®³è€…ï¼‰~~

ä¼¼ä¹ä¸å¯èƒ½å°†æ¥è‡ªä¸åŒADç¯å¢ƒçš„ç”¨æˆ·æˆäºˆå¯¹ä¸€ä¸ªAWSè´¦æˆ·çš„è®¿é—®æƒé™ã€‚

## WorkDocs

Amazon Web Services (AWS) WorkDocsæ˜¯ä¸€ç§åŸºäºäº‘çš„**æ–‡ä»¶å­˜å‚¨å’Œå…±äº«æœåŠ¡**ã€‚å®ƒæ˜¯AWSäº‘è®¡ç®—æœåŠ¡å¥—ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œæ—¨åœ¨ä¸ºç»„ç»‡æä¾›å®‰å…¨å¯æ‰©å±•çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºå­˜å‚¨ã€å…±äº«å’Œåä½œæ–‡ä»¶å’Œæ–‡æ¡£ã€‚

AWS WorkDocsä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªåŸºäºWebçš„ç•Œé¢ï¼Œç”¨äºä¸Šä¼ ã€è®¿é—®å’Œç®¡ç†å…¶æ–‡ä»¶å’Œæ–‡æ¡£ã€‚å®ƒè¿˜æä¾›ç‰ˆæœ¬æ§åˆ¶ã€å®æ—¶åä½œå’Œä¸å…¶ä»–AWSæœåŠ¡å’Œç¬¬ä¸‰æ–¹å·¥å…·çš„é›†æˆç­‰åŠŸèƒ½ã€‚

### æšä¸¾

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
### ææƒ

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDFï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
