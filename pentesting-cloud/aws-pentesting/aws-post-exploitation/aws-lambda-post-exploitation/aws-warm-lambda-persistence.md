# AWS - Lambda Ä°steklerini Ã‡alma

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin!</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

- Åirketinizi HackTricks'te tanÄ±tmak istiyorsanÄ±z veya HackTricks'i PDF olarak indirmek istiyorsanÄ±z [ABONELÄ°K PLANLARI](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
- [Resmi PEASS & HackTricks Ã¼rÃ¼nlerini](https://peass.creator-spring.com) edinin
- Ã–zel [NFT'lerimizden oluÅŸan The PEASS Family](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
- ğŸ’¬ [Discord grubumuza](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [telegram grubumuza](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da ğŸ¦ [@hacktricks_live](https://twitter.com/hacktricks_live) takip edin.
- Hacking ipuÃ§larÄ±nÄ±zÄ± [HackTricks](https://github.com/carlospolop/hacktricks) ve [HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## Lambda AkÄ±ÅŸÄ±

<figure><img src="../../../../.gitbook/assets/image (152).png" alt=""><figcaption><p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/lambda_poc_2_arch.png">https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/lambda_poc_2_arch.png</a></p></figcaption></figure>

1. **Slicer**, **invokasyonlarÄ±** **init** iÅŸlemine gÃ¶nderen **konteyner dÄ±ÅŸÄ±ndaki bir iÅŸlemdir**.
2. Init iÅŸlemi, ilginÃ§ uÃ§ noktalarÄ± aÃ§Ä±ÄŸa Ã§Ä±karan **9001** numaralÄ± baÄŸlantÄ± noktasÄ±nÄ± dinler:
   - **`/2018-06-01/runtime/invocation/next`** - bir sonraki invokasyon etkinliÄŸini al
   - **`/2018-06-01/runtime/invocation/{invoke-id}/response`** - invokasyon iÃ§in iÅŸleyici yanÄ±tÄ±nÄ± dÃ¶ndÃ¼r
   - **`/2018-06-01/runtime/invocation/{invoke-id}/error`** - bir yÃ¼rÃ¼tme hatasÄ± dÃ¶ndÃ¼r
3. **bootstrap.py**, init iÅŸleminden invokasyonlarÄ± alan ve kullanÄ±cÄ± kodunu iÅŸlemek iÃ§in Ã§aÄŸrÄ± yapan bir dÃ¶ngÃ¼ye sahiptir (**`/next`**).
4. Son olarak, **bootstrap.py**, **yanÄ±tÄ±** init'e gÃ¶nderir.

Bootstrap, kullanÄ±cÄ± kodunu bir modÃ¼l olarak yÃ¼kler, bu nedenle kullanÄ±cÄ± kodu tarafÄ±ndan gerÃ§ekleÅŸtirilen herhangi bir kod yÃ¼rÃ¼tme aslÄ±nda bu iÅŸlemde gerÃ§ekleÅŸmektedir.

## Lambda Ä°steklerini Ã‡alma

Bu saldÄ±rÄ±nÄ±n amacÄ±, kullanÄ±cÄ± kodunun, zayÄ±f isteÄŸi iÅŸleyen **`bootstrap.py`** iÅŸlemini iÃ§eren kÃ¶tÃ¼ amaÃ§lÄ± bir **`bootstrap.py`** iÅŸlemini yÃ¼rÃ¼tmeye zorlamaktÄ±r. Bu ÅŸekilde, **kÃ¶tÃ¼ amaÃ§lÄ± bootstrap** iÅŸlemi, istekleri iÅŸlemek iÃ§in **init iÅŸlemiyle iletiÅŸim kurmaya baÅŸlayacak** ve **meÅŸru** bootstrap, kÃ¶tÃ¼ amaÃ§lÄ± olanÄ± Ã§alÄ±ÅŸtÄ±rÄ±rken **tuzaÄŸa dÃ¼ÅŸmÃ¼ÅŸ** olacaÄŸÄ±ndan init iÅŸleminden istekler istemeyecektir.

Bu, kullanÄ±cÄ± kodunun meÅŸru **`bootstrap.py`** iÅŸlemi tarafÄ±ndan yÃ¼rÃ¼tÃ¼ldÃ¼ÄŸÃ¼ iÃ§in kolayca baÅŸarÄ±labilen bir gÃ¶revdir. Bu nedenle saldÄ±rgan:

- **Mevcut invokasyonun sahte sonucunu init iÅŸlemine gÃ¶ndererek**, init iÅŸleminin bootstrap iÅŸleminin daha fazla invokasyon beklediÄŸini dÃ¼ÅŸÃ¼nmesini saÄŸlayabilir.
- Bir istek, **`/${invoke-id}/response`**'a gÃ¶nderilmelidir.
- invoke-id, meÅŸru **`bootstrap.py`** iÅŸleminin yÄ±ÄŸÄ±nÄ±ndan [**inspect**](https://docs.python.org/3/library/inspect.html) python modÃ¼lÃ¼nÃ¼ kullanarak (burada Ã¶nerildiÄŸi gibi) veya sadece tekrar **`/2018-06-01/runtime/invocation/next`**'e istek gÃ¶ndererek (burada Ã¶nerildiÄŸi gibi) elde edilebilir.
- Bir sonraki invokasyonlarÄ± iÅŸleyecek kÃ¶tÃ¼ amaÃ§lÄ± **`boostrap.py`**'yi yÃ¼rÃ¼tÃ¼n
- Gizlilik amaÃ§larÄ±yla lambda invokasyon parametrelerini saldÄ±rganÄ±n kontrol ettiÄŸi C2'ye gÃ¶nderip ardÄ±ndan istekleri normal ÅŸekilde iÅŸleyebilir.
- Bu saldÄ±rÄ± iÃ§in, mevcut lambda invokasyonundan **`invoke-id`**'yi parametre olarak belirterek mevcut **`bootstrap.py`**'nin orijinal kodunu almak, kÃ¶tÃ¼ amaÃ§lÄ± kodu eklemek ve Ã§alÄ±ÅŸtÄ±rmak yeterlidir.

### SaldÄ±rÄ± AdÄ±mlarÄ±

## Referanslar

- [https://unit42.paloaltonetworks.com/gaining-persistency-vulnerable-lambdas/](https://unit42.paloaltonetworks.com/gaining-persistency-vulnerable-lambdas/) 

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahramana kadar AWS hackleme Ã¶ÄŸrenin!</summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

- Åirketinizi HackTricks'te tanÄ±tmak istiyorsanÄ±z veya HackTricks'i PDF olarak indirmek istiyorsanÄ±z [ABONELÄ°K PLANLARI](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
- [Resmi PEASS & HackTricks Ã¼rÃ¼nlerini](https://peass.creator-spring.com) edinin
- Ã–zel [NFT'lerimizden oluÅŸan The PEASS Family](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
- ğŸ’¬ [Discord grubumuza](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [telegram grubumuza](https://t.me/peass) katÄ±lÄ±n veya bizi Twitter'da ğŸ¦ [@hacktricks_live](https://twitter.com/hacktricks_live) takip edin.
- Hacking ipuÃ§larÄ±nÄ±zÄ± [HackTricks](https://github.com/carlospolop/hacktricks) ve [HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
