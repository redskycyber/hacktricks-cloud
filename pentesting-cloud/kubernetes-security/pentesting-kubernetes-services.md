# Kubernetes ì„œë¹„ìŠ¤ì˜ Pentesting

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **Hacking íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>

KubernetesëŠ” ì—¬ëŸ¬ **íŠ¹ì • ë„¤íŠ¸ì›Œí¬ ì„œë¹„ìŠ¤**ë¥¼ ì‚¬ìš©í•˜ë©°, ì´ëŸ¬í•œ ì„œë¹„ìŠ¤ëŠ” **ì¸í„°ë„·ì— ë…¸ì¶œ**ë˜ê±°ë‚˜ **í•˜ë‚˜ì˜ podë¥¼ ì¹¨íˆ¬í•œ í›„ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

## OSINTë¥¼ í†µí•œ ë…¸ì¶œëœ pod ì°¾ê¸°

í•˜ë‚˜ì˜ ë°©ë²•ì€ [crt.sh](https://crt.sh)ì—ì„œ `Identity LIKE "k8s.%.com"`ì„ ê²€ìƒ‰í•˜ì—¬ kubernetesì™€ ê´€ë ¨ëœ í•˜ìœ„ ë„ë©”ì¸ì„ ì°¾ëŠ” ê²ƒì…ë‹ˆë‹¤. ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ githubì—ì„œ `"k8s.%.com"`ì„ ê²€ìƒ‰í•˜ê³  í•´ë‹¹ ë¬¸ìì—´ì„ í¬í•¨í•˜ëŠ” **YAML íŒŒì¼**ì„ ì°¾ëŠ” ê²ƒì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Kubernetesê°€ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí•˜ëŠ” ë°©ë²•

ì„œë¹„ìŠ¤ë¥¼ **ê³µê°œì ìœ¼ë¡œ ë…¸ì¶œ**í•  ìˆ˜ ìˆëŠ” Kubernetesì˜ ì‘ë™ ë°©ì‹ì„ ì´í•´í•˜ëŠ” ê²ƒì´ ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="exposing-services-in-kubernetes.md" %}
[exposing-services-in-kubernetes.md](exposing-services-in-kubernetes.md)
{% endcontent-ref %}

## í¬íŠ¸ ìŠ¤ìºë‹ì„ í†µí•œ ë…¸ì¶œëœ pod ì°¾ê¸°

ë‹¤ìŒ í¬íŠ¸ëŠ” Kubernetes í´ëŸ¬ìŠ¤í„°ì—ì„œ ì—´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

| í¬íŠ¸            | í”„ë¡œì„¸ìŠ¤        | ì„¤ëª…                                                            |
| --------------- | -------------- | ---------------------------------------------------------------------- |
| 443/TCP         | kube-apiserver | Kubernetes API í¬íŠ¸                                                    |
| 2379/TCP        | etcd           |                                                                        |
| 6666/TCP        | etcd           | etcd                                                                   |
| 4194/TCP        | cAdvisor       | ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­                                                      |
| 6443/TCP        | kube-apiserver | Kubernetes API í¬íŠ¸                                                    |
| 8443/TCP        | kube-apiserver | Minikube API í¬íŠ¸                                                      |
| 8080/TCP        | kube-apiserver | ë³´ì•ˆë˜ì§€ ì•Šì€ API í¬íŠ¸                                                      |
| 10250/TCP       | kubelet        | ì „ì²´ ëª¨ë“œ ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•˜ëŠ” HTTPS API                                |
| 10255/TCP       | kubelet        | ì¸ì¦ë˜ì§€ ì•Šì€ ì½ê¸° ì „ìš© HTTP í¬íŠ¸: pods, running pods ë° node state |
| 10256/TCP       | kube-proxy     | Kube Proxy ìƒíƒœ í™•ì¸ ì„œë²„                                         |
| 9099/TCP        | calico-felix   | Calicoë¥¼ ìœ„í•œ ìƒíƒœ í™•ì¸ ì„œë²„                                         |
| 6782-4/TCP      | weave          | ë©”íŠ¸ë¦­ ë° ì—”ë“œí¬ì¸íŠ¸                                                  |
| 30000-32767/TCP | NodePort       | ì„œë¹„ìŠ¤ë¡œì˜ í”„ë¡ì‹œ                                                  |
| 44134/TCP       | Tiller         | Helm ì„œë¹„ìŠ¤ ìˆ˜ì‹  ëŒ€ê¸°                                                 |

### Nmap

{% code overflow="wrap" %}
```bash
nmap -n -T4 -p 443,2379,6666,4194,6443,8443,8080,10250,10255,10256,9099,6782-6784,30000-32767,44134 <pod_ipaddress>/16
```
{% endcode %}

### Kube-apiserver

ì´ê²ƒì€ ì¼ë°˜ì ìœ¼ë¡œ ê´€ë¦¬ìê°€ ë„êµ¬ **`kubectl`**ì„ ì‚¬ìš©í•˜ì—¬ ëŒ€í™”í•˜ëŠ” **API Kubernetes ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤.

**ì¼ë°˜ í¬íŠ¸: 6443 ë° 443**, ê·¸ë¦¬ê³  minikubeì—ì„œëŠ” 8443, ë³´ì•ˆì´ ì—†ëŠ” ê²½ìš° 8080ë„ ì‚¬ìš©ë©ë‹ˆë‹¤.
```
curl -k https://<IP Address>:(8|6)443/swaggerapi
curl -k https://<IP Address>:(8|6)443/healthz
curl -k https://<IP Address>:(8|6)443/api/v1
```
**ë‹¤ìŒ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì—¬ ë¯¼ê°í•œ ë°ì´í„°ë¥¼ ì–»ê³  ì´ ì„œë¹„ìŠ¤ì™€ í†µì‹ í•˜ì—¬ ë¯¼ê°í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì„¸ìš”:**

{% content-ref url="kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](kubernetes-enumeration.md)
{% endcontent-ref %}

### Kubelet API

ì´ ì„œë¹„ìŠ¤ëŠ” **í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ë…¸ë“œì—ì„œ ì‹¤í–‰**ë©ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ëŠ” **ë…¸ë“œ** ë‚´ë¶€ì˜ **íŒŒë“œë¥¼ ì œì–´**í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ëŠ” **kube-apiserver**ì™€ í†µì‹ í•©ë‹ˆë‹¤.

ë§Œì•½ ì´ ì„œë¹„ìŠ¤ê°€ ë…¸ì¶œë˜ì–´ ìˆë‹¤ë©´, **ì¸ì¦ë˜ì§€ ì•Šì€ ì›ê²© ì½”ë“œ ì‹¤í–‰(RCE)** ì·¨ì•½ì ì„ ë°œê²¬í•œ ê²ƒì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Kubelet API
```
curl -k https://<IP address>:10250/metrics
curl -k https://<IP address>:10250/pods
```
ë§Œì•½ ì‘ë‹µì´ `Unauthorized`ë¼ë©´ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.

ë…¸ë“œ ëª©ë¡ì„ ë‚˜ì—´í•  ìˆ˜ ìˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ kubelet ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
kubectl get nodes -o custom-columns='IP:.status.addresses[0].address,KUBELET_PORT:.status.daemonEndpoints.kubeletEndpoint.Port' | grep -v KUBELET_PORT | while IFS='' read -r node; do
ip=$(echo $node | awk '{print $1}')
port=$(echo $node | awk '{print $2}')
echo "curl -k --max-time 30 https://$ip:$port/pods"
echo "curl -k --max-time 30 https://$ip:2379/version" #Check  also for etcd
done
```
#### kubelet (ì½ê¸° ì „ìš©)

The kubelet is the primary node agent that runs on each node in a Kubernetes cluster. It is responsible for managing the containers and their lifecycle on the node. As a pentester, you can gather valuable information by exploiting the read-only access of the kubelet.

##### Exploiting kubelet's read-only access

1. **Enumerating running pods**: Use the `/pods` endpoint to list all the running pods on the node. This can provide information about the applications and services running on the cluster.

2. **Accessing pod logs**: Utilize the `/pods/{pod_name}/log` endpoint to retrieve the logs of a specific pod. This can help in identifying any sensitive information or potential vulnerabilities.

3. **Reading pod metadata**: Use the `/pods/{pod_name}` endpoint to access the metadata of a pod. This can include details such as labels, annotations, and other configuration information.

4. **Checking pod status**: Utilize the `/pods/{pod_name}/status` endpoint to check the status of a pod. This can provide information about the health and availability of the pod.

5. **Inspecting pod environment variables**: Use the `/pods/{pod_name}/env` endpoint to view the environment variables set for a pod. This can reveal sensitive information or potential misconfigurations.

6. **Examining pod volumes**: Utilize the `/pods/{pod_name}/volumes` endpoint to inspect the volumes attached to a pod. This can provide insights into the storage configuration and potential security risks.

By leveraging the read-only access of the kubelet, you can gather valuable information about the running pods, their logs, metadata, status, environment variables, and volumes. This information can be used to identify potential vulnerabilities and misconfigurations in the Kubernetes cluster.
```
curl -k https://<IP Address>:10255
http://<external-IP>:10255/pods
```
### etcd API

etcdëŠ” Kubernetes í´ëŸ¬ìŠ¤í„°ì—ì„œ ì¤‘ìš”í•œ ì—­í• ì„ í•˜ëŠ” ë¶„ì‚° í‚¤-ê°’ ì €ì¥ì†Œì…ë‹ˆë‹¤. etcd APIëŠ” etcd ì„œë²„ì™€ ìƒí˜¸ ì‘ìš©í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ APIë¥¼ í†µí•´ í´ëŸ¬ìŠ¤í„°ì˜ êµ¬ì„± ì •ë³´, ìƒíƒœ ì •ë³´ ë° ê¸°íƒ€ ì¤‘ìš”í•œ ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

etcd APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- í‚¤-ê°’ ìŒì˜ ìƒì„±, ìˆ˜ì •, ì‚­ì œ
- íŠ¹ì • í‚¤ì— ëŒ€í•œ ì¡°íšŒ
- í‚¤ ë²”ìœ„ì— ëŒ€í•œ ì¡°íšŒ
- íŠ¸ëœì­ì…˜ ìˆ˜í–‰
- ì›Œì¹˜ ì´ë²¤íŠ¸ ìˆ˜ì‹ 

etcd APIëŠ” HTTP/JSON ê¸°ë°˜ìœ¼ë¡œ ì‘ë™í•˜ë©°, ë‹¤ì–‘í•œ í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ etcd ì„œë²„ì™€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

etcd APIëŠ” Kubernetes í´ëŸ¬ìŠ¤í„°ì˜ ë³´ì•ˆì„ ê°•í™”í•˜ê¸° ìœ„í•´ ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ etcd APIì˜ ë³´ì•ˆ ì„¤ì •ì€ ì‹ ì¤‘í•˜ê²Œ ê´€ë¦¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì ì ˆí•œ ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬ ë©”ì»¤ë‹ˆì¦˜ì„ êµ¬ì„±í•˜ì—¬ ë¶ˆë²•ì ì¸ ì•¡ì„¸ìŠ¤ë¡œë¶€í„° í´ëŸ¬ìŠ¤í„°ë¥¼ ë³´í˜¸í•´ì•¼ í•©ë‹ˆë‹¤.
```
curl -k https://<IP address>:2379
curl -k https://<IP address>:2379/version
etcdctl --endpoints=http://<MASTER-IP>:2379 get / --prefix --keys-only
```
### Tiller

TillerëŠ” Kubernetes í´ëŸ¬ìŠ¤í„°ì—ì„œ Helm ì°¨íŠ¸ë¥¼ ì„¤ì¹˜, ì—…ê·¸ë ˆì´ë“œ ë° ê´€ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì„œë²„ êµ¬ì„± ìš”ì†Œì…ë‹ˆë‹¤. TillerëŠ” í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ë°›ì•„ì„œ í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ì ì ˆí•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì¡°ì‘í•©ë‹ˆë‹¤. TillerëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì‹¤í–‰ë˜ë©°, Helm í´ë¼ì´ì–¸íŠ¸ì™€ í†µì‹ í•˜ì—¬ ì°¨íŠ¸ë¥¼ ì„¤ì¹˜í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.

TillerëŠ” ë³´ì•ˆ ì·¨ì•½ì ìœ¼ë¡œ ì•…ìš©ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì ì ˆí•œ ë³´í˜¸ ë° êµ¬ì„±ì´ í•„ìš”í•©ë‹ˆë‹¤. Tillerì— ëŒ€í•œ ê¸°ë³¸ì ì¸ ë³´ì•ˆ êµ¬ì„±ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- Tiller ì„œë¹„ìŠ¤ ê³„ì •ì—ëŠ” ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ë¶€ì—¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- Tiller ì„œë¹„ìŠ¤ ê³„ì •ì€ í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ì ê¶Œí•œì„ ê°€ì§€ë©´ ì•ˆ ë©ë‹ˆë‹¤.
- Tiller ì„œë¹„ìŠ¤ ê³„ì •ì€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ì—ì„œë§Œ ì‘ë™í•˜ë„ë¡ ì œí•œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- Tiller ì„œë¹„ìŠ¤ ê³„ì •ì€ í•„ìš”í•œ ê¶Œí•œë§Œ ê°€ì§€ë„ë¡ ì œí•œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

Tillerì˜ ë³´ì•ˆ êµ¬ì„±ì„ ê°•í™”í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Tiller ì„œë¹„ìŠ¤ ê³„ì •ì—ëŠ” RBAC(ë¡¤ ê¸°ë°˜ ì ‘ê·¼ ì œì–´)ì„ ì‚¬ìš©í•˜ì—¬ í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ë¶€ì—¬í•©ë‹ˆë‹¤.
- Tiller ì„œë¹„ìŠ¤ ê³„ì •ì„ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ì—ì„œë§Œ ì‘ë™í•˜ë„ë¡ ì œí•œí•©ë‹ˆë‹¤.
- Tiller ì„œë¹„ìŠ¤ ê³„ì •ì—ëŠ” í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ì ê¶Œí•œì„ ë¶€ì—¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- Tiller ì„œë¹„ìŠ¤ ê³„ì •ì—ëŠ” í•„ìš”í•œ ê¶Œí•œë§Œ ë¶€ì—¬í•˜ê³ , ë¶ˆí•„ìš”í•œ ê¶Œí•œì€ ì œê±°í•©ë‹ˆë‹¤.

Tillerì˜ ë³´ì•ˆ êµ¬ì„±ì„ ê°•í™”í•˜ëŠ” ê²ƒì€ Kubernetes í´ëŸ¬ìŠ¤í„°ì˜ ì•ˆì „ì„±ì„ í–¥ìƒì‹œí‚¤ëŠ” ë° ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤. ì ì ˆí•œ ë³´í˜¸ ë° êµ¬ì„±ì„ í†µí•´ Tillerë¥¼ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
helm --host tiller-deploy.kube-system:44134 version
```
ì´ ì„œë¹„ìŠ¤ë¥¼ ì•…ìš©í•˜ì—¬ Kubernetes ë‚´ì—ì„œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

### cAdvisor

ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ëŠ” ë° ìœ ìš©í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.
```
curl -k https://<IP Address>:4194
```
### NodePort

ë…¸ë“œë¥¼ í†µí•´ í¬íŠ¸ê°€ ë…¸ì¶œë  ë•Œ, ë™ì¼í•œ í¬íŠ¸ê°€ ëª¨ë“  ë…¸ë“œì—ì„œ ì—´ë¦¬ê³  ì„ ì–¸ëœ ì„œë¹„ìŠ¤ë¡œ íŠ¸ë˜í”½ì„ í”„ë¡ì‹œí•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ì´ í¬íŠ¸ëŠ” **30000-32767** ë²”ìœ„ì— ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ìƒˆë¡œìš´ í™•ì¸ë˜ì§€ ì•Šì€ ì„œë¹„ìŠ¤ëŠ” ì´ëŸ¬í•œ í¬íŠ¸ë¥¼ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
sudo nmap -sS -p 30000-32767 <IP>
```
## ì·¨ì•½í•œ êµ¬ì„± ì˜¤ë¥˜

### Kube-apiserver ìµëª… ì•¡ì„¸ìŠ¤

**kube-apiserver API ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ìµëª… ì•¡ì„¸ìŠ¤ëŠ” í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ê·¸ëŸ¬ë‚˜ ëª‡ ê°€ì§€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](https://www.cyberark.com/wp-content/uploads/2019/09/Kube-Pen-2-fig-5.png)

### **ETCD ìµëª… ì•¡ì„¸ìŠ¤ í™•ì¸**

ETCDëŠ” í´ëŸ¬ìŠ¤í„° ë¹„ë°€, êµ¬ì„± íŒŒì¼ ë° ë” ë§ì€ **ë¯¼ê°í•œ ë°ì´í„°**ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. **ê¸°ë³¸ì ìœ¼ë¡œ** ETCDëŠ” **ìµëª…ìœ¼ë¡œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ì—†ì§€ë§Œ**, í•­ìƒ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

ETCDì— ìµëª…ìœ¼ë¡œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë‹¤ë©´, [etcdctl](https://github.com/etcd-io/etcd/blob/master/etcdctl/READMEv2.md) ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì€ ì €ì¥ëœ ëª¨ë“  í‚¤ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤:
```
etcdctl --endpoints=http://<MASTER-IP>:2379 get / --prefix --keys-only
```
### **Kubelet RCE**

[Kubelet ë¬¸ì„œ](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/)ì— ë”°ë¥´ë©´, ê¸°ë³¸ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ìµëª… ì•¡ì„¸ìŠ¤ê°€ í—ˆìš©ë©ë‹ˆë‹¤:

> Kubelet ì„œë²„ì— ëŒ€í•œ ìµëª… ìš”ì²­ì„ í™œì„±í™”í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ì¸ì¦ ë°©ë²•ì— ì˜í•´ ê±°ë¶€ë˜ì§€ ì•Šì€ ìš”ì²­ì€ ìµëª… ìš”ì²­ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤. ìµëª… ìš”ì²­ì€ `system:anonymous`ë¼ëŠ” ì‚¬ìš©ì ì´ë¦„ê³¼ `system:unauthenticated`ë¼ëŠ” ê·¸ë£¹ ì´ë¦„ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

Kuebelet APIì˜ **ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬** ë°©ì‹ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ë ¤ë©´ ì´ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../kubernetes-pentesting/pentesting-kubernetes-services/kubelet-authentication-and-authorization.md" %}
[kubelet-authentication-and-authorization.md](../kubernetes-pentesting/pentesting-kubernetes-services/kubelet-authentication-and-authorization.md)
{% endcontent-ref %}

**Kubelet** ì„œë¹„ìŠ¤ **APIëŠ” ë¬¸ì„œí™”ë˜ì–´ ìˆì§€ ì•Šì§€ë§Œ**, ì†ŒìŠ¤ ì½”ë“œëŠ” ì—¬ê¸°ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©° ë…¸ì¶œëœ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ëŠ” ê²ƒì€ ë‹¤ìŒê³¼ ê°™ì´ ê°„ë‹¨í•©ë‹ˆë‹¤:
```bash
curl -s https://raw.githubusercontent.com/kubernetes/kubernetes/master/pkg/kubelet/server/server.go | grep 'Path("/'

Path("/pods").
Path("/run")
Path("/exec")
Path("/attach")
Path("/portForward")
Path("/containerLogs")
Path("/runningpods/").
```
ëª¨ë‘ í¥ë¯¸ë¡œì›Œ ë³´ì…ë‹ˆë‹¤.

[Kubeletctl](https://github.com/cyberark/kubeletctl) ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ Kubeletê³¼ í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ì™€ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### /pods

ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” íŒŒë“œì™€ í•´ë‹¹ ì»¨í…Œì´ë„ˆë¥¼ ë‚˜ì—´í•©ë‹ˆë‹¤:
```bash
kubeletctl pods
```
#### /exec

ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” ì–´ë–¤ ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì½”ë“œë¥¼ ë§¤ìš° ì‰½ê²Œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤:
```bash
kubeletctl exec [command]
```
{% hint style="info" %}
ì´ëŸ¬í•œ ê³µê²©ì„ í”¼í•˜ê¸° ìœ„í•´ _**kubelet**_ ì„œë¹„ìŠ¤ëŠ” `--anonymous-auth false`ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ë©°, ì„œë¹„ìŠ¤ëŠ” ë„¤íŠ¸ì›Œí¬ ìˆ˜ì¤€ì—ì„œ ê²©ë¦¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
{% endhint %}

### **Kubelet (ì½ê¸° ì „ìš© í¬íŠ¸) ì •ë³´ ë…¸ì¶œ í™•ì¸**

**kubelet ì½ê¸° ì „ìš© í¬íŠ¸**ê°€ ë…¸ì¶œë˜ë©´, ë¬´ë‹¨ìœ¼ë¡œ APIì—ì„œ ì •ë³´ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. ì´ í¬íŠ¸ì˜ ë…¸ì¶œì€ ë‹¤ì–‘í•œ **í´ëŸ¬ìŠ¤í„° êµ¬ì„± ìš”ì†Œ**ì˜ ë…¸ì¶œë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ë³´ì—ëŠ” **íŒŸ ì´ë¦„, ë‚´ë¶€ íŒŒì¼ ìœ„ì¹˜ ë° ê¸°íƒ€ êµ¬ì„±** ë“±ì´ í¬í•¨ë  ìˆ˜ ìˆìœ¼ë©°, ì´ëŸ¬í•œ ì •ë³´ëŠ” ì¤‘ìš”í•˜ì§€ ì•Šì„ ìˆ˜ ìˆì§€ë§Œ, ë…¸ì¶œì€ ì—¬ì „íˆ ë³´ì•ˆ ìœ„í—˜ì„ ì´ˆë˜í•˜ë¯€ë¡œ í”¼í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ ì·¨ì•½ì ì´ ì•…ìš©ë  ìˆ˜ ìˆëŠ” ì˜ˆì‹œëŠ” ì›ê²© ê³µê²©ìê°€ íŠ¹ì • URLì— ì ‘ê·¼í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. `http://<external-IP>:10255/pods`ë¡œ ì´ë™í•¨ìœ¼ë¡œì¨, ê³µê²©ìëŠ” kubeletì—ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![https://www.cyberark.com/wp-content/uploads/2019/09/KUbe-Pen-2-fig-6.png](https://www.cyberark.com/wp-content/uploads/2019/09/KUbe-Pen-2-fig-6.png)

## ì°¸ê³  ìë£Œ

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-2" %}

{% embed url="https://labs.f-secure.com/blog/attacking-kubernetes-through-kubelet" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* HackTricksì—ì„œ **íšŒì‚¬ ê´‘ê³ ë¥¼ ë³´ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìƒí’ˆ**](https://peass.creator-spring.com)ì„ êµ¬ë§¤í•˜ì„¸ìš”.
* ë…ì ì ì¸ [**NFT**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì¸ [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ì„** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
