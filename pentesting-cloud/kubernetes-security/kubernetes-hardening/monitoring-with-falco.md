# ä½¿ç”¨Falcoè¿›è¡Œç›‘æ§

<details>

<summary><strong>æ”¯æŒHackTrickså¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨HackTricksä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®PEASSçš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½PDFæ ¼å¼çš„HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹PEASSå’ŒHackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

æœ¬æ•™ç¨‹æ‘˜è‡ª[https://madhuakula.com/kubernetes-goat/scenarios/scenario-18.html#scenario-information](https://madhuakula.com/kubernetes-goat/scenarios/scenario-18.html#scenario-information)

### åœºæ™¯ä¿¡æ¯

æœ¬åœºæ™¯éƒ¨ç½²äº†ç”¨äºå®¹å™¨å’ŒKubernetesèµ„æºçš„è¿è¡Œæ—¶å®‰å…¨ç›‘æ§å’Œæ£€æµ‹ã€‚

* è¦å¼€å§‹ä½¿ç”¨æ­¤åœºæ™¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç‰ˆæœ¬3éƒ¨ç½²ä»¥ä¸‹Helmå›¾è¡¨

> æ³¨æ„ï¼šç¡®ä¿ä½¿ç”¨Helm v3è¿è¡Œä»¥ä¸‹éƒ¨ç½²
```bash
helm repo add falcosecurity https://falcosecurity.github.io/charts
helm repo update
helm install falco falcosecurity/falco
```
![Scenario 18 helm falco setup](https://madhuakula.com/kubernetes-goat/scenarios/images/sc-18-1.png)

### [æ–¹æ¡ˆè§£å†³](https://madhuakula.com/kubernetes-goat/scenarios/scenario-18.html#scenario-solution)

> `Falco`ï¼Œäº‘åŸç”Ÿçš„è¿è¡Œæ—¶å®‰å…¨é¡¹ç›®ï¼Œæ˜¯äº‹å®ä¸Šçš„Kuberneteså¨èƒæ£€æµ‹å¼•æ“ã€‚Falcoç”±Sysdigäº2016å¹´åˆ›å»ºï¼Œå¹¶æˆä¸ºCNCFçš„å­µåŒ–çº§é¡¹ç›®ä¸­çš„ç¬¬ä¸€ä¸ªè¿è¡Œæ—¶å®‰å…¨é¡¹ç›®ã€‚Falcoåœ¨è¿è¡Œæ—¶æ£€æµ‹æ„å¤–çš„åº”ç”¨è¡Œä¸ºï¼Œå¹¶åœ¨å¨èƒå‘ç”Ÿæ—¶å‘å‡ºè­¦æŠ¥ã€‚

Falcoä½¿ç”¨ç³»ç»Ÿè°ƒç”¨æ¥ä¿æŠ¤å’Œç›‘æ§ç³»ç»Ÿï¼Œå…·ä½“åŒ…æ‹¬ï¼š

* åœ¨è¿è¡Œæ—¶è§£ææ¥è‡ªå†…æ ¸çš„Linuxç³»ç»Ÿè°ƒç”¨
* å°†æµä¸å¼ºå¤§çš„è§„åˆ™å¼•æ“è¿›è¡Œæ–­è¨€
* åœ¨è¿åè§„åˆ™æ—¶å‘å‡ºè­¦æŠ¥

Falcoé™„å¸¦äº†ä¸€ç»„é»˜è®¤è§„åˆ™ï¼Œç”¨äºæ£€æŸ¥å†…æ ¸æ˜¯å¦å­˜åœ¨å¼‚å¸¸è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š

* ä½¿ç”¨ç‰¹æƒå®¹å™¨è¿›è¡Œæƒé™æå‡
* ä½¿ç”¨è¯¸å¦‚`setns`ä¹‹ç±»çš„å·¥å…·è¿›è¡Œå‘½åç©ºé—´æ›´æ”¹
* è¯»å–/å†™å…¥è¯¸å¦‚/etcã€/usr/binã€/usr/sbinç­‰ä¼—æ‰€å‘¨çŸ¥çš„ç›®å½•
* åˆ›å»ºç¬¦å·é“¾æ¥
* æ‰€æœ‰æƒå’Œæ¨¡å¼æ›´æ”¹
* æ„å¤–çš„ç½‘ç»œè¿æ¥æˆ–å¥—æ¥å­—å˜åŒ–
* ä½¿ç”¨execveç”Ÿæˆçš„è¿›ç¨‹
* æ‰§è¡Œshã€bashã€cshã€zshç­‰shelläºŒè¿›åˆ¶æ–‡ä»¶
* æ‰§è¡Œsshã€scpã€sftpç­‰SSHäºŒè¿›åˆ¶æ–‡ä»¶
* å˜å¼‚Linuxæ ¸å¿ƒå·¥å…·å¯æ‰§è¡Œæ–‡ä»¶
* å˜å¼‚ç™»å½•äºŒè¿›åˆ¶æ–‡ä»¶
* å˜å¼‚shadowutilæˆ–passwdå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚shadowconfigã€pwckã€chpasswdã€getpasswdã€changeã€useraddç­‰ç­‰ã€‚
* è·å–æœ‰å…³falcoéƒ¨ç½²çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯
```bash
kubectl get pods --selector app=falco
```
![Scenario 18 falco get pods](https://madhuakula.com/kubernetes-goat/scenarios/images/sc-18-2.png)

* ä»falcoç³»ç»Ÿæ‰‹åŠ¨è·å–æ—¥å¿—

```bash
$ kubectl get pods -n falco
```

* è·å–falcoå‘½åç©ºé—´ä¸­çš„podåˆ—è¡¨

```bash
$ kubectl logs -n falco <pod_name>
```

* è·å–ç‰¹å®špodçš„æ—¥å¿—

```bash
$ kubectl logs -n falco <pod_name> -c falco
```

* è·å–ç‰¹å®špodä¸­falcoå®¹å™¨çš„æ—¥å¿—
```bash
kubectl logs -f -l app=falco
```
* ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªé»‘å®¢å®¹å™¨å¹¶è¯»å–æ•æ„Ÿæ–‡ä»¶ï¼Œçœ‹çœ‹Falcoæ˜¯å¦èƒ½æ£€æµ‹åˆ°ã€‚
```bash
kubectl run --rm --restart=Never -it --image=madhuakula/hacker-container -- bash
```
* è¯»å–æ•æ„Ÿæ–‡ä»¶

```bash
kubectl exec -it <pod_name> -- cat <file_path>
```

ä½¿ç”¨`kubectl exec`å‘½ä»¤ä»¥äº¤äº’æ¨¡å¼è¿›å…¥Podï¼Œå¹¶ä½¿ç”¨`cat`å‘½ä»¤è¯»å–æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„ã€‚
```bash
cat /etc/shadow
```
![Scenario 18 falco detect /etc/shadow](https://madhuakula.com/kubernetes-goat/scenarios/images/sc-18-3.png)

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ PDF ç‰ˆçš„ HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFT**](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘çš„ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘ HackTricks å’Œ HackTricks Cloud çš„ GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
