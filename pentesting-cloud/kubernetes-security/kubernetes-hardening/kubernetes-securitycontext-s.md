# Kubernetes SecurityContext(s)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite **va코u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** me na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Iz dokumentacije:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Prilikom specificiranja security konteksta za Pod, mo쬰te koristiti nekoliko atributa. Sa defanzivne ta캜ke gledi코ta bezbednosti, trebali biste razmotriti:

* Da imate **runASNonRoot** kao **True**
* Da konfiguri코ete **runAsUser**
* Ako je mogu캖e, razmotrite **ograni캜avanje** **dozvola** koje ukazuju na **seLinuxOptions** i **seccompProfile**
* **NE** dajte **pristup privilegijama** grupi putem **runAsGroup** i **supplementaryGroups**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                                 | <p>Specijalna dodatna grupa koja se odnosi na <strong>sve kontejnere u pod-u</strong>. Neke vrste volumena omogu캖avaju Kubelet-u da <strong>promeni vlasni코tvo tog volumena</strong> tako da bude vlasni코tvo pod-a:<br>1. GID vlasnika 캖e biti FSGroup<br>2. Bit setgid je postavljen (novi fajlovi kreirani u volumenu 캖e biti vlasni코tvo FSGroup)<br>3. Dozvole bitova se OR-uju sa rw-rw---- Ako nije postavljeno, Kubelet ne캖e menjati vlasni코tvo i dozvole nijednog volumena</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>string</em></p>                                                                                                                                                                                                                                      | Ovo defini코e pona코anje **promene vlasni코tva i dozvola volumena** pre nego 코to bude izlo쬰no unutar Pod-a.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                              | **GID za pokretanje entrypoint-a procesa kontejnera**. Koristi podrazumevane vrednosti ako nije postavljeno. Mo쬰 se tako캠e postaviti u SecurityContext-u.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                                                                            | Ozna캜ava da kontejner mora raditi kao korisnik koji nije root. Ako je ta캜no, Kubelet 캖e proveriti sliku pri izvr코avanju da bi se osigurao da ne radi kao UID 0 (root) i ne캖e pokrenuti kontejner ako to radi.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                               | **UID za pokretanje entrypoint-a procesa kontejnera**. Podrazumevano je korisnik koji je naveden u metapodacima slike ako nije navedeno.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Vi코e informacija o</em> <em><strong>seLinux-u</strong></em></p>                                                           | **SELinux kontekst koji 캖e se primeniti na sve kontejnere**. Ako nije navedeno, runtime kontejnera 캖e dodeliti nasumi캜an SELinux kontekst za svaki kontejner.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Vi코e informacija o</em> <em><strong>Seccomp-u</strong></em></p>                                                           | **Seccomp opcije koje 캖e koristiti kontejneri** u ovom pod-u.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>integer array</em></p>                                                                                                                                                                                                                                | Lista **grupa koje se primenjuju na prvi proces pokrenut u svakom kontejneru**, pored primarnog GID-a kontejnera.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>niz</em><br><em>Vi코e informacija o</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctl sadr쬴 listu **namespaced sysctl-ova koji se koriste za pod**. Podovi sa nepodr쬬nim sysctl-ovima (od strane runtime kontejnera) mogu imati problema pri pokretanju.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Windows specifi캜ne postavke koje se primenjuju na sve kontejnere. Ako nije navedeno, opcije unutar SecurityContext-a kontejnera 캖e se koristiti.                                                                                                                                                                                                                                                                                                                                               |
## SecurityContext

[**Iz dokumentacije:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Ovaj kontekst se postavlja unutar **definicija kontejnera**. Sa aspekta defanzivne sigurnosti, trebali biste razmotriti:

* **allowPrivilegeEscalation** postaviti na **False**
* Ne dodavati osetljive **capabilities** (i ukloniti one koje nisu potrebne)
* **privileged** postaviti na **False**
* Ako je mogu캖e, postaviti **readOnlyFilesystem** na **True**
* Postaviti **runAsNonRoot** na **True** i postaviti **runAsUser**
* Ako je mogu캖e, razmotriti **ograni캜avanje** **dozvola** putem **seLinuxOptions** i **seccompProfile**
* **NE** davati pristup **privilegovanom** **grupom** putem **runAsGroup**.

Napomena: Atributi postavljeni u **SecurityContext i PodSecurityContext**, vrednost specificirana u **SecurityContext** ima **prioritet**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** kontroli코e da li proces mo쬰 **dobiti vi코e privilegija** od svog roditeljskog procesa. Ova promenljiva direktno kontroli코e da li 캖e biti postavljena zastavica no\_new\_privs na proces kontejnera. AllowPrivilegeEscalation je uvek ta캜no kada se kontejner pokre캖e kao **Privileged** ili ima **CAP\_SYS\_ADMIN** |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Vi코e informacija o</em> <em><strong>Capabilities</strong></em></p>  | **Capabilities koje se dodaju/uklanjaju prilikom pokretanja kontejnera**. Podrazumevano je skup podrazumevanih Capabilities.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Pokrenuti kontejner u privilegovanom re쬴mu. Procesi u privilegovanom kontejneru su su코tinski **ekvivalentni root korisniku na hostu**. Podrazumevano je false.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount ozna캜ava **vrstu proc mounta koja se koristi za kontejnere**. Podrazumevano je DefaultProcMount koji koristi podrazumevane vrednosti za putanje samo za 캜itanje i maskirane putanje.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Da li ovaj **kontejner ima samo za 캜itanje root fajl sistem**. Podrazumevano je false.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | **GID za pokretanje ulazne ta캜ke** procesa kontejnera. Koristi podrazumevane vrednosti ako nije postavljeno.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Ozna캜ava da kontejner mora **pokrenuti kao korisnik koji nije root**. Ako je ta캜no, Kubelet 캖e proveriti sliku pri pokretanju kako bi se osiguralo da se ne pokre캖e kao UID 0 (root) i da ne캖e uspeti da pokrene kontejner ako je tako.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | **UID za pokretanje ulazne ta캜ke** procesa kontejnera. Podrazumevano je korisnik specificiran u metapodacima slike ako nije navedeno.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Vi코e informacija o</em> <em><strong>seLinux</strong></em></p> | **SELinux kontekst koji se primenjuje na kontejner**. Ako nije navedeno, kontejner 캖e dobiti nasumi캜an SELinux kontekst od strane kontejner runtime-a.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | **Seccomp opcije** koje se koriste za ovaj kontejner.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | **Windows specifi캜na pode코avanja** koja se primenjuju na sve kontejnere.                                                                                                                                                                                                                                                              |

## Reference

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini da podr쬴te HackTricks:

* Ako 쬰lite da vidite **ogla코avanje va코e kompanije u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
