# Kubernetes SecurityContext(s)

<details>

<summary><strong>Naucz siƒô hakowaƒá AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Je≈õli chcesz zobaczyƒá swojƒÖ **firmƒô reklamowanƒÖ w HackTricks** lub **pobraƒá HackTricks w formacie PDF**, sprawd≈∫ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobƒÖd≈∫ [**oficjalne gad≈ºety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinƒô PEASS**](https://opensea.io/collection/the-peass-family), naszƒÖ kolekcjƒô ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Do≈ÇƒÖcz do** üí¨ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **≈õled≈∫** mnie na **Twitterze** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel siƒô swoimi sztuczkami hakerskimi, przesy≈ÇajƒÖc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Z dokumentacji:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Podczas okre≈õlania kontekstu bezpiecze≈Ñstwa Podu mo≈ºna u≈ºyƒá kilku atrybut√≥w. Z punktu widzenia defensywnego bezpiecze≈Ñstwa nale≈ºy wziƒÖƒá pod uwagƒô:

* Ustawienie **runASNonRoot** na **True**
* Konfiguracjƒô **runAsUser**
* Je≈õli to mo≈ºliwe, rozwa≈º **ograniczenie** **uprawnie≈Ñ** poprzez okre≈õlenie **seLinuxOptions** i **seccompProfile**
* **NIE** udzielanie dostƒôpu do **grupy uprzywilejowanej** za pomocƒÖ **runAsGroup** i **supplementaryGroups**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>liczba ca≈Çkowita</em></p>                                                                                                                                                                                                                                                 | <p>Specjalna grupa uzupe≈ÇniajƒÖca, kt√≥ra dotyczy <strong>wszystkich kontener√≥w w podzie</strong>. Niekt√≥re typy wolumin√≥w pozwalajƒÖ Kubeletowi <strong>zmieniƒá w≈Ça≈õciciela tego woluminu</strong>, aby by≈Ç w≈Çasno≈õciƒÖ poda:<br>1. GID w≈Ça≈õciciela bƒôdzie FSGroup<br>2. Ustawiony zostanie bit setgid (nowe pliki utworzone w woluminie bƒôdƒÖ w≈Çasno≈õciƒÖ FSGroup)<br>3. Bity uprawnie≈Ñ sƒÖ OR-owane z rw-rw---- Je≈õli nie jest ustawione, Kubelet nie bƒôdzie modyfikowa≈Ç w≈Ça≈õciciela i uprawnie≈Ñ ≈ºadnego woluminu</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>≈Ça≈Ñcuch znak√≥w</em></p>                                                                                                                                                                                                                                      | Okre≈õla zachowanie **zmiany w≈Ça≈õciciela i uprawnie≈Ñ woluminu** przed udostƒôpnieniem go wewnƒÖtrz Podu.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>liczba ca≈Çkowita</em></p>                                                                                                                                                                                                                                              | **GID, pod kt√≥rym ma byƒá uruchomiony punkt wej≈õcia procesu kontenera**. U≈ºywa domy≈õlnych ustawie≈Ñ czasu wykonywania, je≈õli nie jest ustawione. Mo≈ºe byƒá r√≥wnie≈º ustawione w SecurityContext.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>warto≈õƒá logiczna</em></p>                                                                                                                                                                                                                                            | Wskazuje, ≈ºe kontener musi byƒá uruchomiony jako u≈ºytkownik nie bƒôdƒÖcy rootem. Je≈õli warto≈õƒá jest true, Kubelet sprawdzi obraz w czasie wykonywania, aby upewniƒá siƒô, ≈ºe nie jest uruchomiony jako UID 0 (root) i nie uruchomi kontenera, je≈õli tak jest.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>liczba ca≈Çkowita</em></p>                                                                                                                                                                                                                                               | **UID, pod kt√≥rym ma byƒá uruchomiony punkt wej≈õcia procesu kontenera**. Domy≈õlnie jest to u≈ºytkownik okre≈õlony w metadanych obrazu, je≈õli nie jest okre≈õlony.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Wiƒôcej informacji na temat</em> <em><strong>seLinux</strong></em></p>                                                           | **Kontekst SELinux, kt√≥ry ma byƒá zastosowany do wszystkich kontener√≥w**. Je≈õli nie jest okre≈õlony, ≈õrodowisko uruchomieniowe kontenera przydzieli losowy kontekst SELinux dla ka≈ºdego kontenera.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Wiƒôcej informacji na temat</em> <em><strong>Seccomp</strong></em></p>                                                           | **Opcje seccomp do u≈ºycia przez kontenery** w tym podzie.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>tablica liczb ca≈Çkowitych</em></p>                                                                                                                                                                                                                                | Lista **grup stosowanych do pierwszego uruchomionego procesu w ka≈ºdym kontenerze**, opr√≥cz podstawowego GID kontenera.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>tablica</em><br><em>Wiƒôcej informacji na temat</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctls zawiera listƒô **sysctls przestrzeni nazw u≈ºywanych dla poda**. Pody z nieobs≈Çugiwanymi sysctls (przez ≈õrodowisko uruchomieniowe kontenera) mogƒÖ nie uruchomiƒá siƒô.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Windowsowe ustawienia specyficzne dla wszystkich kontener√≥w. Je≈õli nie jest okre≈õlone, bƒôdƒÖ u≈ºywane opcje w ramach SecurityContext kontenera.                                                                                                                                                                                                                                                                                                                                               |
## SecurityContext

[**Z dokumentacji:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Ten kontekst jest ustawiany w **definicjach kontener√≥w**. Z perspektywy defensywnego bezpiecze≈Ñstwa nale≈ºy wziƒÖƒá pod uwagƒô:

* **allowPrivilegeEscalation** ustawione na **False**
* Nie dodawaj wra≈ºliwych **capabilities** (i usu≈Ñ te, kt√≥rych nie potrzebujesz)
* **privileged** ustawione na **False**
* Je≈õli to mo≈ºliwe, ustaw **readOnlyFilesystem** na **True**
* Ustaw **runAsNonRoot** na **True** i podaj **runAsUser**
* Je≈õli to mo≈ºliwe, rozwa≈º **ograniczenie** **uprawnie≈Ñ** poprzez okre≈õlenie **seLinuxOptions** i **seccompProfile**
* **NIE** udzielaj dostƒôpu do **grupy z uprawnieniami** poprzez **runAsGroup**

Nale≈ºy zauwa≈ºyƒá, ≈ºe atrybuty ustawione zar√≥wno w **SecurityContext**, jak i **PodSecurityContext**, warto≈õƒá okre≈õlona w **SecurityContext** ma **priorytet**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** kontroluje, czy proces mo≈ºe **uzyskaƒá wiƒôcej uprawnie≈Ñ** ni≈º jego proces nadrzƒôdny. To boolowskie pole bezpo≈õrednio kontroluje, czy flaga no\_new\_privs zostanie ustawiona dla procesu kontenera. AllowPrivilegeEscalation jest zawsze true, gdy kontener jest uruchamiany jako **Privileged** lub ma **CAP\_SYS\_ADMIN**. |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Wiƒôcej informacji na temat</em> <em><strong>Capabilities</strong></em></p>  | **Capabilities do dodania/usuniƒôcia podczas uruchamiania kontener√≥w**. Domy≈õlnie ustawione na zestaw domy≈õlnych capabilities.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Uruchom kontener w trybie privileged. Procesy w kontenerach privileged sƒÖ w zasadzie **r√≥wnowa≈ºne z rootem na ho≈õcie**. Domy≈õlnie ustawione na false.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount okre≈õla **typ montowania proc do u≈ºycia dla kontener√≥w**. Domy≈õlnie u≈ºywane sƒÖ domy≈õlne ≈õcie≈ºki tylko do odczytu i zmaskowane ≈õcie≈ºki dla kontenera.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Czy ten **kontener ma system plik√≥w root tylko do odczytu**. Domy≈õlnie ustawione na false.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | **GID, z kt√≥rego ma byƒá uruchomiony entrypoint** procesu kontenera. U≈ºywa domy≈õlnych ustawie≈Ñ czasu wykonania, je≈õli nie jest ustawione.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Wskazuje, ≈ºe kontener musi **dzia≈Çaƒá jako u≈ºytkownik nie bƒôdƒÖcy rootem**. Je≈õli true, Kubelet sprawdzi obraz w czasie wykonania, aby upewniƒá siƒô, ≈ºe nie dzia≈Ça jako UID 0 (root) i nie uruchomi kontenera, je≈õli tak jest.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | **UID, z kt√≥rego ma byƒá uruchomiony entrypoint** procesu kontenera. Domy≈õlnie u≈ºywany jest u≈ºytkownik okre≈õlony w metadanych obrazu, je≈õli nie jest okre≈õlony.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Wiƒôcej informacji na temat</em> <em><strong>seLinux</strong></em></p> | **Kontekst SELinux, kt√≥ry ma byƒá zastosowany do kontenera**. Je≈õli nie jest okre≈õlony, ≈õrodowisko wykonawcze kontenera przydzieli losowy kontekst SELinux dla ka≈ºdego kontenera.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | **Opcje seccomp** do u≈ºycia przez ten kontener.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | **Specyficzne dla systemu Windows ustawienia**, kt√≥re sƒÖ stosowane do wszystkich kontener√≥w.                                                                                                                                                                                                                                                              |

## Odwo≈Çania

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

<details>

<summary><strong>Naucz siƒô hakowaƒá AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Je≈õli chcesz zobaczyƒá swojƒÖ **firmƒô reklamowanƒÖ w HackTricks** lub **pobraƒá HackTricks w formacie PDF**, sprawd≈∫ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* ZdobƒÖd≈∫ [**oficjalne gad≈ºety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naszƒÖ kolekcjƒô ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Do≈ÇƒÖcz do** üí¨ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **≈õled≈∫** mnie na **Twitterze** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel siƒô swoimi trikami hakerskimi, przesy≈ÇajƒÖc PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
