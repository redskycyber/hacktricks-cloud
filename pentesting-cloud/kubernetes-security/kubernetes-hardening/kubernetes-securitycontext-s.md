# Kubernetes å®‰å…¨ä¸Šä¸‹æ–‡

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—® PEASS çš„æœ€æ–°ç‰ˆæœ¬æˆ–ä¸‹è½½ PDF ç‰ˆçš„ HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å–[**å®˜æ–¹ PEASS å’Œ HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°æˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)æ”¶è—å“[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–è€…åœ¨ **Twitter** ä¸Š **å…³æ³¨** æˆ‘ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) **å’Œ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

åœ¨æŒ‡å®š Pod çš„å®‰å…¨ä¸Šä¸‹æ–‡æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ªå±æ€§ã€‚ä»é˜²å¾¡å®‰å…¨çš„è§’åº¦è€ƒè™‘ï¼Œæ‚¨åº”è¯¥è€ƒè™‘ä»¥ä¸‹äº‹é¡¹ï¼š

* å°† **runASNonRoot** è®¾ç½®ä¸º **True**
* é…ç½® **runAsUser**
* å¦‚æœå¯èƒ½ï¼Œè€ƒè™‘é€šè¿‡ **seLinuxOptions** å’Œ **seccompProfile** **é™åˆ¶** **æƒé™**
* **ä¸è¦**é€šè¿‡ **runAsGroup** å’Œ **supplementaryGroups** ç»™äºˆ **ç‰¹æƒç»„** è®¿é—®æƒé™

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>æ•´æ•°</em></p>                                                                                                                                                                                                                                                 | <p>é€‚ç”¨äº<strong>Pod ä¸­æ‰€æœ‰å®¹å™¨çš„ç‰¹æ®Šé™„åŠ ç»„</strong>ã€‚æŸäº›å·ç±»å‹å…è®¸ Kubelet å°†è¯¥å·çš„æ‰€æœ‰æƒæ›´æ”¹ä¸ºç”± Pod æ‹¥æœ‰ï¼š<br>1. æ‹¥æœ‰çš„ GID å°†æ˜¯ FSGroup<br>2. è®¾ç½® setgid ä½ï¼ˆåœ¨å·ä¸­åˆ›å»ºçš„æ–°æ–‡ä»¶å°†ç”± FSGroup æ‹¥æœ‰ï¼‰<br>3. æƒé™ä½ä¸ rw-rw---- è¿›è¡Œ OR è¿ç®—ã€‚å¦‚æœæœªè®¾ç½®ï¼ŒKubelet å°†ä¸ä¼šä¿®æ”¹ä»»ä½•å·çš„æ‰€æœ‰æƒå’Œæƒé™</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>å­—ç¬¦ä¸²</em></p>                                                                                                                                                                                                                                      | è¿™å®šä¹‰äº†åœ¨æš´éœ²åˆ° Pod å†…éƒ¨ä¹‹å‰æ›´æ”¹å·çš„æ‰€æœ‰æƒå’Œæƒé™çš„è¡Œä¸ºã€‚                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>æ•´æ•°</em></p>                                                                                                                                                                                                                                              | å®¹å™¨è¿›ç¨‹å…¥å£ç‚¹è¿è¡Œçš„ GIDã€‚å¦‚æœæœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨è¿è¡Œæ—¶é»˜è®¤å€¼ã€‚ä¹Ÿå¯ä»¥åœ¨ SecurityContext ä¸­è®¾ç½®ã€‚                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>å¸ƒå°”å€¼</em></p>                                                                                                                                                                                                                                            | è¡¨ç¤ºå®¹å™¨å¿…é¡»ä»¥é root ç”¨æˆ·èº«ä»½è¿è¡Œã€‚å¦‚æœä¸º trueï¼Œåˆ™ Kubelet å°†åœ¨è¿è¡Œæ—¶éªŒè¯é•œåƒï¼Œä»¥ç¡®ä¿å…¶ä¸ä»¥ UID 0ï¼ˆrootï¼‰è¿è¡Œï¼Œå¹¶åœ¨å…¶ä»¥æ­¤æ–¹å¼è¿è¡Œæ—¶æ— æ³•å¯åŠ¨å®¹å™¨ã€‚                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>æ•´æ•°</em></p>                                                                                                                                                                                                                                               | å®¹å™¨è¿›ç¨‹å…¥å£ç‚¹è¿è¡Œçš„ UIDã€‚å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤ä¸ºå›¾åƒå…ƒæ•°æ®ä¸­æŒ‡å®šçš„ç”¨æˆ·ã€‚                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>æœ‰å…³</em> <em><strong>seLinux</strong></em> çš„æ›´å¤šä¿¡æ¯</p>                                                           | è¦åº”ç”¨äºæ‰€æœ‰å®¹å™¨çš„ **SELinux ä¸Šä¸‹æ–‡**ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå®¹å™¨è¿è¡Œæ—¶å°†ä¸ºæ¯ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªéšæœºçš„ SELinux ä¸Šä¸‹æ–‡ã€‚                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>æœ‰å…³</em> <em><strong>Seccomp</strong></em> çš„æ›´å¤šä¿¡æ¯</p>                                                           | è¯¥ Pod ä¸­å®¹å™¨ä½¿ç”¨çš„ **seccomp é€‰é¡¹**ã€‚                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>æ•´æ•°æ•°ç»„</em></p>                                                                                                                                                                                                                                | é™„åŠ åˆ°æ¯ä¸ªå®¹å™¨ä¸­ç¬¬ä¸€ä¸ªè¿è¡Œçš„è¿›ç¨‹çš„ **ç»„åˆ—è¡¨**ï¼Œé™¤äº†å®¹å™¨çš„ä¸»è¦ GIDã€‚                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>æ•°ç»„</em><br><em>æœ‰å…³</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a> çš„æ›´å¤šä¿¡æ¯</p> | Sysctls åŒ…å«ç”¨äº Pod çš„ **å‘½åç©ºé—´ sysctl åˆ—è¡¨**ã€‚ä½¿ç”¨ä¸å—å®¹å™¨è¿è¡Œæ—¶æ”¯æŒçš„ sysctlï¼ˆå¯èƒ½æ— æ³•å¯åŠ¨ï¼‰çš„ Pod å¯èƒ½ä¼šå¤±è´¥ã€‚                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | åº”ç”¨äºæ‰€æœ‰å®¹å™¨çš„ Windows ç‰¹å®šè®¾ç½®ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨å®¹å™¨çš„ SecurityContext ä¸­çš„é€‰é¡¹ã€‚                                                                                                                                                                                                                                                                                                                                               |
## SecurityContext

è¿™ä¸ªä¸Šä¸‹æ–‡æ˜¯åœ¨**å®¹å™¨å®šä¹‰**ä¸­è®¾ç½®çš„ã€‚ä»é˜²å¾¡å®‰å…¨çš„è§’åº¦è€ƒè™‘ï¼Œæ‚¨åº”è¯¥è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š

* å°†**allowPrivilegeEscalation**è®¾ç½®ä¸º**False**
* ä¸è¦æ·»åŠ æ•æ„Ÿçš„**capabilities**ï¼ˆå¹¶åˆ é™¤ä¸éœ€è¦çš„capabilitiesï¼‰
* å°†**privileged**è®¾ç½®ä¸º**False**
* å¦‚æœå¯èƒ½ï¼Œå°†**readOnlyFilesystem**è®¾ç½®ä¸º**True**
* å°†**runAsNonRoot**è®¾ç½®ä¸º**True**å¹¶è®¾ç½®ä¸€ä¸ª**runAsUser**
* å¦‚æœå¯èƒ½ï¼Œè€ƒè™‘é€šè¿‡æŒ‡å®š**seLinuxOptions**å’Œ**seccompProfile**æ¥**é™åˆ¶**æƒé™
* **ä¸è¦**é€šè¿‡**runAsGroup**ç»™äºˆ**privilege group**è®¿é—®æƒé™ã€‚

è¯·æ³¨æ„ï¼Œ**SecurityContextå’ŒPodSecurityContext**ä¸­è®¾ç½®çš„å±æ€§ï¼Œä»¥**SecurityContext**ä¸­æŒ‡å®šçš„å€¼ä¸ºå‡†ã€‚

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **allowPrivilegeEscalation** æ§åˆ¶ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦å¯ä»¥æ¯”å…¶çˆ¶è¿›ç¨‹è·å¾—æ›´å¤šçš„æƒé™ã€‚è¿™ä¸ªå¸ƒå°”å€¼ç›´æ¥æ§åˆ¶å®¹å™¨è¿›ç¨‹ä¸Šæ˜¯å¦è®¾ç½® no_new_privs æ ‡å¿—ã€‚å½“å®¹å™¨ä»¥**ç‰¹æƒæ¨¡å¼**è¿è¡Œæˆ–å…·æœ‰**CAP_SYS_ADMIN**æ—¶ï¼ŒallowPrivilegeEscalationå§‹ç»ˆä¸ºtrue |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>æœ‰å…³</em> <em><strong>Capabilities</strong></em> çš„æ›´å¤šä¿¡æ¯</p>  | è¿è¡Œå®¹å™¨æ—¶è¦æ·»åŠ /åˆ é™¤çš„**capabilities**ã€‚é»˜è®¤ä¸ºé»˜è®¤çš„capabilitiesé›†åˆã€‚                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | åœ¨ç‰¹æƒæ¨¡å¼ä¸‹è¿è¡Œå®¹å™¨ã€‚ç‰¹æƒå®¹å™¨ä¸­çš„è¿›ç¨‹åŸºæœ¬ä¸Šç­‰åŒäºä¸»æœºä¸Šçš„rootç”¨æˆ·ã€‚é»˜è®¤ä¸ºfalseã€‚                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMountè¡¨ç¤ºå®¹å™¨ä½¿ç”¨çš„proc mountç±»å‹ã€‚é»˜è®¤å€¼ä¸ºDefaultProcMountï¼Œå®ƒä½¿ç”¨å®¹å™¨è¿è¡Œæ—¶é»˜è®¤çš„åªè¯»è·¯å¾„å’Œæ©ç è·¯å¾„ã€‚                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | æ­¤å®¹å™¨æ˜¯å¦å…·æœ‰åªè¯»çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚é»˜è®¤å€¼ä¸ºfalseã€‚                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | å®¹å™¨è¿›ç¨‹çš„å…¥å£ç‚¹è¿è¡Œçš„GIDã€‚å¦‚æœæœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨è¿è¡Œæ—¶é»˜è®¤å€¼ã€‚                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | è¡¨ç¤ºå®¹å™¨å¿…é¡»ä»¥érootç”¨æˆ·èº«ä»½è¿è¡Œã€‚å¦‚æœä¸ºtrueï¼ŒKubeletå°†åœ¨è¿è¡Œæ—¶éªŒè¯é•œåƒï¼Œä»¥ç¡®ä¿å…¶ä¸ä»¥UID 0ï¼ˆrootï¼‰è¿è¡Œï¼Œå¹¶åœ¨å…¶ä»¥æ­¤æ–¹å¼è¿è¡Œæ—¶å¤±è´¥ä»¥å¯åŠ¨å®¹å™¨ã€‚                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | å®¹å™¨è¿›ç¨‹çš„å…¥å£ç‚¹è¿è¡Œçš„UIDã€‚å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤ä¸ºé•œåƒå…ƒæ•°æ®ä¸­æŒ‡å®šçš„ç”¨æˆ·ã€‚                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>æœ‰å…³</em> <em><strong>seLinux</strong></em> çš„æ›´å¤šä¿¡æ¯</p> | è¦åº”ç”¨äºå®¹å™¨çš„**SELinuxä¸Šä¸‹æ–‡**ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå®¹å™¨è¿è¡Œæ—¶å°†ä¸ºæ¯ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªéšæœºçš„SELinuxä¸Šä¸‹æ–‡ã€‚                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | æ­¤å®¹å™¨è¦ä½¿ç”¨çš„**seccompé€‰é¡¹**ã€‚                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | åº”ç”¨äºæ‰€æœ‰å®¹å™¨çš„**Windowsç‰¹å®šè®¾ç½®**ã€‚                                                                                                                                                                                                                                                              |

## å‚è€ƒèµ„æ–™

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

<details>

<summary><strong>æ”¯æŒ HackTricks å¹¶è·å¾—ç¦åˆ©ï¼</strong></summary>

* å¦‚æœæ‚¨æƒ³åœ¨ HackTricks ä¸­çœ‹åˆ°æ‚¨çš„å…¬å¸å¹¿å‘Šï¼Œæˆ–è€…å¦‚æœæ‚¨æƒ³è®¿é—®æœ€æ–°ç‰ˆæœ¬çš„ PEASS æˆ–ä¸‹è½½ PDF ç‰ˆçš„ HackTricksï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* è·å¾—[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* å‘ç°[**The PEASS Family**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[NFT](https://opensea.io/collection/the-peass-family)æ”¶è—å“
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass)ï¼Œæˆ–åœ¨ **Twitter** ä¸Š **å…³æ³¨**æˆ‘ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚**

</details>
