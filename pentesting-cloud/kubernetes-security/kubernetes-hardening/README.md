# Kubernetes Hardening

<details>

<summary><strong>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ç‰¹å…¸ã‚’å¾—ã‚‹ï¼</strong></summary>

* **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„**å ´åˆã‚„ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼ã®PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter**ã§ç§ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€PRã‚’** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ã¨** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>

## ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’åˆ†æã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«

### Kubescape

[**Kubescape**](https://github.com/armosec/kubescape)ã¯ã€K8sã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€ãƒªã‚¹ã‚¯åˆ†æã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã€RBACãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ã€ãŠã‚ˆã³ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã‚’å«ã‚€ã€ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰K8sã®ã‚·ãƒ³ã‚°ãƒ«ãƒšã‚¤ãƒ³ã‚ªãƒ–ã‚°ãƒ©ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚ Kubescapeã¯ã€K8sã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã€YAMLãƒ•ã‚¡ã‚¤ãƒ«ã€HELMãƒãƒ£ãƒ¼ãƒˆã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€[NSA-CISA](https://www.armosec.io/blog/kubernetes-hardening-guidance-summary-by-armo)ã€[MITRE ATT\&CKÂ®](https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/)ãªã©ã®è¤‡æ•°ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«åŸºã¥ã„ã¦ãƒŸã‚¹ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®è„†å¼±æ€§ã€ãŠã‚ˆã³RBACï¼ˆãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰ã®é•åã‚’æ¤œå‡ºã—ã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®åˆæœŸæ®µéšã§ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢ã‚’å³åº§ã«è¨ˆç®—ã—ã€æ™‚é–“ã®çµŒéã«ä¼´ã†ãƒªã‚¹ã‚¯ã®å‚¾å‘ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```bash
kubescape scan --verbose
```

### Kube-bench

[**kube-bench**](https://github.com/aquasecurity/kube-bench)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã¯ã€[**CIS Kubernetes Benchmark**](https://www.cisecurity.org/benchmark/kubernetes/)ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ã€KubernetesãŒå®‰å…¨ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚\
æ¬¡ã®æ–¹æ³•ã§å®Ÿè¡Œã§ãã¾ã™ï¼š

* ãƒ›ã‚¹ãƒˆã¨PIDåå‰ç©ºé–“ã‚’å…±æœ‰ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰kube-benchã‚’å®Ÿè¡Œã™ã‚‹
* ãƒ›ã‚¹ãƒˆã«kube-benchã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã—ã€ãã®å¾Œãƒ›ã‚¹ãƒˆä¸Šã§kube-benchã‚’ç›´æ¥å®Ÿè¡Œã™ã‚‹
* [ãƒªãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¸](https://github.com/aquasecurity/kube-bench/releases)ã‹ã‚‰æœ€æ–°ã®ãƒã‚¤ãƒŠãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
* ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹

### Kubeaudit

[**kubeaudit**](https://github.com/Shopify/kubeaudit)ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã¯ã€ã•ã¾ã–ã¾ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ‡¸å¿µäº‹é …ã«å¯¾ã—ã¦Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ã‚’ç›£æŸ»ã™ã‚‹ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ãŠã‚ˆã³Goãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚

Kubeauditã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®ã‚³ãƒ³ãƒ†ãƒŠã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã†ã§ã‚ã‚Œã°ã€ãã®ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®ã™ã¹ã¦ã®Kubernetesãƒªã‚½ãƒ¼ã‚¹ã‚’ç›£æŸ»ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚

```
kubeaudit all
```

ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¯ã€æ¤œå‡ºã•ã‚ŒãŸå•é¡Œã‚’**è‡ªå‹•çš„ã«ä¿®æ­£ã™ã‚‹**ãŸã‚ã®å¼•æ•° `autofix` ã‚‚ã‚ã‚Šã¾ã™ã€‚

### **Kube-hunter**

ãƒ„ãƒ¼ãƒ« [**kube-hunter**](https://github.com/aquasecurity/kube-hunter) ã¯ã€Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®è„†å¼±æ€§ã‚’æ¢ã—å‡ºã—ã¾ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€Kubernetes ç’°å¢ƒã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã«å¯¾ã™ã‚‹èªè­˜ã¨å¯è¦–æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã«é–‹ç™ºã•ã‚Œã¾ã—ãŸã€‚

```bash
kube-hunter --remote some.node.com
```

### **Kubei**

[**Kubei**](https://github.com/Erezf-p/kubei)ã¯ã€Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®æ­£ç¢ºã§å³æ™‚ã®ãƒªã‚¹ã‚¯è©•ä¾¡ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æä¾›ã™ã‚‹è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ãŠã‚ˆã³CIS Dockerãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚Kubeiã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ‰ã¨ã‚·ã‚¹ãƒ†ãƒ ãƒãƒƒãƒ‰ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å«ã‚€ã€Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚

### KubiScan

[**KubiScan**](https://github.com/cyberark/KubiScan)ã¯ã€Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã€Kubernetesã®ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰èªå¯ãƒ¢ãƒ‡ãƒ«ã§ã®ãƒªã‚¹ã‚­ãƒ¼ãªæ¨©é™ã‚’æ¤œå‡ºã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

## **IaCã‚³ãƒ¼ãƒ‰ã®ç›£æŸ»**

### **Popeye**

[**Popeye**](https://github.com/derailed/popeye)ã¯ã€ãƒ©ã‚¤ãƒ–ãªKubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€**ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã¨è¨­å®šã«æ½œåœ¨çš„ãªå•é¡Œã‚’å ±å‘Š**ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã§ã™ã€‚ãƒ‡ã‚£ã‚¹ã‚¯ä¸Šã«ã‚ã‚‹ã‚‚ã®ã§ã¯ãªãã€ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã«åŸºã¥ã„ã¦ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«ã—ã¾ã™ã€‚ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã“ã¨ã§ã€èª¤ã£ãŸè¨­å®šã‚’æ¤œå‡ºã—ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€å°†æ¥ã®å•é¡Œã‚’é˜²ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’é‹ç”¨ã™ã‚‹éš›ã«ç›´é¢ã™ã‚‹èªçŸ¥ã®è² è·ã‚’è»½æ¸›ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€ãƒªã‚½ãƒ¼ã‚¹ã®éå‰°/ä¸è¶³å‰²ã‚Šå½“ã¦ã®å¯èƒ½æ€§ã‚’å ±å‘Šã—ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å®¹é‡ãŒä¸è¶³ã™ã‚‹å ´åˆã«è­¦å‘Šã‚’è©¦ã¿ã¾ã™ã€‚

### **Kicks**

[**KICS**](https://github.com/Checkmarx/kics)ã¯ã€æ¬¡ã®**ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚³ãƒ¼ãƒ‰ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³**ã§ã‚ã‚‹Terraformã€Kubernetesã€Dockerã€AWS CloudFormationã€Ansibleã€Helmã€Microsoft ARMã€ãŠã‚ˆã³OpenAPI 3.0ã®ä»•æ§˜ã«ãŠã„ã¦ã€**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è„†å¼±æ€§**ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã®å•é¡Œã€ãŠã‚ˆã³ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®èª¤æ§‹æˆã‚’æ¤œå‡ºã—ã¾ã™ã€‚

### Checkov

[**Checkov**](https://github.com/bridgecrewio/checkov)ã¯ã€ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚³ãƒ¼ãƒ‰ã®é™çš„ã‚³ãƒ¼ãƒ‰åˆ†æãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

Terraformã€Terraformãƒ—ãƒ©ãƒ³ã€Cloudformationã€AWS SAMã€Kubernetesã€Dockerfileã€Serverlessã€ã¾ãŸã¯ARMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€ã‚°ãƒ©ãƒ•ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŠã‚ˆã³ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã®èª¤æ§‹æˆã‚’æ¤œå‡ºã—ã¾ã™ã€‚

### Kube-score

[**kube-score**](https://github.com/zegl/kube-score)ã¯ã€Kubernetesã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå®šç¾©ã®é™çš„ã‚³ãƒ¼ãƒ‰åˆ†æã‚’å®Ÿè¡Œã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ï¼š

| ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³                                      | ã‚³ãƒãƒ³ãƒ‰/ãƒªãƒ³ã‚¯                                                                                |
| ------------------------------------------------ | --------------------------------------------------------------------------------------- |
| macOSã€Linuxã€Windowsç”¨ã®ãƒ—ãƒªãƒ“ãƒ«ãƒ‰ãƒã‚¤ãƒŠãƒª                   | [GitHubãƒªãƒªãƒ¼ã‚¹](https://github.com/zegl/kube-score/releases)                               |
| Docker                                           | `docker pull zegl/kube-score` ([Docker Hub)](https://hub.docker.com/r/zegl/kube-score/) |
| Homebrewï¼ˆmacOSãŠã‚ˆã³Linuxï¼‰                          | `brew install kube-score`                                                               |
| [Krew](https://krew.sigs.k8s.io/)ï¼ˆmacOSãŠã‚ˆã³Linuxï¼‰ | `kubectl krew install score`                                                            |

## ãƒ’ãƒ³ãƒˆ

### Falcoã«ã‚ˆã‚‹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

{% content-ref url="broken-reference" %}
[Broken link](broken-reference)
{% endcontent-ref %}

### Kubernetes PodSecurityContextã¨SecurityContext

**Podã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ï¼ˆ\_PodSecurityContext\_ã‚’ä½¿ç”¨ï¼‰ãŠã‚ˆã³å®Ÿè¡Œã•ã‚Œã‚‹**ã‚³ãƒ³ãƒ†ãƒŠ**ã®**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ï¼ˆ\_SecurityContext\_ã‚’ä½¿ç”¨ï¼‰ã‚’è¨­å®šã§ãã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€æ¬¡ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

{% content-ref url="kubernetes-securitycontext-s.md" %}
[kubernetes-securitycontext-s.md](kubernetes-securitycontext-s.md)
{% endcontent-ref %}

### Kubernetes APIã®ãƒãƒ¼ãƒ‰ãƒ‹ãƒ³ã‚°

æ‚ªæ„ã®ã‚ã‚‹ã‚¢ã‚¯ã‚¿ãƒ¼ãŒååˆ†ãªç‰¹æ¨©ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã€Kubernetes APIã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’**ä¿è­·ã™ã‚‹ã“ã¨ã¯éå¸¸ã«é‡è¦**ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç’°å¢ƒãŒã•ã¾ã–ã¾ãªæ–¹æ³•ã§æ‚ªå½±éŸ¿ã‚’å—ã‘ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\
**ã‚¢ã‚¯ã‚»ã‚¹**ï¼ˆAPIã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹å…ƒã‚’ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ç™»éŒ²ã—ã€ä»–ã®æ¥ç¶šã‚’æ‹’å¦ã™ã‚‹ï¼‰ã¨[**èªè¨¼**](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-authentication-authorization/)ï¼ˆ**æœ€å°ç‰¹æ¨©**ã®åŸå‰‡ã«å¾“ã†ï¼‰ã®ä¸¡æ–¹ã‚’ç¢ºä¿ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ãã—ã¦ã€**æ±ºã—ã¦\*\*\*\*åŒ¿åã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ã‚’è¨±å¯ã—ãªã„ã§ãã ã•ã„ã€‚

**ä¸€èˆ¬çš„ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ—ãƒ­ã‚»ã‚¹**ï¼š\
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯K8s ServiceAccount â€“> èªè¨¼ â€“> èªå¯ â€“> å…¥å ´åˆ¶å¾¡ã€‚

**ãƒ’ãƒ³ãƒˆ**ï¼š

* ãƒãƒ¼ãƒˆã‚’é–‰ã˜ã‚‹ã€‚
* åŒ¿åã‚¢ã‚¯ã‚»ã‚¹ã‚’é¿ã‘ã‚‹ã€‚
* NodeRestrictionï¼šç‰¹å®šã®ãƒãƒ¼ãƒ‰ã‹ã‚‰APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ãªã„ã€‚
* [https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction](https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction)
* åŸºæœ¬çš„ã«ã¯ã€kubeletãŒãƒãƒ¼ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã®åˆ†é›¢ç›®çš„ã§ãƒ©ãƒ™ãƒ«ä»˜ã‘ã™ã‚‹ãŸã‚ã«äºˆç´„ã•ã‚Œã¦ã„ã‚‹node-restriction.kubernetes.io/æ¥é ­è¾ã‚’æŒã¤ãƒ©ãƒ™ãƒ«ã®è¿½åŠ /å‰Šé™¤/æ›´æ–°ã‚’kubeletãŒè¨±å¯ã—ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
* ã¾ãŸã€kubeletãŒã“ã‚Œã‚‰ã®ãƒ©ãƒ™ãƒ«ã¨ãƒ©ãƒ™ãƒ«ã®æ¥é ­è¾ã‚’è¿½åŠ /å‰Šé™¤/æ›´æ–°ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
* ãƒ©ãƒ™ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã®åˆ†é›¢ã‚’ç¢ºä¿ã—ã¾ã™ã€‚
* ç‰¹å®šã®ãƒãƒƒãƒ‰ãŒAPIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã€‚
* ApiServerã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«å…¬é–‹ã—ãªã„ã€‚
* ä¸æ­£ãªã‚¢ã‚¯ã‚»ã‚¹RBACã‚’é¿ã‘ã‚‹ã€‚
* ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¨IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã¦ApiServerãƒãƒ¼ãƒˆã‚’ä¿è­·ã™ã‚‹ã€‚

### SecurityContextã®ãƒãƒ¼ãƒ‰ãƒ‹ãƒ³ã‚°

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€PodãŒèµ·å‹•ã•ã‚Œã‚‹ã¨ãã«ã¯rootãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚æ¬¡ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚ˆã†ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€ã‚ˆã‚Šå®‰å…¨ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã¾ã™ï¼š

```yaml
apiVersion: v1
kind: Pod
metadata:
name: security-context-demo
spec:
securityContext:
runAsUser: 1000
runAsGroup: 3000
fsGroup: 2000
volumes:
- name: sec-ctx-vol
emptyDir: {}
containers:
- name: sec-ctx-demo
image: busybox
command: [ "sh", "-c", "sleep 1h" ]
securityContext:
runAsNonRoot: true
volumeMounts:
- name: sec-ctx-vol
mountPath: /data/demo
securityContext:
allowPrivilegeEscalation: true
```

* [https://kubernetes.io/docs/tasks/configure-pod-container/security-context/](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)
* [https://kubernetes.io/docs/concepts/policy/pod-security-policy/](https://kubernetes.io/docs/concepts/policy/pod-security-policy/)

### Kubernetes NetworkPolicies

{% content-ref url="broken-reference" %}
[Broken link](broken-reference)
{% endcontent-ref %}

### ä¸€èˆ¬çš„ãªãƒãƒ¼ãƒ‰ãƒ‹ãƒ³ã‚°

å¿…è¦ã«å¿œã˜ã¦Kubernetesç’°å¢ƒã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«é »ç¹ã«æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

* ä¾å­˜é–¢ä¿‚ã‚’æœ€æ–°ã®çŠ¶æ…‹ã«ä¿ã¤ã€‚
* ãƒã‚°ä¿®æ­£ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒã‚’é©ç”¨ã™ã‚‹ã€‚

[**ãƒªãƒªãƒ¼ã‚¹ã‚µã‚¤ã‚¯ãƒ«**](https://kubernetes.io/docs/setup/release/version-skew-policy/)ï¼š3ãƒ¶æœˆã”ã¨ã«æ–°ã—ã„ãƒã‚¤ãƒŠãƒ¼ãƒªãƒªãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ -- 1.20.3 = 1(ãƒ¡ã‚¸ãƒ£ãƒ¼).20(ãƒã‚¤ãƒŠãƒ¼).3(ãƒ‘ãƒƒãƒ)

**Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ã‚’æ›´æ–°ã™ã‚‹æœ€è‰¯ã®æ–¹æ³•ã¯ï¼ˆ**[**ã“ã¡ã‚‰**](https://kubernetes.io/docs/tasks/administer-cluster/cluster-upgrade/)**ï¼‰ï¼š**

* ä»¥ä¸‹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å¾“ã£ã¦ãƒã‚¹ã‚¿ãƒ¼ãƒãƒ¼ãƒ‰ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ï¼š
* etcdï¼ˆã™ã¹ã¦ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰ã€‚
* kube-apiserverï¼ˆã™ã¹ã¦ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ›ã‚¹ãƒˆï¼‰ã€‚
* kube-controller-managerã€‚
* kube-schedulerã€‚
* ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚‚ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã€‚
* kube-proxyã€kubeletãªã©ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒ‰ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã€‚

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* **HackTricksã§ä¼šç¤¾ã‚’å®£ä¼ã—ãŸã„**å ´åˆã‚„ã€**PEASSã®æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„**å ´åˆã¯ã€[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ã‚’ã”ç¢ºèªãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’æ‰‹ã«å…¥ã‚Œã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’è¦‹ã¤ã‘ã¦ã€ç‹¬å çš„ãª[**NFT**](https://opensea.io/collection/the-peass-family)ã‚’å…¥æ‰‹ã™ã‚‹
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
