# Kubernetes SertleÅŸtirme

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonunu
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**'u takip edin**.
* **Hacking hilelerinizi paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR gÃ¶nderin**.

</details>

## Bir kÃ¼me analiz etmek iÃ§in araÃ§lar

### [**Kubescape**](https://github.com/armosec/kubescape)

[**Kubescape**](https://github.com/armosec/kubescape), Ã§oklu bulut K8s tek bir pencere sunan, risk analizi, gÃ¼venlik uyumluluÄŸu, RBAC gÃ¶rselleÅŸtirici ve gÃ¶rÃ¼ntÃ¼ zafiyet taramasÄ± saÄŸlayan bir K8s aÃ§Ä±k kaynaklÄ± araÃ§tÄ±r. Kubescape, K8s kÃ¼melerini, YAML dosyalarÄ±nÄ± ve HELM grafiklerini tarar, Ã§oklu Ã§erÃ§evelere (Ã¶rneÄŸin [NSA-CISA](https://www.armosec.io/blog/kubernetes-hardening-guidance-summary-by-armo), [MITRE ATT\&CKÂ®](https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/)) gÃ¶re yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ±, yazÄ±lÄ±m zafiyetlerini ve RBAC (rol-tabanlÄ± eriÅŸim kontrolÃ¼) ihlallerini CI/CD boru hattÄ±nÄ±n erken aÅŸamalarÄ±nda tespit eder, risk puanÄ±nÄ± anÄ±nda hesaplar ve zaman iÃ§indeki risk eÄŸilimlerini gÃ¶sterir.
```bash
kubescape scan --verbose
```
### [**Kube-bench**](https://github.com/aquasecurity/kube-bench)

[**kube-bench**](https://github.com/aquasecurity/kube-bench) aracÄ±, [**CIS Kubernetes Benchmark**](https://www.cisecurity.org/benchmark/kubernetes/) belgelerinde belirtilen kontrolleri Ã§alÄ±ÅŸtÄ±rarak Kubernetes'in gÃ¼venli bir ÅŸekilde daÄŸÄ±tÄ±lÄ±p daÄŸÄ±tÄ±lmadÄ±ÄŸÄ±nÄ± kontrol eden bir araÃ§tÄ±r.\
AÅŸaÄŸÄ±daki seÃ§eneklerden birini seÃ§ebilirsiniz:

* kube-bench'i bir konteyner iÃ§inden Ã§alÄ±ÅŸtÄ±rabilirsiniz (ana bilgisayarla PID alanÄ±nÄ± paylaÅŸÄ±r)
* ana bilgisayara kube-bench'i yÃ¼kleyen bir konteyner Ã§alÄ±ÅŸtÄ±rabilir ve ardÄ±ndan kube-bench'i doÄŸrudan ana bilgisayarda Ã§alÄ±ÅŸtÄ±rabilirsiniz
* [YayÄ±nlar sayfasÄ±ndan](https://github.com/aquasecurity/kube-bench/releases) en son ikili dosyalarÄ± yÃ¼kleyebilirsiniz,
* kaynak kodundan derleyebilirsiniz.

### [**Kubeaudit**](https://github.com/Shopify/kubeaudit)

[**kubeaudit**](https://github.com/Shopify/kubeaudit) aracÄ±, Ã§eÅŸitli gÃ¼venlik endiÅŸeleri iÃ§in Kubernetes kÃ¼melerini denetlemek iÃ§in bir komut satÄ±rÄ± aracÄ± ve Go paketidir.

Kubeaudit, bir kÃ¼medeki bir konteyner iÃ§inde Ã§alÄ±ÅŸtÄ±rÄ±lÄ±p Ã§alÄ±ÅŸtÄ±rÄ±lmadÄ±ÄŸÄ±nÄ± tespit edebilir. EÄŸer Ã¶yleyse, kÃ¼medeki tÃ¼m Kubernetes kaynaklarÄ±nÄ± denetlemeye Ã§alÄ±ÅŸacaktÄ±r:
```
kubeaudit all
```
Bu araÃ§ ayrÄ±ca tespit edilen sorunlarÄ± otomatik olarak dÃ¼zeltmek iÃ§in `autofix` argÃ¼manÄ±na sahiptir.

### [**Kube-hunter**](https://github.com/aquasecurity/kube-hunter)

[**kube-hunter**](https://github.com/aquasecurity/kube-hunter) aracÄ±, Kubernetes kÃ¼mesindeki gÃ¼venlik zayÄ±flÄ±klarÄ±nÄ± arar. AraÃ§, Kubernetes ortamlarÄ±ndaki gÃ¼venlik sorunlarÄ±na yÃ¶nelik farkÄ±ndalÄ±ÄŸÄ± ve gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ artÄ±rmak amacÄ±yla geliÅŸtirilmiÅŸtir.
```bash
kube-hunter --remote some.node.com
```
### [**Kubei**](https://github.com/Erezf-p/kubei)

[**Kubei**](https://github.com/Erezf-p/kubei), kubernetes kÃ¼melerinin doÄŸru ve hÄ±zlÄ± bir ÅŸekilde risk deÄŸerlendirmesini yapabilen bir zafiyet tarama ve CIS Docker benchmark aracÄ±dÄ±r. Kubei, uygulama podlarÄ± ve sistem podlarÄ± dahil olmak Ã¼zere bir Kubernetes kÃ¼mesinde kullanÄ±lan tÃ¼m gÃ¶rÃ¼ntÃ¼leri tarar.

### [**KubiScan**](https://github.com/cyberark/KubiScan)

[**KubiScan**](https://github.com/cyberark/KubiScan), Kubernetes kÃ¼mesini Kubernetes'in Rol tabanlÄ± eriÅŸim kontrolÃ¼ (RBAC) yetkilendirme modelinde riskli izinler aÃ§Ä±sÄ±ndan tarayan bir araÃ§tÄ±r.

## **IaC Kodunu Denetleme**

### [**Popeye**](https://github.com/derailed/popeye)

[**Popeye**](https://github.com/derailed/popeye), canlÄ± bir Kubernetes kÃ¼mesini tarayan ve **daÄŸÄ±tÄ±lan kaynaklar ve yapÄ±landÄ±rmalarla ilgili potansiyel sorunlarÄ± raporlayan** bir yardÄ±mcÄ± programdÄ±r. Diskte bulunanlara deÄŸil, daÄŸÄ±tÄ±lanlara dayanarak kÃ¼menizi temizler. KÃ¼menizi tarayarak yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± tespit eder ve en iyi uygulamalarÄ±n yerine getirilmesini saÄŸlar, bÃ¶ylece gelecekteki baÅŸ aÄŸrÄ±larÄ±nÄ± Ã¶nler. VahÅŸi doÄŸada bir Kubernetes kÃ¼mesini iÅŸletirken karÅŸÄ±laÅŸÄ±lan biliÅŸsel yÃ¼kÃ¼ azaltmayÄ± amaÃ§lar. AyrÄ±ca, kÃ¼meniz bir Ã¶lÃ§Ã¼m sunucusu kullanÄ±yorsa, potansiyel kaynak aÅŸÄ±rÄ±/eksik tahsislerini raporlar ve kÃ¼menizin kapasitesi tÃ¼kendiÄŸinde sizi uyarÄ±r.

### [**KICS**](https://github.com/Checkmarx/kics)

[**KICS**](https://github.com/Checkmarx/kics), aÅŸaÄŸÄ±daki **AltyapÄ± olarak Kod** Ã§Ã¶zÃ¼mlerinde gÃ¼venlik aÃ§Ä±klarÄ±, uyumluluk sorunlarÄ± ve altyapÄ± yanlÄ± yapÄ±landÄ±rmalarÄ±nÄ± bulur: Terraform, Kubernetes, Docker, AWS CloudFormation, Ansible, Helm, Microsoft ARM ve OpenAPI 3.0 Ã¶zellikleri

### [**Checkov**](https://github.com/bridgecrewio/checkov)

[**Checkov**](https://github.com/bridgecrewio/checkov), altyapÄ± olarak kod iÃ§in bir statik kod analizi aracÄ±dÄ±r.

[Terraform](https://terraform.io), Terraform plan, [Cloudformation](https://aws.amazon.com/cloudformation/), [AWS SAM](https://aws.amazon.com/serverless/sam/), [Kubernetes](https://kubernetes.io), [Dockerfile](https://www.docker.com), [Serverless](https://www.serverless.com) veya [ARM ÅablonlarÄ±](https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview) kullanarak oluÅŸturulan bulut altyapÄ±sÄ±nÄ± tarar ve graf tabanlÄ± tarama kullanarak gÃ¼venlik ve uyumluluk yanlÄ± yapÄ±landÄ±rmalarÄ±nÄ± tespit eder.

### [**Kube-score**](https://github.com/zegl/kube-score)

[**kube-score**](https://github.com/zegl/kube-score), Kubernetes nesne tanÄ±mlarÄ±nÄ±zÄ±n statik kod analizini gerÃ§ekleÅŸtiren bir araÃ§tÄ±r.

Kurulum iÃ§in:

| DaÄŸÄ±tÄ±m                                             | Komut / BaÄŸlantÄ±                                                                        |
| --------------------------------------------------- | --------------------------------------------------------------------------------------- |
| macOS, Linux ve Windows iÃ§in derlenmiÅŸ ikili dosyalar | [GitHub sÃ¼rÃ¼mleri](https://github.com/zegl/kube-score/releases)                          |
| Docker                                              | `docker pull zegl/kube-score` ([Docker Hub)](https://hub.docker.com/r/zegl/kube-score/) |
| Homebrew (macOS ve Linux)                          | `brew install kube-score`                                                               |
| [Krew](https://krew.sigs.k8s.io/) (macOS ve Linux) | `kubectl krew install score`                                                            |

## Ä°puÃ§larÄ±

### Kubernetes PodSecurityContext ve SecurityContext

**PodSecurityContext** ile Pod'larÄ±n gÃ¼venlik baÄŸlamÄ±nÄ± ve **SecurityContext** ile Ã§alÄ±ÅŸtÄ±rÄ±lacak olan **konteynerlerin** gÃ¼venlik baÄŸlamÄ±nÄ± yapÄ±landÄ±rabilirsiniz. Daha fazla bilgi iÃ§in okuyun:

{% content-ref url="kubernetes-securitycontext-s.md" %}
[kubernetes-securitycontext-s.md](kubernetes-securitycontext-s.md)
{% endcontent-ref %}

### Kubernetes API SÄ±kÄ±laÅŸtÄ±rma

KÃ¶tÃ¼ niyetli bir aktÃ¶r yeterli yetkilere sahipse, Kubernetes Api Sunucusuna eriÅŸimi korumak Ã§ok Ã¶nemlidir ve Ã§evreye birÃ§ok ÅŸekilde zarar verebilir.\
**EriÅŸimi** (**API Sunucusuna eriÅŸimi olan kaynaklarÄ± beyaz listeye almak ve diÄŸer baÄŸlantÄ±larÄ± reddetmek**) ve [**kimlik doÄŸrulama**](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-authentication-authorization/) (en az ayrÄ±calÄ±k ilkesini takip etmek) gÃ¼vence altÄ±na almak Ã¶nemlidir. Ve kesinlikle **anonim isteklere izin vermemek**.

**Ortak Ä°stek SÃ¼reci:**\
KullanÄ±cÄ± veya K8s ServiceAccount â€“> Kimlik doÄŸrulama â€“> Yetkilendirme â€“> Kabul KontrolÃ¼.

**Ä°puÃ§larÄ±**:

* PortlarÄ± kapatÄ±n.
* Anonim eriÅŸimi Ã¶nleyin.
* NodeRestriction; API'ye belirli dÃ¼ÄŸÃ¼mlerden eriÅŸimi engelleyin.
* [https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction](https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction)
* Temel olarak, kubeletlerin dÃ¼ÄŸÃ¼mlerini izolasyon amacÄ±yla etiketlemek iÃ§in yÃ¶neticilerin ayrÄ±calÄ±klÄ± olarak kullandÄ±ÄŸÄ± bir etiket Ã¶neki olan node-restriction.kubernetes.io/ ile baÅŸlayan etiketleri eklemesini/Ã§Ä±karmasÄ±nÄ±/gÃ¼ncellemesini engeller. Ve kubeletlerin bu etiketleri ve etiket Ã¶neklerini eklemesine/Ã§Ä±karmasÄ±na/gÃ¼ncellemesine izin verir.
* Etiketlerle gÃ¼venli iÅŸ yÃ¼kÃ¼ izolasyonunu saÄŸlayÄ±n.
* API eriÅŸimine Ã¶zel podlarÄ± engelleyin.
* ApiServer'Ä±n internete maruz kalmasÄ±nÄ± Ã¶nleyin.
* Yetkisiz eriÅŸimi RBAC ile engelleyin.
* ApiServer portunu gÃ¼venlik duvarÄ± ve IP beyaz listesi ile koruyun.

### SecurityContext SÄ±kÄ±laÅŸtÄ±rma

VarsayÄ±lan olarak, baÅŸka bir kullanÄ±cÄ± belirtilmediÄŸinde bir Pod baÅŸlatÄ±ldÄ±ÄŸÄ±nda kÃ¶k kullanÄ±cÄ±sÄ± kullanÄ±lÄ±r. AÅŸaÄŸÄ±daki ÅŸablona benzer bir ÅŸablonda uygulamanÄ±zÄ± daha gÃ¼venli bir baÄŸlamda Ã§alÄ±ÅŸtÄ±rabilirsiniz:
```yaml
apiVersion: v1
kind: Pod
metadata:
name: security-context-demo
spec:
securityContext:
runAsUser: 1000
runAsGroup: 3000
fsGroup: 2000
volumes:
- name: sec-ctx-vol
emptyDir: {}
containers:
- name: sec-ctx-demo
image: busybox
command: [ "sh", "-c", "sleep 1h" ]
securityContext:
runAsNonRoot: true
volumeMounts:
- name: sec-ctx-vol
mountPath: /data/demo
securityContext:
allowPrivilegeEscalation: true
```
* [https://kubernetes.io/docs/tasks/configure-pod-container/security-context/](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)
* [https://kubernetes.io/docs/concepts/policy/pod-security-policy/](https://kubernetes.io/docs/concepts/policy/pod-security-policy/)


### Genel SÄ±kÄ±laÅŸtÄ±rma

Kubernetes ortamÄ±nÄ±zÄ±, aÅŸaÄŸÄ±daki gibi sÄ±k sÄ±k gÃ¼ncellemelisiniz:

* GÃ¼ncel baÄŸÄ±mlÄ±lÄ±klar.
* Hata ve gÃ¼venlik yamalarÄ±.

[**SÃ¼rÃ¼m dÃ¶ngÃ¼leri**](https://kubernetes.io/docs/setup/release/version-skew-policy/): Her 3 ayda bir yeni bir kÃ¼Ã§Ã¼k sÃ¼rÃ¼m yayÄ±nlanÄ±r -- 1.20.3 = 1(BÃ¼yÃ¼k).20(KÃ¼Ã§Ã¼k).3(yama)

**Bir Kubernetes KÃ¼mesini gÃ¼ncellemenin en iyi yolu (buradan)** [**buradan**](https://kubernetes.io/docs/tasks/administer-cluster/cluster-upgrade/)**):**

* Master DÃ¼ÄŸÃ¼m bileÅŸenlerini aÅŸaÄŸÄ±daki sÄ±rayla gÃ¼ncelleyin:
* etcd (tÃ¼m Ã¶rnekler).
* kube-apiserver (tÃ¼m kontrol dÃ¼zlemi ana bilgisayarlarÄ±).
* kube-controller-manager.
* kube-scheduler.
* Bulut denetleyici yÃ¶neticisi, kullanÄ±yorsanÄ±z.
* kube-proxy, kubelet gibi Worker DÃ¼ÄŸÃ¼m bileÅŸenlerini gÃ¼ncelleyin.

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman olmak iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* Åirketinizi HackTricks'te **reklamÄ±nÄ±zÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'ler**](https://opensea.io/collection/the-peass-family)
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**'u takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.

</details>
