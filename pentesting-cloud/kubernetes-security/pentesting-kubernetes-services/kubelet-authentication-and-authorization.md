# Kubelet ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ ì œë¡œë¶€í„° ì˜ì›…ì´ ë˜ëŠ” AWS í•´í‚¹ì„ ë°°ìš°ì„¸ìš”!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ í•˜ë ¤ë©´ PRì„ ì œì¶œí•˜ì—¬** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œë¥¼ ì´ìš©í•˜ì„¸ìš”.

</details>

## Kubelet ì¸ì¦ <a href="#kubelet-authentication" id="kubelet-authentication"></a>

**[ë¬¸ì„œì—ì„œ:](https://kubernetes.io/docs/reference/access-authn-authz/kubelet-authn-authz/)**

ê¸°ë³¸ì ìœ¼ë¡œ, ë‹¤ë¥¸ êµ¬ì„±ëœ ì¸ì¦ ë°©ë²•ì— ì˜í•´ ê±°ë¶€ë˜ì§€ ì•ŠëŠ” kubeletì˜ HTTPS ì—”ë“œí¬ì¸íŠ¸ë¡œì˜ ìš”ì²­ì€ ìµëª… ìš”ì²­ìœ¼ë¡œ ì²˜ë¦¬ë˜ë©°, **`system:anonymous`** ì‚¬ìš©ì ì´ë¦„ê³¼ **`system:unauthenticated`** ê·¸ë£¹ì´ ë¶€ì—¬ë©ë‹ˆë‹¤.

**3**ê°€ì§€ ì¸ì¦ **ë°©ë²•**ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* **ìµëª…** (ê¸°ë³¸ê°’): **`--anonymous-auth=true`** ë§¤ê°œë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ê±°ë‚˜ êµ¬ì„±ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
```json
"authentication": {
"anonymous": {
"enabled": true
},
```
* **Webhook**: ì´ê²ƒì€ kubectl **API ë² ì–´ëŸ¬ í† í°**ì„ **ì¸ì¦**ìœ¼ë¡œ **í™œì„±í™”**í•©ë‹ˆë‹¤ (ìœ íš¨í•œ í† í°ì´ë©´ ëª¨ë‘ ìœ íš¨í•©ë‹ˆë‹¤). ë‹¤ìŒê³¼ ê°™ì´ í—ˆìš©í•˜ì‹­ì‹œì˜¤:
* API ì„œë²„ì—ì„œ `authentication.k8s.io/v1beta1` API ê·¸ë£¹ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤
* kubeletì„ **`--authentication-token-webhook`** ë° **`--kubeconfig`** í”Œë˜ê·¸ì™€ í•¨ê»˜ ì‹œì‘í•˜ê±°ë‚˜ ë‹¤ìŒ ì„¤ì •ì„ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤:
```json
"authentication": {
"webhook": {
"cacheTTL": "2m0s",
"enabled": true
},
```
{% hint style="info" %}
kubeletì€ êµ¬ì„±ëœ API ì„œë²„ì—ì„œ **`TokenReview` API**ë¥¼ í˜¸ì¶œí•˜ì—¬ bearer í† í°ì—ì„œ **ì‚¬ìš©ì ì •ë³´ë¥¼ ê²°ì •**í•©ë‹ˆë‹¤.
{% endhint %}

* **X509 í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œ:** X509 í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ í†µí•´ ì¸ì¦ì„ í—ˆìš©í•©ë‹ˆë‹¤.
* ìì„¸í•œ ë‚´ìš©ì€ [apiserver ì¸ì¦ ë¬¸ì„œ](https://kubernetes.io/docs/reference/access-authn-authz/authentication/#x509-client-certs)ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.
* `--client-ca-file` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ CA ë²ˆë“¤ì„ ì œê³µí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ í™•ì¸í•˜ê±°ë‚˜ êµ¬ì„±ìœ¼ë¡œ kubeletì„ ì‹œì‘í•˜ì‹­ì‹œì˜¤.
```json
"authentication": {
"x509": {
"clientCAFile": "/etc/kubernetes/pki/ca.crt"
}
}
```
## Kubelet ê¶Œí•œ ë¶€ì—¬ <a href="#kubelet-authentication" id="kubelet-authentication"></a>

ì„±ê³µì ìœ¼ë¡œ ì¸ì¦ëœ ëª¨ë“  ìš”ì²­(ìµëª… ìš”ì²­ í¬í•¨)ì€ **ê·¸ëŸ° ë‹¤ìŒ ê¶Œí•œì´ ë¶€ì—¬ë©ë‹ˆë‹¤**. **ê¸°ë³¸** ê¶Œí•œ ëª¨ë“œëŠ” **`AlwaysAllow`**ì´ë©° **ëª¨ë“  ìš”ì²­ì„ í—ˆìš©**í•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ë‹¤ë¥¸ ê°€ëŠ¥í•œ ê°’ì€ **`webhook`**ì…ë‹ˆë‹¤(ì¼ë°˜ì ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆëŠ” ê°’). ì´ ëª¨ë“œëŠ” **ì¸ì¦ëœ ì‚¬ìš©ìì˜ ê¶Œí•œì„ í™•ì¸**í•˜ì—¬ ì‘ì—…ì„ í—ˆìš©í•˜ê±°ë‚˜ ê±°ë¶€í•©ë‹ˆë‹¤.

{% hint style="warning" %}
ìµëª… ì¸ì¦ì´ í™œì„±í™”ë˜ì–´ ìˆë”ë¼ë„ **ìµëª… ì•¡ì„¸ìŠ¤**ê°€ ì–´ë–¤ ì‘ì—…ë„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ **ê°€ì§€ê³  ìˆì§€ ì•Šì„ ìˆ˜ ìˆë‹¤ëŠ” ì **ì„ ìœ ì˜í•˜ì‹­ì‹œì˜¤.
{% endhint %}

Webhookì„ í†µí•œ ê¶Œí•œ ë¶€ì—¬ëŠ” **`--authorization-mode=Webhook`** ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì„±í•˜ê±°ë‚˜ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„± íŒŒì¼ì„ í†µí•´ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```json
"authorization": {
"mode": "Webhook",
"webhook": {
"cacheAuthorizedTTL": "5m0s",
"cacheUnauthorizedTTL": "30s"
}
},
```
kubeletì€ ê° ìš”ì²­ì´ **ì¸ê°€**ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ êµ¬ì„±ëœ API ì„œë²„ì—ì„œ **`SubjectAccessReview`** APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

kubeletì€ API ìš”ì²­ì„ ì¸ê°€í•˜ê¸° ìœ„í•´ apiserverì™€ ë™ì¼í•œ [ìš”ì²­ ì†ì„±](https://kubernetes.io/docs/reference/access-authn-authz/authorization/#review-your-request-attributes) ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

* **ë™ì‘**

| HTTP ë™ì‚¬ | ìš”ì²­ ë™ì‚¬                                                                                                                                                  |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| POST      | create                                                                                                                                                        |
| GET, HEAD | get (ê°œë³„ ë¦¬ì†ŒìŠ¤ìš©), list (ì»¬ë ‰ì…˜ìš©, ì „ì²´ ê°ì²´ ë‚´ìš© í¬í•¨), watch (ê°œë³„ ë¦¬ì†ŒìŠ¤ ë˜ëŠ” ë¦¬ì†ŒìŠ¤ ì»¬ë ‰ì…˜ì„ ê°ì‹œí•˜ëŠ” ê²½ìš°) |
| PUT       | update                                                                                                                                                        |
| PATCH     | patch                                                                                                                                                         |
| DELETE    | delete (ê°œë³„ ë¦¬ì†ŒìŠ¤ìš©), deletecollection (ì»¬ë ‰ì…˜ìš©)                                                                                         |

* Kubelet APIì™€ í†µì‹ í•˜ëŠ” **ë¦¬ì†ŒìŠ¤**ëŠ” í•­ìƒ **ë…¸ë“œ**ì´ë©° **í•˜ìœ„ ë¦¬ì†ŒìŠ¤**ëŠ” ìˆ˜ì‹ ëœ ìš”ì²­ ê²½ë¡œì—ì„œ **ê²°ì •**ë©ë‹ˆë‹¤:

| Kubelet API  | ë¦¬ì†ŒìŠ¤ | í•˜ìœ„ ë¦¬ì†ŒìŠ¤ |
| ------------ | -------- | ----------- |
| /stats/\*    | nodes    | stats       |
| /metrics/\*  | nodes    | metrics     |
| /logs/\*     | nodes    | log         |
| /spec/\*     | nodes    | spec        |
| _ë‚˜ë¨¸ì§€ ëª¨ë“  ê²ƒ_ | nodes    | proxy       |

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒ ìš”ì²­ì€ ê¶Œí•œ ì—†ì´ kubeletì˜ íŒŒë“œ ì •ë³´ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ê³  ì‹œë„í–ˆìŠµë‹ˆë‹¤:
```bash
curl -k --header "Authorization: Bearer ${TOKEN}" 'https://172.31.28.172:10250/pods'
Forbidden (user=system:node:ip-172-31-28-172.ec2.internal, verb=get, resource=nodes, subresource=proxy)
```
* ìš°ë¦¬ëŠ” **ê¸ˆì§€**ë¥¼ ë°›ì•˜ìœ¼ë¯€ë¡œ ìš”ì²­ì´ **ì¸ì¦ í™•ì¸ì„ í†µê³¼í–ˆìŠµë‹ˆë‹¤**. ê·¸ë ‡ì§€ ì•Šì•˜ë‹¤ë©´, ìš°ë¦¬ëŠ” ê·¸ì € `ì¸ê°€ë˜ì§€ ì•ŠìŒ` ë©”ì‹œì§€ë¥¼ ë°›ì•˜ì„ ê²ƒì…ë‹ˆë‹¤.
* **ì‚¬ìš©ì ì´ë¦„** (ì´ ê²½ìš° í† í°ì—ì„œ)ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ë¦¬ì†ŒìŠ¤**ê°€ **ë…¸ë“œ**ì´ê³  **í•˜ìœ„ ë¦¬ì†ŒìŠ¤**ê°€ **í”„ë¡ì‹œ**ì¸ ê²ƒì„ í™•ì¸í•˜ì„¸ìš” (ì´ì „ ì •ë³´ì™€ ì¼ì¹˜í•©ë‹ˆë‹¤)

## ì°¸ê³  ìë£Œ

* [https://kubernetes.io/docs/reference/access-authn-authz/kubelet-authn-authz/](https://kubernetes.io/docs/reference/access-authn-authz/kubelet-authn-authz/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°**</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ê°€ HackTricksì— ê´‘ê³ ë˜ê¸¸ ì›í•˜ê±°ë‚˜ PDFë¡œ HackTricksë¥¼ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ ìš”ë ¹ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
