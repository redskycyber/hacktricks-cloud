# Kubelet ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìƒí’ˆ**](https://peass.creator-spring.com)ì„ êµ¬ë§¤í•˜ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ ì €ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”. ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ ì—¬ëŸ¬ë¶„ì˜ í•´í‚¹ ê¸°ë²•ì„ ê³µìœ í•˜ì„¸ìš”.

</details>

## Kubelet ì¸ì¦ <a href="#kubelet-authentication" id="kubelet-authentication"></a>

**[ë¬¸ì„œì—ì„œ ì°¸ì¡°:](https://kubernetes.io/docs/reference/access-authn-authz/kubelet-authn-authz/)**

ê¸°ë³¸ì ìœ¼ë¡œ, ë‹¤ë¥¸ êµ¬ì„±ëœ ì¸ì¦ ë°©ë²•ì—ì„œ ê±°ë¶€ë˜ì§€ ì•ŠëŠ” kubeletì˜ HTTPS ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ìš”ì²­ì€ ìµëª… ìš”ì²­ìœ¼ë¡œ ì²˜ë¦¬ë˜ë©°, **`system:anonymous`** ì‚¬ìš©ì ì´ë¦„ê³¼ **`system:unauthenticated`** ê·¸ë£¹ì´ ì§€ì •ë©ë‹ˆë‹¤.

ì¸ì¦ ë°©ë²•ì€ **3**ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤:

* **ìµëª…** (ê¸°ë³¸ê°’): **`--anonymous-auth=true`** ë§¤ê°œë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ê±°ë‚˜ êµ¬ì„±ì—ì„œ ì„¤ì •í•˜ì„¸ìš”.
```json
"authentication": {
"anonymous": {
"enabled": true
},
```
* **Webhook**: ì´ê²ƒì€ kubectl **API bearer tokens**ì„ ì¸ì¦ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤ (ìœ íš¨í•œ í† í°ì´ë©´ ëª¨ë‘ í—ˆìš©ë©ë‹ˆë‹¤). ë‹¤ìŒê³¼ ê°™ì´ í—ˆìš©í•©ë‹ˆë‹¤:
* API ì„œë²„ì—ì„œ `authentication.k8s.io/v1beta1` API ê·¸ë£¹ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
* kubeletì„ **`--authentication-token-webhook`** ë° **`--kubeconfig`** í”Œë˜ê·¸ì™€ í•¨ê»˜ ì‹œì‘í•˜ê±°ë‚˜ ë‹¤ìŒ ì„¤ì •ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:
```json
"authentication": {
"webhook": {
"cacheTTL": "2m0s",
"enabled": true
},
```
{% hint style="info" %}
kubeletì€ êµ¬ì„±ëœ API ì„œë²„ì—ì„œ **`TokenReview` API**ë¥¼ í˜¸ì¶œí•˜ì—¬ bearer í† í°ìœ¼ë¡œë¶€í„° ì‚¬ìš©ì ì •ë³´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
{% endhint %}

* **X509 í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œ:** X509 í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ í†µí•´ ì¸ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ìì„¸í•œ ë‚´ìš©ì€ [apiserver ì¸ì¦ ë¬¸ì„œ](https://kubernetes.io/docs/reference/access-authn-authz/authentication/#x509-client-certs)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
* `--client-ca-file` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ CA ë²ˆë“¤ì„ ì œê³µí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ í™•ì¸í•˜ê±°ë‚˜ êµ¬ì„± íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ kubeletì„ ì‹œì‘í•˜ì„¸ìš”.
```json
"authentication": {
"x509": {
"clientCAFile": "/etc/kubernetes/pki/ca.crt"
}
}
```
## Kubelet ê¶Œí•œ ë¶€ì—¬ <a href="#kubelet-authentication" id="kubelet-authentication"></a>

ì„±ê³µì ìœ¼ë¡œ ì¸ì¦ëœ ëª¨ë“  ìš”ì²­(ìµëª… ìš”ì²­ í¬í•¨)ì€ **ê¶Œí•œ ë¶€ì—¬**ë¥¼ ë°›ìŠµë‹ˆë‹¤. **ê¸°ë³¸** ê¶Œí•œ ë¶€ì—¬ ëª¨ë“œëŠ” **`AlwaysAllow`**ë¡œ, ëª¨ë“  ìš”ì²­ì„ í—ˆìš©í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ, ë‹¤ë¥¸ ê°€ëŠ¥í•œ ê°’ì€ **`webhook`**ì…ë‹ˆë‹¤(ì¼ë°˜ì ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤). ì´ ëª¨ë“œëŠ” ì¸ì¦ëœ ì‚¬ìš©ìì˜ ê¶Œí•œì„ í™•ì¸í•˜ì—¬ ì‘ì—…ì„ í—ˆìš©í•˜ê±°ë‚˜ ê±°ë¶€í•©ë‹ˆë‹¤.

{% hint style="warning" %}
ìµëª… ì¸ì¦ì´ í™œì„±í™”ë˜ì–´ ìˆë”ë¼ë„, **ìµëª… ì•¡ì„¸ìŠ¤**ëŠ” ì–´ë– í•œ ì‘ì—…ë„ ìˆ˜í–‰í•  ê¶Œí•œì´ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

Webhookì„ í†µí•œ ê¶Œí•œ ë¶€ì—¬ëŠ” **`--authorization-mode=Webhook`** ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì„±í•˜ê±°ë‚˜, ì„¤ì • íŒŒì¼ì„ í†µí•´ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```json
"authorization": {
"mode": "Webhook",
"webhook": {
"cacheAuthorizedTTL": "5m0s",
"cacheUnauthorizedTTL": "30s"
}
},
```
kubeletì€ ê° ìš”ì²­ì´ ìŠ¹ì¸ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ êµ¬ì„±ëœ API ì„œë²„ì—ì„œ **`SubjectAccessReview`** APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

kubeletì€ apiserverì™€ ë™ì¼í•œ [ìš”ì²­ ì†ì„±](https://kubernetes.io/docs/reference/access-authn-authz/authorization/#review-your-request-attributes) ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ API ìš”ì²­ì„ ìŠ¹ì¸í•©ë‹ˆë‹¤:

* **Action**

| HTTP ë™ì‚¬ | ìš”ì²­ ë™ì‚¬                                                                                                                                                     |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| POST      | create                                                                                                                                                        |
| GET, HEAD | get (ê°œë³„ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ), list (ì»¬ë ‰ì…˜ì— ëŒ€í•œ, ì „ì²´ ê°ì²´ ë‚´ìš© í¬í•¨), watch (ê°œë³„ ë¦¬ì†ŒìŠ¤ ë˜ëŠ” ë¦¬ì†ŒìŠ¤ ì»¬ë ‰ì…˜ì„ ê°ì‹œí•˜ëŠ” ê²½ìš°) |
| PUT       | update                                                                                                                                                        |
| PATCH     | patch                                                                                                                                                         |
| DELETE    | delete (ê°œë³„ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ), deletecollection (ì»¬ë ‰ì…˜ì— ëŒ€í•œ)                                                                                         |

* Kubelet APIì—ì„œ Kubelet apiì™€ í†µì‹ í•˜ëŠ” **ë¦¬ì†ŒìŠ¤**ëŠ” í•­ìƒ **nodes**ì´ë©° **í•˜ìœ„ ë¦¬ì†ŒìŠ¤**ëŠ” ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ ê²½ë¡œì—ì„œ **ê²°ì •**ë©ë‹ˆë‹¤:

| Kubelet API  | ë¦¬ì†ŒìŠ¤ | í•˜ìœ„ ë¦¬ì†ŒìŠ¤ |
| ------------ | ------ | ----------- |
| /stats/\*    | nodes  | stats       |
| /metrics/\*  | nodes  | metrics     |
| /logs/\*     | nodes  | log         |
| /spec/\*     | nodes  | spec        |
| _ê¸°íƒ€ ëª¨ë“  ê²ƒ_ | nodes  | proxy       |

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒ ìš”ì²­ì€ ê¶Œí•œ ì—†ì´ kubeletì˜ íŒŒë“œ ì •ë³´ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ê³  ì‹œë„í–ˆìŠµë‹ˆë‹¤:
```bash
curl -k --header "Authorization: Bearer ${TOKEN}" 'https://172.31.28.172:10250/pods'
Forbidden (user=system:node:ip-172-31-28-172.ec2.internal, verb=get, resource=nodes, subresource=proxy)
```
* ìš°ë¦¬ëŠ” **Forbidden**ì„ ë°›ì•˜ìœ¼ë¯€ë¡œ ìš”ì²­ì€ **ì¸ì¦ ê²€ì‚¬ë¥¼ í†µê³¼í–ˆìŠµë‹ˆë‹¤**. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ìš°ë¦¬ëŠ” ê·¸ì € `Unauthorised` ë©”ì‹œì§€ë¥¼ ë°›ì•˜ì„ ê²ƒì…ë‹ˆë‹¤.
* ìš°ë¦¬ëŠ” **ì‚¬ìš©ì ì´ë¦„**ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì´ ê²½ìš° í† í°ì—ì„œ ê°€ì ¸ì˜´)
* **ë¦¬ì†ŒìŠ¤**ê°€ **nodes**ì´ê³  **ì„œë¸Œë¦¬ì†ŒìŠ¤**ê°€ **proxy**ì¸ ê²ƒì„ í™•ì¸í•˜ì„¸ìš” (ì´ì „ ì •ë³´ì™€ ì¼ì¹˜í•©ë‹ˆë‹¤)

## ì°¸ê³  ìë£Œ

* [https://kubernetes.io/docs/reference/access-authn-authz/kubelet-authn-authz/](https://kubernetes.io/docs/reference/access-authn-authz/kubelet-authn-authz/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œì—ì„œ ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ì„ ë°°ì›Œë³´ì„¸ìš”**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìƒí’ˆ**](https://peass.creator-spring.com)ì„ êµ¬ë§¤í•˜ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter**ì—ì„œ ì €ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš” ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **ë‹¹ì‹ ì˜ í•´í‚¹ ê¸°êµë¥¼ ê³µìœ **í•˜ì„¸ìš”.

</details>
