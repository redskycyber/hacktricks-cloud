# ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¼Îµ Î’Î¬ÏƒÎ· Ï„Î¿Î½ Î¡ÏŒÎ»Î¿ (RBAC) ÏƒÏ„Î¿ Kubernetes

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ hacking ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Îµ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± hacking tricks ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>

## ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¼Îµ Î’Î¬ÏƒÎ· Ï„Î¿Î½ Î¡ÏŒÎ»Î¿ (RBAC)

Î¤Î¿ Kubernetes Î´Î¹Î±Î¸Î­Ï„ÎµÎ¹ Î­Î½Î± **Î¼Î¿Î½Ï„Î­Î»Î¿ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ Î¼Îµ ÏŒÎ½Î¿Î¼Î± ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¼Îµ Î’Î¬ÏƒÎ· Ï„Î¿Î½ Î¡ÏŒÎ»Î¿** ([**RBAC**](https://kubernetes.io/docs/reference/access-authn-authz/rbac/)) Ï€Î¿Ï… Î²Î¿Î·Î¸Î¬ ÏƒÏ„Î¿Î½ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼ÏŒ Ï„Ï‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Ï‡ÏÎ®ÏƒÎ·Ï‚ Ï„Î¿Ï… Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® API.

Î¤Î¿ Î¼Î¿Î½Ï„Î­Î»Î¿ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ RBAC Î±Ï€Î¿Ï„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ **Ï„ÏÎ¯Î± Î¼ÎµÎ¼Î¿Î½Ï‰Î¼Î­Î½Î± Î¼Î­ÏÎ·**:

1. **Î¡ÏŒÎ»Î¿Ï‚/Î¡ÏŒÎ»Î¿Ï‚ Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ (Role/ClusterRole) Â­â€“** Î¤Î¿ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Î´Î¹ÎºÎ±Î¯Ï‰Î¼Î±. Î ÎµÏÎ¹Î­Ï‡ÎµÎ¹ _**ÎºÎ±Î½ÏŒÎ½ÎµÏ‚**_ Ï€Î¿Ï… Î±Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎ¿Ï…Î½ Î­Î½Î± ÏƒÏÎ½Î¿Î»Î¿ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½. ÎšÎ¬Î¸Îµ ÎºÎ±Î½ÏŒÎ½Î±Ï‚ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ [Ï€ÏŒÏÎ¿Ï…Ï‚](https://kubernetes.io/docs/reference/kubectl/overview/#resource-types) ÎºÎ±Î¹ [ÏÎ®Î¼Î±Ï„Î±](https://kubernetes.io/docs/reference/access-authn-authz/authorization/#determine-the-request-verb). Î¤Î¿ ÏÎ®Î¼Î± ÎµÎ¯Î½Î±Î¹ Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Ï€Î¿Ï… Î¸Î± ÎµÏ†Î±ÏÎ¼Î¿ÏƒÏ„ÎµÎ¯ ÏƒÏ„Î¿Î½ Ï€ÏŒÏÎ¿.
2. **Î¥Ï€Î¿ÎºÎµÎ¯Î¼ÎµÎ½Î¿ (Î§ÏÎ®ÏƒÏ„Î·Ï‚, ÎŸÎ¼Î¬Î´Î± Î® Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Î¥Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚) â€“** Î¤Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Ï€Î¿Ï… Î¸Î± Î»Î¬Î²ÎµÎ¹ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±.
3. **Î£ÏÎ½Î´ÎµÏƒÎ· Î¡ÏŒÎ»Î¿Ï…/Î¡ÏŒÎ»Î¿Ï… Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ (RoleBinding/ClusterRoleBinding) â€“** Î— ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼ÎµÏ„Î±Î¾Ï Ï„Î¿Ï… Î¡ÏŒÎ»Î¿Ï…/Î¡ÏŒÎ»Î¿Ï… Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ ÎºÎ±Î¹ Ï„Î¿Ï… Ï…Ï€Î¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï….

![](https://www.cyberark.com/wp-content/uploads/2018/12/rolebiding\_serviceaccount\_and\_role-1024x551.png)

Î— Î´Î¹Î±Ï†Î¿ÏÎ¬ Î¼ÎµÏ„Î±Î¾Ï Ï„Ï‰Î½ "Î¡ÏŒÎ»Ï‰Î½" (Roles) ÎºÎ±Î¹ Ï„Ï‰Î½ "Î¡ÏŒÎ»Ï‰Î½ Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚" (ClusterRoles) ÎµÎ¯Î½Î±Î¹ Î±Ï€Î»ÏÏ‚ ÏŒÏ„Î¹ Î¿ ÏÏŒÎ»Î¿Ï‚ Î¸Î± ÎµÏ†Î±ÏÎ¼Î¿ÏƒÏ„ÎµÎ¯ ÏƒÎµ **Î­Î½Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿** **Ï€ÎµÏÎ¹Î¿Ï‡Î® Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½**, ÎµÎ½Ï Î¿ "Î¡ÏŒÎ»Î¿Ï‚ Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚" Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÏƒÎµ **ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚ Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½** ÏƒÏ„Î¿ cluster. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î¿Î¹ "Î¡ÏŒÎ»Î¿Î¹ Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚" Î¼Ï€Î¿ÏÎ¿ÏÎ½ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Ï€Î±ÏÎ­Ï‡Î¿Ï…Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ:

* **Ï€ÏŒÏÎ¿Ï…Ï‚ Ï€Î¿Ï… ÎºÎ±Î»ÏÏ€Ï„Î¿Ï…Î½ Î¿Î»ÏŒÎºÎ»Î·ÏÎ¿ Ï„Î¿ cluster** (ÏŒÏ€Ï‰Ï‚ Î¿Î¹ ÎºÏŒÎ¼Î²Î¿Î¹).
* **Î¼Î·-Ï€ÏŒÏÎ¿Ï…Ï‚** (ÏŒÏ€Ï‰Ï‚ /healthz).
* Ï€ÏŒÏÎ¿Ï…Ï‚ Ï€Î¿Ï… ÎºÎ±Î»ÏÏ€Ï„Î¿Ï…Î½ Î¼Î¹Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Ï€ÎµÏÎ¹Î¿Ï‡Î® Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½ (ÏŒÏ€Ï‰Ï‚ Î¿Î¹ Pods), **ÏƒÎµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î­Ï‚ Î¿Î½Î¿Î¼Î¬Ï„Ï‰Î½**.

Î‘Ï€ÏŒ Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· **Kubernetes** 1.6 ÎºÎ±Î¹ Î¼ÎµÏ„Î¬, Î¿Î¹ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ RBAC ÎµÎ¯Î½Î±Î¹ **ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½ÎµÏ‚ Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®**. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î³Î¹Î± Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ RBAC Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ÎºÎ¬Ï„Î¹ ÏŒÏ€Ï‰Ï‚:
```
kube-apiserver --authorization-mode=Example,RBAC --other-options --more-options
```
## Î ÏÏŒÏ„Ï…Ï€Î±

Î£Ï„Î¿ Ï€ÏÏŒÏ„Ï…Ï€Î¿ ÎµÎ½ÏŒÏ‚ **Î¡ÏŒÎ»Î¿Ï… (Role)** Î® ÎµÎ½ÏŒÏ‚ **Î¡ÏŒÎ»Î¿Ï… Î£Ï…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ (ClusterRole)** Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î·Î»ÏÏƒÎµÏ„Îµ Ï„Î¿ **ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… ÏÏŒÎ»Î¿Ï…**, Ï„Î¿ **namespace** (ÏƒÏ„Î¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚) ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï„Î± **apiGroups**, **resources** ÎºÎ±Î¹ **verbs** Ï„Î¿Ï… ÏÏŒÎ»Î¿Ï…:

* Î¤Î¿ **apiGroups** ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î± Î´Î¹Î¬Ï†Î¿ÏÎ± **API namespaces** ÏƒÏ„Î± Î¿Ï€Î¿Î¯Î± ÎµÏ†Î±ÏÎ¼ÏŒÎ¶Î¿Î½Ï„Î±Î¹ Î±Ï…Ï„Î¿Î¯ Î¿Î¹ ÎºÎ±Î½ÏŒÎ½ÎµÏ‚. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î¼Î¹Î± Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Î ÏÎ¿Î´Î¹Î±Î³ÏÎ±Ï†Î® (Pod definition) Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ apiVersion: v1. _ÎœÏ€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Ï„Î¹Î¼Î­Ï‚ ÏŒÏ€Ï‰Ï‚ rbac.authorization.k8s.io Î® \[\*]_.
* Î¤Î¿ **resources** ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Ï€Î¿Ï… ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ **Ï€Î¿Î¹Î¿Î¹ Ï€ÏŒÏÎ¿Î¹ ÎµÏ†Î±ÏÎ¼ÏŒÎ¶Î¿Î½Ï„Î±Î¹ Î±Ï…Ï„Î¿Î¯ Î¿Î¹ ÎºÎ±Î½ÏŒÎ½ÎµÏ‚**. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚ Î¼Îµ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î®: `kubectl api-resources --namespaced=true`
* Î¤Î¿ **verbs** ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î± **ÎµÏ€Î¹Ï„ÏÎµÏ€ÏŒÎ¼ÎµÎ½Î± ÏÎ®Î¼Î±Ï„Î±**. Î¤Î¿ ÏÎ®Î¼Î± ÏƒÏ„Î¿ Kubernetes ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿Î½ **Ï„ÏÏ€Î¿ Î´ÏÎ¬ÏƒÎ·Ï‚** Ï€Î¿Ï… Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÏ†Î±ÏÎ¼ÏŒÏƒÎµÏ„Îµ ÏƒÏ„Î¿Î½ Ï€ÏŒÏÎ¿. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Ï„Î¿ ÏÎ®Î¼Î± "list" Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± ÏƒÏ…Î»Î»Î¿Î³Î­Ï‚ ÎµÎ½Ï Ï„Î¿ "get" Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î­Î½Î±Î½ Î¼ÎµÎ¼Î¿Î½Ï‰Î¼Î­Î½Î¿ Ï€ÏŒÏÎ¿.

### Î¡Î®Î¼Î±Ï„Î± ÎšÎ±Î½ÏŒÎ½Ï‰Î½

(_Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€ÏÎ¿Î®Î»Î¸Î±Î½ Î±Ï€ÏŒ_ [_**Ï„Î± Î­Î³Î³ÏÎ±Ï†Î±**_](https://kubernetes.io/docs/reference/access-authn-authz/authorization/#determine-the-request-verb)_)

| HTTP ÏÎ®Î¼Î± | ÏÎ®Î¼Î± Î±Î¯Ï„Î·ÏƒÎ·Ï‚                                                                                                                                                 |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| POST      | create                                                                                                                                                        |
| GET, HEAD | get (Î³Î¹Î± Î¼ÎµÎ¼Î¿Î½Ï‰Î¼Î­Î½Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚), list (Î³Î¹Î± ÏƒÏ…Î»Î»Î¿Î³Î­Ï‚, ÏƒÏ…Î¼Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î±Î½Î¿Î¼Î­Î½Î¿Ï… Ï„Î¿Ï… Ï€Î»Î®ÏÎ¿Ï…Ï‚ Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï… Ï„Î¿Ï… Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…), watch (Î³Î¹Î± Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ· ÎµÎ½ÏŒÏ‚ Î¼ÎµÎ¼Î¿Î½Ï‰Î¼Î­Î½Î¿Ï… Ï€ÏŒÏÎ¿Ï… Î® ÏƒÏ…Î»Î»Î¿Î³Î®Ï‚ Ï€ÏŒÏÏ‰Î½) |
| PUT       | update                                                                                                                                                        |
| PATCH     | patch                                                                                                                                                         |
| DELETE    | delete (Î³Î¹Î± Î¼ÎµÎ¼Î¿Î½Ï‰Î¼Î­Î½Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚), deletecollection (Î³Î¹Î± ÏƒÏ…Î»Î»Î¿Î³Î­Ï‚)                                                                                             |

ÎŸ Kubernetes ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Ï†Î¿ÏÎ­Ï‚ Ï„Î·Î½ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ· Î³Î¹Î± ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ ÎµÎ¾ÎµÎ¹Î´Î¹ÎºÎµÏ…Î¼Î­Î½Î± ÏÎ®Î¼Î±Ï„Î±. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:

* [Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚ Î ÏÎ¿Î´Î¹Î±Î³ÏÎ±Ï†Î®Ï‚ (PodSecurityPolicy)](https://kubernetes.io/docs/concepts/policy/pod-security-policy/)
* Î¤Î¿ ÏÎ®Î¼Î± `use` ÏƒÏ„Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚ `podsecuritypolicies` ÏƒÏ„Î¿Î½ Î¿Î¼Î¬Î´Î± Ï€ÏŒÏÏ‰Î½ `policy`.
* [RBAC](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#privilege-escalation-prevention-and-bootstrapping)
* Î¤Î± ÏÎ®Î¼Î±Ï„Î± `bind` ÎºÎ±Î¹ `escalate` ÏƒÏ„Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚ `roles` ÎºÎ±Î¹ `clusterroles` ÏƒÏ„Î·Î½ Î¿Î¼Î¬Î´Î± Ï€ÏŒÏÏ‰Î½ `rbac.authorization.k8s.io`.
* [Î Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· (Authentication)](https://kubernetes.io/docs/reference/access-authn-authz/authentication/)
* Î¤Î¿ ÏÎ®Î¼Î± `impersonate` ÏƒÏ„Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚ `users`, `groups` ÎºÎ±Î¹ `serviceaccounts` ÏƒÏ„Î·Î½ Ï€Ï…ÏÎ®Î½Î± Î¿Î¼Î¬Î´Î± Ï€ÏŒÏÏ‰Î½, ÎºÎ±Î¸ÏÏ‚ ÎºÎ±Î¹ Ï„Î¿ `userextras` ÏƒÏ„Î·Î½ Î¿Î¼Î¬Î´Î± Ï€ÏŒÏÏ‰Î½ `authentication.k8s.io`.

{% hint style="warning" %}
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ **ÏŒÎ»Î± Ï„Î± ÏÎ®Î¼Î±Ï„Î± Ï€Î¿Ï… Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ ÎºÎ¬Î¸Îµ Ï€ÏŒÏÎ¿Ï‚** ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î® `kubectl api-resources --sort-by name -o wide`
{% endhint %}

### Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±

{% code title="Î¡ÏŒÎ»Î¿Ï‚ (Role)" %}
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
namespace: defaultGreen
name: pod-and-pod-logs-reader
rules:
- apiGroups: [""]
resources: ["pods", "pods/log"]
verbs: ["get", "list", "watch"]
```
{% code title="ClusterRole" %}
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
# "namespace" omitted since ClusterRoles are not namespaced
name: secret-reader
rules:
- apiGroups: [""]
resources: ["secrets"]
verbs: ["get", "watch", "list"]
```
{% endcode %}

Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î­Î½Î± **ClusterRole** Î³Î¹Î± Î½Î± ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÏ„Îµ ÏƒÎµ Î­Î½Î±Î½ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ Ï‡ÏÎ®ÏƒÏ„Î· Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹:
```
kubectl get pods --all-namespaces
```
### **RoleBinding ÎºÎ±Î¹ ClusterRoleBinding**

**[Î‘Ï€ÏŒ Ï„Î± Î­Î³Î³ÏÎ±Ï†Î±:](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#rolebinding-and-clusterrolebinding)** ÎˆÎ½Î± **role binding Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï€Î¿Ï… Î¿ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ ÏƒÎµ Î­Î½Î±Î½ ÏÏŒÎ»Î¿ ÏƒÎµ Î­Î½Î±Î½ Ï‡ÏÎ®ÏƒÏ„Î· Î® Î¿Î¼Î¬Î´Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½**. Î ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î¼Î¹Î± Î»Î¯ÏƒÏ„Î± Î±Ï€ÏŒ Î¸Î­Î¼Î±Ï„Î± (Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚, Î¿Î¼Î¬Î´ÎµÏ‚ Î® Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿ÏÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚) ÎºÎ±Î¹ Î¼Î¹Î± Î±Î½Î±Ï†Î¿ÏÎ¬ ÏƒÏ„Î¿Î½ ÏÏŒÎ»Î¿ Ï€Î¿Ï… Ï€Î±ÏÎ­Ï‡ÎµÏ„Î±Î¹. ÎˆÎ½Î± **RoleBinding** Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎµÎ½Ï„ÏŒÏ‚ ÎµÎ½ÏŒÏ‚ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿Ï… **namespace**, ÎµÎ½Ï Î­Î½Î± **ClusterRoleBinding** Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏŒÎ»Î¿ Ï„Î¿ **cluster**.

{% code title="" %}
```yaml
piVersion: rbac.authorization.k8s.io/v1
# This role binding allows "jane" to read pods in the "default" namespace.
# You need to already have a Role named "pod-reader" in that namespace.
kind: RoleBinding
metadata:
name: read-pods
namespace: default
subjects:
# You can specify more than one "subject"
- kind: User
name: jane # "name" is case sensitive
apiGroup: rbac.authorization.k8s.io
roleRef:
# "roleRef" specifies the binding to a Role / ClusterRole
kind: Role #this must be Role or ClusterRole
name: pod-reader # this must match the name of the Role or ClusterRole you wish to bind to
apiGroup: rbac.authorization.k8s.io
```
{% code title="ClusterRoleBinding" %}
```yaml
apiVersion: rbac.authorization.k8s.io/v1
# This cluster role binding allows anyone in the "manager" group to read secrets in any namespace.
kind: ClusterRoleBinding
metadata:
name: read-secrets-global
subjects:
- kind: Group
name: manager # Name is case sensitive
apiGroup: rbac.authorization.k8s.io
roleRef:
kind: ClusterRole
name: secret-reader
apiGroup: rbac.authorization.k8s.io
```
{% endcode %}

**ÎŸÎ¹ Î¬Î´ÎµÎ¹ÎµÏ‚ ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÎ¸ÎµÏ„Î¹ÎºÎ­Ï‚**, Î¿Ï€ÏŒÏ„Îµ Î±Î½ Î­Ï‡ÎµÏ„Îµ Î­Î½Î± clusterRole Î¼Îµ "list" ÎºÎ±Î¹ "delete" Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î¿ Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ Î¼Îµ Î­Î½Î± Role Î¼Îµ "get". Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î½Î± ÎµÎ¯ÏƒÏ„Îµ Ï€ÏÎ¿ÏƒÎµÎºÏ„Î¹ÎºÎ¿Î¯ ÎºÎ±Î¹ Î½Î± ÎµÎ»Î­Î³Ï‡ÎµÏ„Îµ Ï€Î¬Î½Ï„Î± Ï„Î¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚ ÎºÎ±Î¹ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ ÏƒÎ±Ï‚ ÎºÎ±Î¹ **Î½Î± ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÏ„Îµ Ï„Î¹ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹, ÎµÏ€ÎµÎ¹Î´Î® Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® ÏŒÎ»Î± Î±Ï€Î¿ÏÏÎ¯Ï€Ï„Î¿Î½Ï„Î±Î¹**.

## **Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· RBAC**
```bash
# Get current privileges
kubectl auth can-i --list
# use `--as=system:serviceaccount:<namespace>:<sa_name>` to impersonate a service account

# List Cluster Roles
kubectl get clusterroles
kubectl describe clusterroles

# List Cluster Roles Bindings
kubectl get clusterrolebindings
kubectl describe clusterrolebindings

# List Roles
kubectl get roles
kubectl describe roles

# List Roles Bindings
kubectl get rolebindings
kubectl describe rolebindings
```
### ÎšÎ±Ï„Î¬Ï‡ÏÎ·ÏƒÎ· Î¡ÏŒÎ»Ï‰Î½/ClusterRoles Î³Î¹Î± Î‘Î½Î­Î»Î¹Î¾Î· Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ hacking ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î³Î¹Î± Î½Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾ÎµÏ„Îµ Ï„Î¿ HackTricks:

* Î•Î¬Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î½Î± Î´Î¹Î±Ï†Î·Î¼Î¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF**, ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î Î‘ÎšÎ•Î¤Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Îµ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± hacking tricks ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>
