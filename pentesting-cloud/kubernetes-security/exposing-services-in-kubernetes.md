# Kubernetes'te Hizmetleri AÃ§Ä±ÄŸa Ã‡Ä±karma

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek** veya **HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n**.

</details>

Kubernetes'te hizmetleri aÃ§Ä±ÄŸa Ã§Ä±karmak iÃ§in **farklÄ± yÃ¶ntemler** vardÄ±r, bÃ¶ylece hem **iÃ§** hem de **dÄ±ÅŸ** uÃ§ noktalarÄ±na eriÅŸilebilir. Bu Kubernetes yapÄ±landÄ±rmasÄ± oldukÃ§a Ã¶nemlidir Ã§Ã¼nkÃ¼ yÃ¶netici, **saldÄ±rganlara eriÅŸmemeleri gereken hizmetlere eriÅŸim saÄŸlayabilir**.

### Otomatik NumaralandÄ±rma

Halka hizmet sunmak iÃ§in K8s'nin sunduÄŸu yollarÄ± numaralandÄ±rmaya baÅŸlamadan Ã¶nce, ad alanlarÄ±nÄ±, hizmetleri ve giriÅŸleri listeleyebilirseniz, her ÅŸeyi aÅŸaÄŸÄ±daki komutla halka aÃ§Ä±k olarak bulabilirsiniz:
```bash
kubectl get namespace -o custom-columns='NAME:.metadata.name' | grep -v NAME | while IFS='' read -r ns; do
echo "Namespace: $ns"
kubectl get service -n "$ns"
kubectl get ingress -n "$ns"
echo "=============================================="
echo ""
echo ""
done | grep -v "ClusterIP"
# Remove the last '| grep -v "ClusterIP"' to see also type ClusterIP
```
### ClusterIP

Bir **ClusterIP** servisi, Kubernetes'in **varsayÄ±lan** servisidir. Bu, kÃ¼meniz iÃ§indeki diÄŸer uygulamalarÄ±n eriÅŸebileceÄŸi bir **servis** saÄŸlar. **Harici eriÅŸim yoktur**.

Ancak, bu Kubernetes Proxy kullanÄ±larak eriÅŸilebilir:
```
kubectl proxy --port=8080
```
Åimdi, hizmetlere eriÅŸmek iÃ§in Kubernetes API'si Ã¼zerinden gezinebilirsiniz. Bu ÅŸema kullanÄ±larak eriÅŸim saÄŸlanabilir:

`http://localhost:8080/api/v1/proxy/namespaces/<NAMESPACE>/services/<SERVICE-NAME>:<PORT-NAME>/`

Ã–rneÄŸin, aÅŸaÄŸÄ±daki URL'yi kullanabilirsiniz:

`http://localhost:8080/api/v1/proxy/namespaces/default/services/my-internal-service:http/`

bu hizmete eriÅŸmek iÃ§in:
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-internal-service
spec:
selector:
app: my-app
type: ClusterIP
ports:
- name: http
port: 80
targetPort: 80
protocol: TCP
```
_Bu yÃ¶ntem iÃ§in `kubectl`'yi **kimlik doÄŸrulamasÄ± yapÄ±lmÄ±ÅŸ bir kullanÄ±cÄ±** olarak Ã§alÄ±ÅŸtÄ±rmanÄ±z gerekmektedir._

### NodePort

**NodePort** kullanÄ±ldÄ±ÄŸÄ±nda, belirli bir baÄŸlantÄ± noktasÄ± tÃ¼m DÃ¼ÄŸÃ¼mlerde (Sanal Makineleri temsil eden) kullanÄ±labilir hale getirilir. Bu belirli baÄŸlantÄ± noktasÄ±na yÃ¶nlendirilen **trafik**, ardÄ±ndan hizmete sistemli bir ÅŸekilde yÃ¶nlendirilir. Genellikle bu yÃ¶ntem, dezavantajlarÄ± nedeniyle Ã¶nerilmez.

Bir NodePort Ã¶rneÄŸi:
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-nodeport-service
spec:
selector:
app: my-app
type: NodePort
ports:
- name: http
port: 80
targetPort: 80
nodePort: 30036
protocol: TCP
```
EÄŸer yaml dosyasÄ±nda **nodePort** belirtmezseniz (bu aÃ§Ä±lacak olan porttur) **30000-32767 aralÄ±ÄŸÄ±nda bir port kullanÄ±lÄ±r**.

### LoadBalancer <a href="#0d96" id="0d96"></a>

Servisi **bir bulut saÄŸlayÄ±cÄ±sÄ±nÄ±n yÃ¼k dengeleyicisi kullanarak** dÄ±ÅŸarÄ±ya aÃ§ar. GKE'de, bu bir [AÄŸ YÃ¼k Dengeleyici](https://cloud.google.com/compute/docs/load-balancing/network/) oluÅŸturacak ve tÃ¼m trafiÄŸi servisinize iletecek tek bir IP adresi saÄŸlayacaktÄ±r.

Her bir aÃ§Ä±k servis iÃ§in bir YÃ¼k Dengeleyiciye Ã¶deme yapmanÄ±z gerekmektedir, bu da maliyetli olabilir.

### ExternalName

**[DokÃ¼mantasyondan:](https://kubernetes.io/docs/concepts/services-networking/service/#externalname)**
ExternalName tipindeki servisler, bir Servisi `my-service` veya `cassandra` gibi tipik bir seÃ§iciye deÄŸil, bir DNS adÄ±na eÅŸler. Bu Servisleri `spec.externalName` parametresiyle belirtirsiniz.

Ã–rneÄŸin, aÅŸaÄŸÄ±daki Servis tanÄ±mÄ±, `prod` ad alanÄ±ndaki `my-service` Servisini `my.database.example.com` adresine eÅŸler:
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-service
namespace: prod
spec:
type: ExternalName
externalName: my.database.example.com
```
`my-service.prod.svc.cluster.local` ana bilgisayar adÄ±nÄ± sorguladÄ±ÄŸÄ±mÄ±zda, kÃ¼me DNS Hizmeti `my.database.example.com` deÄŸeriyle bir `CNAME` kaydÄ± dÃ¶ndÃ¼rÃ¼r. `my-service`'e eriÅŸmek, diÄŸer Hizmetlerle aynÄ± ÅŸekilde Ã§alÄ±ÅŸÄ±rken, **yÃ¶nlendirme DNS seviyesinde** gerÃ§ekleÅŸir ve proxy veya yÃ¶nlendirme ile deÄŸil.

### Harici IP'ler <a href="#external-ips" id="external-ips"></a>

KÃ¼me dÄ±ÅŸÄ±na giren trafiÄŸin **harici IP** (hedef IP) ile, Hizmet baÄŸlantÄ± noktasÄ±na yÃ¶nlendirilir ve bir Hizmet uÃ§ noktasÄ±na yÃ¶nlendirilir. `externalIPs` Kubernetes tarafÄ±ndan yÃ¶netilmez ve kÃ¼me yÃ¶neticisinin sorumluluÄŸundadÄ±r.

Hizmet Ã¶zelliklerinde, `externalIPs` `ServiceTypes` ile birlikte belirtilebilir. AÅŸaÄŸÄ±daki Ã¶rnekte, "`my-service`" istemciler tarafÄ±ndan "`80.11.12.10:80`" (`externalIP:port`) Ã¼zerinden eriÅŸilebilir.
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-service
spec:
selector:
app: MyApp
ports:
- name: http
protocol: TCP
port: 80
targetPort: 9376
externalIPs:
- 80.11.12.10
```
### Ingress

TÃ¼m yukarÄ±daki Ã¶rneklerin aksine, **Ingress bir hizmet tÃ¼rÃ¼ DEÄÄ°LDÄ°R**. Bunun yerine, birden fazla hizmetin Ã¶nÃ¼nde oturur ve kÃ¼menize bir "akÄ±llÄ± yÃ¶nlendirici" veya giriÅŸ noktasÄ± olarak hareket eder.

Bir Ingress ile birÃ§ok farklÄ± ÅŸey yapabilirsiniz ve **farklÄ± yeteneklere sahip birÃ§ok Ingress denetleyicisi vardÄ±r**.

VarsayÄ±lan GKE Ingress denetleyicisi sizin iÃ§in bir [HTTP(S) YÃ¼k Dengeleyici](https://cloud.google.com/compute/docs/load-balancing/http/) oluÅŸturur. Bu, hem yol tabanlÄ± hem de alt alan tabanlÄ± yÃ¶nlendirme yapmanÄ±za olanak saÄŸlar. Ã–rneÄŸin, foo.yourdomain.com Ã¼zerindeki her ÅŸeyi foo hizmetine gÃ¶nderebilir ve yourdomain.com/bar/ yolunun altÄ±ndaki her ÅŸeyi bar hizmetine yÃ¶nlendirebilirsiniz.

GKE'deki bir Ingress nesnesi iÃ§in YAML, [L7 HTTP YÃ¼k Dengeleyici](https://cloud.google.com/compute/docs/load-balancing/http/) ile ÅŸuna benzer olabilir:
```yaml
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
name: my-ingress
spec:
backend:
serviceName: other
servicePort: 8080
rules:
- host: foo.mydomain.com
http:
paths:
- backend:
serviceName: foo
servicePort: 8080
- host: mydomain.com
http:
paths:
- path: /bar/*
backend:
serviceName: bar
servicePort: 8080
```
### Referanslar

* [https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0](https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0)
* [https://kubernetes.io/docs/concepts/services-networking/service/](https://kubernetes.io/docs/concepts/services-networking/service/)

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahramana dÃ¶nÃ¼ÅŸmek iÃ§in</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'Ä± Ã¶ÄŸrenin!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek veya HackTricks'i PDF olarak indirmek** iÃ§in [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**'u takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na **PR gÃ¶ndererek paylaÅŸÄ±n.**

</details>
