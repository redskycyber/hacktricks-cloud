# Kubernetesì—ì„œ ì„œë¹„ìŠ¤ ë…¸ì¶œí•˜ê¸°

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

Kubernetesì—ì„œëŠ” **ë‚´ë¶€** ì—”ë“œí¬ì¸íŠ¸ì™€ **ì™¸ë¶€** ì—”ë“œí¬ì¸íŠ¸ê°€ ëª¨ë‘ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí•˜ëŠ” **ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•**ì´ ìˆìŠµë‹ˆë‹¤. ì´ Kubernetes êµ¬ì„±ì€ ê´€ë¦¬ìê°€ **ì ‘ê·¼í•´ì„œëŠ” ì•ˆ ë˜ëŠ” ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê³µê²©ìì˜ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬**í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.

### ìë™ ì—´ê±°

ê³µê°œì— ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí•˜ëŠ” K8sì˜ ë°©ë²•ì„ ì—´ê±°í•˜ê¸° ì „ì—, ë„¤ì„ìŠ¤í˜ì´ìŠ¤, ì„œë¹„ìŠ¤ ë° ì¸ê·¸ë ˆìŠ¤ë¥¼ ë‚˜ì—´í•  ìˆ˜ ìˆë‹¤ë©´ ë‹¤ìŒ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ê³µê°œì— ë…¸ì¶œëœ ëª¨ë“  ê²ƒì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
kubectl get namespace -o custom-columns='NAME:.metadata.name' | grep -v NAME | while IFS='' read -r ns; do
echo "Namespace: $ns"
kubectl get service -n "$ns"
kubectl get ingress -n "$ns"
echo "=============================================="
echo ""
echo ""
done | grep -v "ClusterIP"
# Remove the last '| grep -v "ClusterIP"' to see also type ClusterIP
```
### ClusterIP

**ClusterIP** ì„œë¹„ìŠ¤ëŠ” Kubernetesì˜ **ê¸°ë³¸ ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤. ì´ëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ë‹¤ë¥¸ ì•±ë“¤ì´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì˜ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. **ì™¸ë¶€ ì ‘ê·¼ì€ ë¶ˆê°€ëŠ¥**í•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ Kubernetes Proxyë¥¼ ì‚¬ìš©í•˜ì—¬ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
kubectl proxy --port=8080
```
ì´ì œ, ì´ ìŠ¤í‚´ì„ ì‚¬ìš©í•˜ì—¬ Kubernetes APIë¥¼ í†µí•´ ì„œë¹„ìŠ¤ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

`http://localhost:8080/api/v1/proxy/namespaces/<NAMESPACE>/services/<SERVICE-NAME>:<PORT-NAME>/`

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒ URLì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

`http://localhost:8080/api/v1/proxy/namespaces/default/services/my-internal-service:http/`

ì´ ì„œë¹„ìŠ¤ì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´.
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-internal-service
spec:
selector:
app: my-app
type: ClusterIP
ports:
- name: http
port: 80
targetPort: 80
protocol: TCP
```
_ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë ¤ë©´ `kubectl`ì„ **ì¸ì¦ëœ ì‚¬ìš©ì**ë¡œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤._

### NodePort

**NodePort**ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ëª¨ë“  ë…¸ë“œ(ê°€ìƒ ë¨¸ì‹ ì„ ë‚˜íƒ€ëƒ„)ì— ì§€ì •ëœ í¬íŠ¸ê°€ ì‚¬ìš© ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤. ì´ íŠ¹ì • í¬íŠ¸ë¡œ ì „ì†¡ëœ **íŠ¸ë˜í”½**ì€ ì„œë¹„ìŠ¤ë¡œ ì²´ê³„ì ìœ¼ë¡œ **ë¼ìš°íŒ…**ë©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì´ ë°©ë²•ì€ ë‹¨ì  ë•Œë¬¸ì— ê¶Œì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

NodePort ì‚¬ì–‘ì˜ ì˜ˆì‹œ:
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-nodeport-service
spec:
selector:
app: my-app
type: NodePort
ports:
- name: http
port: 80
targetPort: 80
nodePort: 30036
protocol: TCP
```
ë§Œì•½ yamlì—ì„œ **nodePort**ë¥¼ **ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´** (ì—´ë¦´ í¬íŠ¸ì…ë‹ˆë‹¤) **30000-32767 ë²”ìœ„ì˜ í¬íŠ¸**ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.

### LoadBalancer <a href="#0d96" id="0d96"></a>

í´ë¼ìš°ë“œ ì œê³µì—…ì²´ì˜ ë¡œë“œ ë°¸ëŸ°ì„œë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì™¸ë¶€ì— ë…¸ì¶œí•©ë‹ˆë‹¤. GKEì—ì„œëŠ” [ë„¤íŠ¸ì›Œí¬ ë¡œë“œ ë°¸ëŸ°ì„œ](https://cloud.google.com/compute/docs/load-balancing/network/)ê°€ ìƒì„±ë˜ì–´ ëª¨ë“  íŠ¸ë˜í”½ì„ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•˜ëŠ” ë‹¨ì¼ IP ì£¼ì†Œë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ì„œë¹„ìŠ¤ë‹¹ ë¡œë“œ ë°¸ëŸ°ì„œë¥¼ ì§€ë¶ˆí•´ì•¼ í•˜ë©°, ì´ëŠ” ë¹„ìš©ì´ ë§ì´ ë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ExternalName

**[ë¬¸ì„œì—ì„œ ì°¸ì¡°:](https://kubernetes.io/docs/concepts/services-networking/service/#externalname)**
ExternalName íƒ€ì…ì˜ ì„œë¹„ìŠ¤ëŠ” **ì„œë¹„ìŠ¤ë¥¼ DNS ì´ë¦„ì— ë§¤í•‘**í•˜ë©°, ì¼ë°˜ì ì¸ ì„ íƒê¸°ì¸ `my-service` ë˜ëŠ” `cassandra`ì™€ ê°™ì€ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ì´ëŸ¬í•œ ì„œë¹„ìŠ¤ëŠ” `spec.externalName` ë§¤ê°œë³€ìˆ˜ë¡œ ì§€ì •í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ì€ ì„œë¹„ìŠ¤ ì •ì˜ëŠ” `prod` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ `my-service` ì„œë¹„ìŠ¤ë¥¼ `my.database.example.com`ì— ë§¤í•‘í•©ë‹ˆë‹¤:
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-service
namespace: prod
spec:
type: ExternalName
externalName: my.database.example.com
```
í˜¸ìŠ¤íŠ¸ `my-service.prod.svc.cluster.local`ì„ ì¡°íšŒí•  ë•Œ, í´ëŸ¬ìŠ¤í„° DNS ì„œë¹„ìŠ¤ëŠ” ê°’ì´ `my.database.example.com`ì¸ `CNAME` ë ˆì½”ë“œë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. `my-service`ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì€ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì‘ë™í•˜ì§€ë§Œ, ì¤‘ìš”í•œ ì°¨ì´ì ì€ **ë¦¬ë‹¤ì´ë ‰ì…˜ì´ í”„ë¡ì‹œ ë˜ëŠ” í¬ì›Œë”©ì„ í†µí•œ ê²ƒì´ ì•„ë‹ˆë¼ DNS ìˆ˜ì¤€ì—ì„œ ë°œìƒí•œë‹¤ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.

### ì™¸ë¶€ IP <a href="#external-ips" id="external-ips"></a>

ì™¸ë¶€ IP(ëŒ€ìƒ IPë¡œ)ë¡œ í´ëŸ¬ìŠ¤í„°ë¡œ ì¸ì…í•˜ëŠ” íŠ¸ë˜í”½ì€ ì„œë¹„ìŠ¤ í¬íŠ¸ë¡œ ë¼ìš°íŒ…ë˜ì–´ **ì„œë¹„ìŠ¤ ì—”ë“œí¬ì¸íŠ¸ ì¤‘ í•˜ë‚˜ë¡œ ì „ë‹¬**ë©ë‹ˆë‹¤. `externalIPs`ëŠ” Kubernetesì—ì„œ ê´€ë¦¬ë˜ì§€ ì•Šìœ¼ë©° í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ìì˜ ì±…ì„ì…ë‹ˆë‹¤.

ì„œë¹„ìŠ¤ ìŠ¤í™ì—ì„œ `externalIPs`ëŠ” `ServiceTypes`ì™€ í•¨ê»˜ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì˜ˆì‹œì—ì„œ "`my-service`"ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ "`80.11.12.10:80`"(`externalIP:port`)ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-service
spec:
selector:
app: MyApp
ports:
- name: http
protocol: TCP
port: 80
targetPort: 9376
externalIPs:
- 80.11.12.10
```
### Ingress

ìœ„ì˜ ëª¨ë“  ì˜ˆì œì™€ ë‹¬ë¦¬ **IngressëŠ” ì„œë¹„ìŠ¤ ìœ í˜•ì´ ì•„ë‹™ë‹ˆë‹¤**. ëŒ€ì‹ , ì—¬ëŸ¬ ì„œë¹„ìŠ¤ ì•ì— ìœ„ì¹˜í•˜ì—¬ "ìŠ¤ë§ˆíŠ¸ ë¼ìš°í„°" ë˜ëŠ” í´ëŸ¬ìŠ¤í„°ë¡œì˜ ì§„ì…ì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.

Ingressë¡œ ë§ì€ ë‹¤ì–‘í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë©°, **ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ê°–ì¶˜ ì—¬ëŸ¬ ìœ í˜•ì˜ Ingress ì»¨íŠ¸ë¡¤ëŸ¬**ê°€ ìˆìŠµë‹ˆë‹¤.

ê¸°ë³¸ GKE Ingress ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” [HTTP(S) ë¡œë“œ ë°¸ëŸ°ì„œ](https://cloud.google.com/compute/docs/load-balancing/http/)ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê²½ë¡œ ê¸°ë°˜ ë° ì„œë¸Œë„ë©”ì¸ ê¸°ë°˜ì˜ ë¼ìš°íŒ…ì„ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, foo.yourdomain.comì˜ ëª¨ë“  ìš”ì²­ì„ foo ì„œë¹„ìŠ¤ë¡œ ë³´ë‚´ê³ , yourdomain.com/bar/ ê²½ë¡œ ì•„ë˜ì˜ ëª¨ë“  ìš”ì²­ì„ bar ì„œë¹„ìŠ¤ë¡œ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

GKEì—ì„œ [L7 HTTP ë¡œë“œ ë°¸ëŸ°ì„œ](https://cloud.google.com/compute/docs/load-balancing/http/)ë¥¼ ì‚¬ìš©í•˜ëŠ” Ingress ê°ì²´ì˜ YAMLì€ ë‹¤ìŒê³¼ ê°™ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```yaml
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
name: my-ingress
spec:
backend:
serviceName: other
servicePort: 8080
rules:
- host: foo.mydomain.com
http:
paths:
- backend:
serviceName: foo
servicePort: 8080
- host: mydomain.com
http:
paths:
- path: /bar/*
backend:
serviceName: bar
servicePort: 8080
```
### ì°¸ê³  ìë£Œ

* [https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0](https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0)
* [https://kubernetes.io/docs/concepts/services-networking/service/](https://kubernetes.io/docs/concepts/services-networking/service/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)ì„ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ ê¸°êµë¥¼ ê³µìœ **í•˜ì„¸ìš”.

</details>
